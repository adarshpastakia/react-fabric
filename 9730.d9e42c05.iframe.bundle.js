/*! For license information please see 9730.d9e42c05.iframe.bundle.js.LICENSE.txt */
(self.webpackChunkreact_fabric=self.webpackChunkreact_fabric||[]).push([[9730],{"./node_modules/@storybook/addon-actions/dist/index.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{XI:()=>action});var v4=__webpack_require__("./node_modules/@storybook/addon-actions/node_modules/uuid/dist/esm-browser/v4.js"),external_STORYBOOK_MODULE_PREVIEW_API_=__webpack_require__("storybook/internal/preview-api"),external_STORYBOOK_MODULE_GLOBAL_=__webpack_require__("@storybook/global"),external_STORYBOOK_MODULE_CORE_EVENTS_PREVIEW_ERRORS_=__webpack_require__("storybook/internal/preview-errors"),ADDON_ID="storybook/actions",EVENT_ID=`${ADDON_ID}/action-event`,config={depth:10,clearOnStoryChange:!0,limit:50},findProto=(obj,callback)=>{let proto=Object.getPrototypeOf(obj);return!proto||callback(proto)?proto:findProto(proto,callback)},serializeArg=a=>{if("object"==typeof(e=a)&&e&&findProto(e,(proto=>/^Synthetic(?:Base)?Event$/.test(proto.constructor.name)))&&"function"==typeof e.persist){let e=Object.create(a.constructor.prototype,Object.getOwnPropertyDescriptors(a));e.persist();let viewDescriptor=Object.getOwnPropertyDescriptor(e,"view"),view=viewDescriptor?.value;return"object"==typeof view&&"Window"===view?.constructor.name&&Object.defineProperty(e,"view",{...viewDescriptor,value:Object.create(view.constructor.prototype)}),e}var e;return a},generateId=()=>"object"==typeof crypto&&"function"==typeof crypto.getRandomValues?(0,v4.A)():Date.now().toString(36)+Math.random().toString(36).substring(2);function action(name,options={}){let actionOptions={...config,...options},handler=function(...args){if(options.implicit){let storyRenderer=("__STORYBOOK_PREVIEW__"in external_STORYBOOK_MODULE_GLOBAL_.global?external_STORYBOOK_MODULE_GLOBAL_.global.__STORYBOOK_PREVIEW__:void 0)?.storyRenders.find((render=>"playing"===render.phase||"rendering"===render.phase));if(storyRenderer){let deprecated=!window?.FEATURES?.disallowImplicitActionsInRenderV8,error=new external_STORYBOOK_MODULE_CORE_EVENTS_PREVIEW_ERRORS_.ImplicitActionsDuringRendering({phase:storyRenderer.phase,name,deprecated});if(!deprecated)throw error;console.warn(error)}}let channel=external_STORYBOOK_MODULE_PREVIEW_API_.addons.getChannel(),id=generateId(),serializedArgs=args.map(serializeArg),normalizedArgs=args.length>1?serializedArgs:serializedArgs[0],actionDisplayToEmit={id,count:0,data:{name,args:normalizedArgs},options:{...actionOptions,maxDepth:5+(actionOptions.depth||3),allowFunction:actionOptions.allowFunction||!1}};channel.emit(EVENT_ID,actionDisplayToEmit)};return handler.isAction=!0,handler.implicit=options.implicit,handler}},"./node_modules/@tiptap/core/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{KE:()=>Editor,YY:()=>Extension,CU:()=>Mark,bP:()=>Node,gk:()=>callOrReturn,T7:()=>combineTransactionSteps,Nx:()=>findChildrenInRange,Zx:()=>generateHTML,yQ:()=>generateJSON,Df:()=>generateText,gu:()=>getAttributes,FF:()=>getChangedRanges,iI:()=>getExtensionField,ve:()=>getMarkRange,hO:()=>getMarksBetween,_w:()=>getSchema,BQ:()=>isNodeSelection,OX:()=>markInputRule,Zc:()=>markPasteRule,KV:()=>mergeAttributes,jT:()=>nodeInputRule,JJ:()=>textblockTypeInputRule,tG:()=>wrappingInputRule});var dist=__webpack_require__("./node_modules/prosemirror-state/dist/index.js"),prosemirror_view_dist=__webpack_require__("./node_modules/prosemirror-view/dist/index.js"),prosemirror_keymap_dist=__webpack_require__("./node_modules/prosemirror-keymap/dist/index.js"),prosemirror_model_dist=__webpack_require__("./node_modules/prosemirror-model/dist/index.js"),prosemirror_transform_dist=__webpack_require__("./node_modules/prosemirror-transform/dist/index.js");const deleteSelection=(state,dispatch)=>!state.selection.empty&&(dispatch&&dispatch(state.tr.deleteSelection().scrollIntoView()),!0);function atBlockStart(state,view){let{$cursor}=state.selection;return!$cursor||(view?!view.endOfTextblock("backward",state):$cursor.parentOffset>0)?null:$cursor}const joinBackward=(state,dispatch,view)=>{let $cursor=atBlockStart(state,view);if(!$cursor)return!1;let $cut=findCutBefore($cursor);if(!$cut){let range=$cursor.blockRange(),target=range&&(0,prosemirror_transform_dist.jP)(range);return null!=target&&(dispatch&&dispatch(state.tr.lift(range,target).scrollIntoView()),!0)}let before=$cut.nodeBefore;if(deleteBarrier(state,$cut,dispatch,-1))return!0;if(0==$cursor.parent.content.size&&(textblockAt(before,"end")||dist.nh.isSelectable(before)))for(let depth=$cursor.depth;;depth--){let delStep=(0,prosemirror_transform_dist.$L)(state.doc,$cursor.before(depth),$cursor.after(depth),prosemirror_model_dist.Ji.empty);if(delStep&&delStep.slice.size<delStep.to-delStep.from){if(dispatch){let tr=state.tr.step(delStep);tr.setSelection(textblockAt(before,"end")?dist.LN.findFrom(tr.doc.resolve(tr.mapping.map($cut.pos,-1)),-1):dist.nh.create(tr.doc,$cut.pos-before.nodeSize)),dispatch(tr.scrollIntoView())}return!0}if(1==depth||$cursor.node(depth-1).childCount>1)break}return!(!before.isAtom||$cut.depth!=$cursor.depth-1)&&(dispatch&&dispatch(state.tr.delete($cut.pos-before.nodeSize,$cut.pos).scrollIntoView()),!0)};function joinTextblocksAround(state,$cut,dispatch){let beforeText=$cut.nodeBefore,beforePos=$cut.pos-1;for(;!beforeText.isTextblock;beforePos--){if(beforeText.type.spec.isolating)return!1;let child=beforeText.lastChild;if(!child)return!1;beforeText=child}let afterText=$cut.nodeAfter,afterPos=$cut.pos+1;for(;!afterText.isTextblock;afterPos++){if(afterText.type.spec.isolating)return!1;let child=afterText.firstChild;if(!child)return!1;afterText=child}let step=(0,prosemirror_transform_dist.$L)(state.doc,beforePos,afterPos,prosemirror_model_dist.Ji.empty);if(!step||step.from!=beforePos||step instanceof prosemirror_transform_dist.Ln&&step.slice.size>=afterPos-beforePos)return!1;if(dispatch){let tr=state.tr.step(step);tr.setSelection(dist.U3.create(tr.doc,beforePos)),dispatch(tr.scrollIntoView())}return!0}function textblockAt(node,side,only=!1){for(let scan=node;scan;scan="start"==side?scan.firstChild:scan.lastChild){if(scan.isTextblock)return!0;if(only&&1!=scan.childCount)return!1}return!1}const selectNodeBackward=(state,dispatch,view)=>{let{$head,empty}=state.selection,$cut=$head;if(!empty)return!1;if($head.parent.isTextblock){if(view?!view.endOfTextblock("backward",state):$head.parentOffset>0)return!1;$cut=findCutBefore($head)}let node=$cut&&$cut.nodeBefore;return!(!node||!dist.nh.isSelectable(node))&&(dispatch&&dispatch(state.tr.setSelection(dist.nh.create(state.doc,$cut.pos-node.nodeSize)).scrollIntoView()),!0)};function findCutBefore($pos){if(!$pos.parent.type.spec.isolating)for(let i=$pos.depth-1;i>=0;i--){if($pos.index(i)>0)return $pos.doc.resolve($pos.before(i+1));if($pos.node(i).type.spec.isolating)break}return null}function atBlockEnd(state,view){let{$cursor}=state.selection;return!$cursor||(view?!view.endOfTextblock("forward",state):$cursor.parentOffset<$cursor.parent.content.size)?null:$cursor}const joinForward=(state,dispatch,view)=>{let $cursor=atBlockEnd(state,view);if(!$cursor)return!1;let $cut=findCutAfter($cursor);if(!$cut)return!1;let after=$cut.nodeAfter;if(deleteBarrier(state,$cut,dispatch,1))return!0;if(0==$cursor.parent.content.size&&(textblockAt(after,"start")||dist.nh.isSelectable(after))){let delStep=(0,prosemirror_transform_dist.$L)(state.doc,$cursor.before(),$cursor.after(),prosemirror_model_dist.Ji.empty);if(delStep&&delStep.slice.size<delStep.to-delStep.from){if(dispatch){let tr=state.tr.step(delStep);tr.setSelection(textblockAt(after,"start")?dist.LN.findFrom(tr.doc.resolve(tr.mapping.map($cut.pos)),1):dist.nh.create(tr.doc,tr.mapping.map($cut.pos))),dispatch(tr.scrollIntoView())}return!0}}return!(!after.isAtom||$cut.depth!=$cursor.depth-1)&&(dispatch&&dispatch(state.tr.delete($cut.pos,$cut.pos+after.nodeSize).scrollIntoView()),!0)},selectNodeForward=(state,dispatch,view)=>{let{$head,empty}=state.selection,$cut=$head;if(!empty)return!1;if($head.parent.isTextblock){if(view?!view.endOfTextblock("forward",state):$head.parentOffset<$head.parent.content.size)return!1;$cut=findCutAfter($head)}let node=$cut&&$cut.nodeAfter;return!(!node||!dist.nh.isSelectable(node))&&(dispatch&&dispatch(state.tr.setSelection(dist.nh.create(state.doc,$cut.pos)).scrollIntoView()),!0)};function findCutAfter($pos){if(!$pos.parent.type.spec.isolating)for(let i=$pos.depth-1;i>=0;i--){let parent=$pos.node(i);if($pos.index(i)+1<parent.childCount)return $pos.doc.resolve($pos.after(i+1));if(parent.type.spec.isolating)break}return null}const newlineInCode=(state,dispatch)=>{let{$head,$anchor}=state.selection;return!(!$head.parent.type.spec.code||!$head.sameParent($anchor))&&(dispatch&&dispatch(state.tr.insertText("\n").scrollIntoView()),!0)};function defaultBlockAt(match){for(let i=0;i<match.edgeCount;i++){let{type}=match.edge(i);if(type.isTextblock&&!type.hasRequiredAttrs())return type}return null}const exitCode=(state,dispatch)=>{let{$head,$anchor}=state.selection;if(!$head.parent.type.spec.code||!$head.sameParent($anchor))return!1;let above=$head.node(-1),after=$head.indexAfter(-1),type=defaultBlockAt(above.contentMatchAt(after));if(!type||!above.canReplaceWith(after,after,type))return!1;if(dispatch){let pos=$head.after(),tr=state.tr.replaceWith(pos,pos,type.createAndFill());tr.setSelection(dist.LN.near(tr.doc.resolve(pos),1)),dispatch(tr.scrollIntoView())}return!0},createParagraphNear=(state,dispatch)=>{let sel=state.selection,{$from,$to}=sel;if(sel instanceof dist.i5||$from.parent.inlineContent||$to.parent.inlineContent)return!1;let type=defaultBlockAt($to.parent.contentMatchAt($to.indexAfter()));if(!type||!type.isTextblock)return!1;if(dispatch){let side=(!$from.parentOffset&&$to.index()<$to.parent.childCount?$from:$to).pos,tr=state.tr.insert(side,type.createAndFill());tr.setSelection(dist.U3.create(tr.doc,side+1)),dispatch(tr.scrollIntoView())}return!0},liftEmptyBlock=(state,dispatch)=>{let{$cursor}=state.selection;if(!$cursor||$cursor.parent.content.size)return!1;if($cursor.depth>1&&$cursor.after()!=$cursor.end(-1)){let before=$cursor.before();if((0,prosemirror_transform_dist.zy)(state.doc,before))return dispatch&&dispatch(state.tr.split(before).scrollIntoView()),!0}let range=$cursor.blockRange(),target=range&&(0,prosemirror_transform_dist.jP)(range);return null!=target&&(dispatch&&dispatch(state.tr.lift(range,target).scrollIntoView()),!0)};const splitBlock=function splitBlockAs(splitNode){return(state,dispatch)=>{let{$from,$to}=state.selection;if(state.selection instanceof dist.nh&&state.selection.node.isBlock)return!(!$from.parentOffset||!(0,prosemirror_transform_dist.zy)(state.doc,$from.pos))&&(dispatch&&dispatch(state.tr.split($from.pos).scrollIntoView()),!0);if(!$from.depth)return!1;let splitDepth,deflt,types=[],atEnd=!1,atStart=!1;for(let d=$from.depth;;d--){if($from.node(d).isBlock){atEnd=$from.end(d)==$from.pos+($from.depth-d),atStart=$from.start(d)==$from.pos-($from.depth-d),deflt=defaultBlockAt($from.node(d-1).contentMatchAt($from.indexAfter(d-1)));let splitType=splitNode&&splitNode($to.parent,atEnd,$from);types.unshift(splitType||(atEnd&&deflt?{type:deflt}:null)),splitDepth=d;break}if(1==d)return!1;types.unshift(null)}let tr=state.tr;(state.selection instanceof dist.U3||state.selection instanceof dist.i5)&&tr.deleteSelection();let splitPos=tr.mapping.map($from.pos),can=(0,prosemirror_transform_dist.zy)(tr.doc,splitPos,types.length,types);if(can||(types[0]=deflt?{type:deflt}:null,can=(0,prosemirror_transform_dist.zy)(tr.doc,splitPos,types.length,types)),!can)return!1;if(tr.split(splitPos,types.length,types),!atEnd&&atStart&&$from.node(splitDepth).type!=deflt){let first=tr.mapping.map($from.before(splitDepth)),$first=tr.doc.resolve(first);deflt&&$from.node(splitDepth-1).canReplaceWith($first.index(),$first.index()+1,deflt)&&tr.setNodeMarkup(tr.mapping.map($from.before(splitDepth)),deflt)}return dispatch&&dispatch(tr.scrollIntoView()),!0}}();function deleteBarrier(state,$cut,dispatch,dir){let conn,match,before=$cut.nodeBefore,after=$cut.nodeAfter,isolated=before.type.spec.isolating||after.type.spec.isolating;if(!isolated&&function joinMaybeClear(state,$pos,dispatch){let before=$pos.nodeBefore,after=$pos.nodeAfter,index=$pos.index();return!(!(before&&after&&before.type.compatibleContent(after.type))||(!before.content.size&&$pos.parent.canReplace(index-1,index)?(dispatch&&dispatch(state.tr.delete($pos.pos-before.nodeSize,$pos.pos).scrollIntoView()),0):!$pos.parent.canReplace(index,index+1)||!after.isTextblock&&!(0,prosemirror_transform_dist.n9)(state.doc,$pos.pos)||(dispatch&&dispatch(state.tr.join($pos.pos).scrollIntoView()),0)))}(state,$cut,dispatch))return!0;let canDelAfter=!isolated&&$cut.parent.canReplace($cut.index(),$cut.index()+1);if(canDelAfter&&(conn=(match=before.contentMatchAt(before.childCount)).findWrapping(after.type))&&match.matchType(conn[0]||after.type).validEnd){if(dispatch){let end=$cut.pos+after.nodeSize,wrap=prosemirror_model_dist.FK.empty;for(let i=conn.length-1;i>=0;i--)wrap=prosemirror_model_dist.FK.from(conn[i].create(null,wrap));wrap=prosemirror_model_dist.FK.from(before.copy(wrap));let tr=state.tr.step(new prosemirror_transform_dist.Wg($cut.pos-1,end,$cut.pos,end,new prosemirror_model_dist.Ji(wrap,1,0),conn.length,!0)),$joinAt=tr.doc.resolve(end+2*conn.length);$joinAt.nodeAfter&&$joinAt.nodeAfter.type==before.type&&(0,prosemirror_transform_dist.n9)(tr.doc,$joinAt.pos)&&tr.join($joinAt.pos),dispatch(tr.scrollIntoView())}return!0}let selAfter=after.type.spec.isolating||dir>0&&isolated?null:dist.LN.findFrom($cut,1),range=selAfter&&selAfter.$from.blockRange(selAfter.$to),target=range&&(0,prosemirror_transform_dist.jP)(range);if(null!=target&&target>=$cut.depth)return dispatch&&dispatch(state.tr.lift(range,target).scrollIntoView()),!0;if(canDelAfter&&textblockAt(after,"start",!0)&&textblockAt(before,"end")){let at=before,wrap=[];for(;wrap.push(at),!at.isTextblock;)at=at.lastChild;let afterText=after,afterDepth=1;for(;!afterText.isTextblock;afterText=afterText.firstChild)afterDepth++;if(at.canReplace(at.childCount,at.childCount,afterText.content)){if(dispatch){let end=prosemirror_model_dist.FK.empty;for(let i=wrap.length-1;i>=0;i--)end=prosemirror_model_dist.FK.from(wrap[i].copy(end));dispatch(state.tr.step(new prosemirror_transform_dist.Wg($cut.pos-wrap.length,$cut.pos+after.nodeSize,$cut.pos+afterDepth,$cut.pos+after.nodeSize-afterDepth,new prosemirror_model_dist.Ji(end,wrap.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function selectTextblockSide(side){return function(state,dispatch){let sel=state.selection,$pos=side<0?sel.$from:sel.$to,depth=$pos.depth;for(;$pos.node(depth).isInline;){if(!depth)return!1;depth--}return!!$pos.node(depth).isTextblock&&(dispatch&&dispatch(state.tr.setSelection(dist.U3.create(state.doc,side<0?$pos.start(depth):$pos.end(depth)))),!0)}}const selectTextblockStart=selectTextblockSide(-1),selectTextblockEnd=selectTextblockSide(1);function setBlockType(nodeType,attrs=null){return function(state,dispatch){let applicable=!1;for(let i=0;i<state.selection.ranges.length&&!applicable;i++){let{$from:{pos:from},$to:{pos:to}}=state.selection.ranges[i];state.doc.nodesBetween(from,to,((node,pos)=>{if(applicable)return!1;if(node.isTextblock&&!node.hasMarkup(nodeType,attrs))if(node.type==nodeType)applicable=!0;else{let $pos=state.doc.resolve(pos),index=$pos.index();applicable=$pos.parent.canReplaceWith(index,index+1,nodeType)}}))}if(!applicable)return!1;if(dispatch){let tr=state.tr;for(let i=0;i<state.selection.ranges.length;i++){let{$from:{pos:from},$to:{pos:to}}=state.selection.ranges[i];tr.setBlockType(from,to,nodeType,attrs)}dispatch(tr.scrollIntoView())}return!0}}function chainCommands(...commands){return function(state,dispatch,view){for(let i=0;i<commands.length;i++)if(commands[i](state,dispatch,view))return!0;return!1}}let backspace=chainCommands(deleteSelection,joinBackward,selectNodeBackward),del=chainCommands(deleteSelection,joinForward,selectNodeForward);const pcBaseKeymap={Enter:chainCommands(newlineInCode,createParagraphNear,liftEmptyBlock,splitBlock),"Mod-Enter":exitCode,Backspace:backspace,"Mod-Backspace":backspace,"Shift-Backspace":backspace,Delete:del,"Mod-Delete":del,"Mod-a":(state,dispatch)=>(dispatch&&dispatch(state.tr.setSelection(new dist.i5(state.doc))),!0)},macBaseKeymap={"Ctrl-h":pcBaseKeymap.Backspace,"Alt-Backspace":pcBaseKeymap["Mod-Backspace"],"Ctrl-d":pcBaseKeymap.Delete,"Ctrl-Alt-Backspace":pcBaseKeymap["Mod-Delete"],"Alt-Delete":pcBaseKeymap["Mod-Delete"],"Alt-d":pcBaseKeymap["Mod-Delete"],"Ctrl-a":selectTextblockStart,"Ctrl-e":selectTextblockEnd};for(let key in pcBaseKeymap)macBaseKeymap[key]=pcBaseKeymap[key];"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!("undefined"==typeof os||!os.platform)&&os.platform();function wrapInList(listType,attrs=null){return function(state,dispatch){let{$from,$to}=state.selection,range=$from.blockRange($to);if(!range)return!1;let tr=dispatch?state.tr:null;return!!function wrapRangeInList(tr,range,listType,attrs=null){let doJoin=!1,outerRange=range,doc=range.$from.doc;if(range.depth>=2&&range.$from.node(range.depth-1).type.compatibleContent(listType)&&0==range.startIndex){if(0==range.$from.index(range.depth-1))return!1;let $insert=doc.resolve(range.start-2);outerRange=new prosemirror_model_dist.u$($insert,$insert,range.depth),range.endIndex<range.parent.childCount&&(range=new prosemirror_model_dist.u$(range.$from,doc.resolve(range.$to.end(range.depth)),range.depth)),doJoin=!0}let wrap=(0,prosemirror_transform_dist.oM)(outerRange,listType,attrs,range);if(!wrap)return!1;tr&&function doWrapInList(tr,range,wrappers,joinBefore,listType){let content=prosemirror_model_dist.FK.empty;for(let i=wrappers.length-1;i>=0;i--)content=prosemirror_model_dist.FK.from(wrappers[i].type.create(wrappers[i].attrs,content));tr.step(new prosemirror_transform_dist.Wg(range.start-(joinBefore?2:0),range.end,range.start,range.end,new prosemirror_model_dist.Ji(content,0,0),wrappers.length,!0));let found=0;for(let i=0;i<wrappers.length;i++)wrappers[i].type==listType&&(found=i+1);let splitDepth=wrappers.length-found,splitPos=range.start+wrappers.length-(joinBefore?2:0),parent=range.parent;for(let i=range.startIndex,e=range.endIndex,first=!0;i<e;i++,first=!1)!first&&(0,prosemirror_transform_dist.zy)(tr.doc,splitPos,splitDepth)&&(tr.split(splitPos,splitDepth),splitPos+=2*splitDepth),splitPos+=parent.child(i).nodeSize;return tr}(tr,range,wrap,doJoin,listType);return!0}(tr,range,listType,attrs)&&(dispatch&&dispatch(tr.scrollIntoView()),!0)}}function liftListItem(itemType){return function(state,dispatch){let{$from,$to}=state.selection,range=$from.blockRange($to,(node=>node.childCount>0&&node.firstChild.type==itemType));return!!range&&(!dispatch||($from.node(range.depth-1).type==itemType?function liftToOuterList(state,dispatch,itemType,range){let tr=state.tr,end=range.end,endOfList=range.$to.end(range.depth);end<endOfList&&(tr.step(new prosemirror_transform_dist.Wg(end-1,endOfList,end,endOfList,new prosemirror_model_dist.Ji(prosemirror_model_dist.FK.from(itemType.create(null,range.parent.copy())),1,0),1,!0)),range=new prosemirror_model_dist.u$(tr.doc.resolve(range.$from.pos),tr.doc.resolve(endOfList),range.depth));const target=(0,prosemirror_transform_dist.jP)(range);if(null==target)return!1;tr.lift(range,target);let $after=tr.doc.resolve(tr.mapping.map(end,-1)-1);(0,prosemirror_transform_dist.n9)(tr.doc,$after.pos)&&$after.nodeBefore.type==$after.nodeAfter.type&&tr.join($after.pos);return dispatch(tr.scrollIntoView()),!0}(state,dispatch,itemType,range):function liftOutOfList(state,dispatch,range){let tr=state.tr,list=range.parent;for(let pos=range.end,i=range.endIndex-1,e=range.startIndex;i>e;i--)pos-=list.child(i).nodeSize,tr.delete(pos-1,pos+1);let $start=tr.doc.resolve(range.start),item=$start.nodeAfter;if(tr.mapping.map(range.end)!=range.start+$start.nodeAfter.nodeSize)return!1;let atStart=0==range.startIndex,atEnd=range.endIndex==list.childCount,parent=$start.node(-1),indexBefore=$start.index(-1);if(!parent.canReplace(indexBefore+(atStart?0:1),indexBefore+1,item.content.append(atEnd?prosemirror_model_dist.FK.empty:prosemirror_model_dist.FK.from(list))))return!1;let start=$start.pos,end=start+item.nodeSize;return tr.step(new prosemirror_transform_dist.Wg(start-(atStart?1:0),end+(atEnd?1:0),start+1,end-1,new prosemirror_model_dist.Ji((atStart?prosemirror_model_dist.FK.empty:prosemirror_model_dist.FK.from(list.copy(prosemirror_model_dist.FK.empty))).append(atEnd?prosemirror_model_dist.FK.empty:prosemirror_model_dist.FK.from(list.copy(prosemirror_model_dist.FK.empty))),atStart?0:1,atEnd?0:1),atStart?0:1)),dispatch(tr.scrollIntoView()),!0}(state,dispatch,range)))}}function createChainableState(config){const{state,transaction}=config;let{selection}=transaction,{doc}=transaction,{storedMarks}=transaction;return{...state,apply:state.apply.bind(state),applyTransaction:state.applyTransaction.bind(state),plugins:state.plugins,schema:state.schema,reconfigure:state.reconfigure.bind(state),toJSON:state.toJSON.bind(state),get storedMarks(){return storedMarks},get selection(){return selection},get doc(){return doc},get tr(){return selection=transaction.selection,doc=transaction.doc,storedMarks=transaction.storedMarks,transaction}}}class CommandManager{constructor(props){this.editor=props.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=props.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands,editor,state}=this,{view}=editor,{tr}=state,props=this.buildProps(tr);return Object.fromEntries(Object.entries(rawCommands).map((([name,command])=>[name,(...args)=>{const callback=command(...args)(props);return tr.getMeta("preventDispatch")||this.hasCustomState||view.dispatch(tr),callback}])))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(startTr,shouldDispatch=!0){const{rawCommands,editor,state}=this,{view}=editor,callbacks=[],hasStartTransaction=!!startTr,tr=startTr||state.tr,chain={...Object.fromEntries(Object.entries(rawCommands).map((([name,command])=>[name,(...args)=>{const props=this.buildProps(tr,shouldDispatch),callback=command(...args)(props);return callbacks.push(callback),chain}]))),run:()=>(hasStartTransaction||!shouldDispatch||tr.getMeta("preventDispatch")||this.hasCustomState||view.dispatch(tr),callbacks.every((callback=>!0===callback)))};return chain}createCan(startTr){const{rawCommands,state}=this,tr=startTr||state.tr,props=this.buildProps(tr,false),formattedCommands=Object.fromEntries(Object.entries(rawCommands).map((([name,command])=>[name,(...args)=>command(...args)({...props,dispatch:void 0})])));return{...formattedCommands,chain:()=>this.createChain(tr,false)}}buildProps(tr,shouldDispatch=!0){const{rawCommands,editor,state}=this,{view}=editor,props={tr,editor,view,state:createChainableState({state,transaction:tr}),dispatch:shouldDispatch?()=>{}:void 0,chain:()=>this.createChain(tr,shouldDispatch),can:()=>this.createCan(tr),get commands(){return Object.fromEntries(Object.entries(rawCommands).map((([name,command])=>[name,(...args)=>command(...args)(props)])))}};return props}}class EventEmitter{constructor(){this.callbacks={}}on(event,fn){return this.callbacks[event]||(this.callbacks[event]=[]),this.callbacks[event].push(fn),this}emit(event,...args){const callbacks=this.callbacks[event];return callbacks&&callbacks.forEach((callback=>callback.apply(this,args))),this}off(event,fn){const callbacks=this.callbacks[event];return callbacks&&(fn?this.callbacks[event]=callbacks.filter((callback=>callback!==fn)):delete this.callbacks[event]),this}once(event,fn){const onceFn=(...args)=>{this.off(event,onceFn),fn.apply(this,args)};return this.on(event,onceFn)}removeAllListeners(){this.callbacks={}}}function getExtensionField(extension,field,context){if(void 0===extension.config[field]&&extension.parent)return getExtensionField(extension.parent,field,context);if("function"==typeof extension.config[field]){return extension.config[field].bind({...context,parent:extension.parent?getExtensionField(extension.parent,field,context):null})}return extension.config[field]}function splitExtensions(extensions){return{baseExtensions:extensions.filter((extension=>"extension"===extension.type)),nodeExtensions:extensions.filter((extension=>"node"===extension.type)),markExtensions:extensions.filter((extension=>"mark"===extension.type))}}function getAttributesFromExtensions(extensions){const extensionAttributes=[],{nodeExtensions,markExtensions}=splitExtensions(extensions),nodeAndMarkExtensions=[...nodeExtensions,...markExtensions],defaultAttribute={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return extensions.forEach((extension=>{const addGlobalAttributes=getExtensionField(extension,"addGlobalAttributes",{name:extension.name,options:extension.options,storage:extension.storage,extensions:nodeAndMarkExtensions});if(!addGlobalAttributes)return;addGlobalAttributes().forEach((globalAttribute=>{globalAttribute.types.forEach((type=>{Object.entries(globalAttribute.attributes).forEach((([name,attribute])=>{extensionAttributes.push({type,name,attribute:{...defaultAttribute,...attribute}})}))}))}))})),nodeAndMarkExtensions.forEach((extension=>{const context={name:extension.name,options:extension.options,storage:extension.storage},addAttributes=getExtensionField(extension,"addAttributes",context);if(!addAttributes)return;const attributes=addAttributes();Object.entries(attributes).forEach((([name,attribute])=>{const mergedAttr={...defaultAttribute,...attribute};"function"==typeof(null==mergedAttr?void 0:mergedAttr.default)&&(mergedAttr.default=mergedAttr.default()),(null==mergedAttr?void 0:mergedAttr.isRequired)&&void 0===(null==mergedAttr?void 0:mergedAttr.default)&&delete mergedAttr.default,extensionAttributes.push({type:extension.name,name,attribute:mergedAttr})}))})),extensionAttributes}function getNodeType(nameOrType,schema){if("string"==typeof nameOrType){if(!schema.nodes[nameOrType])throw Error(`There is no node type named '${nameOrType}'. Maybe you forgot to add the extension?`);return schema.nodes[nameOrType]}return nameOrType}function mergeAttributes(...objects){return objects.filter((item=>!!item)).reduce(((items,item)=>{const mergedAttributes={...items};return Object.entries(item).forEach((([key,value])=>{if(mergedAttributes[key])if("class"===key){const valueClasses=value?String(value).split(" "):[],existingClasses=mergedAttributes[key]?mergedAttributes[key].split(" "):[],insertClasses=valueClasses.filter((valueClass=>!existingClasses.includes(valueClass)));mergedAttributes[key]=[...existingClasses,...insertClasses].join(" ")}else if("style"===key){const newStyles=value?value.split(";").map((style=>style.trim())).filter(Boolean):[],existingStyles=mergedAttributes[key]?mergedAttributes[key].split(";").map((style=>style.trim())).filter(Boolean):[],styleMap=new Map;existingStyles.forEach((style=>{const[property,val]=style.split(":").map((part=>part.trim()));styleMap.set(property,val)})),newStyles.forEach((style=>{const[property,val]=style.split(":").map((part=>part.trim()));styleMap.set(property,val)})),mergedAttributes[key]=Array.from(styleMap.entries()).map((([property,val])=>`${property}: ${val}`)).join("; ")}else mergedAttributes[key]=value;else mergedAttributes[key]=value})),mergedAttributes}),{})}function getRenderedAttributes(nodeOrMark,extensionAttributes){return extensionAttributes.filter((attribute=>attribute.type===nodeOrMark.type.name)).filter((item=>item.attribute.rendered)).map((item=>item.attribute.renderHTML?item.attribute.renderHTML(nodeOrMark.attrs)||{}:{[item.name]:nodeOrMark.attrs[item.name]})).reduce(((attributes,attribute)=>mergeAttributes(attributes,attribute)),{})}function isFunction(value){return"function"==typeof value}function callOrReturn(value,context=void 0,...props){return isFunction(value)?context?value.bind(context)(...props):value(...props):value}function injectExtensionAttributesToParseRule(parseRule,extensionAttributes){return"style"in parseRule?parseRule:{...parseRule,getAttrs:node=>{const oldAttributes=parseRule.getAttrs?parseRule.getAttrs(node):parseRule.attrs;if(!1===oldAttributes)return!1;const newAttributes=extensionAttributes.reduce(((items,item)=>{const value=item.attribute.parseHTML?item.attribute.parseHTML(node):function fromString(value){return"string"!=typeof value?value:value.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(value):"true"===value||"false"!==value&&value}(node.getAttribute(item.name));return null==value?items:{...items,[item.name]:value}}),{});return{...oldAttributes,...newAttributes}}}}function cleanUpSchemaItem(data){return Object.fromEntries(Object.entries(data).filter((([key,value])=>("attrs"!==key||!function isEmptyObject(value={}){return 0===Object.keys(value).length&&value.constructor===Object}(value))&&null!=value)))}function getSchemaByResolvedExtensions(extensions,editor){var _a;const allAttributes=getAttributesFromExtensions(extensions),{nodeExtensions,markExtensions}=splitExtensions(extensions),topNode=null===(_a=nodeExtensions.find((extension=>getExtensionField(extension,"topNode"))))||void 0===_a?void 0:_a.name,nodes=Object.fromEntries(nodeExtensions.map((extension=>{const extensionAttributes=allAttributes.filter((attribute=>attribute.type===extension.name)),context={name:extension.name,options:extension.options,storage:extension.storage,editor},schema=cleanUpSchemaItem({...extensions.reduce(((fields,e)=>{const extendNodeSchema=getExtensionField(e,"extendNodeSchema",context);return{...fields,...extendNodeSchema?extendNodeSchema(extension):{}}}),{}),content:callOrReturn(getExtensionField(extension,"content",context)),marks:callOrReturn(getExtensionField(extension,"marks",context)),group:callOrReturn(getExtensionField(extension,"group",context)),inline:callOrReturn(getExtensionField(extension,"inline",context)),atom:callOrReturn(getExtensionField(extension,"atom",context)),selectable:callOrReturn(getExtensionField(extension,"selectable",context)),draggable:callOrReturn(getExtensionField(extension,"draggable",context)),code:callOrReturn(getExtensionField(extension,"code",context)),whitespace:callOrReturn(getExtensionField(extension,"whitespace",context)),linebreakReplacement:callOrReturn(getExtensionField(extension,"linebreakReplacement",context)),defining:callOrReturn(getExtensionField(extension,"defining",context)),isolating:callOrReturn(getExtensionField(extension,"isolating",context)),attrs:Object.fromEntries(extensionAttributes.map((extensionAttribute=>{var _a;return[extensionAttribute.name,{default:null===(_a=null==extensionAttribute?void 0:extensionAttribute.attribute)||void 0===_a?void 0:_a.default}]})))}),parseHTML=callOrReturn(getExtensionField(extension,"parseHTML",context));parseHTML&&(schema.parseDOM=parseHTML.map((parseRule=>injectExtensionAttributesToParseRule(parseRule,extensionAttributes))));const renderHTML=getExtensionField(extension,"renderHTML",context);renderHTML&&(schema.toDOM=node=>renderHTML({node,HTMLAttributes:getRenderedAttributes(node,extensionAttributes)}));const renderText=getExtensionField(extension,"renderText",context);return renderText&&(schema.toText=renderText),[extension.name,schema]}))),marks=Object.fromEntries(markExtensions.map((extension=>{const extensionAttributes=allAttributes.filter((attribute=>attribute.type===extension.name)),context={name:extension.name,options:extension.options,storage:extension.storage,editor},schema=cleanUpSchemaItem({...extensions.reduce(((fields,e)=>{const extendMarkSchema=getExtensionField(e,"extendMarkSchema",context);return{...fields,...extendMarkSchema?extendMarkSchema(extension):{}}}),{}),inclusive:callOrReturn(getExtensionField(extension,"inclusive",context)),excludes:callOrReturn(getExtensionField(extension,"excludes",context)),group:callOrReturn(getExtensionField(extension,"group",context)),spanning:callOrReturn(getExtensionField(extension,"spanning",context)),code:callOrReturn(getExtensionField(extension,"code",context)),attrs:Object.fromEntries(extensionAttributes.map((extensionAttribute=>{var _a;return[extensionAttribute.name,{default:null===(_a=null==extensionAttribute?void 0:extensionAttribute.attribute)||void 0===_a?void 0:_a.default}]})))}),parseHTML=callOrReturn(getExtensionField(extension,"parseHTML",context));parseHTML&&(schema.parseDOM=parseHTML.map((parseRule=>injectExtensionAttributesToParseRule(parseRule,extensionAttributes))));const renderHTML=getExtensionField(extension,"renderHTML",context);return renderHTML&&(schema.toDOM=mark=>renderHTML({mark,HTMLAttributes:getRenderedAttributes(mark,extensionAttributes)})),[extension.name,schema]})));return new prosemirror_model_dist.Sj({topNode,nodes,marks})}function getSchemaTypeByName(name,schema){return schema.nodes[name]||schema.marks[name]||null}function isExtensionRulesEnabled(extension,enabled){return Array.isArray(enabled)?enabled.some((enabledExtension=>("string"==typeof enabledExtension?enabledExtension:enabledExtension.name)===extension.name)):enabled}function getHTMLFromFragment(fragment,schema){const documentFragment=prosemirror_model_dist.ZF.fromSchema(schema).serializeFragment(fragment),container=document.implementation.createHTMLDocument().createElement("div");return container.appendChild(documentFragment),container.innerHTML}const getTextContentFromNodes=($from,maxMatch=500)=>{let textBefore="";const sliceEndPos=$from.parentOffset;return $from.parent.nodesBetween(Math.max(0,sliceEndPos-maxMatch),sliceEndPos,((node,pos,parent,index)=>{var _a,_b;const chunk=(null===(_b=(_a=node.type.spec).toText)||void 0===_b?void 0:_b.call(_a,{node,pos,parent,index}))||node.textContent||"%leaf%";textBefore+=node.isAtom&&!node.isText?chunk:chunk.slice(0,Math.max(0,sliceEndPos-pos))})),textBefore};function isRegExp(value){return"[object RegExp]"===Object.prototype.toString.call(value)}class InputRule{constructor(config){this.find=config.find,this.handler=config.handler}}const inputRuleMatcherHandler=(text,find)=>{if(isRegExp(find))return find.exec(text);const inputRuleMatch=find(text);if(!inputRuleMatch)return null;const result=[inputRuleMatch.text];return result.index=inputRuleMatch.index,result.input=text,result.data=inputRuleMatch.data,inputRuleMatch.replaceWith&&(inputRuleMatch.text.includes(inputRuleMatch.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),result.push(inputRuleMatch.replaceWith)),result};function run$1(config){var _a;const{editor,from,to,text,rules,plugin}=config,{view}=editor;if(view.composing)return!1;const $from=view.state.doc.resolve(from);if($from.parent.type.spec.code||(null===(_a=$from.nodeBefore||$from.nodeAfter)||void 0===_a?void 0:_a.marks.find((mark=>mark.type.spec.code))))return!1;let matched=!1;const textBefore=getTextContentFromNodes($from)+text;return rules.forEach((rule=>{if(matched)return;const match=inputRuleMatcherHandler(textBefore,rule.find);if(!match)return;const tr=view.state.tr,state=createChainableState({state:view.state,transaction:tr}),range={from:from-(match[0].length-text.length),to},{commands,chain,can}=new CommandManager({editor,state});null!==rule.handler({state,range,match,commands,chain,can})&&tr.steps.length&&(tr.setMeta(plugin,{transform:tr,from,to,text}),view.dispatch(tr),matched=!0)})),matched}function inputRulesPlugin(props){const{editor,rules}=props,plugin=new dist.k_({state:{init:()=>null,apply(tr,prev,state){const stored=tr.getMeta(plugin);if(stored)return stored;const simulatedInputMeta=tr.getMeta("applyInputRules");return!!simulatedInputMeta&&setTimeout((()=>{let{text}=simulatedInputMeta;"string"==typeof text||(text=getHTMLFromFragment(prosemirror_model_dist.FK.from(text),state.schema));const{from}=simulatedInputMeta,to=from+text.length;run$1({editor,from,to,text,rules,plugin})})),tr.selectionSet||tr.docChanged?null:prev}},props:{handleTextInput:(view,from,to,text)=>run$1({editor,from,to,text,rules,plugin}),handleDOMEvents:{compositionend:view=>(setTimeout((()=>{const{$cursor}=view.state.selection;$cursor&&run$1({editor,from:$cursor.pos,to:$cursor.pos,text:"",rules,plugin})})),!1)},handleKeyDown(view,event){if("Enter"!==event.key)return!1;const{$cursor}=view.state.selection;return!!$cursor&&run$1({editor,from:$cursor.pos,to:$cursor.pos,text:"\n",rules,plugin})}},isInputRules:!0});return plugin}function isPlainObject(value){return"Object"===function getType(value){return Object.prototype.toString.call(value).slice(8,-1)}(value)&&(value.constructor===Object&&Object.getPrototypeOf(value)===Object.prototype)}function mergeDeep(target,source){const output={...target};return isPlainObject(target)&&isPlainObject(source)&&Object.keys(source).forEach((key=>{isPlainObject(source[key])&&isPlainObject(target[key])?output[key]=mergeDeep(target[key],source[key]):output[key]=source[key]})),output}class Mark{constructor(config={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...config},this.name=this.config.name,config.defaultOptions&&Object.keys(config.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=callOrReturn(getExtensionField(this,"addOptions",{name:this.name}))),this.storage=callOrReturn(getExtensionField(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(config={}){return new Mark(config)}configure(options={}){const extension=this.extend({...this.config,addOptions:()=>mergeDeep(this.options,options)});return extension.name=this.name,extension.parent=this.parent,extension}extend(extendedConfig={}){const extension=new Mark(extendedConfig);return extension.parent=this,this.child=extension,extension.name=extendedConfig.name?extendedConfig.name:extension.parent.name,extendedConfig.defaultOptions&&Object.keys(extendedConfig.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${extension.name}".`),extension.options=callOrReturn(getExtensionField(extension,"addOptions",{name:extension.name})),extension.storage=callOrReturn(getExtensionField(extension,"addStorage",{name:extension.name,options:extension.options})),extension}static handleExit({editor,mark}){const{tr}=editor.state,currentPos=editor.state.selection.$from;if(currentPos.pos===currentPos.end()){const currentMarks=currentPos.marks();if(!!!currentMarks.find((m=>(null==m?void 0:m.type.name)===mark.name)))return!1;const removeMark=currentMarks.find((m=>(null==m?void 0:m.type.name)===mark.name));return removeMark&&tr.removeStoredMark(removeMark),tr.insertText(" ",currentPos.pos),editor.view.dispatch(tr),!0}return!1}}class PasteRule{constructor(config){this.find=config.find,this.handler=config.handler}}const pasteRuleMatcherHandler=(text,find,event)=>{if(isRegExp(find))return[...text.matchAll(find)];const matches=find(text,event);return matches?matches.map((pasteRuleMatch=>{const result=[pasteRuleMatch.text];return result.index=pasteRuleMatch.index,result.input=text,result.data=pasteRuleMatch.data,pasteRuleMatch.replaceWith&&(pasteRuleMatch.text.includes(pasteRuleMatch.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),result.push(pasteRuleMatch.replaceWith)),result})):[]};let tiptapDragFromOtherEditor=null;function pasteRulesPlugin(props){const{editor,rules}=props;let dropEvent,dragSourceElement=null,isPastedFromProseMirror=!1,isDroppedFromProseMirror=!1,pasteEvent="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null;try{dropEvent="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch{dropEvent=null}const processEvent=({state,from,to,rule,pasteEvt})=>{const tr=state.tr,chainableState=createChainableState({state,transaction:tr}),handler=function run(config){const{editor,state,from,to,rule,pasteEvent,dropEvent}=config,{commands,chain,can}=new CommandManager({editor,state}),handlers=[];return state.doc.nodesBetween(from,to,((node,pos)=>{if(!node.isTextblock||node.type.spec.code)return;const resolvedFrom=Math.max(from,pos),resolvedTo=Math.min(to,pos+node.content.size),textToMatch=node.textBetween(resolvedFrom-pos,resolvedTo-pos,void 0,"ï¿¼");pasteRuleMatcherHandler(textToMatch,rule.find,pasteEvent).forEach((match=>{if(void 0===match.index)return;const start=resolvedFrom+match.index+1,end=start+match[0].length,range={from:state.tr.mapping.map(start),to:state.tr.mapping.map(end)},handler=rule.handler({state,range,match,commands,chain,can,pasteEvent,dropEvent});handlers.push(handler)}))})),handlers.every((handler=>null!==handler))}({editor,state:chainableState,from:Math.max(from-1,0),to:to.b-1,rule,pasteEvent:pasteEvt,dropEvent});if(handler&&tr.steps.length){try{dropEvent="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch{dropEvent=null}return pasteEvent="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null,tr}};return rules.map((rule=>new dist.k_({view(view){const handleDragstart=event=>{var _a;dragSourceElement=(null===(_a=view.dom.parentElement)||void 0===_a?void 0:_a.contains(event.target))?view.dom.parentElement:null,dragSourceElement&&(tiptapDragFromOtherEditor=editor)},handleDragend=()=>{tiptapDragFromOtherEditor&&(tiptapDragFromOtherEditor=null)};return window.addEventListener("dragstart",handleDragstart),window.addEventListener("dragend",handleDragend),{destroy(){window.removeEventListener("dragstart",handleDragstart),window.removeEventListener("dragend",handleDragend)}}},props:{handleDOMEvents:{drop:(view,event)=>{if(isDroppedFromProseMirror=dragSourceElement===view.dom.parentElement,dropEvent=event,!isDroppedFromProseMirror){const dragFromOtherEditor=tiptapDragFromOtherEditor;dragFromOtherEditor&&setTimeout((()=>{const selection=dragFromOtherEditor.state.selection;selection&&dragFromOtherEditor.commands.deleteRange({from:selection.from,to:selection.to})}),10)}return!1},paste:(_view,event)=>{var _a;const html=null===(_a=event.clipboardData)||void 0===_a?void 0:_a.getData("text/html");return pasteEvent=event,isPastedFromProseMirror=!!(null==html?void 0:html.includes("data-pm-slice")),!1}}},appendTransaction:(transactions,oldState,state)=>{const transaction=transactions[0],isPaste="paste"===transaction.getMeta("uiEvent")&&!isPastedFromProseMirror,isDrop="drop"===transaction.getMeta("uiEvent")&&!isDroppedFromProseMirror,simulatedPasteMeta=transaction.getMeta("applyPasteRules"),isSimulatedPaste=!!simulatedPasteMeta;if(!isPaste&&!isDrop&&!isSimulatedPaste)return;if(isSimulatedPaste){let{text}=simulatedPasteMeta;"string"==typeof text||(text=getHTMLFromFragment(prosemirror_model_dist.FK.from(text),state.schema));const{from}=simulatedPasteMeta,to=from+text.length,pasteEvt=(text=>{var _a;const event=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return null===(_a=event.clipboardData)||void 0===_a||_a.setData("text/html",text),event})(text);return processEvent({rule,state,from,to:{b:to},pasteEvt})}const from=oldState.doc.content.findDiffStart(state.doc.content),to=oldState.doc.content.findDiffEnd(state.doc.content);return function isNumber(value){return"number"==typeof value}(from)&&to&&from!==to.b?processEvent({rule,state,from,to,pasteEvt:pasteEvent}):void 0}})))}class ExtensionManager{constructor(extensions,editor){this.splittableMarks=[],this.editor=editor,this.extensions=ExtensionManager.resolve(extensions),this.schema=getSchemaByResolvedExtensions(this.extensions,editor),this.setupExtensions()}static resolve(extensions){const resolvedExtensions=ExtensionManager.sort(ExtensionManager.flatten(extensions)),duplicatedNames=function findDuplicates(items){const filtered=items.filter(((el,index)=>items.indexOf(el)!==index));return Array.from(new Set(filtered))}(resolvedExtensions.map((extension=>extension.name)));return duplicatedNames.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${duplicatedNames.map((item=>`'${item}'`)).join(", ")}]. This can lead to issues.`),resolvedExtensions}static flatten(extensions){return extensions.map((extension=>{const addExtensions=getExtensionField(extension,"addExtensions",{name:extension.name,options:extension.options,storage:extension.storage});return addExtensions?[extension,...this.flatten(addExtensions())]:extension})).flat(10)}static sort(extensions){return extensions.sort(((a,b)=>{const priorityA=getExtensionField(a,"priority")||100,priorityB=getExtensionField(b,"priority")||100;return priorityA>priorityB?-1:priorityA<priorityB?1:0}))}get commands(){return this.extensions.reduce(((commands,extension)=>{const addCommands=getExtensionField(extension,"addCommands",{name:extension.name,options:extension.options,storage:extension.storage,editor:this.editor,type:getSchemaTypeByName(extension.name,this.schema)});return addCommands?{...commands,...addCommands()}:commands}),{})}get plugins(){const{editor}=this,extensions=ExtensionManager.sort([...this.extensions].reverse()),inputRules=[],pasteRules=[],allPlugins=extensions.map((extension=>{const context={name:extension.name,options:extension.options,storage:extension.storage,editor,type:getSchemaTypeByName(extension.name,this.schema)},plugins=[],addKeyboardShortcuts=getExtensionField(extension,"addKeyboardShortcuts",context);let defaultBindings={};if("mark"===extension.type&&getExtensionField(extension,"exitable",context)&&(defaultBindings.ArrowRight=()=>Mark.handleExit({editor,mark:extension})),addKeyboardShortcuts){const bindings=Object.fromEntries(Object.entries(addKeyboardShortcuts()).map((([shortcut,method])=>[shortcut,()=>method({editor})])));defaultBindings={...defaultBindings,...bindings}}const keyMapPlugin=(0,prosemirror_keymap_dist.w)(defaultBindings);plugins.push(keyMapPlugin);const addInputRules=getExtensionField(extension,"addInputRules",context);isExtensionRulesEnabled(extension,editor.options.enableInputRules)&&addInputRules&&inputRules.push(...addInputRules());const addPasteRules=getExtensionField(extension,"addPasteRules",context);isExtensionRulesEnabled(extension,editor.options.enablePasteRules)&&addPasteRules&&pasteRules.push(...addPasteRules());const addProseMirrorPlugins=getExtensionField(extension,"addProseMirrorPlugins",context);if(addProseMirrorPlugins){const proseMirrorPlugins=addProseMirrorPlugins();plugins.push(...proseMirrorPlugins)}return plugins})).flat();return[inputRulesPlugin({editor,rules:inputRules}),...pasteRulesPlugin({editor,rules:pasteRules}),...allPlugins]}get attributes(){return getAttributesFromExtensions(this.extensions)}get nodeViews(){const{editor}=this,{nodeExtensions}=splitExtensions(this.extensions);return Object.fromEntries(nodeExtensions.filter((extension=>!!getExtensionField(extension,"addNodeView"))).map((extension=>{const extensionAttributes=this.attributes.filter((attribute=>attribute.type===extension.name)),context={name:extension.name,options:extension.options,storage:extension.storage,editor,type:getNodeType(extension.name,this.schema)},addNodeView=getExtensionField(extension,"addNodeView",context);if(!addNodeView)return[];return[extension.name,(node,view,getPos,decorations,innerDecorations)=>{const HTMLAttributes=getRenderedAttributes(node,extensionAttributes);return addNodeView()({node,view,getPos,decorations,innerDecorations,editor,extension,HTMLAttributes})}]})))}setupExtensions(){this.extensions.forEach((extension=>{var _a;this.editor.extensionStorage[extension.name]=extension.storage;const context={name:extension.name,options:extension.options,storage:extension.storage,editor:this.editor,type:getSchemaTypeByName(extension.name,this.schema)};if("mark"===extension.type){(null===(_a=callOrReturn(getExtensionField(extension,"keepOnSplit",context)))||void 0===_a||_a)&&this.splittableMarks.push(extension.name)}const onBeforeCreate=getExtensionField(extension,"onBeforeCreate",context),onCreate=getExtensionField(extension,"onCreate",context),onUpdate=getExtensionField(extension,"onUpdate",context),onSelectionUpdate=getExtensionField(extension,"onSelectionUpdate",context),onTransaction=getExtensionField(extension,"onTransaction",context),onFocus=getExtensionField(extension,"onFocus",context),onBlur=getExtensionField(extension,"onBlur",context),onDestroy=getExtensionField(extension,"onDestroy",context);onBeforeCreate&&this.editor.on("beforeCreate",onBeforeCreate),onCreate&&this.editor.on("create",onCreate),onUpdate&&this.editor.on("update",onUpdate),onSelectionUpdate&&this.editor.on("selectionUpdate",onSelectionUpdate),onTransaction&&this.editor.on("transaction",onTransaction),onFocus&&this.editor.on("focus",onFocus),onBlur&&this.editor.on("blur",onBlur),onDestroy&&this.editor.on("destroy",onDestroy)}))}}class Extension{constructor(config={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...config},this.name=this.config.name,config.defaultOptions&&Object.keys(config.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=callOrReturn(getExtensionField(this,"addOptions",{name:this.name}))),this.storage=callOrReturn(getExtensionField(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(config={}){return new Extension(config)}configure(options={}){const extension=this.extend({...this.config,addOptions:()=>mergeDeep(this.options,options)});return extension.name=this.name,extension.parent=this.parent,extension}extend(extendedConfig={}){const extension=new Extension({...this.config,...extendedConfig});return extension.parent=this,this.child=extension,extension.name=extendedConfig.name?extendedConfig.name:extension.parent.name,extendedConfig.defaultOptions&&Object.keys(extendedConfig.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${extension.name}".`),extension.options=callOrReturn(getExtensionField(extension,"addOptions",{name:extension.name})),extension.storage=callOrReturn(getExtensionField(extension,"addStorage",{name:extension.name,options:extension.options})),extension}}function getTextBetween(startNode,range,options){const{from,to}=range,{blockSeparator="\n\n",textSerializers={}}=options||{};let text="";return startNode.nodesBetween(from,to,((node,pos,parent,index)=>{var _a;node.isBlock&&pos>from&&(text+=blockSeparator);const textSerializer=null==textSerializers?void 0:textSerializers[node.type.name];if(textSerializer)return parent&&(text+=textSerializer({node,pos,parent,index,range})),!1;node.isText&&(text+=null===(_a=null==node?void 0:node.text)||void 0===_a?void 0:_a.slice(Math.max(from,pos)-pos,to-pos))})),text}function getTextSerializersFromSchema(schema){return Object.fromEntries(Object.entries(schema.nodes).filter((([,node])=>node.spec.toText)).map((([name,node])=>[name,node.spec.toText])))}const ClipboardTextSerializer=Extension.create({name:"clipboardTextSerializer",addOptions:()=>({blockSeparator:void 0}),addProseMirrorPlugins(){return[new dist.k_({key:new dist.hs("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor}=this,{state,schema}=editor,{doc,selection}=state,{ranges}=selection,from=Math.min(...ranges.map((range=>range.$from.pos))),to=Math.max(...ranges.map((range=>range.$to.pos))),textSerializers=getTextSerializersFromSchema(schema);return getTextBetween(doc,{from,to},{...void 0!==this.options.blockSeparator?{blockSeparator:this.options.blockSeparator}:{},textSerializers})}}})]}});function objectIncludes(object1,object2,options={strict:!0}){const keys=Object.keys(object2);return!keys.length||keys.every((key=>options.strict?object2[key]===object1[key]:isRegExp(object2[key])?object2[key].test(object1[key]):object2[key]===object1[key]))}function findMarkInSet(marks,type,attributes={}){return marks.find((item=>item.type===type&&objectIncludes(Object.fromEntries(Object.keys(attributes).map((k=>[k,item.attrs[k]]))),attributes)))}function isMarkInSet(marks,type,attributes={}){return!!findMarkInSet(marks,type,attributes)}function getMarkRange($pos,type,attributes){var _a;if(!$pos||!type)return;let start=$pos.parent.childAfter($pos.parentOffset);if(start.node&&start.node.marks.some((mark=>mark.type===type))||(start=$pos.parent.childBefore($pos.parentOffset)),!start.node||!start.node.marks.some((mark=>mark.type===type)))return;attributes=attributes||(null===(_a=start.node.marks[0])||void 0===_a?void 0:_a.attrs);if(!findMarkInSet([...start.node.marks],type,attributes))return;let startIndex=start.index,startPos=$pos.start()+start.offset,endIndex=startIndex+1,endPos=startPos+start.node.nodeSize;for(;startIndex>0&&isMarkInSet([...$pos.parent.child(startIndex-1).marks],type,attributes);)startIndex-=1,startPos-=$pos.parent.child(startIndex).nodeSize;for(;endIndex<$pos.parent.childCount&&isMarkInSet([...$pos.parent.child(endIndex).marks],type,attributes);)endPos+=$pos.parent.child(endIndex).nodeSize,endIndex+=1;return{from:startPos,to:endPos}}function getMarkType(nameOrType,schema){if("string"==typeof nameOrType){if(!schema.marks[nameOrType])throw Error(`There is no mark type named '${nameOrType}'. Maybe you forgot to add the extension?`);return schema.marks[nameOrType]}return nameOrType}function isTextSelection(value){return value instanceof dist.U3}function minMax(value=0,min=0,max=0){return Math.min(Math.max(value,min),max)}function resolveFocusPosition(doc,position=null){if(!position)return null;const selectionAtStart=dist.LN.atStart(doc),selectionAtEnd=dist.LN.atEnd(doc);if("start"===position||!0===position)return selectionAtStart;if("end"===position)return selectionAtEnd;const minPos=selectionAtStart.from,maxPos=selectionAtEnd.to;return"all"===position?dist.U3.create(doc,minMax(0,minPos,maxPos),minMax(doc.content.size,minPos,maxPos)):dist.U3.create(doc,minMax(position,minPos,maxPos),minMax(position,minPos,maxPos))}function isAndroid(){return"Android"===navigator.platform||/android/i.test(navigator.userAgent)}function isiOS(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const removeWhitespaces=node=>{const children=node.childNodes;for(let i=children.length-1;i>=0;i-=1){const child=children[i];3===child.nodeType&&child.nodeValue&&/^(\n\s\s|\n)$/.test(child.nodeValue)?node.removeChild(child):1===child.nodeType&&removeWhitespaces(child)}return node};function elementFromString(value){const wrappedValue=`<body>${value}</body>`,html=(new window.DOMParser).parseFromString(wrappedValue,"text/html").body;return removeWhitespaces(html)}function createNodeFromContent(content,schema,options){if(content instanceof prosemirror_model_dist.bP||content instanceof prosemirror_model_dist.FK)return content;options={slice:!0,parseOptions:{},...options};const isTextContent="string"==typeof content;if("object"==typeof content&&null!==content)try{if(Array.isArray(content)&&content.length>0)return prosemirror_model_dist.FK.fromArray(content.map((item=>schema.nodeFromJSON(item))));const node=schema.nodeFromJSON(content);return options.errorOnInvalidContent&&node.check(),node}catch(error){if(options.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:error});return console.warn("[tiptap warn]: Invalid content.","Passed value:",content,"Error:",error),createNodeFromContent("",schema,options)}if(isTextContent){if(options.errorOnInvalidContent){let hasInvalidContent=!1,invalidContent="";const contentCheckSchema=new prosemirror_model_dist.Sj({topNode:schema.spec.topNode,marks:schema.spec.marks,nodes:schema.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:e=>(hasInvalidContent=!0,invalidContent="string"==typeof e?e:e.outerHTML,null)}]}})});if(options.slice?prosemirror_model_dist.S4.fromSchema(contentCheckSchema).parseSlice(elementFromString(content),options.parseOptions):prosemirror_model_dist.S4.fromSchema(contentCheckSchema).parse(elementFromString(content),options.parseOptions),options.errorOnInvalidContent&&hasInvalidContent)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${invalidContent}`)})}const parser=prosemirror_model_dist.S4.fromSchema(schema);return options.slice?parser.parseSlice(elementFromString(content),options.parseOptions).content:parser.parse(elementFromString(content),options.parseOptions)}return createNodeFromContent("",schema,options)}function isMacOS(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}function isNodeActive(state,typeOrName,attributes={}){const{from,to,empty}=state.selection,type=typeOrName?getNodeType(typeOrName,state.schema):null,nodeRanges=[];state.doc.nodesBetween(from,to,((node,pos)=>{if(node.isText)return;const relativeFrom=Math.max(from,pos),relativeTo=Math.min(to,pos+node.nodeSize);nodeRanges.push({node,from:relativeFrom,to:relativeTo})}));const selectionRange=to-from,matchedNodeRanges=nodeRanges.filter((nodeRange=>!type||type.name===nodeRange.node.type.name)).filter((nodeRange=>objectIncludes(nodeRange.node.attrs,attributes,{strict:!1})));if(empty)return!!matchedNodeRanges.length;return matchedNodeRanges.reduce(((sum,nodeRange)=>sum+nodeRange.to-nodeRange.from),0)>=selectionRange}function getSchemaTypeNameByName(name,schema){return schema.nodes[name]?"node":schema.marks[name]?"mark":null}function deleteProps(obj,propOrProps){const props="string"==typeof propOrProps?[propOrProps]:propOrProps;return Object.keys(obj).reduce(((newObj,prop)=>(props.includes(prop)||(newObj[prop]=obj[prop]),newObj)),{})}function createDocument(content,schema,parseOptions={},options={}){return createNodeFromContent(content,schema,{slice:!1,parseOptions,errorOnInvalidContent:options.errorOnInvalidContent})}function getMarkAttributes(state,typeOrName){const type=getMarkType(typeOrName,state.schema),{from,to,empty}=state.selection,marks=[];empty?(state.storedMarks&&marks.push(...state.storedMarks),marks.push(...state.selection.$head.marks())):state.doc.nodesBetween(from,to,(node=>{marks.push(...node.marks)}));const mark=marks.find((markItem=>markItem.type.name===type.name));return mark?{...mark.attrs}:{}}function combineTransactionSteps(oldDoc,transactions){const transform=new prosemirror_transform_dist.dL(oldDoc);return transactions.forEach((transaction=>{transaction.steps.forEach((step=>{transform.step(step)}))})),transform}function findChildrenInRange(node,range,predicate){const nodesWithPos=[];return node.nodesBetween(range.from,range.to,((child,pos)=>{predicate(child)&&nodesWithPos.push({node:child,pos})})),nodesWithPos}function findParentNode(predicate){return selection=>function findParentNodeClosestToPos($pos,predicate){for(let i=$pos.depth;i>0;i-=1){const node=$pos.node(i);if(predicate(node))return{pos:i>0?$pos.before(i):0,start:$pos.start(i),depth:i,node}}}(selection.$from,predicate)}function getSchema(extensions,editor){return getSchemaByResolvedExtensions(ExtensionManager.resolve(extensions),editor)}function generateHTML(doc,extensions){const schema=getSchema(extensions);return getHTMLFromFragment(prosemirror_model_dist.bP.fromJSON(schema,doc).content,schema)}function generateJSON(html,extensions){const schema=getSchema(extensions),dom=elementFromString(html);return prosemirror_model_dist.S4.fromSchema(schema).parse(dom).toJSON()}function getText(node,options){return getTextBetween(node,{from:0,to:node.content.size},options)}function generateText(doc,extensions,options){const{blockSeparator="\n\n",textSerializers={}}=options||{},schema=getSchema(extensions);return getText(prosemirror_model_dist.bP.fromJSON(schema,doc),{blockSeparator,textSerializers:{...getTextSerializersFromSchema(schema),...textSerializers}})}function getAttributes(state,typeOrName){const schemaType=getSchemaTypeNameByName("string"==typeof typeOrName?typeOrName:typeOrName.name,state.schema);return"node"===schemaType?function getNodeAttributes(state,typeOrName){const type=getNodeType(typeOrName,state.schema),{from,to}=state.selection,nodes=[];state.doc.nodesBetween(from,to,(node=>{nodes.push(node)}));const node=nodes.reverse().find((nodeItem=>nodeItem.type.name===type.name));return node?{...node.attrs}:{}}(state,typeOrName):"mark"===schemaType?getMarkAttributes(state,typeOrName):{}}function simplifyChangedRanges(changes){const uniqueChanges=function removeDuplicates(array,by=JSON.stringify){const seen={};return array.filter((item=>{const key=by(item);return!Object.prototype.hasOwnProperty.call(seen,key)&&(seen[key]=!0)}))}(changes);return 1===uniqueChanges.length?uniqueChanges:uniqueChanges.filter(((change,index)=>!uniqueChanges.filter(((_,i)=>i!==index)).some((otherChange=>change.oldRange.from>=otherChange.oldRange.from&&change.oldRange.to<=otherChange.oldRange.to&&change.newRange.from>=otherChange.newRange.from&&change.newRange.to<=otherChange.newRange.to))))}function getChangedRanges(transform){const{mapping,steps}=transform,changes=[];return mapping.maps.forEach(((stepMap,index)=>{const ranges=[];if(stepMap.ranges.length)stepMap.forEach(((from,to)=>{ranges.push({from,to})}));else{const{from,to}=steps[index];if(void 0===from||void 0===to)return;ranges.push({from,to})}ranges.forEach((({from,to})=>{const newStart=mapping.slice(index).map(from,-1),newEnd=mapping.slice(index).map(to),oldStart=mapping.invert().map(newStart,-1),oldEnd=mapping.invert().map(newEnd);changes.push({oldRange:{from:oldStart,to:oldEnd},newRange:{from:newStart,to:newEnd}})}))})),simplifyChangedRanges(changes)}function getMarksBetween(from,to,doc){const marks=[];return from===to?doc.resolve(from).marks().forEach((mark=>{const range=getMarkRange(doc.resolve(from),mark.type);range&&marks.push({mark,...range})})):doc.nodesBetween(from,to,((node,pos)=>{node&&void 0!==(null==node?void 0:node.nodeSize)&&marks.push(...node.marks.map((mark=>({from:pos,to:pos+node.nodeSize,mark}))))})),marks}function getSplittedAttributes(extensionAttributes,typeName,attributes){return Object.fromEntries(Object.entries(attributes).filter((([name])=>{const extensionAttribute=extensionAttributes.find((item=>item.type===typeName&&item.name===name));return!!extensionAttribute&&extensionAttribute.attribute.keepOnSplit})))}function isMarkActive(state,typeOrName,attributes={}){const{empty,ranges}=state.selection,type=typeOrName?getMarkType(typeOrName,state.schema):null;if(empty)return!!(state.storedMarks||state.selection.$from.marks()).filter((mark=>!type||type.name===mark.type.name)).find((mark=>objectIncludes(mark.attrs,attributes,{strict:!1})));let selectionRange=0;const markRanges=[];if(ranges.forEach((({$from,$to})=>{const from=$from.pos,to=$to.pos;state.doc.nodesBetween(from,to,((node,pos)=>{if(!node.isText&&!node.marks.length)return;const relativeFrom=Math.max(from,pos),relativeTo=Math.min(to,pos+node.nodeSize);selectionRange+=relativeTo-relativeFrom,markRanges.push(...node.marks.map((mark=>({mark,from:relativeFrom,to:relativeTo}))))}))})),0===selectionRange)return!1;const matchedRange=markRanges.filter((markRange=>!type||type.name===markRange.mark.type.name)).filter((markRange=>objectIncludes(markRange.mark.attrs,attributes,{strict:!1}))).reduce(((sum,markRange)=>sum+markRange.to-markRange.from),0),excludedRange=markRanges.filter((markRange=>!type||markRange.mark.type!==type&&markRange.mark.type.excludes(type))).reduce(((sum,markRange)=>sum+markRange.to-markRange.from),0);return(matchedRange>0?matchedRange+excludedRange:matchedRange)>=selectionRange}function isList(name,extensions){const{nodeExtensions}=splitExtensions(extensions),extension=nodeExtensions.find((item=>item.name===name));if(!extension)return!1;const group=callOrReturn(getExtensionField(extension,"group",{name:extension.name,options:extension.options,storage:extension.storage}));return"string"==typeof group&&group.split(" ").includes("list")}function isNodeEmpty(node,{checkChildren=!0,ignoreWhitespace=!1}={}){var _a;if(ignoreWhitespace){if("hardBreak"===node.type.name)return!0;if(node.isText)return/^\s*$/m.test(null!==(_a=node.text)&&void 0!==_a?_a:"")}if(node.isText)return!node.text;if(node.isAtom||node.isLeaf)return!1;if(0===node.content.childCount)return!0;if(checkChildren){let isContentEmpty=!0;return node.content.forEach((childNode=>{!1!==isContentEmpty&&(isNodeEmpty(childNode,{ignoreWhitespace,checkChildren})||(isContentEmpty=!1))})),isContentEmpty}return!1}function isNodeSelection(value){return value instanceof dist.nh}function ensureMarks(state,splittableMarks){const marks=state.storedMarks||state.selection.$to.parentOffset&&state.selection.$from.marks();if(marks){const filteredMarks=marks.filter((mark=>null==splittableMarks?void 0:splittableMarks.includes(mark.type.name)));state.tr.ensureMarks(filteredMarks)}}const joinListBackwards=(tr,listType)=>{const list=findParentNode((node=>node.type===listType))(tr.selection);if(!list)return!0;const before=tr.doc.resolve(Math.max(0,list.pos-1)).before(list.depth);if(void 0===before)return!0;const nodeBefore=tr.doc.nodeAt(before);return list.node.type!==(null==nodeBefore?void 0:nodeBefore.type)||!(0,prosemirror_transform_dist.n9)(tr.doc,list.pos)||(tr.join(list.pos),!0)},joinListForwards=(tr,listType)=>{const list=findParentNode((node=>node.type===listType))(tr.selection);if(!list)return!0;const after=tr.doc.resolve(list.start).after(list.depth);if(void 0===after)return!0;const nodeAfter=tr.doc.nodeAt(after);return list.node.type!==(null==nodeAfter?void 0:nodeAfter.type)||!(0,prosemirror_transform_dist.n9)(tr.doc,after)||(tr.join(after),!0)};var commands=Object.freeze({__proto__:null,blur:()=>({editor,view})=>(requestAnimationFrame((()=>{var _a;editor.isDestroyed||(view.dom.blur(),null===(_a=null===window||void 0===window?void 0:window.getSelection())||void 0===_a||_a.removeAllRanges())})),!0),clearContent:(emitUpdate=!1)=>({commands})=>commands.setContent("",emitUpdate),clearNodes:()=>({state,tr,dispatch})=>{const{selection}=tr,{ranges}=selection;return!dispatch||(ranges.forEach((({$from,$to})=>{state.doc.nodesBetween($from.pos,$to.pos,((node,pos)=>{if(node.type.isText)return;const{doc,mapping}=tr,$mappedFrom=doc.resolve(mapping.map(pos)),$mappedTo=doc.resolve(mapping.map(pos+node.nodeSize)),nodeRange=$mappedFrom.blockRange($mappedTo);if(!nodeRange)return;const targetLiftDepth=(0,prosemirror_transform_dist.jP)(nodeRange);if(node.type.isTextblock){const{defaultType}=$mappedFrom.parent.contentMatchAt($mappedFrom.index());tr.setNodeMarkup(nodeRange.start,defaultType)}(targetLiftDepth||0===targetLiftDepth)&&tr.lift(nodeRange,targetLiftDepth)}))})),!0)},command:fn=>props=>fn(props),createParagraphNear:()=>({state,dispatch})=>createParagraphNear(state,dispatch),cut:(originRange,targetPos)=>({editor,tr})=>{const{state}=editor,contentSlice=state.doc.slice(originRange.from,originRange.to);tr.deleteRange(originRange.from,originRange.to);const newPos=tr.mapping.map(targetPos);return tr.insert(newPos,contentSlice.content),tr.setSelection(new dist.U3(tr.doc.resolve(newPos-1))),!0},deleteCurrentNode:()=>({tr,dispatch})=>{const{selection}=tr,currentNode=selection.$anchor.node();if(currentNode.content.size>0)return!1;const $pos=tr.selection.$anchor;for(let depth=$pos.depth;depth>0;depth-=1){if($pos.node(depth).type===currentNode.type){if(dispatch){const from=$pos.before(depth),to=$pos.after(depth);tr.delete(from,to).scrollIntoView()}return!0}}return!1},deleteNode:typeOrName=>({tr,state,dispatch})=>{const type=getNodeType(typeOrName,state.schema),$pos=tr.selection.$anchor;for(let depth=$pos.depth;depth>0;depth-=1){if($pos.node(depth).type===type){if(dispatch){const from=$pos.before(depth),to=$pos.after(depth);tr.delete(from,to).scrollIntoView()}return!0}}return!1},deleteRange:range=>({tr,dispatch})=>{const{from,to}=range;return dispatch&&tr.delete(from,to),!0},deleteSelection:()=>({state,dispatch})=>deleteSelection(state,dispatch),enter:()=>({commands})=>commands.keyboardShortcut("Enter"),exitCode:()=>({state,dispatch})=>exitCode(state,dispatch),extendMarkRange:(typeOrName,attributes={})=>({tr,state,dispatch})=>{const type=getMarkType(typeOrName,state.schema),{doc,selection}=tr,{$from,from,to}=selection;if(dispatch){const range=getMarkRange($from,type,attributes);if(range&&range.from<=from&&range.to>=to){const newSelection=dist.U3.create(doc,range.from,range.to);tr.setSelection(newSelection)}}return!0},first:commands=>props=>{const items="function"==typeof commands?commands(props):commands;for(let i=0;i<items.length;i+=1)if(items[i](props))return!0;return!1},focus:(position=null,options={})=>({editor,view,tr,dispatch})=>{options={scrollIntoView:!0,...options};const delayedFocus=()=>{(isiOS()||isAndroid())&&view.dom.focus(),requestAnimationFrame((()=>{editor.isDestroyed||(view.focus(),(null==options?void 0:options.scrollIntoView)&&editor.commands.scrollIntoView())}))};if(view.hasFocus()&&null===position||!1===position)return!0;if(dispatch&&null===position&&!isTextSelection(editor.state.selection))return delayedFocus(),!0;const selection=resolveFocusPosition(tr.doc,position)||editor.state.selection,isSameSelection=editor.state.selection.eq(selection);return dispatch&&(isSameSelection||tr.setSelection(selection),isSameSelection&&tr.storedMarks&&tr.setStoredMarks(tr.storedMarks),delayedFocus()),!0},forEach:(items,fn)=>props=>items.every(((item,index)=>fn(item,{...props,index}))),insertContent:(value,options)=>({tr,commands})=>commands.insertContentAt({from:tr.selection.from,to:tr.selection.to},value,options),insertContentAt:(position,value,options)=>({tr,dispatch,editor})=>{var _a;if(dispatch){let content;options={parseOptions:editor.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...options};try{content=createNodeFromContent(value,editor.schema,{parseOptions:{preserveWhitespace:"full",...options.parseOptions},errorOnInvalidContent:null!==(_a=options.errorOnInvalidContent)&&void 0!==_a?_a:editor.options.enableContentCheck})}catch(e){return editor.emit("contentError",{editor,error:e,disableCollaboration:()=>{editor.storage.collaboration&&(editor.storage.collaboration.isDisabled=!0)}}),!1}let{from,to}="number"==typeof position?{from:position,to:position}:{from:position.from,to:position.to},isOnlyTextContent=!0,isOnlyBlockContent=!0;if(("type"in content?[content]:content).forEach((node=>{node.check(),isOnlyTextContent=!!isOnlyTextContent&&(node.isText&&0===node.marks.length),isOnlyBlockContent=!!isOnlyBlockContent&&node.isBlock})),from===to&&isOnlyBlockContent){const{parent}=tr.doc.resolve(from);parent.isTextblock&&!parent.type.spec.code&&!parent.childCount&&(from-=1,to+=1)}let newContent;if(isOnlyTextContent){if(Array.isArray(value))newContent=value.map((v=>v.text||"")).join("");else if(value instanceof prosemirror_model_dist.FK){let text="";value.forEach((node=>{node.text&&(text+=node.text)})),newContent=text}else newContent="object"==typeof value&&value&&value.text?value.text:value;tr.insertText(newContent,from,to)}else newContent=content,tr.replaceWith(from,to,newContent);options.updateSelection&&function selectionToInsertionEnd(tr,startLen,bias){const last=tr.steps.length-1;if(last<startLen)return;const step=tr.steps[last];if(!(step instanceof prosemirror_transform_dist.Ln||step instanceof prosemirror_transform_dist.Wg))return;const map=tr.mapping.maps[last];let end=0;map.forEach(((_from,_to,_newFrom,newTo)=>{0===end&&(end=newTo)})),tr.setSelection(dist.LN.near(tr.doc.resolve(end),bias))}(tr,tr.steps.length-1,-1),options.applyInputRules&&tr.setMeta("applyInputRules",{from,text:newContent}),options.applyPasteRules&&tr.setMeta("applyPasteRules",{from,text:newContent})}return!0},joinBackward:()=>({state,dispatch})=>joinBackward(state,dispatch),joinDown:()=>({state,dispatch})=>((state,dispatch)=>{let point,sel=state.selection;if(sel instanceof dist.nh){if(sel.node.isTextblock||!(0,prosemirror_transform_dist.n9)(state.doc,sel.to))return!1;point=sel.to}else if(point=(0,prosemirror_transform_dist.N0)(state.doc,sel.to,1),null==point)return!1;return dispatch&&dispatch(state.tr.join(point).scrollIntoView()),!0})(state,dispatch),joinForward:()=>({state,dispatch})=>joinForward(state,dispatch),joinItemBackward:()=>({state,dispatch,tr})=>{try{const point=(0,prosemirror_transform_dist.N0)(state.doc,state.selection.$from.pos,-1);return null!=point&&(tr.join(point,2),dispatch&&dispatch(tr),!0)}catch{return!1}},joinItemForward:()=>({state,dispatch,tr})=>{try{const point=(0,prosemirror_transform_dist.N0)(state.doc,state.selection.$from.pos,1);return null!=point&&(tr.join(point,2),dispatch&&dispatch(tr),!0)}catch{return!1}},joinTextblockBackward:()=>({state,dispatch})=>((state,dispatch,view)=>{let $cursor=atBlockStart(state,view);if(!$cursor)return!1;let $cut=findCutBefore($cursor);return!!$cut&&joinTextblocksAround(state,$cut,dispatch)})(state,dispatch),joinTextblockForward:()=>({state,dispatch})=>((state,dispatch,view)=>{let $cursor=atBlockEnd(state,view);if(!$cursor)return!1;let $cut=findCutAfter($cursor);return!!$cut&&joinTextblocksAround(state,$cut,dispatch)})(state,dispatch),joinUp:()=>({state,dispatch})=>((state,dispatch)=>{let point,sel=state.selection,nodeSel=sel instanceof dist.nh;if(nodeSel){if(sel.node.isTextblock||!(0,prosemirror_transform_dist.n9)(state.doc,sel.from))return!1;point=sel.from}else if(point=(0,prosemirror_transform_dist.N0)(state.doc,sel.from,-1),null==point)return!1;if(dispatch){let tr=state.tr.join(point);nodeSel&&tr.setSelection(dist.nh.create(tr.doc,point-state.doc.resolve(point).nodeBefore.nodeSize)),dispatch(tr.scrollIntoView())}return!0})(state,dispatch),keyboardShortcut:name=>({editor,view,tr,dispatch})=>{const keys=function normalizeKeyName(name){const parts=name.split(/-(?!$)/);let alt,ctrl,shift,meta,result=parts[parts.length-1];"Space"===result&&(result=" ");for(let i=0;i<parts.length-1;i+=1){const mod=parts[i];if(/^(cmd|meta|m)$/i.test(mod))meta=!0;else if(/^a(lt)?$/i.test(mod))alt=!0;else if(/^(c|ctrl|control)$/i.test(mod))ctrl=!0;else if(/^s(hift)?$/i.test(mod))shift=!0;else{if(!/^mod$/i.test(mod))throw new Error(`Unrecognized modifier name: ${mod}`);isiOS()||isMacOS()?meta=!0:ctrl=!0}}return alt&&(result=`Alt-${result}`),ctrl&&(result=`Ctrl-${result}`),meta&&(result=`Meta-${result}`),shift&&(result=`Shift-${result}`),result}(name).split(/-(?!$)/),key=keys.find((item=>!["Alt","Ctrl","Meta","Shift"].includes(item))),event=new KeyboardEvent("keydown",{key:"Space"===key?" ":key,altKey:keys.includes("Alt"),ctrlKey:keys.includes("Ctrl"),metaKey:keys.includes("Meta"),shiftKey:keys.includes("Shift"),bubbles:!0,cancelable:!0}),capturedTransaction=editor.captureTransaction((()=>{view.someProp("handleKeyDown",(f=>f(view,event)))}));return null==capturedTransaction||capturedTransaction.steps.forEach((step=>{const newStep=step.map(tr.mapping);newStep&&dispatch&&tr.maybeStep(newStep)})),!0},lift:(typeOrName,attributes={})=>({state,dispatch})=>!!isNodeActive(state,getNodeType(typeOrName,state.schema),attributes)&&((state,dispatch)=>{let{$from,$to}=state.selection,range=$from.blockRange($to),target=range&&(0,prosemirror_transform_dist.jP)(range);return null!=target&&(dispatch&&dispatch(state.tr.lift(range,target).scrollIntoView()),!0)})(state,dispatch),liftEmptyBlock:()=>({state,dispatch})=>liftEmptyBlock(state,dispatch),liftListItem:typeOrName=>({state,dispatch})=>liftListItem(getNodeType(typeOrName,state.schema))(state,dispatch),newlineInCode:()=>({state,dispatch})=>newlineInCode(state,dispatch),resetAttributes:(typeOrName,attributes)=>({tr,state,dispatch})=>{let nodeType=null,markType=null;const schemaType=getSchemaTypeNameByName("string"==typeof typeOrName?typeOrName:typeOrName.name,state.schema);return!!schemaType&&("node"===schemaType&&(nodeType=getNodeType(typeOrName,state.schema)),"mark"===schemaType&&(markType=getMarkType(typeOrName,state.schema)),dispatch&&tr.selection.ranges.forEach((range=>{state.doc.nodesBetween(range.$from.pos,range.$to.pos,((node,pos)=>{nodeType&&nodeType===node.type&&tr.setNodeMarkup(pos,void 0,deleteProps(node.attrs,attributes)),markType&&node.marks.length&&node.marks.forEach((mark=>{markType===mark.type&&tr.addMark(pos,pos+node.nodeSize,markType.create(deleteProps(mark.attrs,attributes)))}))}))})),!0)},scrollIntoView:()=>({tr,dispatch})=>(dispatch&&tr.scrollIntoView(),!0),selectAll:()=>({tr,dispatch})=>{if(dispatch){const selection=new dist.i5(tr.doc);tr.setSelection(selection)}return!0},selectNodeBackward:()=>({state,dispatch})=>selectNodeBackward(state,dispatch),selectNodeForward:()=>({state,dispatch})=>selectNodeForward(state,dispatch),selectParentNode:()=>({state,dispatch})=>((state,dispatch)=>{let pos,{$from,to}=state.selection,same=$from.sharedDepth(to);return 0!=same&&(pos=$from.before(same),dispatch&&dispatch(state.tr.setSelection(dist.nh.create(state.doc,pos))),!0)})(state,dispatch),selectTextblockEnd:()=>({state,dispatch})=>selectTextblockEnd(state,dispatch),selectTextblockStart:()=>({state,dispatch})=>selectTextblockStart(state,dispatch),setContent:(content,emitUpdate=!1,parseOptions={},options={})=>({editor,tr,dispatch,commands})=>{var _a,_b;const{doc}=tr;if("full"!==parseOptions.preserveWhitespace){const document=createDocument(content,editor.schema,parseOptions,{errorOnInvalidContent:null!==(_a=options.errorOnInvalidContent)&&void 0!==_a?_a:editor.options.enableContentCheck});return dispatch&&tr.replaceWith(0,doc.content.size,document).setMeta("preventUpdate",!emitUpdate),!0}return dispatch&&tr.setMeta("preventUpdate",!emitUpdate),commands.insertContentAt({from:0,to:doc.content.size},content,{parseOptions,errorOnInvalidContent:null!==(_b=options.errorOnInvalidContent)&&void 0!==_b?_b:editor.options.enableContentCheck})},setMark:(typeOrName,attributes={})=>({tr,state,dispatch})=>{const{selection}=tr,{empty,ranges}=selection,type=getMarkType(typeOrName,state.schema);if(dispatch)if(empty){const oldAttributes=getMarkAttributes(state,type);tr.addStoredMark(type.create({...oldAttributes,...attributes}))}else ranges.forEach((range=>{const from=range.$from.pos,to=range.$to.pos;state.doc.nodesBetween(from,to,((node,pos)=>{const trimmedFrom=Math.max(pos,from),trimmedTo=Math.min(pos+node.nodeSize,to);node.marks.find((mark=>mark.type===type))?node.marks.forEach((mark=>{type===mark.type&&tr.addMark(trimmedFrom,trimmedTo,type.create({...mark.attrs,...attributes}))})):tr.addMark(trimmedFrom,trimmedTo,type.create(attributes))}))}));return function canSetMark(state,tr,newMarkType){var _a;const{selection}=tr;let cursor=null;if(isTextSelection(selection)&&(cursor=selection.$cursor),cursor){const currentMarks=null!==(_a=state.storedMarks)&&void 0!==_a?_a:cursor.marks();return!!newMarkType.isInSet(currentMarks)||!currentMarks.some((mark=>mark.type.excludes(newMarkType)))}const{ranges}=selection;return ranges.some((({$from,$to})=>{let someNodeSupportsMark=0===$from.depth&&state.doc.inlineContent&&state.doc.type.allowsMarkType(newMarkType);return state.doc.nodesBetween($from.pos,$to.pos,((node,_pos,parent)=>{if(someNodeSupportsMark)return!1;if(node.isInline){const parentAllowsMarkType=!parent||parent.type.allowsMarkType(newMarkType),currentMarksAllowMarkType=!!newMarkType.isInSet(node.marks)||!node.marks.some((otherMark=>otherMark.type.excludes(newMarkType)));someNodeSupportsMark=parentAllowsMarkType&&currentMarksAllowMarkType}return!someNodeSupportsMark})),someNodeSupportsMark}))}(state,tr,type)},setMeta:(key,value)=>({tr})=>(tr.setMeta(key,value),!0),setNode:(typeOrName,attributes={})=>({state,dispatch,chain})=>{const type=getNodeType(typeOrName,state.schema);let attributesToCopy;return state.selection.$anchor.sameParent(state.selection.$head)&&(attributesToCopy=state.selection.$anchor.parent.attrs),type.isTextblock?chain().command((({commands})=>!!setBlockType(type,{...attributesToCopy,...attributes})(state)||commands.clearNodes())).command((({state:updatedState})=>setBlockType(type,{...attributesToCopy,...attributes})(updatedState,dispatch))).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},setNodeSelection:position=>({tr,dispatch})=>{if(dispatch){const{doc}=tr,from=minMax(position,0,doc.content.size),selection=dist.nh.create(doc,from);tr.setSelection(selection)}return!0},setTextSelection:position=>({tr,dispatch})=>{if(dispatch){const{doc}=tr,{from,to}="number"==typeof position?{from:position,to:position}:position,minPos=dist.U3.atStart(doc).from,maxPos=dist.U3.atEnd(doc).to,resolvedFrom=minMax(from,minPos,maxPos),resolvedEnd=minMax(to,minPos,maxPos),selection=dist.U3.create(doc,resolvedFrom,resolvedEnd);tr.setSelection(selection)}return!0},sinkListItem:typeOrName=>({state,dispatch})=>function sinkListItem(itemType){return function(state,dispatch){let{$from,$to}=state.selection,range=$from.blockRange($to,(node=>node.childCount>0&&node.firstChild.type==itemType));if(!range)return!1;let startIndex=range.startIndex;if(0==startIndex)return!1;let parent=range.parent,nodeBefore=parent.child(startIndex-1);if(nodeBefore.type!=itemType)return!1;if(dispatch){let nestedBefore=nodeBefore.lastChild&&nodeBefore.lastChild.type==parent.type,inner=prosemirror_model_dist.FK.from(nestedBefore?itemType.create():null),slice=new prosemirror_model_dist.Ji(prosemirror_model_dist.FK.from(itemType.create(null,prosemirror_model_dist.FK.from(parent.type.create(null,inner)))),nestedBefore?3:1,0),before=range.start,after=range.end;dispatch(state.tr.step(new prosemirror_transform_dist.Wg(before-(nestedBefore?3:1),after,before,after,slice,1,!0)).scrollIntoView())}return!0}}(getNodeType(typeOrName,state.schema))(state,dispatch),splitBlock:({keepMarks=!0}={})=>({tr,state,dispatch,editor})=>{const{selection,doc}=tr,{$from,$to}=selection,newAttributes=getSplittedAttributes(editor.extensionManager.attributes,$from.node().type.name,$from.node().attrs);if(selection instanceof dist.nh&&selection.node.isBlock)return!(!$from.parentOffset||!(0,prosemirror_transform_dist.zy)(doc,$from.pos))&&(dispatch&&(keepMarks&&ensureMarks(state,editor.extensionManager.splittableMarks),tr.split($from.pos).scrollIntoView()),!0);if(!$from.parent.isBlock)return!1;const atEnd=$to.parentOffset===$to.parent.content.size,deflt=0===$from.depth?void 0:function dist_defaultBlockAt(match){for(let i=0;i<match.edgeCount;i+=1){const{type}=match.edge(i);if(type.isTextblock&&!type.hasRequiredAttrs())return type}return null}($from.node(-1).contentMatchAt($from.indexAfter(-1)));let types=atEnd&&deflt?[{type:deflt,attrs:newAttributes}]:void 0,can=(0,prosemirror_transform_dist.zy)(tr.doc,tr.mapping.map($from.pos),1,types);if(types||can||!(0,prosemirror_transform_dist.zy)(tr.doc,tr.mapping.map($from.pos),1,deflt?[{type:deflt}]:void 0)||(can=!0,types=deflt?[{type:deflt,attrs:newAttributes}]:void 0),dispatch){if(can&&(selection instanceof dist.U3&&tr.deleteSelection(),tr.split(tr.mapping.map($from.pos),1,types),deflt&&!atEnd&&!$from.parentOffset&&$from.parent.type!==deflt)){const first=tr.mapping.map($from.before()),$first=tr.doc.resolve(first);$from.node(-1).canReplaceWith($first.index(),$first.index()+1,deflt)&&tr.setNodeMarkup(tr.mapping.map($from.before()),deflt)}keepMarks&&ensureMarks(state,editor.extensionManager.splittableMarks),tr.scrollIntoView()}return can},splitListItem:(typeOrName,overrideAttrs={})=>({tr,state,dispatch,editor})=>{var _a;const type=getNodeType(typeOrName,state.schema),{$from,$to}=state.selection,node=state.selection.node;if(node&&node.isBlock||$from.depth<2||!$from.sameParent($to))return!1;const grandParent=$from.node(-1);if(grandParent.type!==type)return!1;const extensionAttributes=editor.extensionManager.attributes;if(0===$from.parent.content.size&&$from.node(-1).childCount===$from.indexAfter(-1)){if(2===$from.depth||$from.node(-3).type!==type||$from.index(-2)!==$from.node(-2).childCount-1)return!1;if(dispatch){let wrap=prosemirror_model_dist.FK.empty;const depthBefore=$from.index(-1)?1:$from.index(-2)?2:3;for(let d=$from.depth-depthBefore;d>=$from.depth-3;d-=1)wrap=prosemirror_model_dist.FK.from($from.node(d).copy(wrap));const depthAfter=$from.indexAfter(-1)<$from.node(-2).childCount?1:$from.indexAfter(-2)<$from.node(-3).childCount?2:3,newNextTypeAttributes={...getSplittedAttributes(extensionAttributes,$from.node().type.name,$from.node().attrs),...overrideAttrs},nextType=(null===(_a=type.contentMatch.defaultType)||void 0===_a?void 0:_a.createAndFill(newNextTypeAttributes))||void 0;wrap=wrap.append(prosemirror_model_dist.FK.from(type.createAndFill(null,nextType)||void 0));const start=$from.before($from.depth-(depthBefore-1));tr.replace(start,$from.after(-depthAfter),new prosemirror_model_dist.Ji(wrap,4-depthBefore,0));let sel=-1;tr.doc.nodesBetween(start,tr.doc.content.size,((n,pos)=>{if(sel>-1)return!1;n.isTextblock&&0===n.content.size&&(sel=pos+1)})),sel>-1&&tr.setSelection(dist.U3.near(tr.doc.resolve(sel))),tr.scrollIntoView()}return!0}const nextType=$to.pos===$from.end()?grandParent.contentMatchAt(0).defaultType:null,newTypeAttributes={...getSplittedAttributes(extensionAttributes,grandParent.type.name,grandParent.attrs),...overrideAttrs},newNextTypeAttributes={...getSplittedAttributes(extensionAttributes,$from.node().type.name,$from.node().attrs),...overrideAttrs};tr.delete($from.pos,$to.pos);const types=nextType?[{type,attrs:newTypeAttributes},{type:nextType,attrs:newNextTypeAttributes}]:[{type,attrs:newTypeAttributes}];if(!(0,prosemirror_transform_dist.zy)(tr.doc,$from.pos,2))return!1;if(dispatch){const{selection,storedMarks}=state,{splittableMarks}=editor.extensionManager,marks=storedMarks||selection.$to.parentOffset&&selection.$from.marks();if(tr.split($from.pos,2,types).scrollIntoView(),!marks||!dispatch)return!0;const filteredMarks=marks.filter((mark=>splittableMarks.includes(mark.type.name)));tr.ensureMarks(filteredMarks)}return!0},toggleList:(listTypeOrName,itemTypeOrName,keepMarks,attributes={})=>({editor,tr,state,dispatch,chain,commands,can})=>{const{extensions,splittableMarks}=editor.extensionManager,listType=getNodeType(listTypeOrName,state.schema),itemType=getNodeType(itemTypeOrName,state.schema),{selection,storedMarks}=state,{$from,$to}=selection,range=$from.blockRange($to),marks=storedMarks||selection.$to.parentOffset&&selection.$from.marks();if(!range)return!1;const parentList=findParentNode((node=>isList(node.type.name,extensions)))(selection);if(range.depth>=1&&parentList&&range.depth-parentList.depth<=1){if(parentList.node.type===listType)return commands.liftListItem(itemType);if(isList(parentList.node.type.name,extensions)&&listType.validContent(parentList.node.content)&&dispatch)return chain().command((()=>(tr.setNodeMarkup(parentList.pos,listType),!0))).command((()=>joinListBackwards(tr,listType))).command((()=>joinListForwards(tr,listType))).run()}return keepMarks&&marks&&dispatch?chain().command((()=>{const canWrapInList=can().wrapInList(listType,attributes),filteredMarks=marks.filter((mark=>splittableMarks.includes(mark.type.name)));return tr.ensureMarks(filteredMarks),!!canWrapInList||commands.clearNodes()})).wrapInList(listType,attributes).command((()=>joinListBackwards(tr,listType))).command((()=>joinListForwards(tr,listType))).run():chain().command((()=>!!can().wrapInList(listType,attributes)||commands.clearNodes())).wrapInList(listType,attributes).command((()=>joinListBackwards(tr,listType))).command((()=>joinListForwards(tr,listType))).run()},toggleMark:(typeOrName,attributes={},options={})=>({state,commands})=>{const{extendEmptyMarkRange=!1}=options,type=getMarkType(typeOrName,state.schema);return isMarkActive(state,type,attributes)?commands.unsetMark(type,{extendEmptyMarkRange}):commands.setMark(type,attributes)},toggleNode:(typeOrName,toggleTypeOrName,attributes={})=>({state,commands})=>{const type=getNodeType(typeOrName,state.schema),toggleType=getNodeType(toggleTypeOrName,state.schema),isActive=isNodeActive(state,type,attributes);let attributesToCopy;return state.selection.$anchor.sameParent(state.selection.$head)&&(attributesToCopy=state.selection.$anchor.parent.attrs),isActive?commands.setNode(toggleType,attributesToCopy):commands.setNode(type,{...attributesToCopy,...attributes})},toggleWrap:(typeOrName,attributes={})=>({state,commands})=>{const type=getNodeType(typeOrName,state.schema);return isNodeActive(state,type,attributes)?commands.lift(type):commands.wrapIn(type,attributes)},undoInputRule:()=>({state,dispatch})=>{const plugins=state.plugins;for(let i=0;i<plugins.length;i+=1){const plugin=plugins[i];let undoable;if(plugin.spec.isInputRules&&(undoable=plugin.getState(state))){if(dispatch){const tr=state.tr,toUndo=undoable.transform;for(let j=toUndo.steps.length-1;j>=0;j-=1)tr.step(toUndo.steps[j].invert(toUndo.docs[j]));if(undoable.text){const marks=tr.doc.resolve(undoable.from).marks();tr.replaceWith(undoable.from,undoable.to,state.schema.text(undoable.text,marks))}else tr.delete(undoable.from,undoable.to)}return!0}}return!1},unsetAllMarks:()=>({tr,dispatch})=>{const{selection}=tr,{empty,ranges}=selection;return empty||dispatch&&ranges.forEach((range=>{tr.removeMark(range.$from.pos,range.$to.pos)})),!0},unsetMark:(typeOrName,options={})=>({tr,state,dispatch})=>{var _a;const{extendEmptyMarkRange=!1}=options,{selection}=tr,type=getMarkType(typeOrName,state.schema),{$from,empty,ranges}=selection;if(!dispatch)return!0;if(empty&&extendEmptyMarkRange){let{from,to}=selection;const attrs=null===(_a=$from.marks().find((mark=>mark.type===type)))||void 0===_a?void 0:_a.attrs,range=getMarkRange($from,type,attrs);range&&(from=range.from,to=range.to),tr.removeMark(from,to,type)}else ranges.forEach((range=>{tr.removeMark(range.$from.pos,range.$to.pos,type)}));return tr.removeStoredMark(type),!0},updateAttributes:(typeOrName,attributes={})=>({tr,state,dispatch})=>{let nodeType=null,markType=null;const schemaType=getSchemaTypeNameByName("string"==typeof typeOrName?typeOrName:typeOrName.name,state.schema);return!!schemaType&&("node"===schemaType&&(nodeType=getNodeType(typeOrName,state.schema)),"mark"===schemaType&&(markType=getMarkType(typeOrName,state.schema)),dispatch&&tr.selection.ranges.forEach((range=>{const from=range.$from.pos,to=range.$to.pos;let lastPos,lastNode,trimmedFrom,trimmedTo;tr.selection.empty?state.doc.nodesBetween(from,to,((node,pos)=>{nodeType&&nodeType===node.type&&(trimmedFrom=Math.max(pos,from),trimmedTo=Math.min(pos+node.nodeSize,to),lastPos=pos,lastNode=node)})):state.doc.nodesBetween(from,to,((node,pos)=>{pos<from&&nodeType&&nodeType===node.type&&(trimmedFrom=Math.max(pos,from),trimmedTo=Math.min(pos+node.nodeSize,to),lastPos=pos,lastNode=node),pos>=from&&pos<=to&&(nodeType&&nodeType===node.type&&tr.setNodeMarkup(pos,void 0,{...node.attrs,...attributes}),markType&&node.marks.length&&node.marks.forEach((mark=>{if(markType===mark.type){const trimmedFrom2=Math.max(pos,from),trimmedTo2=Math.min(pos+node.nodeSize,to);tr.addMark(trimmedFrom2,trimmedTo2,markType.create({...mark.attrs,...attributes}))}})))})),lastNode&&(void 0!==lastPos&&tr.setNodeMarkup(lastPos,void 0,{...lastNode.attrs,...attributes}),markType&&lastNode.marks.length&&lastNode.marks.forEach((mark=>{markType===mark.type&&tr.addMark(trimmedFrom,trimmedTo,markType.create({...mark.attrs,...attributes}))})))})),!0)},wrapIn:(typeOrName,attributes={})=>({state,dispatch})=>function wrapIn(nodeType,attrs=null){return function(state,dispatch){let{$from,$to}=state.selection,range=$from.blockRange($to),wrapping=range&&(0,prosemirror_transform_dist.oM)(range,nodeType,attrs);return!!wrapping&&(dispatch&&dispatch(state.tr.wrap(range,wrapping).scrollIntoView()),!0)}}(getNodeType(typeOrName,state.schema),attributes)(state,dispatch),wrapInList:(typeOrName,attributes={})=>({state,dispatch})=>wrapInList(getNodeType(typeOrName,state.schema),attributes)(state,dispatch)});const Commands=Extension.create({name:"commands",addCommands:()=>({...commands})}),Drop=Extension.create({name:"drop",addProseMirrorPlugins(){return[new dist.k_({key:new dist.hs("tiptapDrop"),props:{handleDrop:(_,e,slice,moved)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice,moved})}}})]}}),Editable=Extension.create({name:"editable",addProseMirrorPlugins(){return[new dist.k_({key:new dist.hs("editable"),props:{editable:()=>this.editor.options.editable}})]}}),focusEventsPluginKey=new dist.hs("focusEvents"),FocusEvents=Extension.create({name:"focusEvents",addProseMirrorPlugins(){const{editor}=this;return[new dist.k_({key:focusEventsPluginKey,props:{handleDOMEvents:{focus:(view,event)=>{editor.isFocused=!0;const transaction=editor.state.tr.setMeta("focus",{event}).setMeta("addToHistory",!1);return view.dispatch(transaction),!1},blur:(view,event)=>{editor.isFocused=!1;const transaction=editor.state.tr.setMeta("blur",{event}).setMeta("addToHistory",!1);return view.dispatch(transaction),!1}}}})]}}),Keymap=Extension.create({name:"keymap",addKeyboardShortcuts(){const handleBackspace=()=>this.editor.commands.first((({commands})=>[()=>commands.undoInputRule(),()=>commands.command((({tr})=>{const{selection,doc}=tr,{empty,$anchor}=selection,{pos,parent}=$anchor,$parentPos=$anchor.parent.isTextblock&&pos>0?tr.doc.resolve(pos-1):$anchor,parentIsIsolating=$parentPos.parent.type.spec.isolating,parentPos=$anchor.pos-$anchor.parentOffset,isAtStart=parentIsIsolating&&1===$parentPos.parent.childCount?parentPos===$anchor.pos:dist.LN.atStart(doc).from===pos;return!(!empty||!parent.type.isTextblock||parent.textContent.length||!isAtStart||isAtStart&&"paragraph"===$anchor.parent.type.name)&&commands.clearNodes()})),()=>commands.deleteSelection(),()=>commands.joinBackward(),()=>commands.selectNodeBackward()])),handleDelete=()=>this.editor.commands.first((({commands})=>[()=>commands.deleteSelection(),()=>commands.deleteCurrentNode(),()=>commands.joinForward(),()=>commands.selectNodeForward()])),baseKeymap={Enter:()=>this.editor.commands.first((({commands})=>[()=>commands.newlineInCode(),()=>commands.createParagraphNear(),()=>commands.liftEmptyBlock(),()=>commands.splitBlock()])),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:handleBackspace,"Mod-Backspace":handleBackspace,"Shift-Backspace":handleBackspace,Delete:handleDelete,"Mod-Delete":handleDelete,"Mod-a":()=>this.editor.commands.selectAll()},pcKeymap={...baseKeymap},macKeymap={...baseKeymap,"Ctrl-h":handleBackspace,"Alt-Backspace":handleBackspace,"Ctrl-d":handleDelete,"Ctrl-Alt-Backspace":handleDelete,"Alt-Delete":handleDelete,"Alt-d":handleDelete,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return isiOS()||isMacOS()?macKeymap:pcKeymap},addProseMirrorPlugins(){return[new dist.k_({key:new dist.hs("clearDocument"),appendTransaction:(transactions,oldState,newState)=>{if(transactions.some((tr=>tr.getMeta("composition"))))return;const docChanges=transactions.some((transaction=>transaction.docChanged))&&!oldState.doc.eq(newState.doc),ignoreTr=transactions.some((transaction=>transaction.getMeta("preventClearDocument")));if(!docChanges||ignoreTr)return;const{empty,from,to}=oldState.selection,allFrom=dist.LN.atStart(oldState.doc).from,allEnd=dist.LN.atEnd(oldState.doc).to;if(empty||!(from===allFrom&&to===allEnd))return;if(!isNodeEmpty(newState.doc))return;const tr=newState.tr,state=createChainableState({state:newState,transaction:tr}),{commands}=new CommandManager({editor:this.editor,state});return commands.clearNodes(),tr.steps.length?tr:void 0}})]}}),Paste=Extension.create({name:"paste",addProseMirrorPlugins(){return[new dist.k_({key:new dist.hs("tiptapPaste"),props:{handlePaste:(_view,e,slice)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice})}}})]}}),Tabindex=Extension.create({name:"tabindex",addProseMirrorPlugins(){return[new dist.k_({key:new dist.hs("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class NodePos{get name(){return this.node.type.name}constructor(pos,editor,isBlock=!1,node=null){this.currentNode=null,this.actualDepth=null,this.isBlock=isBlock,this.resolvedPos=pos,this.editor=editor,this.currentNode=node}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var _a;return null!==(_a=this.actualDepth)&&void 0!==_a?_a:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(content){let from=this.from,to=this.to;if(this.isBlock){if(0===this.content.size)return void console.error(`You canât set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);from=this.from+1,to=this.to-1}this.editor.commands.insertContentAt({from,to},content)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(0===this.depth)return null;const parentPos=this.resolvedPos.start(this.resolvedPos.depth-1),$pos=this.resolvedPos.doc.resolve(parentPos);return new NodePos($pos,this.editor)}get before(){let $pos=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return $pos.depth!==this.depth&&($pos=this.resolvedPos.doc.resolve(this.from-3)),new NodePos($pos,this.editor)}get after(){let $pos=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return $pos.depth!==this.depth&&($pos=this.resolvedPos.doc.resolve(this.to+3)),new NodePos($pos,this.editor)}get children(){const children=[];return this.node.content.forEach(((node,offset)=>{const isBlock=node.isBlock&&!node.isTextblock,isNonTextAtom=node.isAtom&&!node.isText,targetPos=this.pos+offset+(isNonTextAtom?0:1),$pos=this.resolvedPos.doc.resolve(targetPos);if(!isBlock&&$pos.depth<=this.depth)return;const childNodePos=new NodePos($pos,this.editor,isBlock,isBlock?node:null);isBlock&&(childNodePos.actualDepth=this.depth+1),children.push(new NodePos($pos,this.editor,isBlock,isBlock?node:null))})),children}get firstChild(){return this.children[0]||null}get lastChild(){const children=this.children;return children[children.length-1]||null}closest(selector,attributes={}){let node=null,currentNode=this.parent;for(;currentNode&&!node;){if(currentNode.node.type.name===selector)if(Object.keys(attributes).length>0){const nodeAttributes=currentNode.node.attrs,attrKeys=Object.keys(attributes);for(let index=0;index<attrKeys.length;index+=1){const key=attrKeys[index];if(nodeAttributes[key]!==attributes[key])break}}else node=currentNode;currentNode=currentNode.parent}return node}querySelector(selector,attributes={}){return this.querySelectorAll(selector,attributes,!0)[0]||null}querySelectorAll(selector,attributes={},firstItemOnly=!1){let nodes=[];if(!this.children||0===this.children.length)return nodes;const attrKeys=Object.keys(attributes);return this.children.forEach((childPos=>{if(!(firstItemOnly&&nodes.length>0)){if(childPos.node.type.name===selector){attrKeys.every((key=>attributes[key]===childPos.node.attrs[key]))&&nodes.push(childPos)}firstItemOnly&&nodes.length>0||(nodes=nodes.concat(childPos.querySelectorAll(selector,attributes,firstItemOnly)))}})),nodes}setAttribute(attributes){const{tr}=this.editor.state;tr.setNodeMarkup(this.from,void 0,{...this.node.attrs,...attributes}),this.editor.view.dispatch(tr)}}class Editor extends EventEmitter{constructor(options={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error})=>{throw error},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(options),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",(({event,slice,moved})=>this.options.onDrop(event,slice,moved))),this.on("paste",(({event,slice})=>this.options.onPaste(event,slice))),window.setTimeout((()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)}),0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=function createStyleTag(style,nonce,suffix){const tiptapStyleTag=document.querySelector(`style[data-tiptap-style${suffix?`-${suffix}`:""}]`);if(null!==tiptapStyleTag)return tiptapStyleTag;const styleNode=document.createElement("style");return nonce&&styleNode.setAttribute("nonce",nonce),styleNode.setAttribute("data-tiptap-style"+(suffix?`-${suffix}`:""),""),styleNode.innerHTML=style,document.getElementsByTagName("head")[0].appendChild(styleNode),styleNode}('.ProseMirror {\n  position: relative;\n}\n\n.ProseMirror {\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  white-space: break-spaces;\n  -webkit-font-variant-ligatures: none;\n  font-variant-ligatures: none;\n  font-feature-settings: "liga" 0; /* the above doesn\'t seem to work in Edge */\n}\n\n.ProseMirror [contenteditable="false"] {\n  white-space: normal;\n}\n\n.ProseMirror [contenteditable="false"] [contenteditable="true"] {\n  white-space: pre-wrap;\n}\n\n.ProseMirror pre {\n  white-space: pre-wrap;\n}\n\nimg.ProseMirror-separator {\n  display: inline !important;\n  border: none !important;\n  margin: 0 !important;\n  width: 0 !important;\n  height: 0 !important;\n}\n\n.ProseMirror-gapcursor {\n  display: none;\n  pointer-events: none;\n  position: absolute;\n  margin: 0;\n}\n\n.ProseMirror-gapcursor:after {\n  content: "";\n  display: block;\n  position: absolute;\n  top: -2px;\n  width: 20px;\n  border-top: 1px solid black;\n  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n}\n\n@keyframes ProseMirror-cursor-blink {\n  to {\n    visibility: hidden;\n  }\n}\n\n.ProseMirror-hideselection *::selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection *::-moz-selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection * {\n  caret-color: transparent;\n}\n\n.ProseMirror-focused .ProseMirror-gapcursor {\n  display: block;\n}\n\n.tippy-box[data-animation=fade][data-state=hidden] {\n  opacity: 0\n}',this.options.injectNonce))}setOptions(options={}){this.options={...this.options,...options},this.view&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(editable,emitUpdate=!0){this.setOptions({editable}),emitUpdate&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(plugin,handlePlugins){const plugins=isFunction(handlePlugins)?handlePlugins(plugin,[...this.state.plugins]):[...this.state.plugins,plugin],state=this.state.reconfigure({plugins});return this.view.updateState(state),state}unregisterPlugin(nameOrPluginKeyToRemove){if(this.isDestroyed)return;const prevPlugins=this.state.plugins;let plugins=prevPlugins;if([].concat(nameOrPluginKeyToRemove).forEach((nameOrPluginKey=>{const name="string"==typeof nameOrPluginKey?`${nameOrPluginKey}$`:nameOrPluginKey.key;plugins=plugins.filter((plugin=>!plugin.key.startsWith(name)))})),prevPlugins.length===plugins.length)return;const state=this.state.reconfigure({plugins});return this.view.updateState(state),state}createExtensionManager(){var _a,_b;const allExtensions=[...this.options.enableCoreExtensions?[Editable,ClipboardTextSerializer.configure({blockSeparator:null===(_b=null===(_a=this.options.coreExtensionOptions)||void 0===_a?void 0:_a.clipboardTextSerializer)||void 0===_b?void 0:_b.blockSeparator}),Commands,FocusEvents,Keymap,Tabindex,Drop,Paste].filter((ext=>"object"!=typeof this.options.enableCoreExtensions||!1!==this.options.enableCoreExtensions[ext.name])):[],...this.options.extensions].filter((extension=>["extension","node","mark"].includes(null==extension?void 0:extension.type)));this.extensionManager=new ExtensionManager(allExtensions,this)}createCommandManager(){this.commandManager=new CommandManager({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var _a;let doc;try{doc=createDocument(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(e){if(!(e instanceof Error&&["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(e.message)))throw e;this.emit("contentError",{editor:this,error:e,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter((extension=>"collaboration"!==extension.name)),this.createExtensionManager()}}),doc=createDocument(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const selection=resolveFocusPosition(doc,this.options.autofocus);this.view=new prosemirror_view_dist.Lz(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...null===(_a=this.options.editorProps)||void 0===_a?void 0:_a.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:dist.$t.create({doc,selection:selection||void 0})});const newState=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(newState),this.createNodeViews(),this.prependClass();this.view.dom.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(fn){this.isCapturingTransaction=!0,fn(),this.isCapturingTransaction=!1;const tr=this.capturedTransaction;return this.capturedTransaction=null,tr}dispatchTransaction(transaction){if(this.view.isDestroyed)return;if(this.isCapturingTransaction)return this.capturedTransaction?void transaction.steps.forEach((step=>{var _a;return null===(_a=this.capturedTransaction)||void 0===_a?void 0:_a.step(step)})):void(this.capturedTransaction=transaction);const state=this.state.apply(transaction),selectionHasChanged=!this.state.selection.eq(state.selection);this.emit("beforeTransaction",{editor:this,transaction,nextState:state}),this.view.updateState(state),this.emit("transaction",{editor:this,transaction}),selectionHasChanged&&this.emit("selectionUpdate",{editor:this,transaction});const focus=transaction.getMeta("focus"),blur=transaction.getMeta("blur");focus&&this.emit("focus",{editor:this,event:focus.event,transaction}),blur&&this.emit("blur",{editor:this,event:blur.event,transaction}),transaction.docChanged&&!transaction.getMeta("preventUpdate")&&this.emit("update",{editor:this,transaction})}getAttributes(nameOrType){return getAttributes(this.state,nameOrType)}isActive(nameOrAttributes,attributesOrUndefined){const name="string"==typeof nameOrAttributes?nameOrAttributes:null,attributes="string"==typeof nameOrAttributes?attributesOrUndefined:nameOrAttributes;return function isActive(state,name,attributes={}){if(!name)return isNodeActive(state,null,attributes)||isMarkActive(state,null,attributes);const schemaType=getSchemaTypeNameByName(name,state.schema);return"node"===schemaType?isNodeActive(state,name,attributes):"mark"===schemaType&&isMarkActive(state,name,attributes)}(this.state,name,attributes)}getJSON(){return this.state.doc.toJSON()}getHTML(){return getHTMLFromFragment(this.state.doc.content,this.schema)}getText(options){const{blockSeparator="\n\n",textSerializers={}}=options||{};return getText(this.state.doc,{blockSeparator,textSerializers:{...getTextSerializersFromSchema(this.schema),...textSerializers}})}get isEmpty(){return isNodeEmpty(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const dom=this.view.dom;dom&&dom.editor&&delete dom.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var _a;return!(null===(_a=this.view)||void 0===_a?void 0:_a.docView)}$node(selector,attributes){var _a;return(null===(_a=this.$doc)||void 0===_a?void 0:_a.querySelector(selector,attributes))||null}$nodes(selector,attributes){var _a;return(null===(_a=this.$doc)||void 0===_a?void 0:_a.querySelectorAll(selector,attributes))||null}$pos(pos){const $pos=this.state.doc.resolve(pos);return new NodePos($pos,this)}get $doc(){return this.$pos(0)}}function markInputRule(config){return new InputRule({find:config.find,handler:({state,range,match})=>{const attributes=callOrReturn(config.getAttributes,void 0,match);if(!1===attributes||null===attributes)return null;const{tr}=state,captureGroup=match[match.length-1],fullMatch=match[0];if(captureGroup){const startSpaces=fullMatch.search(/\S/),textStart=range.from+fullMatch.indexOf(captureGroup),textEnd=textStart+captureGroup.length;if(getMarksBetween(range.from,range.to,state.doc).filter((item=>item.mark.type.excluded.find((type=>type===config.type&&type!==item.mark.type)))).filter((item=>item.to>textStart)).length)return null;textEnd<range.to&&tr.delete(textEnd,range.to),textStart>range.from&&tr.delete(range.from+startSpaces,textStart);const markEnd=range.from+startSpaces+captureGroup.length;tr.addMark(range.from+startSpaces,markEnd,config.type.create(attributes||{})),tr.removeStoredMark(config.type)}}})}function nodeInputRule(config){return new InputRule({find:config.find,handler:({state,range,match})=>{const attributes=callOrReturn(config.getAttributes,void 0,match)||{},{tr}=state,start=range.from;let end=range.to;const newNode=config.type.create(attributes);if(match[1]){let matchStart=start+match[0].lastIndexOf(match[1]);matchStart>end?matchStart=end:end=matchStart+match[1].length;const lastChar=match[0][match[0].length-1];tr.insertText(lastChar,start+match[0].length-1),tr.replaceWith(matchStart,end,newNode)}else if(match[0]){const insertionStart=config.type.isInline?start:start-1;tr.insert(insertionStart,config.type.create(attributes)).delete(tr.mapping.map(start),tr.mapping.map(end))}tr.scrollIntoView()}})}function textblockTypeInputRule(config){return new InputRule({find:config.find,handler:({state,range,match})=>{const $start=state.doc.resolve(range.from),attributes=callOrReturn(config.getAttributes,void 0,match)||{};if(!$start.node(-1).canReplaceWith($start.index(-1),$start.indexAfter(-1),config.type))return null;state.tr.delete(range.from,range.to).setBlockType(range.from,range.from,config.type,attributes)}})}function wrappingInputRule(config){return new InputRule({find:config.find,handler:({state,range,match,chain})=>{const attributes=callOrReturn(config.getAttributes,void 0,match)||{},tr=state.tr.delete(range.from,range.to),blockRange=tr.doc.resolve(range.from).blockRange(),wrapping=blockRange&&(0,prosemirror_transform_dist.oM)(blockRange,config.type,attributes);if(!wrapping)return null;if(tr.wrap(blockRange,wrapping),config.keepMarks&&config.editor){const{selection,storedMarks}=state,{splittableMarks}=config.editor.extensionManager,marks=storedMarks||selection.$to.parentOffset&&selection.$from.marks();if(marks){const filteredMarks=marks.filter((mark=>splittableMarks.includes(mark.type.name)));tr.ensureMarks(filteredMarks)}}if(config.keepAttributes){const nodeType="bulletList"===config.type.name||"orderedList"===config.type.name?"listItem":"taskList";chain().updateAttributes(nodeType,attributes).run()}const before=tr.doc.resolve(range.from-1).nodeBefore;before&&before.type===config.type&&(0,prosemirror_transform_dist.n9)(tr.doc,range.from-1)&&(!config.joinPredicate||config.joinPredicate(match,before))&&tr.join(range.from-1)}})}class Node{constructor(config={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...config},this.name=this.config.name,config.defaultOptions&&Object.keys(config.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=callOrReturn(getExtensionField(this,"addOptions",{name:this.name}))),this.storage=callOrReturn(getExtensionField(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(config={}){return new Node(config)}configure(options={}){const extension=this.extend({...this.config,addOptions:()=>mergeDeep(this.options,options)});return extension.name=this.name,extension.parent=this.parent,extension}extend(extendedConfig={}){const extension=new Node(extendedConfig);return extension.parent=this,this.child=extension,extension.name=extendedConfig.name?extendedConfig.name:extension.parent.name,extendedConfig.defaultOptions&&Object.keys(extendedConfig.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${extension.name}".`),extension.options=callOrReturn(getExtensionField(extension,"addOptions",{name:extension.name})),extension.storage=callOrReturn(getExtensionField(extension,"addStorage",{name:extension.name,options:extension.options})),extension}}function markPasteRule(config){return new PasteRule({find:config.find,handler:({state,range,match,pasteEvent})=>{const attributes=callOrReturn(config.getAttributes,void 0,match,pasteEvent);if(!1===attributes||null===attributes)return null;const{tr}=state,captureGroup=match[match.length-1],fullMatch=match[0];let markEnd=range.to;if(captureGroup){const startSpaces=fullMatch.search(/\S/),textStart=range.from+fullMatch.indexOf(captureGroup),textEnd=textStart+captureGroup.length;if(getMarksBetween(range.from,range.to,state.doc).filter((item=>item.mark.type.excluded.find((type=>type===config.type&&type!==item.mark.type)))).filter((item=>item.to>textStart)).length)return null;textEnd<range.to&&tr.delete(textEnd,range.to),textStart>range.from&&tr.delete(range.from+startSpaces,textStart),markEnd=range.from+startSpaces+captureGroup.length,tr.addMark(range.from+startSpaces,markEnd,config.type.create(attributes||{})),tr.removeStoredMark(config.type)}}})}},"./node_modules/@tldraw/editor/dist-esm/index.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{xGO:()=>Arc2d,srS:()=>ArrowShapeArrowheadEndStyle,roz:()=>ArrowShapeArrowheadStartStyle,qfG:()=>ArrowShapeKindStyle,Kx3:()=>AssetRecordType,QVi:()=>BaseBoxShapeTool,A8:()=>BaseBoxShapeUtil,mbh:()=>BindingUtil,azJ:()=>Box,PUi:()=>Circle2d,iON:()=>CubicBezier2d,M8g:()=>CubicSpline2d,RBp:()=>dist_esm.RB,MM6:()=>dist_esm.MM,qSO:()=>dist_esm.qS,ive:()=>DefaultColorStyle,Rmu:()=>DefaultColorThemePalette,Pe6:()=>DefaultDashStyle,u8f:()=>DefaultFillStyle,xXD:()=>DefaultFontFamilies,yes:()=>DefaultFontStyle,yMj:()=>DefaultHorizontalAlignStyle,X$1:()=>DefaultShapeIndicators,Sg3:()=>DefaultSizeStyle,nM1:()=>DefaultTextAlignStyle,YUb:()=>DefaultVerticalAlignStyle,Z4H:()=>EASINGS,Mlv:()=>state_dist_esm.Ml,AoN:()=>Edge2d,KE6:()=>Editor,pPP:()=>Ellipse2d,SmQ:()=>dist_esm.Sm,tg8:()=>GeoShapeGeoStyle,MI8:()=>Geometry2dFilters,IQE:()=>Group2d,sKG:()=>HALF_PI,hDc:()=>HTMLContainer,_V3:()=>dist_esm._V,Yjb:()=>LANGUAGES,eBK:()=>LineShapeSplineStyle,xxw:()=>LoadingScreen,V8r:()=>Mat,K4L:()=>dist_esm.K4,PI:()=>utils_PI,uAR:()=>utils_PI2,tvM:()=>PageRecordType,dxv:()=>Polygon2d,Hes:()=>Polyline2d,krb:()=>Rectangle2d,dwc:()=>SIN,ULM:()=>SVGContainer,inY:()=>ShapeUtil,bDP:()=>SharedStyleMap,SPX:()=>Stadium2d,YM5:()=>StateNode,T:()=>validation_namespaceObject,O75:()=>TldrawEditor,xXO:()=>USER_COLORS,l2P:()=>Vec,laH:()=>dist_esm.l,as9:()=>dist_esm.as,ghB:()=>activeElementShouldCaptureKeys,_Bx:()=>applyRotationToSnapshotShapes,YY0:()=>approximately,jwY:()=>areAnglesCompatible,g8l:()=>arrowBindingMigrations,P_i:()=>arrowBindingProps,udf:()=>arrowShapeMigrations,FXh:()=>arrowShapeProps,vAR:()=>dist_esm.vA,eUv:()=>state_dist_esm.eU,G86:()=>average,oIE:()=>dist_esm.oI,hNn:()=>bookmarkShapeMigrations,aWX:()=>bookmarkShapeProps,rgm:()=>canonicalizeRotation,oj6:()=>centerOfCircleFromThreePoints,qE8:()=>clamp,KMq:()=>clockwiseAngleDist,oE7:()=>dist_esm.oE,EWP:()=>state_dist_esm.EW,IM4:()=>counterClockwiseAngleDist,BNi:()=>createBindingId,uYT:()=>store_dist_esm.uY,n6Y:()=>createShapeId,sg1:()=>dist_esm.sg,bGJ:()=>debugFlags,TjI:()=>defaultUserPreferences,tRv:()=>degreesToRadians,deR:()=>drawShapeMigrations,KBL:()=>drawShapeProps,upp:()=>embedShapeMigrations,Pwo:()=>embedShapeProps,h6G:()=>dist_esm.h6,ofH:()=>featureFlags,hdJ:()=>dist_esm.hd,SpZ:()=>frameShapeMigrations,X24:()=>frameShapeProps,s4L:()=>geoShapeMigrations,X8F:()=>geoShapeProps,BEc:()=>getCursor,H__:()=>getDefaultCdnBaseUrl,AnR:()=>getDefaultColorTheme,EYW:()=>getFontsFromRichText,zMQ:()=>dist_esm.zM,Gwq:()=>dist_esm.Gw,xpx:()=>dist_esm.xp,AQy:()=>dist_esm.AQ,SBu:()=>dist_esm.SB,HEt:()=>dist_esm.HE,uud:()=>dist_esm.uu,g50:()=>dist_esm.g5,EK8:()=>getPerfectDashProps,AQe:()=>getPointOnCircle,yGT:()=>getPointerInfo,Dso:()=>getPointsOnArc,yeN:()=>getPolygonVertices,fHb:()=>getRotationSnapshot,dVW:()=>getSnapshot,JDT:()=>getSvgPathFromPoints,W$r:()=>hardResetEditor,REO:()=>highlightShapeMigrations,M60:()=>highlightShapeProps,UcL:()=>imageShapeMigrations,lXb:()=>imageShapeProps,OpZ:()=>intersectCircleCircle,vrM:()=>intersectLineSegmentCircle,lqI:()=>intersectLineSegmentPolygon,Fg_:()=>dist_esm.Fg,gu7:()=>isAccelKey,O9V:()=>dist_esm.O9,xhT:()=>isPageId,_Bd:()=>isSafeFloat,vc4:()=>isShapeId,HVh:()=>dist_esm.HV,CcK:()=>dist_esm.Cc,bT0:()=>lineShapeMigrations,e9l:()=>lineShapeProps,N2B:()=>loadSnapshot,_Hz:()=>dist_esm._H,Y8F:()=>maybeSnapToGrid,OgJ:()=>dist_esm.Og,wql:()=>dist_esm.wq,wwY:()=>dist_esm.ww,lQ1:()=>dist_esm.lQ,jaC:()=>normalizeWheel,fq3:()=>noteShapeMigrations,SWg:()=>noteShapeProps,iAN:()=>dist_esm.iA,_ed:()=>dist_esm._e,w$g:()=>dist_esm.w$,Ics:()=>dist_esm.Ic,D1x:()=>openWindow,VMe:()=>perimeterOfEllipse,s3y:()=>pointInPolygon,j0P:()=>polygonIntersectsPolyline,Rx2:()=>polygonsIntersect,ulI:()=>precise,woC:()=>preventDefault,wvh:()=>state_dist_esm.wv,lFJ:()=>dist_esm.lF,hPm:()=>releasePointerCapture,mfH:()=>resizeBox,d5$:()=>resizeScaled,She:()=>dist_esm.Sh,yCG:()=>dist_esm.yC,ni0:()=>sanitizeId,Yz5:()=>dist_esm.Yz,YYG:()=>setPointerCapture,qer:()=>shortAngleDist,cL9:()=>snapAngle,Ky:()=>dist_esm.Ky,$6n:()=>stopEventPropagation,pN9:()=>dist_esm.pN,oX2:()=>suffixSafeId,E4k:()=>textShapeMigrations,xjg:()=>textShapeProps,nFR:()=>dist_esm.nF,YZA:()=>tlenv,NlK:()=>tlmenus,slq:()=>tltime,WMC:()=>utils_toDomPrecision,Mg8:()=>toFixed,TP3:()=>toRichText,u4I:()=>track,hLc:()=>state_dist_esm.hL,sbv:()=>uniq,NF7:()=>dist_esm.NF,PmD:()=>state_dist_esm.Pm,fpl:()=>useAtom_useAtom,NFA:()=>useContainer,lsV:()=>useDelaySvgExport,hGv:()=>useEditor_useEditor,BSi:()=>useEditorComponents,_q_:()=>useEvent,ofB:()=>useGlobalMenuIsOpen,hJo:()=>useIsDarkMode,_As:()=>useIsEditing,frr:()=>useMaybeEditor,yfR:()=>useOnMount,_vE:()=>usePassThroughMouseOverEvents,I9L:()=>usePassThroughWheelEvents,oKA:()=>usePeerIds,xQ_:()=>usePresence,lXS:()=>useQuickReactor,a1r:()=>useReactor,bQe:()=>useSelectionEvents,H80:()=>useShallowArrayIdentity,dSk:()=>useIdentity_useShallowObjectIdentity,Xhk:()=>useSharedSafeId,Jf5:()=>useSvgExportContext,jXu:()=>useTLStore,Gyu:()=>useTransform_useTransform,LsA:()=>useUniqueSafeId,hau:()=>useValue_useValue,w9f:()=>videoShapeMigrations,ZMy:()=>videoShapeProps});var validation_namespaceObject={};__webpack_require__.r(validation_namespaceObject),__webpack_require__.d(validation_namespaceObject,{ArrayOfValidator:()=>ArrayOfValidator,DictValidator:()=>DictValidator,ObjectValidator:()=>ObjectValidator,UnionValidator:()=>UnionValidator,ValidationError:()=>ValidationError,Validator:()=>Validator,any:()=>any,array:()=>array,arrayOf:()=>arrayOf,bigint:()=>bigint,boolean:()=>validation_boolean,dict:()=>dict,httpUrl:()=>httpUrl,indexKey:()=>indexKey,integer:()=>integer,jsonDict:()=>jsonDict,jsonValue:()=>jsonValue,linkUrl:()=>linkUrl,literal:()=>literal,literalEnum:()=>literalEnum,model:()=>model,nonZeroInteger:()=>nonZeroInteger,nonZeroNumber:()=>nonZeroNumber,nullable:()=>nullable,number:()=>number,numberUnion:()=>numberUnion,object:()=>object,optional:()=>optional,or:()=>or,positiveInteger:()=>positiveInteger,positiveNumber:()=>positiveNumber,setEnum:()=>setEnum,srcUrl:()=>srcUrl,string:()=>string,union:()=>union,unknown:()=>unknown,unknownObject:()=>unknownObject});var dist_esm=__webpack_require__("./node_modules/@tldraw/utils/dist-esm/index.mjs"),state_dist_esm=(__webpack_require__("./node_modules/core-js/stable/array/at.js"),__webpack_require__("./node_modules/core-js/stable/array/flat-map.js"),__webpack_require__("./node_modules/core-js/stable/array/flat.js"),__webpack_require__("./node_modules/core-js/stable/string/at.js"),__webpack_require__("./node_modules/core-js/stable/string/replace-all.js"),__webpack_require__("./node_modules/@tldraw/state/dist-esm/index.mjs")),react=__webpack_require__("./node_modules/react/index.js");function useStateTracking(name,render,deps=[]){const renderRef=react.useRef(render);renderRef.current=render;const[scheduler,subscribe,getSnapshot]=react.useMemo((()=>{let scheduleUpdate=null;const scheduler2=new state_dist_esm.VM(`useStateTracking(${name})`,(()=>renderRef.current?.()),{scheduleEffect(){scheduleUpdate?.()}});return[scheduler2,cb=>(scheduleUpdate=cb,()=>{scheduleUpdate=null}),()=>scheduler2.scheduleCount]}),[name,...deps]);return react.useSyncExternalStore(subscribe,getSnapshot,getSnapshot),react.useEffect((()=>(scheduler.attach(),scheduler.maybeScheduleEffect(),()=>{scheduler.detach()})),[scheduler]),scheduler.execute()}const ProxyHandlers={apply:(Component,thisArg,argumentsList)=>useStateTracking(Component.displayName??Component.name??"tracked(???)",(()=>Component.apply(thisArg,argumentsList)))},ReactMemoSymbol=Symbol.for("react.memo"),ReactForwardRefSymbol=Symbol.for("react.forward_ref");function track(baseComponent){let compare=null;const $$typeof=baseComponent.$$typeof;return $$typeof===ReactMemoSymbol&&(compare=(baseComponent=baseComponent.type).compare),$$typeof===ReactForwardRefSymbol?(0,react.memo)((0,react.forwardRef)(new Proxy(baseComponent.render,ProxyHandlers))):(0,react.memo)(new Proxy(baseComponent,ProxyHandlers),compare)}function useAtom_useAtom(name,valueOrInitialiser,options){return(0,react.useState)((()=>{const initialValue="function"==typeof valueOrInitialiser?valueOrInitialiser():valueOrInitialiser;return(0,state_dist_esm.eU)(`useAtom(${name})`,initialValue,options)}))[0]}function useQuickReactor(name,reactFn,deps=state_dist_esm.Ml){(0,react.useEffect)((()=>{const scheduler=new state_dist_esm.VM(name,reactFn);return scheduler.attach(),scheduler.execute(),()=>{scheduler.detach()}}),deps)}function useReactor(name,reactFn,deps=[]){const raf=(0,react.useRef)(-1),scheduler=(0,react.useMemo)((()=>new state_dist_esm.VM(name,reactFn,{scheduleEffect:cb=>{const rafId=requestAnimationFrame(cb);return raf.current=rafId,rafId}})),deps);(0,react.useEffect)((()=>(scheduler.attach(),scheduler.execute(),()=>{scheduler.detach(),cancelAnimationFrame(raf.current)})),[scheduler])}function useValue_useValue(){const args=arguments,deps=3===args.length?args[2]:[args[0]],name=3===args.length?args[0]:`useValue(${args[0].name})`,isInRender=(0,react.useRef)(!0);isInRender.current=!0;const $val=(0,react.useMemo)((()=>1===args.length?args[0]:(0,state_dist_esm.EW)(name,(()=>{if(isInRender.current)return args[1]();try{return args[1]()}catch{return{}}}))),deps);try{const{subscribe,getSnapshot}=(0,react.useMemo)((()=>({subscribe:listen=>(0,state_dist_esm.wv)(`useValue(${name})`,(()=>{$val.get(),listen()})),getSnapshot:()=>$val.get()})),[$val]);return(0,react.useSyncExternalStore)(subscribe,getSnapshot,getSnapshot)}finally{isInRender.current=!1}}(0,dist_esm.lF)("@tldraw/state-react","3.13.1","esm");var store_dist_esm=__webpack_require__("./node_modules/@tldraw/store/dist-esm/index.mjs");class ValidationError extends Error{constructor(rawMessage,path=[]){const formattedPath=function formatPath(path){if(!path.length)return null;let formattedPath="";for(const item of path)"number"==typeof item?formattedPath+=`.${item}`:item.startsWith("(")?formattedPath.endsWith(")")?formattedPath=`${formattedPath.slice(0,-1)}, ${item.slice(1)}`:formattedPath+=item:formattedPath+=`.${item}`;return formattedPath=formattedPath.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,""),formattedPath.startsWith(".")?formattedPath.slice(1):formattedPath}(path),indentedMessage=rawMessage.split("\n").map(((line,i)=>0===i?line:`  ${line}`)).join("\n");super(path?`At ${formattedPath}: ${indentedMessage}`:indentedMessage),this.rawMessage=rawMessage,this.path=path}name="ValidationError"}function prefixError(path,fn){try{return fn()}catch(err){if(err instanceof ValidationError)throw new ValidationError(err.rawMessage,[path,...err.path]);throw new ValidationError(err.toString(),[path])}}function typeToString(value){if(null===value)return"null";if(Array.isArray(value))return"an array";const type=typeof value;switch(type){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${type}`;case"object":return`an ${type}`;case"undefined":return"undefined";default:(0,dist_esm.h6)(type)}}class Validator{constructor(validationFn,validateUsingKnownGoodVersionFn){this.validationFn=validationFn,this.validateUsingKnownGoodVersionFn=validateUsingKnownGoodVersionFn}validate(value){return this.validationFn(value)}validateUsingKnownGoodVersion(knownGoodValue,newValue){return Object.is(knownGoodValue,newValue)?knownGoodValue:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(knownGoodValue,newValue):this.validate(newValue)}isValid(value){try{return this.validate(value),!0}catch{return!1}}nullable(){return nullable(this)}optional(){return optional(this)}refine(otherValidationFn){return new Validator((value=>otherValidationFn(this.validate(value))),((knownGoodValue,newValue)=>{const validated=this.validateUsingKnownGoodVersion(knownGoodValue,newValue);return Object.is(knownGoodValue,validated)?knownGoodValue:otherValidationFn(validated)}))}check(nameOrCheckFn,checkFn){return"string"==typeof nameOrCheckFn?this.refine((value=>(prefixError(`(check ${nameOrCheckFn})`,(()=>checkFn(value))),value))):this.refine((value=>(nameOrCheckFn(value),value)))}}class ArrayOfValidator extends Validator{constructor(itemValidator){super((value=>{const arr=array.validate(value);for(let i=0;i<arr.length;i++)prefixError(i,(()=>itemValidator.validate(arr[i])));return arr}),((knownGoodValue,newValue)=>{if(!itemValidator.validateUsingKnownGoodVersion)return this.validate(newValue);const arr=array.validate(newValue);let isDifferent=knownGoodValue.length!==arr.length;for(let i=0;i<arr.length;i++){const item=arr[i];if(i>=knownGoodValue.length){isDifferent=!0,prefixError(i,(()=>itemValidator.validate(item)));continue}if(Object.is(knownGoodValue[i],item))continue;const checkedItem=prefixError(i,(()=>itemValidator.validateUsingKnownGoodVersion(knownGoodValue[i],item)));Object.is(checkedItem,knownGoodValue[i])||(isDifferent=!0)}return isDifferent?newValue:knownGoodValue})),this.itemValidator=itemValidator}nonEmpty(){return this.check((value=>{if(0===value.length)throw new ValidationError("Expected a non-empty array")}))}lengthGreaterThan1(){return this.check((value=>{if(value.length<=1)throw new ValidationError("Expected an array with length greater than 1")}))}}class ObjectValidator extends Validator{constructor(config,shouldAllowUnknownProperties=!1){super((object2=>{if("object"!=typeof object2||null===object2)throw new ValidationError(`Expected object, got ${typeToString(object2)}`);for(const[key,validator]of Object.entries(config))prefixError(key,(()=>{validator.validate((0,dist_esm.g5)(object2,key))}));if(!shouldAllowUnknownProperties)for(const key of Object.keys(object2))if(!(0,dist_esm.mQ)(config,key))throw new ValidationError("Unexpected property",[key]);return object2}),((knownGoodValue,newValue)=>{if("object"!=typeof newValue||null===newValue)throw new ValidationError(`Expected object, got ${typeToString(newValue)}`);let isDifferent=!1;for(const[key,validator]of Object.entries(config)){const prev=(0,dist_esm.g5)(knownGoodValue,key),next=(0,dist_esm.g5)(newValue,key);if(Object.is(prev,next))continue;const checked=prefixError(key,(()=>{const validatable=validator;return validatable.validateUsingKnownGoodVersion?validatable.validateUsingKnownGoodVersion(prev,next):validatable.validate(next)}));Object.is(checked,prev)||(isDifferent=!0)}if(!shouldAllowUnknownProperties)for(const key of Object.keys(newValue))if(!(0,dist_esm.mQ)(config,key))throw new ValidationError("Unexpected property",[key]);for(const key of Object.keys(knownGoodValue))if(!(0,dist_esm.mQ)(newValue,key)){isDifferent=!0;break}return isDifferent?newValue:knownGoodValue})),this.config=config,this.shouldAllowUnknownProperties=shouldAllowUnknownProperties}allowUnknownProperties(){return new ObjectValidator(this.config,!0)}extend(extension){return new ObjectValidator({...this.config,...extension})}}class UnionValidator extends Validator{constructor(key,config,unknownValueValidation,useNumberKeys){super((input=>{this.expectObject(input);const{matchingSchema,variant}=this.getMatchingSchemaAndVariant(input);return void 0===matchingSchema?this.unknownValueValidation(input,variant):prefixError(`(${key} = ${variant})`,(()=>matchingSchema.validate(input)))}),((prevValue,newValue)=>{this.expectObject(newValue),this.expectObject(prevValue);const{matchingSchema,variant}=this.getMatchingSchemaAndVariant(newValue);return void 0===matchingSchema?this.unknownValueValidation(newValue,variant):(0,dist_esm.g5)(prevValue,key)!==(0,dist_esm.g5)(newValue,key)?prefixError(`(${key} = ${variant})`,(()=>matchingSchema.validate(newValue))):prefixError(`(${key} = ${variant})`,(()=>matchingSchema.validateUsingKnownGoodVersion?matchingSchema.validateUsingKnownGoodVersion(prevValue,newValue):matchingSchema.validate(newValue)))})),this.key=key,this.config=config,this.unknownValueValidation=unknownValueValidation,this.useNumberKeys=useNumberKeys}expectObject(value){if("object"!=typeof value||null===value)throw new ValidationError(`Expected an object, got ${typeToString(value)}`,[])}getMatchingSchemaAndVariant(object2){const variant=(0,dist_esm.g5)(object2,this.key);if(!this.useNumberKeys&&"string"!=typeof variant)throw new ValidationError(`Expected a string for key "${this.key}", got ${typeToString(variant)}`);if(this.useNumberKeys&&!Number.isFinite(Number(variant)))throw new ValidationError(`Expected a number for key "${this.key}", got "${variant}"`);return{matchingSchema:(0,dist_esm.mQ)(this.config,variant)?this.config[variant]:void 0,variant}}validateUnknownVariants(unknownValueValidation){return new UnionValidator(this.key,this.config,unknownValueValidation,this.useNumberKeys)}}class DictValidator extends Validator{constructor(keyValidator,valueValidator){super((object2=>{if("object"!=typeof object2||null===object2)throw new ValidationError(`Expected object, got ${typeToString(object2)}`);for(const[key,value]of Object.entries(object2))prefixError(key,(()=>{keyValidator.validate(key),valueValidator.validate(value)}));return object2}),((knownGoodValue,newValue)=>{if("object"!=typeof newValue||null===newValue)throw new ValidationError(`Expected object, got ${typeToString(newValue)}`);let isDifferent=!1;for(const[key,value]of Object.entries(newValue)){if(!(0,dist_esm.mQ)(knownGoodValue,key)){isDifferent=!0,prefixError(key,(()=>{keyValidator.validate(key),valueValidator.validate(value)}));continue}const prev=(0,dist_esm.g5)(knownGoodValue,key),next=value;if(Object.is(prev,next))continue;const checked=prefixError(key,(()=>valueValidator.validateUsingKnownGoodVersion?valueValidator.validateUsingKnownGoodVersion(prev,next):valueValidator.validate(next)));Object.is(checked,prev)||(isDifferent=!0)}for(const key of Object.keys(knownGoodValue))if(!(0,dist_esm.mQ)(newValue,key)){isDifferent=!0;break}return isDifferent?newValue:knownGoodValue})),this.keyValidator=keyValidator,this.valueValidator=valueValidator}}function typeofValidator(type){return new Validator((value=>{if(typeof value!==type)throw new ValidationError(`Expected ${type}, got ${typeToString(value)}`);return value}))}const unknown=new Validator((value=>value)),any=new Validator((value=>value)),string=typeofValidator("string"),number=typeofValidator("number").check((number2=>{if(Number.isNaN(number2))throw new ValidationError("Expected a number, got NaN");if(!Number.isFinite(number2))throw new ValidationError(`Expected a finite number, got ${number2}`)})),positiveNumber=number.check((value=>{if(value<0)throw new ValidationError(`Expected a positive number, got ${value}`)})),nonZeroNumber=number.check((value=>{if(value<=0)throw new ValidationError(`Expected a non-zero positive number, got ${value}`)})),integer=number.check((value=>{if(!Number.isInteger(value))throw new ValidationError(`Expected an integer, got ${value}`)})),positiveInteger=integer.check((value=>{if(value<0)throw new ValidationError(`Expected a positive integer, got ${value}`)})),nonZeroInteger=integer.check((value=>{if(value<=0)throw new ValidationError(`Expected a non-zero positive integer, got ${value}`)})),validation_boolean=typeofValidator("boolean"),bigint=typeofValidator("bigint");function literal(expectedValue){return new Validator((actualValue=>{if(actualValue!==expectedValue)throw new ValidationError(`Expected ${expectedValue}, got ${JSON.stringify(actualValue)}`);return expectedValue}))}const array=new Validator((value=>{if(!Array.isArray(value))throw new ValidationError(`Expected an array, got ${typeToString(value)}`);return value}));function arrayOf(itemValidator){return new ArrayOfValidator(itemValidator)}const unknownObject=new Validator((value=>{if("object"!=typeof value||null===value)throw new ValidationError(`Expected object, got ${typeToString(value)}`);return value}));function object(config){return new ObjectValidator(config)}function isPlainObject(value){return"object"==typeof value&&null!==value&&(Object.getPrototypeOf(value)===Object.prototype||null===Object.getPrototypeOf(value)||Object.getPrototypeOf(value)===dist_esm.DM)}function isValidJson(value){return null===value||"number"==typeof value||"string"==typeof value||"boolean"==typeof value||(Array.isArray(value)?value.every(isValidJson):!!isPlainObject(value)&&Object.values(value).every(isValidJson))}const jsonValue=new Validator((value=>{if(isValidJson(value))return value;throw new ValidationError("Expected json serializable value, got "+typeof value)}),((knownGoodValue,newValue)=>{if(Array.isArray(knownGoodValue)&&Array.isArray(newValue)){let isDifferent=knownGoodValue.length!==newValue.length;for(let i=0;i<newValue.length;i++){if(i>=knownGoodValue.length){isDifferent=!0,jsonValue.validate(newValue[i]);continue}const prev=knownGoodValue[i],next=newValue[i];if(Object.is(prev,next))continue;const checked=jsonValue.validateUsingKnownGoodVersion(prev,next);Object.is(checked,prev)||(isDifferent=!0)}return isDifferent?newValue:knownGoodValue}if(isPlainObject(knownGoodValue)&&isPlainObject(newValue)){let isDifferent=!1;for(const key of Object.keys(newValue)){if(!(0,dist_esm.mQ)(knownGoodValue,key)){isDifferent=!0,jsonValue.validate(newValue[key]);continue}const prev=knownGoodValue[key],next=newValue[key];if(Object.is(prev,next))continue;const checked=jsonValue.validateUsingKnownGoodVersion(prev,next);Object.is(checked,prev)||(isDifferent=!0)}for(const key of Object.keys(knownGoodValue))if(!(0,dist_esm.mQ)(newValue,key)){isDifferent=!0;break}return isDifferent?newValue:knownGoodValue}return jsonValue.validate(newValue)}));function jsonDict(){return dict(string,jsonValue)}function dict(keyValidator,valueValidator){return new DictValidator(keyValidator,valueValidator)}function union(key,config){return new UnionValidator(key,config,((_unknownValue,unknownVariant)=>{throw new ValidationError(`Expected one of ${Object.keys(config).map((key2=>JSON.stringify(key2))).join(" or ")}, got ${JSON.stringify(unknownVariant)}`,[key])}),!1)}function numberUnion(key,config){return new UnionValidator(key,config,((unknownValue,unknownVariant)=>{throw new ValidationError(`Expected one of ${Object.keys(config).map((key2=>JSON.stringify(key2))).join(" or ")}, got ${JSON.stringify(unknownVariant)}`,[key])}),!0)}function model(name,validator){return new Validator((value=>prefixError(name,(()=>validator.validate(value)))),((prevValue,newValue)=>prefixError(name,(()=>validator.validateUsingKnownGoodVersion?validator.validateUsingKnownGoodVersion(prevValue,newValue):validator.validate(newValue)))))}function setEnum(values){return new Validator((value=>{if(!values.has(value)){const valuesString=Array.from(values,(value2=>JSON.stringify(value2))).join(" or ");throw new ValidationError(`Expected ${valuesString}, got ${value}`)}return value}))}function optional(validator){return new Validator((value=>{if(void 0!==value)return validator.validate(value)}),((knownGoodValue,newValue)=>{if((void 0!==knownGoodValue||void 0!==newValue)&&void 0!==newValue)return validator.validateUsingKnownGoodVersion&&void 0!==knownGoodValue?validator.validateUsingKnownGoodVersion(knownGoodValue,newValue):validator.validate(newValue)}))}function nullable(validator){return new Validator((value=>null===value?null:validator.validate(value)),((knownGoodValue,newValue)=>null===newValue?null:validator.validateUsingKnownGoodVersion&&null!==knownGoodValue?validator.validateUsingKnownGoodVersion(knownGoodValue,newValue):validator.validate(newValue)))}function literalEnum(...values){return setEnum(new Set(values))}function parseUrl(str){try{return new URL(str)}catch{if(str.startsWith("/")||str.startsWith("./"))try{return new URL(str,"http://example.com")}catch{throw new ValidationError(`Expected a valid url, got ${JSON.stringify(str)}`)}throw new ValidationError(`Expected a valid url, got ${JSON.stringify(str)}`)}}const validLinkProtocols=new Set(["http:","https:","mailto:"]),linkUrl=string.check((value=>{if(""===value)return;const url=parseUrl(value);if(!validLinkProtocols.has(url.protocol.toLowerCase()))throw new ValidationError(`Expected a valid url, got ${JSON.stringify(value)} (invalid protocol)`)})),validSrcProtocols=new Set(["http:","https:","data:","asset:"]),srcUrl=string.check((value=>{if(""===value)return;const url=parseUrl(value);if(!validSrcProtocols.has(url.protocol.toLowerCase()))throw new ValidationError(`Expected a valid url, got ${JSON.stringify(value)} (invalid protocol)`)})),httpUrl=string.check((value=>{if(""===value)return;if(!parseUrl(value).protocol.toLowerCase().match(/^https?:$/))throw new ValidationError(`Expected a valid url, got ${JSON.stringify(value)} (invalid protocol)`)})),indexKey=string.refine((key=>{try{return(0,dist_esm.fb)(key),key}catch{throw new ValidationError(`Expected an index key, got ${JSON.stringify(key)}`)}}));function or(v1,v2){return new Validator((value=>{try{return v1.validate(value)}catch{return v2.validate(value)}}))}function idValidator(prefix){return string.refine((id=>{if(!id.startsWith(`${prefix}:`))throw new Error(`${prefix} ID must start with "${prefix}:"`);return id}))}(0,dist_esm.lF)("@tldraw/validate","3.13.1","esm");const assetIdValidator=idValidator("asset");function createAssetValidator(type,props){return object({id:assetIdValidator,typeName:literal("asset"),type:literal(type),props,meta:jsonValue})}const vecModelValidator=object({x:number,y:number,z:number.optional()}),boxModelValidator=object({x:number,y:number,w:number,h:number}),opacityValidator=number.check((n=>{if(n<0||n>1)throw new ValidationError("Opacity must be between 0 and 1")})),parentIdValidator=string.refine((id=>{if(!id.startsWith("page:")&&!id.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return id})),shapeIdValidator=idValidator("shape");const bindingIdValidator=idValidator("binding");(0,store_dist_esm.bo)("com.tldraw.binding",{}),(0,store_dist_esm.XD)({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function createBindingId(id){return`binding:${id??(0,dist_esm.NF)()}`}function createBindingRecordType(bindings){return(0,store_dist_esm.WE)("binding",{scope:"document",validator:model("binding",union("type",(0,dist_esm._H)(bindings,((type,{props,meta})=>function createBindingValidator(type,props,meta){return object({id:bindingIdValidator,typeName:literal("binding"),type:literal(type),fromId:shapeIdValidator,toId:shapeIdValidator,props:props?object(props):jsonValue,meta:meta?object(meta):jsonValue})}(type,props,meta)))))}).withDefaultProperties((()=>({meta:{}})))}class StyleProp{constructor(id,defaultValue,type){this.id=id,this.defaultValue=defaultValue,this.type=type}static define(uniqueId,options){const{defaultValue,type=any}=options;return new StyleProp(uniqueId,defaultValue,type)}static defineEnum(uniqueId,options){const{defaultValue,values}=options;return new EnumStyleProp(uniqueId,defaultValue,values)}setDefaultValue(value){this.defaultValue=value}validate(value){return this.type.validate(value)}validateUsingKnownGoodVersion(prevValue,newValue){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(prevValue,newValue):this.validate(newValue)}}class EnumStyleProp extends StyleProp{constructor(id,defaultValue,values){super(id,defaultValue,literalEnum(...values)),this.values=values}}const rootShapeVersions=(0,store_dist_esm.bo)("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),rootShapeMigrations=(0,store_dist_esm.XD)({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:rootShapeVersions.AddIsLocked,up:record=>{record.isLocked=!1},down:record=>{delete record.isLocked}},{id:rootShapeVersions.HoistOpacity,up:record=>{record.opacity=Number(record.props.opacity??"1"),delete record.props.opacity},down:record=>{const opacity=record.opacity;delete record.opacity,record.props.opacity=opacity<.175?"0.1":opacity<.375?"0.25":opacity<.625?"0.5":opacity<.875?"0.75":"1"}},{id:rootShapeVersions.AddMeta,up:record=>{record.meta={}}},{id:rootShapeVersions.AddWhite,up:_record=>{},down:record=>{"white"===record.props.color&&(record.props.color="black")}}]});function isShape(record){return!!record&&"shape"===record.typeName}function isShapeId(id){return!!id&&id.startsWith("shape:")}function createShapeId(id){return`shape:${id??(0,dist_esm.NF)()}`}function getShapePropKeysByStyle(props){const propKeysByStyle=new Map;for(const[key,prop]of Object.entries(props))if(prop instanceof StyleProp){if(propKeysByStyle.has(prop))throw new Error(`Duplicate style prop ${prop.id}. Each style prop can only be used once within a shape.`);propKeysByStyle.set(prop,key)}return propKeysByStyle}function createShapePropsMigrationIds(shapeType,ids){return(0,dist_esm._H)(ids,((_k,v)=>`com.tldraw.shape.${shapeType}/${v}`))}function createShapeRecordType(shapes){return(0,store_dist_esm.WE)("shape",{scope:"document",validator:model("shape",union("type",(0,dist_esm._H)(shapes,((type,{props,meta})=>function createShapeValidator(type,props,meta){return object({id:shapeIdValidator,typeName:literal("shape"),x:number,y:number,rotation:number,index:indexKey,parentId:parentIdValidator,type:literal(type),isLocked:validation_boolean,opacity:opacityValidator,props:props?object(props):jsonValue,meta:meta?object(meta):jsonValue})}(type,props,meta)))))}).withDefaultProperties((()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}})))}function processPropsMigrations(typeName,records){const result=[];for(const[subType,{migrations}]of Object.entries(records)){const sequenceId=`com.tldraw.${typeName}.${subType}`;migrations?"sequenceId"in migrations?((0,dist_esm.vA)(sequenceId===migrations.sequenceId,`sequenceId mismatch for ${subType} ${store_dist_esm.ee} migrations. Expected '${sequenceId}', got '${migrations.sequenceId}'`),result.push(migrations)):"sequence"in migrations?result.push((0,store_dist_esm._B)({sequenceId,retroactive:!0,sequence:migrations.sequence.map((m=>"id"in m?createPropsMigration(typeName,subType,m):m))})):result.push((0,store_dist_esm._B)({sequenceId,retroactive:!0,sequence:Object.keys(migrations.migrators).map((k=>Number(k))).sort(((a,b)=>a-b)).map((version=>({id:`${sequenceId}/${version}`,scope:"record",filter:r=>r.typeName===typeName&&r.type===subType,up:record=>{const result2=migrations.migrators[version].up(record);if(result2)return result2},down:record=>{const result2=migrations.migrators[version].down(record);if(result2)return result2}})))})):result.push((0,store_dist_esm._B)({sequenceId,retroactive:!0,sequence:[]}))}return result}function createPropsMigration(typeName,subType,m){return{id:m.id,dependsOn:m.dependsOn,scope:"record",filter:r=>r.typeName===typeName&&r.type===subType,up:record=>{const result=m.up(record.props);result&&(record.props=result)},down:"function"==typeof m.down?record=>{const result=m.down(record.props);result&&(record.props=result)}:void 0}}const defaultColorNames=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],DefaultColorThemePalette={lightMode:{id:"light",text:"#000000",background:"#f9fafb",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",frame:{headingStroke:"#717171",headingFill:"#ffffff",stroke:"#717171",fill:"#ffffff",text:"#000000"},note:{fill:"#FCE19C",text:"#000000"},semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8205 0.05)"}},blue:{solid:"#4465e9",fill:"#4465e9",frame:{headingStroke:"#6681ec",headingFill:"#f9fafe",stroke:"#6681ec",fill:"#f9fafe",text:"#000000"},note:{fill:"#8AA3FF",text:"#000000"},semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",fill:"#099268",frame:{headingStroke:"#37a684",headingFill:"#f8fcfa",stroke:"#37a684",fill:"#f8fcfa",text:"#000000"},note:{fill:"#6FC896",text:"#000000"},semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#9fa8b2",fill:"#9fa8b2",frame:{headingStroke:"#aaaaab",headingFill:"#fbfcfc",stroke:"#aaaaab",fill:"#fcfcfd",text:"#000000"},note:{fill:"#C0CAD3",text:"#000000"},semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",frame:{headingStroke:"#6cb2f3",headingFill:"#f8fbfe",stroke:"#6cb2f3",fill:"#fafcff",text:"#000000"},note:{fill:"#9BC4FD",text:"#000000"},semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#4cb05e",fill:"#4cb05e",frame:{headingStroke:"#6dbe7c",headingFill:"#f8fcf9",stroke:"#6dbe7c",fill:"#fafdfa",text:"#000000"},note:{fill:"#98D08A",text:"#000000"},semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#f87777",fill:"#f87777",frame:{headingStroke:"#f89090",headingFill:"#fffafa",stroke:"#f89090",fill:"#fffbfb",text:"#000000"},note:{fill:"#F7A5A1",text:"#000000"},semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e085f4",fill:"#e085f4",frame:{headingStroke:"#e59bf5",headingFill:"#fefaff",stroke:"#e59bf5",fill:"#fefbff",text:"#000000"},note:{fill:"#DFB0F9",text:"#000000"},semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#e16919",fill:"#e16919",frame:{headingStroke:"#e68544",headingFill:"#fef9f6",stroke:"#e68544",fill:"#fef9f6",text:"#000000"},note:{fill:"#FAA475",text:"#000000"},semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",fill:"#e03131",frame:{headingStroke:"#e55757",headingFill:"#fef7f7",stroke:"#e55757",fill:"#fef9f9",text:"#000000"},note:{fill:"#FC8282",text:"#000000"},semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",frame:{headingStroke:"#bc62d3",headingFill:"#fcf7fd",stroke:"#bc62d3",fill:"#fdf9fd",text:"#000000"},note:{fill:"#DB91FD",text:"#000000"},semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",frame:{headingStroke:"#f3bb6c",headingFill:"#fefcf8",stroke:"#f3bb6c",fill:"#fffdfa",text:"#000000"},note:{fill:"#FED49A",text:"#000000"},semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},white:{solid:"#FFFFFF",fill:"#FFFFFF",semi:"#f5f5f5",pattern:"#f9f9f9",frame:{headingStroke:"#7d7d7d",headingFill:"#ffffff",stroke:"#7d7d7d",fill:"#ffffff",text:"#000000"},note:{fill:"#FFFFFF",text:"#000000"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",frame:{headingStroke:"#5c5c5c",headingFill:"#252525",stroke:"#5c5c5c",fill:"#0c0c0c",text:"#f2f2f2"},note:{fill:"#2c2c2c",text:"#f2f2f2"},semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.6225 0.0312)"}},blue:{solid:"#4f72fc",fill:"#4f72fc",frame:{headingStroke:"#384994",headingFill:"#1C2036",stroke:"#384994",fill:"#11141f",text:"#f2f2f2"},note:{fill:"#2A3F98",text:"#f2f2f2"},semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",fill:"#099268",frame:{headingStroke:"#10513C",headingFill:"#14241f",stroke:"#10513C",fill:"#0E1614",text:"#f2f2f2"},note:{fill:"#014429",text:"#f2f2f2"},semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",fill:"#9398b0",frame:{headingStroke:"#42474D",headingFill:"#23262A",stroke:"#42474D",fill:"#151719",text:"#f2f2f2"},note:{fill:"#56595F",text:"#f2f2f2"},semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",frame:{headingStroke:"#075797",headingFill:"#142839",stroke:"#075797",fill:"#0B1823",text:"#f2f2f2"},note:{fill:"#1F5495",text:"#f2f2f2"},semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",fill:"#40c057",frame:{headingStroke:"#1C5427",headingFill:"#18251A",stroke:"#1C5427",fill:"#0F1911",text:"#f2f2f2"},note:{fill:"#21581D",text:"#f2f2f2"},semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",fill:"#ff8787",frame:{headingStroke:"#6f3232",headingFill:"#341818",stroke:"#6f3232",fill:"#181212",text:"#f2f2f2"},note:{fill:"#7a3333",text:"#f2f2f2"},semi:"#3c2b2b",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",fill:"#e599f7",frame:{headingStroke:"#6c367a",headingFill:"#2D2230",stroke:"#6c367a",fill:"#1C151E",text:"#f2f2f2"},note:{fill:"#762F8E",text:"#f2f2f2"},semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",fill:"#f76707",frame:{headingStroke:"#773a0e",headingFill:"#2f1d13",stroke:"#773a0e",fill:"#1c1512",text:"#f2f2f2"},note:{fill:"#7c3905",text:"#f2f2f2"},semi:"#3b2e27",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",fill:"#e03131",frame:{headingStroke:"#701e1e",headingFill:"#301616",stroke:"#701e1e",fill:"#1b1313",text:"#f2f2f2"},note:{fill:"#7e201f",text:"#f2f2f2"},semi:"#382726",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",frame:{headingStroke:"#6d1583",headingFill:"#27152e",stroke:"#6d1583",fill:"#1b0f21",text:"#f2f2f2"},note:{fill:"#5f1c70",text:"#f2f2f2"},semi:"#342938",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",fill:"#ffc034",frame:{headingStroke:"#684e12",headingFill:"#2a2113",stroke:"#684e12",fill:"#1e1911",text:"#f2f2f2"},note:{fill:"#8a5e1c",text:"#f2f2f2"},semi:"#3b352b",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},white:{solid:"#f3f3f3",fill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",frame:{headingStroke:"#ffffff",headingFill:"#ffffff",stroke:"#ffffff",fill:"#ffffff",text:"#000000"},note:{fill:"#eaeaea",text:"#1d1d1d"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}}};function getDefaultColorTheme(opts){return opts.isDarkMode?DefaultColorThemePalette.darkMode:DefaultColorThemePalette.lightMode}const DefaultColorStyle=StyleProp.defineEnum("tldraw:color",{defaultValue:"black",values:defaultColorNames}),DefaultLabelColorStyle=StyleProp.defineEnum("tldraw:labelColor",{defaultValue:"black",values:defaultColorNames}),DefaultDashStyle=StyleProp.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),DefaultFillStyle=StyleProp.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]}),DefaultFontStyle=StyleProp.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),DefaultFontFamilies={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},DefaultSizeStyle=StyleProp.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),ArrowShapeKindStyle=StyleProp.defineEnum("tldraw:arrowKind",{defaultValue:"arc",values:["arc","elbow"]}),arrowheadTypes=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],ArrowShapeArrowheadStartStyle=StyleProp.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:arrowheadTypes}),ArrowShapeArrowheadEndStyle=StyleProp.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:arrowheadTypes}),arrowShapeProps={kind:ArrowShapeKindStyle,labelColor:DefaultLabelColorStyle,color:DefaultColorStyle,fill:DefaultFillStyle,dash:DefaultDashStyle,size:DefaultSizeStyle,arrowheadStart:ArrowShapeArrowheadStartStyle,arrowheadEnd:ArrowShapeArrowheadEndStyle,font:DefaultFontStyle,start:vecModelValidator,end:vecModelValidator,bend:number,text:string,labelPosition:number,scale:nonZeroNumber,elbowMidPoint:number},arrowShapeVersions=createShapePropsMigrationIds("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5,AddElbow:6});function propsMigration(migration){return createPropsMigration("shape","arrow",migration)}const arrowShapeMigrations=(0,store_dist_esm._B)({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[propsMigration({id:arrowShapeVersions.AddLabelColor,up:props=>{props.labelColor="black"},down:"retired"}),propsMigration({id:arrowShapeVersions.AddIsPrecise,up:({start,end})=>{"binding"===start.type&&(start.isPrecise=!(.5===start.normalizedAnchor.x&&.5===start.normalizedAnchor.y)),"binding"===end.type&&(end.isPrecise=!(.5===end.normalizedAnchor.x&&.5===end.normalizedAnchor.y))},down:({start,end})=>{"binding"===start.type&&(start.isPrecise||(start.normalizedAnchor={x:.5,y:.5}),delete start.isPrecise),"binding"===end.type&&(end.isPrecise||(end.normalizedAnchor={x:.5,y:.5}),delete end.isPrecise)}}),propsMigration({id:arrowShapeVersions.AddLabelPosition,up:props=>{props.labelPosition=.5},down:props=>{delete props.labelPosition}}),{id:arrowShapeVersions.ExtractBindings,scope:"store",up:oldStore=>{const arrows=Object.values(oldStore).filter((r=>"shape"===r.typeName&&"arrow"===r.type));for(const arrow of arrows){const{start,end}=arrow.props;if("binding"===start.type){const id=createBindingId(),binding={typeName:"binding",id,type:"arrow",fromId:arrow.id,toId:start.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:start.normalizedAnchor,isExact:start.isExact,isPrecise:start.isPrecise}};oldStore[id]=binding,arrow.props.start={x:0,y:0}}else delete arrow.props.start.type;if("binding"===end.type){const id=createBindingId(),binding={typeName:"binding",id,type:"arrow",fromId:arrow.id,toId:end.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:end.normalizedAnchor,isExact:end.isExact,isPrecise:end.isPrecise}};oldStore[id]=binding,arrow.props.end={x:0,y:0}}else delete arrow.props.end.type}}},propsMigration({id:arrowShapeVersions.AddScale,up:props=>{props.scale=1},down:props=>{delete props.scale}}),propsMigration({id:arrowShapeVersions.AddElbow,up:props=>{props.kind="arc",props.elbowMidPoint=.5},down:props=>{delete props.kind,delete props.elbowMidPoint}})]}),ElbowArrowSnap=literalEnum("center","edge-point","edge","none"),arrowBindingProps={terminal:literalEnum("start","end"),normalizedAnchor:vecModelValidator,isExact:validation_boolean,isPrecise:validation_boolean,snap:ElbowArrowSnap},arrowBindingVersions=function createBindingPropsMigrationIds(bindingType,ids){return(0,dist_esm._H)(ids,((_k,v)=>`com.tldraw.binding.${bindingType}/${v}`))}("arrow",{AddSnap:1}),arrowBindingMigrations={sequence:[{dependsOn:[arrowShapeVersions.ExtractBindings]},{id:arrowBindingVersions.AddSnap,up:props=>{props.snap="none"},down:props=>{delete props.snap}}]},cameraValidator=model("camera",object({typeName:literal("camera"),id:idValidator("camera"),x:number,y:number,z:number,meta:jsonValue})),cameraVersions=(0,store_dist_esm.bo)("com.tldraw.camera",{AddMeta:1}),cameraMigrations=(0,store_dist_esm.XD)({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:cameraVersions.AddMeta,up:record=>{record.meta={}}}]}),TLCamera_CameraRecordType=(0,store_dist_esm.WE)("camera",{validator:cameraValidator,scope:"session"}).withDefaultProperties((()=>({x:0,y:0,z:1,meta:{}}))),cursorTypeValidator=setEnum(new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"])),cursorValidator=object({type:cursorTypeValidator,rotation:number}),canvasUiColorTypeValidator=setEnum(new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"])),TL_SCRIBBLE_STATES=new Set(["starting","paused","active","stopping"]),scribbleValidator=object({id:string,points:arrayOf(vecModelValidator),size:positiveNumber,color:canvasUiColorTypeValidator,opacity:number,state:setEnum(TL_SCRIBBLE_STATES),delay:number,shrink:number,taper:validation_boolean}),pageIdValidator=idValidator("page"),pageValidator=model("page",object({typeName:literal("page"),id:pageIdValidator,name:string,index:indexKey,meta:jsonValue})),pageVersions=(0,store_dist_esm.bo)("com.tldraw.page",{AddMeta:1}),pageMigrations=(0,store_dist_esm.XD)({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:pageVersions.AddMeta,up:record=>{record.meta={}}}]}),PageRecordType=(0,store_dist_esm.WE)("page",{validator:pageValidator,scope:"document"}).withDefaultProperties((()=>({meta:{}})));function isPageId(id){return PageRecordType.isId(id)}const shouldKeyBePreservedBetweenSessions={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1};function pluckPreservingValues(val){return val?(0,dist_esm.J2)(val,(key=>shouldKeyBePreservedBetweenSessions[key])):null}idValidator("instance");const instanceVersions=(0,store_dist_esm.bo)("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),instanceMigrations=(0,store_dist_esm.XD)({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:instanceVersions.AddTransparentExportBgs,up:instance=>({...instance,exportBackground:!0})},{id:instanceVersions.RemoveDialog,up:({dialog:_,...instance})=>instance},{id:instanceVersions.AddToolLockMode,up:instance=>({...instance,isToolLocked:!1})},{id:instanceVersions.RemoveExtraPropsForNextShape,up:({propsForNextShape,...instance})=>({...instance,propsForNextShape:Object.fromEntries(Object.entries(propsForNextShape).filter((([key])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(key))))})},{id:instanceVersions.AddLabelColor,up:({propsForNextShape,...instance})=>({...instance,propsForNextShape:{...propsForNextShape,labelColor:"black"}})},{id:instanceVersions.AddFollowingUserId,up:instance=>({...instance,followingUserId:null})},{id:instanceVersions.RemoveAlignJustify,up:instance=>{let newAlign=instance.propsForNextShape.align;return"justify"===newAlign&&(newAlign="start"),{...instance,propsForNextShape:{...instance.propsForNextShape,align:newAlign}}}},{id:instanceVersions.AddZoom,up:instance=>({...instance,zoomBrush:null})},{id:instanceVersions.AddVerticalAlign,up:instance=>({...instance,propsForNextShape:{...instance.propsForNextShape,verticalAlign:"middle"}})},{id:instanceVersions.AddScribbleDelay,up:instance=>null!==instance.scribble?{...instance,scribble:{...instance.scribble,delay:0}}:{...instance}},{id:instanceVersions.RemoveUserId,up:({userId:_,...instance})=>instance},{id:instanceVersions.AddIsPenModeAndIsGridMode,up:instance=>({...instance,isPenMode:!1,isGridMode:!1})},{id:instanceVersions.HoistOpacity,up:({propsForNextShape:{opacity,...propsForNextShape},...instance})=>({...instance,opacityForNextShape:Number(opacity??"1"),propsForNextShape})},{id:instanceVersions.AddChat,up:instance=>({...instance,chatMessage:"",isChatting:!1})},{id:instanceVersions.AddHighlightedUserIds,up:instance=>({...instance,highlightedUserIds:[]})},{id:instanceVersions.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:_,...instance})=>({...instance,stylesForNextShape:{}})},{id:instanceVersions.AddMeta,up:record=>({...record,meta:{}})},{id:instanceVersions.RemoveCursorColor,up:record=>{const{color:_,...cursor}=record.cursor;return{...record,cursor}}},{id:instanceVersions.AddLonelyProperties,up:record=>({...record,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:instanceVersions.ReadOnlyReadonly,up:({isReadOnly:_isReadOnly,...record})=>({...record,isReadonly:_isReadOnly})},{id:instanceVersions.AddHoveringCanvas,up:record=>({...record,isHoveringCanvas:null})},{id:instanceVersions.AddScribbles,up:({scribble:_,...record})=>({...record,scribbles:[]})},{id:instanceVersions.AddInset,up:record=>({...record,insets:[!1,!1,!1,!1]}),down:({insets:_,...record})=>({...record})},{id:instanceVersions.AddDuplicateProps,up:record=>({...record,duplicateProps:null}),down:({duplicateProps:_,...record})=>({...record})},{id:instanceVersions.RemoveCanMoveCamera,up:({canMoveCamera:_,...record})=>({...record}),down:instance=>({...instance,canMoveCamera:!0})}]}),TLInstance_TLINSTANCE_ID="instance:instance",instancePageStateValidator=model("instance_page_state",object({typeName:literal("instance_page_state"),id:idValidator("instance_page_state"),pageId:pageIdValidator,selectedShapeIds:arrayOf(shapeIdValidator),hintingShapeIds:arrayOf(shapeIdValidator),erasingShapeIds:arrayOf(shapeIdValidator),hoveredShapeId:shapeIdValidator.nullable(),editingShapeId:shapeIdValidator.nullable(),croppingShapeId:shapeIdValidator.nullable(),focusedGroupId:shapeIdValidator.nullable(),meta:jsonValue})),instancePageStateVersions=(0,store_dist_esm.bo)("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),instancePageStateMigrations=(0,store_dist_esm.XD)({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:instancePageStateVersions.AddCroppingId,up(instance){instance.croppingShapeId=null}},{id:instancePageStateVersions.RemoveInstanceIdAndCameraId,up(instance){delete instance.instanceId,delete instance.cameraId}},{id:instancePageStateVersions.AddMeta,up:record=>{record.meta={}}},{id:instancePageStateVersions.RenameProperties,up:_record=>{},down:_record=>{}},{id:instancePageStateVersions.RenamePropertiesAgain,up:record=>{record.selectedShapeIds=record.selectedIds,delete record.selectedIds,record.hintingShapeIds=record.hintingIds,delete record.hintingIds,record.erasingShapeIds=record.erasingIds,delete record.erasingIds,record.hoveredShapeId=record.hoveredId,delete record.hoveredId,record.editingShapeId=record.editingId,delete record.editingId,record.croppingShapeId=record.croppingShapeId??record.croppingId??null,delete record.croppingId,record.focusedGroupId=record.focusLayerId,delete record.focusLayerId},down:record=>{record.selectedIds=record.selectedShapeIds,delete record.selectedShapeIds,record.hintingIds=record.hintingShapeIds,delete record.hintingShapeIds,record.erasingIds=record.erasingShapeIds,delete record.erasingShapeIds,record.hoveredId=record.hoveredShapeId,delete record.hoveredShapeId,record.editingId=record.editingShapeId,delete record.editingShapeId,record.croppingId=record.croppingShapeId,delete record.croppingShapeId,record.focusLayerId=record.focusedGroupId,delete record.focusedGroupId}}]}),TLPageState_InstancePageStateRecordType=(0,store_dist_esm.WE)("instance_page_state",{validator:instancePageStateValidator,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties((()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}}))),pointerValidator=model("pointer",object({typeName:literal("pointer"),id:idValidator("pointer"),x:number,y:number,lastActivityTimestamp:number,meta:jsonValue})),pointerVersions=(0,store_dist_esm.bo)("com.tldraw.pointer",{AddMeta:1}),pointerMigrations=(0,store_dist_esm.XD)({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:pointerVersions.AddMeta,up:record=>{record.meta={}}}]}),PointerRecordType=(0,store_dist_esm.WE)("pointer",{validator:pointerValidator,scope:"session"}).withDefaultProperties((()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}}))),TLPointer_TLPOINTER_ID=PointerRecordType.createId("pointer"),instancePresenceValidator=model("instance_presence",object({typeName:literal("instance_presence"),id:idValidator("instance_presence"),userId:string,userName:string,lastActivityTimestamp:number.nullable(),followingUserId:string.nullable(),cursor:object({x:number,y:number,type:cursorTypeValidator,rotation:number}).nullable(),color:string,camera:object({x:number,y:number,z:number}).nullable(),screenBounds:boxModelValidator.nullable(),selectedShapeIds:arrayOf(idValidator("shape")),currentPageId:idValidator("page"),brush:boxModelValidator.nullable(),scribbles:arrayOf(scribbleValidator),chatMessage:string,meta:jsonValue})),instancePresenceVersions=(0,store_dist_esm.bo)("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5,NullableCameraCursor:6}),instancePresenceMigrations=(0,store_dist_esm.XD)({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:instancePresenceVersions.AddScribbleDelay,up:instance=>{null!==instance.scribble&&(instance.scribble.delay=0)}},{id:instancePresenceVersions.RemoveInstanceId,up:instance=>{delete instance.instanceId}},{id:instancePresenceVersions.AddChatMessage,up:instance=>{instance.chatMessage=""}},{id:instancePresenceVersions.AddMeta,up:record=>{record.meta={}}},{id:instancePresenceVersions.RenameSelectedShapeIds,up:_record=>{}},{id:instancePresenceVersions.NullableCameraCursor,up:_record=>{},down:record=>{null===record.camera&&(record.camera={x:0,y:0,z:1}),null===record.lastActivityTimestamp&&(record.lastActivityTimestamp=0),null===record.cursor&&(record.cursor={type:"default",x:0,y:0,rotation:0}),null===record.screenBounds&&(record.screenBounds={x:0,y:0,w:1,h:1})}}]}),TLPresence_InstancePresenceRecordType=(0,store_dist_esm.WE)("instance_presence",{validator:instancePresenceValidator,scope:"presence"}).withDefaultProperties((()=>({lastActivityTimestamp:null,followingUserId:null,color:"#FF0000",camera:null,cursor:null,screenBounds:null,selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})));const documentValidator=model("document",object({typeName:literal("document"),id:literal("document:document"),gridSize:number,name:string,meta:jsonValue}));const documentVersions=(0,store_dist_esm.bo)("com.tldraw.document",{AddName:1,AddMeta:2}),documentMigrations=(0,store_dist_esm.XD)({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:documentVersions.AddName,up:document=>{document.name=""},down:document=>{delete document.name}},{id:documentVersions.AddMeta,up:record=>{record.meta={}}}]}),DocumentRecordType=(0,store_dist_esm.WE)("document",{validator:documentValidator,scope:"document"}).withDefaultProperties((()=>({gridSize:10,name:"",meta:{}}))),TLDOCUMENT_ID=DocumentRecordType.createId("document");function sortByIndex(a,b){return a.index<b.index?-1:a.index>b.index?1:0}function redactRecordForErrorReporting(record){"asset"===record.typeName&&("src"in record&&(record.src="<redacted>"),"src"in record.props&&(record.props.src="<redacted>"))}function onValidationFailure({error,phase,record,recordBefore}){const isExistingValidationIssue="initialize"===phase;throw(0,dist_esm.TF)(error,{tags:{origin:"store.validateRecord",storePhase:phase,isExistingValidationIssue},extras:{recordBefore:recordBefore?redactRecordForErrorReporting((0,dist_esm.pN)(recordBefore)):void 0,recordAfter:redactRecordForErrorReporting((0,dist_esm.pN)(record))}}),error}function createIntegrityChecker(store){const $pageIds=store.query.ids("page"),$pageStates=store.query.records("instance_page_state"),ensureStoreIsUsable=()=>{if(!store.has(TLDOCUMENT_ID))return store.put([DocumentRecordType.create({id:TLDOCUMENT_ID,name:store.props.defaultName})]),ensureStoreIsUsable();if(!store.has(TLPointer_TLPOINTER_ID))return store.put([PointerRecordType.create({id:TLPointer_TLPOINTER_ID})]),ensureStoreIsUsable();const pageIds=$pageIds.get();if(0===pageIds.size)return store.put(function getDefaultPages(){return[PageRecordType.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}()),ensureStoreIsUsable();const getFirstPageId=()=>[...pageIds].map((id=>store.get(id))).sort(sortByIndex)[0].id,instanceState=store.get(TLInstance_TLINSTANCE_ID);if(!instanceState)return store.put([store.schema.types.instance.create({id:TLInstance_TLINSTANCE_ID,currentPageId:getFirstPageId(),exportBackground:!0})]),ensureStoreIsUsable();if(!pageIds.has(instanceState.currentPageId))return store.put([{...instanceState,currentPageId:getFirstPageId()}]),ensureStoreIsUsable();const missingPageStateIds=new Set,missingCameraIds=new Set;for(const id of pageIds){const pageStateId=TLPageState_InstancePageStateRecordType.createId(id);store.get(pageStateId)||missingPageStateIds.add(pageStateId);const cameraId=TLCamera_CameraRecordType.createId(id);store.has(cameraId)||missingCameraIds.add(cameraId)}missingPageStateIds.size>0&&store.put([...missingPageStateIds].map((id=>TLPageState_InstancePageStateRecordType.create({id,pageId:TLPageState_InstancePageStateRecordType.parseId(id)})))),missingCameraIds.size>0&&store.put([...missingCameraIds].map((id=>TLCamera_CameraRecordType.create({id}))));const pageStates=$pageStates.get();for(const pageState of pageStates){if(!pageIds.has(pageState.pageId)){store.remove([pageState.id]);continue}if(pageState.croppingShapeId&&!store.has(pageState.croppingShapeId))return store.put([{...pageState,croppingShapeId:null}]),ensureStoreIsUsable();if(pageState.focusedGroupId&&!store.has(pageState.focusedGroupId))return store.put([{...pageState,focusedGroupId:null}]),ensureStoreIsUsable();if(pageState.hoveredShapeId&&!store.has(pageState.hoveredShapeId))return store.put([{...pageState,hoveredShapeId:null}]),ensureStoreIsUsable();const filteredSelectedIds=pageState.selectedShapeIds.filter((id=>store.has(id)));if(filteredSelectedIds.length!==pageState.selectedShapeIds.length)return store.put([{...pageState,selectedShapeIds:filteredSelectedIds}]),ensureStoreIsUsable();const filteredHintingIds=pageState.hintingShapeIds.filter((id=>store.has(id)));if(filteredHintingIds.length!==pageState.hintingShapeIds.length)return store.put([{...pageState,hintingShapeIds:filteredHintingIds}]),ensureStoreIsUsable();const filteredErasingIds=pageState.erasingShapeIds.filter((id=>store.has(id)));if(filteredErasingIds.length!==pageState.erasingShapeIds.length)return store.put([{...pageState,erasingShapeIds:filteredErasingIds}]),ensureStoreIsUsable()}};return ensureStoreIsUsable}const bookmarkAssetValidator=createAssetValidator("bookmark",object({title:string,description:string,image:string,favicon:string,src:srcUrl.nullable()})),Versions=(0,store_dist_esm.bo)("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),bookmarkAssetMigrations=(0,store_dist_esm.XD)({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:asset=>"bookmark"===asset.type,sequence:[{id:Versions.MakeUrlsValid,up:asset=>{srcUrl.isValid(asset.props.src)||(asset.props.src="")},down:_asset=>{}},{id:Versions.AddFavicon,up:asset=>{srcUrl.isValid(asset.props.favicon)||(asset.props.favicon="")},down:asset=>{delete asset.props.favicon}}]}),imageAssetValidator=createAssetValidator("image",object({w:number,h:number,name:string,isAnimated:validation_boolean,mimeType:string.nullable(),src:srcUrl.nullable(),fileSize:nonZeroNumber.optional()})),TLImageAsset_Versions=(0,store_dist_esm.bo)("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),imageAssetMigrations=(0,store_dist_esm.XD)({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:asset=>"image"===asset.type,sequence:[{id:TLImageAsset_Versions.AddIsAnimated,up:asset=>{asset.props.isAnimated=!1},down:asset=>{delete asset.props.isAnimated}},{id:TLImageAsset_Versions.RenameWidthHeight,up:asset=>{asset.props.w=asset.props.width,asset.props.h=asset.props.height,delete asset.props.width,delete asset.props.height},down:asset=>{asset.props.width=asset.props.w,asset.props.height=asset.props.h,delete asset.props.w,delete asset.props.h}},{id:TLImageAsset_Versions.MakeUrlsValid,up:asset=>{srcUrl.isValid(asset.props.src)||(asset.props.src="")},down:_asset=>{}},{id:TLImageAsset_Versions.AddFileSize,up:asset=>{asset.props.fileSize=-1},down:asset=>{delete asset.props.fileSize}},{id:TLImageAsset_Versions.MakeFileSizeOptional,up:asset=>{-1===asset.props.fileSize&&(asset.props.fileSize=void 0)},down:asset=>{void 0===asset.props.fileSize&&(asset.props.fileSize=-1)}}]}),videoAssetValidator=createAssetValidator("video",object({w:number,h:number,name:string,isAnimated:validation_boolean,mimeType:string.nullable(),src:srcUrl.nullable(),fileSize:number.optional()})),TLVideoAsset_Versions=(0,store_dist_esm.bo)("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),videoAssetMigrations=(0,store_dist_esm.XD)({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:asset=>"video"===asset.type,sequence:[{id:TLVideoAsset_Versions.AddIsAnimated,up:asset=>{asset.props.isAnimated=!1},down:asset=>{delete asset.props.isAnimated}},{id:TLVideoAsset_Versions.RenameWidthHeight,up:asset=>{asset.props.w=asset.props.width,asset.props.h=asset.props.height,delete asset.props.width,delete asset.props.height},down:asset=>{asset.props.width=asset.props.w,asset.props.height=asset.props.h,delete asset.props.w,delete asset.props.h}},{id:TLVideoAsset_Versions.MakeUrlsValid,up:asset=>{srcUrl.isValid(asset.props.src)||(asset.props.src="")},down:_asset=>{}},{id:TLVideoAsset_Versions.AddFileSize,up:asset=>{asset.props.fileSize=-1},down:asset=>{delete asset.props.fileSize}},{id:TLVideoAsset_Versions.MakeFileSizeOptional,up:asset=>{-1===asset.props.fileSize&&(asset.props.fileSize=void 0)},down:asset=>{void 0===asset.props.fileSize&&(asset.props.fileSize=-1)}}]}),assetValidator=model("asset",union("type",{image:imageAssetValidator,video:videoAssetValidator,bookmark:bookmarkAssetValidator})),assetVersions=(0,store_dist_esm.bo)("com.tldraw.asset",{AddMeta:1}),assetMigrations=(0,store_dist_esm.XD)({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:assetVersions.AddMeta,up:record=>{record.meta={}}}]}),AssetRecordType=(0,store_dist_esm.WE)("asset",{validator:assetValidator,scope:"document"}).withDefaultProperties((()=>({meta:{}}))),bookmarkShapeProps={w:nonZeroNumber,h:nonZeroNumber,assetId:assetIdValidator.nullable(),url:linkUrl},TLBookmarkShape_Versions=createShapePropsMigrationIds("bookmark",{NullAssetId:1,MakeUrlsValid:2}),bookmarkShapeMigrations={sequence:[{id:TLBookmarkShape_Versions.NullAssetId,up:props=>{void 0===props.assetId&&(props.assetId=null)},down:"retired"},{id:TLBookmarkShape_Versions.MakeUrlsValid,up:props=>{linkUrl.isValid(props.url)||(props.url="")},down:_props=>{}}]},DrawShapeSegment=object({type:literalEnum("free","straight"),points:arrayOf(vecModelValidator)}),drawShapeProps={color:DefaultColorStyle,fill:DefaultFillStyle,dash:DefaultDashStyle,size:DefaultSizeStyle,segments:arrayOf(DrawShapeSegment),isComplete:validation_boolean,isClosed:validation_boolean,isPen:validation_boolean,scale:nonZeroNumber},TLDrawShape_Versions=createShapePropsMigrationIds("draw",{AddInPen:1,AddScale:2}),drawShapeMigrations={sequence:[{id:TLDrawShape_Versions.AddInPen,up:props=>{const{points}=props.segments[0];if(0===points.length)return void(props.isPen=!1);let isPen=!(0===points[0].z||.5===points[0].z);points[1]&&(isPen=isPen&&!(0===points[1].z||.5===points[1].z)),props.isPen=isPen},down:"retired"},{id:TLDrawShape_Versions.AddScale,up:props=>{props.scale=1},down:props=>{delete props.scale}}]},TLDRAW_APP_RE=/(^\/r\/[^/]+\/?$)/,EMBED_DEFINITIONS=[{hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yC)(url);if(urlObj&&urlObj.pathname.match(TLDRAW_APP_RE))return url}},{hostnames:["figma.com"],fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yC)(url);if(urlObj&&urlObj.pathname.match(/^\/embed\/?$/)){const outUrl=urlObj.searchParams.get("url");if(outUrl)return outUrl}}},{hostnames:["google.*"],fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yC)(url);if(!urlObj)return;if(urlObj.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&urlObj.searchParams.has("center")&&urlObj.searchParams.get("zoom")){const zoom=urlObj.searchParams.get("zoom"),[lat,lon]=urlObj.searchParams.get("center").split(",");return`https://www.google.com/maps/@${lat},${lon},${zoom}z`}}},{hostnames:["val.town"],fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yC)(url),matches=urlObj&&urlObj.pathname.match(/\/embed\/(.+)\/?/);if(matches)return`https://www.val.town/v/${matches[1]}`}},{hostnames:["codesandbox.io"],fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yC)(url),matches=urlObj&&urlObj.pathname.match(/\/embed\/([^/]+)\/?/);if(matches)return`https://codesandbox.io/s/${matches[1]}`}},{hostnames:["codepen.io"],fromEmbedUrl:url=>{const matches=url.match(/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/);if(matches){const[_,user,id]=matches;return`https://codepen.io/${user}/pen/${id}`}}},{hostnames:["scratch.mit.edu"],fromEmbedUrl:url=>{const matches=url.match(/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/);if(matches){const[_,id]=matches;return`https://scratch.mit.edu/projects/${id}`}}},{hostnames:["*.youtube.com","youtube.com","youtu.be"],fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yC)(url);if(!urlObj)return;if("youtube.com"===urlObj.hostname.replace(/^www./,"")){const matches=urlObj.pathname.match(/^\/embed\/([^/]+)\/?/);if(matches)return`https://www.youtube.com/watch?v=${matches[1]}`}}},{hostnames:["calendar.google.*"],fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yC)(url),srcQs=urlObj?.searchParams.get("src");if(urlObj?.pathname.match(/\/calendar\/embed/)&&srcQs){urlObj.pathname="/calendar/u/0";const keys=Array.from(urlObj.searchParams.keys());for(const key of keys)urlObj.searchParams.delete(key);return urlObj.searchParams.set("cid",srcQs),urlObj.href}}},{hostnames:["docs.google.*"],fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yC)(url);if(urlObj?.pathname.match(/^\/presentation/)&&urlObj?.pathname.match(/\/embed\/?$/)){urlObj.pathname=urlObj.pathname.replace(/\/embed$/,"/pub");const keys=Array.from(urlObj.searchParams.keys());for(const key of keys)urlObj.searchParams.delete(key);return urlObj.href}}},{hostnames:["gist.github.com"],fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yC)(url);if(urlObj&&urlObj.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!url.split("/").pop())return;return url}}},{hostnames:["replit.com"],fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yC)(url);if(urlObj&&urlObj.pathname.match(/\/@([^/]+)\/([^/]+)/)&&urlObj.searchParams.has("embed"))return urlObj.searchParams.delete("embed"),urlObj.href}},{hostnames:["felt.com"],fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yC)(url);if(urlObj&&urlObj.pathname.match(/^\/embed\/map\//))return urlObj.pathname=urlObj.pathname.replace(/^\/embed/,""),urlObj.href}},{hostnames:["open.spotify.com"],fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yC)(url);if(urlObj&&urlObj.pathname.match(/^\/embed\/(artist|album)\//))return urlObj.origin+urlObj.pathname.replace(/^\/embed/,"")}},{hostnames:["vimeo.com","player.vimeo.com"],fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yC)(url);if(urlObj&&"player.vimeo.com"===urlObj.hostname){const matches=urlObj.pathname.match(/^\/video\/([^/]+)\/?$/);if(matches)return"https://vimeo.com/"+matches[1]}}},{hostnames:["excalidraw.com"],fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yC)(url);if(urlObj&&urlObj.hash.match(/#room=/))return url}},{hostnames:["observablehq.com"],fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yC)(url);return urlObj&&urlObj.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/)?`${urlObj.origin}${urlObj.pathname.replace("/embed","")}#cell-*`:urlObj&&urlObj.pathname.match(/^\/embed\/([^/]+)\/?$/)?`${urlObj.origin}${urlObj.pathname.replace("/embed","/d")}#cell-*`:void 0}},{hostnames:["desmos.com"],fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yC)(url);if(urlObj&&"www.desmos.com"===urlObj.hostname&&urlObj.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&"?embed"===urlObj.search&&""===urlObj.hash)return url.replace("?embed","")}}],embedShapeProps={w:nonZeroNumber,h:nonZeroNumber,url:string},TLEmbedShape_Versions=createShapePropsMigrationIds("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),embedShapeMigrations={sequence:[{id:TLEmbedShape_Versions.GenOriginalUrlInEmbed,up:props=>{try{const url=props.url,host=new URL(url).host.replace("www.","");let originalUrl;for(const localEmbedDef of EMBED_DEFINITIONS)if(localEmbedDef.hostnames.includes(host))try{originalUrl=localEmbedDef.fromEmbedUrl(url)}catch(err){console.warn(err)}props.tmpOldUrl=props.url,props.url=originalUrl??""}catch{props.url="",props.tmpOldUrl=props.url}},down:"retired"},{id:TLEmbedShape_Versions.RemoveDoesResize,up:props=>{delete props.doesResize},down:"retired"},{id:TLEmbedShape_Versions.RemoveTmpOldUrl,up:props=>{delete props.tmpOldUrl},down:"retired"},{id:TLEmbedShape_Versions.RemovePermissionOverrides,up:props=>{delete props.overridePermissions},down:"retired"}]},frameShapeProps={w:nonZeroNumber,h:nonZeroNumber,name:string,color:literalEnum(...DefaultColorStyle.values)},frameShapeMigrations={sequence:[{id:createShapePropsMigrationIds("frame",{AddColorProp:1}).AddColorProp,up:props=>{props.color="black"},down:props=>{delete props.color}}]},richTextValidator=object({type:string,content:arrayOf(unknown)});function toRichText(text){return{type:"doc",content:text.split("\n").map((text2=>text2?{type:"paragraph",content:[{type:"text",text:text2}]}:{type:"paragraph"}))}}const DefaultHorizontalAlignStyle=StyleProp.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),DefaultVerticalAlignStyle=StyleProp.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),GeoShapeGeoStyle=StyleProp.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),geoShapeProps={geo:GeoShapeGeoStyle,labelColor:DefaultLabelColorStyle,color:DefaultColorStyle,fill:DefaultFillStyle,dash:DefaultDashStyle,size:DefaultSizeStyle,font:DefaultFontStyle,align:DefaultHorizontalAlignStyle,verticalAlign:DefaultVerticalAlignStyle,url:linkUrl,w:nonZeroNumber,h:nonZeroNumber,growY:positiveNumber,richText:richTextValidator,scale:nonZeroNumber},geoShapeVersions=createShapePropsMigrationIds("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9,AddRichText:10}),geoShapeMigrations={sequence:[{id:geoShapeVersions.AddUrlProp,up:props=>{props.url=""},down:"retired"},{id:geoShapeVersions.AddLabelColor,up:props=>{props.labelColor="black"},down:"retired"},{id:geoShapeVersions.RemoveJustify,up:props=>{"justify"===props.align&&(props.align="start")},down:"retired"},{id:geoShapeVersions.AddCheckBox,up:_props=>{},down:"retired"},{id:geoShapeVersions.AddVerticalAlign,up:props=>{props.verticalAlign="middle"},down:"retired"},{id:geoShapeVersions.MigrateLegacyAlign,up:props=>{let newAlign;switch(props.align){case"start":newAlign="start-legacy";break;case"end":newAlign="end-legacy";break;default:newAlign="middle-legacy"}props.align=newAlign},down:"retired"},{id:geoShapeVersions.AddCloud,up:_props=>{},down:"retired"},{id:geoShapeVersions.MakeUrlsValid,up:props=>{linkUrl.isValid(props.url)||(props.url="")},down:_props=>{}},{id:geoShapeVersions.AddScale,up:props=>{props.scale=1},down:props=>{delete props.scale}},{id:geoShapeVersions.AddRichText,up:props=>{props.richText=toRichText(props.text),delete props.text}}]},groupShapeProps={},groupShapeMigrations={sequence:[]},highlightShapeProps={color:DefaultColorStyle,size:DefaultSizeStyle,segments:arrayOf(DrawShapeSegment),isComplete:validation_boolean,isPen:validation_boolean,scale:nonZeroNumber},highlightShapeMigrations={sequence:[{id:createShapePropsMigrationIds("highlight",{AddScale:1}).AddScale,up:props=>{props.scale=1},down:props=>{delete props.scale}}]},ImageShapeCrop=object({topLeft:vecModelValidator,bottomRight:vecModelValidator}),imageShapeProps={w:nonZeroNumber,h:nonZeroNumber,playing:validation_boolean,url:linkUrl,assetId:assetIdValidator.nullable(),crop:ImageShapeCrop.nullable(),flipX:validation_boolean,flipY:validation_boolean,altText:string},TLImageShape_Versions=createShapePropsMigrationIds("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4,AddAltText:5}),imageShapeMigrations={sequence:[{id:TLImageShape_Versions.AddUrlProp,up:props=>{props.url=""},down:"retired"},{id:TLImageShape_Versions.AddCropProp,up:props=>{props.crop=null},down:props=>{delete props.crop}},{id:TLImageShape_Versions.MakeUrlsValid,up:props=>{linkUrl.isValid(props.url)||(props.url="")},down:_props=>{}},{id:TLImageShape_Versions.AddFlipProps,up:props=>{props.flipX=!1,props.flipY=!1},down:props=>{delete props.flipX,delete props.flipY}},{id:TLImageShape_Versions.AddAltText,up:props=>{props.altText=""},down:props=>{delete props.altText}}]},LineShapeSplineStyle=StyleProp.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),lineShapePointValidator=object({id:string,index:indexKey,x:number,y:number}),lineShapeProps={color:DefaultColorStyle,dash:DefaultDashStyle,size:DefaultSizeStyle,spline:LineShapeSplineStyle,points:dict(string,lineShapePointValidator),scale:nonZeroNumber},lineShapeVersions=createShapePropsMigrationIds("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),lineShapeMigrations={sequence:[{id:lineShapeVersions.AddSnapHandles,up:props=>{for(const handle of Object.values(props.handles))handle.canSnap=!0},down:"retired"},{id:lineShapeVersions.RemoveExtraHandleProps,up:props=>{props.handles=(0,dist_esm._e)(Object.values(props.handles).map((handle=>[handle.index,{x:handle.x,y:handle.y}])))},down:props=>{const handles=Object.entries(props.handles).map((([index,handle])=>({index,...handle}))).sort(dist_esm.Ky);props.handles=Object.fromEntries(handles.map(((handle,i)=>{const id=0===i?"start":i===handles.length-1?"end":`handle:${handle.index}`;return[id,{id,type:"vertex",canBind:!1,canSnap:!0,index:handle.index,x:handle.x,y:handle.y}]})))}},{id:lineShapeVersions.HandlesToPoints,up:props=>{const sortedHandles=Object.entries(props.handles).map((([index,{x,y}])=>({x,y,index}))).sort(dist_esm.Ky);props.points=sortedHandles.map((({x,y})=>({x,y}))),delete props.handles},down:props=>{const indices=(0,dist_esm.uu)(props.points.length);props.handles=Object.fromEntries(props.points.map(((handle,i)=>[indices[i],{x:handle.x,y:handle.y}]))),delete props.points}},{id:lineShapeVersions.PointIndexIds,up:props=>{const indices=(0,dist_esm.uu)(props.points.length);props.points=Object.fromEntries(props.points.map(((point,i)=>{const id=indices[i];return[id,{id,index:id,x:point.x,y:point.y}]})))},down:props=>{const sortedHandles=Object.values(props.points).sort(dist_esm.Ky);props.points=sortedHandles.map((({x,y})=>({x,y})))}},{id:lineShapeVersions.AddScale,up:props=>{props.scale=1},down:props=>{delete props.scale}}]},noteShapeProps={color:DefaultColorStyle,labelColor:DefaultLabelColorStyle,size:DefaultSizeStyle,font:DefaultFontStyle,fontSizeAdjustment:positiveNumber,align:DefaultHorizontalAlignStyle,verticalAlign:DefaultVerticalAlignStyle,growY:positiveNumber,url:linkUrl,richText:richTextValidator,scale:nonZeroNumber},TLNoteShape_Versions=createShapePropsMigrationIds("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7,AddLabelColor:8,AddRichText:9}),noteShapeMigrations={sequence:[{id:TLNoteShape_Versions.AddUrlProp,up:props=>{props.url=""},down:"retired"},{id:TLNoteShape_Versions.RemoveJustify,up:props=>{"justify"===props.align&&(props.align="start")},down:"retired"},{id:TLNoteShape_Versions.MigrateLegacyAlign,up:props=>{switch(props.align){case"start":return void(props.align="start-legacy");case"end":return void(props.align="end-legacy");default:return void(props.align="middle-legacy")}},down:"retired"},{id:TLNoteShape_Versions.AddVerticalAlign,up:props=>{props.verticalAlign="middle"},down:"retired"},{id:TLNoteShape_Versions.MakeUrlsValid,up:props=>{linkUrl.isValid(props.url)||(props.url="")},down:_props=>{}},{id:TLNoteShape_Versions.AddFontSizeAdjustment,up:props=>{props.fontSizeAdjustment=0},down:props=>{delete props.fontSizeAdjustment}},{id:TLNoteShape_Versions.AddScale,up:props=>{props.scale=1},down:props=>{delete props.scale}},{id:TLNoteShape_Versions.AddLabelColor,up:props=>{props.labelColor="black"},down:props=>{delete props.labelColor}},{id:TLNoteShape_Versions.AddRichText,up:props=>{props.richText=toRichText(props.text),delete props.text}}]},DefaultTextAlignStyle=StyleProp.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),textShapeProps={color:DefaultColorStyle,size:DefaultSizeStyle,font:DefaultFontStyle,textAlign:DefaultTextAlignStyle,w:nonZeroNumber,richText:richTextValidator,scale:nonZeroNumber,autoSize:validation_boolean},TLTextShape_Versions=createShapePropsMigrationIds("text",{RemoveJustify:1,AddTextAlign:2,AddRichText:3}),textShapeMigrations={sequence:[{id:TLTextShape_Versions.RemoveJustify,up:props=>{"justify"===props.align&&(props.align="start")},down:"retired"},{id:TLTextShape_Versions.AddTextAlign,up:props=>{props.textAlign=props.align,delete props.align},down:props=>{props.align=props.textAlign,delete props.textAlign}},{id:TLTextShape_Versions.AddRichText,up:props=>{props.richText=toRichText(props.text),delete props.text}}]},videoShapeProps={w:nonZeroNumber,h:nonZeroNumber,time:number,playing:validation_boolean,url:linkUrl,assetId:assetIdValidator.nullable(),altText:string},TLVideoShape_Versions=createShapePropsMigrationIds("video",{AddUrlProp:1,MakeUrlsValid:2,AddAltText:3}),videoShapeMigrations={sequence:[{id:TLVideoShape_Versions.AddUrlProp,up:props=>{props.url=""},down:"retired"},{id:TLVideoShape_Versions.MakeUrlsValid,up:props=>{linkUrl.isValid(props.url)||(props.url="")},down:_props=>{}},{id:TLVideoShape_Versions.AddAltText,up:props=>{props.altText=""},down:props=>{delete props.altText}}]},store_migrations_Versions=(0,store_dist_esm.bo)("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4}),storeMigrations=(0,store_dist_esm._B)({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:store_migrations_Versions.RemoveCodeAndIconShapeTypes,scope:"store",up:store=>{for(const[id,record]of(0,dist_esm.iA)(store))"shape"!==record.typeName||"icon"!==record.type&&"code"!==record.type||delete store[id]}},{id:store_migrations_Versions.AddInstancePresenceType,scope:"store",up(_store){}},{id:store_migrations_Versions.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:store=>{for(const[id,record]of(0,dist_esm.iA)(store))record.typeName.match(/^(user|user_presence)$/)&&delete store[id]}},{id:store_migrations_Versions.RemoveUserDocument,scope:"store",up:store=>{for(const[id,record]of(0,dist_esm.iA)(store))record.typeName.match("user_document")&&delete store[id]}}]}),defaultShapeSchemas={arrow:{migrations:arrowShapeMigrations,props:arrowShapeProps},bookmark:{migrations:bookmarkShapeMigrations,props:bookmarkShapeProps},draw:{migrations:drawShapeMigrations,props:drawShapeProps},embed:{migrations:embedShapeMigrations,props:embedShapeProps},frame:{migrations:frameShapeMigrations,props:frameShapeProps},geo:{migrations:geoShapeMigrations,props:geoShapeProps},group:{migrations:groupShapeMigrations,props:groupShapeProps},highlight:{migrations:highlightShapeMigrations,props:highlightShapeProps},image:{migrations:imageShapeMigrations,props:imageShapeProps},line:{migrations:lineShapeMigrations,props:lineShapeProps},note:{migrations:noteShapeMigrations,props:noteShapeProps},text:{migrations:textShapeMigrations,props:textShapeProps},video:{migrations:videoShapeMigrations,props:videoShapeProps}},defaultBindingSchemas={arrow:{migrations:arrowBindingMigrations,props:arrowBindingProps}};function createTLSchema({shapes=defaultShapeSchemas,bindings=defaultBindingSchemas,migrations}={}){const stylesById=new Map;for(const shape of(0,dist_esm.Ic)(shapes))for(const style of getShapePropKeysByStyle(shape.props??{}).keys()){if(stylesById.has(style.id)&&stylesById.get(style.id)!==style)throw new Error(`Multiple StyleProp instances with the same id: ${style.id}`);stylesById.set(style.id,style)}const ShapeRecordType=createShapeRecordType(shapes),BindingRecordType=createBindingRecordType(bindings),InstanceRecordType=function createInstanceRecordType(stylesById){const stylesForNextShapeValidators={};for(const[id,style]of stylesById)stylesForNextShapeValidators[id]=optional(style);const instanceTypeValidator=model("instance",object({typeName:literal("instance"),id:idValidator("instance"),currentPageId:pageIdValidator,followingUserId:string.nullable(),brush:boxModelValidator.nullable(),opacityForNextShape:opacityValidator,stylesForNextShape:object(stylesForNextShapeValidators),cursor:cursorValidator,scribbles:arrayOf(scribbleValidator),isFocusMode:validation_boolean,isDebugMode:validation_boolean,isToolLocked:validation_boolean,exportBackground:validation_boolean,screenBounds:boxModelValidator,insets:arrayOf(validation_boolean),zoomBrush:boxModelValidator.nullable(),isPenMode:validation_boolean,isGridMode:validation_boolean,chatMessage:string,isChatting:validation_boolean,highlightedUserIds:arrayOf(string),isFocused:validation_boolean,devicePixelRatio:number,isCoarsePointer:validation_boolean,isHoveringCanvas:validation_boolean.nullable(),openMenus:arrayOf(string),isChangingStyle:validation_boolean,isReadonly:validation_boolean,meta:jsonValue,duplicateProps:object({shapeIds:arrayOf(idValidator("shape")),offset:object({x:number,y:number})}).nullable()}));return(0,store_dist_esm.WE)("instance",{validator:instanceTypeValidator,scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties((()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:"undefined"==typeof window?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null})))}(stylesById);return store_dist_esm.fX.create({asset:AssetRecordType,binding:BindingRecordType,camera:TLCamera_CameraRecordType,document:DocumentRecordType,instance:InstanceRecordType,instance_page_state:TLPageState_InstancePageStateRecordType,page:PageRecordType,instance_presence:TLPresence_InstancePresenceRecordType,pointer:PointerRecordType,shape:ShapeRecordType},{migrations:[storeMigrations,assetMigrations,cameraMigrations,documentMigrations,instanceMigrations,instancePageStateMigrations,pageMigrations,instancePresenceMigrations,pointerMigrations,rootShapeMigrations,bookmarkAssetMigrations,imageAssetMigrations,videoAssetMigrations,...processPropsMigrations("shape",shapes),...processPropsMigrations("binding",bindings),...migrations??[]],onValidationFailure,createIntegrityChecker})}const LANGUAGES=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ms",label:"Bahasa Melayu"},{locale:"ca",label:"CatalÃ "},{locale:"cs",label:"ÄeÅ¡tina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"EspaÃ±ol"},{locale:"tl",label:"Filipino"},{locale:"fr",label:"FranÃ§ais"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"nl",label:"Nederlands"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"PortuguÃªs - Brasil"},{locale:"pt-pt",label:"PortuguÃªs - Europeu"},{locale:"ro",label:"RomÃ¢nÄ"},{locale:"sl",label:"SlovenÅ¡Äina"},{locale:"so",label:"Somali"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Tiáº¿ng Viá»t"},{locale:"tr",label:"TÃ¼rkÃ§e"},{locale:"el",label:"ÎÎ»Î»Î·Î½Î¹ÎºÎ¬"},{locale:"ru",label:"Ð ÑÑÑÐºÐ¸Ð¹"},{locale:"uk",label:"Ð£ÐºÑÐ°ÑÐ½ÑÑÐºÐ°"},{locale:"he",label:"×¢××¨××ª"},{locale:"ur",label:"Ø§Ø±Ø¯Ù"},{locale:"ar",label:"Ø¹Ø±Ø¨Ù"},{locale:"fa",label:"ÙØ§Ø±Ø³Û"},{locale:"ne",label:"à¤¨à¥à¤ªà¤¾à¤²à¥"},{locale:"mr",label:"à¤®à¤°à¤¾à¤ à¥"},{locale:"hi-in",label:"à¤¹à¤¿à¤¨à¥à¤¦à¥"},{locale:"bn",label:"à¦¬à¦¾à¦à¦²à¦¾"},{locale:"pa",label:"à¨ªà©°à¨à¨¾à¨¬à©"},{locale:"gu-in",label:"àªà«àªàª°àª¾àª¤à«"},{locale:"ta",label:"à®¤à®®à®¿à®´à¯"},{locale:"te",label:"à°¤à±à°²à±à°à±"},{locale:"kn",label:"à²à²¨à³à²¨à²¡"},{locale:"ml",label:"à´®à´²à´¯à´¾à´³à´"},{locale:"th",label:"à¸ à¸²à¸©à¸²à¹à¸à¸¢"},{locale:"km-kh",label:"áá¶áá¶ááááá"},{locale:"ko-kr",label:"íêµ­ì´"},{locale:"ja",label:"æ¥æ¬èª"},{locale:"zh-cn",label:"ç®ä½ä¸­æ"},{locale:"zh-tw",label:"ç¹é«ä¸­æ (å°ç£)"}];const DEFAULT_LOCALE_REGIONS={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function getSupportedLocale(locale){const exactMatch=LANGUAGES.find((t=>t.locale===locale.toLowerCase()));if(exactMatch)return exactMatch.locale;const[language,region]=locale.split(/[-_]/).map((s=>s.toLowerCase()));if(region){const languageMatch=LANGUAGES.find((t=>t.locale===language));if(languageMatch)return languageMatch.locale}return language in DEFAULT_LOCALE_REGIONS?DEFAULT_LOCALE_REGIONS[language]:null}(0,dist_esm.lF)("@tldraw/tlschema","3.13.1","esm");var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames);const version="3.13.1",publishDates_major="2024-09-13T14:36:29.063Z",publishDates_minor="2025-05-22T13:38:59.946Z",initialState={error:null};class ErrorBoundary extends react.Component{static getDerivedStateFromError(error){return{error}}state=initialState;componentDidCatch(error){this.props.onError?.(error)}render(){const{error}=this.state;if(null!==error){const{fallback:Fallback}=this.props;return(0,jsx_runtime.jsx)(Fallback,{error})}return this.props.children}}function OptionalErrorBoundary({children,fallback,...props}){return null===fallback?children:(0,jsx_runtime.jsx)(ErrorBoundary,{fallback,...props,children})}function suffixSafeId(id,suffix){return sanitizeId(`${id}_${suffix}`)}function useUniqueSafeId(suffix){return sanitizeId(`${(0,react.useId)()}${suffix??""}`)}function useSharedSafeId(id){return sanitizeId(`${(0,dist_esm.Z1)((0,react.useContext)(IdContext))}_${id}`)}function sanitizeId(id){return id.replace(/:/g,"_")}const IdContext=(0,react.createContext)(null);function IdProvider({children}){const id=useUniqueSafeId();return(0,jsx_runtime.jsx)(IdContext.Provider,{value:id,children})}const EditorContext=(0,react.createContext)(null);function useEditor_useEditor(){const editor=react.useContext(EditorContext);if(!editor)throw new Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return editor}function useMaybeEditor(){return react.useContext(EditorContext)}function EditorProvider({editor,children}){return(0,jsx_runtime.jsx)(EditorContext.Provider,{value:editor,children:(0,jsx_runtime.jsx)(IdProvider,{children})})}function DefaultBackground(){return(0,jsx_runtime.jsx)("div",{className:"tl-background"})}function useTransform_useTransform(ref,x,y,scale,rotate,additionalOffset){(0,react.useLayoutEffect)((()=>{const elm=ref.current;if(!elm)return;if(void 0===x)return;let trans=`translate(${x}px, ${y}px)`;void 0!==scale&&(trans+=` scale(${scale})`),void 0!==rotate&&(trans+=` rotate(${rotate}rad)`),additionalOffset&&(trans+=` translate(${additionalOffset.x}px, ${additionalOffset.y}px)`),elm.style.transform=trans}))}const EASINGS={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>t*(2-t),easeInOutQuad:t=>t<.5?2*t*t:(4-2*t)*t-1,easeInCubic:t=>t*t*t,easeOutCubic:t=>--t*t*t+1,easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1- --t*t*t*t,easeInOutQuart:t=>t<.5?8*t*t*t*t:1-8*--t*t*t*t,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1+--t*t*t*t*t,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInExpo:t=>t<=0?0:Math.pow(2,10*t-10),easeOutExpo:t=>t>=1?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>t<=0?0:t>=1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2};class Vec{constructor(x=0,y=0,z=1){this.x=x,this.y=y,this.z=z}get pressure(){return this.z}set(x=this.x,y=this.y,z=this.z){return this.x=x,this.y=y,this.z=z,this}setTo({x=0,y=0,z=1}){return this.x=x,this.y=y,this.z=z,this}rot(r){if(0===r)return this;const{x,y}=this,s=Math.sin(r),c=Math.cos(r);return this.x=x*c-y*s,this.y=x*s+y*c,this}rotWith(C,r){if(0===r)return this;const x=this.x-C.x,y=this.y-C.y,s=Math.sin(r),c=Math.cos(r);return this.x=C.x+(x*c-y*s),this.y=C.y+(x*s+y*c),this}clone(){const{x,y,z}=this;return new Vec(x,y,z)}sub(V){return this.x-=V.x,this.y-=V.y,this}subXY(x,y){return this.x-=x,this.y-=y,this}subScalar(n){return this.x-=n,this.y-=n,this}add(V){return this.x+=V.x,this.y+=V.y,this}addXY(x,y){return this.x+=x,this.y+=y,this}addScalar(n){return this.x+=n,this.y+=n,this}clamp(min,max){return this.x=Math.max(this.x,min),this.y=Math.max(this.y,min),void 0!==max&&(this.x=Math.min(this.x,max),this.y=Math.min(this.y,max)),this}div(t){return this.x/=t,this.y/=t,this}divV(V){return this.x/=V.x,this.y/=V.y,this}mul(t){return this.x*=t,this.y*=t,this}mulV(V){return this.x*=V.x,this.y*=V.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(B,distance){const tan=Vec.Tan(B,this);return this.add(tan.mul(distance))}neg(){return this.x*=-1,this.y*=-1,this}cross(V){return this.x=this.y*V.z-this.z*V.y,this.y=this.z*V.x-this.x*V.z,this}dpr(V){return Vec.Dpr(this,V)}cpr(V){return Vec.Cpr(this,V)}len2(){return Vec.Len2(this)}len(){return Vec.Len(this)}pry(V){return Vec.Pry(this,V)}per(){const{x,y}=this;return this.x=y,this.y=-x,this}uni(){return Vec.Uni(this)}tan(V){return Vec.Tan(this,V)}dist(V){return Vec.Dist(this,V)}distanceToLineSegment(A,B){return Vec.DistanceToLineSegment(A,B,this)}slope(B){return Vec.Slope(this,B)}snapToGrid(gridSize){return this.x=Math.round(this.x/gridSize)*gridSize,this.y=Math.round(this.y/gridSize)*gridSize,this}angle(B){return Vec.Angle(this,B)}toAngle(){return Vec.ToAngle(this)}lrp(B,t){return this.x=this.x+(B.x-this.x)*t,this.y=this.y+(B.y-this.y)*t,this}equals(B){return Vec.Equals(this,B)}equalsXY(x,y){return Vec.EqualsXY(this,x,y)}norm(){const l=this.len();return this.x=0===l?0:this.x/l,this.y=0===l?0:this.y/l,this}toFixed(){return Vec.ToFixed(this)}toString(){return Vec.ToString(Vec.ToFixed(this))}toJson(){return Vec.ToJson(this)}toArray(){return Vec.ToArray(this)}static Add(A,B){return new Vec(A.x+B.x,A.y+B.y)}static AddXY(A,x,y){return new Vec(A.x+x,A.y+y)}static Sub(A,B){return new Vec(A.x-B.x,A.y-B.y)}static SubXY(A,x,y){return new Vec(A.x-x,A.y-y)}static AddScalar(A,n){return new Vec(A.x+n,A.y+n)}static SubScalar(A,n){return new Vec(A.x-n,A.y-n)}static Div(A,t){return new Vec(A.x/t,A.y/t)}static Mul(A,t){return new Vec(A.x*t,A.y*t)}static DivV(A,B){return new Vec(A.x/B.x,A.y/B.y)}static MulV(A,B){return new Vec(A.x*B.x,A.y*B.y)}static Neg(A){return new Vec(-A.x,-A.y)}static Per(A){return new Vec(A.y,-A.x)}static Abs(A){return new Vec(Math.abs(A.x),Math.abs(A.y))}static Dist(A,B){return((A.y-B.y)**2+(A.x-B.x)**2)**.5}static ManhattanDist(A,B){return Math.abs(A.x-B.x)+Math.abs(A.y-B.y)}static DistMin(A,B,n){return(A.x-B.x)*(A.x-B.x)+(A.y-B.y)*(A.y-B.y)<n**2}static Dist2(A,B){return(A.x-B.x)*(A.x-B.x)+(A.y-B.y)*(A.y-B.y)}static Dpr(A,B){return A.x*B.x+A.y*B.y}static Cross(A,V){return new Vec(A.y*V.z-A.z*V.y,A.z*V.x-A.x*V.z)}static Cpr(A,B){return A.x*B.y-B.x*A.y}static Len2(A){return A.x*A.x+A.y*A.y}static Len(A){return(A.x*A.x+A.y*A.y)**.5}static Pry(A,B){return Vec.Dpr(A,B)/Vec.Len(B)}static Uni(A){return Vec.Div(A,Vec.Len(A))}static Tan(A,B){return Vec.Uni(Vec.Sub(A,B))}static Min(A,B){return new Vec(Math.min(A.x,B.x),Math.min(A.y,B.y))}static Max(A,B){return new Vec(Math.max(A.x,B.x),Math.max(A.y,B.y))}static From({x,y,z=1}){return new Vec(x,y,z)}static FromArray(v){return new Vec(v[0],v[1])}static Rot(A,r=0){const s=Math.sin(r),c=Math.cos(r);return new Vec(A.x*c-A.y*s,A.x*s+A.y*c)}static RotWith(A,C,r){const x=A.x-C.x,y=A.y-C.y,s=Math.sin(r),c=Math.cos(r);return new Vec(C.x+(x*c-y*s),C.y+(x*s+y*c))}static NearestPointOnLineThroughPoint(A,u,P){return Vec.Mul(u,Vec.Sub(P,A).pry(u)).add(A)}static NearestPointOnLineSegment(A,B,P,clamp=!0){if(Vec.Equals(A,P))return Vec.From(P);if(Vec.Equals(B,P))return Vec.From(P);const u=Vec.Tan(B,A),C=Vec.Add(A,Vec.Mul(u,Vec.Sub(P,A).pry(u)));if(clamp){if(C.x<Math.min(A.x,B.x))return Vec.Cast(A.x<B.x?A:B);if(C.x>Math.max(A.x,B.x))return Vec.Cast(A.x>B.x?A:B);if(C.y<Math.min(A.y,B.y))return Vec.Cast(A.y<B.y?A:B);if(C.y>Math.max(A.y,B.y))return Vec.Cast(A.y>B.y?A:B)}return C}static DistanceToLineThroughPoint(A,u,P){return Vec.Dist(P,Vec.NearestPointOnLineThroughPoint(A,u,P))}static DistanceToLineSegment(A,B,P,clamp=!0){return Vec.Dist(P,Vec.NearestPointOnLineSegment(A,B,P,clamp))}static Snap(A,step=1){return new Vec(Math.round(A.x/step)*step,Math.round(A.y/step)*step)}static Cast(A){return A instanceof Vec?A:Vec.From(A)}static Slope(A,B){return A.x===B.y?NaN:(A.y-B.y)/(A.x-B.x)}static IsNaN(A){return isNaN(A.x)||isNaN(A.y)}static Angle(A,B){return Math.atan2(B.y-A.y,B.x-A.x)}static AngleBetween(A,B){const p=A.x*B.x+A.y*B.y,n=Math.sqrt((Math.pow(A.x,2)+Math.pow(A.y,2))*(Math.pow(B.x,2)+Math.pow(B.y,2)));return(A.x*B.y-A.y*B.x<0?-1:1)*Math.acos(p/n)}static Lrp(A,B,t){return Vec.Sub(B,A).mul(t).add(A)}static Med(A,B){return new Vec((A.x+B.x)/2,(A.y+B.y)/2)}static Equals(A,B){return Math.abs(A.x-B.x)<1e-4&&Math.abs(A.y-B.y)<1e-4}static EqualsXY(A,x,y){return A.x===x&&A.y===y}static Clockwise(A,B,C){return(C.x-A.x)*(B.y-A.y)-(B.x-A.x)*(C.y-A.y)<0}static Rescale(A,n){const l=Vec.Len(A);return new Vec(n*A.x/l,n*A.y/l)}static ScaleWithOrigin(A,scale,origin){return Vec.Sub(A,origin).mul(scale).add(origin)}static ToFixed(A){return new Vec(toFixed(A.x),toFixed(A.y))}static ToInt(A){return new Vec(parseInt(A.x.toFixed(0)),parseInt(A.y.toFixed(0)),parseInt((A.z??0).toFixed(0)))}static ToCss(A){return`${A.x},${A.y}`}static Nudge(A,B,distance){return Vec.Add(A,Vec.Tan(B,A).mul(distance))}static ToString(A){return`${A.x}, ${A.y}`}static ToAngle(A){let r=Math.atan2(A.y,A.x);return r<0&&(r+=2*Math.PI),r}static FromAngle(r,length=1){return new Vec(Math.cos(r)*length,Math.sin(r)*length)}static ToArray(A){return[A.x,A.y,A.z]}static ToJson(A){const{x,y,z}=A;return{x,y,z}}static Average(arr){const len=arr.length,avg=new Vec(0,0);if(0===len)return avg;for(let i=0;i<len;i++)avg.add(arr[i]);return avg.div(len)}static Clamp(A,min,max){return void 0===max?new Vec(Math.min(Math.max(A.x,min)),Math.min(Math.max(A.y,min))):new Vec(Math.min(Math.max(A.x,min),max),Math.min(Math.max(A.y,min),max))}static PointsBetween(A,B,steps=6){const results=[];for(let i=0;i<steps;i++){const t=EASINGS.easeInQuad(i/(steps-1)),point=Vec.Lrp(A,B,t);point.z=Math.min(1,.5+.65*Math.abs(.5-ease(t))),results.push(point)}return results}static SnapToGrid(A,gridSize=8){return new Vec(Math.round(A.x/gridSize)*gridSize,Math.round(A.y/gridSize)*gridSize)}}const ease=t=>t<.5?2*t*t:(4-2*t)*t-1;function precise(A){return`${utils_toDomPrecision(A.x)},${utils_toDomPrecision(A.y)} `}function average(A,B){return`${utils_toDomPrecision((A.x+B.x)/2)},${utils_toDomPrecision((A.y+B.y)/2)} `}const utils_PI=Math.PI,HALF_PI=utils_PI/2,utils_PI2=2*utils_PI,SIN=Math.sin;function clamp(n,min,max){return Math.max(min,void 0!==max?Math.min(n,max):n)}function toPrecision(n,precision=1e10){return n?Math.round(n*precision)/precision:0}function approximately(a,b,precision=1e-6){return Math.abs(a-b)<=precision}function perimeterOfEllipse(rx,ry){const h=Math.pow(rx-ry,2)/Math.pow(rx+ry,2);return utils_PI*(rx+ry)*(1+3*h/(10+Math.sqrt(4-3*h)))}function canonicalizeRotation(a){return(a%=utils_PI2)<0?a+=utils_PI2:0===a&&(a=0),a}function clockwiseAngleDist(a0,a1){return(a0=canonicalizeRotation(a0))>(a1=canonicalizeRotation(a1))&&(a1+=utils_PI2),a1-a0}function counterClockwiseAngleDist(a0,a1){return utils_PI2-clockwiseAngleDist(a0,a1)}function shortAngleDist(a0,a1){const da=(a1-a0)%utils_PI2;return 2*da%utils_PI2-da}function clampRadians(r){return(utils_PI2+r)%utils_PI2}function snapAngle(r,segments){const seg=utils_PI2/segments;let ang=Math.floor((clampRadians(r)+seg/2)/seg)*seg%utils_PI2;return ang<utils_PI&&(ang+=utils_PI2),ang>utils_PI&&(ang-=utils_PI2),ang}function areAnglesCompatible(a,b){return a===b||approximately(a%(Math.PI/2)-b%(Math.PI/2),0)}function degreesToRadians(d){return d*utils_PI/180}function getPointOnCircle(center,r,a){return new Vec(center.x,center.y).add(Vec.FromAngle(a,r))}function getPolygonVertices(width,height,sides){const cx=width/2,cy=height/2,pointsOnPerimeter=[];let minX=1/0,maxX=-1/0,minY=1/0,maxY=-1/0;for(let i=0;i<sides;i++){const t=i*(utils_PI2/sides)-HALF_PI,x=cx+cx*Math.cos(t),y=cy+cy*Math.sin(t);x<minX&&(minX=x),y<minY&&(minY=y),x>maxX&&(maxX=x),y>maxY&&(maxY=y),pointsOnPerimeter.push(new Vec(x,y))}const w=maxX-minX,h=maxY-minY;if(0!==width-w||0!==height-h)for(let i=0;i<pointsOnPerimeter.length;i++){const pt=pointsOnPerimeter[i];pt.x=(pt.x-minX)/w*width,pt.y=(pt.y-minY)/h*height}return pointsOnPerimeter}function rangesOverlap(a0,a1,b0,b1){return a0<b1&&b0<a1}function rangeIntersection(a0,a1,b0,b1){const min=Math.max(a0,b0),max=Math.min(a1,b1);return min<=max?[min,max]:null}function cross(x,y,z){return(y.x-x.x)*(z.y-x.y)-(z.x-x.x)*(y.y-x.y)}function pointInPolygon(A,points){let a,b,windingNumber=0;for(let i=0;i<points.length;i++){if(a=points[i],a.x===A.x&&a.y===A.y)return!0;if(b=points[(i+1)%points.length],Vec.Dist(A,a)+Vec.Dist(A,b)===Vec.Dist(a,b))return!0;a.y<=A.y?b.y>A.y&&cross(a,b,A)>0&&(windingNumber+=1):b.y<=A.y&&cross(a,b,A)<0&&(windingNumber-=1)}return 0!==windingNumber}function utils_toDomPrecision(v){return Math.round(1e4*v)/1e4}function toFixed(v){return Math.round(100*v)/100}const isSafeFloat=n=>Math.abs(n)<Number.MAX_SAFE_INTEGER;function getPointInArcT(mAB,A,B,P){let mAP;if(Math.abs(mAB)>utils_PI){mAP=shortAngleDist(A,P);const mPB=shortAngleDist(P,B);return Math.abs(mAP)<Math.abs(mPB)?mAP/mAB:(mAB-mPB)/mAB}{mAP=shortAngleDist(A,P);const t=mAP/mAB;return Math.sign(mAP)!==Math.sign(mAB)?Math.abs(t)>.5?1:0:t}}function centerOfCircleFromThreePoints(a,b,c){const u=-2*(a.x*(b.y-c.y)-a.y*(b.x-c.x)+b.x*c.y-c.x*b.y),x=((a.x*a.x+a.y*a.y)*(c.y-b.y)+(b.x*b.x+b.y*b.y)*(a.y-c.y)+(c.x*c.x+c.y*c.y)*(b.y-a.y))/u,y=((a.x*a.x+a.y*a.y)*(b.x-c.x)+(b.x*b.x+b.y*b.y)*(c.x-a.x)+(c.x*c.x+c.y*c.y)*(a.x-b.x))/u;return Number.isFinite(x)&&Number.isFinite(y)?new Vec(x,y):null}function getPointsOnArc(startPoint,endPoint,center,radius,numPoints){if(null===center)return[Vec.From(startPoint),Vec.From(endPoint)];const results=[],startAngle=Vec.Angle(center,startPoint),l=clockwiseAngleDist(startAngle,Vec.Angle(center,endPoint));for(let i=0;i<numPoints;i++){const point=getPointOnCircle(center,radius,startAngle+l*(i/(numPoints-1)));results.push(point)}return results}const DefaultBrush=({brush,color,opacity,className})=>{const rSvg=(0,react.useRef)(null);useTransform_useTransform(rSvg,brush.x,brush.y);const w=utils_toDomPrecision(Math.max(1,brush.w)),h=utils_toDomPrecision(Math.max(1,brush.h));return(0,jsx_runtime.jsx)("svg",{className:"tl-overlays__item",ref:rSvg,children:color?(0,jsx_runtime.jsxs)("g",{className:"tl-brush",opacity,children:[(0,jsx_runtime.jsx)("rect",{width:w,height:h,fill:color,opacity:.75}),(0,jsx_runtime.jsx)("rect",{width:w,height:h,fill:"none",stroke:color,opacity:.1})]}):(0,jsx_runtime.jsx)("rect",{className:`tl-brush tl-brush__default ${className}`,width:w,height:h})})},tlenv={isSafari:!1,isIos:!1,isChromeForIos:!1,isFirefox:!1,isAndroid:!1,isWebview:!1,isDarwin:!1,hasCanvasSupport:!1};"undefined"!=typeof window&&"navigator"in window&&(tlenv.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),tlenv.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),tlenv.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),tlenv.isFirefox=/firefox/i.test(navigator.userAgent),tlenv.isAndroid=/android/i.test(navigator.userAgent),tlenv.isDarwin=window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,tlenv.hasCanvasSupport="undefined"!=typeof window&&"Promise"in window&&"HTMLCanvasElement"in window);const DEFAULT_CAMERA_OPTIONS={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.05,.1,.25,.5,1,2,4,8]},DEFAULT_ANIMATION_OPTIONS={duration:0,easing:EASINGS.easeInOutCubic},INTERNAL_POINTER_IDS_CAMERA_MOVE=-10,SIDES=["top","right","bottom","left"],RIGHT_MOUSE_BUTTON=2;var process=__webpack_require__("./node_modules/process/browser.js");const featureFlags={},pointerCaptureTrackingObject=createDebugValue("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),debugFlags={logPreventDefaults:createDebugValue("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:createDebugValue("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:createDebugValue("logElementRemoves",{defaults:{all:!1}}),debugSvg:createDebugValue("debugSvg",{defaults:{all:!1}}),showFps:createDebugValue("showFps",{defaults:{all:!1}}),measurePerformance:createDebugValue("measurePerformance",{defaults:{all:!1}}),throwToBlob:createDebugValue("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:createDebugValue("reconnectOnPing",{defaults:{all:!1}}),debugCursors:createDebugValue("debugCursors",{defaults:{all:!1}}),forceSrgb:createDebugValue("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:createDebugValue("debugGeometry",{defaults:{all:!1}}),hideShapes:createDebugValue("hideShapes",{defaults:{all:!1}}),editOnType:createDebugValue("editOnType",{defaults:{all:!1}}),a11y:createDebugValue("a11y",{defaults:{all:!1}}),debugElbowArrows:createDebugValue("debugElbowArrows",{defaults:{all:!1}})};if("undefined"!=typeof Element){const nativeElementRemoveChild=Element.prototype.removeChild;(0,state_dist_esm.wv)("element removal logging",(()=>{debugFlags.logElementRemoves.get()?Element.prototype.removeChild=function(child){return console.warn("[tldraw] removing child:",child),nativeElementRemoveChild.call(this,child)}:Element.prototype.removeChild=nativeElementRemoveChild}))}function createDebugValue(name,{defaults,shouldStoreForSession=!0}){return function createDebugValueBase(def){const defaultValue=function getDefaultValue(def){switch(readEnv((()=>process.env.TLDRAW_ENV))??readEnv((()=>process.env.VERCEL_PUBLIC_TLDRAW_ENV))??readEnv((()=>process.env.NEXT_PUBLIC_TLDRAW_ENV))??"production"){case"production":return def.defaults.production??def.defaults.all;case"preview":case"staging":return def.defaults.staging??def.defaults.all;default:return def.defaults.development??def.defaults.all}}(def),storedValue=def.shouldStoreForSession?function getStoredInitialValue(name){try{return JSON.parse((0,dist_esm._9)(`tldraw_debug:${name}`)??"null")}catch{return null}}(def.name):null,valueAtom=(0,state_dist_esm.eU)(`debug:${def.name}`,storedValue??defaultValue);"undefined"!=typeof window&&(def.shouldStoreForSession&&(0,state_dist_esm.wv)(`debug:${def.name}`,(()=>{const currentValue=valueAtom.get();currentValue===defaultValue?(0,dist_esm.ZJ)(`tldraw_debug:${def.name}`):(0,dist_esm.dQ)(`tldraw_debug:${def.name}`,JSON.stringify(currentValue))})),Object.defineProperty(window,`tldraw${def.name.replace(/^[a-z]/,(l=>l.toUpperCase()))}`,{get:()=>valueAtom.get(),set(newValue){valueAtom.set(newValue)},configurable:!0}));return Object.assign(valueAtom,def,{reset:()=>valueAtom.set(defaultValue)})}({name,defaults,shouldStoreForSession})}function readEnv(fn){try{return fn()}catch{return null}}function loopToHtmlElement(elm){if(elm instanceof HTMLElement)return elm;if(elm.parentElement)return loopToHtmlElement(elm.parentElement);throw Error("Could not find a parent element of an HTML type!")}function preventDefault(event){event.preventDefault(),debugFlags.logPreventDefaults.get()&&console.warn("preventDefault called on event:",event)}function setPointerCapture(element,event){if(element.setPointerCapture(event.pointerId),debugFlags.logPointerCaptures.get()){const trackingObj=pointerCaptureTrackingObject.get();trackingObj.set(element,(trackingObj.get(element)??0)+1),console.warn("setPointerCapture called on element:",element,event)}}function releasePointerCapture(element,event){if(element.hasPointerCapture(event.pointerId)&&(element.releasePointerCapture(event.pointerId),debugFlags.logPointerCaptures.get())){const trackingObj=pointerCaptureTrackingObject.get();1===trackingObj.get(element)?trackingObj.delete(element):trackingObj.has(element)?trackingObj.set(element,trackingObj.get(element)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",element,event)}}const stopEventPropagation=e=>e.stopPropagation(),setStyleProperty=(elm,property,value)=>{elm&&elm.style.setProperty(property,value)};function activeElementShouldCaptureKeys(allowButtons=!1){const{activeElement}=document,elements=allowButtons?["input","textarea"]:["input","select","button","textarea"];return!(!activeElement||!(activeElement.isContentEditable||elements.indexOf(activeElement.tagName.toLowerCase())>-1||activeElement.classList.contains("tlui-slider__thumb")))}const isAccelKey=e=>tlenv.isDarwin?e.metaKey:e.ctrlKey||e.metaKey;function getPointerInfo(e){return e.isKilled=!0,{point:{x:e.clientX,y:e.clientY,z:e.pressure},shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,metaKey:e.metaKey,accelKey:isAccelKey(e),pointerId:e.pointerId,button:e.button,isPen:"pen"===e.pointerType}}function useCanvasEvents(){const editor=useEditor_useEditor(),currentTool=useValue_useValue("current tool",(()=>editor.getCurrentTool()),[editor]);return(0,react.useMemo)((function canvasEvents(){let lastX,lastY;return{onPointerDown:function onPointerDown(e){e.isKilled||(e.button!==RIGHT_MOUSE_BUTTON?0!==e.button&&1!==e.button&&5!==e.button||(setPointerCapture(e.currentTarget,e),editor.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...getPointerInfo(e)})):editor.dispatch({type:"pointer",target:"canvas",name:"right_click",...getPointerInfo(e)}))},onPointerMove:function onPointerMove(e){if(e.isKilled)return;if(e.clientX===lastX&&e.clientY===lastY)return;lastX=e.clientX,lastY=e.clientY;const events2=currentTool.useCoalescedEvents&&e.nativeEvent.getCoalescedEvents?e.nativeEvent.getCoalescedEvents():[e];for(const singleEvent of events2)editor.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...getPointerInfo(singleEvent)})},onPointerUp:function onPointerUp(e){e.isKilled||0!==e.button&&1!==e.button&&2!==e.button&&5!==e.button||(lastX=e.clientX,lastY=e.clientY,releasePointerCapture(e.currentTarget,e),editor.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...getPointerInfo(e)}))},onPointerEnter:function onPointerEnter(e){if(e.isKilled)return;if(editor.getInstanceState().isPenMode&&"pen"!==e.pointerType)return;const canHover="mouse"===e.pointerType||"pen"===e.pointerType;editor.updateInstanceState({isHoveringCanvas:!!canHover||null})},onPointerLeave:function onPointerLeave(e){if(e.isKilled)return;if(editor.getInstanceState().isPenMode&&"pen"!==e.pointerType)return;const canHover="mouse"===e.pointerType||"pen"===e.pointerType;editor.updateInstanceState({isHoveringCanvas:!canHover&&null})},onDragOver:function onDragOver(e){preventDefault(e)},onDrop:async function onDrop(e){if(preventDefault(e),stopEventPropagation(e),e.dataTransfer?.files?.length){const files=Array.from(e.dataTransfer.files);return void await editor.putExternalContent({type:"files",files,point:editor.screenToPage({x:e.clientX,y:e.clientY}),ignoreParent:!1})}const url=e.dataTransfer.getData("url");url&&await editor.putExternalContent({type:"url",url,point:editor.screenToPage({x:e.clientX,y:e.clientY})})},onTouchStart:function onTouchStart(e){e.isKilled=!0,preventDefault(e)},onTouchEnd:function onTouchEnd(e){e.isKilled=!0,e.target instanceof HTMLElement&&("A"===e.target.tagName||"TEXTAREA"===e.target.tagName||e.target.isContentEditable||editor.getEditingShape()&&e.target.className.includes("tl-text-content")||preventDefault(e))},onClick:function onClick(e){stopEventPropagation(e)}}}),[editor,currentTool])}const ContainerContext=(0,react.createContext)(null);function ContainerProvider({container,children}){return(0,jsx_runtime.jsx)(ContainerContext.Provider,{value:container,children})}function useContainer(){return(0,dist_esm.Z1)((0,react.useContext)(ContainerContext),"useContainer used outside of <Tldraw />")}function areShortcutsDisabled(editor){return editor.menus.hasOpenMenus()||activeElementShouldCaptureKeys()}const IGNORED_TAGS=["textarea","input"];const V={toVector:(v,fallback)=>(void 0===v&&(v=fallback),Array.isArray(v)?v:[v,v]),add:(v1,v2)=>[v1[0]+v2[0],v1[1]+v2[1]],sub:(v1,v2)=>[v1[0]-v2[0],v1[1]-v2[1]],addTo(v1,v2){v1[0]+=v2[0],v1[1]+=v2[1]},subTo(v1,v2){v1[0]-=v2[0],v1[1]-=v2[1]}};function rubberband(distance,dimension,constant){return 0===dimension||Math.abs(dimension)===1/0?Math.pow(distance,5*constant):distance*dimension*constant/(dimension+constant*distance)}function rubberbandIfOutOfBounds(position,min,max,constant=.15){return 0===constant?function maths_0ab39ae9_esm_clamp(v,min,max){return Math.max(min,Math.min(v,max))}(position,min,max):position<min?-rubberband(min-position,max-min,constant)+min:position>max?+rubberband(position-max,max-min,constant)+max:position}function _toPropertyKey(arg){var key=function _toPrimitive(input,hint){if("object"!=typeof input||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0!==prim){var res=prim.call(input,hint||"default");if("object"!=typeof res)return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===hint?String:Number)(input)}(arg,"string");return"symbol"==typeof key?key:String(key)}function _defineProperty(obj,key,value){return(key=_toPropertyKey(key))in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread2(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}const EVENT_TYPE_MAP={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function capitalize(string){return string?string[0].toUpperCase()+string.slice(1):""}const actionsWithoutCaptureSupported=["enter","leave"];function toHandlerProp(device,action="",capture=!1){const deviceProps=EVENT_TYPE_MAP[device],actionKey=deviceProps&&deviceProps[action]||action;return"on"+capitalize(device)+capitalize(actionKey)+(function hasCapture(capture=!1,actionKey){return capture&&!actionsWithoutCaptureSupported.includes(actionKey)}(capture,actionKey)?"Capture":"")}const pointerCaptureEvents=["gotpointercapture","lostpointercapture"];function parseProp(prop){let eventKey=prop.substring(2).toLowerCase();const passive=!!~eventKey.indexOf("passive");passive&&(eventKey=eventKey.replace("passive",""));const captureKey=pointerCaptureEvents.includes(eventKey)?"capturecapture":"capture",capture=!!~eventKey.indexOf(captureKey);return capture&&(eventKey=eventKey.replace("capture","")),{device:eventKey,capture,passive}}function isTouch(event){return"touches"in event}function getPointerType(event){return isTouch(event)?"touch":"pointerType"in event?event.pointerType:"mouse"}function distanceAngle(P1,P2){try{const dx=P2.clientX-P1.clientX,dy=P2.clientY-P1.clientY,cx=(P2.clientX+P1.clientX)/2,cy=(P2.clientY+P1.clientY)/2,distance=Math.hypot(dx,dy),angle=-180*Math.atan2(dx,dy)/Math.PI;return{angle,distance,origin:[cx,cy]}}catch(_unused){}return null}function touchIds(event){return function getCurrentTargetTouchList(event){return Array.from(event.touches).filter((e=>{var _event$currentTarget,_event$currentTarget$;return e.target===event.currentTarget||(null===(_event$currentTarget=event.currentTarget)||void 0===_event$currentTarget||null===(_event$currentTarget$=_event$currentTarget.contains)||void 0===_event$currentTarget$?void 0:_event$currentTarget$.call(_event$currentTarget,e.target))}))}(event).map((touch=>touch.identifier))}function touchDistanceAngle(event,ids){const[P1,P2]=Array.from(event.touches).filter((touch=>ids.includes(touch.identifier)));return distanceAngle(P1,P2)}function wheelValues(event){let{deltaX,deltaY,deltaMode}=event;return 1===deltaMode?(deltaX*=40,deltaY*=40):2===deltaMode&&(deltaX*=800,deltaY*=800),[deltaX,deltaY]}function call(v,...args){return"function"==typeof v?v(...args):v}function noop(){}function chain(...fns){return 0===fns.length?noop:1===fns.length?fns[0]:function(){let result;for(const fn of fns)result=fn.apply(this,arguments)||result;return result}}function assignDefault(value,fallback){return Object.assign({},fallback,value||{})}class Engine{constructor(ctrl,args,key){this.ctrl=ctrl,this.args=args,this.key=key,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(state){this.ctrl.state[this.key]=state}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state,shared,ingKey,args}=this;shared[ingKey]=state._active=state.active=state._blocked=state._force=!1,state._step=[!1,!1],state.intentional=!1,state._movement=[0,0],state._distance=[0,0],state._direction=[0,0],state._delta=[0,0],state._bounds=[[-1/0,1/0],[-1/0,1/0]],state.args=args,state.axis=void 0,state.memo=void 0,state.elapsedTime=state.timeDelta=0,state.direction=[0,0],state.distance=[0,0],state.overflow=[0,0],state._movementBound=[!1,!1],state.velocity=[0,0],state.movement=[0,0],state.delta=[0,0],state.timeStamp=0}start(event){const state=this.state,config=this.config;state._active||(this.reset(),this.computeInitial(),state._active=!0,state.target=event.target,state.currentTarget=event.currentTarget,state.lastOffset=config.from?call(config.from,state):state.offset,state.offset=state.lastOffset,state.startTime=state.timeStamp=event.timeStamp)}computeValues(values){const state=this.state;state._values=values,state.values=this.config.transform(values)}computeInitial(){const state=this.state;state._initial=state._values,state.initial=state.values}compute(event){const{state,config,shared}=this;state.args=this.args;let dt=0;if(event&&(state.event=event,config.preventDefault&&event.cancelable&&state.event.preventDefault(),state.type=event.type,shared.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,shared.locked=!!document.pointerLockElement,Object.assign(shared,function getEventDetails(event){const payload={};if("buttons"in event&&(payload.buttons=event.buttons),"shiftKey"in event){const{shiftKey,altKey,metaKey,ctrlKey}=event;Object.assign(payload,{shiftKey,altKey,metaKey,ctrlKey})}return payload}(event)),shared.down=shared.pressed=shared.buttons%2==1||shared.touches>0,dt=event.timeStamp-state.timeStamp,state.timeStamp=event.timeStamp,state.elapsedTime=state.timeStamp-state.startTime),state._active){const _absoluteDelta=state._delta.map(Math.abs);V.addTo(state._distance,_absoluteDelta)}this.axisIntent&&this.axisIntent(event);const[_m0,_m1]=state._movement,[t0,t1]=config.threshold,{_step,values}=state;if(config.hasCustomTransform?(!1===_step[0]&&(_step[0]=Math.abs(_m0)>=t0&&values[0]),!1===_step[1]&&(_step[1]=Math.abs(_m1)>=t1&&values[1])):(!1===_step[0]&&(_step[0]=Math.abs(_m0)>=t0&&Math.sign(_m0)*t0),!1===_step[1]&&(_step[1]=Math.abs(_m1)>=t1&&Math.sign(_m1)*t1)),state.intentional=!1!==_step[0]||!1!==_step[1],!state.intentional)return;const movement=[0,0];if(config.hasCustomTransform){const[v0,v1]=values;movement[0]=!1!==_step[0]?v0-_step[0]:0,movement[1]=!1!==_step[1]?v1-_step[1]:0}else movement[0]=!1!==_step[0]?_m0-_step[0]:0,movement[1]=!1!==_step[1]?_m1-_step[1]:0;this.restrictToAxis&&!state._blocked&&this.restrictToAxis(movement);const previousOffset=state.offset,gestureIsActive=state._active&&!state._blocked||state.active;gestureIsActive&&(state.first=state._active&&!state.active,state.last=!state._active&&state.active,state.active=shared[this.ingKey]=state._active,event&&(state.first&&("bounds"in config&&(state._bounds=call(config.bounds,state)),this.setup&&this.setup()),state.movement=movement,this.computeOffset()));const[ox,oy]=state.offset,[[x0,x1],[y0,y1]]=state._bounds;state.overflow=[ox<x0?-1:ox>x1?1:0,oy<y0?-1:oy>y1?1:0],state._movementBound[0]=!!state.overflow[0]&&(!1===state._movementBound[0]?state._movement[0]:state._movementBound[0]),state._movementBound[1]=!!state.overflow[1]&&(!1===state._movementBound[1]?state._movement[1]:state._movementBound[1]);const rubberband=state._active&&config.rubberband||[0,0];if(state.offset=function computeRubberband(bounds,[Vx,Vy],[Rx,Ry]){const[[X0,X1],[Y0,Y1]]=bounds;return[rubberbandIfOutOfBounds(Vx,X0,X1,Rx),rubberbandIfOutOfBounds(Vy,Y0,Y1,Ry)]}(state._bounds,state.offset,rubberband),state.delta=V.sub(state.offset,previousOffset),this.computeMovement(),gestureIsActive&&(!state.last||dt>32)){state.delta=V.sub(state.offset,previousOffset);const absoluteDelta=state.delta.map(Math.abs);V.addTo(state.distance,absoluteDelta),state.direction=state.delta.map(Math.sign),state._direction=state._delta.map(Math.sign),!state.first&&dt>0&&(state.velocity=[absoluteDelta[0]/dt,absoluteDelta[1]/dt],state.timeDelta=dt)}}emit(){const state=this.state,shared=this.shared,config=this.config;if(state._active||this.clean(),(state._blocked||!state.intentional)&&!state._force&&!config.triggerAllEvents)return;const memo=this.handler(_objectSpread2(_objectSpread2(_objectSpread2({},shared),state),{},{[this.aliasKey]:state.values}));void 0!==memo&&(state.memo=memo)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class CoordinatesEngine extends Engine{constructor(...args){super(...args),_defineProperty(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=V.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=V.sub(this.state.offset,this.state.lastOffset)}axisIntent(event){const state=this.state,config=this.config;if(!state.axis&&event){const threshold="object"==typeof config.axisThreshold?config.axisThreshold[getPointerType(event)]:config.axisThreshold;state.axis=function selectAxis([dx,dy],threshold){const absDx=Math.abs(dx),absDy=Math.abs(dy);return absDx>absDy&&absDx>threshold?"x":absDy>absDx&&absDy>threshold?"y":void 0}(state._movement,threshold)}state._blocked=(config.lockDirection||!!config.axis)&&!state.axis||!!config.axis&&config.axis!==state.axis}restrictToAxis(v){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":v[1]=0;break;case"y":v[0]=0}}}const identity=v=>v,commonConfigResolver={enabled:(value=!0)=>value,eventOptions:(value,_k,config)=>_objectSpread2(_objectSpread2({},config.shared.eventOptions),value),preventDefault:(value=!1)=>value,triggerAllEvents:(value=!1)=>value,rubberband(value=0){switch(value){case!0:return[.15,.15];case!1:return[0,0];default:return V.toVector(value)}},from:value=>"function"==typeof value?value:null!=value?V.toVector(value):void 0,transform(value,_k,config){const transform=value||config.shared.transform;return this.hasCustomTransform=!!transform,transform||identity},threshold:value=>V.toVector(value,0)};const coordinatesConfigResolver=_objectSpread2(_objectSpread2({},commonConfigResolver),{},{axis(_v,_k,{axis}){if(this.lockDirection="lock"===axis,!this.lockDirection)return axis},axisThreshold:(value=0)=>value,bounds(value={}){if("function"==typeof value)return state=>coordinatesConfigResolver.bounds(value(state));if("current"in value)return()=>value.current;if("function"==typeof HTMLElement&&value instanceof HTMLElement)return value;const{left=-1/0,right=1/0,top=-1/0,bottom=1/0}=value;return[[left,right],[top,bottom]]}});const isBrowser="undefined"!=typeof window&&window.document&&window.document.createElement;function supportsTouchEvents(){return isBrowser&&"ontouchstart"in window}const SUPPORT={isBrowser,gesture:function supportsGestureEvents(){try{return"constructor"in GestureEvent}catch(e){return!1}}(),touch:supportsTouchEvents(),touchscreen:function isTouchScreen(){return supportsTouchEvents()||isBrowser&&window.navigator.maxTouchPoints>1}(),pointer:function supportsPointerEvents(){return isBrowser&&"onpointerdown"in window}(),pointerLock:function supportsPointerLock(){return isBrowser&&"exitPointerLock"in window.document}()},DEFAULT_DRAG_AXIS_THRESHOLD={mouse:0,touch:0,pen:8};_objectSpread2(_objectSpread2({},coordinatesConfigResolver),{},{device(_v,_k,{pointer:{touch=!1,lock=!1,mouse=!1}={}}){return this.pointerLock=lock&&SUPPORT.pointerLock,SUPPORT.touch&&touch?"touch":this.pointerLock?"mouse":SUPPORT.pointer&&!mouse?"pointer":SUPPORT.touch?"touch":"mouse"},preventScrollAxis(value,_k,{preventScroll}){if(this.preventScrollDelay="number"==typeof preventScroll?preventScroll:preventScroll||void 0===preventScroll&&value?250:void 0,SUPPORT.touchscreen&&!1!==preventScroll)return value||(void 0!==preventScroll?"y":void 0)},pointerCapture(_v,_k,{pointer:{capture=!0,buttons=1,keys=!0}={}}){return this.pointerButtons=buttons,this.keys=keys,!this.pointerLock&&"pointer"===this.device&&capture},threshold(value,_k,{filterTaps=!1,tapsThreshold=3,axis}){const threshold=V.toVector(value,filterTaps?tapsThreshold:axis?1:0);return this.filterTaps=filterTaps,this.tapsThreshold=tapsThreshold,threshold},swipe({velocity=.5,distance=50,duration=250}={}){return{velocity:this.transform(V.toVector(velocity)),distance:this.transform(V.toVector(distance)),duration}},delay(value=0){switch(value){case!0:return 180;case!1:return 0;default:return value}},axisThreshold:value=>value?_objectSpread2(_objectSpread2({},DEFAULT_DRAG_AXIS_THRESHOLD),value):DEFAULT_DRAG_AXIS_THRESHOLD,keyboardDisplacement:(value=10)=>value});function clampStateInternalMovementToBounds(state){const[ox,oy]=state.overflow,[dx,dy]=state._delta,[dirx,diry]=state._direction;(ox<0&&dx>0&&dirx<0||ox>0&&dx<0&&dirx>0)&&(state._movement[0]=state._movementBound[0]),(oy<0&&dy>0&&diry<0||oy>0&&dy<0&&diry>0)&&(state._movement[1]=state._movementBound[1])}const pinchConfigResolver=_objectSpread2(_objectSpread2({},commonConfigResolver),{},{device(_v,_k,{shared,pointer:{touch=!1}={}}){if(shared.target&&!SUPPORT.touch&&SUPPORT.gesture)return"gesture";if(SUPPORT.touch&&touch)return"touch";if(SUPPORT.touchscreen){if(SUPPORT.pointer)return"pointer";if(SUPPORT.touch)return"touch"}},bounds(_v,_k,{scaleBounds={},angleBounds={}}){const _scaleBounds=state=>{const D=assignDefault(call(scaleBounds,state),{min:-1/0,max:1/0});return[D.min,D.max]},_angleBounds=state=>{const A=assignDefault(call(angleBounds,state),{min:-1/0,max:1/0});return[A.min,A.max]};return"function"!=typeof scaleBounds&&"function"!=typeof angleBounds?[_scaleBounds(),_angleBounds()]:state=>[_scaleBounds(state),_angleBounds(state)]},threshold(value,_k,config){this.lockDirection="lock"===config.axis;return V.toVector(value,this.lockDirection?[.1,3]:0)},modifierKey:value=>void 0===value?"ctrlKey":value,pinchOnWheel:(value=!0)=>value});_objectSpread2(_objectSpread2({},coordinatesConfigResolver),{},{mouseOnly:(value=!0)=>value});const wheelConfigResolver=coordinatesConfigResolver;_objectSpread2(_objectSpread2({},coordinatesConfigResolver),{},{mouseOnly:(value=!0)=>value});const EngineMap=new Map,ConfigResolverMap=new Map;function actions_fe213e88_esm_registerAction(action){EngineMap.set(action.key,action.engine),ConfigResolverMap.set(action.key,action.resolver)}const actions_fe213e88_esm_pinchAction={key:"pinch",engine:class PinchEngine extends Engine{constructor(...args){super(...args),_defineProperty(this,"ingKey","pinching"),_defineProperty(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const state=this.state;state._touchIds=[],state.canceled=!1,state.cancel=this.cancel.bind(this),state.turns=0}computeOffset(){const{type,movement,lastOffset}=this.state;this.state.offset="wheel"===type?V.add(movement,lastOffset):[(1+movement[0])*lastOffset[0],movement[1]+lastOffset[1]]}computeMovement(){const{offset,lastOffset}=this.state;this.state.movement=[offset[0]/lastOffset[0],offset[1]-lastOffset[1]]}axisIntent(){const state=this.state,[_m0,_m1]=state._movement;if(!state.axis){const axisMovementDifference=30*Math.abs(_m0)-Math.abs(_m1);axisMovementDifference<0?state.axis="angle":axisMovementDifference>0&&(state.axis="scale")}}restrictToAxis(v){this.config.lockDirection&&("scale"===this.state.axis?v[1]=0:"angle"===this.state.axis&&(v[0]=0))}cancel(){const state=this.state;state.canceled||setTimeout((()=>{state.canceled=!0,state._active=!1,this.compute(),this.emit()}),0)}touchStart(event){this.ctrl.setEventIds(event);const state=this.state,ctrlTouchIds=this.ctrl.touchIds;if(state._active&&state._touchIds.every((id=>ctrlTouchIds.has(id))))return;if(ctrlTouchIds.size<2)return;this.start(event),state._touchIds=Array.from(ctrlTouchIds).slice(0,2);const payload=touchDistanceAngle(event,state._touchIds);payload&&this.pinchStart(event,payload)}pointerStart(event){if(null!=event.buttons&&event.buttons%2!=1)return;this.ctrl.setEventIds(event),event.target.setPointerCapture(event.pointerId);const state=this.state,_pointerEvents=state._pointerEvents,ctrlPointerIds=this.ctrl.pointerIds;if(state._active&&Array.from(_pointerEvents.keys()).every((id=>ctrlPointerIds.has(id))))return;if(_pointerEvents.size<2&&_pointerEvents.set(event.pointerId,event),state._pointerEvents.size<2)return;this.start(event);const payload=distanceAngle(...Array.from(_pointerEvents.values()));payload&&this.pinchStart(event,payload)}pinchStart(event,payload){this.state.origin=payload.origin,this.computeValues([payload.distance,payload.angle]),this.computeInitial(),this.compute(event),this.emit()}touchMove(event){if(!this.state._active)return;const payload=touchDistanceAngle(event,this.state._touchIds);payload&&this.pinchMove(event,payload)}pointerMove(event){const _pointerEvents=this.state._pointerEvents;if(_pointerEvents.has(event.pointerId)&&_pointerEvents.set(event.pointerId,event),!this.state._active)return;const payload=distanceAngle(...Array.from(_pointerEvents.values()));payload&&this.pinchMove(event,payload)}pinchMove(event,payload){const state=this.state,prev_a=state._values[1],delta_a=payload.angle-prev_a;let delta_turns=0;Math.abs(delta_a)>270&&(delta_turns+=Math.sign(delta_a)),this.computeValues([payload.distance,payload.angle-360*delta_turns]),state.origin=payload.origin,state.turns=delta_turns,state._movement=[state._values[0]/state._initial[0]-1,state._values[1]-state._initial[1]],this.compute(event),this.emit()}touchEnd(event){this.ctrl.setEventIds(event),this.state._active&&this.state._touchIds.some((id=>!this.ctrl.touchIds.has(id)))&&(this.state._active=!1,this.compute(event),this.emit())}pointerEnd(event){const state=this.state;this.ctrl.setEventIds(event);try{event.target.releasePointerCapture(event.pointerId)}catch(_unused){}state._pointerEvents.has(event.pointerId)&&state._pointerEvents.delete(event.pointerId),state._active&&state._pointerEvents.size<2&&(state._active=!1,this.compute(event),this.emit())}gestureStart(event){event.cancelable&&event.preventDefault();const state=this.state;state._active||(this.start(event),this.computeValues([event.scale,event.rotation]),state.origin=[event.clientX,event.clientY],this.compute(event),this.emit())}gestureMove(event){if(event.cancelable&&event.preventDefault(),!this.state._active)return;const state=this.state;this.computeValues([event.scale,event.rotation]),state.origin=[event.clientX,event.clientY];const _previousMovement=state._movement;state._movement=[event.scale-1,event.rotation],state._delta=V.sub(state._movement,_previousMovement),this.compute(event),this.emit()}gestureEnd(event){this.state._active&&(this.state._active=!1,this.compute(event),this.emit())}wheel(event){const modifierKey=this.config.modifierKey;modifierKey&&!(Array.isArray(modifierKey)?modifierKey.find((k=>event[k])):event[modifierKey])||(this.state._active?this.wheelChange(event):this.wheelStart(event),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(event){this.start(event),this.wheelChange(event)}wheelChange(event){"uv"in event||event.cancelable&&event.preventDefault();const state=this.state;state._delta=[-wheelValues(event)[1]/100*state.offset[0],0],V.addTo(state._movement,state._delta),clampStateInternalMovementToBounds(state),this.state.origin=[event.clientX,event.clientY],this.compute(event),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(bindFunction){const device=this.config.device;device&&(bindFunction(device,"start",this[device+"Start"].bind(this)),bindFunction(device,"change",this[device+"Move"].bind(this)),bindFunction(device,"end",this[device+"End"].bind(this)),bindFunction(device,"cancel",this[device+"End"].bind(this)),bindFunction("lostPointerCapture","",this[device+"End"].bind(this))),this.config.pinchOnWheel&&bindFunction("wheel","",this.wheel.bind(this),{passive:!1})}},resolver:pinchConfigResolver},actions_fe213e88_esm_wheelAction={key:"wheel",engine:class WheelEngine extends CoordinatesEngine{constructor(...args){super(...args),_defineProperty(this,"ingKey","wheeling")}wheel(event){this.state._active||this.start(event),this.wheelChange(event),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(event){const state=this.state;state._delta=wheelValues(event),V.addTo(state._movement,state._delta),clampStateInternalMovementToBounds(state),this.compute(event),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(bindFunction){bindFunction("wheel","",this.wheel.bind(this))}},resolver:wheelConfigResolver};function _objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}const sharedConfigResolver={target(value){if(value)return()=>"current"in value?value.current:value},enabled:(value=!0)=>value,window:(value=(SUPPORT.isBrowser?window:void 0))=>value,eventOptions:({passive=!0,capture=!1}={})=>({passive,capture}),transform:value=>value},_excluded=["target","eventOptions","window","enabled","transform"];function resolveWith(config={},resolvers){const result={};for(const[key,resolver]of Object.entries(resolvers))switch(typeof resolver){case"function":result[key]=resolver.call(result,config[key],key,config);break;case"object":result[key]=resolveWith(config[key],resolver);break;case"boolean":resolver&&(result[key]=config[key])}return result}class EventStore{constructor(ctrl,gestureKey){_defineProperty(this,"_listeners",new Set),this._ctrl=ctrl,this._gestureKey=gestureKey}add(element,device,action,handler,options){const listeners=this._listeners,type=function toDomEventType(device,action=""){const deviceProps=EVENT_TYPE_MAP[device];return device+(deviceProps&&deviceProps[action]||action)}(device,action),eventOptions=_objectSpread2(_objectSpread2({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),options);element.addEventListener(type,handler,eventOptions);const remove=()=>{element.removeEventListener(type,handler,eventOptions),listeners.delete(remove)};return listeners.add(remove),remove}clean(){this._listeners.forEach((remove=>remove())),this._listeners.clear()}}class TimeoutStore{constructor(){_defineProperty(this,"_timeouts",new Map)}add(key,callback,ms=140,...args){this.remove(key),this._timeouts.set(key,window.setTimeout(callback,ms,...args))}remove(key){const timeout=this._timeouts.get(key);timeout&&window.clearTimeout(timeout)}clean(){this._timeouts.forEach((timeout=>{window.clearTimeout(timeout)})),this._timeouts.clear()}}class Controller{constructor(handlers){_defineProperty(this,"gestures",new Set),_defineProperty(this,"_targetEventStore",new EventStore(this)),_defineProperty(this,"gestureEventStores",{}),_defineProperty(this,"gestureTimeoutStores",{}),_defineProperty(this,"handlers",{}),_defineProperty(this,"config",{}),_defineProperty(this,"pointerIds",new Set),_defineProperty(this,"touchIds",new Set),_defineProperty(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),function resolveGestures(ctrl,internalHandlers){internalHandlers.drag&&setupGesture(ctrl,"drag");internalHandlers.wheel&&setupGesture(ctrl,"wheel");internalHandlers.scroll&&setupGesture(ctrl,"scroll");internalHandlers.move&&setupGesture(ctrl,"move");internalHandlers.pinch&&setupGesture(ctrl,"pinch");internalHandlers.hover&&setupGesture(ctrl,"hover")}(this,handlers)}setEventIds(event){return isTouch(event)?(this.touchIds=new Set(touchIds(event)),this.touchIds):"pointerId"in event?("pointerup"===event.type||"pointercancel"===event.type?this.pointerIds.delete(event.pointerId):"pointerdown"===event.type&&this.pointerIds.add(event.pointerId),this.pointerIds):void 0}applyHandlers(handlers,nativeHandlers){this.handlers=handlers,this.nativeHandlers=nativeHandlers}applyConfig(config,gestureKey){this.config=function parse(newConfig,gestureKey,_config={}){const _ref=newConfig,{target,eventOptions,window,enabled,transform}=_ref,rest=_objectWithoutProperties(_ref,_excluded);if(_config.shared=resolveWith({target,eventOptions,window,enabled,transform},sharedConfigResolver),gestureKey){const resolver=ConfigResolverMap.get(gestureKey);_config[gestureKey]=resolveWith(_objectSpread2({shared:_config.shared},rest),resolver)}else for(const key in rest){const resolver=ConfigResolverMap.get(key);resolver&&(_config[key]=resolveWith(_objectSpread2({shared:_config.shared},rest[key]),resolver))}return _config}(config,gestureKey,this.config)}clean(){this._targetEventStore.clean();for(const key of this.gestures)this.gestureEventStores[key].clean(),this.gestureTimeoutStores[key].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...args){const sharedConfig=this.config.shared,props={};let target;if(!sharedConfig.target||(target=sharedConfig.target(),target)){if(sharedConfig.enabled){for(const gestureKey of this.gestures){const gestureConfig=this.config[gestureKey],bindFunction=bindToProps(props,gestureConfig.eventOptions,!!target);if(gestureConfig.enabled){new(EngineMap.get(gestureKey))(this,args,gestureKey).bind(bindFunction)}}const nativeBindFunction=bindToProps(props,sharedConfig.eventOptions,!!target);for(const eventKey in this.nativeHandlers)nativeBindFunction(eventKey,"",(event=>this.nativeHandlers[eventKey](_objectSpread2(_objectSpread2({},this.state.shared),{},{event,args}))),void 0,!0)}for(const handlerProp in props)props[handlerProp]=chain(...props[handlerProp]);if(!target)return props;for(const handlerProp in props){const{device,capture,passive}=parseProp(handlerProp);this._targetEventStore.add(target,device,"",props[handlerProp],{capture,passive})}}}}function setupGesture(ctrl,gestureKey){ctrl.gestures.add(gestureKey),ctrl.gestureEventStores[gestureKey]=new EventStore(ctrl,gestureKey),ctrl.gestureTimeoutStores[gestureKey]=new TimeoutStore}const bindToProps=(props,eventOptions,withPassiveOption)=>(device,action,handler,options={},isNative=!1)=>{var _options$capture,_options$passive;const capture=null!==(_options$capture=options.capture)&&void 0!==_options$capture?_options$capture:eventOptions.capture,passive=null!==(_options$passive=options.passive)&&void 0!==_options$passive?_options$passive:eventOptions.passive;let handlerProp=isNative?device:toHandlerProp(device,action,capture);withPassiveOption&&passive&&(handlerProp+="Passive"),props[handlerProp]=props[handlerProp]||[],props[handlerProp].push(handler)},RE_NOT_NATIVE=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function registerGesture(actions,handlers,handlerKey,key,internalHandlers,config){if(!actions.has(handlerKey))return;if(!EngineMap.has(key))return void 0;const startKey=handlerKey+"Start",endKey=handlerKey+"End";internalHandlers[key]=state=>{let memo;return state.first&&startKey in handlers&&handlers[startKey](state),handlerKey in handlers&&(memo=handlers[handlerKey](state)),state.last&&endKey in handlers&&handlers[endKey](state),memo},config[key]=config[key]||{}}function parseMergedHandlers(mergedHandlers,mergedConfig){const[handlers,nativeHandlers,actions]=function sortHandlers(_handlers){const native={},handlers={},actions=new Set;for(let key in _handlers)RE_NOT_NATIVE.test(key)?(actions.add(RegExp.lastMatch),handlers[key]=_handlers[key]):native[key]=_handlers[key];return[handlers,native,actions]}(mergedHandlers),internalHandlers={};return registerGesture(actions,handlers,"onDrag","drag",internalHandlers,mergedConfig),registerGesture(actions,handlers,"onWheel","wheel",internalHandlers,mergedConfig),registerGesture(actions,handlers,"onScroll","scroll",internalHandlers,mergedConfig),registerGesture(actions,handlers,"onPinch","pinch",internalHandlers,mergedConfig),registerGesture(actions,handlers,"onMove","move",internalHandlers,mergedConfig),registerGesture(actions,handlers,"onHover","hover",internalHandlers,mergedConfig),{handlers:internalHandlers,config:mergedConfig,nativeHandlers}}function useRecognizers(handlers,config={},gestureKey,nativeHandlers){const ctrl=react.useMemo((()=>new Controller(handlers)),[]);if(ctrl.applyHandlers(handlers,nativeHandlers),ctrl.applyConfig(config,gestureKey),react.useEffect(ctrl.effect.bind(ctrl)),react.useEffect((()=>ctrl.clean.bind(ctrl)),[]),void 0===config.target)return ctrl.bind.bind(ctrl)}function createUseGesture(actions){return actions.forEach(actions_fe213e88_esm_registerAction),function useGesture(_handlers,_config){const{handlers,nativeHandlers,config}=parseMergedHandlers(_handlers,_config||{});return useRecognizers(handlers,config,void 0,nativeHandlers)}}const MAX_ZOOM_STEP=10,IS_DARWIN=/Mac|iPod|iPhone|iPad/.test("undefined"==typeof window?"node":window.navigator.platform);function normalizeWheel(event){let{deltaY,deltaX}=event,deltaZ=0;return event.ctrlKey||event.altKey||event.metaKey?deltaZ=(Math.abs(deltaY)>MAX_ZOOM_STEP?MAX_ZOOM_STEP*Math.sign(deltaY):deltaY)/100:event.shiftKey&&!IS_DARWIN&&(deltaX=deltaY,deltaY=0),{x:-deltaX,y:-deltaY,z:-deltaZ}}const useGestureEvents_useGesture=createUseGesture([actions_fe213e88_esm_wheelAction,actions_fe213e88_esm_pinchAction]);let lastWheelTime;const isWheelEndEvent=time=>void 0===lastWheelTime?(lastWheelTime=time,!1):time-lastWheelTime>120&&time-lastWheelTime<160?(lastWheelTime=time,!0):(lastWheelTime=time,!1);function useGestureEvents(ref){const editor=useEditor_useEditor(),events=react.useMemo((()=>{let pinchState="not sure";let initDistanceBetweenFingers=1,initZoom=1,currDistanceBetweenFingers=0;const initPointBetweenFingers=new Vec,prevPointBetweenFingers=new Vec;return{onWheel:({event})=>{if(!editor.getInstanceState().isFocused)return;if(pinchState="not sure",isWheelEndEvent(Date.now()))return;const editingShapeId=editor.getEditingShapeId();if(editingShapeId){const shape=editor.getShape(editingShapeId);if(shape){if(editor.getShapeUtil(shape).canScroll(shape)){const bounds=editor.getShapePageBounds(editingShapeId);if(bounds?.containsPoint(editor.inputs.currentPagePoint))return}}}preventDefault(event),stopEventPropagation(event);const delta=normalizeWheel(event);if(0===delta.x&&0===delta.y)return;const info={type:"wheel",name:"wheel",delta,point:new Vec(event.clientX,event.clientY),shiftKey:event.shiftKey,altKey:event.altKey,ctrlKey:event.metaKey||event.ctrlKey,metaKey:event.metaKey,accelKey:isAccelKey(event)};editor.dispatch(info)},onPinchStart:gesture=>{const elm=ref.current;pinchState="not sure";const{event,origin,da}=gesture;event instanceof WheelEvent||(event.target===elm||elm?.contains(event.target))&&(prevPointBetweenFingers.x=origin[0],prevPointBetweenFingers.y=origin[1],initPointBetweenFingers.x=origin[0],initPointBetweenFingers.y=origin[1],initDistanceBetweenFingers=da[0],initZoom=editor.getZoomLevel(),editor.dispatch({type:"pinch",name:"pinch_start",point:{x:origin[0],y:origin[1],z:editor.getZoomLevel()},delta:{x:0,y:0},shiftKey:event.shiftKey,altKey:event.altKey,ctrlKey:event.metaKey||event.ctrlKey,metaKey:event.metaKey,accelKey:isAccelKey(event)}))},onPinchEnd:gesture=>{const elm=ref.current,{event,origin,offset}=gesture;if(event instanceof WheelEvent)return;if(event.target!==elm&&!elm?.contains(event.target))return;const scale=offset[0]**editor.getCameraOptions().zoomSpeed;pinchState="not sure",editor.timers.requestAnimationFrame((()=>{editor.dispatch({type:"pinch",name:"pinch_end",point:{x:origin[0],y:origin[1],z:scale},delta:{x:origin[0],y:origin[1]},shiftKey:event.shiftKey,altKey:event.altKey,ctrlKey:event.metaKey||event.ctrlKey,metaKey:event.metaKey,accelKey:isAccelKey(event)})}))},onPinch:gesture=>{const elm=ref.current,{event,origin,offset,da}=gesture;if(event instanceof WheelEvent)return;if(event.target!==elm&&!elm?.contains(event.target))return;const isSafariTrackpadPinch="gesturechange"===gesture.type||"gestureend"===gesture.type;currDistanceBetweenFingers=da[0];const dx=origin[0]-prevPointBetweenFingers.x,dy=origin[1]-prevPointBetweenFingers.y;switch(prevPointBetweenFingers.x=origin[0],prevPointBetweenFingers.y=origin[1],(isSafariTrackpadPinch=>{if(isSafariTrackpadPinch&&(pinchState="zooming"),"zooming"===pinchState)return;const touchDistance=Math.abs(currDistanceBetweenFingers-initDistanceBetweenFingers),originDistance=Vec.Dist(initPointBetweenFingers,prevPointBetweenFingers);switch(pinchState){case"not sure":touchDistance>24?pinchState="zooming":originDistance>16&&(pinchState="panning");break;case"panning":touchDistance>64&&(pinchState="zooming")}})(isSafariTrackpadPinch),pinchState){case"zooming":{const currZoom=offset[0]**editor.getCameraOptions().zoomSpeed;editor.dispatch({type:"pinch",name:"pinch",point:{x:origin[0],y:origin[1],z:currZoom},delta:{x:dx,y:dy},shiftKey:event.shiftKey,altKey:event.altKey,ctrlKey:event.metaKey||event.ctrlKey,metaKey:event.metaKey,accelKey:isAccelKey(event)});break}case"panning":editor.dispatch({type:"pinch",name:"pinch",point:{x:origin[0],y:origin[1],z:initZoom},delta:{x:dx,y:dy},shiftKey:event.shiftKey,altKey:event.altKey,ctrlKey:event.metaKey||event.ctrlKey,metaKey:event.metaKey,accelKey:isAccelKey(event)})}}}}),[editor,ref]);useGestureEvents_useGesture(events,{target:ref,eventOptions:{passive:!1},pinch:{from:()=>{const{zoomSpeed}=editor.getCameraOptions();return[editor.getZoomLevel()**(1/zoomSpeed),0]},scaleBounds:()=>{const baseZoom=editor.getBaseZoom(),{zoomSteps,zoomSpeed}=editor.getCameraOptions(),zoomMin=zoomSteps[0]*baseZoom;return{max:(zoomSteps[zoomSteps.length-1]*baseZoom)**(1/zoomSpeed),min:zoomMin**(1/zoomSpeed)}}}})}function getHandle(editor,id,handleId){const shape=editor.getShape(id);return{shape,handle:editor.getShapeHandles(shape).find((h=>h.id===handleId))}}const getNearestScrollableContainer=element=>{let parent=element.parentElement;for(;parent;){if(parent===document.body)return document;const{overflowY}=window.getComputedStyle(parent);if(parent.scrollHeight>parent.clientHeight&&("auto"===overflowY||"scroll"===overflowY||"overlay"===overflowY))return parent;parent=parent.parentElement}return document};class Box{constructor(x=0,y=0,w=0,h=0){this.x=x,this.y=y,this.w=w,this.h=h}x=0;y=0;w=0;h=0;get point(){return new Vec(this.x,this.y)}set point(val){this.x=val.x,this.y=val.y}get minX(){return this.x}set minX(n){this.x=n}get left(){return this.x}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get right(){return this.x+this.w}get minY(){return this.y}set minY(n){this.y=n}get top(){return this.y}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get bottom(){return this.y+this.h}get width(){return this.w}set width(n){this.w=n}get height(){return this.h}set height(n){this.h=n}get aspectRatio(){return this.width/this.height}get center(){return new Vec(this.midX,this.midY)}set center(v){this.minX=v.x-this.width/2,this.minY=v.y-this.height/2}get corners(){return[new Vec(this.minX,this.minY),new Vec(this.maxX,this.minY),new Vec(this.maxX,this.maxY),new Vec(this.minX,this.maxY)]}get cornersAndCenter(){return[new Vec(this.minX,this.minY),new Vec(this.maxX,this.minY),new Vec(this.maxX,this.maxY),new Vec(this.minX,this.maxY),this.center]}get sides(){const{corners}=this;return[[corners[0],corners[1]],[corners[1],corners[2]],[corners[2],corners[3]],[corners[3],corners[0]]]}get size(){return new Vec(this.w,this.h)}toFixed(){return this.x=toPrecision(this.x),this.y=toPrecision(this.y),this.w=toPrecision(this.w),this.h=toPrecision(this.h),this}setTo(B){return this.x=B.x,this.y=B.y,this.w=B.w,this.h=B.h,this}set(x=0,y=0,w=0,h=0){return this.x=x,this.y=y,this.w=w,this.h=h,this}expand(A){const minX=Math.min(this.minX,A.minX),minY=Math.min(this.minY,A.minY),maxX=Math.max(this.maxX,A.maxX),maxY=Math.max(this.maxY,A.maxY);return this.x=minX,this.y=minY,this.w=maxX-minX,this.h=maxY-minY,this}expandBy(n){return this.x-=n,this.y-=n,this.w+=2*n,this.h+=2*n,this}scale(n){return this.x/=n,this.y/=n,this.w/=n,this.h/=n,this}clone(){const{x,y,w,h}=this;return new Box(x,y,w,h)}translate(delta){return this.x+=delta.x,this.y+=delta.y,this}snapToGrid(size){const minX=Math.round(this.minX/size)*size,minY=Math.round(this.minY/size)*size,maxX=Math.round(this.maxX/size)*size,maxY=Math.round(this.maxY/size)*size;this.minX=minX,this.minY=minY,this.width=Math.max(1,maxX-minX),this.height=Math.max(1,maxY-minY)}collides(B){return Box.Collides(this,B)}contains(B){return Box.Contains(this,B)}includes(B){return Box.Includes(this,B)}containsPoint(V,margin=0){return Box.ContainsPoint(this,V,margin)}getHandlePoint(handle){switch(handle){case"top_left":return new Vec(this.minX,this.minY);case"top_right":return new Vec(this.maxX,this.minY);case"bottom_left":return new Vec(this.minX,this.maxY);case"bottom_right":return new Vec(this.maxX,this.maxY);case"top":return new Vec(this.midX,this.minY);case"right":return new Vec(this.maxX,this.midY);case"bottom":return new Vec(this.midX,this.maxY);case"left":return new Vec(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(handle,dx,dy){const{minX:a0x,minY:a0y,maxX:a1x,maxY:a1y}=this;let{minX:b0x,minY:b0y,maxX:b1x,maxY:b1y}=this;switch(handle){case"left":case"top_left":case"bottom_left":b0x+=dx;break;case"right":case"top_right":case"bottom_right":b1x+=dx}switch(handle){case"top":case"top_left":case"top_right":b0y+=dy;break;case"bottom":case"bottom_left":case"bottom_right":b1y+=dy}if((b1x-b0x)/(a1x-a0x)<0){const t=b1x;b1x=b0x,b0x=t}if((b1y-b0y)/(a1y-a0y)<0){const t=b1y;b1y=b0y,b0y=t}this.minX=b0x,this.minY=b0y,this.width=Math.abs(b1x-b0x),this.height=Math.abs(b1y-b0y)}union(box){const minX=Math.min(this.minX,box.x),minY=Math.min(this.minY,box.y),maxX=Math.max(this.maxX,box.w+box.x),maxY=Math.max(this.maxY,box.h+box.y);return this.x=minX,this.y=minY,this.width=maxX-minX,this.height=maxY-minY,this}static From(box){return new Box(box.x,box.y,box.w,box.h)}static FromCenter(center,size){return new Box(center.x-size.x/2,center.y-size.y/2,size.x,size.y)}static FromPoints(points){if(0===points.length)return new Box;let point,minX=1/0,minY=1/0,maxX=-1/0,maxY=-1/0;for(let i=0,n=points.length;i<n;i++)point=points[i],minX=Math.min(point.x,minX),minY=Math.min(point.y,minY),maxX=Math.max(point.x,maxX),maxY=Math.max(point.y,maxY);return new Box(minX,minY,maxX-minX,maxY-minY)}static Expand(A,B){const minX=Math.min(B.minX,A.minX),minY=Math.min(B.minY,A.minY),maxX=Math.max(B.maxX,A.maxX),maxY=Math.max(B.maxY,A.maxY);return new Box(minX,minY,maxX-minX,maxY-minY)}static ExpandBy(A,n){return new Box(A.minX-n,A.minY-n,A.width+2*n,A.height+2*n)}static Collides(A,B){return!(A.maxX<B.minX||A.minX>B.maxX||A.maxY<B.minY||A.minY>B.maxY)}static Contains(A,B){return A.minX<B.minX&&A.minY<B.minY&&A.maxY>B.maxY&&A.maxX>B.maxX}static Includes(A,B){return Box.Collides(A,B)||Box.Contains(A,B)}static ContainsPoint(A,B,margin=0){return!(B.x<A.minX-margin||B.y<A.minY-margin||B.x>A.maxX+margin||B.y>A.maxY+margin)}static Common(boxes){let minX=1/0,minY=1/0,maxX=-1/0,maxY=-1/0;for(let i=0;i<boxes.length;i++){const B=boxes[i];minX=Math.min(minX,B.minX),minY=Math.min(minY,B.minY),maxX=Math.max(maxX,B.maxX),maxY=Math.max(maxY,B.maxY)}return new Box(minX,minY,maxX-minX,maxY-minY)}static Sides(A,inset=0){const{corners}=A;return[[corners[0],corners[1]],[corners[1],corners[2]],[corners[2],corners[3]],[corners[3],corners[0]]]}static Resize(box,handle,dx,dy,isAspectRatioLocked=!1){const{minX:a0x,minY:a0y,maxX:a1x,maxY:a1y}=box;let{minX:b0x,minY:b0y,maxX:b1x,maxY:b1y}=box;switch(handle){case"left":case"top_left":case"bottom_left":b0x+=dx;break;case"right":case"top_right":case"bottom_right":b1x+=dx}switch(handle){case"top":case"top_left":case"top_right":b0y+=dy;break;case"bottom":case"bottom_left":case"bottom_right":b1y+=dy}const scaleX=(b1x-b0x)/(a1x-a0x),scaleY=(b1y-b0y)/(a1y-a0y),flipX=scaleX<0,flipY=scaleY<0;if(isAspectRatioLocked){const aspectRatio=(a1x-a0x)/(a1y-a0y),bw=Math.abs(b1x-b0x),bh=Math.abs(b1y-b0y),tw=bw*(scaleY<0?1:-1)*(1/aspectRatio),th=bh*(scaleX<0?1:-1)*aspectRatio,isTall=aspectRatio<bw/bh;switch(handle){case"top_left":isTall?b0y=b1y+tw:b0x=b1x+th;break;case"top_right":isTall?b0y=b1y+tw:b1x=b0x-th;break;case"bottom_right":isTall?b1y=b0y-tw:b1x=b0x-th;break;case"bottom_left":isTall?b1y=b0y-tw:b0x=b1x+th;break;case"bottom":case"top":{const m=(b0x+b1x)/2,w=bh*aspectRatio;b0x=m-w/2,b1x=m+w/2;break}case"left":case"right":{const m=(b0y+b1y)/2,h=bw/aspectRatio;b0y=m-h/2,b1y=m+h/2;break}}}if(flipX){const t=b1x;b1x=b0x,b0x=t}if(flipY){const t=b1y;b1y=b0y,b0y=t}const final=new Box(b0x,b0y,Math.abs(b1x-b0x),Math.abs(b1y-b0y));return{box:final,scaleX:+(final.width/box.width*(scaleX>0?1:-1)).toFixed(5),scaleY:+(final.height/box.height*(scaleY>0?1:-1)).toFixed(5)}}equals(other){return Box.Equals(this,other)}static Equals(a,b){return b.x===a.x&&b.y===a.y&&b.w===a.w&&b.h===a.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(other){return new Box(other.x,other.y,Math.max(1,other.w),Math.max(1,other.h))}}class Mat{constructor(a,b,c,d,e,f){this.a=a,this.b=b,this.c=c,this.d=d,this.e=e,this.f=f}a=1;b=0;c=0;d=1;e=0;f=0;equals(m){return this===m||this.a===m.a&&this.b===m.b&&this.c===m.c&&this.d===m.d&&this.e===m.e&&this.f===m.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(m){const m2=m,{a,b,c,d,e,f}=this;return this.a=a*m2.a+c*m2.b,this.c=a*m2.c+c*m2.d,this.e=a*m2.e+c*m2.f+e,this.b=b*m2.a+d*m2.b,this.d=b*m2.c+d*m2.d,this.f=b*m2.e+d*m2.f+f,this}rotate(r,cx,cy){return 0===r?this:void 0===cx?this.multiply(Mat.Rotate(r)):this.translate(cx,cy).multiply(Mat.Rotate(r)).translate(-cx,-cy)}translate(x,y){return this.multiply(Mat.Translate(x,y))}scale(x,y){return this.multiply(Mat.Scale(x,y))}invert(){const{a,b,c,d,e,f}=this,denom=a*d-b*c;return this.a=d/denom,this.b=b/-denom,this.c=c/-denom,this.d=a/denom,this.e=(d*e-c*f)/-denom,this.f=(b*e-a*f)/denom,this}applyToPoint(point){return Mat.applyToPoint(this,point)}applyToPoints(points){return Mat.applyToPoints(this,points)}rotation(){return Mat.Rotation(this)}point(){return Mat.Point(this)}decomposed(){return Mat.Decompose(this)}toCssString(){return Mat.toCssString(this)}setTo(model){return Object.assign(this,model),this}decompose(){return Mat.Decompose(this)}clone(){return new Mat(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new Mat(1,0,0,1,0,0)}static Translate(x,y){return new Mat(1,0,0,1,x,y)}static Rotate(r,cx,cy){if(0===r)return Mat.Identity();const cosAngle=Math.cos(r),sinAngle=Math.sin(r),rotationMatrix=new Mat(cosAngle,sinAngle,-sinAngle,cosAngle,0,0);return void 0===cx?rotationMatrix:Mat.Compose(Mat.Translate(cx,cy),rotationMatrix,Mat.Translate(-cx,-cy))}static Scale(x,y,cx,cy){const scaleMatrix=new Mat(x,0,0,y,0,0);return void 0===cx?scaleMatrix:Mat.Translate(cx,cy).multiply(scaleMatrix).translate(-cx,-cy)}static Multiply(m1,m2){return{a:m1.a*m2.a+m1.c*m2.b,c:m1.a*m2.c+m1.c*m2.d,e:m1.a*m2.e+m1.c*m2.f+m1.e,b:m1.b*m2.a+m1.d*m2.b,d:m1.b*m2.c+m1.d*m2.d,f:m1.b*m2.e+m1.d*m2.f+m1.f}}static Inverse(m){const denom=m.a*m.d-m.b*m.c;return{a:m.d/denom,b:m.b/-denom,c:m.c/-denom,d:m.a/denom,e:(m.d*m.e-m.c*m.f)/-denom,f:(m.b*m.e-m.a*m.f)/denom}}static Absolute(m){const denom=m.a*m.d-m.b*m.c;return{a:m.d/denom,b:m.b/-denom,c:m.c/-denom,d:m.a/denom,e:(m.d*m.e-m.c*m.f)/denom,f:(m.b*m.e-m.a*m.f)/-denom}}static Compose(...matrices){const matrix=Mat.Identity();for(let i=0,n=matrices.length;i<n;i++)matrix.multiply(matrices[i]);return matrix}static Point(m){return new Vec(m.e,m.f)}static Rotation(m){let rotation;if(0!==m.a||0!==m.c){const hypotAc=(m.a*m.a+m.c*m.c)**.5;rotation=Math.acos(m.a/hypotAc)*(m.c>0?-1:1)}else if(0!==m.b||0!==m.d){const hypotBd=(m.b*m.b+m.d*m.d)**.5;rotation=HALF_PI+Math.acos(m.b/hypotBd)*(m.d>0?-1:1)}else rotation=0;return clampRadians(rotation)}static Decompose(m){let scaleX,scaleY,rotation;if(0!==m.a||0!==m.c){const hypotAc=(m.a*m.a+m.c*m.c)**.5;scaleX=hypotAc,scaleY=(m.a*m.d-m.b*m.c)/hypotAc,rotation=Math.acos(m.a/hypotAc)*(m.c>0?-1:1)}else if(0!==m.b||0!==m.d){const hypotBd=(m.b*m.b+m.d*m.d)**.5;scaleX=(m.a*m.d-m.b*m.c)/hypotBd,scaleY=hypotBd,rotation=HALF_PI+Math.acos(m.b/hypotBd)*(m.d>0?-1:1)}else scaleX=0,scaleY=0,rotation=0;return{x:m.e,y:m.f,scaleX,scaleY,rotation:clampRadians(rotation)}}static Smooth(m,precision=1e10){return m.a=Math.round(m.a*precision)/precision,m.b=Math.round(m.b*precision)/precision,m.c=Math.round(m.c*precision)/precision,m.d=Math.round(m.d*precision)/precision,m.e=Math.round(m.e*precision)/precision,m.f=Math.round(m.f*precision)/precision,m}static toCssString(m){return`matrix(${utils_toDomPrecision(m.a)}, ${utils_toDomPrecision(m.b)}, ${utils_toDomPrecision(m.c)}, ${utils_toDomPrecision(m.d)}, ${utils_toDomPrecision(m.e)}, ${utils_toDomPrecision(m.f)})`}static applyToPoint(m,point){return new Vec(m.a*point.x+m.c*point.y+m.e,m.b*point.x+m.d*point.y+m.f,point.z)}static applyToXY(m,x,y){return[m.a*x+m.c*y+m.e,m.b*x+m.d*y+m.f]}static applyToPoints(m,points){return points.map((point=>new Vec(m.a*point.x+m.c*point.y+m.e,m.b*point.x+m.d*point.y+m.f,point.z)))}static applyToBounds(m,box){return new Box(m.e+box.minX,m.f+box.minY,box.width,box.height)}static From(m){return new Mat(m.a,m.b,m.c,m.d,m.e,m.f)}static Cast(m){return m instanceof Mat?m:Mat.From(m)}}function gcd(a,b){return 0===b?a:gcd(b,a%b)}function nearestMultiple(float){const decimal=float.toString().split(".")[1];if(!decimal)return 1;const denominator=Math.pow(10,decimal.length);return denominator/gcd(parseInt(decimal,10),denominator)}function intersectLineSegmentLineSegment(a1,a2,b1,b2){const ABx=a1.x-b1.x,ABy=a1.y-b1.y,BVx=b2.x-b1.x,BVy=b2.y-b1.y,AVx=a2.x-a1.x,AVy=a2.y-a1.y,ua_t=BVx*ABy-BVy*ABx,ub_t=AVx*ABy-AVy*ABx,u_b=BVy*AVx-BVx*AVy;if(0===ua_t||0===ub_t)return null;if(0===u_b)return null;if(0!==u_b){const ua=ua_t/u_b,ub=ub_t/u_b;if(0<=ua&&ua<=1&&0<=ub&&ub<=1)return Vec.AddXY(a1,ua*AVx,ua*AVy)}return null}function intersectLineSegmentCircle(a1,a2,c,r){const a=(a2.x-a1.x)*(a2.x-a1.x)+(a2.y-a1.y)*(a2.y-a1.y),b=2*((a2.x-a1.x)*(a1.x-c.x)+(a2.y-a1.y)*(a1.y-c.y)),deter=b*b-4*a*(c.x*c.x+c.y*c.y+a1.x*a1.x+a1.y*a1.y-2*(c.x*a1.x+c.y*a1.y)-r*r);if(deter<0)return null;if(0===deter)return null;const e=Math.sqrt(deter),u1=(-b+e)/(2*a),u2=(-b-e)/(2*a);if((u1<0||u1>1)&&(u2<0||u2>1))return null;const result=[];return 0<=u1&&u1<=1&&result.push(Vec.Lrp(a1,a2,u1)),0<=u2&&u2<=1&&result.push(Vec.Lrp(a1,a2,u2)),0===result.length?null:result}function intersectLineSegmentPolygon(a1,a2,points){const result=[];let segmentIntersection;for(let i=1,n=points.length;i<n+1;i++)segmentIntersection=intersectLineSegmentLineSegment(a1,a2,points[i-1],points[i%points.length]),segmentIntersection&&result.push(segmentIntersection);return 0===result.length?null:result}function intersectCircleCircle(c1,r1,c2,r2){let dx=c2.x-c1.x,dy=c2.y-c1.y;const d=Math.sqrt(dx*dx+dy*dy),x=(d*d-r2*r2+r1*r1)/(2*d),y=Math.sqrt(r1*r1-x*x);return dx/=d,dy/=d,[new Vec(c1.x+dx*x-dy*y,c1.y+dy*x+dx*y),new Vec(c1.x+dx*x+dy*y,c1.y+dy*x-dx*y)]}function ccw(A,B,C){return(C.y-A.y)*(B.x-A.x)>(B.y-A.y)*(C.x-A.x)}function linesIntersect(A,B,C,D){return ccw(A,C,D)!==ccw(B,C,D)&&ccw(A,B,C)!==ccw(A,B,D)}function intersectPolygonPolygon(polygonA,polygonB){const result=new Map;let a,b,c,d;for(let i=0,n=polygonA.length;i<n;i++)if(a=polygonA[i],pointInPolygon(a,polygonB)){const id=getPointId(a);result.has(id)||result.set(id,a)}for(let i=0,n=polygonB.length;i<n;i++)if(a=polygonB[i],pointInPolygon(a,polygonA)){const id=getPointId(a);result.has(id)||result.set(id,a)}for(let i=0,n=polygonA.length;i<n;i++){a=polygonA[i],b=polygonA[(i+1)%polygonA.length];for(let j=0,m=polygonB.length;j<m;j++){c=polygonB[j],d=polygonB[(j+1)%polygonB.length];const intersection=intersectLineSegmentLineSegment(a,b,c,d);if(null!==intersection){const id=getPointId(intersection);result.has(id)||result.set(id,intersection)}}}return 0===result.size?null:function orderClockwise(points){const C=Vec.Average(points);return points.sort(((A,B)=>Vec.Angle(C,A)-Vec.Angle(C,B)))}([...result.values()])}function intersectPolys(polyA,polyB,isAClosed,isBClosed){const result=new Map;for(let i=0,n=isAClosed?polyA.length:polyA.length-1;i<n;i++){const currentA=polyA[i],nextA=polyA[(i+1)%polyA.length];for(let j=0,m=isBClosed?polyB.length:polyB.length-1;j<m;j++){const intersection=intersectLineSegmentLineSegment(currentA,nextA,polyB[j],polyB[(j+1)%polyB.length]);if(null!==intersection){const id=getPointId(intersection);result.has(id)||result.set(id,intersection)}}}return[...result.values()]}function getPointId(point){return`${point.x},${point.y}`}function polygonsIntersect(a,b){let a0,a1,b0,b1;for(let i=0,n=a.length;i<n;i++){a0=a[i],a1=a[(i+1)%n];for(let j=0,m=b.length;j<m;j++)if(b0=b[j],b1=b[(j+1)%m],linesIntersect(a0,a1,b0,b1))return!0}return!1}function polygonIntersectsPolyline(polygon,polyline){let a,b,c,d;for(let i=0,n=polygon.length;i<n;i++){a=polygon[i],b=polygon[(i+1)%n];for(let j=1,m=polyline.length;j<m;j++)if(c=polyline[j-1],d=polyline[j],linesIntersect(a,b,c,d))return!0}return!1}const Geometry2dFilters={EXCLUDE_NON_STANDARD:{includeLabels:!1,includeInternal:!1},INCLUDE_ALL:{includeLabels:!0,includeInternal:!0},EXCLUDE_LABELS:{includeLabels:!1,includeInternal:!0},EXCLUDE_INTERNAL:{includeLabels:!0,includeInternal:!1}};class Geometry2d{isFilled=!1;isClosed=!0;isLabel=!1;isInternal=!1;debugColor;ignore;constructor(opts){this.isFilled=opts.isFilled,this.isClosed=opts.isClosed,this.isLabel=opts.isLabel??!1,this.isInternal=opts.isInternal??!1,this.debugColor=opts.debugColor,this.ignore=opts.ignore}isExcludedByFilter(filters){return!!filters&&(!(!this.isLabel||filters.includeLabels)||!(!this.isInternal||filters.includeInternal))}hitTestPoint(point,margin=0,hitInside=!1,_filters){return!(!this.isClosed||!this.isFilled&&!hitInside||!pointInPolygon(point,this.vertices))||Vec.Dist2(point,this.nearestPoint(point))<=margin*margin}distanceToPoint(point,hitInside=!1,filters){return Vec.Dist(point,this.nearestPoint(point,filters))*(this.isClosed&&(this.isFilled||hitInside)&&pointInPolygon(point,this.vertices)?-1:1)}distanceToLineSegment(A,B,filters){if(Vec.Equals(A,B))return this.distanceToPoint(A,!1,filters);const{vertices}=this;let nearest,d,p,q,dist=1/0;for(let i=0;i<vertices.length;i++)p=vertices[i],q=Vec.NearestPointOnLineSegment(A,B,p,!0),d=Vec.Dist2(p,q),d<dist&&(dist=d,nearest=q);if(!nearest)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&pointInPolygon(nearest,this.vertices)?-dist:dist}hitTestLineSegment(A,B,distance=0,filters){return this.distanceToLineSegment(A,B,filters)<=distance}intersectLineSegment(A,B,_filters){return(this.isClosed?intersectLineSegmentPolygon(A,B,this.vertices):function intersectLineSegmentPolyline(a1,a2,points){const result=[];let segmentIntersection;for(let i=0,n=points.length-1;i<n;i++)segmentIntersection=intersectLineSegmentLineSegment(a1,a2,points[i],points[i+1]),segmentIntersection&&result.push(segmentIntersection);return 0===result.length?null:result}(A,B,this.vertices))??[]}intersectCircle(center,radius,_filters){return(this.isClosed?function intersectCirclePolygon(c,r,points){const result=[];let a,b,int;for(let i=0,n=points.length;i<n;i++)a=points[i],b=points[(i+1)%points.length],int=intersectLineSegmentCircle(a,b,c,r),int&&result.push(...int);return 0===result.length?null:result}(center,radius,this.vertices):function intersectCirclePolyline(c,r,points){const result=[];let a,b,int;for(let i=1,n=points.length;i<n;i++)a=points[i-1],b=points[i],int=intersectLineSegmentCircle(a,b,c,r),int&&result.push(...int);return 0===result.length?null:result}(center,radius,this.vertices))??[]}intersectPolygon(polygon,_filters){return intersectPolys(polygon,this.vertices,!0,this.isClosed)}intersectPolyline(polyline,_filters){return intersectPolys(polyline,this.vertices,!1,this.isClosed)}interpolateAlongEdge(t,_filters){const{vertices}=this;if(t<=0)return vertices[0];const distanceToTravel=t*this.length;let distanceTraveled=0;for(let i=0;i<(this.isClosed?vertices.length:vertices.length-1);i++){const curr=vertices[i],next=vertices[(i+1)%vertices.length],newDistanceTraveled=distanceTraveled+Vec.Dist(curr,next);if(newDistanceTraveled>=distanceToTravel){return Vec.Lrp(curr,next,(0,dist_esm.Fg)(distanceTraveled,newDistanceTraveled,distanceToTravel))}distanceTraveled=newDistanceTraveled}return this.isClosed?vertices[0]:vertices[vertices.length-1]}uninterpolateAlongEdge(point,_filters){const{vertices,length}=this;let closestSegment=null,closestDistance=1/0,distanceTraveled=0;for(let i=0;i<(this.isClosed?vertices.length:vertices.length-1);i++){const curr=vertices[i],next=vertices[(i+1)%vertices.length],nearestPoint=Vec.NearestPointOnLineSegment(curr,next,point,!0),distance=Vec.Dist(nearestPoint,point);distance<closestDistance&&(closestDistance=distance,closestSegment={start:curr,end:next,nearestPoint,distanceToStart:distanceTraveled}),distanceTraveled+=Vec.Dist(curr,next)}(0,dist_esm.vA)(closestSegment);return(closestSegment.distanceToStart+Vec.Dist(closestSegment.start,closestSegment.nearestPoint))/length}nearestPointOnLineSegment(A,B){const{vertices}=this;let nearest,d,p,q,dist=1/0;for(let i=0;i<vertices.length;i++)p=vertices[i],q=Vec.NearestPointOnLineSegment(A,B,p,!0),d=Vec.Dist2(p,q),d<dist&&(dist=d,nearest=q);if(!nearest)throw Error("nearest point not found");return nearest}isPointInBounds(point,margin=0){const{bounds}=this;return!(point.x<bounds.minX-margin||point.y<bounds.minY-margin||point.x>bounds.maxX+margin||point.y>bounds.maxY+margin)}transform(transform,opts){return new TransformedGeometry2d(this,transform,opts)}_vertices;get vertices(){return this._vertices||(this._vertices=this.getVertices(Geometry2dFilters.EXCLUDE_LABELS)),this._vertices}getBounds(){return Box.FromPoints(this.vertices)}_bounds;get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}_area;get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices}=this;let area=0;for(let i=0,n=vertices.length;i<n;i++){const curr=vertices[i],next=vertices[(i+1)%n];area+=curr.x*next.y-next.x*curr.y}return area/2}toSimpleSvgPath(){let path="";const{vertices}=this,n=vertices.length;if(0===n)return path;path+=`M${vertices[0].x},${vertices[0].y}`;for(let i=1;i<n;i++)path+=`L${vertices[i].x},${vertices[i].y}`;return this.isClosed&&(path+="Z"),path}_length;get length(){return this._length||(this._length=this.getLength(Geometry2dFilters.EXCLUDE_LABELS)),this._length}getLength(_filters){const vertices=this.getVertices(_filters??Geometry2dFilters.EXCLUDE_LABELS);if(0===vertices.length)return 0;let prev=vertices[0],length=0;for(let i=1;i<vertices.length;i++){const next=vertices[i];length+=Vec.Dist(prev,next),prev=next}return this.isClosed&&(length+=Vec.Dist(vertices[vertices.length-1],vertices[0])),length}}class TransformedGeometry2d extends Geometry2d{constructor(geometry,matrix,opts){super(geometry),this.geometry=geometry,this.matrix=matrix,this.inverse=Mat.Inverse(matrix),this.decomposed=Mat.Decompose(matrix),opts&&(null!=opts.isLabel&&(this.isLabel=opts.isLabel),null!=opts.isInternal&&(this.isInternal=opts.isInternal),null!=opts.debugColor&&(this.debugColor=opts.debugColor),null!=opts.ignore&&(this.ignore=opts.ignore)),(0,dist_esm.vA)(approximately(this.decomposed.scaleX,this.decomposed.scaleY),"non-uniform scaling is not yet supported")}inverse;decomposed;getVertices(filters){return this.geometry.getVertices(filters).map((v=>Mat.applyToPoint(this.matrix,v)))}nearestPoint(point,filters){return Mat.applyToPoint(this.matrix,this.geometry.nearestPoint(Mat.applyToPoint(this.inverse,point),filters))}hitTestPoint(point,margin=0,hitInside,filters){return this.geometry.hitTestPoint(Mat.applyToPoint(this.inverse,point),margin/this.decomposed.scaleX,hitInside,filters)}distanceToPoint(point,hitInside=!1,filters){return this.geometry.distanceToPoint(Mat.applyToPoint(this.inverse,point),hitInside,filters)*this.decomposed.scaleX}distanceToLineSegment(A,B,filters){return this.geometry.distanceToLineSegment(Mat.applyToPoint(this.inverse,A),Mat.applyToPoint(this.inverse,B),filters)*this.decomposed.scaleX}hitTestLineSegment(A,B,distance=0,filters){return this.geometry.hitTestLineSegment(Mat.applyToPoint(this.inverse,A),Mat.applyToPoint(this.inverse,B),distance/this.decomposed.scaleX,filters)}intersectLineSegment(A,B,filters){return Mat.applyToPoints(this.matrix,this.geometry.intersectLineSegment(Mat.applyToPoint(this.inverse,A),Mat.applyToPoint(this.inverse,B),filters))}intersectCircle(center,radius,filters){return Mat.applyToPoints(this.matrix,this.geometry.intersectCircle(Mat.applyToPoint(this.inverse,center),radius/this.decomposed.scaleX,filters))}intersectPolygon(polygon,filters){return Mat.applyToPoints(this.matrix,this.geometry.intersectPolygon(Mat.applyToPoints(this.inverse,polygon),filters))}intersectPolyline(polyline,filters){return Mat.applyToPoints(this.matrix,this.geometry.intersectPolyline(Mat.applyToPoints(this.inverse,polyline),filters))}transform(transform,opts){return new TransformedGeometry2d(this.geometry,Mat.Multiply(transform,this.matrix),{isLabel:opts?.isLabel??this.isLabel,isInternal:opts?.isInternal??this.isInternal,debugColor:opts?.debugColor??this.debugColor,ignore:opts?.ignore??this.ignore})}getSvgPathData(){throw new Error("Cannot get SVG path data for transformed geometry.")}}class Group2d extends Geometry2d{children=[];ignoredChildren=[];constructor(config){super({...config,isClosed:!0,isFilled:!1});for(const child of config.children)child.ignore?this.ignoredChildren.push(child):this.children.push(child);if(0===this.children.length)throw Error("Group2d must have at least one child")}getVertices(filters){return this.isExcludedByFilter(filters)?[]:this.children.filter((c=>!c.isExcludedByFilter(filters))).flatMap((c=>c.getVertices(filters)))}nearestPoint(point,filters){let nearest,dist=1/0;const{children}=this;if(0===children.length)throw Error("no children");let p,d;for(const child of children)child.isExcludedByFilter(filters)||(p=child.nearestPoint(point,filters),d=Vec.Dist2(p,point),d<dist&&(dist=d,nearest=p));if(!nearest)throw Error("nearest point not found");return nearest}distanceToPoint(point,hitInside=!1,filters){let smallestDistance=1/0;for(const child of this.children){if(child.isExcludedByFilter(filters))continue;const distance=child.distanceToPoint(point,hitInside,filters);distance<smallestDistance&&(smallestDistance=distance)}return smallestDistance}hitTestPoint(point,margin,hitInside,filters=Geometry2dFilters.EXCLUDE_LABELS){return!!this.children.filter((c=>!c.isExcludedByFilter(filters))).find((c=>c.hitTestPoint(point,margin,hitInside)))}hitTestLineSegment(A,B,zoom,filters=Geometry2dFilters.EXCLUDE_LABELS){return!!this.children.filter((c=>!c.isExcludedByFilter(filters))).find((c=>c.hitTestLineSegment(A,B,zoom)))}intersectLineSegment(A,B,filters){return this.children.flatMap((child=>child.isExcludedByFilter(filters)?state_dist_esm.Ml:child.intersectLineSegment(A,B,filters)))}intersectCircle(center,radius,filters){return this.children.flatMap((child=>child.isExcludedByFilter(filters)?state_dist_esm.Ml:child.intersectCircle(center,radius,filters)))}intersectPolygon(polygon,filters){return this.children.flatMap((child=>child.isExcludedByFilter(filters)?state_dist_esm.Ml:child.intersectPolygon(polygon,filters)))}intersectPolyline(polyline,filters){return this.children.flatMap((child=>child.isExcludedByFilter(filters)?state_dist_esm.Ml:child.intersectPolyline(polyline,filters)))}interpolateAlongEdge(t,filters){const distanceToTravel=t*this.getLength(filters);let distanceTraveled=0;for(const child of this.children){if(child.isExcludedByFilter(filters))continue;const newDistanceTraveled=distanceTraveled+child.length;if(newDistanceTraveled>=distanceToTravel)return child.interpolateAlongEdge((0,dist_esm.Fg)(distanceTraveled,newDistanceTraveled,distanceToTravel),filters);distanceTraveled=newDistanceTraveled}return this.children[this.children.length-1].interpolateAlongEdge(1,filters)}uninterpolateAlongEdge(point,filters){const totalLength=this.getLength(filters);let closestChild=null,closestDistance=1/0,distanceTraveled=0;for(const child of this.children){if(child.isExcludedByFilter(filters))continue;const newDistanceTraveled=distanceTraveled+child.getLength(filters),distance=child.distanceToPoint(point,!1,filters);distance<closestDistance&&(closestDistance=distance,closestChild={startLength:distanceTraveled,endLength:newDistanceTraveled,child}),distanceTraveled=newDistanceTraveled}(0,dist_esm.vA)(closestChild);const normalizedDistanceInChild=closestChild.child.uninterpolateAlongEdge(point,filters);return(0,dist_esm.Cc)(closestChild.startLength,closestChild.endLength,normalizedDistanceInChild)/totalLength}transform(transform){return new Group2d({children:this.children.map((c=>c.transform(transform))),isLabel:this.isLabel,debugColor:this.debugColor,ignore:this.ignore})}getArea(){return this.children[0].area}toSimpleSvgPath(){let path="";for(const child of this.children)path+=child.toSimpleSvgPath();const corners=Box.FromPoints(this.vertices).corners;for(let i=0,n=corners.length;i<n;i++){const corner=corners[i],prevCorner=corners[(i-1+n)%n],prevDist=corner.dist(prevCorner),nextCorner=corners[(i+1)%n],nextDist=corner.dist(nextCorner),A=corner.clone().lrp(prevCorner,4/prevDist),B=corner,C=corner.clone().lrp(nextCorner,4/nextDist);path+=`M${A.x},${A.y} L${B.x},${B.y} L${C.x},${C.y} `}return path}getLength(filters){let length=0;for(const child of this.children)child.isExcludedByFilter(filters)||(length+=child.length);return length}getSvgPathData(){return this.children.map(((c,i)=>c.isLabel?"":c.getSvgPathData(0===i))).join(" ")}}const GeometryDebuggingView=track((function GeometryDebuggingView2({showStroke=!0,showVertices=!0,showClosestPointOnOutline=!0}){const editor=useEditor_useEditor();!function useTick(isEnabled=!0){const[_,setTick]=(0,react.useState)(0),editor=useEditor_useEditor();(0,react.useEffect)((()=>{if(!isEnabled)return;const update=()=>setTick((tick=>tick+1));return editor.on("tick",update),()=>{editor.off("tick",update)}}),[editor,isEnabled])}(showClosestPointOnOutline);const zoomLevel=editor.getZoomLevel(),renderingShapes=editor.getRenderingShapes(),{inputs:{currentPagePoint}}=editor;return(0,jsx_runtime.jsx)("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:renderingShapes.map((result=>{const shape=editor.getShape(result.id);if("group"===shape.type)return null;const geometry=editor.getShapeGeometry(shape),pageTransform=editor.getShapePageTransform(shape),pointInShapeSpace=editor.getPointInShapeSpace(shape,currentPagePoint),nearestPointOnShape=geometry.nearestPoint(pointInShapeSpace),distanceToPoint=geometry.distanceToPoint(pointInShapeSpace,!0),dist=Math.abs(distanceToPoint)*zoomLevel,hitInside=distanceToPoint<0,{vertices}=geometry;return(0,jsx_runtime.jsxs)("g",{transform:pageTransform.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[showStroke&&(0,jsx_runtime.jsx)("g",{stroke:geometry.debugColor??"red",opacity:"1",strokeWidth:2/zoomLevel,fill:"none",children:(0,jsx_runtime.jsx)(GeometryStroke,{geometry})}),showVertices&&vertices.map(((v,i)=>(0,jsx_runtime.jsx)("circle",{cx:v.x,cy:v.y,r:2/zoomLevel,fill:`hsl(${(0,dist_esm.ww)(i,[0,vertices.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/zoomLevel},`v${i}`))),showClosestPointOnOutline&&dist<150&&(0,jsx_runtime.jsx)("line",{x1:nearestPointOnShape.x,y1:nearestPointOnShape.y,x2:pointInShapeSpace.x,y2:pointInShapeSpace.y,opacity:1-dist/150,stroke:hitInside?"goldenrod":"dodgerblue",strokeWidth:2/zoomLevel})]},result.id+"_outline")}))})}));function GeometryStroke({geometry}){return geometry instanceof Group2d?(0,jsx_runtime.jsx)("g",{stroke:geometry.debugColor,children:[...geometry.children,...geometry.ignoredChildren].map(((child,i)=>(0,jsx_runtime.jsx)(GeometryStroke,{geometry:child},i)))}):(0,jsx_runtime.jsx)("path",{d:geometry.toSimpleSvgPath(),stroke:geometry.debugColor})}function uniq(array){return(0,dist_esm.sb)(array)}function usePeerIds(){const editor=useEditor_useEditor(),$userIds=function useComputed(){const name=arguments[0],compute=arguments[1],opts=3===arguments.length?void 0:arguments[2],deps=3===arguments.length?arguments[2]:arguments[3];return(0,react.useMemo)((()=>(0,state_dist_esm.EW)(`useComputed(${name})`,compute,opts)),deps)}("userIds",(()=>uniq(editor.getCollaborators().map((p=>p.userId))).sort()),{isEqual:(a,b)=>a.join(",")===b.join?.(",")},[editor]);return useValue_useValue($userIds)}function usePresence(userId){const editor=useEditor_useEditor();return useValue_useValue(`latestPresence:${userId}`,(()=>editor.getCollaborators().find((c=>c.userId===userId))),[editor,userId])??null}const LiveCollaborators=track((function Collaborators(){return usePeerIds().map((id=>(0,jsx_runtime.jsx)(CollaboratorGuard,{collaboratorId:id},id)))})),CollaboratorGuard=track((function CollaboratorGuard2({collaboratorId}){const editor=useEditor_useEditor(),presence=usePresence(collaboratorId),collaboratorState=function useCollaboratorState(editor,latestPresence){const rLastActivityTimestamp=(0,react.useRef)(latestPresence?.lastActivityTimestamp??-1),[state,setState]=(0,react.useState)((()=>getStateFromElapsedTime(editor,Date.now()-rLastActivityTimestamp.current)));(0,react.useEffect)((()=>{const interval=editor.timers.setInterval((()=>{setState(getStateFromElapsedTime(editor,Date.now()-rLastActivityTimestamp.current))}),editor.options.collaboratorCheckIntervalMs);return()=>clearInterval(interval)}),[editor]),latestPresence&&(rLastActivityTimestamp.current=latestPresence.lastActivityTimestamp??1/0);return state}(editor,presence);if(!presence||presence.currentPageId!==editor.getCurrentPageId())return null;switch(collaboratorState){case"inactive":{const{followingUserId,highlightedUserIds}=editor.getInstanceState();if(followingUserId!==presence.userId&&!highlightedUserIds.includes(presence.userId))return null;break}case"idle":{const{highlightedUserIds}=editor.getInstanceState();if(presence.followingUserId===editor.user.getId()&&!presence.chatMessage&&!highlightedUserIds.includes(presence.userId))return null;break}}return(0,jsx_runtime.jsx)(Collaborator,{latestPresence:presence})})),Collaborator=track((function Collaborator2({latestPresence}){const editor=useEditor_useEditor(),{CollaboratorBrush,CollaboratorScribble,CollaboratorCursor,CollaboratorHint,CollaboratorShapeIndicator}=useEditorComponents(),zoomLevel=editor.getZoomLevel(),viewportPageBounds=editor.getViewportPageBounds(),{userId,chatMessage,brush,scribbles,selectedShapeIds,userName,cursor,color}=latestPresence;if(!cursor)return null;const isCursorInViewport=!(cursor.x<viewportPageBounds.minX-12/zoomLevel||cursor.y<viewportPageBounds.minY-16/zoomLevel||cursor.x>viewportPageBounds.maxX-12/zoomLevel||cursor.y>viewportPageBounds.maxY-16/zoomLevel);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[brush&&CollaboratorBrush?(0,jsx_runtime.jsx)(CollaboratorBrush,{className:"tl-collaborator__brush",userId,brush,color,opacity:.1},userId+"_brush"):null,isCursorInViewport&&CollaboratorCursor?(0,jsx_runtime.jsx)(CollaboratorCursor,{className:"tl-collaborator__cursor",userId,point:cursor,color,zoom:zoomLevel,name:"New User"!==userName?userName:null,chatMessage:chatMessage??""},userId+"_cursor"):CollaboratorHint?(0,jsx_runtime.jsx)(CollaboratorHint,{className:"tl-collaborator__cursor-hint",userId,point:cursor,color,zoom:zoomLevel,viewport:viewportPageBounds},userId+"_cursor_hint"):null,CollaboratorScribble&&scribbles.length?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:scribbles.map((scribble=>(0,jsx_runtime.jsx)(CollaboratorScribble,{className:"tl-collaborator__scribble",userId,scribble,color,zoom:zoomLevel,opacity:"laser"===scribble.color?.5:.1},userId+"_scribble_"+scribble.id)))}):null,CollaboratorShapeIndicator&&selectedShapeIds.filter((id=>!editor.isShapeHidden(id))).map((shapeId=>(0,jsx_runtime.jsx)(CollaboratorShapeIndicator,{className:"tl-collaborator__shape-indicator",userId,shapeId,color,opacity:.5},userId+"_"+shapeId)))]})}));function getStateFromElapsedTime(editor,elapsed){return elapsed>editor.options.collaboratorInactiveTimeoutMs?"inactive":elapsed>editor.options.collaboratorIdleTimeoutMs?"idle":"active"}function MenuClickCapture(){const editor=useEditor_useEditor(),isMenuOpen=useValue_useValue("is menu open",(()=>editor.menus.hasAnyOpenMenus()),[editor]),[isPointing,setIsPointing]=(0,react.useState)(!1),showElement=isMenuOpen||isPointing,canvasEvents=useCanvasEvents(),rPointerState=(0,react.useRef)({isDown:!1,isDragging:!1,start:new Vec}),handlePointerDown=(0,react.useCallback)((e=>{0===e.button&&(setIsPointing(!0),rPointerState.current={isDown:!0,isDragging:!1,start:new Vec(e.clientX,e.clientY)}),editor.menus.clearOpenMenus()}),[editor]),handlePointerMove=(0,react.useCallback)((e=>{if(rPointerState.current.isDown)if(rPointerState.current.isDragging)canvasEvents.onPointerMove?.(e);else if(Vec.Dist2(rPointerState.current.start,new Vec(e.clientX,e.clientY))>editor.options.dragDistanceSquared){rPointerState.current={...rPointerState.current,isDown:!0,isDragging:!0};const{x,y}=rPointerState.current.start;canvasEvents.onPointerDown?.({...e,clientX:x,clientY:y,button:0}),canvasEvents.onPointerMove?.(e)}}),[canvasEvents,editor]),handlePointerUp=(0,react.useCallback)((e=>{canvasEvents.onPointerUp?.(e),setIsPointing(!1),rPointerState.current={isDown:!1,isDragging:!1,start:new Vec(e.clientX,e.clientY)}}),[canvasEvents]);return showElement&&(0,jsx_runtime.jsx)("div",{className:"tlui-menu-click-capture","data-testid":"menu-click-capture.content",...canvasEvents,onPointerDown:handlePointerDown,onPointerMove:handlePointerMove,onPointerUp:handlePointerUp})}const areShapesContentEqual=(a,b)=>a.props===b.props&&a.meta===b.meta,Shape=(0,react.memo)((function Shape2({id,shape,util,index,backgroundIndex,opacity,dprMultiple}){const editor=useEditor_useEditor(),{ShapeErrorFallback}=useEditorComponents(),containerRef=(0,react.useRef)(null),bgContainerRef=(0,react.useRef)(null);(0,react.useEffect)((()=>(0,state_dist_esm.wv)("load fonts",(()=>{const fonts=editor.fonts.getShapeFontFaces(id);editor.fonts.requestFonts(fonts)}))),[editor,id]);const memoizedStuffRef=(0,react.useRef)({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});useQuickReactor("set shape stuff",(()=>{const shape2=editor.getShape(id);if(!shape2)return;const prev=memoizedStuffRef.current,clipPath=editor.getShapeClipPath(id)??"none";clipPath!==prev.clipPath&&(setStyleProperty(containerRef.current,"clip-path",clipPath),setStyleProperty(bgContainerRef.current,"clip-path",clipPath),prev.clipPath=clipPath);const pageTransform=editor.getShapePageTransform(id),transform=Mat.toCssString(pageTransform),bounds=editor.getShapeGeometry(shape2).bounds;transform!==prev.transform&&(setStyleProperty(containerRef.current,"transform",transform),setStyleProperty(bgContainerRef.current,"transform",transform),prev.transform=transform);const widthRemainder=bounds.w%dprMultiple,heightRemainder=bounds.h%dprMultiple,width=0===widthRemainder?bounds.w:bounds.w+(dprMultiple-widthRemainder),height=0===heightRemainder?bounds.h:bounds.h+(dprMultiple-heightRemainder);width===prev.width&&height===prev.height||(setStyleProperty(containerRef.current,"width",Math.max(width,dprMultiple)+"px"),setStyleProperty(containerRef.current,"height",Math.max(height,dprMultiple)+"px"),setStyleProperty(bgContainerRef.current,"width",Math.max(width,dprMultiple)+"px"),setStyleProperty(bgContainerRef.current,"height",Math.max(height,dprMultiple)+"px"),prev.width=width,prev.height=height)}),[editor]),(0,react.useLayoutEffect)((()=>{const container=containerRef.current,bgContainer=bgContainerRef.current;setStyleProperty(container,"opacity",opacity),setStyleProperty(bgContainer,"opacity",opacity),setStyleProperty(container,"z-index",index),setStyleProperty(bgContainer,"z-index",backgroundIndex)}),[opacity,index,backgroundIndex]),useQuickReactor("set display",(()=>{if(!editor.getShape(id))return;const isCulled=editor.getCulledShapes().has(id);isCulled!==memoizedStuffRef.current.isCulled&&(setStyleProperty(containerRef.current,"display",isCulled?"none":"block"),setStyleProperty(bgContainerRef.current,"display",isCulled?"none":"block"),memoizedStuffRef.current.isCulled=isCulled)}),[editor]);const annotateError=(0,react.useCallback)((error=>editor.annotateError(error,{origin:"shape",willCrashApp:!1})),[editor]);if(!shape)return null;const isFilledShape="fill"in shape.props&&"none"!==shape.props.fill;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[util.backgroundComponent&&(0,jsx_runtime.jsx)("div",{ref:bgContainerRef,className:"tl-shape tl-shape-background","data-shape-type":shape.type,"data-shape-id":shape.id,draggable:!1,children:(0,jsx_runtime.jsx)(OptionalErrorBoundary,{fallback:ShapeErrorFallback,onError:annotateError,children:(0,jsx_runtime.jsx)(InnerShapeBackground,{shape,util})})}),(0,jsx_runtime.jsx)("div",{ref:containerRef,className:"tl-shape","data-shape-type":shape.type,"data-shape-is-filled":isFilledShape,"data-shape-id":shape.id,draggable:!1,children:(0,jsx_runtime.jsx)(OptionalErrorBoundary,{fallback:ShapeErrorFallback,onError:annotateError,children:(0,jsx_runtime.jsx)(InnerShape,{shape,util})})})]})})),InnerShape=(0,react.memo)((function InnerShape2({shape,util}){return useStateTracking("InnerShape:"+shape.type,(()=>util.component(util.editor.store.unsafeGetWithoutCapture(shape.id))),[util,shape.id])}),((prev,next)=>areShapesContentEqual(prev.shape,next.shape)&&prev.util===next.util)),InnerShapeBackground=(0,react.memo)((function InnerShapeBackground2({shape,util}){return useStateTracking("InnerShape:"+shape.type,(()=>util.backgroundComponent?.(util.editor.store.unsafeGetWithoutCapture(shape.id))),[util,shape.id])}),((prev,next)=>prev.shape.props===next.shape.props&&prev.shape.meta===next.shape.meta&&prev.util===next.util));function DefaultCanvas({className}){const editor=useEditor_useEditor(),{SelectionBackground,Background,SvgDefs,ShapeIndicators}=useEditorComponents(),rCanvas=(0,react.useRef)(null),rHtmlLayer=(0,react.useRef)(null),rHtmlLayer2=(0,react.useRef)(null),container=useContainer();!function useScreenBounds(ref){const editor=useEditor_useEditor();(0,react.useLayoutEffect)((()=>{const updateBounds=(0,dist_esm.nF)((()=>{ref.current&&editor.updateViewportScreenBounds(ref.current)}),200,{trailing:!0}),interval=editor.timers.setInterval(updateBounds,1e3);window.addEventListener("resize",updateBounds);const resizeObserver=new ResizeObserver((entries=>{entries[0].contentRect&&updateBounds()})),container=ref.current;let scrollingParent=null;return container&&(resizeObserver.observe(container),scrollingParent=getNearestScrollableContainer(container),scrollingParent.addEventListener("scroll",updateBounds)),()=>{clearInterval(interval),window.removeEventListener("resize",updateBounds),resizeObserver.disconnect(),scrollingParent?.removeEventListener("scroll",updateBounds),updateBounds.cancel()}}),[editor,ref])}(rCanvas),function useDocumentEvents(){const editor=useEditor_useEditor(),container=useContainer(),isEditing=useValue_useValue("isEditing",(()=>editor.getEditingShapeId()),[editor]),isAppFocused=useValue_useValue("isFocused",(()=>editor.getIsFocused()),[editor]);(0,react.useEffect)((()=>{if(container)return container.addEventListener("dragover",onDrop),container.addEventListener("drop",onDrop),()=>{container.removeEventListener("dragover",onDrop),container.removeEventListener("drop",onDrop)};function onDrop(e){if(e.isSpecialRedispatchedEvent)return;preventDefault(e),stopEventPropagation(e);const cvs=container.querySelector(".tl-canvas");if(!cvs)return;const newEvent=new DragEvent(e.type,e);newEvent.isSpecialRedispatchedEvent=!0,cvs.dispatchEvent(newEvent)}}),[container]),(0,react.useEffect)((()=>{if("undefined"==typeof window||!("matchMedia"in window))return;let remove=null;const updatePixelRatio=()=>{null!=remove&&remove();const mqString=`(resolution: ${window.devicePixelRatio}dppx)`,media=matchMedia(mqString),safariCb=ev=>{"change"===ev.type&&updatePixelRatio()};media.addEventListener?media.addEventListener("change",updatePixelRatio):media.addListener&&media.addListener(safariCb),remove=()=>{media.removeEventListener?media.removeEventListener("change",updatePixelRatio):media.removeListener&&media.removeListener(safariCb)},editor.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return updatePixelRatio(),()=>{remove?.()}}),[editor]),(0,react.useEffect)((()=>{if(!isAppFocused)return;const handleKeyDown=e=>{if(!e.altKey||!editor.isIn("zoom")&&editor.getPath().endsWith(".idle")||areShortcutsDisabled(editor)||preventDefault(e),e.isKilled)return;e.isKilled=!0;const hasSelectedShapes=!!editor.getSelectedShapeIds().length;switch(e.key){case"=":case"-":case"0":if(e.metaKey||e.ctrlKey)return void preventDefault(e);break;case"Tab":if(areShortcutsDisabled(editor))return;hasSelectedShapes&&!isEditing&&preventDefault(e);break;case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":if(areShortcutsDisabled(editor))return;hasSelectedShapes&&(e.metaKey||e.ctrlKey)&&preventDefault(e);break;case",":return;case"Escape":if((editor.getEditingShape()||editor.getSelectedShapeIds().length>0)&&preventDefault(e),editor.menus.getOpenMenus().length>0)return;return void(editor.inputs.keys.has("Escape")||(editor.inputs.keys.add("Escape"),editor.cancel(),container.focus()));default:if(areShortcutsDisabled(editor))return}const info={type:"keyboard",name:e.repeat?"key_repeat":"key_down",key:e.key,code:e.code,shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,metaKey:e.metaKey,accelKey:isAccelKey(e)};editor.dispatch(info)},handleKeyUp=e=>{if(e.isKilled)return;if(e.isKilled=!0,areShortcutsDisabled(editor))return;if(","===e.key)return;const info={type:"keyboard",name:"key_up",key:e.key,code:e.code,shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,metaKey:e.metaKey,accelKey:isAccelKey(e)};editor.dispatch(info)};function handleTouchStart(e){if(container.contains(e.target)){const touchXPosition=e.touches[0].pageX,touchXRadius=e.touches[0].radiusX||0;(touchXPosition-touchXRadius<10||touchXPosition+touchXRadius>editor.getViewportScreenBounds().width-10)&&("BUTTON"===e.target?.tagName&&e.target?.click(),preventDefault(e))}}const handleWheel=e=>{container.contains(e.target)&&(e.ctrlKey||e.metaKey)&&preventDefault(e)};return container.addEventListener("touchstart",handleTouchStart,{passive:!1}),container.addEventListener("wheel",handleWheel,{passive:!1}),document.addEventListener("gesturestart",preventDefault),document.addEventListener("gesturechange",preventDefault),document.addEventListener("gestureend",preventDefault),container.addEventListener("keydown",handleKeyDown),container.addEventListener("keyup",handleKeyUp),()=>{container.removeEventListener("touchstart",handleTouchStart),container.removeEventListener("wheel",handleWheel),document.removeEventListener("gesturestart",preventDefault),document.removeEventListener("gesturechange",preventDefault),document.removeEventListener("gestureend",preventDefault),container.removeEventListener("keydown",handleKeyDown),container.removeEventListener("keyup",handleKeyUp)}}),[editor,container,isAppFocused,isEditing])}(),function useCoarsePointer(){const editor=useEditor_useEditor();(0,react.useEffect)((()=>{let isCoarse=editor.getInstanceState().isCoarsePointer;const handlePointerDown=e=>{const isCoarseEvent="mouse"!==e.pointerType;isCoarse!==isCoarseEvent&&(isCoarse=isCoarseEvent,editor.updateInstanceState({isCoarsePointer:isCoarseEvent}))};window.addEventListener("pointerdown",handlePointerDown,{capture:!0});const mql=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),isForcedFinePointer=tlenv.isFirefox&&!tlenv.isAndroid&&!tlenv.isIos,handleMediaQueryChange=()=>{const next=!isForcedFinePointer&&mql.matches;isCoarse===next&&(isCoarse=next,editor.updateInstanceState({isCoarsePointer:next}))};return mql&&(mql.addEventListener("change",handleMediaQueryChange),handleMediaQueryChange()),()=>{window.removeEventListener("pointerdown",handlePointerDown,{capture:!0}),mql&&mql.removeEventListener("change",handleMediaQueryChange)}}),[editor])}(),useGestureEvents(rCanvas),function useFixSafariDoubleTapZoomPencilEvents(ref){const editor=useEditor_useEditor();(0,react.useEffect)((()=>{const elm=ref.current;if(!elm)return;const handleEvent=e=>{if(e instanceof PointerEvent&&"pen"===e.pointerType){e.isKilled=!0;const{target}=e;if(IGNORED_TAGS.includes(target.tagName?.toLocaleLowerCase())||target.isContentEditable||editor.isIn("select.editing_shape"))return;preventDefault(e)}};return elm.addEventListener("touchstart",handleEvent),elm.addEventListener("touchend",handleEvent),()=>{elm.removeEventListener("touchstart",handleEvent),elm.removeEventListener("touchend",handleEvent)}}),[editor,ref])}(rCanvas);const rMemoizedStuff=(0,react.useRef)({lodDisableTextOutline:!1,allowTextOutline:!0});useQuickReactor("position layers",(function positionLayersWhenCameraMoves(){const{x,y,z}=editor.getCamera();if(rMemoizedStuff.current.allowTextOutline&&tlenv.isSafari&&(container.style.setProperty("--tl-text-outline","none"),rMemoizedStuff.current.allowTextOutline=!1),rMemoizedStuff.current.allowTextOutline&&z<editor.options.textShadowLod!==rMemoizedStuff.current.lodDisableTextOutline){const lodDisableTextOutline=z<editor.options.textShadowLod;container.style.setProperty("--tl-text-outline",lodDisableTextOutline?"none":"var(--tl-text-outline-reference)"),rMemoizedStuff.current.lodDisableTextOutline=lodDisableTextOutline}const offset=z>=1?(0,dist_esm.ww)(z,[1,8],[.125,.5],!0):(0,dist_esm.ww)(z,[.1,1],[-2,.125],!0),transform=`scale(${utils_toDomPrecision(z)}) translate(${utils_toDomPrecision(x+offset)}px,${utils_toDomPrecision(y+offset)}px)`;setStyleProperty(rHtmlLayer.current,"transform",transform),setStyleProperty(rHtmlLayer2.current,"transform",transform)}),[editor,container]);const events=useCanvasEvents(),shapeSvgDefs=useValue_useValue("shapeSvgDefs",(()=>{const shapeSvgDefsByKey=new Map;for(const util of(0,dist_esm.Ic)(editor.shapeUtils)){if(!util)return;const defs=util.getCanvasSvgDefs();for(const{key,component:Component}of defs)shapeSvgDefsByKey.has(key)||shapeSvgDefsByKey.set(key,(0,jsx_runtime.jsx)(Component,{},key))}return[...shapeSvgDefsByKey.values()]}),[editor]),hideShapes=useValue_useValue("debug_shapes",(()=>debugFlags.hideShapes.get()),[debugFlags]),debugSvg=useValue_useValue("debug_svg",(()=>debugFlags.debugSvg.get()),[debugFlags]),debugGeometry=useValue_useValue("debug_geometry",(()=>debugFlags.debugGeometry.get()),[debugFlags]),isEditingAnything=useValue_useValue("isEditingAnything",(()=>null!==editor.getEditingShapeId()),[editor]),isSelectingAnything=useValue_useValue("isSelectingAnything",(()=>!!editor.getSelectedShapeIds().length),[editor]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{ref:rCanvas,draggable:!1,"data-iseditinganything":isEditingAnything,"data-isselectinganything":isSelectingAnything,className:classnames_default()("tl-canvas",className),"data-testid":"canvas",...events,children:[(0,jsx_runtime.jsx)("svg",{className:"tl-svg-context",children:(0,jsx_runtime.jsxs)("defs",{children:[shapeSvgDefs,(0,jsx_runtime.jsx)(CursorDef,{}),(0,jsx_runtime.jsx)(CollaboratorHintDef,{}),SvgDefs&&(0,jsx_runtime.jsx)(SvgDefs,{})]})}),Background&&(0,jsx_runtime.jsx)("div",{className:"tl-background__wrapper",children:(0,jsx_runtime.jsx)(Background,{})}),(0,jsx_runtime.jsx)(GridWrapper,{}),(0,jsx_runtime.jsxs)("div",{ref:rHtmlLayer,className:"tl-html-layer tl-shapes",draggable:!1,children:[(0,jsx_runtime.jsx)(OnTheCanvasWrapper,{}),SelectionBackground&&(0,jsx_runtime.jsx)(SelectionBackgroundWrapper,{}),hideShapes?null:debugSvg?(0,jsx_runtime.jsx)(ShapesWithSVGs,{}):(0,jsx_runtime.jsx)(ShapesToDisplay,{})]}),(0,jsx_runtime.jsx)("div",{className:"tl-overlays",children:(0,jsx_runtime.jsxs)("div",{ref:rHtmlLayer2,className:"tl-html-layer",children:[debugGeometry?(0,jsx_runtime.jsx)(GeometryDebuggingView,{}):null,(0,jsx_runtime.jsx)(BrushWrapper,{}),(0,jsx_runtime.jsx)(ScribbleWrapper,{}),(0,jsx_runtime.jsx)(ZoomBrushWrapper,{}),ShapeIndicators&&(0,jsx_runtime.jsx)(ShapeIndicators,{}),(0,jsx_runtime.jsx)(HintedShapeIndicator,{}),(0,jsx_runtime.jsx)(SnapIndicatorWrapper,{}),(0,jsx_runtime.jsx)(SelectionForegroundWrapper,{}),(0,jsx_runtime.jsx)(HandlesWrapper,{}),(0,jsx_runtime.jsx)(OverlaysWrapper,{}),(0,jsx_runtime.jsx)(LiveCollaborators,{})]})}),(0,jsx_runtime.jsx)(MovingCameraHitTestBlocker,{})]}),(0,jsx_runtime.jsx)(MenuClickCapture,{}),(0,jsx_runtime.jsx)(InFrontOfTheCanvasWrapper,{})]})}function InFrontOfTheCanvasWrapper(){const{InFrontOfTheCanvas}=useEditorComponents();return InFrontOfTheCanvas?(0,jsx_runtime.jsx)(InFrontOfTheCanvas,{}):null}function GridWrapper(){const editor=useEditor_useEditor(),gridSize=useValue_useValue("gridSize",(()=>editor.getDocumentSettings().gridSize),[editor]),{x,y,z}=useValue_useValue("camera",(()=>editor.getCamera()),[editor]),isGridMode=useValue_useValue("isGridMode",(()=>editor.getInstanceState().isGridMode),[editor]),{Grid}=useEditorComponents();return Grid&&isGridMode?(0,jsx_runtime.jsx)(Grid,{x,y,z,size:gridSize}):null}function ScribbleWrapper(){const editor=useEditor_useEditor(),scribbles=useValue_useValue("scribbles",(()=>editor.getInstanceState().scribbles),[editor]),zoomLevel=useValue_useValue("zoomLevel",(()=>editor.getZoomLevel()),[editor]),{Scribble}=useEditorComponents();return Scribble&&scribbles.length?scribbles.map((scribble=>(0,jsx_runtime.jsx)(Scribble,{className:"tl-user-scribble",scribble,zoom:zoomLevel},scribble.id))):null}function BrushWrapper(){const editor=useEditor_useEditor(),brush=useValue_useValue("brush",(()=>editor.getInstanceState().brush),[editor]),{Brush}=useEditorComponents();return Brush&&brush?(0,jsx_runtime.jsx)(Brush,{className:"tl-user-brush",brush}):null}function ZoomBrushWrapper(){const editor=useEditor_useEditor(),zoomBrush=useValue_useValue("zoomBrush",(()=>editor.getInstanceState().zoomBrush),[editor]),{ZoomBrush}=useEditorComponents();return ZoomBrush&&zoomBrush?(0,jsx_runtime.jsx)(ZoomBrush,{className:"tl-user-brush tl-zoom-brush",brush:zoomBrush}):null}function SnapIndicatorWrapper(){const editor=useEditor_useEditor(),lines=useValue_useValue("snapLines",(()=>editor.snaps.getIndicators()),[editor]),zoomLevel=useValue_useValue("zoomLevel",(()=>editor.getZoomLevel()),[editor]),{SnapIndicator}=useEditorComponents();return SnapIndicator&&lines.length>0?lines.map((line=>(0,jsx_runtime.jsx)(SnapIndicator,{className:"tl-user-snapline",line,zoom:zoomLevel},line.id))):null}function HandlesWrapper(){const editor=useEditor_useEditor(),shapeIdWithHandles=useValue_useValue("handles shapeIdWithHandles",(()=>{const{isReadonly,isChangingStyle}=editor.getInstanceState();if(isReadonly||isChangingStyle)return!1;const onlySelectedShape=editor.getOnlySelectedShape();if(!onlySelectedShape)return!1;return!!editor.getShapeHandles(onlySelectedShape)&&onlySelectedShape.id}),[editor]);return shapeIdWithHandles?(0,jsx_runtime.jsx)(HandlesWrapperInner,{shapeId:shapeIdWithHandles}):null}function HandlesWrapperInner({shapeId}){const editor=useEditor_useEditor(),{Handles}=useEditorComponents(),zoomLevel=useValue_useValue("zoomLevel",(()=>editor.getZoomLevel()),[editor]),isCoarse=useValue_useValue("coarse pointer",(()=>editor.getInstanceState().isCoarsePointer),[editor]),transform=useValue_useValue("handles transform",(()=>editor.getShapePageTransform(shapeId)),[editor,shapeId]),handles=useValue_useValue("handles",(()=>{const handles2=editor.getShapeHandles(shapeId);if(!handles2)return null;const minDistBetweenVirtualHandlesAndRegularHandles=(isCoarse?editor.options.coarseHandleRadius:editor.options.handleRadius)/zoomLevel*2;return handles2.filter((handle=>"virtual"!==handle.type||!handles2.some((h=>h!==handle&&"vertex"===h.type&&Vec.Dist(handle,h)<minDistBetweenVirtualHandlesAndRegularHandles)))).sort((a=>"vertex"===a.type?1:-1))}),[editor,zoomLevel,isCoarse,shapeId]),isHidden=useValue_useValue("isHidden",(()=>editor.isShapeHidden(shapeId)),[editor,shapeId]);return Handles&&handles&&transform&&!isHidden?(0,jsx_runtime.jsx)(Handles,{children:(0,jsx_runtime.jsx)("g",{transform:Mat.toCssString(transform),children:handles.map((handle=>(0,jsx_runtime.jsx)(HandleWrapper,{shapeId,handle,zoom:zoomLevel,isCoarse},handle.id)))})}):null}function HandleWrapper({shapeId,handle,zoom,isCoarse}){const events=function useHandleEvents(id,handleId){const editor=useEditor_useEditor();return react.useMemo((()=>{let lastX,lastY;return{onPointerDown:e=>{if(e.isKilled)return;setPointerCapture(loopToHtmlElement(e.currentTarget),e);const{shape,handle}=getHandle(editor,id,handleId);handle&&editor.dispatch({type:"pointer",target:"handle",handle,shape,name:"pointer_down",...getPointerInfo(e)})},onPointerMove:e=>{if(e.isKilled)return;if(e.clientX===lastX&&e.clientY===lastY)return;lastX=e.clientX,lastY=e.clientY;const{shape,handle}=getHandle(editor,id,handleId);handle&&editor.dispatch({type:"pointer",target:"handle",handle,shape,name:"pointer_move",...getPointerInfo(e)})},onPointerUp:e=>{if(e.isKilled)return;releasePointerCapture(loopToHtmlElement(e.currentTarget),e);const{shape,handle}=getHandle(editor,id,handleId);handle&&editor.dispatch({type:"pointer",target:"handle",handle,shape,name:"pointer_up",...getPointerInfo(e)})}}}),[editor,id,handleId])}(shapeId,handle.id),{Handle}=useEditorComponents();return Handle?(0,jsx_runtime.jsx)("g",{role:"button","aria-label":handle.label||"handle",transform:`translate(${handle.x}, ${handle.y})`,...events,children:(0,jsx_runtime.jsx)(Handle,{shapeId,handle,zoom,isCoarse})}):null}function OverlaysWrapper(){const{Overlays}=useEditorComponents();return Overlays?(0,jsx_runtime.jsx)("div",{className:"tl-custom-overlays tl-overlays__item",children:(0,jsx_runtime.jsx)(Overlays,{})}):null}function ShapesWithSVGs(){const editor=useEditor_useEditor(),renderingShapes=useValue_useValue("rendering shapes",(()=>editor.getRenderingShapes()),[editor]),dprMultiple=useValue_useValue("dpr multiple",(()=>nearestMultiple(Math.floor(100*editor.getInstanceState().devicePixelRatio)/100)),[editor]);return renderingShapes.map((result=>(0,jsx_runtime.jsxs)(react.Fragment,{children:[(0,jsx_runtime.jsx)(Shape,{...result,dprMultiple}),(0,jsx_runtime.jsx)(DebugSvgCopy,{id:result.id,mode:"iframe"})]},result.id+"_fragment")))}function ReflowIfNeeded(){const editor=useEditor_useEditor(),culledShapesRef=(0,react.useRef)(new Set);return useQuickReactor("reflow for culled shapes",(()=>{const culledShapes=editor.getCulledShapes();if(culledShapesRef.current.size===culledShapes.size&&[...culledShapes].every((id=>culledShapesRef.current.has(id))))return;culledShapesRef.current=culledShapes;const canvas=document.getElementsByClassName("tl-canvas");if(0===canvas.length)return;canvas[0].offsetHeight}),[editor]),null}function ShapesToDisplay(){const editor=useEditor_useEditor(),renderingShapes=useValue_useValue("rendering shapes",(()=>editor.getRenderingShapes()),[editor]),dprMultiple=useValue_useValue("dpr multiple",(()=>nearestMultiple(Math.floor(100*editor.getInstanceState().devicePixelRatio)/100)),[editor]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[renderingShapes.map((result=>(0,jsx_runtime.jsx)(Shape,{...result,dprMultiple},result.id+"_shape"))),tlenv.isSafari&&(0,jsx_runtime.jsx)(ReflowIfNeeded,{})]})}function HintedShapeIndicator(){const editor=useEditor_useEditor(),{ShapeIndicator}=useEditorComponents(),ids=useValue_useValue("hinting shape ids",(()=>(0,dist_esm.Qq)(editor.getHintingShapeIds())),[editor]);return ids.length&&ShapeIndicator?ids.map((id=>(0,jsx_runtime.jsx)(ShapeIndicator,{className:"tl-user-indicator__hint",shapeId:id},id+"_hinting"))):null}function CursorDef(){return(0,jsx_runtime.jsxs)("g",{id:useSharedSafeId("cursor"),children:[(0,jsx_runtime.jsxs)("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[(0,jsx_runtime.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,jsx_runtime.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,jsx_runtime.jsxs)("g",{fill:"white",transform:"translate(-12,-12)",children:[(0,jsx_runtime.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,jsx_runtime.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,jsx_runtime.jsxs)("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[(0,jsx_runtime.jsx)("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),(0,jsx_runtime.jsx)("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function CollaboratorHintDef(){const cursorHintId=useSharedSafeId("cursor_hint");return(0,jsx_runtime.jsx)("path",{id:cursorHintId,fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function DebugSvgCopy({id,mode}){const editor=useEditor_useEditor(),[image,setImage]=(0,react.useState)(null),isInRoot=useValue_useValue("is in root",(()=>{const shape=editor.getShape(id);return shape?.parentId===editor.getCurrentPageId()}),[editor,id]);return(0,react.useEffect)((()=>{if(!isInRoot)return;let latest=null;const unsubscribe=(0,state_dist_esm.wv)("shape to svg",(async()=>{const renderId=Math.random();latest=renderId;const padding=editor.isShapeOfType(id,"frame")?0:10;let bounds=editor.getShapePageBounds(id);if(!bounds)return;bounds=bounds.clone().expandBy(padding);const result=await editor.getSvgString([id],{padding});if(latest!==renderId||!result)return;const svgDataUrl=`data:image/svg+xml;utf8,${encodeURIComponent(result.svg)}`;setImage({src:svgDataUrl,bounds})}));return()=>{latest=null,unsubscribe()}}),[editor,id,isInRoot]),isInRoot&&image?"iframe"===mode?(0,jsx_runtime.jsx)("iframe",{src:image.src,width:image.bounds.width,height:image.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,border:"none",transform:`translate(${image.bounds.x}px, ${image.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}}):(0,jsx_runtime.jsx)("img",{src:image.src,width:image.bounds.width,height:image.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${image.bounds.x}px, ${image.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}}):null}function SelectionForegroundWrapper(){const editor=useEditor_useEditor(),selectionRotation=useValue_useValue("selection rotation",(function getSelectionRotation(){return editor.getSelectionRotation()}),[editor]),selectionBounds=useValue_useValue("selection bounds",(()=>editor.getSelectionRotatedPageBounds()),[editor]),{SelectionForeground}=useEditorComponents();return selectionBounds&&SelectionForeground?(0,jsx_runtime.jsx)(SelectionForeground,{bounds:selectionBounds,rotation:selectionRotation}):null}function SelectionBackgroundWrapper(){const editor=useEditor_useEditor(),selectionRotation=useValue_useValue("selection rotation",(()=>editor.getSelectionRotation()),[editor]),selectionBounds=useValue_useValue("selection bounds",(()=>editor.getSelectionRotatedPageBounds()),[editor]),{SelectionBackground}=useEditorComponents();return selectionBounds&&SelectionBackground?(0,jsx_runtime.jsx)(SelectionBackground,{bounds:selectionBounds,rotation:selectionRotation}):null}function OnTheCanvasWrapper(){const{OnTheCanvas}=useEditorComponents();return OnTheCanvas?(0,jsx_runtime.jsx)(OnTheCanvas,{}):null}function MovingCameraHitTestBlocker(){const editor=useEditor_useEditor(),cameraState=useValue_useValue("camera state",(()=>editor.getCameraState()),[editor]);return(0,jsx_runtime.jsx)("div",{className:classnames_default()("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":"idle"===cameraState})})}function DefaultCollaboratorHint({className,zoom,point,color,viewport,opacity=1}){const rSvg=(0,react.useRef)(null);useTransform_useTransform(rSvg,clamp(point.x,viewport.minX+5/zoom,viewport.maxX-5/zoom),clamp(point.y,viewport.minY+5/zoom,viewport.maxY-5/zoom),1/zoom,Vec.Angle(viewport.center,point));const cursorHintId=useSharedSafeId("cursor_hint");return(0,jsx_runtime.jsxs)("svg",{ref:rSvg,className:classnames_default()("tl-overlays__item",className),children:[(0,jsx_runtime.jsx)("use",{href:`#${cursorHintId}`,color,strokeWidth:3,stroke:"var(--color-background)"}),(0,jsx_runtime.jsx)("use",{href:`#${cursorHintId}`,color,opacity})]})}const DefaultCursor=(0,react.memo)((function DefaultCursor2({className,zoom,point,color,name,chatMessage}){const rCursor=(0,react.useRef)(null);useTransform_useTransform(rCursor,point?.x,point?.y,1/zoom);const cursorId=useSharedSafeId("cursor");return point?(0,jsx_runtime.jsxs)("div",{ref:rCursor,className:classnames_default()("tl-overlays__item",className),children:[(0,jsx_runtime.jsx)("svg",{className:"tl-cursor",children:(0,jsx_runtime.jsx)("use",{href:`#${cursorId}`,color})}),chatMessage?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[name&&(0,jsx_runtime.jsx)("div",{className:"tl-nametag-title",style:{color},children:name}),(0,jsx_runtime.jsx)("div",{className:"tl-nametag-chat",style:{backgroundColor:color},children:chatMessage})]}):name&&(0,jsx_runtime.jsx)("div",{className:"tl-nametag",style:{backgroundColor:color},children:name})]}):null}));function DefaultGrid({x,y,z,size}){const id=useUniqueSafeId("grid"),editor=useEditor_useEditor(),{gridSteps}=editor.options;return(0,jsx_runtime.jsxs)("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[(0,jsx_runtime.jsx)("defs",{children:gridSteps.map((({min,mid,step},i)=>{const s=step*size*z,xo=.5+x*z,yo=.5+y*z,gxo=xo>0?xo%s:s+xo%s,gyo=yo>0?yo%s:s+yo%s,opacity=z<mid?(0,dist_esm.ww)(z,[min,mid],[0,1]):1;return(0,jsx_runtime.jsx)("pattern",{id:suffixSafeId(id,`${step}`),width:s,height:s,patternUnits:"userSpaceOnUse",children:(0,jsx_runtime.jsx)("circle",{className:"tl-grid-dot",cx:gxo,cy:gyo,r:1,opacity})},i)}))}),gridSteps.map((({step},i)=>(0,jsx_runtime.jsx)("rect",{width:"100%",height:"100%",fill:`url(#${id}_${step})`},i)))]})}function DefaultHandle({handle,isCoarse,className,zoom}){const editor=useEditor_useEditor(),br=(isCoarse?editor.options.coarseHandleRadius:editor.options.handleRadius)/zoom;if("clone"===handle.type){const fr2=3/zoom,path=`M0,${-fr2} A${fr2},${fr2} 0 0,1 0,${fr2}`,index=SIDES.indexOf(handle.id);return(0,jsx_runtime.jsxs)("g",{className:classnames_default()(`tl-handle tl-handle__${handle.type}`,className),children:[(0,jsx_runtime.jsx)("circle",{className:"tl-handle__bg",r:br}),(0,jsx_runtime.jsx)("path",{className:"tl-handle__fg",d:path,transform:`rotate(${90*index-90})`})]})}const fr=("create"===handle.type&&isCoarse?3:4)/Math.max(zoom,.25);return(0,jsx_runtime.jsxs)("g",{className:classnames_default()(`tl-handle tl-handle__${handle.type}`,className),children:[(0,jsx_runtime.jsx)("circle",{className:"tl-handle__bg",r:br}),(0,jsx_runtime.jsx)("circle",{className:"tl-handle__fg",r:fr})]})}const DefaultHandles=({children})=>(0,jsx_runtime.jsx)("svg",{className:"tl-user-handles tl-overlays__item",children}),DefaultLoadingScreen=()=>{const{Spinner}=useEditorComponents();return(0,jsx_runtime.jsx)(LoadingScreen,{children:Spinner?(0,jsx_runtime.jsx)(Spinner,{}):null})};function getSvgPathFromPoints(points,closed=!0){const len=points.length;if(len<2)return"";let a=points[0],b=points[1];if(2===len)return`M${precise(a)}L${precise(b)}`;let result="";for(let i=2,max=len-1;i<max;i++)a=points[i],b=points[i+1],result+=average(a,b);return closed?`M${average(points[0],points[1])}Q${precise(points[1])}${average(points[1],points[2])}T${result}${average(points[len-1],points[0])}${average(points[0],points[1])}Z`:`M${precise(points[0])}Q${precise(points[1])}${average(points[1],points[2])}${points.length>3?"T":""}${result}L${precise(points[len-1])}`}function DefaultScribble({scribble,zoom,color,opacity,className}){return scribble.points.length?(0,jsx_runtime.jsx)("svg",{className:className?classnames_default()("tl-overlays__item",className):className,children:(0,jsx_runtime.jsx)("path",{className:"tl-scribble",d:getSvgPathFromPoints(scribble.points,!1),stroke:color??`var(--color-${scribble.color})`,fill:"none",strokeWidth:8/zoom,opacity:opacity??scribble.opacity})}):null}function DefaultSelectionForeground({bounds,rotation}){const editor=useEditor_useEditor(),rSvg=(0,react.useRef)(null),onlyShape=useValue_useValue("only selected shape",(()=>editor.getOnlySelectedShape()),[editor]),expandOutlineBy=onlyShape?editor.getShapeUtil(onlyShape).expandSelectionOutlinePx(onlyShape):0;return useTransform_useTransform(rSvg,bounds?.x,bounds?.y,1,rotation,{x:-expandOutlineBy,y:-expandOutlineBy}),bounds=expandOutlineBy instanceof Box?bounds.clone().expand(expandOutlineBy).zeroFix():bounds.clone().expandBy(expandOutlineBy).zeroFix(),(0,jsx_runtime.jsx)("svg",{ref:rSvg,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:(0,jsx_runtime.jsx)("rect",{className:classnames_default()("tl-selection__fg__outline"),width:utils_toDomPrecision(bounds.width),height:utils_toDomPrecision(bounds.height)})})}const DefaultShapeErrorFallback=()=>(0,jsx_runtime.jsx)("div",{className:"tl-shape-error-boundary"}),EvenInnererIndicator=(0,react.memo)((({shape,util})=>useStateTracking("Indicator: "+shape.type,(()=>util.indicator(util.editor.store.unsafeGetWithoutCapture(shape.id))))),((prevProps,nextProps)=>prevProps.shape.props===nextProps.shape.props&&prevProps.shape.meta===nextProps.shape.meta)),InnerIndicator=(0,react.memo)((({editor,id})=>{const shape=useValue_useValue("shape for indicator",(()=>editor.store.get(id)),[editor,id]),{ShapeIndicatorErrorFallback}=useEditorComponents();return!shape||shape.isLocked?null:(0,jsx_runtime.jsx)(OptionalErrorBoundary,{fallback:ShapeIndicatorErrorFallback,onError:error=>editor.annotateError(error,{origin:"react.shapeIndicator",willCrashApp:!1}),children:(0,jsx_runtime.jsx)(EvenInnererIndicator,{shape,util:editor.getShapeUtil(shape)},shape.id)})})),DefaultShapeIndicator=(0,react.memo)((function DefaultShapeIndicator2({shapeId,className,color,hidden,opacity}){const editor=useEditor_useEditor(),rIndicator=(0,react.useRef)(null);return useQuickReactor("indicator transform",(()=>{if(hidden)return;const elm=rIndicator.current;if(!elm)return;const pageTransform=editor.getShapePageTransform(shapeId);pageTransform&&elm.style.setProperty("transform",pageTransform.toCssString())}),[editor,shapeId,hidden]),(0,react.useLayoutEffect)((()=>{const elm=rIndicator.current;elm&&elm.style.setProperty("display",hidden?"none":"block")}),[hidden]),(0,jsx_runtime.jsx)("svg",{ref:rIndicator,className:classnames_default()("tl-overlays__item",className),children:(0,jsx_runtime.jsx)("g",{className:"tl-shape-indicator",stroke:color??"var(--color-selected)",opacity,children:(0,jsx_runtime.jsx)(InnerIndicator,{editor,id:shapeId})})})})),DefaultShapeIndicatorErrorFallback=()=>(0,jsx_runtime.jsx)("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"}),DefaultShapeIndicators=(0,react.memo)((function DefaultShapeIndicators2({hideAll,showAll}){const editor=useEditor_useEditor();if(hideAll&&showAll)throw Error("You cannot set both hideAll and showAll props to true, cmon now");const rPreviousSelectedShapeIds=(0,react.useRef)(new Set),idsToDisplay=useValue_useValue("should display selected ids",(()=>{const prev=rPreviousSelectedShapeIds.current,next=new Set,instanceState=editor.getInstanceState(),isChangingStyle=instanceState.isChangingStyle,isIdleOrEditing=editor.isInAny("select.idle","select.editing_shape"),isInSelectState=editor.isInAny("select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","select.pointing_handle");if(isChangingStyle||!isIdleOrEditing&&!isInSelectState)return rPreviousSelectedShapeIds.current=next,next;for(const id of editor.getSelectedShapeIds())next.add(id);if(isIdleOrEditing&&instanceState.isHoveringCanvas&&!instanceState.isCoarsePointer){const hovered=editor.getHoveredShapeId();hovered&&next.add(hovered)}if(prev.size!==next.size)return rPreviousSelectedShapeIds.current=next,next;for(const id of next)if(!prev.has(id))return rPreviousSelectedShapeIds.current=next,next;return prev}),[editor]),renderingShapes=useValue_useValue("rendering shapes",(()=>editor.getRenderingShapes()),[editor]),{ShapeIndicator}=useEditorComponents();return ShapeIndicator?renderingShapes.map((({id})=>(0,jsx_runtime.jsx)(ShapeIndicator,{shapeId:id,hidden:!showAll&&(hideAll||!idsToDisplay.has(id))},id+"_indicator"))):null}));function PointsSnapIndicator({points,zoom}){const l=2.5/zoom,minX=points.reduce(((acc,p)=>Math.min(acc,p.x)),1/0),maxX=points.reduce(((acc,p)=>Math.max(acc,p.x)),-1/0),minY=points.reduce(((acc,p)=>Math.min(acc,p.y)),1/0),maxY=points.reduce(((acc,p)=>Math.max(acc,p.y)),-1/0);let firstX,firstY,secondX,secondY;return points.some((p=>p.x===minX&&p.y===minY))?(firstX=minX,firstY=minY,secondX=maxX,secondY=maxY):(firstX=minX,firstY=maxY,secondX=maxX,secondY=minY),(0,jsx_runtime.jsxs)("g",{className:"tl-snap-indicator",stroke:"lime",children:[(0,jsx_runtime.jsx)("line",{x1:firstX,y1:firstY,x2:secondX,y2:secondY}),points.map(((p,i)=>(0,jsx_runtime.jsx)("g",{transform:`translate(${p.x},${p.y})`,children:(0,jsx_runtime.jsx)("path",{className:"tl-snap-point",d:`M ${-l},${-l} L ${l},${l} M ${-l},${l} L ${l},${-l}`})},i)))]})}function GapsSnapIndicator({gaps,direction,zoom}){const l=3.5/zoom;let edgeIntersection=[-1/0,1/0],nextEdgeIntersection=null;const horizontal="horizontal"===direction;for(const gap of gaps)nextEdgeIntersection=rangeIntersection(edgeIntersection[0],edgeIntersection[1],horizontal?gap.startEdge[0].y:gap.startEdge[0].x,horizontal?gap.startEdge[1].y:gap.startEdge[1].x),nextEdgeIntersection&&(edgeIntersection=nextEdgeIntersection,nextEdgeIntersection=rangeIntersection(edgeIntersection[0],edgeIntersection[1],horizontal?gap.endEdge[0].y:gap.endEdge[0].x,horizontal?gap.endEdge[1].y:gap.endEdge[1].x),nextEdgeIntersection&&(edgeIntersection=nextEdgeIntersection));if(null===edgeIntersection)return null;const midPoint=(edgeIntersection[0]+edgeIntersection[1])/2;return(0,jsx_runtime.jsx)("g",{className:"tl-snap-indicator",stroke:"cyan",children:gaps.map((({startEdge,endEdge},i)=>(0,jsx_runtime.jsx)(react.Fragment,{children:horizontal?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("line",{x1:startEdge[0].x,y1:midPoint-2*l,x2:startEdge[1].x,y2:midPoint+2*l}),(0,jsx_runtime.jsx)("line",{x1:endEdge[0].x,y1:midPoint-2*l,x2:endEdge[1].x,y2:midPoint+2*l}),(0,jsx_runtime.jsx)("line",{x1:startEdge[0].x,y1:midPoint,x2:endEdge[0].x,y2:midPoint}),(0,jsx_runtime.jsx)("line",{x1:(startEdge[0].x+endEdge[0].x)/2,y1:midPoint-l,x2:(startEdge[0].x+endEdge[0].x)/2,y2:midPoint+l})]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("line",{x1:midPoint-2*l,y1:startEdge[0].y,x2:midPoint+2*l,y2:startEdge[1].y}),(0,jsx_runtime.jsx)("line",{x1:midPoint-2*l,y1:endEdge[0].y,x2:midPoint+2*l,y2:endEdge[1].y}),(0,jsx_runtime.jsx)("line",{x1:midPoint,y1:startEdge[0].y,x2:midPoint,y2:endEdge[0].y}),(0,jsx_runtime.jsx)("line",{x1:midPoint-l,y1:(startEdge[0].y+endEdge[0].y)/2,x2:midPoint+l,y2:(startEdge[0].y+endEdge[0].y)/2})]})},i)))})}function DefaultSnapIndicator({className,line,zoom}){return(0,jsx_runtime.jsx)("svg",{className:classnames_default()("tl-overlays__item",className),children:"points"===line.type?(0,jsx_runtime.jsx)(PointsSnapIndicator,{...line,zoom}):"gaps"===line.type?(0,jsx_runtime.jsx)(GapsSnapIndicator,{...line,zoom}):null})}function DefaultSpinner(){return(0,jsx_runtime.jsx)("svg",{width:16,height:16,viewBox:"0 0 16 16","aria-hidden":"false",children:(0,jsx_runtime.jsxs)("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[(0,jsx_runtime.jsx)("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),(0,jsx_runtime.jsx)("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:(0,jsx_runtime.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const DefaultSvgDefs=()=>null;function useIdentity(value,isEqual){const ref=(0,react.useRef)(value);return isEqual(value,ref.current)?ref.current:(ref.current=value,value)}const areNullableArraysShallowEqual=(a,b)=>(a??=null,b??=null,a===b||!(!a||!b)&&(0,dist_esm.vq)(a,b));function useShallowArrayIdentity(arr){return useIdentity(arr,areNullableArraysShallowEqual)}const areNullableObjectsShallowEqual=(a,b)=>(a??=null,b??=null,a===b||!(!a||!b)&&(0,dist_esm.zK)(a,b));function useIdentity_useShallowObjectIdentity(obj){return useIdentity(obj,areNullableObjectsShallowEqual)}const EditorComponentsContext=(0,react.createContext)(null);function EditorComponentsProvider({overrides={},children}){const _overrides=useIdentity_useShallowObjectIdentity(overrides),value=(0,react.useMemo)((()=>({Background:DefaultBackground,Brush:DefaultBrush,Canvas:DefaultCanvas,CollaboratorBrush:DefaultBrush,CollaboratorCursor:DefaultCursor,CollaboratorHint:DefaultCollaboratorHint,CollaboratorScribble:DefaultScribble,CollaboratorShapeIndicator:DefaultShapeIndicator,Cursor:DefaultCursor,Grid:DefaultGrid,Handle:DefaultHandle,Handles:DefaultHandles,InFrontOfTheCanvas:null,LoadingScreen:DefaultLoadingScreen,OnTheCanvas:null,Overlays:null,Scribble:DefaultScribble,SelectionBackground:null,SelectionForeground:DefaultSelectionForeground,ShapeIndicator:DefaultShapeIndicator,ShapeIndicators:DefaultShapeIndicators,SnapIndicator:DefaultSnapIndicator,Spinner:DefaultSpinner,SvgDefs:DefaultSvgDefs,ZoomBrush:DefaultBrush,ErrorFallback:DefaultErrorFallback,ShapeErrorFallback:DefaultShapeErrorFallback,ShapeIndicatorErrorFallback:DefaultShapeIndicatorErrorFallback,..._overrides})),[_overrides]);return(0,jsx_runtime.jsx)(EditorComponentsContext.Provider,{value,children})}function useEditorComponents(){const components=(0,react.useContext)(EditorComponentsContext);if(!components)throw new Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return components}const runtime={openWindow(url,target){window.open(url,target,"noopener noreferrer")},refreshPage(){window.location.reload()},hardReset:async()=>await(window.__tldraw__hardReset?.())};function hardResetEditor(){runtime.hardReset()}const DefaultErrorFallback=({error,editor})=>{const containerRef=(0,react.useRef)(null),[shouldShowError,setShouldShowError]=(0,react.useState)(!1),[didCopy,setDidCopy]=(0,react.useState)(!1),[shouldShowResetConfirmation,setShouldShowResetConfirmation]=(0,react.useState)(!1);let Canvas=null;try{Canvas=useEditorComponents().Canvas??null}catch{}const errorMessage=error instanceof Error?error.message:String(error),errorStack=error instanceof Error?error.stack:null,isDarkModeFromApp=useValue_useValue("isDarkMode",(()=>{try{if(editor)return editor.user.getIsDarkMode()}catch{}return null}),[editor]),[isDarkMode,setIsDarkMode]=(0,react.useState)(null);(0,react.useLayoutEffect)((()=>{null!==isDarkModeFromApp&&setIsDarkMode(isDarkModeFromApp);let parent=containerRef.current?.parentElement,foundParentThemeClass=!1;for(;parent;){if(parent.classList.contains("tl-theme__dark")||parent.classList.contains("tl-theme__light")){foundParentThemeClass=!0;break}parent=parent.parentElement}foundParentThemeClass?setIsDarkMode(null):"undefined"!=typeof window&&"matchMedia"in window&&setIsDarkMode(window.matchMedia("(prefers-color-scheme: dark)").matches)}),[isDarkModeFromApp]),(0,react.useEffect)((()=>{if(didCopy){const timeout=editor?.timers.setTimeout((()=>{setDidCopy(!1)}),2e3);return()=>clearTimeout(timeout)}}),[didCopy,editor]);const url=new URL("https://github.com/tldraw/tldraw/issues/new");return url.searchParams.set("title",errorMessage),url.searchParams.set("labels","bug"),url.searchParams.set("body",`Hey, I ran into an error while using tldraw:\n\n\`\`\`js\n${errorStack??errorMessage}\n\`\`\`\n\nMy browser: ${navigator.userAgent}`),(0,jsx_runtime.jsxs)("div",{ref:containerRef,className:classnames_default()("tl-container tl-error-boundary",null===isDarkMode?"":isDarkMode?"tl-theme__dark":"tl-theme__light"),children:[(0,jsx_runtime.jsx)("div",{className:"tl-error-boundary__overlay"}),editor&&(0,jsx_runtime.jsx)(ErrorBoundary,{onError:dist_esm.lQ,fallback:()=>null,children:(0,jsx_runtime.jsx)(EditorProvider,{editor,children:(0,jsx_runtime.jsx)("div",{className:"tl-overlay tl-error-boundary__canvas",children:Canvas?(0,jsx_runtime.jsx)(Canvas,{}):null})})}),(0,jsx_runtime.jsx)("div",{className:classnames_default()("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":shouldShowError&&!shouldShowResetConfirmation}),children:shouldShowResetConfirmation?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h2",{children:"Are you sure?"}),(0,jsx_runtime.jsx)("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),(0,jsx_runtime.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,jsx_runtime.jsx)("button",{className:"tlui-button",onClick:()=>setShouldShowResetConfirmation(!1),children:"Cancel"}),(0,jsx_runtime.jsx)("button",{className:"tlui-button tl-error-boundary__reset",onClick:async()=>{hardResetEditor()},children:"Reset data"})]})]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h2",{children:"Something went wrong"}),(0,jsx_runtime.jsx)("p",{children:"Please refresh your browser."}),(0,jsx_runtime.jsx)("p",{children:"If the issue continues after refreshing, you may need to reset the tldraw data stored on your device."}),(0,jsx_runtime.jsxs)("p",{children:[(0,jsx_runtime.jsx)("strong",{children:"Note:"})," Resetting will erase your current project and any unsaved work."]}),!1,shouldShowError&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Message:",(0,jsx_runtime.jsx)("h4",{children:(0,jsx_runtime.jsx)("code",{children:errorMessage})}),"Stack trace:",(0,jsx_runtime.jsxs)("div",{className:"tl-error-boundary__content__error",children:[(0,jsx_runtime.jsx)("pre",{children:(0,jsx_runtime.jsx)("code",{children:errorStack??errorMessage})}),(0,jsx_runtime.jsx)("button",{className:"tlui-button",onClick:()=>{const textarea=document.createElement("textarea");textarea.value=errorStack??errorMessage,document.body.appendChild(textarea),textarea.select(),document.execCommand("copy"),textarea.remove(),setDidCopy(!0)},children:didCopy?"Copied!":"Copy"})]})]}),(0,jsx_runtime.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,jsx_runtime.jsx)("button",{className:"tlui-button",onClick:()=>setShouldShowError(!shouldShowError),children:shouldShowError?"Hide details":"Show details"}),(0,jsx_runtime.jsxs)("div",{className:"tl-error-boundary__content__actions__group",children:[(0,jsx_runtime.jsx)("button",{className:"tlui-button tl-error-boundary__reset",onClick:()=>setShouldShowResetConfirmation(!0),children:"Reset data"}),(0,jsx_runtime.jsx)("button",{className:"tlui-button tl-error-boundary__refresh",onClick:()=>{!function refreshPage(){runtime.refreshPage()}()},children:"Refresh Page"})]})]})]})})]})};var TLUserPreferences_process=__webpack_require__("./node_modules/process/browser.js");const USER_DATA_KEY="TLDRAW_USER_DATA_v3",userTypeValidator=object({id:string,name:string.nullable().optional(),color:string.nullable().optional(),locale:string.nullable().optional(),animationSpeed:number.nullable().optional(),edgeScrollSpeed:number.nullable().optional(),colorScheme:literalEnum("light","dark","system").optional(),isSnapMode:validation_boolean.nullable().optional(),isWrapMode:validation_boolean.nullable().optional(),isDynamicSizeMode:validation_boolean.nullable().optional(),isPasteAtCursorMode:validation_boolean.nullable().optional()}),TLUserPreferences_Versions={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8},CURRENT_VERSION=Math.max(...Object.values(TLUserPreferences_Versions));const USER_COLORS=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function getRandomColor(){return USER_COLORS[Math.floor(Math.random()*USER_COLORS.length)]}const defaultUserPreferences=Object.freeze({name:"",locale:function getDefaultTranslationLocale(){return function _getDefaultTranslationLocale(locales){for(const locale of locales){const supportedLocale=getSupportedLocale(locale);if(supportedLocale)return supportedLocale}return"en"}("undefined"!=typeof window?window.navigator.languages??["en"]:["en"])}(),color:getRandomColor(),edgeScrollSpeed:1,animationSpeed:function userPrefersReducedMotion(){return"undefined"!=typeof window&&"matchMedia"in window&&(window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches??!1)}()?0:1,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,colorScheme:"light"});function getFreshUserPreferences(){return{id:(0,dist_esm.NF)(),color:getRandomColor()}}function migrateUserPreferences(userData){if(null===userData||"object"!=typeof userData)return getFreshUserPreferences();if(!("version"in userData)||!("user"in userData)||"number"!=typeof userData.version)return getFreshUserPreferences();const snapshot=(0,dist_esm.pN)(userData);!function migrateSnapshot(data){data.version<TLUserPreferences_Versions.AddAnimationSpeed&&(data.user.animationSpeed=1),data.version<TLUserPreferences_Versions.AddIsSnapMode&&(data.user.isSnapMode=!1),data.version,TLUserPreferences_Versions.MakeFieldsNullable,data.version<TLUserPreferences_Versions.AddEdgeScrollSpeed&&(data.user.edgeScrollSpeed=1),data.version<TLUserPreferences_Versions.AddExcalidrawSelectMode&&(data.user.isWrapMode=!1),data.version<TLUserPreferences_Versions.AllowSystemColorScheme&&(!0===data.user.isDarkMode?data.user.colorScheme="dark":!1===data.user.isDarkMode&&(data.user.colorScheme="light"),delete data.user.isDarkMode),data.version<TLUserPreferences_Versions.AddDynamicSizeMode&&(data.user.isDynamicSizeMode=!1),data.version<TLUserPreferences_Versions.AddPasteAtCursor&&(data.user.isPasteAtCursorMode=!1),data.version=CURRENT_VERSION}(snapshot);try{return userTypeValidator.validate(snapshot.user)}catch{return getFreshUserPreferences()}}const globalUserPreferences=(0,state_dist_esm.eU)("globalUserData",null);function setUserPreferences(user){userTypeValidator.validate(user),globalUserPreferences.set(user),function storeUserPreferences(){(0,dist_esm.Yz)(USER_DATA_KEY,JSON.stringify({version:CURRENT_VERSION,user:globalUserPreferences.get()}))}(),function broadcastUserPreferencesChange(){channel?.postMessage({type:broadcastEventKey,origin:getBroadcastOrigin(),data:{user:getUserPreferences(),version:CURRENT_VERSION}})}()}const channel="undefined"==typeof BroadcastChannel||void 0!==TLUserPreferences_process&&!1?null:new BroadcastChannel("tldraw-user-sync");channel?.addEventListener("message",(e=>{const data=e.data;data?.type===broadcastEventKey&&data?.origin!==getBroadcastOrigin()&&globalUserPreferences.set(migrateUserPreferences(data.data))}));let _broadcastOrigin=null;function getBroadcastOrigin(){return null===_broadcastOrigin&&(_broadcastOrigin=(0,dist_esm.NF)()),_broadcastOrigin}const broadcastEventKey="tldraw-user-preferences-change";function getUserPreferences(){let prefs=globalUserPreferences.get();return prefs||(prefs=function loadUserPreferences(){return migrateUserPreferences(JSON.parse((0,dist_esm.zM)(USER_DATA_KEY)||"null")??null)}(),setUserPreferences(prefs)),prefs}const defaultLocalStorageUserPrefs=(0,state_dist_esm.EW)("defaultLocalStorageUserPrefs",(()=>getUserPreferences()));function createTLUser(opts={}){return{userPreferences:opts.userPreferences??defaultLocalStorageUserPrefs,setUserPreferences:opts.setUserPreferences??setUserPreferences}}var eventemitter3=__webpack_require__("./node_modules/eventemitter3/index.js"),eventemitter3_default=__webpack_require__.n(eventemitter3),lodash_isequal=__webpack_require__("./node_modules/lodash.isequal/index.js"),lodash_isequal_default=__webpack_require__.n(lodash_isequal);const tabIdKey="TLDRAW_TAB_ID_v2",TLSessionStateSnapshot_window=globalThis.window;const TAB_ID=TLSessionStateSnapshot_window?TLSessionStateSnapshot_window[tabIdKey]??(0,dist_esm._9)(tabIdKey)??"TLDRAW_INSTANCE_STATE_V1_"+(0,dist_esm.NF)():"<error>";TLSessionStateSnapshot_window&&(TLSessionStateSnapshot_window[tabIdKey]=TAB_ID,!function iOS(){return!!TLSessionStateSnapshot_window&&(["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(TLSessionStateSnapshot_window.navigator.platform)||tlenv.isDarwin&&"ontouchend"in document)}()?(0,dist_esm.ZJ)(tabIdKey):(0,dist_esm.dQ)(tabIdKey,TAB_ID)),TLSessionStateSnapshot_window?.addEventListener("beforeunload",(()=>{(0,dist_esm.dQ)(tabIdKey,TAB_ID)}));const TLSessionStateSnapshot_Versions={Initial:0},CURRENT_SESSION_STATE_SNAPSHOT_VERSION=Math.max(...Object.values(TLSessionStateSnapshot_Versions));const sessionStateSnapshotValidator=object({version:number,currentPageId:pageIdValidator.optional(),isFocusMode:validation_boolean.optional(),exportBackground:validation_boolean.optional(),isDebugMode:validation_boolean.optional(),isToolLocked:validation_boolean.optional(),isGridMode:validation_boolean.optional(),pageStates:arrayOf(object({pageId:pageIdValidator,camera:object({x:number,y:number,z:number}).optional(),selectedShapeIds:arrayOf(shapeIdValidator).optional(),focusedGroupId:shapeIdValidator.nullable().optional()})).optional()});function migrateAndValidateSessionStateSnapshot(state){if(!state||"object"!=typeof state)return console.warn("Invalid instance state"),null;if(!("version"in state)||"number"!=typeof state.version)return console.warn("No version in instance state"),null;state.version!==CURRENT_SESSION_STATE_SNAPSHOT_VERSION&&function migrate(snapshot){snapshot.version,TLSessionStateSnapshot_Versions.Initial,snapshot.version=CURRENT_SESSION_STATE_SNAPSHOT_VERSION}(state=(0,dist_esm.pN)(state));try{return sessionStateSnapshotValidator.validate(state)}catch(e){return console.warn(e),null}}function createSessionStateSnapshotSignal(store){const $allPageIds=store.query.ids("page");return(0,state_dist_esm.EW)("sessionStateSnapshot",(()=>{const instanceState=store.get(TLInstance_TLINSTANCE_ID);if(!instanceState)return null;const allPageIds=[...$allPageIds.get()];return{version:CURRENT_SESSION_STATE_SNAPSHOT_VERSION,currentPageId:instanceState.currentPageId,exportBackground:instanceState.exportBackground,isFocusMode:instanceState.isFocusMode,isDebugMode:instanceState.isDebugMode,isToolLocked:instanceState.isToolLocked,isGridMode:instanceState.isGridMode,pageStates:allPageIds.map((id=>{const ps=store.get(TLPageState_InstancePageStateRecordType.createId(id)),camera=store.get(TLCamera_CameraRecordType.createId(id));return{pageId:id,camera:{x:camera?.x??0,y:camera?.y??0,z:camera?.z??1},selectedShapeIds:ps?.selectedShapeIds??[],focusedGroupId:ps?.focusedGroupId??null}}))}}),{isEqual:lodash_isequal_default()})}function loadSessionStateSnapshotIntoStore(store,snapshot,opts){const res=migrateAndValidateSessionStateSnapshot(snapshot);if(!res)return;const preserved=pluckPreservingValues(store.get(TLInstance_TLINSTANCE_ID)),primary=opts?.forceOverwrite?res:preserved,secondary=opts?.forceOverwrite?preserved:res,instanceState=store.schema.types.instance.create({id:TLInstance_TLINSTANCE_ID,...preserved,currentPageId:res.currentPageId,isDebugMode:primary?.isDebugMode??secondary?.isDebugMode,isFocusMode:primary?.isFocusMode??secondary?.isFocusMode,isToolLocked:primary?.isToolLocked??secondary?.isToolLocked,isGridMode:primary?.isGridMode??secondary?.isGridMode,exportBackground:primary?.exportBackground??secondary?.exportBackground});store.atomic((()=>{for(const ps of res.pageStates??[]){if(!store.has(ps.pageId))continue;const cameraId=TLCamera_CameraRecordType.createId(ps.pageId),instancePageState=TLPageState_InstancePageStateRecordType.createId(ps.pageId),previousCamera=store.get(cameraId),previousInstanceState=store.get(instancePageState);store.put([TLCamera_CameraRecordType.create({id:cameraId,x:ps.camera?.x??previousCamera?.x,y:ps.camera?.y??previousCamera?.y,z:ps.camera?.z??previousCamera?.z}),TLPageState_InstancePageStateRecordType.create({id:instancePageState,pageId:ps.pageId,selectedShapeIds:ps.selectedShapeIds??previousInstanceState?.selectedShapeIds,focusedGroupId:ps.focusedGroupId??previousInstanceState?.focusedGroupId})])}store.put([instanceState]),store.ensureStoreIsUsable()}))}function loadSnapshot(store,_snapshot,opts){let snapshot={};if("store"in _snapshot){const migrationResult=store.schema.migrateStoreSnapshot(_snapshot);if("success"!==migrationResult.type)throw new Error("Failed to migrate store snapshot: "+migrationResult.reason);snapshot.document={schema:store.schema.serialize(),store:(0,dist_esm.J2)(migrationResult.value,((_,{typeName})=>store.scopedTypes.document.has(typeName)))}}else snapshot=_snapshot;const preservingInstanceState=pluckPreservingValues(store.get(TLInstance_TLINSTANCE_ID)),preservingSessionState=sessionStateCache.get(store,createSessionStateSnapshotSignal).get();store.atomic((()=>{snapshot.document&&store.loadStoreSnapshot(snapshot.document),preservingInstanceState&&store.update(TLInstance_TLINSTANCE_ID,(r=>({...r,...preservingInstanceState}))),preservingSessionState&&loadSessionStateSnapshotIntoStore(store,preservingSessionState),snapshot.session&&loadSessionStateSnapshotIntoStore(store,snapshot.session,{forceOverwrite:opts?.forceOverwriteSessionState})}))}const sessionStateCache=new dist_esm.l;function getSnapshot(store){const session=sessionStateCache.get(store,createSessionStateSnapshotSignal).get();if(!session)throw new Error("Session state is not ready yet");return{document:store.getStoreSnapshot(),session}}function checkBindings(customBindings){const bindings=[],addedCustomBindingTypes=new Set;for(const customBinding of customBindings){if(addedCustomBindingTypes.has(customBinding.type))throw new Error(`Binding type "${customBinding.type}" is defined more than once`);bindings.push(customBinding),addedCustomBindingTypes.add(customBinding.type)}return bindings}function SVGContainer({children,className="",...rest}){return(0,jsx_runtime.jsx)("svg",{...rest,className:classnames_default()("tl-svg-container",className),children})}class Edge2d extends Geometry2d{start;end;d;u;ul;constructor(config){super({...config,isClosed:!1,isFilled:!1});const{start,end}=config;this.start=start,this.end=end,this.d=start.clone().sub(end),this.u=this.d.clone().uni(),this.ul=this.u.len()}getLength(){return this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(point){const{start,end,d,u,ul:l}=this;if(0===d.len())return start;if(0===l)return start;const k=Vec.Sub(point,start).dpr(u)/l,cx=start.x+u.x*k;if(cx<Math.min(start.x,end.x))return start.x<end.x?start:end;if(cx>Math.max(start.x,end.x))return start.x>end.x?start:end;const cy=start.y+u.y*k;return cy<Math.min(start.y,end.y)?start.y<end.y?start:end:cy>Math.max(start.y,end.y)?start.y>end.y?start:end:new Vec(cx,cy)}hitTestLineSegment(A,B,distance=0){return linesIntersect(A,B,this.start,this.end)||this.distanceToLineSegment(A,B)<=distance}getSvgPathData(first=!0){const{start,end}=this;return`${first?`M${start.toFixed()}`:""} L${end.toFixed()}`}}class Polyline2d extends Geometry2d{points;constructor(config){super({isClosed:!1,isFilled:!1,...config});const{points}=config;this.points=points}_segments;get segments(){if(!this._segments){this._segments=[];const{vertices}=this;for(let i=0,n=vertices.length-1;i<n;i++){const start=vertices[i],end=vertices[i+1];this._segments.push(new Edge2d({start,end}))}this.isClosed&&this._segments.push(new Edge2d({start:vertices[vertices.length-1],end:vertices[0]}))}return this._segments}getLength(){return this.segments.reduce(((acc,segment)=>acc+segment.length),0)}getVertices(){return this.points}nearestPoint(A){const{segments}=this;let p,d,nearest=this.points[0],dist=1/0;for(let i=0;i<segments.length;i++)p=segments[i].nearestPoint(A),d=Vec.Dist2(p,A),d<dist&&(nearest=p,dist=d);if(!nearest)throw Error("nearest point not found");return nearest}hitTestLineSegment(A,B,distance=0){const{segments}=this;for(let i=0,n=segments.length;i<n;i++)if(segments[i].hitTestLineSegment(A,B,distance))return!0;return!1}getSvgPathData(){const{vertices}=this;return vertices.length<2?"":vertices.reduce(((acc,vertex,i)=>0===i?`M ${vertex.x} ${vertex.y}`:`${acc} L ${vertex.x} ${vertex.y}`),"")}}class Polygon2d extends Polyline2d{constructor(config){super({...config}),this.isClosed=!0}}class Rectangle2d extends Polygon2d{x;y;w;h;constructor(config){const{x=0,y=0,width,height}=config;super({...config,points:[new Vec(x,y),new Vec(x+width,y),new Vec(x+width,y+height),new Vec(x,y+height)]}),this.x=x,this.y=y,this.w=width,this.h=height}getBounds(){return new Box(this.x,this.y,this.w,this.h)}getSvgPathData(){const{x,y,w,h}=this;return`M${x},${y} h${w} v${h} h-${w}z`}}class ShapeUtil{constructor(editor){this.editor=editor}static configure(options){return class extends(this){options={...this.options,...options}}}options={};static props;static migrations;static type;getFontFaces(shape){return state_dist_esm.Ml}canSnap(_shape){return!0}canTabTo(_shape){return!0}canScroll(_shape){return!1}canBind(_opts){return!0}canEdit(_shape){return!1}canResize(_shape){return!0}canEditInReadonly(_shape){return!1}canCrop(_shape){return!1}canBeLaidOut(_shape,_info){return!0}providesBackgroundForChildren(_shape){return!1}hideResizeHandles(_shape){return!1}hideRotateHandle(_shape){return!1}hideSelectionBoundsBg(_shape){return!1}hideSelectionBoundsFg(_shape){return!1}isAspectRatioLocked(_shape){return!1}canReceiveNewChildrenOfType(_shape,_type){return!1}canDropShapes(_shape,_shapes){return!1}expandSelectionOutlinePx(shape){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(_shape){return{}}getHandleSnapGeometry(_shape){return{}}getText(_shape){}getAriaDescriptor(_shape){}}function getPerfectDashProps(totalLength,strokeWidth,opts={}){const{closed=!1,snap=1,start="outset",end="outset",lengthRatio=2,style="dashed",forceSolid=!1}=opts;let dashLength=0,dashCount=0,ratio=1,gapLength=0,strokeDashoffset=0;if(forceSolid)return{strokeDasharray:"none",strokeDashoffset:"none"};switch(style){case"dashed":ratio=1,dashLength=Math.min(strokeWidth*lengthRatio,totalLength/4);break;case"dotted":ratio=100,dashLength=strokeWidth/ratio;break;default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return closed||("outset"===start?(totalLength+=dashLength/2,strokeDashoffset+=dashLength/2):"skip"===start&&(totalLength-=dashLength,strokeDashoffset-=dashLength),"outset"===end?totalLength+=dashLength/2:"skip"===end&&(totalLength-=dashLength)),dashCount=Math.floor(totalLength/dashLength/(2*ratio)),dashCount-=dashCount%snap,dashCount<3&&"dashed"===style?totalLength/strokeWidth<4?(dashLength=totalLength,dashCount=1,gapLength=0):(dashLength=totalLength*(1/3),gapLength=totalLength*(1/3)):(dashLength=totalLength/dashCount/(2*ratio),closed?(strokeDashoffset=dashLength/2,gapLength=(totalLength-dashCount*dashLength)/dashCount):gapLength=(totalLength-dashCount*dashLength)/Math.max(1,dashCount-1)),{strokeDasharray:[dashLength,gapLength].join(" "),strokeDashoffset:strokeDashoffset.toString()}}function DashedOutlineBox({bounds,className}){const editor=useEditor_useEditor(),zoomLevel=useValue_useValue("zoom level",(()=>editor.getZoomLevel()),[editor]);return(0,jsx_runtime.jsx)("g",{className,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:bounds.sides.map(((side,i)=>{const{strokeDasharray,strokeDashoffset}=getPerfectDashProps(side[0].dist(side[1]),1/zoomLevel,{style:"dashed",lengthRatio:4});return(0,jsx_runtime.jsx)("line",{x1:side[0].x,y1:side[0].y,x2:side[1].x,y2:side[1].y,strokeDasharray,strokeDashoffset},i)}))})}const coreShapes=[class GroupShapeUtil extends ShapeUtil{static type="group";static props=groupShapeProps;static migrations=groupShapeMigrations;hideSelectionBoundsFg(){return!0}canBind(){return!1}getDefaultProps(){return{}}getGeometry(shape){const children=this.editor.getSortedChildIdsForParent(shape.id);return 0===children.length?new Rectangle2d({width:1,height:1,isFilled:!1}):new Group2d({children:children.map((childId=>{const shape2=this.editor.getShape(childId);return this.editor.getShapeGeometry(childId).transform(this.editor.getShapeLocalTransform(shape2),{isLabel:!1})}))})}component(shape){const isErasing=this.editor.getErasingShapeIds().includes(shape.id),{hintingShapeIds}=this.editor.getCurrentPageState(),isHintingOtherGroup=hintingShapeIds.length>0&&hintingShapeIds.some((id=>id!==shape.id&&this.editor.isShapeOfType(this.editor.getShape(id),"group"))),isFocused=this.editor.getCurrentPageState().focusedGroupId!==shape.id;if(!isErasing&&(isFocused||isHintingOtherGroup))return null;const bounds=this.editor.getShapeGeometry(shape).bounds;return(0,jsx_runtime.jsx)(SVGContainer,{children:(0,jsx_runtime.jsx)(DashedOutlineBox,{className:"tl-group",bounds})})}indicator(shape){const bounds=this.editor.getShapeGeometry(shape).bounds;return(0,jsx_runtime.jsx)(DashedOutlineBox,{className:"",bounds})}onChildrenChange(group){const children=this.editor.getSortedChildIdsForParent(group.id);return 0===children.length?(this.editor.getCurrentPageState().focusedGroupId===group.id&&this.editor.popFocusedGroupId(),void this.editor.deleteShapes([group.id])):1===children.length?(this.editor.getCurrentPageState().focusedGroupId===group.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(children,group.parentId),void this.editor.deleteShapes([group.id])):void 0}}],coreShapeTypes=new Set(coreShapes.map((s=>s.type)));function checkShapesAndAddCore(customShapes){const shapes=[...coreShapes],addedCustomShapeTypes=new Set;for(const customShape of customShapes){if(coreShapeTypes.has(customShape.type))throw new Error(`Shape type "${customShape.type}" is a core shapes type and cannot be overridden`);if(addedCustomShapeTypes.has(customShape.type))throw new Error(`Shape type "${customShape.type}" is defined more than once`);shapes.push(customShape),addedCustomShapeTypes.add(customShape.type)}return shapes}var react_dom=__webpack_require__("./node_modules/react-dom/index.js"),client=__webpack_require__("./node_modules/react-dom/client.js");function fetchCache(cb,init){const cache=new Map;return async function fetchCached(url){const existing=cache.get(url);if(existing)return existing;const promise=(async()=>{try{const response=await(0,dist_esm.hd)(url,init);return(0,dist_esm.vA)(response.ok),await cb(response)}catch(err){return console.error(err),null}})();return cache.set(url,promise),promise}}const resourceToDataUrl=fetchCache((async response=>await dist_esm.Sm.blobToDataUrl(await response.blob()))),importsRegex=/@import\s+(?:"([^"]+)"|'([^']+)'|url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\))([^;]+);/gi,fontFaceRegex=/@font-face\s*{([^}]+)}/gi,urlsRegex=/url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\)/gi,fontFamilyRegex=/(?:^|;)\s*font-family\s*:\s*(?:([^'"][^;\n]+)|"([^"]+)"|'([^']+)')\s*(?:;|$)/gi;function parseCssImports(css){return Array.from(css.matchAll(importsRegex),(m=>({url:m[1]||m[2]||m[3]||m[4]||m[5],extras:m[6]})))}function parseCssFontFaces(css,baseUrl){return Array.from(css.matchAll(fontFaceRegex),(m=>{const fontFace=m[1],urls=Array.from(fontFace.matchAll(urlsRegex),(m2=>{const original=m2[1]||m2[2]||m2[3];return{original,resolved:(0,dist_esm.yC)(original,baseUrl)?.href??null}})),fontFamilies=new Set(Array.from(fontFace.matchAll(fontFamilyRegex),(m2=>(m2[1]||m2[2]||m2[3]).toLowerCase())));return{fontFace,urls,fontFamilies}}))}function shouldIncludeCssProperty(property){return!property.startsWith("-")&&(!property.startsWith("animation")&&(!property.startsWith("transition")&&("cursor"!==property&&("pointer-events"!==property&&("user-select"!==property&&"touch-action"!==property)))))}function parseCssValueUrls(value){return Array.from(value.matchAll(urlsRegex),(m=>({original:m[0],url:m[1]||m[2]||m[3]})))}var _onFontFamilyValue_dec,_init,__create=Object.create,__defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__knownSymbol=(name,symbol)=>(symbol=Symbol[name])?symbol:Symbol.for("Symbol."+name),__typeError=msg=>{throw TypeError(msg)},__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__name=(target,value)=>__defProp(target,"name",{value,configurable:!0}),__decoratorStrings=["class","method","getter","setter","accessor","field","value","get","set"],__expectFn=fn=>void 0!==fn&&"function"!=typeof fn?__typeError("Function expected"):fn,__decoratorContext=(kind,name,done,metadata,fns)=>({kind:__decoratorStrings[kind],name,metadata,addInitializer:fn=>done._?__typeError("Already initialized"):fns.push(__expectFn(fn||null))}),__decoratorMetadata=(array,target)=>__defNormalProp(target,__knownSymbol("metadata"),array[3]),__publicField=(obj,key,value)=>__defNormalProp(obj,"symbol"!=typeof key?key+"":key,value),__accessCheck=(obj,member,msg)=>member.has(obj)||__typeError("Cannot "+msg),__privateIn=(member,obj)=>Object(obj)!==obj?__typeError('Cannot use the "in" operator on this value'):member.has(obj),__privateGet=(obj,member,getter)=>(__accessCheck(obj,member,"read from private field"),getter?getter.call(obj):member.get(obj)),__privateSet=(obj,member,value,setter)=>(__accessCheck(obj,member,"write to private field"),setter?setter.call(obj,value):member.set(obj,value),value),__privateMethod=(obj,member,method)=>(__accessCheck(obj,member,"access private method"),method);_onFontFamilyValue_dec=[dist_esm.oI];class FontEmbedder{constructor(){((array,flags,self,value)=>{for(var i=0,fns=array[flags>>1],n=fns&&fns.length;i<n;i++)1&flags?fns[i].call(self):value=fns[i].call(self,value)})(_init,5,this),__publicField(this,"fontFacesPromise",null),__publicField(this,"foundFontNames",new Set),__publicField(this,"fontFacesToEmbed",new Set),__publicField(this,"pendingPromises",[])}startFindingCurrentDocumentFontFaces(){(0,dist_esm.vA)(!this.fontFacesPromise,"FontEmbedder already started"),this.fontFacesPromise=async function getCurrentDocumentFontFaces(){const fontFaces=[],styleSheetsWithoutSvgExports=Array.from(document.styleSheets).filter((styleSheet=>!styleSheet.ownerNode?.closest(".tldraw-svg-export")));for(const styleSheet of styleSheetsWithoutSvgExports){let cssRules;try{cssRules=styleSheet.cssRules}catch{}if(cssRules){for(const rule of styleSheet.cssRules)if(rule instanceof CSSFontFaceRule)fontFaces.push(parseCssFontFaces(rule.cssText,styleSheet.href??document.baseURI));else if(rule instanceof CSSImportRule){const absoluteUrl=new URL(rule.href,rule.parentStyleSheet?.href??document.baseURI);fontFaces.push(fetchCssFontFaces(absoluteUrl.href))}}else styleSheet.href&&fontFaces.push(fetchCssFontFaces(styleSheet.href))}return(0,dist_esm.oE)(await Promise.all(fontFaces)).flat()}()}onFontFamilyValue(fontFamilyValue){(0,dist_esm.vA)(this.fontFacesPromise,"FontEmbedder not started");const fonts=function parseCssFontFamilyValue(value){const valueRegex=/\s*(?:([^'"][^;\n\s,]+)|"([^"]+)"|'([^']+)')\s*/gi,separatorRegex=/\s*,\s*/gi,fontFamilies=new Set;for(;;){const valueMatch=valueRegex.exec(value);if(!valueMatch)break;const fontFamily=valueMatch[1]||valueMatch[2]||valueMatch[3];if(fontFamilies.add(fontFamily.toLowerCase()),separatorRegex.lastIndex=valueRegex.lastIndex,!separatorRegex.exec(value))break;valueRegex.lastIndex=separatorRegex.lastIndex}return fontFamilies}(fontFamilyValue);for(const font of fonts){if(this.foundFontNames.has(font))return;this.foundFontNames.add(font),this.pendingPromises.push(this.fontFacesPromise.then((fontFaces=>{const relevantFontFaces=fontFaces.filter((fontFace=>fontFace.fontFamilies.has(font)));for(const fontFace of relevantFontFaces)if(!this.fontFacesToEmbed.has(fontFace)){this.fontFacesToEmbed.add(fontFace);for(const url of fontFace.urls)url.resolved&&!url.embedded&&(url.embedded=resourceToDataUrl(url.resolved))}})))}}async createCss(){await Promise.all(this.pendingPromises);let css="";for(const fontFace of this.fontFacesToEmbed){let fontFaceString=`@font-face {${fontFace.fontFace}}`;for(const url of fontFace.urls){if(!url.embedded)continue;const dataUrl=await url.embedded;dataUrl&&(fontFaceString=fontFaceString.replace(url.original,dataUrl))}css+=fontFaceString}return css}}var base;base=null,((array,flags,name,decorators,target,extra)=>{var fn,it,done,ctx,access,k=7&flags,s=!!(8&flags),p=!!(16&flags),j=k>3?array.length+1:k?s?1:2:0,key=__decoratorStrings[k+5],initializers=k>3&&(array[j-1]=[]),extraInitializers=array[j]||(array[j]=[]),desc=k&&(!p&&!s&&(target=target.prototype),k<5&&(k>3||!p)&&__getOwnPropDesc(k<4?target:{get[name](){return __privateGet(this,extra)},set[name](x){return __privateSet(this,extra,x)}},name));k?p&&k<4&&__name(extra,(k>2?"set ":k>1?"get ":"")+name):__name(target,name);for(var i=decorators.length-1;i>=0;i--)ctx=__decoratorContext(k,name,done={},array[3],extraInitializers),k&&(ctx.static=s,ctx.private=p,access=ctx.access={has:p?x=>__privateIn(target,x):x=>name in x},3^k&&(access.get=p?x=>(1^k?__privateGet:__privateMethod)(x,target,4^k?extra:desc.get):x=>x[name]),k>2&&(access.set=p?(x,y)=>__privateSet(x,target,y,4^k?extra:desc.set):(x,y)=>x[name]=y)),it=(0,decorators[i])(k?k<4?p?extra:desc[key]:k>4?void 0:{get:desc.get,set:desc.set}:target,ctx),done._=1,4^k||void 0===it?__expectFn(it)&&(k>4?initializers.unshift(it):k?p?extra=it:desc[key]=it:target=it):"object"!=typeof it||null===it?__typeError("Object expected"):(__expectFn(fn=it.get)&&(desc.get=fn),__expectFn(fn=it.set)&&(desc.set=fn),__expectFn(fn=it.init)&&initializers.unshift(fn));k||__decoratorMetadata(array,target),desc&&__defProp(target,name,desc)})(_init=[,,,__create(base?.[__knownSymbol("metadata")]??null)],1,"onFontFamilyValue",_onFontFamilyValue_dec,FontEmbedder),__decoratorMetadata(_init,FontEmbedder);const fetchCssFontFaces=fetchCache((async response=>{const parsed=function parseCss(css,baseUrl){return{imports:parseCssImports(css),fontFaces:parseCssFontFaces(css,baseUrl)}}(await response.text(),response.url),importedFontFaces=await Promise.all(parsed.imports.map((({url})=>fetchCssFontFaces(new URL(url,response.url).href))));return[...parsed.fontFaces,...(0,dist_esm.oE)(importedFontFaces).flat()]})),isCoveredByCurrentColor=(value,property,{currentColor})=>"currentColor"===value||value===currentColor,isInherited=(value,property,{parentStyles})=>parentStyles[property]===value,isExcludedBorder=borderDirection=>(value,property,{getStyle})=>{const borderWidth=getStyle(`border-${borderDirection}-width`),borderStyle=getStyle(`border-${borderDirection}-style`);return"0px"===borderWidth||"none"===borderStyle},cssRules={"border-block-end-color":isCoveredByCurrentColor,"border-block-start-color":isCoveredByCurrentColor,"border-bottom-color":isCoveredByCurrentColor,"border-inline-end-color":isCoveredByCurrentColor,"border-inline-start-color":isCoveredByCurrentColor,"border-left-color":isCoveredByCurrentColor,"border-right-color":isCoveredByCurrentColor,"border-top-color":isCoveredByCurrentColor,"caret-color":isCoveredByCurrentColor,"column-rule-color":isCoveredByCurrentColor,"outline-color":isCoveredByCurrentColor,"text-decoration":(value,property,{currentColor})=>"none solid currentColor"===value||value==="none solid "+currentColor,"text-decoration-color":isCoveredByCurrentColor,"text-emphasis-color":isCoveredByCurrentColor,"border-collapse":isInherited,"border-spacing":isInherited,"caption-side":isInherited,cursor:isInherited,direction:isInherited,"empty-cells":isInherited,"font-family":isInherited,"font-size":isInherited,"font-style":isInherited,"font-variant":isInherited,"font-weight":isInherited,"font-size-adjust":isInherited,"font-stretch":isInherited,font:isInherited,"letter-spacing":isInherited,"line-height":isInherited,"list-style-image":isInherited,"list-style-position":isInherited,"list-style-type":isInherited,"list-style":isInherited,orphans:isInherited,"overflow-wrap":isInherited,quotes:isInherited,"stroke-linecap":isInherited,"stroke-linejoin":isInherited,"tab-size":isInherited,"text-align":isInherited,"text-align-last":isInherited,"text-indent":isInherited,"text-justify":isInherited,"text-shadow":isInherited,"text-transform":isInherited,visibility:isInherited,"white-space":isInherited,"white-space-collapse":isInherited,widows:isInherited,"word-break":isInherited,"word-spacing":isInherited,"word-wrap":isInherited,"border-top":isExcludedBorder("top"),"border-right":isExcludedBorder("right"),"border-bottom":isExcludedBorder("bottom"),"border-left":isExcludedBorder("left"),"border-block-end":isExcludedBorder("block-end"),"border-block-start":isExcludedBorder("block-start"),"border-inline-end":isExcludedBorder("inline-end"),"border-inline-start":isExcludedBorder("inline-start"),"border-top-style":isExcludedBorder("top"),"border-right-style":isExcludedBorder("right"),"border-bottom-style":isExcludedBorder("bottom"),"border-left-style":isExcludedBorder("left"),"border-block-end-style":isExcludedBorder("block-end"),"border-block-start-style":isExcludedBorder("block-start"),"border-inline-end-style":isExcludedBorder("inline-end"),"border-inline-start-style":isExcludedBorder("inline-start"),"border-top-width":isExcludedBorder("top"),"border-right-width":isExcludedBorder("right"),"border-bottom-width":isExcludedBorder("bottom"),"border-left-width":isExcludedBorder("left"),"border-block-end-width":isExcludedBorder("block-end"),"border-block-start-width":isExcludedBorder("block-start"),"border-inline-end-width":isExcludedBorder("inline-end")};function getRenderedChildNodes(node){if(node.shadowRoot)return node.shadowRoot.childNodes;if(function isShadowSlotElement(node){return function isInShadowRoot(node){return"getRootNode"in node&&function isShadowRoot(node){return node instanceof getWindow(node).ShadowRoot}(node.getRootNode())}(node)&&node instanceof getWindow(node).HTMLSlotElement}(node)){const assignedNodes=node.assignedNodes();if(assignedNodes?.length)return assignedNodes}return node.childNodes}function*getRenderedChildren(node){for(const child of getRenderedChildNodes(node))isElement(child)&&(yield child)}function getWindow(node){return node.ownerDocument?.defaultView??globalThis}function isElement(node){return node instanceof getWindow(node).Element}function elementStyle(element){return element.style}function getComputedStyle(element,pseudoElement){return getWindow(element).getComputedStyle(element,pseudoElement)}const NO_STYLES={};class StyleEmbedder{constructor(root){this.root=root}styles=new Map;fonts=new FontEmbedder;readRootElementStyles(rootElement){this.readElementStyles(rootElement,{shouldRespectDefaults:!1,shouldSkipInheritedParentStyles:!1});const children=Array.from(getRenderedChildren(rootElement));for(;children.length;){const child=children.pop();children.push(...getRenderedChildren(child)),this.readElementStyles(child,{shouldRespectDefaults:!0,shouldSkipInheritedParentStyles:!0})}}readElementStyles(element,{shouldRespectDefaults=!0,shouldSkipInheritedParentStyles=!0}){const defaultStyles=shouldRespectDefaults?function getDefaultStylesForTagName(tagName){let existing=defaultStylesByTagName[tagName];if(!existing){const{foreignObject,document:document2}=function getDefaultStyleFrame(){if(!defaultStyleFrame){const frame=document.createElement("iframe");frame.style.display="none",document.body.appendChild(frame);const frameDocument=(0,dist_esm.Z1)(frame.contentDocument,"frame must have a document"),svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),foreignObject=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");svg.appendChild(foreignObject),frameDocument.body.appendChild(svg),defaultStyleFrame={iframe:frame,foreignObject,document:frameDocument}}return defaultStyleFrame}(),element=document2.createElement(tagName);foreignObject.appendChild(element),existing=element.computedStyleMap?styleFromComputedStyleMap(element.computedStyleMap(),defaultStyleReadOptions):styleFromComputedStyle(getComputedStyle(element),defaultStyleReadOptions),foreignObject.removeChild(element),defaultStylesByTagName[tagName]=existing}return existing}(element.tagName.toLowerCase()):NO_STYLES,parentStyles=Object.assign({},NO_STYLES);if(shouldSkipInheritedParentStyles){let el=element.parentElement;for(;el;){const currentStyles=this.styles.get(el)?.self;for(const style in currentStyles)parentStyles[style]||(parentStyles[style]=currentStyles[style]);el=el.parentElement}}const info={self:styleFromElement(element,{defaultStyles,parentStyles}),before:styleFromPseudoElement(element,"::before"),after:styleFromPseudoElement(element,"::after")};this.styles.set(element,info)}fetchResources(){const promises=[];for(const info of this.styles.values())for(const styles of(0,dist_esm.Ic)(info))if(styles)for(const[property,value]of Object.entries(styles)){if(!value)continue;"font-family"===property&&this.fonts.onFontFamilyValue(value);const urlMatches=parseCssValueUrls(value);0!==urlMatches.length&&promises.push(...urlMatches.map((async({url,original})=>{const dataUrl=await resourceToDataUrl(url)??"data:";styles[property]=value.replace(original,`url("${dataUrl}")`)})))}return Promise.all(promises)}unwrapCustomElements(){const visited=new Set,visit=(element,clonedParent)=>{if(visited.has(element))return;visited.add(element);const shadowRoot=element.shadowRoot;if(shadowRoot){const clonedCustomEl=document.createElement("div");this.styles.set(clonedCustomEl,this.styles.get(element)),clonedCustomEl.setAttribute("data-tl-custom-element",element.tagName),(clonedParent??element.parentElement).appendChild(clonedCustomEl);for(const child of shadowRoot.childNodes)child instanceof Element?visit(child,clonedCustomEl):clonedCustomEl.appendChild(child.cloneNode(!0));element.remove()}else if(clonedParent){if("style"===element.tagName.toLowerCase())return;const clonedEl=element.cloneNode(!1);this.styles.set(clonedEl,this.styles.get(element)),clonedParent.appendChild(clonedEl);for(const child of getRenderedChildNodes(element))child instanceof Element?visit(child,clonedEl):clonedEl.appendChild(child.cloneNode(!0))}};for(const element of this.styles.keys())visit(element,null)}embedStyles(){let css="";for(const[element,info]of this.styles){if(info.after||info.before){const className=`pseudo-${(0,dist_esm.NF)()}`;element.classList.add(className),info.before&&(css+=`.${className}::before {${formatCss(info.before)}}\n`),info.after&&(css+=`.${className}::after {${formatCss(info.after)}}\n`)}const style=elementStyle(element);for(const[property,value]of Object.entries(info.self))value&&style.setProperty(property,value);"auto"===style.fontKerning&&(style.fontKerning="normal")}return css}async getFontFaceCss(){return await this.fonts.createCss()}dispose(){!function destroyDefaultStyleFrame(){defaultStyleFrame&&(document.body.removeChild(defaultStyleFrame.iframe),defaultStyleFrame=void 0)}()}}function styleFromElement(element,{defaultStyles,parentStyles}){return element.computedStyleMap?styleFromComputedStyleMap(element.computedStyleMap(),{defaultStyles,parentStyles}):styleFromComputedStyle(getComputedStyle(element),{defaultStyles,parentStyles})}function styleFromPseudoElement(element,pseudo){const style=getComputedStyle(element,pseudo),content=style.getPropertyValue("content");if(""!==content&&"none"!==content)return styleFromComputedStyle(style,{defaultStyles:NO_STYLES,parentStyles:NO_STYLES})}function styleFromComputedStyleMap(style,{defaultStyles,parentStyles}){const styles={},ruleOptions={currentColor:style.get("color")?.toString()||"",parentStyles,defaultStyles,getStyle:property=>style.get(property)?.toString()??""};for(const property of style.keys()){if(!shouldIncludeCssProperty(property))continue;const value=style.get(property).toString();if(defaultStyles[property]===value)continue;const rule=(0,dist_esm.g5)(cssRules,property);rule&&rule(value,property,ruleOptions)||(styles[property]=value)}return styles}function styleFromComputedStyle(style,{defaultStyles,parentStyles}){const styles={},ruleOptions={currentColor:style.color,parentStyles,defaultStyles,getStyle:property=>style.getPropertyValue(property)};for(const property in style){if(!shouldIncludeCssProperty(property))continue;const value=style.getPropertyValue(property);if(defaultStyles[property]===value)continue;const rule=(0,dist_esm.g5)(cssRules,property);rule&&rule(value,property,ruleOptions)||(styles[property]=value)}return styles}function formatCss(style){let cssText="";for(const[property,value]of Object.entries(style))cssText+=`${property}: ${value};`;return cssText}let defaultStyleFrame;const defaultStylesByTagName={};const defaultStyleReadOptions={defaultStyles:NO_STYLES,parentStyles:NO_STYLES};function replace(original,replacement){return original.replaceWith(replacement),replacement}async function createImage(dataUrl,cloneAttributesFrom){const image=document.createElement("img");cloneAttributesFrom&&function copyAttrs(source,target){Array.from(source.attributes).forEach((attr=>{target.setAttribute(attr.name,attr.value)}))}(cloneAttributesFrom,image),image.setAttribute("src",dataUrl??"data:"),image.setAttribute("decoding","sync"),image.setAttribute("loading","eager");try{await image.decode()}catch{}return image}async function embedMedia(node){if(node instanceof HTMLCanvasElement)return replace(node,await async function getCanvasReplacement(canvas){try{const dataURL=canvas.toDataURL();return await createImage(dataURL,canvas)}catch{return await createImage(null,canvas)}}(node));if(node instanceof HTMLVideoElement)return replace(node,await async function getVideoReplacement(video){try{return createImage(await dist_esm.K4.getVideoFrameAsDataUrl(video),video)}catch(err){console.error("Could not get video frame",err)}if(video.poster)return createImage(await resourceToDataUrl(video.poster),video);return createImage(null,video)}(node));if(node instanceof HTMLImageElement){const src=node.currentSrc||node.src,dataUrl=await resourceToDataUrl(src);node.setAttribute("src",dataUrl??"data:"),node.setAttribute("decoding","sync"),node.setAttribute("loading","eager");try{await node.decode()}catch{}return node}node instanceof HTMLInputElement?node.setAttribute("value",node.value):node instanceof HTMLTextAreaElement&&(node.textContent=node.value),await Promise.all(Array.from(getRenderedChildren(node),(child=>embedMedia(child))))}function useEvent(handler){const handlerRef=(0,react.useRef)();return(0,react.useLayoutEffect)((()=>{handlerRef.current=handler})),(0,react.useDebugValue)(handler),(0,react.useCallback)(((...args)=>{const fn=handlerRef.current;return(0,dist_esm.vA)(fn,"fn does not exist"),fn(...args)}),[])}const Context=(0,react.createContext)(null);function SvgExportContextProvider({context,editor,children}){const Provider=editor.options.exportProvider;return(0,jsx_runtime.jsx)(EditorProvider,{editor,children:(0,jsx_runtime.jsx)(ContainerProvider,{container:editor.getContainer(),children:(0,jsx_runtime.jsx)(Context.Provider,{value:context,children:(0,jsx_runtime.jsx)(Provider,{children})})})})}function useSvgExportContext(){return(0,react.useContext)(Context)}function useDelaySvgExport(){const ctx=(0,react.useContext)(Context),[promise]=(0,react.useState)(dist_esm.il);return(0,react.useEffect)((()=>(ctx?.waitUntil(promise),()=>{promise.resolve()})),[promise,ctx]),useEvent((()=>{promise.resolve()}))}var _waitUntil_dec,ExportDelay_init,ExportDelay_create=Object.create,ExportDelay_defProp=Object.defineProperty,ExportDelay_getOwnPropDesc=Object.getOwnPropertyDescriptor,ExportDelay_knownSymbol=(name,symbol)=>(symbol=Symbol[name])?symbol:Symbol.for("Symbol."+name),ExportDelay_typeError=msg=>{throw TypeError(msg)},ExportDelay_defNormalProp=(obj,key,value)=>key in obj?ExportDelay_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,ExportDelay_name=(target,value)=>ExportDelay_defProp(target,"name",{value,configurable:!0}),ExportDelay_decoratorStrings=["class","method","getter","setter","accessor","field","value","get","set"],ExportDelay_expectFn=fn=>void 0!==fn&&"function"!=typeof fn?ExportDelay_typeError("Function expected"):fn,ExportDelay_decoratorContext=(kind,name,done,metadata,fns)=>({kind:ExportDelay_decoratorStrings[kind],name,metadata,addInitializer:fn=>done._?ExportDelay_typeError("Already initialized"):fns.push(ExportDelay_expectFn(fn||null))}),ExportDelay_decoratorMetadata=(array,target)=>ExportDelay_defNormalProp(target,ExportDelay_knownSymbol("metadata"),array[3]),ExportDelay_publicField=(obj,key,value)=>ExportDelay_defNormalProp(obj,"symbol"!=typeof key?key+"":key,value),ExportDelay_accessCheck=(obj,member,msg)=>member.has(obj)||ExportDelay_typeError("Cannot "+msg),ExportDelay_privateIn=(member,obj)=>Object(obj)!==obj?ExportDelay_typeError('Cannot use the "in" operator on this value'):member.has(obj),ExportDelay_privateGet=(obj,member,getter)=>(ExportDelay_accessCheck(obj,member,"read from private field"),getter?getter.call(obj):member.get(obj)),ExportDelay_privateSet=(obj,member,value,setter)=>(ExportDelay_accessCheck(obj,member,"write to private field"),setter?setter.call(obj,value):member.set(obj,value),value),ExportDelay_privateMethod=(obj,member,method)=>(ExportDelay_accessCheck(obj,member,"access private method"),method);_waitUntil_dec=[dist_esm.oI];class ExportDelay{constructor(maxDelayTimeMs){this.maxDelayTimeMs=maxDelayTimeMs,((array,flags,self,value)=>{for(var i=0,fns=array[flags>>1],n=fns&&fns.length;i<n;i++)1&flags?fns[i].call(self):value=fns[i].call(self,value)})(ExportDelay_init,5,this),ExportDelay_publicField(this,"isResolved",!1),ExportDelay_publicField(this,"promisesToWaitFor",[])}waitUntil(promise){if(this.isResolved)throw new Error("Cannot `waitUntil` - the export has already been resolved. Make sure to call `waitUntil` as soon as possible during an export - ie within the first react effect after rendering.");this.promisesToWaitFor.push(promise.catch((err=>console.error("Error while waiting for export:",err))))}async resolvePromises(){let lastLength=null;for(;this.promisesToWaitFor.length!==lastLength;)lastLength=this.promisesToWaitFor.length,await Promise.allSettled(this.promisesToWaitFor),await(0,dist_esm.yy)(0)}async resolve(){const timeoutPromise=(0,dist_esm.yy)(this.maxDelayTimeMs).then((()=>"timeout")),resolvePromise=this.resolvePromises().then((()=>"resolved"));"timeout"===await Promise.race([timeoutPromise,resolvePromise])&&console.warn("[tldraw] Export delay timed out after ${this.maxDelayTimeMs}ms"),this.isResolved=!0}}function SvgExport({editor,preserveAspectRatio,scale,pixelRatio,bbox,background,singleFrameShapeId,isDarkMode,renderingShapes,onMount,waitUntil}){const masksId=useUniqueSafeId(),theme=getDefaultColorTheme({isDarkMode}),stateAtom=useAtom_useAtom("export state",{defsById:{},shapeElements:null}),{defsById,shapeElements}=useValue_useValue(stateAtom),addExportDef=useEvent((def=>{stateAtom.update((state=>{if((0,dist_esm.mQ)(state.defsById,def.key))return state;const promise=Promise.resolve(def.getElement());return waitUntil(promise.then((result=>{stateAtom.update((state2=>({...state2,defsById:{...state2.defsById,[def.key]:{pending:!1,element:result}}})))}))),{...state,defsById:{...state.defsById,[def.key]:{pending:!0,element:promise}}}}))})),exportContext=(0,react.useMemo)((()=>({isDarkMode,waitUntil,addExportDef,scale,pixelRatio,async resolveAssetUrl(assetId,width){const asset=editor.getAsset(assetId);return!asset||"image"!==asset.type&&"video"!==asset.type?null:await editor.resolveAssetUrl(assetId,{screenScale:scale*(width/asset.props.w),shouldResolveToOriginal:null===pixelRatio,dpr:pixelRatio??void 0})}})),[isDarkMode,waitUntil,addExportDef,scale,pixelRatio,editor]),didRenderRef=(0,react.useRef)(!1);(0,react.useLayoutEffect)((()=>{if(didRenderRef.current)throw new Error("SvgExport should only render once - do not use with react strict mode");didRenderRef.current=!0,(async()=>{const shapeDefs={},unorderedShapeElementPromises=renderingShapes.map((async({id,opacity,index,backgroundIndex})=>{if(id===singleFrameShapeId)return[];const shape=editor.getShape(id);if(editor.isShapeOfType(shape,"group"))return[];const elements=[],util=editor.getShapeUtil(shape);if(util.toSvg||util.toBackgroundSvg){const[toSvgResult,toBackgroundSvgResult]=await Promise.all([util.toSvg?.(shape,exportContext),util.toBackgroundSvg?.(shape,exportContext)]),pageTransform=editor.getShapePageTransform(shape);let pageTransformString=pageTransform.toCssString(),scale2=1;"scale"in shape.props&&1!==shape.props.scale&&(scale2=shape.props.scale,pageTransformString=`${pageTransformString} scale(${shape.props.scale}, ${shape.props.scale})`);const pageMask=editor.getShapeMask(shape.id),shapeMask=pageMask?Mat.From(Mat.Inverse(pageTransform)).applyToPoints(pageMask):null,shapeMaskId=suffixSafeId(masksId,shape.id);shapeMask&&(shapeDefs[shapeMaskId]={pending:!1,element:(0,jsx_runtime.jsx)("clipPath",{id:shapeMaskId,children:(0,jsx_runtime.jsx)("path",{d:`M${shapeMask.map((({x,y})=>`${x/scale2},${y/scale2}`)).join("L")}Z`})})}),toSvgResult&&elements.push({zIndex:index,element:(0,jsx_runtime.jsx)("g",{transform:pageTransformString,opacity,clipPath:pageMask?`url(#${shapeMaskId})`:void 0,children:toSvgResult},`fg_${shape.id}`)}),toBackgroundSvgResult&&elements.push({zIndex:backgroundIndex,element:(0,jsx_runtime.jsx)("g",{transform:pageTransformString,opacity,clipPath:pageMask?`url(#${shapeMaskId})`:void 0,children:toBackgroundSvgResult},`bg_${shape.id}`)})}else elements.push({zIndex:index,element:(0,jsx_runtime.jsx)(ForeignObjectShape,{shape,util,component:InnerShape,className:"tl-shape",bbox,opacity},`fg_${shape.id}`)}),util.backgroundComponent&&elements.push({zIndex:backgroundIndex,element:(0,jsx_runtime.jsx)(ForeignObjectShape,{shape,util,component:InnerShapeBackground,className:"tl-shape tl-shape-background",bbox,opacity},`bg_${shape.id}`)});return elements})),unorderedShapeElements=(await Promise.all(unorderedShapeElementPromises)).flat();(0,react_dom.flushSync)((()=>{stateAtom.update((state=>({...state,shapeElements:unorderedShapeElements.sort(((a,b)=>a.zIndex-b.zIndex)).map((({element})=>element)),defsById:{...state.defsById,...shapeDefs}})))}))})()}),[bbox,editor,exportContext,masksId,renderingShapes,singleFrameShapeId,stateAtom]),(0,react.useEffect)((()=>{const fontsInUse=new Set;for(const{id}of renderingShapes)for(const font of editor.fonts.getShapeFontFaces(id))fontsInUse.add(font);for(const font of fontsInUse)addExportDef({key:(0,dist_esm.NF)(),getElement:async()=>{const declaration=await editor.fonts.toEmbeddedCssDeclaration(font);return(0,jsx_runtime.jsx)("style",{nonce:editor.options.nonce,children:declaration})}})}),[editor,renderingShapes,addExportDef]),(0,react.useEffect)((()=>{null!==shapeElements&&onMount()}),[onMount,shapeElements]);let backgroundColor=background?theme.background:"transparent";if(singleFrameShapeId&&background){const frameShapeUtil=editor.getShapeUtil("frame");if(frameShapeUtil?.options.showColors){backgroundColor=theme[editor.getShape(singleFrameShapeId).props.color].frame.fill}else backgroundColor=theme.solid}return(0,jsx_runtime.jsx)(SvgExportContextProvider,{editor,context:exportContext,children:(0,jsx_runtime.jsxs)("svg",{preserveAspectRatio,direction:"ltr",width:bbox.width*scale,height:bbox.height*scale,viewBox:`${bbox.minX} ${bbox.minY} ${bbox.width} ${bbox.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor},"data-color-mode":isDarkMode?"dark":"light",className:"tl-container tl-theme__force-sRGB "+(isDarkMode?"tl-theme__dark":"tl-theme__light"),children:[(0,jsx_runtime.jsx)("defs",{children:Object.entries(defsById).map((([key,def])=>def.pending?null:(0,jsx_runtime.jsx)(react.Fragment,{children:def.element},key)))}),shapeElements]})})}function ForeignObjectShape({shape,util,className,component:Component,bbox,opacity}){const editor=useEditor_useEditor(),transform=Mat.Translate(-bbox.minX,-bbox.minY).multiply(editor.getShapePageTransform(shape.id)),bounds=editor.getShapeGeometry(shape.id).bounds,width=Math.max(bounds.width,1),height=Math.max(bounds.height,1);return(0,jsx_runtime.jsx)(ErrorBoundary,{fallback:()=>null,children:(0,jsx_runtime.jsx)("foreignObject",{x:bbox.minX,y:bbox.minY,width:bbox.w,height:bbox.h,className:"tl-shape-foreign-object tl-export-embed-styles",children:(0,jsx_runtime.jsx)("div",{className,"data-shape-type":shape.type,style:{clipPath:editor.getShapeClipPath(shape.id),transform:transform.toCssString(),width,height,opacity},children:(0,jsx_runtime.jsx)(Component,{shape,util})})})})}ExportDelay_init=(base=>[,,,ExportDelay_create(base?.[ExportDelay_knownSymbol("metadata")]??null)])(null),((array,flags,name,decorators,target,extra)=>{var fn,it,done,ctx,access,k=7&flags,s=!!(8&flags),p=!!(16&flags),j=k>3?array.length+1:k?s?1:2:0,key=ExportDelay_decoratorStrings[k+5],initializers=k>3&&(array[j-1]=[]),extraInitializers=array[j]||(array[j]=[]),desc=k&&(!p&&!s&&(target=target.prototype),k<5&&(k>3||!p)&&ExportDelay_getOwnPropDesc(k<4?target:{get[name](){return ExportDelay_privateGet(this,extra)},set[name](x){return ExportDelay_privateSet(this,extra,x)}},name));k?p&&k<4&&ExportDelay_name(extra,(k>2?"set ":k>1?"get ":"")+name):ExportDelay_name(target,name);for(var i=decorators.length-1;i>=0;i--)ctx=ExportDelay_decoratorContext(k,name,done={},array[3],extraInitializers),k&&(ctx.static=s,ctx.private=p,access=ctx.access={has:p?x=>ExportDelay_privateIn(target,x):x=>name in x},3^k&&(access.get=p?x=>(1^k?ExportDelay_privateGet:ExportDelay_privateMethod)(x,target,4^k?extra:desc.get):x=>x[name]),k>2&&(access.set=p?(x,y)=>ExportDelay_privateSet(x,target,y,4^k?extra:desc.set):(x,y)=>x[name]=y)),it=(0,decorators[i])(k?k<4?p?extra:desc[key]:k>4?void 0:{get:desc.get,set:desc.set}:target,ctx),done._=1,4^k||void 0===it?ExportDelay_expectFn(it)&&(k>4?initializers.unshift(it):k?p?extra=it:desc[key]=it:target=it):"object"!=typeof it||null===it?ExportDelay_typeError("Object expected"):(ExportDelay_expectFn(fn=it.get)&&(desc.get=fn),ExportDelay_expectFn(fn=it.set)&&(desc.set=fn),ExportDelay_expectFn(fn=it.init)&&initializers.unshift(fn));k||ExportDelay_decoratorMetadata(array,target),desc&&ExportDelay_defProp(target,name,desc)})(ExportDelay_init,1,"waitUntil",_waitUntil_dec,ExportDelay),ExportDelay_decoratorMetadata(ExportDelay_init,ExportDelay);let idCounter=1;async function exportToSvg(editor,shapeIds,opts={}){const result=function getSvgJsx(editor,ids,opts={}){if(!window.document)throw Error("No document");const{scale=1,background=editor.getInstanceState().exportBackground,padding=editor.options.defaultSvgPadding,preserveAspectRatio}=opts,isDarkMode=opts.darkMode??editor.user.getIsDarkMode(),shapeIdsToInclude=editor.getShapeAndDescendantIds(ids),renderingShapes=editor.getUnorderedRenderingShapes(!1).filter((({id})=>shapeIdsToInclude.has(id)));let bbox=null;if(opts.bounds)bbox=opts.bounds;else for(const{id}of renderingShapes){const maskedPageBounds=editor.getShapeMaskedPageBounds(id);maskedPageBounds&&(bbox?bbox.union(maskedPageBounds):bbox=maskedPageBounds.clone())}if(!bbox)return;const singleFrameShapeId=1===ids.length&&editor.isShapeOfType(editor.getShape(ids[0]),"frame")?ids[0]:null;singleFrameShapeId||bbox.expandBy(padding);const w=bbox.width*scale,h=bbox.height*scale;try{document.body.focus?.()}catch{}const exportDelay=new ExportDelay(editor.options.maxExportDelayMs),initialEffectPromise=(0,dist_esm.il)();return exportDelay.waitUntil(initialEffectPromise),{jsx:(0,jsx_runtime.jsx)(SvgExport,{editor,preserveAspectRatio,scale,pixelRatio:opts.pixelRatio??null,bbox,background,singleFrameShapeId,isDarkMode,renderingShapes,onMount:initialEffectPromise.resolve,waitUntil:exportDelay.waitUntil}),width:w,height:h,exportDelay}}(editor,shapeIds,opts);if(!result)return;const container=editor.getContainer(),renderTarget=document.createElement("div");renderTarget.className="tldraw-svg-export",renderTarget.inert=!0,renderTarget.tabIndex=-1,Object.assign(renderTarget.style,{position:"absolute",top:"0px",left:"0px",width:result.width+"px",height:result.height+"px",pointerEvents:"none",opacity:0}),container.appendChild(renderTarget);const root=(0,client.createRoot)(renderTarget,{identifierPrefix:`export_${idCounter++}_`});try{await Promise.resolve(),(0,react_dom.flushSync)((()=>{root.render(result.jsx)})),await result.exportDelay.resolve();const svg=renderTarget.firstElementChild;return(0,dist_esm.vA)(svg instanceof SVGSVGElement,"Expected an SVG element"),await async function applyChangesToForeignObjects(svg){const foreignObjectChildren=[...svg.querySelectorAll("foreignObject.tl-export-embed-styles > *")];if(!foreignObjectChildren.length)return;const styleEmbedder=new StyleEmbedder(svg);try{styleEmbedder.fonts.startFindingCurrentDocumentFontFaces(),await Promise.all(foreignObjectChildren.map((el=>embedMedia(el))));for(const el of foreignObjectChildren)styleEmbedder.readRootElementStyles(el);await styleEmbedder.fetchResources();const fontCss=await styleEmbedder.getFontFaceCss();styleEmbedder.unwrapCustomElements();const pseudoCss=styleEmbedder.embedStyles();if(fontCss||pseudoCss){const style=document.createElementNS("http://www.w3.org/2000/svg","style");style.textContent=`${fontCss}\n${pseudoCss}`,svg.prepend(style)}}finally{styleEmbedder.dispose()}}(svg),{svg,width:result.width,height:result.height}}finally{setTimeout((()=>{root.unmount(),container.removeChild(renderTarget)}),0)}}let maxCanvasSizes=null;const MAX_SAFE_CANVAS_DIMENSION=8192,MAX_SAFE_CANVAS_AREA=16777216,TEST_SIZES={area:[16384,14188,11402,11180,10836,8192,4096],height:[8388607,65535,32767,16384,8192,4096],width:[4194303,65535,32767,16384,8192,4096]};function getCanvasSize(dimension){const cropCvs=document.createElement("canvas");cropCvs.width=1,cropCvs.height=1;const cropCtx=cropCvs.getContext("2d");for(const size of TEST_SIZES[dimension]){const w="height"===dimension?1:size,h="width"===dimension?1:size,testCvs=document.createElement("canvas");testCvs.width=w,testCvs.height=h;testCvs.getContext("2d").fillRect(w-1,h-1,1,1),cropCtx.drawImage(testCvs,w-1,h-1,1,1,0,0,1,1);const isTestPassed=0!==cropCtx.getImageData(0,0,1,1).data[3];if(testCvs.width=0,testCvs.height=0,isTestPassed)return cropCvs.width=0,cropCvs.height=0,"area"===dimension?size*size:size}throw cropCvs.width=0,cropCvs.height=0,Error("Failed to determine maximum canvas dimension")}function clampToBrowserMaxCanvasSize(width,height){if(width<=MAX_SAFE_CANVAS_DIMENSION&&height<=MAX_SAFE_CANVAS_DIMENSION&&width*height<=MAX_SAFE_CANVAS_AREA)return[width,height];const{maxWidth,maxHeight,maxArea}=function getBrowserCanvasMaxSize(){return maxCanvasSizes||(maxCanvasSizes={maxWidth:getCanvasSize("width"),maxHeight:getCanvasSize("height"),maxArea:getCanvasSize("area")}),maxCanvasSizes}(),aspectRatio=width/height;if(width>maxWidth&&(height=(width=maxWidth)/aspectRatio),height>maxHeight&&(width=(height=maxHeight)*aspectRatio),width*height>maxArea){const ratio=Math.sqrt(maxArea/(width*height));width*=ratio,height*=ratio}return[width,height]}const tlmenus={menus:(0,state_dist_esm.eU)("open menus",[]),getOpenMenus(contextId){return contextId?this.menus.get().filter((m=>m.endsWith("-"+contextId))):this.menus.get()},addOpenMenu(id,contextId=""){const idWithContext=contextId?`${id}-${contextId}`:id,menus=new Set(this.menus.get());menus.has(idWithContext)||(menus.add(idWithContext),this.menus.set([...menus]))},deleteOpenMenu(id,contextId=""){const idWithContext=contextId?`${id}-${contextId}`:id,menus=new Set(this.menus.get());menus.has(idWithContext)&&(menus.delete(idWithContext),this.menus.set([...menus]))},clearOpenMenus(contextId){this.menus.set(contextId?this.menus.get().filter((m=>!m.endsWith("-"+contextId))):[])},_hiddenMenus:[],hideOpenMenus(contextId){if(this._hiddenMenus=[...this.getOpenMenus(contextId)],0!==this._hiddenMenus.length)for(const menu of this._hiddenMenus)this.deleteOpenMenu(menu,contextId)},showOpenMenus(contextId){if(0!==this._hiddenMenus.length){for(const menu of this._hiddenMenus)this.addOpenMenu(menu,contextId);this._hiddenMenus=[]}},isMenuOpen(id,contextId){return this.getOpenMenus(contextId).includes(id)},hasOpenMenus(contextId){return this.getOpenMenus(contextId).length>0},hasAnyOpenMenus(){return this.getOpenMenus().length>0},forContext(contextId){return{getOpenMenus:()=>this.getOpenMenus(contextId),addOpenMenu:id=>this.addOpenMenu(id,contextId),deleteOpenMenu:id=>this.deleteOpenMenu(id,contextId),clearOpenMenus:()=>this.clearOpenMenus(contextId),isMenuOpen:id=>this.isMenuOpen(id,contextId),hasOpenMenus:()=>this.hasOpenMenus(contextId),hasAnyOpenMenus:()=>this.hasAnyOpenMenus()}}},tltime=new dist_esm.xl,defaultTldrawOptions={maxShapesPerPage:4e3,maxFilesAtOnce:100,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,defaultSvgPadding:32,cameraSlideFriction:.09,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16,laserDelayMs:1200,maxExportDelayMs:5e3,temporaryAssetPreviewLifetimeMs:18e4,actionShortcutsLocation:"swap",createTextOnCanvasDoubleClick:!0,exportProvider:react.Fragment,enableToolbarKeyboardShortcuts:!0,maxFontsToLoadBeforeRender:1/0,nonce:void 0};function sharedStyleEquals(a,b){if(!b)return!1;switch(a.type){case"mixed":return"mixed"===b.type;case"shared":return"shared"===b.type&&a.value===b.value;default:throw(0,dist_esm.h6)(a)}}class ReadonlySharedStyleMap{map;constructor(entries){this.map=new Map(entries)}get(prop){return this.map.get(prop)}getAsKnownValue(prop){const value=this.get(prop);if(value&&"mixed"!==value.type)return value.value}get size(){return this.map.size}equals(other){if(this.size!==other.size)return!1;const checkedKeys=new Set;for(const[styleProp,value]of this){if(!sharedStyleEquals(value,other.get(styleProp)))return!1;checkedKeys.add(styleProp)}for(const[styleProp,value]of other)if(!checkedKeys.has(styleProp)&&!sharedStyleEquals(value,this.get(styleProp)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class SharedStyleMap extends ReadonlySharedStyleMap{set(prop,value){this.map.set(prop,value)}applyValue(prop,value){const existingValue=this.get(prop);if(existingValue)switch(existingValue.type){case"mixed":return;case"shared":return void(existingValue.value!==value&&this.set(prop,{type:"mixed"}));default:(0,dist_esm.h6)(existingValue,"type")}else this.set(prop,{type:"shared",value})}}const CDN_BASE_URL="https://cdn.tldraw.com";function getDefaultCdnBaseUrl(){return`${CDN_BASE_URL}/${version}`}function encodeId(str){return encodeURIComponent(str).replace(/\./g,"%2E")}function getReorderingShapesChanges(editor,operation,ids,opts){if(0===ids.length)return[];const parents=new Map;for(const shape of(0,dist_esm.oE)(ids.map((id=>editor.getShape(id))))){const{parentId}=shape;parents.has(parentId)||parents.set(parentId,{children:(0,dist_esm.oE)(editor.getSortedChildIdsForParent(parentId).map((id=>editor.getShape(id)))),moving:new Set}),parents.get(parentId).moving.add(shape)}const changes=[];switch(operation){case"toBack":parents.forEach((({moving,children})=>function reorderToBack(moving,children,changes){const len=children.length;if(moving.size===len)return;let below,above;for(let i=0;i<len;i++){const shape=children[i];if(!moving.has(shape)){above=shape.index;break}below=shape.index,moving.delete(shape)}if(0===moving.size)return;{const indices=(0,dist_esm.MT)(below,above,moving.size);changes.push(...Array.from(moving.values()).sort(dist_esm.Ky).map(((shape,i)=>({...shape,index:indices[i]}))))}}(moving,children,changes)));break;case"toFront":parents.forEach((({moving,children})=>function reorderToFront(moving,children,changes){const len=children.length;if(moving.size===len)return;let below,above;for(let i=len-1;i>-1;i--){const shape=children[i];if(!moving.has(shape)){below=shape.index;break}above=shape.index,moving.delete(shape)}if(0===moving.size)return;{const indices=(0,dist_esm.MT)(below,above,moving.size);changes.push(...Array.from(moving.values()).sort(dist_esm.Ky).map(((shape,i)=>({...shape,index:indices[i]}))))}}(moving,children,changes)));break;case"forward":parents.forEach((({moving,children})=>function reorderForward(editor,moving,children,changes,opts){const isOverlapping=getOverlapChecker(editor,moving),len=children.length;if(moving.size===len)return;let state={name:"skipping"};for(let i=0;i<len;i++){const isMoving=moving.has(children[i]);switch(state.name){case"skipping":if(!isMoving)continue;state={name:"selecting",selectIndex:i};break;case"selecting":{if(isMoving)continue;if(!opts?.considerAllShapes&&!isOverlapping(children[i]))continue;const{selectIndex}=state;(0,dist_esm.MT)(children[i].index,children[i+1]?.index,i-selectIndex).forEach(((index,k)=>{const child=children[selectIndex+k];moving.has(child)&&changes.push({...child,index})})),state={name:"skipping"};break}}}}(editor,moving,children,changes,opts)));break;case"backward":parents.forEach((({moving,children})=>function reorderBackward(editor,moving,children,changes,opts){const isOverlapping=getOverlapChecker(editor,moving),len=children.length;if(moving.size===len)return;let state={name:"skipping"};for(let i=len-1;i>-1;i--){const isMoving=moving.has(children[i]);switch(state.name){case"skipping":if(!isMoving)continue;state={name:"selecting",selectIndex:i};break;case"selecting":if(isMoving)continue;if(!opts?.considerAllShapes&&!isOverlapping(children[i]))continue;(0,dist_esm.MT)(children[i-1]?.index,children[i].index,state.selectIndex-i).forEach(((index,k)=>{const child=children[i+k+1];moving.has(child)&&changes.push({...child,index})})),state={name:"skipping"}}}}(editor,moving,children,changes,opts)))}return changes}function getOverlapChecker(editor,moving){const movingVertices=Array.from(moving).map((shape=>{const vertices=editor.getShapePageGeometry(shape).vertices;return vertices?{shape,vertices}:null})).filter(Boolean);return child=>{const vertices=editor.getShapePageGeometry(child).vertices;return!!vertices&&movingVertices.some((other=>polygonsIntersect(other.vertices,vertices)))}}function getRotationSnapshot({editor,ids}){const shapes=(0,dist_esm.oE)(ids.map((id=>editor.getShape(id)))),rotation=editor.getShapesSharedRotation(ids),rotatedPageBounds=editor.getShapesRotatedPageBounds(ids);if(!rotatedPageBounds)return null;const initialPageCenter=rotatedPageBounds.center.clone().rotWith(rotatedPageBounds.point,rotation);return{initialPageCenter,initialCursorAngle:initialPageCenter.angle(editor.inputs.originPagePoint),initialShapesRotation:rotation,shapeSnapshots:shapes.map((shape=>({shape,initialPagePoint:editor.getShapePageTransform(shape.id).point()})))}}function applyRotationToSnapshotShapes({delta,editor,snapshot,stage,centerOverride}){const{initialPageCenter,shapeSnapshots}=snapshot;editor.updateShapes(shapeSnapshots.map((({shape,initialPagePoint})=>{const parentTransform=isShapeId(shape.parentId)?editor.getShapePageTransform(shape.parentId):Mat.Identity(),newPagePoint=Vec.RotWith(initialPagePoint,centerOverride??initialPageCenter,delta),newLocalPoint=Mat.applyToPoint(Mat.Inverse(parentTransform),newPagePoint),newRotation=canonicalizeRotation(shape.rotation+delta);return{id:shape.id,type:shape.type,x:newLocalPoint.x,y:newLocalPoint.y,rotation:newRotation}})));const changes=[];shapeSnapshots.forEach((({shape})=>{const current=editor.getShape(shape.id);if(!current)return;const util=editor.getShapeUtil(shape);if("start"===stage||"one-off"===stage){const changeStart=util.onRotateStart?.(shape);changeStart&&changes.push(changeStart)}const changeUpdate=util.onRotate?.(shape,current);if(changeUpdate&&changes.push(changeUpdate),"end"===stage||"one-off"===stage){const changeEnd=util.onRotateEnd?.(shape,current);changeEnd&&changes.push(changeEnd)}})),changes.length>0&&editor.updateShapes(changes)}const isShapeInPage=(store,pageId,shape)=>{for(;!isPageId(shape.parentId);){const parent=store.get(shape.parentId);if(!parent)return!1;shape=parent}return shape.parentId===pageId};var _cancelDoubleClickTimeout_dec,__getClickTimeout_dec,ClickManager_init,ClickManager_create=Object.create,ClickManager_defProp=Object.defineProperty,ClickManager_getOwnPropDesc=Object.getOwnPropertyDescriptor,ClickManager_knownSymbol=(name,symbol)=>(symbol=Symbol[name])?symbol:Symbol.for("Symbol."+name),ClickManager_typeError=msg=>{throw TypeError(msg)},ClickManager_defNormalProp=(obj,key,value)=>key in obj?ClickManager_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,ClickManager_name=(target,value)=>ClickManager_defProp(target,"name",{value,configurable:!0}),ClickManager_decoratorStrings=["class","method","getter","setter","accessor","field","value","get","set"],ClickManager_expectFn=fn=>void 0!==fn&&"function"!=typeof fn?ClickManager_typeError("Function expected"):fn,ClickManager_decoratorContext=(kind,name,done,metadata,fns)=>({kind:ClickManager_decoratorStrings[kind],name,metadata,addInitializer:fn=>done._?ClickManager_typeError("Already initialized"):fns.push(ClickManager_expectFn(fn||null))}),ClickManager_decoratorMetadata=(array,target)=>ClickManager_defNormalProp(target,ClickManager_knownSymbol("metadata"),array[3]),ClickManager_decorateElement=(array,flags,name,decorators,target,extra)=>{var fn,it,done,ctx,access,k=7&flags,s=!!(8&flags),p=!!(16&flags),j=k>3?array.length+1:k?s?1:2:0,key=ClickManager_decoratorStrings[k+5],initializers=k>3&&(array[j-1]=[]),extraInitializers=array[j]||(array[j]=[]),desc=k&&(!p&&!s&&(target=target.prototype),k<5&&(k>3||!p)&&ClickManager_getOwnPropDesc(k<4?target:{get[name](){return ClickManager_privateGet(this,extra)},set[name](x){return ClickManager_privateSet(this,extra,x)}},name));k?p&&k<4&&ClickManager_name(extra,(k>2?"set ":k>1?"get ":"")+name):ClickManager_name(target,name);for(var i=decorators.length-1;i>=0;i--)ctx=ClickManager_decoratorContext(k,name,done={},array[3],extraInitializers),k&&(ctx.static=s,ctx.private=p,access=ctx.access={has:p?x=>ClickManager_privateIn(target,x):x=>name in x},3^k&&(access.get=p?x=>(1^k?ClickManager_privateGet:ClickManager_privateMethod)(x,target,4^k?extra:desc.get):x=>x[name]),k>2&&(access.set=p?(x,y)=>ClickManager_privateSet(x,target,y,4^k?extra:desc.set):(x,y)=>x[name]=y)),it=(0,decorators[i])(k?k<4?p?extra:desc[key]:k>4?void 0:{get:desc.get,set:desc.set}:target,ctx),done._=1,4^k||void 0===it?ClickManager_expectFn(it)&&(k>4?initializers.unshift(it):k?p?extra=it:desc[key]=it:target=it):"object"!=typeof it||null===it?ClickManager_typeError("Object expected"):(ClickManager_expectFn(fn=it.get)&&(desc.get=fn),ClickManager_expectFn(fn=it.set)&&(desc.set=fn),ClickManager_expectFn(fn=it.init)&&initializers.unshift(fn));return k||ClickManager_decoratorMetadata(array,target),desc&&ClickManager_defProp(target,name,desc),p?4^k?extra:desc:target},ClickManager_publicField=(obj,key,value)=>ClickManager_defNormalProp(obj,"symbol"!=typeof key?key+"":key,value),ClickManager_accessCheck=(obj,member,msg)=>member.has(obj)||ClickManager_typeError("Cannot "+msg),ClickManager_privateIn=(member,obj)=>Object(obj)!==obj?ClickManager_typeError('Cannot use the "in" operator on this value'):member.has(obj),ClickManager_privateGet=(obj,member,getter)=>(ClickManager_accessCheck(obj,member,"read from private field"),getter?getter.call(obj):member.get(obj)),ClickManager_privateSet=(obj,member,value,setter)=>(ClickManager_accessCheck(obj,member,"write to private field"),setter?setter.call(obj,value):member.set(obj,value),value),ClickManager_privateMethod=(obj,member,method)=>(ClickManager_accessCheck(obj,member,"access private method"),method);__getClickTimeout_dec=[dist_esm.oI],_cancelDoubleClickTimeout_dec=[dist_esm.oI];class ClickManager{constructor(editor){this.editor=editor,((array,flags,self,value)=>{for(var i=0,fns=array[flags>>1],n=fns&&fns.length;i<n;i++)1&flags?fns[i].call(self):value=fns[i].call(self,value)})(ClickManager_init,5,this),ClickManager_publicField(this,"_clickId",""),ClickManager_publicField(this,"_clickTimeout"),ClickManager_publicField(this,"_clickScreenPoint"),ClickManager_publicField(this,"_previousScreenPoint"),ClickManager_publicField(this,"_clickState","idle"),ClickManager_publicField(this,"lastPointerInfo",{})}_getClickTimeout(state,id=(0,dist_esm.NF)()){this._clickId=id,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout((()=>{if(this._clickState===state&&this._clickId===id){switch(this._clickState){case"pendingTriple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break;case"pendingQuadruple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break;case"pendingOverflow":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"})}this._clickState="idle"}}),"idle"===state||"pendingDouble"===state?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)}get clickState(){return this._clickState}handlePointerEvent(info){switch(info.name){case"pointer_down":if(!this._clickState)return info;switch(this._clickScreenPoint=Vec.From(info.point),this._previousScreenPoint&&Vec.Dist2(this._previousScreenPoint,this._clickScreenPoint)>1600&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=info,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...info,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...info,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...info,type:"click",name:"quadruple_click",phase:"down"};case"idle":this._clickState="pendingDouble";break;case"pendingOverflow":this._clickState="overflow"}return this._clickTimeout=this._getClickTimeout(this._clickState),info;case"pointer_up":if(!this._clickState)return info;switch(this._clickScreenPoint=Vec.From(info.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}return info;case"pointer_move":return"idle"!==this._clickState&&this._clickScreenPoint&&Vec.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout(),info}return info}cancelDoubleClickTimeout(){this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"}}ClickManager_init=(base=>[,,,ClickManager_create(base?.[ClickManager_knownSymbol("metadata")]??null)])(null),ClickManager_decorateElement(ClickManager_init,1,"_getClickTimeout",__getClickTimeout_dec,ClickManager),ClickManager_decorateElement(ClickManager_init,1,"cancelDoubleClickTimeout",_cancelDoubleClickTimeout_dec,ClickManager),ClickManager_decoratorMetadata(ClickManager_init,ClickManager);class EdgeScrollManager{constructor(editor){this.editor=editor}_isEdgeScrolling=!1;_edgeScrollDuration=-1;updateEdgeScrolling(elapsed){const{editor}=this,edgeScrollProximityFactor=this.getEdgeScroll();if(0===edgeScrollProximityFactor.x&&0===edgeScrollProximityFactor.y)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=elapsed,this._edgeScrollDuration>editor.options.edgeScrollDelay){const eased=editor.options.edgeScrollEaseDuration>0?EASINGS.easeInCubic(Math.min(1,this._edgeScrollDuration/(editor.options.edgeScrollDelay+editor.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:edgeScrollProximityFactor.x*eased,y:edgeScrollProximityFactor.y*eased})}}getEdgeProximityFactors(position,dimension,isCoarse,insetStart,insetEnd){const{editor}=this,dist=editor.options.edgeScrollDistance,pw=isCoarse?editor.options.coarsePointerWidth:0,pMin=position-pw,pMax=position+pw,min=insetStart?0:dist,max=insetEnd?dimension:dimension-dist;return pMin<min?Math.min(1,(min-pMin)/dist):pMax>max?-Math.min(1,(pMax-max)/dist):0}getEdgeScroll(){const{editor}=this,{inputs:{currentScreenPoint:{x,y}}}=editor,screenBounds=editor.getViewportScreenBounds(),{isCoarsePointer,insets:[t,r,b,l]}=editor.getInstanceState();return{x:this.getEdgeProximityFactors(x,screenBounds.w,isCoarsePointer,l,r),y:this.getEdgeProximityFactors(y,screenBounds.h,isCoarsePointer,t,b)}}moveCameraWhenCloseToEdge(proximityFactor){const{editor}=this;if(!editor.inputs.isDragging||editor.inputs.isPanning||editor.getCameraOptions().isLocked)return;if(0===proximityFactor.x&&0===proximityFactor.y)return;const screenBounds=editor.getViewportScreenBounds(),screenSizeFactorX=screenBounds.w<1e3?.612:1,screenSizeFactorY=screenBounds.h<1e3?.612:1,zoomLevel=editor.getZoomLevel(),pxSpeed=editor.user.getEdgeScrollSpeed()*editor.options.edgeScrollSpeed,scrollDeltaX=pxSpeed*proximityFactor.x*screenSizeFactorX/zoomLevel,scrollDeltaY=pxSpeed*proximityFactor.y*screenSizeFactorY/zoomLevel,{x,y,z}=editor.getCamera();editor.setCamera(new Vec(x+scrollDeltaX,y+scrollDeltaY,z))}}class FocusManager{constructor(editor,autoFocus){this.editor=editor,this.disposeSideEffectListener=editor.sideEffects.registerAfterChangeHandler("instance",((prev,next)=>{prev.isFocused!==next.isFocused&&this.updateContainerClass()}));autoFocus!==editor.getInstanceState().isFocused&&editor.updateInstanceState({isFocused:!!autoFocus}),this.updateContainerClass(),document.body.addEventListener("keydown",this.handleKeyDown.bind(this)),document.body.addEventListener("mousedown",this.handleMouseDown.bind(this))}disposeSideEffectListener;updateContainerClass(){const container=this.editor.getContainer();this.editor.getInstanceState().isFocused?container.classList.add("tl-container__focused"):container.classList.remove("tl-container__focused"),container.classList.add("tl-container__no-focus-ring")}handleKeyDown(keyEvent){const container=this.editor.getContainer();["Tab","ArrowUp","ArrowDown"].includes(keyEvent.key)&&container.classList.remove("tl-container__no-focus-ring")}handleMouseDown(){this.editor.getContainer().classList.add("tl-container__no-focus-ring")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){document.body.removeEventListener("keydown",this.handleKeyDown.bind(this)),document.body.removeEventListener("mousedown",this.handleMouseDown.bind(this)),this.disposeSideEffectListener?.()}}class FontManager{constructor(editor,assetUrls){this.editor=editor,this.assetUrls=assetUrls,this.shapeFontFacesCache=editor.store.createComputedCache("shape font faces",(shape=>this.editor.getShapeUtil(shape).getFontFaces(shape)),{areResultsEqual:dist_esm.vq,areRecordsEqual:(a,b)=>a.props===b.props}),this.shapeFontLoadStateCache=editor.store.createCache((id=>{const fontFacesComputed=(0,state_dist_esm.EW)("font faces",(()=>this.getShapeFontFaces(id)));return(0,state_dist_esm.EW)("font load state",(()=>fontFacesComputed.get().map((face=>this.getFontState(face)))),{isEqual:dist_esm.vq})}))}shapeFontFacesCache;shapeFontLoadStateCache;getShapeFontFaces(shape){const shapeId="string"==typeof shape?shape:shape.id;return this.shapeFontFacesCache.get(shapeId)??state_dist_esm.Ml}trackFontsForShape(shape){const shapeId="string"==typeof shape?shape:shape.id;this.shapeFontLoadStateCache.get(shapeId)}async loadRequiredFontsForCurrentPage(limit=1/0){const neededFonts=new Set;for(const shapeId of this.editor.getCurrentPageShapeIds())for(const font of this.getShapeFontFaces(this.editor.getShape(shapeId)))neededFonts.add(font);if(neededFonts.size>limit)return;const promises=Array.from(neededFonts,(font=>this.ensureFontIsLoaded(font)));await Promise.all(promises)}fontStates=new store_dist_esm._j("font states");getFontState(font){return this.fontStates.get(font)??null}ensureFontIsLoaded(font){const existingState=this.getFontState(font);if(existingState)return existingState.loadingPromise;const instance=this.findOrCreateFontFace(font),state={state:"loading",instance,loadingPromise:instance.load().then((()=>{document.fonts.add(instance),this.fontStates.update(font,(s=>({...s,state:"ready"})))})).catch((err=>{console.error(err),this.fontStates.update(font,(s=>({...s,state:"error"})))}))};return this.fontStates.set(font,state),state.loadingPromise}fontsToLoad=new Set;requestFonts(fonts){this.fontsToLoad.size||queueMicrotask((()=>{if(this.editor.isDisposed)return;const toLoad=this.fontsToLoad;this.fontsToLoad=new Set,(0,state_dist_esm.hL)((()=>{for(const font of toLoad)this.ensureFontIsLoaded(font)}))}));for(const font of fonts)this.fontsToLoad.add(font)}findOrCreateFontFace(font){for(const existing of document.fonts)if(existing.family===font.family&&(0,dist_esm.iA)(defaultFontFaceDescriptors).every((([key,defaultValue])=>existing[key]===(font[key]??defaultValue))))return existing;const url=this.assetUrls?.[font.src.url]??font.src.url,instance=new FontFace(font.family,`url(${JSON.stringify(url)})`,{...(0,dist_esm._H)(defaultFontFaceDescriptors,(key=>font[key])),display:"swap"});return document.fonts.add(instance),instance}async toEmbeddedCssDeclaration(font){const url=this.assetUrls?.[font.src.url]??font.src.url,dataUrl=await dist_esm.Sm.urlToDataUrl(url),src=(0,dist_esm.oE)([`url("${dataUrl}")`,font.src.format?`format(${font.src.format})`:null,font.src.tech?`tech(${font.src.tech})`:null]).join(" ");return(0,dist_esm.oE)(["@font-face {",`  font-family: "${font.family}";`,font.ascentOverride?`  ascent-override: ${font.ascentOverride};`:null,font.descentOverride?`  descent-override: ${font.descentOverride};`:null,font.stretch?`  font-stretch: ${font.stretch};`:null,font.style?`  font-style: ${font.style};`:null,font.weight?`  font-weight: ${font.weight};`:null,font.featureSettings?`  font-feature-settings: ${font.featureSettings};`:null,font.lineGapOverride?`  line-gap-override: ${font.lineGapOverride};`:null,font.unicodeRange?`  unicode-range: ${font.unicodeRange};`:null,`  src: ${src};`,"}"]).join("\n")}}const defaultFontFaceDescriptors={style:"normal",weight:"normal",stretch:"normal",unicodeRange:"U+0-10FFFF",featureSettings:"normal",ascentOverride:"normal",descentOverride:"normal",lineGapOverride:"normal"};function stack(items){if(items){let result=EMPTY_STACK_ITEM;for(;items.length;)result=result.push(items.pop());return result}return EMPTY_STACK_ITEM}class EmptyStackItem{length=0;head=null;tail=this;push(head){return new StackItem(head,this)}toArray(){return state_dist_esm.Ml}[Symbol.iterator](){return{next:()=>({value:void 0,done:!0})}}}const EMPTY_STACK_ITEM=new EmptyStackItem;class StackItem{constructor(head,tail){this.head=head,this.tail=tail,this.length=tail.length+1}length;push(head){return new StackItem(head,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let stack2=this;return{next(){if(stack2.length){const value=stack2.head;return stack2=stack2.tail,{value,done:!1}}return{value:void 0,done:!0}}}}}class HistoryManager{store;dispose;state="recording";pendingDiff=new PendingDiff;stacks=(0,state_dist_esm.eU)("HistoryManager.stacks",{undos:stack(),redos:stack()},{isEqual:(a,b)=>a.undos===b.undos&&a.redos===b.redos});annotateError;constructor(opts){this.store=opts.store,this.annotateError=opts.annotateError??dist_esm.lQ,this.dispose=this.store.addHistoryInterceptor(((entry,source)=>{if("user"===source)switch(this.state){case"recording":this.pendingDiff.apply(entry.changes),this.stacks.update((({undos})=>({undos,redos:stack()})));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(entry.changes);break;case"paused":break;default:(0,dist_esm.h6)(this.state)}}))}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;const diff=this.pendingDiff.clear();this.stacks.update((({undos,redos})=>({undos:undos.push({type:"diff",diff}),redos})))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}_isInBatch=!1;batch(fn,opts){const previousState=this.state;"paused"!==previousState&&opts?.history&&(this.state=modeToState[opts.history]);try{if(this._isInBatch)return(0,state_dist_esm.hL)(fn),this;this._isInBatch=!0;try{(0,state_dist_esm.hL)(fn)}catch(error){throw this.annotateError(error),error}finally{this._isInBatch=!1}return this}finally{this.state=previousState}}_undo({pushToRedoStack,toMark}){const previousState=this.state;this.state="paused";try{let{undos,redos}=this.stacks.get();const pendingDiff=this.pendingDiff.clear(),isPendingDiffEmpty=(0,store_dist_esm.RF)(pendingDiff),diffToUndo=(0,store_dist_esm.E8)(pendingDiff);pushToRedoStack&&!isPendingDiffEmpty&&(redos=redos.push({type:"diff",diff:pendingDiff}));let didFindMark=!1;if(isPendingDiffEmpty)for(;"stop"===undos.head?.type;){const mark=undos.head;if(undos=undos.tail,pushToRedoStack&&(redos=redos.push(mark)),mark.id===toMark){didFindMark=!0;break}}if(!didFindMark)loop:for(;undos.head;){const undo=undos.head;switch(undos=undos.tail,pushToRedoStack&&(redos=redos.push(undo)),undo.type){case"diff":(0,store_dist_esm.Fl)(diffToUndo,[(0,store_dist_esm.E8)(undo.diff)]);break;case"stop":if(!toMark)break loop;if(undo.id===toMark){didFindMark=!0;break loop}break;default:(0,dist_esm.h6)(undo)}}if(!didFindMark&&toMark)return this;this.store.applyDiff(diffToUndo,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos,redos})}finally{this.state=previousState}return this}undo(){return this._undo({pushToRedoStack:!0}),this}redo(){const previousState=this.state;this.state="paused";try{this.flushPendingDiff();let{undos,redos}=this.stacks.get();if(0===redos.length)return this;for(;"stop"===redos.head?.type;)undos=undos.push(redos.head),redos=redos.tail;const diffToRedo=(0,store_dist_esm.L4)();for(;redos.head;){const redo=redos.head;if(undos=undos.push(redo),redos=redos.tail,"diff"!==redo.type)break;(0,store_dist_esm.Fl)(diffToRedo,[redo.diff])}this.store.applyDiff(diffToRedo,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos,redos})}finally{this.state=previousState}return this}bail(){return this._undo({pushToRedoStack:!1}),this}bailToMark(id){return this._undo({pushToRedoStack:!1,toMark:id}),this}squashToMark(id){let top=this.stacks.get().undos;const popped=[];for(;top.head&&("stop"!==top.head.type||top.head.id!==id);)"diff"===top.head.type&&popped.push(top.head.diff),top=top.tail;if(!top.head||top.head?.id!==id)return console.error("Could not find mark to squash to: ",id),this;if(0===popped.length)return this;const diff=(0,store_dist_esm.L4)();return(0,store_dist_esm.Fl)(diff,popped.reverse()),this.stacks.update((({redos})=>({undos:top.push({type:"diff",diff}),redos}))),this}_mark(id){(0,state_dist_esm.hL)((()=>{this.flushPendingDiff(),this.stacks.update((({undos,redos})=>({undos:undos.push({type:"stop",id}),redos})))}))}clear(){this.stacks.set({undos:stack(),redos:stack()}),this.pendingDiff.clear()}getMarkIdMatching(idSubstring){let top=this.stacks.get().undos;for(;top.head;){if("stop"===top.head.type&&top.head.id.includes(idSubstring))return top.head.id;top=top.tail}return null}debug(){const{undos,redos}=this.stacks.get();return{undos:undos.toArray(),redos:redos.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}}const modeToState={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class PendingDiff{diff=(0,store_dist_esm.L4)();isEmptyAtom=(0,state_dist_esm.eU)("PendingDiff.isEmpty",!0);clear(){const diff=this.diff;return this.diff=(0,store_dist_esm.L4)(),this.isEmptyAtom.set(!0),diff}isEmpty(){return this.isEmptyAtom.get()}apply(diff){(0,store_dist_esm.Fl)(this.diff,[diff]),this.isEmptyAtom.set((0,store_dist_esm.RF)(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}class ScribbleManager{constructor(editor){this.editor=editor}scribbleItems=new Map;state="paused";addScribble(scribble,id=(0,dist_esm.NF)()){const item={id,scribble:{id,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...scribble,state:"starting"},timeoutMs:0,delayRemaining:scribble.delay??0,prev:null,next:null};return this.scribbleItems.set(id,item),item}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}stop(id){const item=this.scribbleItems.get(id);if(!item)throw Error(`Scribble with id ${id} not found`);return item.delayRemaining=Math.min(item.delayRemaining,200),item.scribble.state="stopping",item}addPoint(id,x,y,z=.5){const item=this.scribbleItems.get(id);if(!item)throw Error(`Scribble with id ${id} not found`);const{prev}=item,point={x,y,z};return(!prev||Vec.Dist(prev,point)>=1)&&(item.next=point),item}tick(elapsed){0!==this.scribbleItems.size&&this.editor.run((()=>{this.scribbleItems.forEach((item=>{if("starting"===item.scribble.state){const{next:next2,prev:prev2}=item;return next2&&next2!==prev2&&(item.prev=next2,item.scribble.points.push(next2)),void(item.scribble.points.length>8&&(item.scribble.state="active"))}item.delayRemaining>0&&(item.delayRemaining=Math.max(0,item.delayRemaining-elapsed)),item.timeoutMs+=elapsed,item.timeoutMs>=16&&(item.timeoutMs=0);const{delayRemaining,timeoutMs,prev,next,scribble}=item;switch(scribble.state){case"active":next&&next!==prev?(item.prev=next,scribble.points.push(next),0===delayRemaining&&scribble.points.length>8&&scribble.points.shift()):0===timeoutMs&&(scribble.points.length>1?scribble.points.shift():item.delayRemaining=scribble.delay);break;case"stopping":if(0===item.delayRemaining&&0===timeoutMs){if(1===scribble.points.length)return void this.scribbleItems.delete(item.id);scribble.shrink&&(scribble.size=Math.max(1,scribble.size*(1-scribble.shrink))),scribble.points.shift()}}})),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map((({scribble})=>({...scribble,points:[...scribble.points]}))).slice(-5)})}))}}var _getVisibleGaps_dec,_getSnappableGapNodes_dec,_getSnappablePoints_dec,_getSnapPointsCache_dec,BoundsSnaps_init,BoundsSnaps_create=Object.create,BoundsSnaps_defProp=Object.defineProperty,BoundsSnaps_getOwnPropDesc=Object.getOwnPropertyDescriptor,BoundsSnaps_knownSymbol=(name,symbol)=>(symbol=Symbol[name])?symbol:Symbol.for("Symbol."+name),BoundsSnaps_typeError=msg=>{throw TypeError(msg)},BoundsSnaps_defNormalProp=(obj,key,value)=>key in obj?BoundsSnaps_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,BoundsSnaps_name=(target,value)=>BoundsSnaps_defProp(target,"name",{value,configurable:!0}),BoundsSnaps_decoratorStrings=["class","method","getter","setter","accessor","field","value","get","set"],BoundsSnaps_expectFn=fn=>void 0!==fn&&"function"!=typeof fn?BoundsSnaps_typeError("Function expected"):fn,BoundsSnaps_decoratorContext=(kind,name,done,metadata,fns)=>({kind:BoundsSnaps_decoratorStrings[kind],name,metadata,addInitializer:fn=>done._?BoundsSnaps_typeError("Already initialized"):fns.push(BoundsSnaps_expectFn(fn||null))}),BoundsSnaps_decoratorMetadata=(array,target)=>BoundsSnaps_defNormalProp(target,BoundsSnaps_knownSymbol("metadata"),array[3]),BoundsSnaps_decorateElement=(array,flags,name,decorators,target,extra)=>{var fn,it,done,ctx,access,k=7&flags,s=!!(8&flags),p=!!(16&flags),j=k>3?array.length+1:k?s?1:2:0,key=BoundsSnaps_decoratorStrings[k+5],initializers=k>3&&(array[j-1]=[]),extraInitializers=array[j]||(array[j]=[]),desc=k&&(!p&&!s&&(target=target.prototype),k<5&&(k>3||!p)&&BoundsSnaps_getOwnPropDesc(k<4?target:{get[name](){return BoundsSnaps_privateGet(this,extra)},set[name](x){return BoundsSnaps_privateSet(this,extra,x)}},name));k?p&&k<4&&BoundsSnaps_name(extra,(k>2?"set ":k>1?"get ":"")+name):BoundsSnaps_name(target,name);for(var i=decorators.length-1;i>=0;i--)ctx=BoundsSnaps_decoratorContext(k,name,done={},array[3],extraInitializers),k&&(ctx.static=s,ctx.private=p,access=ctx.access={has:p?x=>BoundsSnaps_privateIn(target,x):x=>name in x},3^k&&(access.get=p?x=>(1^k?BoundsSnaps_privateGet:BoundsSnaps_privateMethod)(x,target,4^k?extra:desc.get):x=>x[name]),k>2&&(access.set=p?(x,y)=>BoundsSnaps_privateSet(x,target,y,4^k?extra:desc.set):(x,y)=>x[name]=y)),it=(0,decorators[i])(k?k<4?p?extra:desc[key]:k>4?void 0:{get:desc.get,set:desc.set}:target,ctx),done._=1,4^k||void 0===it?BoundsSnaps_expectFn(it)&&(k>4?initializers.unshift(it):k?p?extra=it:desc[key]=it:target=it):"object"!=typeof it||null===it?BoundsSnaps_typeError("Object expected"):(BoundsSnaps_expectFn(fn=it.get)&&(desc.get=fn),BoundsSnaps_expectFn(fn=it.set)&&(desc.set=fn),BoundsSnaps_expectFn(fn=it.init)&&initializers.unshift(fn));return k||BoundsSnaps_decoratorMetadata(array,target),desc&&BoundsSnaps_defProp(target,name,desc),p?4^k?extra:desc:target},BoundsSnaps_accessCheck=(obj,member,msg)=>member.has(obj)||BoundsSnaps_typeError("Cannot "+msg),BoundsSnaps_privateIn=(member,obj)=>Object(obj)!==obj?BoundsSnaps_typeError('Cannot use the "in" operator on this value'):member.has(obj),BoundsSnaps_privateGet=(obj,member,getter)=>(BoundsSnaps_accessCheck(obj,member,"read from private field"),getter?getter.call(obj):member.get(obj)),BoundsSnaps_privateSet=(obj,member,value,setter)=>(BoundsSnaps_accessCheck(obj,member,"write to private field"),setter?setter.call(obj,value):member.set(obj,value),value),BoundsSnaps_privateMethod=(obj,member,method)=>(BoundsSnaps_accessCheck(obj,member,"access private method"),method);const round=x=>Math.round(x*10**8)/10**8;function findAdjacentGaps(gaps,shapeId,gapLength,direction,intersection){const matches=gaps.filter((gap=>("forward"===direction?gap.startNode.id===shapeId:gap.endNode.id===shapeId)&&round(gap.length)===round(gapLength)&&rangeIntersection(gap.breadthIntersection[0],gap.breadthIntersection[1],intersection[0],intersection[1])));if(0===matches.length)return[];const nextNodes=new Set;return matches.forEach((match=>{const node="forward"===direction?match.endNode.id:match.startNode.id;if(!nextNodes.has(node)){nextNodes.add(node);const foundGaps=findAdjacentGaps(gaps,node,gapLength,direction,rangeIntersection(match.breadthIntersection[0],match.breadthIntersection[1],intersection[0],intersection[1]));matches.push(...foundGaps)}})),matches}_getSnapPointsCache_dec=[state_dist_esm.EW],_getSnappablePoints_dec=[state_dist_esm.EW],_getSnappableGapNodes_dec=[state_dist_esm.EW],_getVisibleGaps_dec=[state_dist_esm.EW];class BoundsSnaps{constructor(manager){var key,value;this.manager=manager,((array,flags,self,value)=>{for(var i=0,fns=array[flags>>1],n=fns&&fns.length;i<n;i++)1&flags?fns[i].call(self):value=fns[i].call(self,value)})(BoundsSnaps_init,5,this),BoundsSnaps_defNormalProp(this,"symbol"!=typeof(key="editor")?key+"":key,value),this.editor=manager.editor}getSnapPointsCache(){const{editor}=this;return editor.store.createComputedCache("snapPoints",(shape=>{const pageTransform=editor.getShapePageTransform(shape.id);if(!pageTransform)return;const snapPoints=editor.getShapeUtil(shape).getBoundsSnapGeometry(shape).points??editor.getShapeGeometry(shape).bounds.cornersAndCenter;return pageTransform&&snapPoints?snapPoints.map(((point,i)=>{const{x,y}=Mat.applyToPoint(pageTransform,point);return{x,y,id:`${shape.id}:${i}`}})):void 0}))}getSnapPoints(shapeId){return this.getSnapPointsCache().get(shapeId)??[]}getSnappablePoints(){const snapPointsCache=this.getSnapPointsCache(),snappableShapes=this.manager.getSnappableShapes(),result=[];for(const shapeId of snappableShapes){const snapPoints=snapPointsCache.get(shapeId);snapPoints&&result.push(...snapPoints)}return result}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),(shapeId=>({id:shapeId,pageBounds:(0,dist_esm.Z1)(this.editor.getShapePageBounds(shapeId))})))}getVisibleGaps(){const horizontal=[],vertical=[];let startNode,endNode;const sortedShapesOnCurrentPageHorizontal=this.getSnappableGapNodes().sort(((a,b)=>a.pageBounds.minX-b.pageBounds.minX));for(let i=0;i<sortedShapesOnCurrentPageHorizontal.length;i++){startNode=sortedShapesOnCurrentPageHorizontal[i];for(let j=i+1;j<sortedShapesOnCurrentPageHorizontal.length;j++)endNode=sortedShapesOnCurrentPageHorizontal[j],startNode.pageBounds.maxX<endNode.pageBounds.minX&&rangesOverlap(startNode.pageBounds.minY,startNode.pageBounds.maxY,endNode.pageBounds.minY,endNode.pageBounds.maxY)&&horizontal.push({startNode,endNode,startEdge:[new Vec(startNode.pageBounds.maxX,startNode.pageBounds.minY),new Vec(startNode.pageBounds.maxX,startNode.pageBounds.maxY)],endEdge:[new Vec(endNode.pageBounds.minX,endNode.pageBounds.minY),new Vec(endNode.pageBounds.minX,endNode.pageBounds.maxY)],length:endNode.pageBounds.minX-startNode.pageBounds.maxX,breadthIntersection:rangeIntersection(startNode.pageBounds.minY,startNode.pageBounds.maxY,endNode.pageBounds.minY,endNode.pageBounds.maxY)})}const sortedShapesOnCurrentPageVertical=sortedShapesOnCurrentPageHorizontal.sort(((a,b)=>a.pageBounds.minY-b.pageBounds.minY));for(let i=0;i<sortedShapesOnCurrentPageVertical.length;i++){startNode=sortedShapesOnCurrentPageVertical[i];for(let j=i+1;j<sortedShapesOnCurrentPageVertical.length;j++)endNode=sortedShapesOnCurrentPageVertical[j],startNode.pageBounds.maxY<endNode.pageBounds.minY&&rangesOverlap(startNode.pageBounds.minX,startNode.pageBounds.maxX,endNode.pageBounds.minX,endNode.pageBounds.maxX)&&vertical.push({startNode,endNode,startEdge:[new Vec(startNode.pageBounds.minX,startNode.pageBounds.maxY),new Vec(startNode.pageBounds.maxX,startNode.pageBounds.maxY)],endEdge:[new Vec(endNode.pageBounds.minX,endNode.pageBounds.minY),new Vec(endNode.pageBounds.maxX,endNode.pageBounds.minY)],length:endNode.pageBounds.minY-startNode.pageBounds.maxY,breadthIntersection:rangeIntersection(startNode.pageBounds.minX,startNode.pageBounds.maxX,endNode.pageBounds.minX,endNode.pageBounds.maxX)})}return{horizontal,vertical}}snapTranslateShapes({lockedAxis,initialSelectionPageBounds,initialSelectionSnapPoints,dragDelta}){const snapThreshold=this.manager.getSnapThreshold(),visibleSnapPointsNotInSelection=this.getSnappablePoints(),selectionPageBounds=initialSelectionPageBounds.clone().translate(dragDelta),selectionSnapPoints=initialSelectionSnapPoints.map((({x,y},i)=>({id:"selection:"+i,x:x+dragDelta.x,y:y+dragDelta.y}))),otherNodeSnapPoints=visibleSnapPointsNotInSelection,nearestSnapsX=[],nearestSnapsY=[],minOffset=new Vec(snapThreshold,snapThreshold);this.collectPointSnaps({minOffset,nearestSnapsX,nearestSnapsY,otherNodeSnapPoints,selectionSnapPoints}),this.collectGapSnaps({selectionPageBounds,nearestSnapsX,nearestSnapsY,minOffset});const nudge=new Vec("x"===lockedAxis?0:nearestSnapsX[0]?.nudge??0,"y"===lockedAxis?0:nearestSnapsY[0]?.nudge??0);minOffset.x=0,minOffset.y=0,nearestSnapsX.length=0,nearestSnapsY.length=0,selectionSnapPoints.forEach((s=>{s.x+=nudge.x,s.y+=nudge.y})),selectionPageBounds.translate(nudge),this.collectPointSnaps({minOffset,nearestSnapsX,nearestSnapsY,otherNodeSnapPoints,selectionSnapPoints}),this.collectGapSnaps({selectionPageBounds,nearestSnapsX,nearestSnapsY,minOffset});const pointSnapsLines=this.getPointSnapLines({nearestSnapsX,nearestSnapsY}),gapSnapLines=this.getGapSnapLines({selectionPageBounds,nearestSnapsX,nearestSnapsY});return this.manager.setIndicators([...gapSnapLines,...pointSnapsLines]),{nudge}}snapResizeShapes({initialSelectionPageBounds,dragDelta,handle:originalHandle,isAspectRatioLocked,isResizingFromCenter}){const snapThreshold=this.manager.getSnapThreshold(),{box:unsnappedResizedPageBounds,scaleX,scaleY}=Box.Resize(initialSelectionPageBounds,originalHandle,isResizingFromCenter?2*dragDelta.x:dragDelta.x,isResizingFromCenter?2*dragDelta.y:dragDelta.y,isAspectRatioLocked);let handle=originalHandle;scaleX<0&&(handle=function flipSelectionHandleX(handle){switch(handle){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return handle}}(handle)),scaleY<0&&(handle=function flipSelectionHandleY(handle){switch(handle){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return handle}}(handle)),isResizingFromCenter&&(unsnappedResizedPageBounds.center=initialSelectionPageBounds.center);const isXLocked="top"===handle||"bottom"===handle,isYLocked="left"===handle||"right"===handle,selectionSnapPoints=getResizeSnapPointsForHandle(handle,unsnappedResizedPageBounds),otherNodeSnapPoints=this.getSnappablePoints(),nearestSnapsX=[],nearestSnapsY=[],minOffset=new Vec(snapThreshold,snapThreshold);this.collectPointSnaps({minOffset,nearestSnapsX,nearestSnapsY,otherNodeSnapPoints,selectionSnapPoints});const nudge=new Vec(isXLocked?0:nearestSnapsX[0]?.nudge??0,isYLocked?0:nearestSnapsY[0]?.nudge??0);if(isAspectRatioLocked&&function isSelectionCorner(selection){return"top_left"===selection||"top_right"===selection||"bottom_right"===selection||"bottom_left"===selection}(handle)&&0!==nudge.len()){const primaryNudgeAxis=nearestSnapsX.length&&nearestSnapsY.length?Math.abs(nudge.x)<Math.abs(nudge.y)?"x":"y":nearestSnapsX.length?"x":"y",ratio=initialSelectionPageBounds.aspectRatio;"x"===primaryNudgeAxis?(nearestSnapsY.length=0,nudge.y=nudge.x/ratio,"bottom_left"!==handle&&"top_right"!==handle||(nudge.y=-nudge.y)):(nearestSnapsX.length=0,nudge.x=nudge.y*ratio,"bottom_left"!==handle&&"top_right"!==handle||(nudge.x=-nudge.x))}const snappedDelta=Vec.Add(dragDelta,nudge),{box:snappedResizedPageBounds}=Box.Resize(initialSelectionPageBounds,originalHandle,isResizingFromCenter?2*snappedDelta.x:snappedDelta.x,isResizingFromCenter?2*snappedDelta.y:snappedDelta.y,isAspectRatioLocked);isResizingFromCenter&&(snappedResizedPageBounds.center=initialSelectionPageBounds.center);const snappedSelectionPoints=getResizeSnapPointsForHandle("any",snappedResizedPageBounds);nearestSnapsX.length=0,nearestSnapsY.length=0,minOffset.x=0,minOffset.y=0,this.collectPointSnaps({minOffset,nearestSnapsX,nearestSnapsY,otherNodeSnapPoints,selectionSnapPoints:snappedSelectionPoints});const pointSnaps=this.getPointSnapLines({nearestSnapsX,nearestSnapsY});return this.manager.setIndicators([...pointSnaps]),{nudge}}collectPointSnaps({selectionSnapPoints,otherNodeSnapPoints,minOffset,nearestSnapsX,nearestSnapsY}){for(const thisSnapPoint of selectionSnapPoints)for(const otherSnapPoint of otherNodeSnapPoints){const offset=Vec.Sub(thisSnapPoint,otherSnapPoint),offsetX=Math.abs(offset.x),offsetY=Math.abs(offset.y);round(offsetX)<=round(minOffset.x)&&(round(offsetX)<round(minOffset.x)&&(nearestSnapsX.length=0),nearestSnapsX.push({type:"points",points:{thisPoint:thisSnapPoint,otherPoint:otherSnapPoint},nudge:otherSnapPoint.x-thisSnapPoint.x}),minOffset.x=offsetX),round(offsetY)<=round(minOffset.y)&&(round(offsetY)<round(minOffset.y)&&(nearestSnapsY.length=0),nearestSnapsY.push({type:"points",points:{thisPoint:thisSnapPoint,otherPoint:otherSnapPoint},nudge:otherSnapPoint.y-thisSnapPoint.y}),minOffset.y=offsetY)}}collectGapSnaps({selectionPageBounds,minOffset,nearestSnapsX,nearestSnapsY}){const{horizontal,vertical}=this.getVisibleGaps();for(const gap of horizontal){if(!rangesOverlap(gap.breadthIntersection[0],gap.breadthIntersection[1],selectionPageBounds.minY,selectionPageBounds.maxY))continue;const centerNudge=gap.startEdge[0].x+gap.length/2-selectionPageBounds.center.x;if(gap.length>selectionPageBounds.width&&round(Math.abs(centerNudge))<=round(minOffset.x)){round(Math.abs(centerNudge))<round(minOffset.x)&&(nearestSnapsX.length=0),minOffset.x=Math.abs(centerNudge);const snap={type:"gap_center",gap,nudge:centerNudge},otherCenterSnap=nearestSnapsX.find((({type})=>"gap_center"===type)),gapBreadthsOverlap=otherCenterSnap&&rangeIntersection(gap.breadthIntersection[0],gap.breadthIntersection[1],otherCenterSnap.gap.breadthIntersection[0],otherCenterSnap.gap.breadthIntersection[1]);otherCenterSnap&&otherCenterSnap.gap.length>gap.length&&gapBreadthsOverlap?nearestSnapsX[nearestSnapsX.indexOf(otherCenterSnap)]=snap:otherCenterSnap&&gapBreadthsOverlap||nearestSnapsX.push(snap)}const duplicationLeftNudge=gap.startNode.pageBounds.minX-gap.length-selectionPageBounds.maxX;round(Math.abs(duplicationLeftNudge))<=round(minOffset.x)&&(round(Math.abs(duplicationLeftNudge))<round(minOffset.x)&&(nearestSnapsX.length=0),minOffset.x=Math.abs(duplicationLeftNudge),nearestSnapsX.push({type:"gap_duplicate",gap,protrusionDirection:"left",nudge:duplicationLeftNudge}));const duplicationRightNudge=gap.endNode.pageBounds.maxX+gap.length-selectionPageBounds.minX;round(Math.abs(duplicationRightNudge))<=round(minOffset.x)&&(round(Math.abs(duplicationRightNudge))<round(minOffset.x)&&(nearestSnapsX.length=0),minOffset.x=Math.abs(duplicationRightNudge),nearestSnapsX.push({type:"gap_duplicate",gap,protrusionDirection:"right",nudge:duplicationRightNudge}))}for(const gap of vertical){if(!rangesOverlap(gap.breadthIntersection[0],gap.breadthIntersection[1],selectionPageBounds.minX,selectionPageBounds.maxX))continue;const centerNudge=gap.startEdge[0].y+gap.length/2-selectionPageBounds.center.y;if(gap.length>selectionPageBounds.height&&round(Math.abs(centerNudge))<=round(minOffset.y)){round(Math.abs(centerNudge))<round(minOffset.y)&&(nearestSnapsY.length=0),minOffset.y=Math.abs(centerNudge);const snap={type:"gap_center",gap,nudge:centerNudge},otherCenterSnap=nearestSnapsY.find((({type})=>"gap_center"===type)),gapBreadthsOverlap=otherCenterSnap&&rangesOverlap(otherCenterSnap.gap.breadthIntersection[0],otherCenterSnap.gap.breadthIntersection[1],gap.breadthIntersection[0],gap.breadthIntersection[1]);otherCenterSnap&&otherCenterSnap.gap.length>gap.length&&gapBreadthsOverlap?nearestSnapsY[nearestSnapsY.indexOf(otherCenterSnap)]=snap:otherCenterSnap&&gapBreadthsOverlap||nearestSnapsY.push(snap);continue}const duplicationTopNudge=gap.startNode.pageBounds.minY-gap.length-selectionPageBounds.maxY;round(Math.abs(duplicationTopNudge))<=round(minOffset.y)&&(round(Math.abs(duplicationTopNudge))<round(minOffset.y)&&(nearestSnapsY.length=0),minOffset.y=Math.abs(duplicationTopNudge),nearestSnapsY.push({type:"gap_duplicate",gap,protrusionDirection:"top",nudge:duplicationTopNudge}));const duplicationBottomNudge=gap.endNode.pageBounds.maxY+gap.length-selectionPageBounds.minY;round(Math.abs(duplicationBottomNudge))<=round(minOffset.y)&&(round(Math.abs(duplicationBottomNudge))<round(minOffset.y)&&(nearestSnapsY.length=0),minOffset.y=Math.abs(duplicationBottomNudge),nearestSnapsY.push({type:"gap_duplicate",gap,protrusionDirection:"bottom",nudge:duplicationBottomNudge}))}}getPointSnapLines({nearestSnapsX,nearestSnapsY}){const snapGroupsX={},snapGroupsY={};if(nearestSnapsX.length>0)for(const snap of nearestSnapsX)if("points"===snap.type){const key=round(snap.points.otherPoint.x);snapGroupsX[key]||(snapGroupsX[key]=[]),snapGroupsX[key].push(snap.points)}if(nearestSnapsY.length>0)for(const snap of nearestSnapsY)if("points"===snap.type){const key=round(snap.points.otherPoint.y);snapGroupsY[key]||(snapGroupsY[key]=[]),snapGroupsY[key].push(snap.points)}return Object.values(snapGroupsX).concat(Object.values(snapGroupsY)).map((snapGroup=>({id:(0,dist_esm.NF)(),type:"points",points:(0,dist_esm.Qq)(snapGroup.map((snap=>Vec.From(snap.otherPoint))).concat(snapGroup.map((snap=>Vec.From(snap.thisPoint)))),((a,b)=>a.equals(b)))})))}getGapSnapLines({selectionPageBounds,nearestSnapsX,nearestSnapsY}){const{vertical,horizontal}=this.getVisibleGaps(),selectionSides={top:selectionPageBounds.sides[0],right:selectionPageBounds.sides[1],bottom:[selectionPageBounds.corners[3],selectionPageBounds.corners[2]],left:[selectionPageBounds.corners[0],selectionPageBounds.corners[3]]},result=[];if(nearestSnapsX.length>0)for(const snap of nearestSnapsX){if("points"===snap.type)continue;const{gap:{breadthIntersection,startEdge,startNode,endNode,length,endEdge}}=snap;switch(snap.type){case"gap_center":{const newGapsLength=(length-selectionPageBounds.width)/2,gapBreadthIntersection=rangeIntersection(breadthIntersection[0],breadthIntersection[1],selectionPageBounds.minY,selectionPageBounds.maxY);result.push({type:"gaps",direction:"horizontal",id:(0,dist_esm.NF)(),gaps:[...findAdjacentGaps(horizontal,startNode.id,newGapsLength,"backward",gapBreadthIntersection),{startEdge,endEdge:selectionSides.left},{startEdge:selectionSides.right,endEdge},...findAdjacentGaps(horizontal,endNode.id,newGapsLength,"forward",gapBreadthIntersection)]});break}case"gap_duplicate":{const gapBreadthIntersection=rangeIntersection(breadthIntersection[0],breadthIntersection[1],selectionPageBounds.minY,selectionPageBounds.maxY);result.push({type:"gaps",direction:"horizontal",id:(0,dist_esm.NF)(),gaps:"left"===snap.protrusionDirection?[{startEdge:selectionSides.right,endEdge:startEdge.map((v=>v.clone().addXY(-startNode.pageBounds.width,0)))},{startEdge,endEdge},...findAdjacentGaps(horizontal,endNode.id,length,"forward",gapBreadthIntersection)]:[...findAdjacentGaps(horizontal,startNode.id,length,"backward",gapBreadthIntersection),{startEdge,endEdge},{startEdge:endEdge.map((v=>v.clone().addXY(snap.gap.endNode.pageBounds.width,0))),endEdge:selectionSides.left}]});break}}}if(nearestSnapsY.length>0)for(const snap of nearestSnapsY){if("points"===snap.type)continue;const{gap:{breadthIntersection,startEdge,startNode,endNode,length,endEdge}}=snap;switch(snap.type){case"gap_center":{const newGapsLength=(length-selectionPageBounds.height)/2,gapBreadthIntersection=rangeIntersection(breadthIntersection[0],breadthIntersection[1],selectionPageBounds.minX,selectionPageBounds.maxX);result.push({type:"gaps",direction:"vertical",id:(0,dist_esm.NF)(),gaps:[...findAdjacentGaps(vertical,startNode.id,newGapsLength,"backward",gapBreadthIntersection),{startEdge,endEdge:selectionSides.top},{startEdge:selectionSides.bottom,endEdge},...findAdjacentGaps(vertical,snap.gap.endNode.id,newGapsLength,"forward",gapBreadthIntersection)]});break}case"gap_duplicate":{const gapBreadthIntersection=rangeIntersection(breadthIntersection[0],breadthIntersection[1],selectionPageBounds.minX,selectionPageBounds.maxX);result.push({type:"gaps",direction:"vertical",id:(0,dist_esm.NF)(),gaps:"top"===snap.protrusionDirection?[{startEdge:selectionSides.bottom,endEdge:startEdge.map((v=>v.clone().addXY(0,-startNode.pageBounds.height)))},{startEdge,endEdge},...findAdjacentGaps(vertical,endNode.id,length,"forward",gapBreadthIntersection)]:[...findAdjacentGaps(vertical,startNode.id,length,"backward",gapBreadthIntersection),{startEdge,endEdge},{startEdge:endEdge.map((v=>v.clone().addXY(0,endNode.pageBounds.height))),endEdge:selectionSides.top}]})}}}return function dedupeGapSnaps(snaps){snaps.sort(((a,b)=>b.gaps.length-a.gaps.length));for(let i=snaps.length-1;i>0;i--){const snap=snaps[i];for(let j=i-1;j>=0;j--){const otherSnap=snaps[j];if(otherSnap.direction===snap.direction&&snap.gaps.every((gap=>otherSnap.gaps.some((otherGap=>round(gap.startEdge[0].x)===round(otherGap.startEdge[0].x)&&round(gap.startEdge[0].y)===round(otherGap.startEdge[0].y)&&round(gap.startEdge[1].x)===round(otherGap.startEdge[1].x)&&round(gap.startEdge[1].y)===round(otherGap.startEdge[1].y)))&&otherSnap.gaps.some((otherGap=>round(gap.endEdge[0].x)===round(otherGap.endEdge[0].x)&&round(gap.endEdge[0].y)===round(otherGap.endEdge[0].y)&&round(gap.endEdge[1].x)===round(otherGap.endEdge[1].x)&&round(gap.endEdge[1].y)===round(otherGap.endEdge[1].y)))))){snaps.splice(i,1);break}}}}(result),result}}function getResizeSnapPointsForHandle(handle,selectionPageBounds){const{minX,maxX,minY,maxY}=selectionPageBounds,result=[];switch(handle){case"top":case"left":case"top_left":case"any":result.push({id:"top_left",handle:"top_left",x:minX,y:minY})}switch(handle){case"top":case"right":case"top_right":case"any":result.push({id:"top_right",handle:"top_right",x:maxX,y:minY})}switch(handle){case"bottom":case"right":case"bottom_right":case"any":result.push({id:"bottom_right",handle:"bottom_right",x:maxX,y:maxY})}switch(handle){case"bottom":case"left":case"bottom_left":case"any":result.push({id:"bottom_left",handle:"bottom_left",x:minX,y:maxY})}return result}BoundsSnaps_init=(base=>[,,,BoundsSnaps_create(base?.[BoundsSnaps_knownSymbol("metadata")]??null)])(null),BoundsSnaps_decorateElement(BoundsSnaps_init,1,"getSnapPointsCache",_getSnapPointsCache_dec,BoundsSnaps),BoundsSnaps_decorateElement(BoundsSnaps_init,1,"getSnappablePoints",_getSnappablePoints_dec,BoundsSnaps),BoundsSnaps_decorateElement(BoundsSnaps_init,1,"getSnappableGapNodes",_getSnappableGapNodes_dec,BoundsSnaps),BoundsSnaps_decorateElement(BoundsSnaps_init,1,"getVisibleGaps",_getVisibleGaps_dec,BoundsSnaps),BoundsSnaps_decoratorMetadata(BoundsSnaps_init,BoundsSnaps);var _getSnapGeometryCache_dec,HandleSnaps_init,HandleSnaps_create=Object.create,HandleSnaps_defProp=Object.defineProperty,HandleSnaps_getOwnPropDesc=Object.getOwnPropertyDescriptor,HandleSnaps_knownSymbol=(name,symbol)=>(symbol=Symbol[name])?symbol:Symbol.for("Symbol."+name),HandleSnaps_typeError=msg=>{throw TypeError(msg)},HandleSnaps_defNormalProp=(obj,key,value)=>key in obj?HandleSnaps_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,HandleSnaps_name=(target,value)=>HandleSnaps_defProp(target,"name",{value,configurable:!0}),HandleSnaps_decoratorStrings=["class","method","getter","setter","accessor","field","value","get","set"],HandleSnaps_expectFn=fn=>void 0!==fn&&"function"!=typeof fn?HandleSnaps_typeError("Function expected"):fn,HandleSnaps_decoratorContext=(kind,name,done,metadata,fns)=>({kind:HandleSnaps_decoratorStrings[kind],name,metadata,addInitializer:fn=>done._?HandleSnaps_typeError("Already initialized"):fns.push(HandleSnaps_expectFn(fn||null))}),HandleSnaps_decoratorMetadata=(array,target)=>HandleSnaps_defNormalProp(target,HandleSnaps_knownSymbol("metadata"),array[3]),HandleSnaps_accessCheck=(obj,member,msg)=>member.has(obj)||HandleSnaps_typeError("Cannot "+msg),HandleSnaps_privateIn=(member,obj)=>Object(obj)!==obj?HandleSnaps_typeError('Cannot use the "in" operator on this value'):member.has(obj),HandleSnaps_privateGet=(obj,member,getter)=>(HandleSnaps_accessCheck(obj,member,"read from private field"),getter?getter.call(obj):member.get(obj)),HandleSnaps_privateSet=(obj,member,value,setter)=>(HandleSnaps_accessCheck(obj,member,"write to private field"),setter?setter.call(obj,value):member.set(obj,value),value),HandleSnaps_privateMethod=(obj,member,method)=>(HandleSnaps_accessCheck(obj,member,"access private method"),method);const defaultGetSelfSnapOutline=()=>null,defaultGetSelfSnapPoints=()=>[];_getSnapGeometryCache_dec=[state_dist_esm.EW];class HandleSnaps{constructor(manager){var key,value;this.manager=manager,((array,flags,self,value)=>{for(var i=0,fns=array[flags>>1],n=fns&&fns.length;i<n;i++)1&flags?fns[i].call(self):value=fns[i].call(self,value)})(HandleSnaps_init,5,this),HandleSnaps_defNormalProp(this,"symbol"!=typeof(key="editor")?key+"":key,value),this.editor=manager.editor}getSnapGeometryCache(){const{editor}=this;return editor.store.createComputedCache("handle snap geometry",(shape=>{const snapGeometry=editor.getShapeUtil(shape).getHandleSnapGeometry(shape),getSelfSnapOutline=snapGeometry.getSelfSnapOutline?snapGeometry.getSelfSnapOutline.bind(snapGeometry):defaultGetSelfSnapOutline,getSelfSnapPoints=snapGeometry.getSelfSnapPoints?snapGeometry.getSelfSnapPoints.bind(snapGeometry):defaultGetSelfSnapPoints;return{outline:void 0===snapGeometry.outline?editor.getShapeGeometry(shape):snapGeometry.outline,points:snapGeometry.points??[],getSelfSnapOutline,getSelfSnapPoints}}))}*iterateSnapPointsInPageSpace(currentShapeId,currentHandle){const selfSnapPoints=this.getSnapGeometryCache().get(currentShapeId)?.getSelfSnapPoints(currentHandle);if(selfSnapPoints&&selfSnapPoints.length){const shapePageTransform=(0,dist_esm.Z1)(this.editor.getShapePageTransform(currentShapeId));for(const point of selfSnapPoints)yield shapePageTransform.applyToPoint(point)}for(const shapeId of this.manager.getSnappableShapes()){if(shapeId===currentShapeId)continue;const snapPoints=this.getSnapGeometryCache().get(shapeId)?.points;if(!snapPoints||!snapPoints.length)continue;const shapePageTransform=(0,dist_esm.Z1)(this.editor.getShapePageTransform(shapeId));for(const point of snapPoints)yield shapePageTransform.applyToPoint(point)}}*iterateSnapOutlines(currentShapeId,currentHandle){const selfSnapOutline=this.getSnapGeometryCache().get(currentShapeId)?.getSelfSnapOutline(currentHandle);selfSnapOutline&&(yield{shapeId:currentShapeId,outline:selfSnapOutline});for(const shapeId of this.manager.getSnappableShapes()){if(shapeId===currentShapeId)continue;const snapOutline=this.getSnapGeometryCache().get(shapeId)?.outline;snapOutline&&(yield{shapeId,outline:snapOutline})}}getHandleSnapPosition({currentShapeId,handle,handleInPageSpace}){const snapThreshold=this.manager.getSnapThreshold();let minDistanceForSnapPoint=snapThreshold,nearestSnapPoint=null;for(const snapPoint of this.iterateSnapPointsInPageSpace(currentShapeId,handle))Vec.DistMin(handleInPageSpace,snapPoint,minDistanceForSnapPoint)&&(minDistanceForSnapPoint=Vec.Dist(handleInPageSpace,snapPoint),nearestSnapPoint=snapPoint);if(nearestSnapPoint)return nearestSnapPoint;let minDistanceForOutline=snapThreshold,nearestPointOnOutline=null;for(const{shapeId,outline}of this.iterateSnapOutlines(currentShapeId,handle)){const shapePageTransform=(0,dist_esm.Z1)(this.editor.getShapePageTransform(shapeId)),pointInShapeSpace=this.editor.getPointInShapeSpace(shapeId,handleInPageSpace),nearestShapePointInShapeSpace=outline.nearestPoint(pointInShapeSpace),nearestInPageSpace=shapePageTransform.applyToPoint(nearestShapePointInShapeSpace);Vec.DistMin(handleInPageSpace,nearestInPageSpace,minDistanceForOutline)&&(minDistanceForOutline=Vec.Dist(handleInPageSpace,nearestInPageSpace),nearestPointOnOutline=nearestInPageSpace)}return nearestPointOnOutline||null}snapHandle({currentShapeId,handle}){const handleInPageSpace=(0,dist_esm.Z1)(this.editor.getShapePageTransform(currentShapeId)).applyToPoint(handle),snapPosition=this.getHandleSnapPosition({currentShapeId,handle,handleInPageSpace});return snapPosition?(this.manager.setIndicators([{id:(0,dist_esm.NF)(),type:"points",points:[snapPosition]}]),{nudge:Vec.Sub(snapPosition,handleInPageSpace)}):null}}HandleSnaps_init=(base=>[,,,HandleSnaps_create(base?.[HandleSnaps_knownSymbol("metadata")]??null)])(null),((array,flags,name,decorators,target,extra)=>{var fn,it,done,ctx,access,k=7&flags,s=!!(8&flags),p=!!(16&flags),j=k>3?array.length+1:k?s?1:2:0,key=HandleSnaps_decoratorStrings[k+5],initializers=k>3&&(array[j-1]=[]),extraInitializers=array[j]||(array[j]=[]),desc=k&&(!p&&!s&&(target=target.prototype),k<5&&(k>3||!p)&&HandleSnaps_getOwnPropDesc(k<4?target:{get[name](){return HandleSnaps_privateGet(this,extra)},set[name](x){return HandleSnaps_privateSet(this,extra,x)}},name));k?p&&k<4&&HandleSnaps_name(extra,(k>2?"set ":k>1?"get ":"")+name):HandleSnaps_name(target,name);for(var i=decorators.length-1;i>=0;i--)ctx=HandleSnaps_decoratorContext(k,name,done={},array[3],extraInitializers),k&&(ctx.static=s,ctx.private=p,access=ctx.access={has:p?x=>HandleSnaps_privateIn(target,x):x=>name in x},3^k&&(access.get=p?x=>(1^k?HandleSnaps_privateGet:HandleSnaps_privateMethod)(x,target,4^k?extra:desc.get):x=>x[name]),k>2&&(access.set=p?(x,y)=>HandleSnaps_privateSet(x,target,y,4^k?extra:desc.set):(x,y)=>x[name]=y)),it=(0,decorators[i])(k?k<4?p?extra:desc[key]:k>4?void 0:{get:desc.get,set:desc.set}:target,ctx),done._=1,4^k||void 0===it?HandleSnaps_expectFn(it)&&(k>4?initializers.unshift(it):k?p?extra=it:desc[key]=it:target=it):"object"!=typeof it||null===it?HandleSnaps_typeError("Object expected"):(HandleSnaps_expectFn(fn=it.get)&&(desc.get=fn),HandleSnaps_expectFn(fn=it.set)&&(desc.set=fn),HandleSnaps_expectFn(fn=it.init)&&initializers.unshift(fn));k||HandleSnaps_decoratorMetadata(array,target),desc&&HandleSnaps_defProp(target,name,desc)})(HandleSnaps_init,1,"getSnapGeometryCache",_getSnapGeometryCache_dec,HandleSnaps),HandleSnaps_decoratorMetadata(HandleSnaps_init,HandleSnaps);var _getCurrentCommonAncestor_dec,_getSnappableShapes_dec,_getSnapThreshold_dec,SnapManager_init,SnapManager_create=Object.create,SnapManager_defProp=Object.defineProperty,SnapManager_getOwnPropDesc=Object.getOwnPropertyDescriptor,SnapManager_knownSymbol=(name,symbol)=>(symbol=Symbol[name])?symbol:Symbol.for("Symbol."+name),SnapManager_typeError=msg=>{throw TypeError(msg)},SnapManager_defNormalProp=(obj,key,value)=>key in obj?SnapManager_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,SnapManager_name=(target,value)=>SnapManager_defProp(target,"name",{value,configurable:!0}),SnapManager_decoratorStrings=["class","method","getter","setter","accessor","field","value","get","set"],SnapManager_expectFn=fn=>void 0!==fn&&"function"!=typeof fn?SnapManager_typeError("Function expected"):fn,SnapManager_decoratorContext=(kind,name,done,metadata,fns)=>({kind:SnapManager_decoratorStrings[kind],name,metadata,addInitializer:fn=>done._?SnapManager_typeError("Already initialized"):fns.push(SnapManager_expectFn(fn||null))}),SnapManager_decoratorMetadata=(array,target)=>SnapManager_defNormalProp(target,SnapManager_knownSymbol("metadata"),array[3]),SnapManager_decorateElement=(array,flags,name,decorators,target,extra)=>{var fn,it,done,ctx,access,k=7&flags,s=!!(8&flags),p=!!(16&flags),j=k>3?array.length+1:k?s?1:2:0,key=SnapManager_decoratorStrings[k+5],initializers=k>3&&(array[j-1]=[]),extraInitializers=array[j]||(array[j]=[]),desc=k&&(!p&&!s&&(target=target.prototype),k<5&&(k>3||!p)&&SnapManager_getOwnPropDesc(k<4?target:{get[name](){return SnapManager_privateGet(this,extra)},set[name](x){return SnapManager_privateSet(this,extra,x)}},name));k?p&&k<4&&SnapManager_name(extra,(k>2?"set ":k>1?"get ":"")+name):SnapManager_name(target,name);for(var i=decorators.length-1;i>=0;i--)ctx=SnapManager_decoratorContext(k,name,done={},array[3],extraInitializers),k&&(ctx.static=s,ctx.private=p,access=ctx.access={has:p?x=>SnapManager_privateIn(target,x):x=>name in x},3^k&&(access.get=p?x=>(1^k?SnapManager_privateGet:SnapManager_privateMethod)(x,target,4^k?extra:desc.get):x=>x[name]),k>2&&(access.set=p?(x,y)=>SnapManager_privateSet(x,target,y,4^k?extra:desc.set):(x,y)=>x[name]=y)),it=(0,decorators[i])(k?k<4?p?extra:desc[key]:k>4?void 0:{get:desc.get,set:desc.set}:target,ctx),done._=1,4^k||void 0===it?SnapManager_expectFn(it)&&(k>4?initializers.unshift(it):k?p?extra=it:desc[key]=it:target=it):"object"!=typeof it||null===it?SnapManager_typeError("Object expected"):(SnapManager_expectFn(fn=it.get)&&(desc.get=fn),SnapManager_expectFn(fn=it.set)&&(desc.set=fn),SnapManager_expectFn(fn=it.init)&&initializers.unshift(fn));return k||SnapManager_decoratorMetadata(array,target),desc&&SnapManager_defProp(target,name,desc),p?4^k?extra:desc:target},SnapManager_publicField=(obj,key,value)=>SnapManager_defNormalProp(obj,"symbol"!=typeof key?key+"":key,value),SnapManager_accessCheck=(obj,member,msg)=>member.has(obj)||SnapManager_typeError("Cannot "+msg),SnapManager_privateIn=(member,obj)=>Object(obj)!==obj?SnapManager_typeError('Cannot use the "in" operator on this value'):member.has(obj),SnapManager_privateGet=(obj,member,getter)=>(SnapManager_accessCheck(obj,member,"read from private field"),getter?getter.call(obj):member.get(obj)),SnapManager_privateSet=(obj,member,value,setter)=>(SnapManager_accessCheck(obj,member,"write to private field"),setter?setter.call(obj,value):member.set(obj,value),value),SnapManager_privateMethod=(obj,member,method)=>(SnapManager_accessCheck(obj,member,"access private method"),method);_getSnapThreshold_dec=[state_dist_esm.EW],_getSnappableShapes_dec=[state_dist_esm.EW],_getCurrentCommonAncestor_dec=[state_dist_esm.EW];class SnapManager{constructor(editor){this.editor=editor,((array,flags,self,value)=>{for(var i=0,fns=array[flags>>1],n=fns&&fns.length;i<n;i++)1&flags?fns[i].call(self):value=fns[i].call(self,value)})(SnapManager_init,5,this),SnapManager_publicField(this,"shapeBounds"),SnapManager_publicField(this,"handles"),SnapManager_publicField(this,"_snapIndicators",(0,state_dist_esm.eU)("snapLines",void 0)),this.shapeBounds=new BoundsSnaps(this),this.handles=new HandleSnaps(this)}getIndicators(){return this._snapIndicators.get()??state_dist_esm.Ml}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(indicators){this._snapIndicators.set(indicators)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor}=this,renderingBounds=editor.getViewportPageBounds(),selectedShapeIds=editor.getSelectedShapeIds(),snappableShapes=new Set,collectSnappableShapesFromParent=parentId=>{if(isShapeId(parentId)){const parent=editor.getShape(parentId);parent&&editor.isShapeOfType(parent,"frame")&&snappableShapes.add(parentId)}const sortedChildIds=editor.getSortedChildIdsForParent(parentId);for(const childId of sortedChildIds){if(selectedShapeIds.includes(childId))continue;const childShape=editor.getShape(childId);if(!childShape)continue;if(!editor.getShapeUtil(childShape).canSnap(childShape))continue;const pageBounds=editor.getShapePageBounds(childId);pageBounds&&renderingBounds.includes(pageBounds)&&(editor.isShapeOfType(childShape,"group")?collectSnappableShapesFromParent(childId):snappableShapes.add(childId))}};return collectSnappableShapesFromParent(this.getCurrentCommonAncestor()??editor.getCurrentPageId()),snappableShapes}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}SnapManager_init=(base=>[,,,SnapManager_create(base?.[SnapManager_knownSymbol("metadata")]??null)])(null),SnapManager_decorateElement(SnapManager_init,1,"getSnapThreshold",_getSnapThreshold_dec,SnapManager),SnapManager_decorateElement(SnapManager_init,1,"getSnappableShapes",_getSnappableShapes_dec,SnapManager),SnapManager_decorateElement(SnapManager_init,1,"getCurrentCommonAncestor",_getCurrentCommonAncestor_dec,SnapManager),SnapManager_decoratorMetadata(SnapManager_init,SnapManager);const fixNewLines=/\r?\n|\r/g;function normalizeTextForDom(text){return text.replace(fixNewLines,"\n").split("\n").map((x=>x||" ")).join("\n")}const textAlignmentsForLtr={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},spaceCharacterRegex=/\s/;class TextManager{constructor(editor){this.editor=editor,this.baseElem=document.createElement("div"),this.baseElem.classList.add("tl-text"),this.baseElem.classList.add("tl-text-measure"),this.baseElem.tabIndex=-1}baseElem;measureText(textToMeasure,opts){const div=document.createElement("div");return div.textContent=normalizeTextForDom(textToMeasure),this.measureHtml(div.innerHTML,opts)}measureHtml(html,opts){const wrapperElm=this.baseElem.cloneNode();if(this.editor.getContainer().appendChild(wrapperElm),wrapperElm.innerHTML=html,this.baseElem.insertAdjacentElement("afterend",wrapperElm),wrapperElm.setAttribute("dir","auto"),wrapperElm.style.setProperty("unicode-bidi","plaintext"),wrapperElm.style.setProperty("font-family",opts.fontFamily),wrapperElm.style.setProperty("font-style",opts.fontStyle),wrapperElm.style.setProperty("font-weight",opts.fontWeight),wrapperElm.style.setProperty("font-size",opts.fontSize+"px"),wrapperElm.style.setProperty("line-height",opts.lineHeight*opts.fontSize+"px"),wrapperElm.style.setProperty("max-width",null===opts.maxWidth?null:opts.maxWidth+"px"),wrapperElm.style.setProperty("min-width",null===opts.minWidth?null:opts.minWidth+"px"),wrapperElm.style.setProperty("padding",opts.padding),wrapperElm.style.setProperty("overflow-wrap",opts.disableOverflowWrapBreaking?"normal":"break-word"),opts.otherStyles)for(const[key,value]of Object.entries(opts.otherStyles))wrapperElm.style.setProperty(key,value);const scrollWidth=wrapperElm.scrollWidth,rect=wrapperElm.getBoundingClientRect();return wrapperElm.remove(),{x:0,y:0,w:rect.width,h:rect.height,scrollWidth}}measureElementTextNodeSpans(element,{shouldTruncateToFirstLine=!1}={}){const spans=[],elmBounds=element.getBoundingClientRect(),offsetX=-elmBounds.left,offsetY=-elmBounds.top,range=new Range,textNode=element.childNodes[0];let idx=0,currentSpan=null,prevCharWasSpaceCharacter=null,prevCharTop=0,prevCharLeftForRTLTest=0,didTruncate=!1;for(const childNode of element.childNodes)if(childNode.nodeType===Node.TEXT_NODE)for(const char of childNode.textContent??""){range.setStart(textNode,idx),range.setEnd(textNode,idx+char.length);const rects=range.getClientRects(),rect=rects[rects.length-1],top=rect.top+offsetY,left=rect.left+offsetX,right=rect.right+offsetX,isRTL=left<prevCharLeftForRTLTest,isSpaceCharacter=spaceCharacterRegex.test(char);if(isSpaceCharacter===prevCharWasSpaceCharacter&&top===prevCharTop&&currentSpan)isRTL&&(currentSpan.box.x=left),currentSpan.box.w=isRTL?currentSpan.box.w+rect.width:right-currentSpan.box.x,currentSpan.text+=char;else{if(currentSpan){if(shouldTruncateToFirstLine&&top!==prevCharTop){didTruncate=!0;break}spans.push(currentSpan)}currentSpan={box:{x:left,y:top,w:rect.width,h:rect.height},text:char},prevCharLeftForRTLTest=left}"\n"===char&&(prevCharLeftForRTLTest=0),prevCharWasSpaceCharacter=isSpaceCharacter,prevCharTop=top,idx+=char.length}return currentSpan&&spans.push(currentSpan),{spans,didTruncate}}measureTextSpans(textToMeasure,opts){if(""===textToMeasure)return[];const elm=this.baseElem.cloneNode();this.editor.getContainer().appendChild(elm);const elementWidth=Math.ceil(opts.width-2*opts.padding);if(elm.setAttribute("dir","auto"),elm.style.setProperty("unicode-bidi","plaintext"),elm.style.setProperty("width",`${elementWidth}px`),elm.style.setProperty("height","min-content"),elm.style.setProperty("font-size",`${opts.fontSize}px`),elm.style.setProperty("font-family",opts.fontFamily),elm.style.setProperty("font-weight",opts.fontWeight),elm.style.setProperty("line-height",opts.lineHeight*opts.fontSize+"px"),elm.style.setProperty("text-align",textAlignmentsForLtr[opts.textAlign]),elm.style.setProperty("font-style",opts.fontStyle),opts.otherStyles)for(const[key,value]of Object.entries(opts.otherStyles))elm.style.setProperty(key,value);const shouldTruncateToFirstLine="truncate-ellipsis"===opts.overflow||"truncate-clip"===opts.overflow;shouldTruncateToFirstLine&&(elm.style.setProperty("overflow-wrap","anywhere"),elm.style.setProperty("word-break","break-all"));const normalizedText=normalizeTextForDom(textToMeasure);elm.textContent=normalizedText;const{spans,didTruncate}=this.measureElementTextNodeSpans(elm,{shouldTruncateToFirstLine});if("truncate-ellipsis"===opts.overflow&&didTruncate){elm.textContent="â¦";const ellipsisWidth=Math.ceil(this.measureElementTextNodeSpans(elm).spans[0].box.w);elm.style.setProperty("width",elementWidth-ellipsisWidth+"px"),elm.textContent=normalizedText;const truncatedSpans=this.measureElementTextNodeSpans(elm,{shouldTruncateToFirstLine:!0}).spans,lastSpan=truncatedSpans[truncatedSpans.length-1];return truncatedSpans.push({text:"â¦",box:{x:Math.min(lastSpan.box.x+lastSpan.box.w,opts.width-opts.padding-ellipsisWidth),y:lastSpan.box.y,w:ellipsisWidth,h:lastSpan.box.h}}),truncatedSpans}return elm.remove(),spans}}__webpack_require__("./node_modules/process/browser.js");var _dispose_dec,_tick_dec,TickManager_init,TickManager_create=Object.create,TickManager_defProp=Object.defineProperty,TickManager_getOwnPropDesc=Object.getOwnPropertyDescriptor,TickManager_knownSymbol=(name,symbol)=>(symbol=Symbol[name])?symbol:Symbol.for("Symbol."+name),TickManager_typeError=msg=>{throw TypeError(msg)},TickManager_defNormalProp=(obj,key,value)=>key in obj?TickManager_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,TickManager_name=(target,value)=>TickManager_defProp(target,"name",{value,configurable:!0}),TickManager_decoratorStrings=["class","method","getter","setter","accessor","field","value","get","set"],TickManager_expectFn=fn=>void 0!==fn&&"function"!=typeof fn?TickManager_typeError("Function expected"):fn,TickManager_decoratorContext=(kind,name,done,metadata,fns)=>({kind:TickManager_decoratorStrings[kind],name,metadata,addInitializer:fn=>done._?TickManager_typeError("Already initialized"):fns.push(TickManager_expectFn(fn||null))}),TickManager_decoratorMetadata=(array,target)=>TickManager_defNormalProp(target,TickManager_knownSymbol("metadata"),array[3]),TickManager_decorateElement=(array,flags,name,decorators,target,extra)=>{var fn,it,done,ctx,access,k=7&flags,s=!!(8&flags),p=!!(16&flags),j=k>3?array.length+1:k?s?1:2:0,key=TickManager_decoratorStrings[k+5],initializers=k>3&&(array[j-1]=[]),extraInitializers=array[j]||(array[j]=[]),desc=k&&(!p&&!s&&(target=target.prototype),k<5&&(k>3||!p)&&TickManager_getOwnPropDesc(k<4?target:{get[name](){return TickManager_privateGet(this,extra)},set[name](x){return TickManager_privateSet(this,extra,x)}},name));k?p&&k<4&&TickManager_name(extra,(k>2?"set ":k>1?"get ":"")+name):TickManager_name(target,name);for(var i=decorators.length-1;i>=0;i--)ctx=TickManager_decoratorContext(k,name,done={},array[3],extraInitializers),k&&(ctx.static=s,ctx.private=p,access=ctx.access={has:p?x=>TickManager_privateIn(target,x):x=>name in x},3^k&&(access.get=p?x=>(1^k?TickManager_privateGet:TickManager_privateMethod)(x,target,4^k?extra:desc.get):x=>x[name]),k>2&&(access.set=p?(x,y)=>TickManager_privateSet(x,target,y,4^k?extra:desc.set):(x,y)=>x[name]=y)),it=(0,decorators[i])(k?k<4?p?extra:desc[key]:k>4?void 0:{get:desc.get,set:desc.set}:target,ctx),done._=1,4^k||void 0===it?TickManager_expectFn(it)&&(k>4?initializers.unshift(it):k?p?extra=it:desc[key]=it:target=it):"object"!=typeof it||null===it?TickManager_typeError("Object expected"):(TickManager_expectFn(fn=it.get)&&(desc.get=fn),TickManager_expectFn(fn=it.set)&&(desc.set=fn),TickManager_expectFn(fn=it.init)&&initializers.unshift(fn));return k||TickManager_decoratorMetadata(array,target),desc&&TickManager_defProp(target,name,desc),p?4^k?extra:desc:target},TickManager_publicField=(obj,key,value)=>TickManager_defNormalProp(obj,"symbol"!=typeof key?key+"":key,value),TickManager_accessCheck=(obj,member,msg)=>member.has(obj)||TickManager_typeError("Cannot "+msg),TickManager_privateIn=(member,obj)=>Object(obj)!==obj?TickManager_typeError('Cannot use the "in" operator on this value'):member.has(obj),TickManager_privateGet=(obj,member,getter)=>(TickManager_accessCheck(obj,member,"read from private field"),getter?getter.call(obj):member.get(obj)),TickManager_privateSet=(obj,member,value,setter)=>(TickManager_accessCheck(obj,member,"write to private field"),setter?setter.call(obj,value):member.set(obj,value),value),TickManager_privateMethod=(obj,member,method)=>(TickManager_accessCheck(obj,member,"access private method"),method);const throttleToNextFrame=dist_esm.Uo;_tick_dec=[dist_esm.oI],_dispose_dec=[dist_esm.oI];class TickManager{constructor(editor){this.editor=editor,((array,flags,self,value)=>{for(var i=0,fns=array[flags>>1],n=fns&&fns.length;i<n;i++)1&flags?fns[i].call(self):value=fns[i].call(self,value)})(TickManager_init,5,this),TickManager_publicField(this,"cancelRaf"),TickManager_publicField(this,"isPaused",!0),TickManager_publicField(this,"now",0),TickManager_publicField(this,"prevPoint",new Vec),this.editor.disposables.add(this.dispose),this.start()}start(){this.isPaused=!1,this.cancelRaf?.(),this.cancelRaf=throttleToNextFrame(this.tick),this.now=Date.now()}tick(){if(this.isPaused)return;const now=Date.now(),elapsed=now-this.now;this.now=now,this.updatePointerVelocity(elapsed),this.editor.emit("frame",elapsed),this.editor.emit("tick",elapsed),this.cancelRaf=throttleToNextFrame(this.tick)}dispose(){this.isPaused=!0,this.cancelRaf?.()}updatePointerVelocity(elapsed){const{prevPoint,editor:{inputs:{currentScreenPoint,pointerVelocity}}}=this;if(0===elapsed)return;const delta=Vec.Sub(currentScreenPoint,prevPoint);this.prevPoint=currentScreenPoint.clone();const length=delta.len(),direction=length?delta.div(length):new Vec(0,0),next=pointerVelocity.clone().lrp(direction.mul(length/elapsed),.5);Math.abs(next.x)<.01&&(next.x=0),Math.abs(next.y)<.01&&(next.y=0),pointerVelocity.equals(next)||(this.editor.inputs.pointerVelocity=next)}}TickManager_init=(base=>[,,,TickManager_create(base?.[TickManager_knownSymbol("metadata")]??null)])(null),TickManager_decorateElement(TickManager_init,1,"tick",_tick_dec,TickManager),TickManager_decorateElement(TickManager_init,1,"dispose",_dispose_dec,TickManager),TickManager_decoratorMetadata(TickManager_init,TickManager);var _getIsPasteAtCursorMode_dec,_getIsDynamicResizeMode_dec,_getIsWrapMode_dec,_getIsSnapMode_dec,_getColor_dec,_getLocale_dec,_getName_dec,_getId_dec,_getAnimationSpeed_dec,_getEdgeScrollSpeed_dec,_getIsDarkMode_dec,_getUserPreferences_dec,UserPreferencesManager_init,UserPreferencesManager_create=Object.create,UserPreferencesManager_defProp=Object.defineProperty,UserPreferencesManager_getOwnPropDesc=Object.getOwnPropertyDescriptor,UserPreferencesManager_knownSymbol=(name,symbol)=>(symbol=Symbol[name])?symbol:Symbol.for("Symbol."+name),UserPreferencesManager_typeError=msg=>{throw TypeError(msg)},UserPreferencesManager_defNormalProp=(obj,key,value)=>key in obj?UserPreferencesManager_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,UserPreferencesManager_name=(target,value)=>UserPreferencesManager_defProp(target,"name",{value,configurable:!0}),UserPreferencesManager_decoratorStrings=["class","method","getter","setter","accessor","field","value","get","set"],UserPreferencesManager_expectFn=fn=>void 0!==fn&&"function"!=typeof fn?UserPreferencesManager_typeError("Function expected"):fn,UserPreferencesManager_decoratorContext=(kind,name,done,metadata,fns)=>({kind:UserPreferencesManager_decoratorStrings[kind],name,metadata,addInitializer:fn=>done._?UserPreferencesManager_typeError("Already initialized"):fns.push(UserPreferencesManager_expectFn(fn||null))}),UserPreferencesManager_decoratorMetadata=(array,target)=>UserPreferencesManager_defNormalProp(target,UserPreferencesManager_knownSymbol("metadata"),array[3]),UserPreferencesManager_decorateElement=(array,flags,name,decorators,target,extra)=>{var fn,it,done,ctx,access,k=7&flags,s=!!(8&flags),p=!!(16&flags),j=k>3?array.length+1:k?s?1:2:0,key=UserPreferencesManager_decoratorStrings[k+5],initializers=k>3&&(array[j-1]=[]),extraInitializers=array[j]||(array[j]=[]),desc=k&&(!p&&!s&&(target=target.prototype),k<5&&(k>3||!p)&&UserPreferencesManager_getOwnPropDesc(k<4?target:{get[name](){return UserPreferencesManager_privateGet(this,extra)},set[name](x){return UserPreferencesManager_privateSet(this,extra,x)}},name));k?p&&k<4&&UserPreferencesManager_name(extra,(k>2?"set ":k>1?"get ":"")+name):UserPreferencesManager_name(target,name);for(var i=decorators.length-1;i>=0;i--)ctx=UserPreferencesManager_decoratorContext(k,name,done={},array[3],extraInitializers),k&&(ctx.static=s,ctx.private=p,access=ctx.access={has:p?x=>UserPreferencesManager_privateIn(target,x):x=>name in x},3^k&&(access.get=p?x=>(1^k?UserPreferencesManager_privateGet:UserPreferencesManager_privateMethod)(x,target,4^k?extra:desc.get):x=>x[name]),k>2&&(access.set=p?(x,y)=>UserPreferencesManager_privateSet(x,target,y,4^k?extra:desc.set):(x,y)=>x[name]=y)),it=(0,decorators[i])(k?k<4?p?extra:desc[key]:k>4?void 0:{get:desc.get,set:desc.set}:target,ctx),done._=1,4^k||void 0===it?UserPreferencesManager_expectFn(it)&&(k>4?initializers.unshift(it):k?p?extra=it:desc[key]=it:target=it):"object"!=typeof it||null===it?UserPreferencesManager_typeError("Object expected"):(UserPreferencesManager_expectFn(fn=it.get)&&(desc.get=fn),UserPreferencesManager_expectFn(fn=it.set)&&(desc.set=fn),UserPreferencesManager_expectFn(fn=it.init)&&initializers.unshift(fn));return k||UserPreferencesManager_decoratorMetadata(array,target),desc&&UserPreferencesManager_defProp(target,name,desc),p?4^k?extra:desc:target},UserPreferencesManager_publicField=(obj,key,value)=>UserPreferencesManager_defNormalProp(obj,"symbol"!=typeof key?key+"":key,value),UserPreferencesManager_accessCheck=(obj,member,msg)=>member.has(obj)||UserPreferencesManager_typeError("Cannot "+msg),UserPreferencesManager_privateIn=(member,obj)=>Object(obj)!==obj?UserPreferencesManager_typeError('Cannot use the "in" operator on this value'):member.has(obj),UserPreferencesManager_privateGet=(obj,member,getter)=>(UserPreferencesManager_accessCheck(obj,member,"read from private field"),getter?getter.call(obj):member.get(obj)),UserPreferencesManager_privateSet=(obj,member,value,setter)=>(UserPreferencesManager_accessCheck(obj,member,"write to private field"),setter?setter.call(obj,value):member.set(obj,value),value),UserPreferencesManager_privateMethod=(obj,member,method)=>(UserPreferencesManager_accessCheck(obj,member,"access private method"),method);_getUserPreferences_dec=[state_dist_esm.EW],_getIsDarkMode_dec=[state_dist_esm.EW],_getEdgeScrollSpeed_dec=[state_dist_esm.EW],_getAnimationSpeed_dec=[state_dist_esm.EW],_getId_dec=[state_dist_esm.EW],_getName_dec=[state_dist_esm.EW],_getLocale_dec=[state_dist_esm.EW],_getColor_dec=[state_dist_esm.EW],_getIsSnapMode_dec=[state_dist_esm.EW],_getIsWrapMode_dec=[state_dist_esm.EW],_getIsDynamicResizeMode_dec=[state_dist_esm.EW],_getIsPasteAtCursorMode_dec=[state_dist_esm.EW];class UserPreferencesManager{constructor(user,inferDarkMode){if(this.user=user,this.inferDarkMode=inferDarkMode,((array,flags,self,value)=>{for(var i=0,fns=array[flags>>1],n=fns&&fns.length;i<n;i++)1&flags?fns[i].call(self):value=fns[i].call(self,value)})(UserPreferencesManager_init,5,this),UserPreferencesManager_publicField(this,"systemColorScheme",(0,state_dist_esm.eU)("systemColorScheme","light")),UserPreferencesManager_publicField(this,"disposables",new Set),"undefined"==typeof window||!("matchMedia"in window))return;const darkModeMediaQuery=window.matchMedia("(prefers-color-scheme: dark)");darkModeMediaQuery?.matches&&this.systemColorScheme.set("dark");const handleChange=e=>{e.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")};darkModeMediaQuery?.addEventListener("change",handleChange),this.disposables.add((()=>darkModeMediaQuery?.removeEventListener("change",handleChange)))}dispose(){this.disposables.forEach((d=>d()))}updateUserPreferences(userPreferences){this.user.setUserPreferences({...this.user.userPreferences.get(),...userPreferences})}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return"dark"===this.systemColorScheme.get();default:return!!this.inferDarkMode&&"dark"===this.systemColorScheme.get()}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??defaultUserPreferences.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??defaultUserPreferences.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name?.trim()??defaultUserPreferences.name}getLocale(){return this.user.userPreferences.get().locale??defaultUserPreferences.locale}getColor(){return this.user.userPreferences.get().color??defaultUserPreferences.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??defaultUserPreferences.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??defaultUserPreferences.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??defaultUserPreferences.isDynamicSizeMode}getIsPasteAtCursorMode(){return this.user.userPreferences.get().isPasteAtCursorMode??defaultUserPreferences.isPasteAtCursorMode}}UserPreferencesManager_init=(base=>[,,,UserPreferencesManager_create(base?.[UserPreferencesManager_knownSymbol("metadata")]??null)])(null),UserPreferencesManager_decorateElement(UserPreferencesManager_init,1,"getUserPreferences",_getUserPreferences_dec,UserPreferencesManager),UserPreferencesManager_decorateElement(UserPreferencesManager_init,1,"getIsDarkMode",_getIsDarkMode_dec,UserPreferencesManager),UserPreferencesManager_decorateElement(UserPreferencesManager_init,1,"getEdgeScrollSpeed",_getEdgeScrollSpeed_dec,UserPreferencesManager),UserPreferencesManager_decorateElement(UserPreferencesManager_init,1,"getAnimationSpeed",_getAnimationSpeed_dec,UserPreferencesManager),UserPreferencesManager_decorateElement(UserPreferencesManager_init,1,"getId",_getId_dec,UserPreferencesManager),UserPreferencesManager_decorateElement(UserPreferencesManager_init,1,"getName",_getName_dec,UserPreferencesManager),UserPreferencesManager_decorateElement(UserPreferencesManager_init,1,"getLocale",_getLocale_dec,UserPreferencesManager),UserPreferencesManager_decorateElement(UserPreferencesManager_init,1,"getColor",_getColor_dec,UserPreferencesManager),UserPreferencesManager_decorateElement(UserPreferencesManager_init,1,"getIsSnapMode",_getIsSnapMode_dec,UserPreferencesManager),UserPreferencesManager_decorateElement(UserPreferencesManager_init,1,"getIsWrapMode",_getIsWrapMode_dec,UserPreferencesManager),UserPreferencesManager_decorateElement(UserPreferencesManager_init,1,"getIsDynamicResizeMode",_getIsDynamicResizeMode_dec,UserPreferencesManager),UserPreferencesManager_decorateElement(UserPreferencesManager_init,1,"getIsPasteAtCursorMode",_getIsPasteAtCursorMode_dec,UserPreferencesManager),UserPreferencesManager_decoratorMetadata(UserPreferencesManager_init,UserPreferencesManager);const EVENT_NAME_MAP={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},STATE_NODES_TO_MEASURE=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class StateNode{constructor(editor,parent){this.editor=editor;const{id,children,initial,isLockable,useCoalescedEvents}=this.constructor;this.id=id,this._isActive=(0,state_dist_esm.eU)("toolIsActive"+this.id,!1),this._current=(0,state_dist_esm.eU)("toolState"+this.id,void 0),this._path=(0,state_dist_esm.EW)("toolPath"+this.id,(()=>{const current=this.getCurrent();return this.id+(current?`.${current.getPath()}`:"")})),this.parent=parent??{},this.parent?children&&initial?(this.type="branch",this.initial=initial,this.children=Object.fromEntries(children().map((Ctor=>[Ctor.id,new Ctor(this.editor,this)]))),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",children&&initial&&(this.initial=initial,this.children=Object.fromEntries(children().map((Ctor=>[Ctor.id,new Ctor(this.editor,this)]))),this._current.set(this.children[this.initial]))),this.isLockable=isLockable,this.useCoalescedEvents=useCoalescedEvents,this.performanceTracker=new dist_esm.f6}performanceTracker;static id;static initial;static children;static isLockable=!0;static useCoalescedEvents=!1;id;type;shapeType;initial;children;isLockable;useCoalescedEvents;parent;getPath(){return this._path.get()}_path;getCurrent(){return this._current.get()}_current;getIsActive(){return this._isActive.get()}_isActive;transition(id,info={}){const path=id.split(".");let currState=this;for(let i=0;i<path.length;i++){const id2=path[i],prevChildState=currState.getCurrent(),nextChildState=currState.children?.[id2];if(!nextChildState)throw Error(`${currState.id} - no child state exists with the id ${id2}.`);if(prevChildState?.id!==nextChildState.id&&(prevChildState?.exit(info,id2),currState._current.set(nextChildState),nextChildState.enter(info,prevChildState?.id||"initial"),!nextChildState.getIsActive()))break;currState=nextChildState}return this}handleEvent(info){const cbName=EVENT_NAME_MAP[info.name],currentActiveChild=this._current.__unsafe__getWithoutCapture();this[cbName]?.(info),this._isActive.__unsafe__getWithoutCapture()&&currentActiveChild&&currentActiveChild===this._current.__unsafe__getWithoutCapture()&&currentActiveChild.handleEvent(info)}enter(info,from){if(debugFlags.measurePerformance.get()&&STATE_NODES_TO_MEASURE.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),this.onEnter?.(info,from),this.children&&this.initial&&this.getIsActive()){const initial=this.children[this.initial];this._current.set(initial),initial.enter(info,from)}}exit(info,from){debugFlags.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),this.onExit?.(info,from),this.getIsActive()||this.getCurrent()?.exit(info,from)}_currentToolIdMask=(0,state_dist_esm.eU)("curent tool id mask",void 0);getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(id){this._currentToolIdMask.set(id)}}class RootState extends StateNode{static id="root";static initial="";static children(){return[]}onKeyDown(info){if("KeyZ"===info.code)if(!info.shiftKey&&!info.ctrlKey){const currentTool=this.getCurrent();currentTool&&"idle"===currentTool.getCurrent()?.id&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...info,onInteractionEnd:currentTool.id})}}}var __setMetaKeyTimeout_dec,__setCtrlKeyTimeout_dec,__setAltKeyTimeout_dec,__setShiftKeyTimeout_dec,_getIsReadonly_dec,_getIsFocused_dec,_getSharedOpacity_dec,_getSharedStyles_dec,__getSelectionSharedStyles_dec,__getBindingsIndexCache_dec,_getCurrentPageRenderingShapesSorted_dec,_getCurrentPageShapesSorted_dec,_getCurrentPageShapes_dec,_getCurrentPageBounds_dec,_getCulledShapes_dec,__notVisibleShapes_dec,__getShapeMaskedPageBoundsCache_dec,__getShapeMaskCache_dec,__getShapeClipPathCache_dec,__getShapePageBoundsCache_dec,__getShapePageTransformCache_dec,__getShapeHandlesCache_dec,__getAllAssetsQuery_dec,_getCurrentPageShapeIdsSorted_dec,_getCurrentPageId_dec,_getPages_dec,__getAllPagesQuery_dec,_getRenderingShapes_dec,_getCollaboratorsOnCurrentPage_dec,_getCollaborators_dec,__getCollaboratorsQuery_dec,_getViewportPageBounds_dec,_getViewportScreenCenter_dec,_getViewportScreenBounds_dec,_getZoomLevel_dec,_getCameraForFollowing_dec,_getViewportPageBoundsForFollowing_dec,_getCamera_dec,__unsafe_getCameraId_dec,_getErasingShapes_dec,_getErasingShapeIds_dec,_getHintingShape_dec,_getHintingShapeIds_dec,_getHoveredShape_dec,_getHoveredShapeId_dec,_getRichTextEditor_dec,_getEditingShape_dec,_getEditingShapeId_dec,_getFocusedGroup_dec,_getFocusedGroupId_dec,_getSelectionRotatedScreenBounds_dec,_getSelectionRotatedPageBounds_dec,_getSelectionRotation_dec,_getSelectionPageBounds_dec,_getOnlySelectedShape_dec,_getOnlySelectedShapeId_dec,_getCurrentPageShapesInReadingOrder_dec,_getSelectedShapes_dec,_getSelectedShapeIds_dec,__getCurrentPageStateId_dec,_getCurrentPageState_dec,__getPageStatesQuery_dec,_getPageStates_dec,_getIsMenuOpen_dec,_getOpenMenus_dec,_getInstanceState_dec,_getDocumentSettings_dec,_getCurrentToolId_dec,_getCurrentTool_dec,_getPath_dec,_getCanRedo_dec,_getCanUndo_dec,_getIsShapeHiddenCache_dec,_a,Editor_init,Editor_create=Object.create,Editor_defProp=Object.defineProperty,Editor_getOwnPropDesc=Object.getOwnPropertyDescriptor,Editor_knownSymbol=(name,symbol)=>(symbol=Symbol[name])?symbol:Symbol.for("Symbol."+name),Editor_typeError=msg=>{throw TypeError(msg)},Editor_defNormalProp=(obj,key,value)=>key in obj?Editor_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,Editor_name=(target,value)=>Editor_defProp(target,"name",{value,configurable:!0}),Editor_decoratorStrings=["class","method","getter","setter","accessor","field","value","get","set"],Editor_expectFn=fn=>void 0!==fn&&"function"!=typeof fn?Editor_typeError("Function expected"):fn,Editor_decoratorContext=(kind,name,done,metadata,fns)=>({kind:Editor_decoratorStrings[kind],name,metadata,addInitializer:fn=>done._?Editor_typeError("Already initialized"):fns.push(Editor_expectFn(fn||null))}),Editor_decoratorMetadata=(array,target)=>Editor_defNormalProp(target,Editor_knownSymbol("metadata"),array[3]),Editor_decorateElement=(array,flags,name,decorators,target,extra)=>{var fn,it,done,ctx,access,k=7&flags,s=!!(8&flags),p=!!(16&flags),j=k>3?array.length+1:k?s?1:2:0,key=Editor_decoratorStrings[k+5],initializers=k>3&&(array[j-1]=[]),extraInitializers=array[j]||(array[j]=[]),desc=k&&(!p&&!s&&(target=target.prototype),k<5&&(k>3||!p)&&Editor_getOwnPropDesc(k<4?target:{get[name](){return Editor_privateGet(this,extra)},set[name](x){return Editor_privateSet(this,extra,x)}},name));k?p&&k<4&&Editor_name(extra,(k>2?"set ":k>1?"get ":"")+name):Editor_name(target,name);for(var i=decorators.length-1;i>=0;i--)ctx=Editor_decoratorContext(k,name,done={},array[3],extraInitializers),k&&(ctx.static=s,ctx.private=p,access=ctx.access={has:p?x=>Editor_privateIn(target,x):x=>name in x},3^k&&(access.get=p?x=>(1^k?Editor_privateGet:Editor_privateMethod)(x,target,4^k?extra:desc.get):x=>x[name]),k>2&&(access.set=p?(x,y)=>Editor_privateSet(x,target,y,4^k?extra:desc.set):(x,y)=>x[name]=y)),it=(0,decorators[i])(k?k<4?p?extra:desc[key]:k>4?void 0:{get:desc.get,set:desc.set}:target,ctx),done._=1,4^k||void 0===it?Editor_expectFn(it)&&(k>4?initializers.unshift(it):k?p?extra=it:desc[key]=it:target=it):"object"!=typeof it||null===it?Editor_typeError("Object expected"):(Editor_expectFn(fn=it.get)&&(desc.get=fn),Editor_expectFn(fn=it.set)&&(desc.set=fn),Editor_expectFn(fn=it.init)&&initializers.unshift(fn));return k||Editor_decoratorMetadata(array,target),desc&&Editor_defProp(target,name,desc),p?4^k?extra:desc:target},Editor_publicField=(obj,key,value)=>Editor_defNormalProp(obj,"symbol"!=typeof key?key+"":key,value),Editor_accessCheck=(obj,member,msg)=>member.has(obj)||Editor_typeError("Cannot "+msg),Editor_privateIn=(member,obj)=>Object(obj)!==obj?Editor_typeError('Cannot use the "in" operator on this value'):member.has(obj),Editor_privateGet=(obj,member,getter)=>(Editor_accessCheck(obj,member,"read from private field"),getter?getter.call(obj):member.get(obj)),Editor_privateSet=(obj,member,value,setter)=>(Editor_accessCheck(obj,member,"write to private field"),setter?setter.call(obj,value):member.set(obj,value),value),Editor_privateMethod=(obj,member,method)=>(Editor_accessCheck(obj,member,"access private method"),method);class Editor extends(_a=eventemitter3_default(),_getIsShapeHiddenCache_dec=[state_dist_esm.EW],_getCanUndo_dec=[state_dist_esm.EW],_getCanRedo_dec=[state_dist_esm.EW],_getPath_dec=[state_dist_esm.EW],_getCurrentTool_dec=[state_dist_esm.EW],_getCurrentToolId_dec=[state_dist_esm.EW],_getDocumentSettings_dec=[state_dist_esm.EW],_getInstanceState_dec=[state_dist_esm.EW],_getOpenMenus_dec=[state_dist_esm.EW],_getIsMenuOpen_dec=[state_dist_esm.EW],_getPageStates_dec=[state_dist_esm.EW],__getPageStatesQuery_dec=[state_dist_esm.EW],_getCurrentPageState_dec=[state_dist_esm.EW],__getCurrentPageStateId_dec=[state_dist_esm.EW],_getSelectedShapeIds_dec=[state_dist_esm.EW],_getSelectedShapes_dec=[state_dist_esm.EW],_getCurrentPageShapesInReadingOrder_dec=[state_dist_esm.EW],_getOnlySelectedShapeId_dec=[state_dist_esm.EW],_getOnlySelectedShape_dec=[state_dist_esm.EW],_getSelectionPageBounds_dec=[state_dist_esm.EW],_getSelectionRotation_dec=[state_dist_esm.EW],_getSelectionRotatedPageBounds_dec=[state_dist_esm.EW],_getSelectionRotatedScreenBounds_dec=[state_dist_esm.EW],_getFocusedGroupId_dec=[state_dist_esm.EW],_getFocusedGroup_dec=[state_dist_esm.EW],_getEditingShapeId_dec=[state_dist_esm.EW],_getEditingShape_dec=[state_dist_esm.EW],_getRichTextEditor_dec=[state_dist_esm.EW],_getHoveredShapeId_dec=[state_dist_esm.EW],_getHoveredShape_dec=[state_dist_esm.EW],_getHintingShapeIds_dec=[state_dist_esm.EW],_getHintingShape_dec=[state_dist_esm.EW],_getErasingShapeIds_dec=[state_dist_esm.EW],_getErasingShapes_dec=[state_dist_esm.EW],__unsafe_getCameraId_dec=[state_dist_esm.EW],_getCamera_dec=[state_dist_esm.EW],_getViewportPageBoundsForFollowing_dec=[state_dist_esm.EW],_getCameraForFollowing_dec=[state_dist_esm.EW],_getZoomLevel_dec=[state_dist_esm.EW],_getViewportScreenBounds_dec=[state_dist_esm.EW],_getViewportScreenCenter_dec=[state_dist_esm.EW],_getViewportPageBounds_dec=[state_dist_esm.EW],__getCollaboratorsQuery_dec=[state_dist_esm.EW],_getCollaborators_dec=[state_dist_esm.EW],_getCollaboratorsOnCurrentPage_dec=[state_dist_esm.EW],_getRenderingShapes_dec=[state_dist_esm.EW],__getAllPagesQuery_dec=[state_dist_esm.EW],_getPages_dec=[state_dist_esm.EW],_getCurrentPageId_dec=[state_dist_esm.EW],_getCurrentPageShapeIdsSorted_dec=[state_dist_esm.EW],__getAllAssetsQuery_dec=[state_dist_esm.EW],__getShapeHandlesCache_dec=[state_dist_esm.EW],__getShapePageTransformCache_dec=[state_dist_esm.EW],__getShapePageBoundsCache_dec=[state_dist_esm.EW],__getShapeClipPathCache_dec=[state_dist_esm.EW],__getShapeMaskCache_dec=[state_dist_esm.EW],__getShapeMaskedPageBoundsCache_dec=[state_dist_esm.EW],__notVisibleShapes_dec=[state_dist_esm.EW],_getCulledShapes_dec=[state_dist_esm.EW],_getCurrentPageBounds_dec=[state_dist_esm.EW],_getCurrentPageShapes_dec=[state_dist_esm.EW],_getCurrentPageShapesSorted_dec=[state_dist_esm.EW],_getCurrentPageRenderingShapesSorted_dec=[state_dist_esm.EW],__getBindingsIndexCache_dec=[state_dist_esm.EW],__getSelectionSharedStyles_dec=[state_dist_esm.EW],_getSharedStyles_dec=[(0,state_dist_esm.EW)({isEqual:(a,b)=>a.equals(b)})],_getSharedOpacity_dec=[state_dist_esm.EW],_getIsFocused_dec=[state_dist_esm.EW],_getIsReadonly_dec=[state_dist_esm.EW],__setShiftKeyTimeout_dec=[dist_esm.oI],__setAltKeyTimeout_dec=[dist_esm.oI],__setCtrlKeyTimeout_dec=[dist_esm.oI],__setMetaKeyTimeout_dec=[dist_esm.oI],_a){constructor({store,user,shapeUtils,bindingUtils,tools,getContainer,cameraOptions,textOptions,initialState,autoFocus,inferDarkMode,options,isShapeHidden,getShapeVisibility,fontAssetUrls}){super(),((array,flags,self,value)=>{for(var i=0,fns=array[flags>>1],n=fns&&fns.length;i<n;i++)1&flags?fns[i].call(self):value=fns[i].call(self,value)})(Editor_init,5,this),Editor_publicField(this,"id",(0,dist_esm.NF)()),Editor_publicField(this,"_getShapeVisibility"),Editor_publicField(this,"options"),Editor_publicField(this,"contextId",(0,dist_esm.NF)()),Editor_publicField(this,"store"),Editor_publicField(this,"root"),Editor_publicField(this,"disposables",new Set),Editor_publicField(this,"isDisposed",!1),Editor_publicField(this,"_tickManager"),Editor_publicField(this,"snaps"),Editor_publicField(this,"timers",tltime.forContext(this.contextId)),Editor_publicField(this,"user"),Editor_publicField(this,"textMeasure"),Editor_publicField(this,"fonts"),Editor_publicField(this,"environment",tlenv),Editor_publicField(this,"scribbles"),Editor_publicField(this,"sideEffects"),Editor_publicField(this,"edgeScrollManager"),Editor_publicField(this,"focusManager"),Editor_publicField(this,"getContainer"),Editor_publicField(this,"shapeUtils"),Editor_publicField(this,"styleProps"),Editor_publicField(this,"bindingUtils"),Editor_publicField(this,"history"),Editor_publicField(this,"_shouldIgnoreShapeLock",!1),Editor_publicField(this,"_crashingError",null),Editor_publicField(this,"_isChangingStyleTimeout",-1),Editor_publicField(this,"menus",tlmenus.forContext(this.contextId)),Editor_publicField(this,"_currentRichTextEditor",(0,state_dist_esm.eU)("rich text editor",null)),Editor_publicField(this,"_textOptions"),Editor_publicField(this,"_cameraOptions",(0,state_dist_esm.eU)("camera options",DEFAULT_CAMERA_OPTIONS)),Editor_publicField(this,"_viewportAnimation",null),Editor_publicField(this,"_willSetInitialBounds",!0),Editor_publicField(this,"_isLockedOnFollowingUser",(0,state_dist_esm.eU)("isLockedOnFollowingUser",!1)),Editor_publicField(this,"_cameraState",(0,state_dist_esm.eU)("camera state","idle")),Editor_publicField(this,"_cameraStateTimeoutRemaining",0),Editor_publicField(this,"_currentPageShapeIds"),Editor_publicField(this,"_shapeGeometryCaches",{}),Editor_publicField(this,"_shapePageGeometryCaches",{}),Editor_publicField(this,"_parentIdsToChildIds"),Editor_publicField(this,"animatingShapes",new Map),Editor_publicField(this,"externalAssetContentHandlers",{file:null,url:null}),Editor_publicField(this,"temporaryAssetPreview",new Map),Editor_publicField(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null,tldraw:null,excalidraw:null}),Editor_publicField(this,"inputs",{originPagePoint:new Vec,originScreenPoint:new Vec,previousPagePoint:new Vec,previousScreenPoint:new Vec,currentPagePoint:new Vec,currentScreenPoint:new Vec,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,isSpacebarPanning:!1,pointerVelocity:new Vec}),Editor_publicField(this,"_clickManager",new ClickManager(this)),Editor_publicField(this,"_prevCursor","default"),Editor_publicField(this,"_shiftKeyTimeout",-1),Editor_publicField(this,"_altKeyTimeout",-1),Editor_publicField(this,"_ctrlKeyTimeout",-1),Editor_publicField(this,"_metaKeyTimeout",-1),Editor_publicField(this,"_restoreToolId","select"),Editor_publicField(this,"_pinchStart",1),Editor_publicField(this,"_didPinch",!1),Editor_publicField(this,"_selectedShapeIdsAtPointerDown",[]),Editor_publicField(this,"_longPressTimeout",-1),Editor_publicField(this,"capturedPointerId",null),Editor_publicField(this,"performanceTracker"),Editor_publicField(this,"performanceTrackerTimeout",-1),Editor_publicField(this,"_pendingEventsForNextTick",[]),(0,dist_esm.vA)(!(isShapeHidden&&getShapeVisibility),"Cannot use both isShapeHidden and getShapeVisibility"),this._getShapeVisibility=isShapeHidden?(shape,editor)=>isShapeHidden(shape,editor)?"hidden":"inherit":getShapeVisibility,this.options={...defaultTldrawOptions,...options},this.store=store,this.history=new HistoryManager({store,annotateError:error=>{this.annotateError(error,{origin:"history.batch",willCrashApp:!0}),this.crash(error)}}),this.snaps=new SnapManager(this),this.disposables.add(this.timers.dispose),this._cameraOptions.set({...DEFAULT_CAMERA_OPTIONS,...cameraOptions}),this._textOptions=(0,state_dist_esm.eU)("text options",textOptions??null),this.user=new UserPreferencesManager(user??createTLUser(),inferDarkMode??!1),this.disposables.add((()=>this.user.dispose())),this.getContainer=getContainer,this.textMeasure=new TextManager(this),this.fonts=new FontManager(this,fontAssetUrls),this._tickManager=new TickManager(this);this.root=new class NewRoot extends RootState{static initial=initialState??""}(this),this.root.children={};const allShapeUtils=checkShapesAndAddCore(shapeUtils),_shapeUtils={},_styleProps={},allStylesById=new Map;for(const Util of allShapeUtils){const util=new Util(this);_shapeUtils[Util.type]=util;const propKeysByStyle=getShapePropKeysByStyle(Util.props??{});_styleProps[Util.type]=propKeysByStyle;for(const style of propKeysByStyle.keys())if(allStylesById.has(style.id)){if(allStylesById.get(style.id)!==style)throw Error(`Multiple style props with id "${style.id}" in use. Style prop IDs must be unique.`)}else allStylesById.set(style.id,style)}this.shapeUtils=_shapeUtils,this.styleProps=_styleProps;const allBindingUtils=checkBindings(bindingUtils),_bindingUtils={};for(const Util of allBindingUtils){const util=new Util(this);_bindingUtils[Util.type]=util}this.bindingUtils=_bindingUtils;for(const Tool of[...tools]){if((0,dist_esm.mQ)(this.root.children,Tool.id))throw Error(`Can't override tool with id "${Tool.id}"`);this.root.children[Tool.id]=new Tool(this,this.root)}this.scribbles=new ScribbleManager(this);const cleanupInstancePageState=(prevPageState,shapesNoLongerInPage)=>{let nextPageState=null;const selectedShapeIds=prevPageState.selectedShapeIds.filter((id=>!shapesNoLongerInPage.has(id)));selectedShapeIds.length!==prevPageState.selectedShapeIds.length&&(nextPageState||(nextPageState={...prevPageState}),nextPageState.selectedShapeIds=selectedShapeIds);const erasingShapeIds=prevPageState.erasingShapeIds.filter((id=>!shapesNoLongerInPage.has(id)));erasingShapeIds.length!==prevPageState.erasingShapeIds.length&&(nextPageState||(nextPageState={...prevPageState}),nextPageState.erasingShapeIds=erasingShapeIds),prevPageState.hoveredShapeId&&shapesNoLongerInPage.has(prevPageState.hoveredShapeId)&&(nextPageState||(nextPageState={...prevPageState}),nextPageState.hoveredShapeId=null),prevPageState.editingShapeId&&shapesNoLongerInPage.has(prevPageState.editingShapeId)&&(nextPageState||(nextPageState={...prevPageState}),nextPageState.editingShapeId=null);const hintingShapeIds=prevPageState.hintingShapeIds.filter((id=>!shapesNoLongerInPage.has(id)));return hintingShapeIds.length!==prevPageState.hintingShapeIds.length&&(nextPageState||(nextPageState={...prevPageState}),nextPageState.hintingShapeIds=hintingShapeIds),prevPageState.focusedGroupId&&shapesNoLongerInPage.has(prevPageState.focusedGroupId)&&(nextPageState||(nextPageState={...prevPageState}),nextPageState.focusedGroupId=null),nextPageState};this.sideEffects=this.store.sideEffects;let deletedBindings=new Map;const deletedShapeIds=new Set,invalidParents=new Set;let invalidBindingTypes=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler((()=>{deletedShapeIds.clear();for(const parentId of invalidParents){invalidParents.delete(parentId);const parent=this.getShape(parentId);if(!parent)continue;const util=this.getShapeUtil(parent),changes=util.onChildrenChange?.(parent);changes?.length&&this.updateShapes(changes)}if(invalidBindingTypes.size){const t=invalidBindingTypes;invalidBindingTypes=new Set;for(const type of t){const util=this.getBindingUtil(type);util.onOperationComplete?.()}}if(deletedBindings.size){const t=deletedBindings;deletedBindings=new Map;for(const opts of t.values())this.getBindingUtil(opts.binding).onAfterDelete?.(opts)}this.emit("update")}))),this.disposables.add(this.sideEffects.register({shape:{afterChange:(shapeBefore,shapeAfter)=>{for(const binding of this.getBindingsInvolvingShape(shapeAfter))invalidBindingTypes.add(binding.type),binding.fromId===shapeAfter.id&&this.getBindingUtil(binding).onAfterChangeFromShape?.({binding,shapeBefore,shapeAfter}),binding.toId===shapeAfter.id&&this.getBindingUtil(binding).onAfterChangeToShape?.({binding,shapeBefore,shapeAfter});if(shapeBefore.parentId!==shapeAfter.parentId){const notifyBindingAncestryChange=id=>{const descendantShape=this.getShape(id);if(descendantShape)for(const binding of this.getBindingsInvolvingShape(descendantShape))invalidBindingTypes.add(binding.type),binding.fromId===descendantShape.id&&this.getBindingUtil(binding).onAfterChangeFromShape?.({binding,shapeBefore:descendantShape,shapeAfter:descendantShape}),binding.toId===descendantShape.id&&this.getBindingUtil(binding).onAfterChangeToShape?.({binding,shapeBefore:descendantShape,shapeAfter:descendantShape})};notifyBindingAncestryChange(shapeAfter.id),this.visitDescendants(shapeAfter.id,notifyBindingAncestryChange)}if(shapeBefore.parentId!==shapeAfter.parentId&&isPageId(shapeAfter.parentId)){const allMovingIds=new Set([shapeBefore.id]);this.visitDescendants(shapeBefore.id,(id=>{allMovingIds.add(id)}));for(const instancePageState of this.getPageStates()){if(instancePageState.pageId===shapeAfter.parentId)continue;const nextPageState=cleanupInstancePageState(instancePageState,allMovingIds);nextPageState&&this.store.put([nextPageState])}}shapeBefore.parentId&&isShapeId(shapeBefore.parentId)&&invalidParents.add(shapeBefore.parentId),shapeAfter.parentId!==shapeBefore.parentId&&isShapeId(shapeAfter.parentId)&&invalidParents.add(shapeAfter.parentId)},beforeDelete:shape=>{if(deletedShapeIds.has(shape.id))return;shape.parentId&&isShapeId(shape.parentId)&&invalidParents.add(shape.parentId),deletedShapeIds.add(shape.id);const deleteBindingIds=[];for(const binding of this.getBindingsInvolvingShape(shape)){invalidBindingTypes.add(binding.type),deleteBindingIds.push(binding.id);const util=this.getBindingUtil(binding);binding.fromId===shape.id?(util.onBeforeIsolateToShape?.({binding,removedShape:shape}),util.onBeforeDeleteFromShape?.({binding,shape})):(util.onBeforeIsolateFromShape?.({binding,removedShape:shape}),util.onBeforeDeleteToShape?.({binding,shape}))}deleteBindingIds.length&&this.deleteBindings(deleteBindingIds);const deletedIds=new Set([shape.id]),updates=(0,dist_esm.oE)(this.getPageStates().map((pageState=>cleanupInstancePageState(pageState,deletedIds))));updates.length&&this.store.put(updates)}},binding:{beforeCreate:binding=>{const next=this.getBindingUtil(binding).onBeforeCreate?.({binding});return next||binding},afterCreate:binding=>{invalidBindingTypes.add(binding.type),this.getBindingUtil(binding).onAfterCreate?.({binding})},beforeChange:(bindingBefore,bindingAfter)=>{const updated=this.getBindingUtil(bindingAfter).onBeforeChange?.({bindingBefore,bindingAfter});return updated||bindingAfter},afterChange:(bindingBefore,bindingAfter)=>{invalidBindingTypes.add(bindingAfter.type),this.getBindingUtil(bindingAfter).onAfterChange?.({bindingBefore,bindingAfter})},beforeDelete:binding=>{this.getBindingUtil(binding).onBeforeDelete?.({binding})},afterDelete:binding=>{this.getBindingUtil(binding).onAfterDelete?.({binding}),invalidBindingTypes.add(binding.type)}},page:{afterCreate:record=>{const cameraId=TLCamera_CameraRecordType.createId(record.id),_pageStateId=TLPageState_InstancePageStateRecordType.createId(record.id);this.store.has(cameraId)||this.store.put([TLCamera_CameraRecordType.create({id:cameraId})]),this.store.has(_pageStateId)||this.store.put([TLPageState_InstancePageStateRecordType.create({id:_pageStateId,pageId:record.id})])},afterDelete:(record,source)=>{if(this.getInstanceState()?.currentPageId===record.id){const backupPageId=this.getPages().find((p=>p.id!==record.id))?.id;backupPageId?this.store.put([{...this.getInstanceState(),currentPageId:backupPageId}]):"user"===source&&this.store.ensureStoreIsUsable()}const cameraId=TLCamera_CameraRecordType.createId(record.id),instance_PageStateId=TLPageState_InstancePageStateRecordType.createId(record.id);this.store.remove([cameraId,instance_PageStateId])}},instance:{afterChange:(prev,next,source)=>{if(!this.store.has(next.currentPageId)){const backupPageId=this.store.has(prev.currentPageId)?prev.currentPageId:this.getPages()[0]?.id;backupPageId?this.store.update(next.id,(instance=>({...instance,currentPageId:backupPageId}))):"user"===source&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(prev,next)=>{if(prev?.selectedShapeIds!==next?.selectedShapeIds){const filtered=next.selectedShapeIds.filter((id=>{let parentId=this.getShape(id)?.parentId;for(;isShapeId(parentId);){if(next.selectedShapeIds.includes(parentId))return!1;parentId=this.getShape(parentId)?.parentId}return!0}));let nextFocusedGroupId=null;if(filtered.length>0){const commonGroupAncestor=this.findCommonAncestor((0,dist_esm.oE)(filtered.map((id=>this.getShape(id)))),(shape=>this.isShapeOfType(shape,"group")));commonGroupAncestor&&(nextFocusedGroupId=commonGroupAncestor)}else next?.focusedGroupId&&(nextFocusedGroupId=next.focusedGroupId);filtered.length===next.selectedShapeIds.length&&nextFocusedGroupId===next.focusedGroupId||this.store.put([{...next,selectedShapeIds:filtered,focusedGroupId:nextFocusedGroupId??null}])}}}})),this._currentPageShapeIds=((store,getCurrentPageId)=>{const shapesIndex=store.query.ids("shape");let lastPageId=null;function fromScratch(){const currentPageId=getCurrentPageId();return lastPageId=currentPageId,new Set([...shapesIndex.get()].filter((id=>isShapeInPage(store,currentPageId,store.get(id)))))}return(0,state_dist_esm.EW)("_shapeIdsInCurrentPage",((prevValue,lastComputedEpoch)=>{if((0,state_dist_esm._O)(prevValue))return fromScratch();const currentPageId=getCurrentPageId();if(currentPageId!==lastPageId)return fromScratch();const diff=store.history.getDiffSince(lastComputedEpoch);if(diff===state_dist_esm.c2)return fromScratch();const builder=new store_dist_esm.zq(prevValue);for(const changes of diff){for(const record of Object.values(changes.added))isShape(record)&&isShapeInPage(store,currentPageId,record)&&builder.add(record.id);for(const[_from,to]of Object.values(changes.updated))isShape(to)&&(isShapeInPage(store,currentPageId,to)?builder.add(to.id):builder.remove(to.id));for(const id of Object.keys(changes.removed))isShapeId(id)&&builder.remove(id)}const result=builder.get();return result?(0,state_dist_esm._D)(result.value,result.diff):prevValue}))})(this.store,(()=>this.getCurrentPageId())),this._parentIdsToChildIds=(store=>{const shapeIdsQuery=store.query.ids("shape"),shapeHistory=store.query.filterHistory("shape");function fromScratch(){const result={},shapeIds=shapeIdsQuery.get(),shapes=Array(shapeIds.size);return shapeIds.forEach((id=>shapes.push(store.get(id)))),shapes.sort(dist_esm.Ky),shapes.forEach((shape=>{result[shape.parentId]||(result[shape.parentId]=[]),result[shape.parentId].push(shape.id)})),result}return(0,state_dist_esm.EW)("parentsToChildrenWithIndexes",((lastValue,lastComputedEpoch)=>{if((0,state_dist_esm._O)(lastValue))return fromScratch();const diff=shapeHistory.getDiffSince(lastComputedEpoch);if(diff===state_dist_esm.c2)return fromScratch();if(0===diff.length)return lastValue;let newValue=null;const ensureNewArray=parentId=>{newValue||(newValue={...lastValue}),newValue[parentId]?newValue[parentId]===lastValue[parentId]&&(newValue[parentId]=[...newValue[parentId]]):newValue[parentId]=[]},toSort=new Set;let changes;for(let i=0,n=diff.length;i<n;i++){changes=diff[i];for(const record of Object.values(changes.added))isShape(record)&&(ensureNewArray(record.parentId),newValue[record.parentId].push(record.id),toSort.add(newValue[record.parentId]));for(const[from,to]of Object.values(changes.updated))if(isShape(to)&&isShape(from))if(from.parentId!==to.parentId)ensureNewArray(from.parentId),ensureNewArray(to.parentId),newValue[from.parentId].splice(newValue[from.parentId].indexOf(to.id),1),newValue[to.parentId].push(to.id),toSort.add(newValue[to.parentId]);else if(from.index!==to.index){ensureNewArray(to.parentId);const idx=newValue[to.parentId].indexOf(to.id);newValue[to.parentId][idx]=to.id,toSort.add(newValue[to.parentId])}for(const record of Object.values(changes.removed))isShape(record)&&(ensureNewArray(record.parentId),newValue[record.parentId].splice(newValue[record.parentId].indexOf(record.id),1))}for(const arr of toSort){const shapesInArr=(0,dist_esm.oE)(arr.map((id=>store.get(id))));shapesInArr.sort(dist_esm.Ky),arr.splice(0,arr.length,...shapesInArr.map((shape=>shape.id)))}return newValue??lastValue}))})(this.store),this.disposables.add(this.store.listen((changes=>{this.emit("change",changes)}))),this.disposables.add(this.history.dispose),this.run((()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})}),{history:"ignore"}),initialState&&void 0===this.root.children[initialState])throw Error(`No state found for initialState "${initialState}".`);if(this.root.enter(void 0,"initial"),this.edgeScrollManager=new EdgeScrollManager(this),this.focusManager=new FocusManager(this,autoFocus),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame((()=>{this._tickManager.start()})),this.performanceTracker=new dist_esm.f6,this.store.props.collaboration?.mode){const mode=this.store.props.collaboration.mode;this.disposables.add((0,state_dist_esm.wv)("update collaboration mode",(()=>{this.store.put([{...this.getInstanceState(),isReadonly:"readonly"===mode.get()}])})))}}getIsShapeHiddenCache(){return this._getShapeVisibility?this.store.createComputedCache("isShapeHidden",(shape=>{const visibility=this._getShapeVisibility(shape,this);return!PageRecordType.isId(shape.parentId)&&this.isShapeHidden(shape.parentId)?"visible"!==visibility:"hidden"===visibility})):null}isShapeHidden(shapeOrId){return!!this._getShapeVisibility&&!!this.getIsShapeHiddenCache().get("string"==typeof shapeOrId?shapeOrId:shapeOrId.id)}dispose(){this.disposables.forEach((dispose=>dispose())),this.disposables.clear(),this.store.dispose(),this.isDisposed=!0}getShapeUtil(arg){const type="string"==typeof arg?arg:arg.type,shapeUtil=(0,dist_esm.g5)(this.shapeUtils,type);return(0,dist_esm.vA)(shapeUtil,`No shape util found for type "${type}"`),shapeUtil}hasShapeUtil(arg){const type="string"==typeof arg?arg:arg.type;return(0,dist_esm.mQ)(this.shapeUtils,type)}getBindingUtil(arg){const type="string"==typeof arg?arg:arg.type,bindingUtil=(0,dist_esm.g5)(this.bindingUtils,type);return(0,dist_esm.vA)(bindingUtil,`No binding util found for type "${type}"`),bindingUtil}undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}clearHistory(){return this.history.clear(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(markId){return"string"==typeof markId?console.warn(`[tldraw] \`editor.history.mark("${markId}")\` is deprecated. Please use \`const myMarkId = editor.markHistoryStoppingPoint()\` instead.`):console.warn("[tldraw] `editor.mark()` is deprecated. Use `editor.markHistoryStoppingPoint()` instead."),this.history._mark(markId??(0,dist_esm.NF)()),this}markHistoryStoppingPoint(name){const id=`[${name??"stop"}]_${(0,dist_esm.NF)()}`;return this.history._mark(id),id}getMarkIdMatching(idSubstring){return this.history.getMarkIdMatching(idSubstring)}squashToMark(markId){return this.history.squashToMark(markId),this}bail(){return this.history.bail(),this}bailToMark(id){return this.history.bailToMark(id),this}run(fn,opts){const previousIgnoreShapeLock=this._shouldIgnoreShapeLock;this._shouldIgnoreShapeLock=opts?.ignoreShapeLock??previousIgnoreShapeLock;try{this.history.batch(fn,opts)}finally{this._shouldIgnoreShapeLock=previousIgnoreShapeLock}return this}batch(fn,opts){return this.run(fn,opts)}annotateError(error,{origin,willCrashApp,tags,extras}){const defaultAnnotations=this.createErrorAnnotations(origin,willCrashApp);return(0,dist_esm.TF)(error,{tags:{...defaultAnnotations.tags,...tags},extras:{...defaultAnnotations.extras,...extras}}),willCrashApp&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(origin,willCrashApp){try{const editingShapeId=this.getEditingShapeId();return{tags:{origin,willCrashApp},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes().map((s=>{const{props,...rest}=s,{text:_text,richText:_richText,...restProps}=props;return{...rest,props:restProps}})),selectionCount:this.getSelectedShapes().length,editingShape:editingShapeId?this.getShape(editingShapeId):void 0,inputs:this.inputs,pageState:this.getCurrentPageState(),instanceState:this.getInstanceState(),collaboratorCount:this.getCollaboratorsOnCurrentPage().length}}}catch{return{tags:{origin,willCrashApp},extras:{}}}}getCrashingError(){return this._crashingError}crash(error){return this._crashingError=error,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(path){const ids=path.split(".").reverse();let state=this.root;for(;ids.length>0;){const id=ids.pop();if(!id)return!0;const current=state.getCurrent();if(current?.id!==id)return!1;if(0===ids.length)return!0;state=current}return!1}isInAny(...paths){return paths.some((path=>this.isIn(path)))}setCurrentTool(id,info={}){return this.root.transition(id,info),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const currentTool=this.getCurrentTool();return currentTool?currentTool.getCurrentToolIdMask()??currentTool.id:""}getStateDescendant(path){const ids=path.split(".").reverse();let state=this.root;for(;ids.length>0;){const id=ids.pop();if(!id)return state;const childState=state.children?.[id];if(!childState)return;state=childState}return state}getDocumentSettings(){return this.store.get(TLDOCUMENT_ID)}updateDocumentSettings(settings){return this.run((()=>{this.store.put([{...this.getDocumentSettings(),...settings}])}),{history:"ignore"}),this}getInstanceState(){return this.store.get(TLInstance_TLINSTANCE_ID)}updateInstanceState(partial,historyOptions){return this._updateInstanceState(partial,{history:"ignore",...historyOptions}),void 0!==partial.isChangingStyle&&(clearTimeout(this._isChangingStyleTimeout),!0===partial.isChangingStyle&&(this._isChangingStyleTimeout=this.timers.setTimeout((()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})}),1e3))),this}_updateInstanceState(partial,opts){this.run((()=>{this.store.put([{...this.getInstanceState(),...partial}])}),opts)}getOpenMenus(){return this.menus.getOpenMenus()}addOpenMenu(id){return this.menus.addOpenMenu(id),this}deleteOpenMenu(id){return this.menus.deleteOpenMenu(id),this}clearOpenMenus(){return this.menus.clearOpenMenus(),this}getIsMenuOpen(){return this.menus.hasAnyOpenMenus()}setCursor(cursor){return this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...cursor}}),this}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return TLPageState_InstancePageStateRecordType.createId(this.getCurrentPageId())}updateCurrentPageState(partial){return this._updateCurrentPageState(partial),this}_updateCurrentPageState(partial){this.store.update(partial.id??this.getCurrentPageState().id,(state=>({...state,...partial})))}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){return(0,dist_esm.oE)(this.getSelectedShapeIds().map((id=>this.store.get(id))))}setSelectedShapes(shapes){return this.run((()=>{const ids=shapes.map((shape=>"string"==typeof shape?shape:shape.id)),{selectedShapeIds:prevSelectedShapeIds}=this.getCurrentPageState(),prevSet=new Set(prevSelectedShapeIds);if(ids.length===prevSet.size&&ids.every((id=>prevSet.has(id))))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:ids}])}),{history:"record-preserveRedoStack"})}isAncestorSelected(shape){const id="string"==typeof shape?shape:shape?.id??null,_shape=this.getShape(id);if(!_shape)return!1;const selectedShapeIds=this.getSelectedShapeIds();return!!this.findShapeAncestor(_shape,(parent=>selectedShapeIds.includes(parent.id)))}select(...shapes){const ids="string"==typeof shapes[0]?shapes:shapes.map((shape=>shape.id));return this.setSelectedShapes(ids),this}deselect(...shapes){const ids="string"==typeof shapes[0]?shapes:shapes.map((shape=>shape.id)),selectedShapeIds=this.getSelectedShapeIds();return selectedShapeIds.length>0&&ids.length>0&&this.setSelectedShapes(selectedShapeIds.filter((id=>!ids.includes(id)))),this}selectAll(){const ids=this.getSortedChildIdsForParent(this.getCurrentPageId());return ids.length<=0||this.setSelectedShapes(this._getUnlockedShapeIds(ids)),this}selectAdjacentShape(direction){const selectedShapeIds=this.getSelectedShapeIds(),firstParentId=selectedShapeIds[0]?this.getShape(selectedShapeIds[0])?.parentId:null,readingOrderShapes=firstParentId&&selectedShapeIds.every((shapeId=>this.getShape(shapeId)?.parentId===firstParentId))&&!isPageId(firstParentId)?this._getShapesInReadingOrder(this.getCurrentPageShapes().filter((shape2=>shape2.parentId===firstParentId))):this.getCurrentPageShapesInReadingOrder(),currentShapeId=1===selectedShapeIds.length?selectedShapeIds[0]:readingOrderShapes.find((shape2=>selectedShapeIds.includes(shape2.id)))?.id;let adjacentShapeId;if("next"===direction||"prev"===direction){const shapeIds=readingOrderShapes.map((shape2=>shape2.id)),currentIndex=currentShapeId?shapeIds.indexOf(currentShapeId):-1;adjacentShapeId=shapeIds[(currentIndex+("next"===direction?1:-1)+shapeIds.length)%shapeIds.length]}else{if(!currentShapeId)return;adjacentShapeId=this.getNearestAdjacentShape(currentShapeId,direction)}const shape=this.getShape(adjacentShapeId);shape&&this._selectShapesAndZoom([shape.id])}getCurrentPageShapesInReadingOrder(){const shapes=this.getCurrentPageShapes().filter((shape=>isPageId(shape.parentId)));return this._getShapesInReadingOrder(shapes)}_getShapesInReadingOrder(shapes){const tabbableShapes=shapes.filter((shape=>this.getShapeUtil(shape).canTabTo(shape)));if(tabbableShapes.length<=1)return tabbableShapes;const shapesWithCenters=tabbableShapes.map((shape=>({shape,center:this.getShapePageBounds(shape).center})));shapesWithCenters.sort(((a,b)=>a.center.y-b.center.y));const rows=[];for(const shapeWithCenter of shapesWithCenters){let rowIndex=-1;for(let i=rows.length-1;i>=0;i--){const row=rows[i],lastShapeInRow=row[row.length-1];if(Math.abs(shapeWithCenter.center.y-lastShapeInRow.center.y)<100){rowIndex=i;break}}-1===rowIndex?rows.push([shapeWithCenter]):rows[rowIndex].push(shapeWithCenter)}for(const row of rows)row.sort(((a,b)=>a.center.x-b.center.x));for(const row of rows)if(!(row.length<=2))for(let i=0;i<row.length-2;i++){const currentShape=row[i],nextShape=row[i+1],nextNextShape=row[i+2],dist1=Vec.Dist2(currentShape.center,nextShape.center);if(Vec.Dist2(currentShape.center,nextNextShape.center)<.9*dist1){Math.abs(Vec.Angle(currentShape.center,nextNextShape.center)*(180/Math.PI))<=20&&([row[i+1],row[i+2]]=[row[i+2],row[i+1]])}}return rows.flat().map((item=>item.shape))}getNearestAdjacentShape(currentShapeId,direction){const directionToAngle={right:0,left:180,down:90,up:270},currentShape=this.getShape(currentShapeId);if(!currentShape)return currentShapeId;const tabbableShapes=this.getCurrentPageShapes().filter((shape=>this.getShapeUtil(shape).canTabTo(shape)&&shape.id!==currentShapeId));if(!tabbableShapes.length)return currentShapeId;const currentCenter=this.getShapePageBounds(currentShape).center,shapesInDirection=tabbableShapes.map((shape=>({shape,center:this.getShapePageBounds(shape).center}))).filter((({center})=>{const isRight=center.x>currentCenter.x,isDown=center.y>currentCenter.y,xDist=center.x-currentCenter.x,yDist=center.y-currentCenter.y,isInXDirection=Math.abs(yDist)<2*Math.abs(xDist),isInYDirection=Math.abs(xDist)<2*Math.abs(yDist);return"left"===direction||"right"===direction?isInXDirection&&("right"===direction?isRight:!isRight):"up"===direction||"down"===direction?isInYDirection&&("down"===direction?isDown:!isDown):void 0}));if(0===shapesInDirection.length)return currentShapeId;return(0,dist_esm.wq)(shapesInDirection,(({center})=>{const distance=Vec.Dist2(currentCenter,center),dirProp=["left","right"].includes(direction)?"x":"y",directionalDistance=Math.abs(center[dirProp]-currentCenter[dirProp]),offProp=["left","right"].includes(direction)?"y":"x",offAxisDeviation=Math.abs(center[offProp]-currentCenter[offProp]),angle=Math.abs(Vec.Angle(currentCenter,center)*(180/Math.PI));return 1*distance+2*offAxisDeviation+1.5*(distance-directionalDistance)+.5*Math.abs(angle-directionToAngle[direction])})).shape.id}selectParentShape(){const selectedShape=this.getOnlySelectedShape();if(!selectedShape)return;const parentShape=this.getShape(selectedShape.parentId);parentShape&&this._selectShapesAndZoom([parentShape.id])}selectFirstChildShape(){const selectedShapes=this.getSelectedShapes();if(!selectedShapes.length)return;const selectedShape=selectedShapes[0],children=this.getSortedChildIdsForParent(selectedShape.id).map((id=>this.getShape(id))).filter((i=>i)),sortedChildren=this._getShapesInReadingOrder(children);0!==sortedChildren.length&&this._selectShapesAndZoom([sortedChildren[0].id])}_selectShapesAndZoom(ids){this.setSelectedShapes(ids),this.zoomToSelectionIfOffscreen(256,{animation:{duration:this.options.animationMediumMs},inset:0})}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){return this.getOnlySelectedShape()?.id??null}getOnlySelectedShape(){const selectedShapes=this.getSelectedShapes();return 1===selectedShapes.length?selectedShapes[0]:null}getShapesPageBounds(shapeIds){const bounds=(0,dist_esm.oE)(shapeIds.map((id=>this.getShapePageBounds(id))));return 0===bounds.length?null:Box.Common(bounds)}getSelectionPageBounds(){return this.getShapesPageBounds(this.getSelectedShapeIds())}getShapesSharedRotation(shapeIds){let foundFirst=!1,rotation=0;for(let i=0,n=shapeIds.length;i<n;i++){const pageTransform=this.getShapePageTransform(shapeIds[i]);if(pageTransform)if(foundFirst){if(pageTransform.rotation()!==rotation)return 0}else foundFirst=!0,rotation=pageTransform.rotation()}return rotation}getSelectionRotation(){return this.getShapesSharedRotation(this.getSelectedShapeIds())}getShapesRotatedPageBounds(shapeIds){if(0===shapeIds.length)return;const selectionRotation=this.getShapesSharedRotation(shapeIds);if(0===selectionRotation)return this.getShapesPageBounds(shapeIds)??void 0;if(1===shapeIds.length){const bounds=this.getShapeGeometry(shapeIds[0]).bounds.clone(),pageTransform=this.getShapePageTransform(shapeIds[0]);return bounds.point=pageTransform.applyToPoint(bounds.point),bounds}const boxFromRotatedVertices=Box.FromPoints(shapeIds.flatMap((id=>{const pageTransform=this.getShapePageTransform(id);return pageTransform?pageTransform.applyToPoints(this.getShapeGeometry(id).bounds.corners):[]})).map((p=>p.rot(-selectionRotation))));return boxFromRotatedVertices.point=boxFromRotatedVertices.point.rot(selectionRotation),boxFromRotatedVertices}getSelectionRotatedPageBounds(){return this.getShapesRotatedPageBounds(this.getSelectedShapeIds())}getSelectionRotatedScreenBounds(){const bounds=this.getSelectionRotatedPageBounds();if(!bounds)return;const{x,y}=this.pageToScreen(bounds.point),zoom=this.getZoomLevel();return new Box(x,y,bounds.width*zoom,bounds.height*zoom)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const focusedGroupId=this.getFocusedGroupId();return focusedGroupId?this.getShape(focusedGroupId):void 0}setFocusedGroup(shape){const id="string"==typeof shape?shape:shape?.id??null;if(null!==id){const shape2=this.getShape(id);if(!shape2)throw Error(`Editor.setFocusedGroup: Shape with id ${id} does not exist`);if(!this.isShapeOfType(shape2,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${shape2.type}`)}return id===this.getFocusedGroupId()?this:this.run((()=>{this.store.update(this.getCurrentPageState().id,(s=>({...s,focusedGroupId:id})))}),{history:"record-preserveRedoStack"})}popFocusedGroupId(){const focusedGroup=this.getFocusedGroup();if(focusedGroup){const match=this.findShapeAncestor(focusedGroup,(shape=>this.isShapeOfType(shape,"group")));this.setFocusedGroup(match?.id??null),this.select(focusedGroup.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const editingShapeId=this.getEditingShapeId();return editingShapeId?this.getShape(editingShapeId):void 0}setEditingShape(shape){const id="string"==typeof shape?shape:shape?.id??null;this.setRichTextEditor(null);const prevEditingShapeId=this.getEditingShapeId();if(id!==prevEditingShapeId){if(id){const shape2=this.getShape(id);if(shape2&&this.getShapeUtil(shape2).canEdit(shape2))return this.run((()=>{if(this._updateCurrentPageState({editingShapeId:id}),prevEditingShapeId){const prevEditingShape=this.getShape(prevEditingShapeId);prevEditingShape&&this.getShapeUtil(prevEditingShape).onEditEnd?.(prevEditingShape)}this.getShapeUtil(shape2).onEditStart?.(shape2)}),{history:"ignore"}),this}this.run((()=>{if(this._updateCurrentPageState({editingShapeId:null}),this._currentRichTextEditor.set(null),prevEditingShapeId){const prevEditingShape=this.getShape(prevEditingShapeId);prevEditingShape&&this.getShapeUtil(prevEditingShape).onEditEnd?.(prevEditingShape)}}),{history:"ignore"})}return this}getRichTextEditor(){return this._currentRichTextEditor.get()}setRichTextEditor(textEditor){return this._currentRichTextEditor.set(textEditor),this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const hoveredShapeId=this.getHoveredShapeId();return hoveredShapeId?this.getShape(hoveredShapeId):void 0}setHoveredShape(shape){const id="string"==typeof shape?shape:shape?.id??null;return id===this.getHoveredShapeId()||this.run((()=>{this.updateCurrentPageState({hoveredShapeId:id})}),{history:"ignore"}),this}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const hintingShapeIds=this.getHintingShapeIds();return(0,dist_esm.oE)(hintingShapeIds.map((id=>this.getShape(id))))}setHintingShapes(shapes){const ids="string"==typeof shapes[0]?shapes:shapes.map((shape=>shape.id));return this.run((()=>{this._updateCurrentPageState({hintingShapeIds:(0,dist_esm.Qq)(ids)})}),{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const erasingShapeIds=this.getErasingShapeIds();return(0,dist_esm.oE)(erasingShapeIds.map((id=>this.getShape(id))))}setErasingShapes(shapes){const ids="string"==typeof shapes[0]?shapes:shapes.map((shape=>shape.id));ids.sort();const erasingShapeIds=this.getErasingShapeIds();return this.run((()=>{if(ids.length===erasingShapeIds.length){for(let i=0;i<ids.length;i++)if(ids[i]!==erasingShapeIds[i]){this._updateCurrentPageState({erasingShapeIds:ids});break}}else this._updateCurrentPageState({erasingShapeIds:ids})}),{history:"ignore"}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(shape){const id="string"==typeof shape?shape:shape?.id??null;return id!==this.getCroppingShapeId()&&this.run((()=>{if(id){const shape2=this.getShape(id),util=this.getShapeUtil(shape2);shape2&&util.canCrop(shape2)&&this.updateCurrentPageState({croppingShapeId:id})}else this.updateCurrentPageState({croppingShapeId:null})}),{history:"ignore"}),this}getTextOptions(){return(0,dist_esm.Z1)(this._textOptions.get(),"Cannot use text without setting textOptions")}_unsafe_getCameraId(){return TLCamera_CameraRecordType.createId(this.getCurrentPageId())}getCamera(){const baseCamera=this.store.get(this._unsafe_getCameraId());if(this._isLockedOnFollowingUser.get()){const followingCamera=this.getCameraForFollowing();if(followingCamera)return{...baseCamera,...followingCamera}}return baseCamera}_getFollowingPresence(targetUserId){const visited=[this.user.getId()],collaborators=this.getCollaborators();let leaderPresence=null;for(;targetUserId&&!visited.includes(targetUserId);)leaderPresence=collaborators.find((c=>c.userId===targetUserId))??null,targetUserId=leaderPresence?.followingUserId??null,leaderPresence&&visited.push(leaderPresence.userId);return leaderPresence}getViewportPageBoundsForFollowing(){const leaderPresence=this._getFollowingPresence(this.getInstanceState().followingUserId);if(!leaderPresence?.camera||!leaderPresence?.screenBounds)return null;const{w:lw,h:lh}=leaderPresence.screenBounds,{x:lx,y:ly,z:lz}=leaderPresence.camera,theirViewport=new Box(-lx,-ly,lw/lz,lh/lz),ourViewport=this.getViewportScreenBounds().clone(),ourAspectRatio=ourViewport.width/ourViewport.height;return ourViewport.width=theirViewport.width,ourViewport.height=ourViewport.width/ourAspectRatio,ourViewport.height<theirViewport.height&&(ourViewport.height=theirViewport.height,ourViewport.width=ourViewport.height*ourAspectRatio),ourViewport.center=theirViewport.center,ourViewport}getCameraForFollowing(){const viewport=this.getViewportPageBoundsForFollowing();return viewport?{x:-viewport.x,y:-viewport.y,z:this.getViewportScreenBounds().w/viewport.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){const cameraOptions=this.getCameraOptions();if(!cameraOptions.constraints)return 1;if("default"===cameraOptions.constraints.initialZoom)return 1;const{zx,zy}=getCameraFitXFitY(this,cameraOptions);switch(cameraOptions.constraints.initialZoom){case"fit-min":return Math.max(zx,zy);case"fit-max":return Math.min(zx,zy);case"fit-x":return zx;case"fit-y":return zy;case"fit-min-100":return Math.min(1,Math.max(zx,zy));case"fit-max-100":return Math.min(1,Math.min(zx,zy));case"fit-x-100":return Math.min(1,zx);case"fit-y-100":return Math.min(1,zy);default:throw(0,dist_esm.h6)(cameraOptions.constraints.initialZoom)}}getBaseZoom(){const cameraOptions=this.getCameraOptions();if(!cameraOptions.constraints)return 1;if("default"===cameraOptions.constraints.baseZoom)return 1;const{zx,zy}=getCameraFitXFitY(this,cameraOptions);switch(cameraOptions.constraints.baseZoom){case"fit-min":return Math.max(zx,zy);case"fit-max":return Math.min(zx,zy);case"fit-x":return zx;case"fit-y":return zy;case"fit-min-100":return Math.min(1,Math.max(zx,zy));case"fit-max-100":return Math.min(1,Math.min(zx,zy));case"fit-x-100":return Math.min(1,zx);case"fit-y-100":return Math.min(1,zy);default:throw(0,dist_esm.h6)(cameraOptions.constraints.baseZoom)}}getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(opts){const next=(0,dist_esm.pN)({...this._cameraOptions.__unsafe__getWithoutCapture(),...opts});return next.zoomSteps?.length<1&&(next.zoomSteps=[1]),this._cameraOptions.set(next),this.setCamera(this.getCamera()),this}getConstrainedCamera(point,opts){const currentCamera=this.getCamera();let{x,y,z=currentCamera.z}=point;if(!opts?.force){const cameraOptions=this.getCameraOptions(),zoomMin=cameraOptions.zoomSteps[0],zoomMax=(0,dist_esm.HV)(cameraOptions.zoomSteps),vsb=this.getViewportScreenBounds();if(cameraOptions.constraints){const{constraints}=cameraOptions,py=Math.min(constraints.padding.y,vsb.w/2),px=Math.min(constraints.padding.x,vsb.h/2),bounds=Box.From(cameraOptions.constraints.bounds),zx=(vsb.w-2*px)/bounds.w,zy=(vsb.h-2*py)/bounds.h,baseZoom=this.getBaseZoom(),maxZ=zoomMax*baseZoom,minZ=zoomMin*baseZoom;if(opts?.reset&&(z=this.getInitialZoom()),z<minZ||z>maxZ){const{x:cx,y:cy,z:cz}=currentCamera,cxA=-cx+vsb.w/cz/2,cyA=-cy+vsb.h/cz/2;z=clamp(z,minZ,maxZ);x=cx+(-cx+vsb.w/z/2)-cxA,y=cy+(-cy+vsb.h/z/2)-cyA}const minX=px/z-bounds.x,minY=py/z-bounds.y,freeW=(vsb.w-2*px)/z-bounds.w,freeH=(vsb.h-2*py)/z-bounds.h,originX=minX+freeW*constraints.origin.x,originY=minY+freeH*constraints.origin.y,behaviorX="string"==typeof constraints.behavior?constraints.behavior:constraints.behavior.x,behaviorY="string"==typeof constraints.behavior?constraints.behavior:constraints.behavior.y;if(opts?.reset)x=originX,y=originY;else{switch(behaviorX){case"fixed":x=originX;break;case"contain":x=z<zx?originX:clamp(x,minX+freeW,minX);break;case"inside":x=z<zx?clamp(x,minX,(vsb.w-px)/z-bounds.w):clamp(x,minX+freeW,minX);break;case"outside":x=clamp(x,px/z-bounds.w,(vsb.w-px)/z);break;case"free":break;default:throw(0,dist_esm.h6)(behaviorX)}switch(behaviorY){case"fixed":y=originY;break;case"contain":y=z<zy?originY:clamp(y,minY+freeH,minY);break;case"inside":y=z<zy?clamp(y,minY,(vsb.h-py)/z-bounds.h):clamp(y,minY+freeH,minY);break;case"outside":y=clamp(y,py/z-bounds.h,(vsb.h-py)/z);break;case"free":break;default:throw(0,dist_esm.h6)(behaviorY)}}}else if(z>zoomMax||z<zoomMin){const{x:cx,y:cy,z:cz}=currentCamera;z=clamp(z,zoomMin,zoomMax),x=cx+(-cx+vsb.w/z/2)-(-cx+vsb.w/cz/2),y=cy+(-cy+vsb.h/z/2)-(-cy+vsb.h/cz/2)}}return{x,y,z}}_setCamera(point,opts){const currentCamera=this.getCamera(),{x,y,z}=this.getConstrainedCamera(point,opts);return currentCamera.x===x&&currentCamera.y===y&&currentCamera.z===z||(0,state_dist_esm.hL)((()=>{const camera={...currentCamera,x,y,z};this.run((()=>{this.store.put([camera])}),{history:"ignore"});const{currentScreenPoint,currentPagePoint}=this.inputs,{screenBounds}=this.store.unsafeGetWithoutCapture(TLInstance_TLINSTANCE_ID);if(currentScreenPoint.x/z-x!==currentPagePoint.x||currentScreenPoint.y/z-y!==currentPagePoint.y){const event={type:"pointer",target:"canvas",name:"pointer_move",point:Vec.AddXY(currentScreenPoint,screenBounds.x,screenBounds.y),pointerId:INTERNAL_POINTER_IDS_CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,metaKey:this.inputs.metaKey,accelKey:isAccelKey(this.inputs),button:0,isPen:this.getInstanceState().isPenMode??!1};opts?.immediate?this._flushEventForTick(event):this.dispatch(event)}this._tickCameraState()})),this}setCamera(point,opts){const{isLocked}=this._cameraOptions.__unsafe__getWithoutCapture();if(isLocked&&!opts?.force)return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();const _point=Vec.Cast(point);Number.isFinite(_point.x)||(_point.x=0),Number.isFinite(_point.y)||(_point.y=0),void 0!==_point.z&&Number.isFinite(_point.z)||(point.z=this.getZoomLevel());const camera=this.getConstrainedCamera(_point,opts);if(opts?.animation){const{width,height}=this.getViewportScreenBounds();this._animateToViewport(new Box(-camera.x,-camera.y,width/camera.z,height/camera.z),opts)}else this._setCamera(camera,{...opts,force:!0});return this}centerOnPoint(point,opts){const{isLocked}=this.getCameraOptions();if(isLocked&&!opts?.force)return this;const{width:pw,height:ph}=this.getViewportPageBounds();return this.setCamera(new Vec(-(point.x-pw/2),-(point.y-ph/2),this.getCamera().z),opts),this}zoomToFit(opts){const ids=[...this.getCurrentPageShapeIds()];if(ids.length<=0)return this;const pageBounds=Box.Common((0,dist_esm.oE)(ids.map((id=>this.getShapePageBounds(id)))));return this.zoomToBounds(pageBounds,opts),this}resetZoom(point=this.getViewportScreenCenter(),opts){const{isLocked,constraints}=this.getCameraOptions();if(isLocked&&!opts?.force)return this;const currentCamera=this.getCamera(),{x:cx,y:cy,z:cz}=currentCamera,{x,y}=point;let z=1;if(constraints){const initialZoom=this.getInitialZoom();cz!==initialZoom&&(z=initialZoom)}return this.setCamera(new Vec(cx+(x/z-x)-(x/cz-x),cy+(y/z-y)-(y/cz-y),z),opts),this}zoomIn(point=this.getViewportScreenCenter(),opts){const{isLocked}=this.getCameraOptions();if(isLocked&&!opts?.force)return this;const{x:cx,y:cy,z:cz}=this.getCamera(),{zoomSteps}=this.getCameraOptions();if(null!==zoomSteps&&zoomSteps.length>1){const baseZoom=this.getBaseZoom();let zoom=(0,dist_esm.HV)(zoomSteps)*baseZoom;for(let i=1;i<zoomSteps.length;i++){const z1=zoomSteps[i-1]*baseZoom,z2=zoomSteps[i]*baseZoom;if(!(z2-cz<=(z2-z1)/2)){zoom=z2;break}}this.setCamera(new Vec(cx+(point.x/zoom-point.x)-(point.x/cz-point.x),cy+(point.y/zoom-point.y)-(point.y/cz-point.y),zoom),opts)}return this}zoomOut(point=this.getViewportScreenCenter(),opts){const{isLocked}=this.getCameraOptions();if(isLocked&&!opts?.force)return this;const{zoomSteps}=this.getCameraOptions();if(null!==zoomSteps&&zoomSteps.length>1){const baseZoom=this.getBaseZoom(),{x:cx,y:cy,z:cz}=this.getCamera();let zoom=zoomSteps[0]*baseZoom;for(let i=zoomSteps.length-1;i>0;i--){const z1=zoomSteps[i-1]*baseZoom,z2=zoomSteps[i]*baseZoom;if(!(z2-cz>=(z2-z1)/2)){zoom=z1;break}}this.setCamera(new Vec(cx+(point.x/zoom-point.x)-(point.x/cz-point.x),cy+(point.y/zoom-point.y)-(point.y/cz-point.y),zoom),opts)}return this}zoomToSelection(opts){const{isLocked}=this.getCameraOptions();if(isLocked&&!opts?.force)return this;const selectionPageBounds=this.getSelectionPageBounds();return selectionPageBounds&&this.zoomToBounds(selectionPageBounds,{targetZoom:Math.max(1,this.getZoomLevel()),...opts}),this}zoomToSelectionIfOffscreen(padding=16,opts){const selectionPageBounds=this.getSelectionPageBounds(),viewportPageBounds=this.getViewportPageBounds();if(selectionPageBounds&&!viewportPageBounds.contains(selectionPageBounds)){const eb=selectionPageBounds.clone().expandBy(padding/this.getZoomLevel()).expand(viewportPageBounds),nextBounds=viewportPageBounds.clone().translate({x:2*(eb.center.x-viewportPageBounds.center.x),y:2*(eb.center.y-viewportPageBounds.center.y)});this.zoomToBounds(nextBounds,opts)}}zoomToBounds(bounds,opts){const cameraOptions=this._cameraOptions.__unsafe__getWithoutCapture();if(cameraOptions.isLocked&&!opts?.force)return this;const viewportScreenBounds=this.getViewportScreenBounds(),inset=opts?.inset??Math.min(128,.28*viewportScreenBounds.width),baseZoom=this.getBaseZoom(),zoomMin=cameraOptions.zoomSteps[0],zoomMax=(0,dist_esm.HV)(cameraOptions.zoomSteps);let zoom=clamp(Math.min((viewportScreenBounds.width-inset)/bounds.w,(viewportScreenBounds.height-inset)/bounds.h),zoomMin*baseZoom,zoomMax*baseZoom);return void 0!==opts?.targetZoom&&(zoom=Math.min(opts.targetZoom,zoom)),this.setCamera(new Vec(-bounds.x+(viewportScreenBounds.width-bounds.w*zoom)/2/zoom,-bounds.y+(viewportScreenBounds.height-bounds.h*zoom)/2/zoom,zoom),opts),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(ms){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=ms;const{elapsed,easing,duration,start,end}=this._viewportAnimation;if(elapsed>duration)return this.off("tick",this._animateViewport),this._viewportAnimation=null,void this._setCamera(new Vec(-end.x,-end.y,this.getViewportScreenBounds().width/end.width));const t=easing(1-(duration-elapsed)/duration),left=start.minX+(end.minX-start.minX)*t,top=start.minY+(end.minY-start.minY)*t,right=start.maxX+(end.maxX-start.maxX)*t;this._setCamera(new Vec(-left,-top,this.getViewportScreenBounds().width/(right-left)),{force:!0})}_animateToViewport(targetViewportPage,opts={animation:DEFAULT_ANIMATION_OPTIONS}){const{animation,...rest}=opts;if(!animation)return;const{duration=0,easing=EASINGS.easeInOutCubic}=animation,animationSpeed=this.user.getAnimationSpeed(),viewportPageBounds=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),0===duration||0===animationSpeed?this._setCamera(new Vec(-targetViewportPage.x,-targetViewportPage.y,this.getViewportScreenBounds().width/targetViewportPage.width),{...rest}):(this._viewportAnimation={elapsed:0,duration:duration/animationSpeed,easing,start:viewportPageBounds.clone(),end:targetViewportPage.clone()},this.once("stop-camera-animation",(()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null})),this.on("tick",this._animateViewport),this)}slideCamera(opts={}){const{isLocked}=this.getCameraOptions();if(isLocked&&!opts?.force)return this;if(0===this.user.getAnimationSpeed())return this;this.stopCameraAnimation();const{speed,friction=this.options.cameraSlideFriction,direction,speedThreshold=.01}=opts;let currentSpeed=Math.min(speed,1);const cancel=()=>{this.off("tick",moveCamera),this.off("stop-camera-animation",cancel)};this.once("stop-camera-animation",cancel);const moveCamera=elapsed=>{const{x:cx,y:cy,z:cz}=this.getCamera(),movementVec=Vec.Mul(direction,currentSpeed*elapsed/cz);currentSpeed*=1-friction,currentSpeed<speedThreshold?cancel():this._setCamera(new Vec(cx+movementVec.x,cy+movementVec.y,cz))};return this.on("tick",moveCamera),this}zoomToUser(userId,opts={animation:{duration:500}}){const presence=this.getCollaborators().find((c=>c.userId===userId));if(!presence)return this;const cursor=presence.cursor;return cursor?(this.run((()=>{null!==this.getInstanceState().followingUserId&&this.stopFollowingUser();const isOnSamePage=presence.currentPageId===this.getCurrentPageId();isOnSamePage||this.setCurrentPage(presence.currentPageId),opts&&opts.animation&&!isOnSamePage&&(opts.animation=void 0),this.centerOnPoint(cursor,opts);const{highlightedUserIds}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...highlightedUserIds,userId]}),this.timers.setTimeout((()=>{const highlightedUserIds2=[...this.getInstanceState().highlightedUserIds],index=highlightedUserIds2.indexOf(userId);index<0||(highlightedUserIds2.splice(index,1),this.updateInstanceState({highlightedUserIds:highlightedUserIds2}))}),this.options.collaboratorIdleTimeoutMs)})),this):this}updateViewportScreenBounds(screenBounds,center=!1){if(screenBounds instanceof HTMLElement){const rect=screenBounds.getBoundingClientRect();screenBounds=new Box(rect.left||rect.x,rect.top||rect.y,Math.max(rect.width,1),Math.max(rect.height,1))}else screenBounds.width=Math.max(screenBounds.width,1),screenBounds.height=Math.max(screenBounds.height,1);const insets=[0!==screenBounds.minY,!approximately(document.body.scrollWidth,screenBounds.maxX,1),!approximately(document.body.scrollHeight,screenBounds.maxY,1),0!==screenBounds.minX],{_willSetInitialBounds}=this;this._willSetInitialBounds=!1;const{screenBounds:prevScreenBounds,insets:prevInsets}=this.getInstanceState();if(screenBounds.equals(prevScreenBounds)&&insets.every(((v,i)=>v===prevInsets[i])))return this;if(_willSetInitialBounds)this.updateInstanceState({screenBounds:screenBounds.toJson(),insets}),this.setCamera(this.getCamera());else if(center&&!this.getInstanceState().followingUserId){const before=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:screenBounds.toJson(),insets}),this.centerOnPoint(before)}else this.updateInstanceState({screenBounds:screenBounds.toJson(),insets}),this._setCamera(Vec.From({...this.getCamera()}));return this._tickCameraState(),this}getViewportScreenBounds(){const{x,y,w,h}=this.getInstanceState().screenBounds;return new Box(x,y,w,h)}getViewportScreenCenter(){const viewportScreenBounds=this.getViewportScreenBounds();return new Vec(viewportScreenBounds.midX-viewportScreenBounds.minX,viewportScreenBounds.midY-viewportScreenBounds.minY)}getViewportPageBounds(){const{w,h}=this.getViewportScreenBounds(),{x:cx,y:cy,z:cz}=this.getCamera();return new Box(-cx,-cy,w/cz,h/cz)}screenToPage(point){const{screenBounds}=this.store.unsafeGetWithoutCapture(TLInstance_TLINSTANCE_ID),{x:cx,y:cy,z:cz=1}=this.getCamera();return new Vec((point.x-screenBounds.x)/cz-cx,(point.y-screenBounds.y)/cz-cy,point.z??.5)}pageToScreen(point){const{screenBounds}=this.store.unsafeGetWithoutCapture(TLInstance_TLINSTANCE_ID),{x:cx,y:cy,z:cz=1}=this.getCamera();return new Vec((point.x+cx)*cz+screenBounds.x,(point.y+cy)*cz+screenBounds.y,point.z??.5)}pageToViewport(point){const{x:cx,y:cy,z:cz=1}=this.getCamera();return new Vec((point.x+cx)*cz,(point.y+cy)*cz,point.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",(()=>({userId:{neq:this.user.getId()}})))}getCollaborators(){const allPresenceRecords=this._getCollaboratorsQuery().get();if(!allPresenceRecords.length)return state_dist_esm.Ml;return[...new Set(allPresenceRecords.map((c=>c.userId)))].sort().map((id=>(0,dist_esm.Sk)(allPresenceRecords.filter((c=>c.userId===id)),(p=>p.lastActivityTimestamp??0))))}getCollaboratorsOnCurrentPage(){const currentPageId=this.getCurrentPageId();return this.getCollaborators().filter((c=>c.currentPageId===currentPageId))}startFollowingUser(userId){this.stopFollowingUser();this.user.getId()||console.warn("You should set the userId for the current instance before following a user");if(!this._getFollowingPresence(userId))return this;const latestLeaderPresence=(0,state_dist_esm.EW)("latestLeaderPresence",(()=>this._getFollowingPresence(userId)));return(0,state_dist_esm.hL)((()=>{this.updateInstanceState({followingUserId:userId},{history:"ignore"});const dispose=(0,state_dist_esm.wv)("update current page",(()=>{const leaderPresence2=latestLeaderPresence.get();leaderPresence2?leaderPresence2.currentPageId!==this.getCurrentPageId()&&this.getPage(leaderPresence2.currentPageId)&&this.run((()=>{this.store.put([{...this.getInstanceState(),currentPageId:leaderPresence2.currentPageId}]),this._isLockedOnFollowingUser.set(!0)}),{history:"ignore"}):this.stopFollowingUser()})),cancel=()=>{dispose(),this._isLockedOnFollowingUser.set(!1),this.off("frame",moveTowardsUser),this.off("stop-following",cancel)},moveTowardsUser=()=>{if(!latestLeaderPresence.get())return void this.stopFollowingUser();if(this._isLockedOnFollowingUser.get())return;const animationSpeed=this.user.getAnimationSpeed();if(0===animationSpeed)return void this._isLockedOnFollowingUser.set(!0);const targetViewport=this.getViewportPageBoundsForFollowing();if(!targetViewport)return void this.stopFollowingUser();const currentViewport=this.getViewportPageBounds(),diffX=Math.abs(targetViewport.minX-currentViewport.minX)+Math.abs(targetViewport.maxX-currentViewport.maxX),diffY=Math.abs(targetViewport.minY-currentViewport.minY)+Math.abs(targetViewport.maxY-currentViewport.maxY);if(diffX<this.options.followChaseViewportSnap&&diffY<this.options.followChaseViewportSnap)return void this._isLockedOnFollowingUser.set(!0);const t=clamp(.5*animationSpeed,.1,.8),nextViewport=new Box((0,dist_esm.Cc)(currentViewport.minX,targetViewport.minX,t),(0,dist_esm.Cc)(currentViewport.minY,targetViewport.minY,t),(0,dist_esm.Cc)(currentViewport.width,targetViewport.width,t),(0,dist_esm.Cc)(currentViewport.height,targetViewport.height,t)),nextCamera=new Vec(-nextViewport.x,-nextViewport.y,this.getViewportScreenBounds().width/nextViewport.width);this.stopCameraAnimation(),this._setCamera(nextCamera)};this.once("stop-following",cancel),this.addListener("frame",moveTowardsUser),moveTowardsUser()})),this}stopFollowingUser(){return this.run((()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")}),{history:"ignore"}),this}getUnorderedRenderingShapes(useEditorState){const renderingShapes=[];let nextIndex=2*this.options.maxShapesPerPage,nextBackgroundIndex=this.options.maxShapesPerPage;const erasingShapeIds=this.getErasingShapeIds(),addShapeById=(id,opacity,isAncestorErasing)=>{const shape=this.getShape(id);if(!shape)return;if(this.isShapeHidden(shape)){const isErasing=isAncestorErasing||erasingShapeIds.includes(id);for(const childId of this.getSortedChildIdsForParent(id))addShapeById(childId,opacity,isErasing);return}opacity*=shape.opacity;let isShapeErasing=!1;const util=this.getShapeUtil(shape);useEditorState&&(isShapeErasing=!isAncestorErasing&&erasingShapeIds.includes(id),isShapeErasing&&(opacity*=.32)),renderingShapes.push({id,shape,util,index:nextIndex,backgroundIndex:nextBackgroundIndex,opacity}),nextIndex+=1,nextBackgroundIndex+=1;const childIds=this.getSortedChildIdsForParent(id);if(!childIds.length)return;let backgroundIndexToRestore=null;util.providesBackgroundForChildren(shape)&&(backgroundIndexToRestore=nextBackgroundIndex,nextBackgroundIndex=nextIndex,nextIndex+=this.options.maxShapesPerPage);for(const childId of childIds)addShapeById(childId,opacity,isAncestorErasing||isShapeErasing);null!==backgroundIndexToRestore&&(nextBackgroundIndex=backgroundIndexToRestore)},pages=useEditorState?[this.getCurrentPage()]:this.getPages();for(const page of pages)for(const childId of this.getSortedChildIdsForParent(page.id))addShapeById(childId,1,!1);return renderingShapes}_decayCameraStateTimeout(elapsed){this._cameraStateTimeoutRemaining-=elapsed,this._cameraStateTimeoutRemaining>0||(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))}_tickCameraState(){this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,"idle"===this._cameraState.__unsafe__getWithoutCapture()&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))}getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(dist_esm.rb)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return Array.from(this._getAllPagesQuery().get()).sort(dist_esm.Ky)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(page){return this.store.get("string"==typeof page?page:page.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(page){const pageId="string"==typeof page?page:page.id,result=this.store.query.exec("shape",{parentId:{eq:pageId}});return this.getShapeAndDescendantIds(result.map((s=>s.id)))}setCurrentPage(page){const pageId="string"==typeof page?page:page.id;return this.store.has(pageId)?(this.stopFollowingUser(),this.complete(),this.run((()=>{this.store.put([{...this.getInstanceState(),currentPageId:pageId}]),this.setCamera(this.getCamera())}),{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(partial){if(this.getIsReadonly())return this;return this.getPage(partial.id)?this.run((()=>this.store.update(partial.id,(page=>({...page,...partial}))))):this}createPage(page){return this.run((()=>{if(this.getIsReadonly())return;if(this.getPages().length>=this.options.maxPages)return;const pages=this.getPages(),name=function getIncrementedName(name,others){let result=name;const set=new Set(others);for(;set.has(result);)result=/^.*(\d+)$/.exec(result)?.[1]?result.replace(/(\d+)(?=\D?)$/,(m=>(+m+1).toString())):`${result} 1`;return result}(page.name??"Page 1",pages.map((p=>p.name)));let index=page.index;index&&!pages.some((p=>p.index===index))||(index=(0,dist_esm.AQ)(pages[pages.length-1].index));const newPage=PageRecordType.create({meta:{},...page,name,index});this.store.put([newPage])})),this}deletePage(page){const id="string"==typeof page?page:page.id;return this.run((()=>{if(this.getIsReadonly())return;const pages=this.getPages();if(1===pages.length)return;const deletedPage=this.getPage(id);if(deletedPage){if(id===this.getCurrentPageId()){const index=pages.findIndex((page2=>page2.id===id)),next=pages[index-1]??pages[index+1];this.setCurrentPage(next.id)}this.store.remove([deletedPage.id])}})),this}duplicatePage(page,createId=PageRecordType.createId()){if(this.getPages().length>=this.options.maxPages)return this;const id="string"==typeof page?page:page.id,freshPage=this.getPage(id);if(!freshPage)return this;const prevCamera={...this.getCamera()},content=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(freshPage.id));return this.run((()=>{const pages=this.getPages(),index=(0,dist_esm.HE)(freshPage.index,pages[pages.indexOf(freshPage)+1]?.index);if(this.createPage({name:freshPage.name+" Copy",id:createId,index}),this.setCurrentPage(createId),this.setCamera(prevCamera),content)return this.putContentOntoCurrentPage(content)})),this}renamePage(page,name){const id="string"==typeof page?page:page.id;return this.getIsReadonly()||this.updatePage({id,name}),this}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(assets){return this.getIsReadonly()||assets.length<=0||this.run((()=>this.store.put(assets)),{history:"ignore"}),this}updateAssets(assets){return this.getIsReadonly()||assets.length<=0||this.run((()=>{this.store.put(assets.map((partial=>({...this.store.get(partial.id),...partial}))))}),{history:"ignore"}),this}deleteAssets(assets){if(this.getIsReadonly())return this;const ids="string"==typeof assets[0]?assets:assets.map((a=>a.id));return ids.length<=0||this.run((()=>{this.store.props.assets.remove?.(ids),this.store.remove(ids)}),{history:"ignore"}),this}getAsset(asset){return this.store.get("string"==typeof asset?asset:asset.id)}async resolveAssetUrl(assetId,context){if(!assetId)return null;const asset=this.getAsset(assetId);if(!asset)return null;const{screenScale=1,shouldResolveToOriginal=!1,dpr=this.getInstanceState().devicePixelRatio}=context,steppedScreenScale=(zoom=screenScale,Math.pow(2,Math.ceil(Math.log2(zoom))));var zoom;const networkEffectiveType="connection"in navigator?navigator.connection.effectiveType:null;return await this.store.props.assets.resolve(asset,{screenScale:screenScale||1,steppedScreenScale,dpr,networkEffectiveType,shouldResolveToOriginal})}async uploadAsset(asset,file,abortSignal){return await this.store.props.assets.upload(asset,file,abortSignal)}getShapeGeometry(shape,opts){const context=opts?.context??"none";return this._shapeGeometryCaches[context]||(this._shapeGeometryCaches[context]=this.store.createComputedCache("bounds",(shape2=>(this.fonts.trackFontsForShape(shape2),this.getShapeUtil(shape2).getGeometry(shape2,opts))),{areRecordsEqual:areShapesContentEqual})),this._shapeGeometryCaches[context].get("string"==typeof shape?shape:shape.id)}getShapePageGeometry(shape,opts){const context=opts?.context??"none";return this._shapePageGeometryCaches[context]||(this._shapePageGeometryCaches[context]=this.store.createComputedCache("bounds",(shape2=>{const geometry=this.getShapeGeometry(shape2.id,opts),pageTransform=this.getShapePageTransform(shape2.id);return geometry.transform(pageTransform)}),{areRecordsEqual:()=>!0})),this._shapePageGeometryCaches[context].get("string"==typeof shape?shape:shape.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",(shape=>this.getShapeUtil(shape).getHandles?.(shape)),{areRecordsEqual:areShapesContentEqual})}getShapeHandles(shape){return this._getShapeHandlesCache().get("string"==typeof shape?shape:shape.id)}getShapeLocalTransform(shape){const id="string"==typeof shape?shape:shape.id,freshShape=this.getShape(id);if(!freshShape)throw Error("Editor.getTransform: shape not found");return Mat.Identity().translate(freshShape.x,freshShape.y).rotate(freshShape.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",(shape=>{if(isPageId(shape.parentId))return this.getShapeLocalTransform(shape);const parentTransform=this._getShapePageTransformCache().get(shape.parentId)??Mat.Identity();return Mat.Compose(parentTransform,this.getShapeLocalTransform(shape))}))}getShapeParentTransform(shape){const id="string"==typeof shape?shape:shape.id,freshShape=this.getShape(id);return!freshShape||isPageId(freshShape.parentId)?Mat.Identity():this._getShapePageTransformCache().get(freshShape.parentId)??Mat.Identity()}getShapePageTransform(shape){const id="string"==typeof shape?shape:shape.id;return this._getShapePageTransformCache().get(id)??Mat.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",(shape=>this.getShapePageGeometry(shape).bounds))}getShapePageBounds(shape){return this._getShapePageBoundsCache().get("string"==typeof shape?shape:shape.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",(shape=>{const pageMask=this._getShapeMaskCache().get(shape.id);if(!pageMask)return;if(0===pageMask.length)return"polygon(0px 0px, 0px 0px, 0px 0px)";const pageTransform=this._getShapePageTransformCache().get(shape.id);if(!pageTransform)return;return`polygon(${Mat.applyToPoints(Mat.Inverse(pageTransform),pageMask).map((p=>`${p.x}px ${p.y}px`)).join(",")})`}))}getShapeClipPath(shape){return this._getShapeClipPathCache().get("string"==typeof shape?shape:shape.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",(shape=>{if(isPageId(shape.parentId))return;const frameAncestors=this.getShapeAncestors(shape.id).filter((shape2=>this.isShapeOfType(shape2,"frame")));if(0===frameAncestors.length)return;return frameAncestors.map((s=>this.getShapePageGeometry(s.id).vertices)).reduce(((acc,b)=>{if(!b||!acc)return;const intersection=intersectPolygonPolygon(acc,b);return intersection?intersection.map(Vec.Cast):[]}))}))}getShapeMask(shape){return this._getShapeMaskCache().get("string"==typeof shape?shape:shape.id)}getShapeMaskedPageBounds(shape){return"string"!=typeof shape&&(shape=shape.id),this._getShapeMaskedPageBoundsCache().get(shape)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",(shape=>{const pageBounds=this._getShapePageBoundsCache().get(shape.id);if(!pageBounds)return;const pageMask=this._getShapeMaskCache().get(shape.id);if(pageMask){if(0===pageMask.length)return;const{corners}=pageBounds;if(corners.every(((p,i)=>p&&Vec.Equals(p,pageMask[i]))))return pageBounds.clone();const intersection=intersectPolygonPolygon(pageMask,corners);if(!intersection)return;return Box.FromPoints(intersection)}return pageBounds}))}getShapeAncestors(shape,acc=[]){const id="string"==typeof shape?shape:shape.id,freshShape=this.getShape(id);if(!freshShape)return acc;const parentId=freshShape.parentId;if(isPageId(parentId))return acc.reverse(),acc;const parent=this.store.get(parentId);return parent?(acc.push(parent),this.getShapeAncestors(parent,acc)):acc}findShapeAncestor(shape,predicate){const id="string"==typeof shape?shape:shape.id,freshShape=this.getShape(id);if(!freshShape)return;const parentId=freshShape.parentId;if(isPageId(parentId))return;const parent=this.getShape(parentId);return parent?predicate(parent)?parent:this.findShapeAncestor(parent,predicate):void 0}hasAncestor(shape,ancestorId){const id="string"==typeof shape?shape:shape?.id,freshShape=id&&this.getShape(id);return!!freshShape&&(freshShape.parentId===ancestorId||this.hasAncestor(this.getShapeParent(freshShape),ancestorId))}findCommonAncestor(shapes,predicate){if(0===shapes.length)return;const ids="string"==typeof shapes[0]?shapes:shapes.map((s=>s.id)),freshShapes=(0,dist_esm.oE)(ids.map((id=>this.getShape(id))));if(1===freshShapes.length){const parentId=freshShapes[0].parentId;if(isPageId(parentId))return;return predicate?this.findShapeAncestor(freshShapes[0],predicate)?.id:parentId}const[nodeA,...others]=freshShapes;let ancestor=this.getShapeParent(nodeA);for(;ancestor;)if(!predicate||predicate(ancestor)){if(others.every((shape=>this.hasAncestor(shape,ancestor.id))))return ancestor.id;ancestor=this.getShapeParent(ancestor)}else ancestor=this.getShapeParent(ancestor)}isShapeOrAncestorLocked(arg){const shape="string"==typeof arg?this.getShape(arg):arg;return void 0!==shape&&(!!shape.isLocked||this.isShapeOrAncestorLocked(this.getShapeParent(shape)))}_notVisibleShapes(){return(editor=>{function fromScratch(editor2){const shapes=editor2.getCurrentPageShapeIds(),viewportPageBounds=editor2.getViewportPageBounds(),notVisibleShapes2=new Set;return shapes.forEach((id=>{(function isShapeNotVisible(editor,id,viewportPageBounds){const maskedPageBounds=editor.getShapeMaskedPageBounds(id);return void 0===maskedPageBounds||!viewportPageBounds.includes(maskedPageBounds)})(editor2,id,viewportPageBounds)&&notVisibleShapes2.add(id)})),notVisibleShapes2}return(0,state_dist_esm.EW)("notVisibleShapes",(prevValue=>{if((0,state_dist_esm._O)(prevValue))return fromScratch(editor);const nextValue=fromScratch(editor);if(prevValue.size!==nextValue.size)return nextValue;for(const prev of prevValue)if(!nextValue.has(prev))return nextValue;return prevValue}))})(this)}getCulledShapes(){const notVisibleShapes2=this._notVisibleShapes().get(),selectedShapeIds=this.getSelectedShapeIds(),editingId=this.getEditingShapeId(),culledShapes=new Set(notVisibleShapes2);return editingId&&culledShapes.delete(editingId),selectedShapeIds.forEach((id=>{culledShapes.delete(id)})),culledShapes}getCurrentPageBounds(){let commonBounds;return this.getCurrentPageShapeIdsSorted().forEach((shapeId=>{const bounds=this.getShapeMaskedPageBounds(shapeId);bounds&&(commonBounds=commonBounds?commonBounds.expand(bounds):bounds.clone())})),commonBounds}getSelectedShapeAtPoint(point){const selectedShapeIds=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter((shape=>"group"!==shape.type&&selectedShapeIds.includes(shape.id))).reverse().find((shape=>this.isPointInShape(shape,point,{hitInside:!0,margin:0})))}getShapeAtPoint(point,opts={}){const zoomLevel=this.getZoomLevel(),viewportPageBounds=this.getViewportPageBounds(),{filter,margin=0,hitLocked=!1,hitLabels=!1,hitInside=!1,hitFrameInside=!1}=opts;let inHollowSmallestArea=1/0,inHollowSmallestAreaHit=null,inMarginClosestToEdgeDistance=1/0,inMarginClosestToEdgeHit=null;const shapesToCheck=(opts.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter((shape=>{if(shape.isLocked&&!hitLocked||this.isShapeHidden(shape)||this.isShapeOfType(shape,"group"))return!1;const pageMask=this.getShapeMask(shape);return!(pageMask&&!pointInPolygon(point,pageMask))&&(!filter||filter(shape))}));for(let i=shapesToCheck.length-1;i>=0;i--){const shape=shapesToCheck[i],geometry=this.getShapeGeometry(shape),isGroup=geometry instanceof Group2d,pointInShapeSpace=this.getPointInShapeSpace(shape,point);if(this.isShapeOfType(shape,"frame")||this.isShapeOfType(shape,"arrow")&&shape.props.text.trim()||(this.isShapeOfType(shape,"note")||this.isShapeOfType(shape,"geo")&&"none"===shape.props.fill)&&this.getShapeUtil(shape).getText(shape)?.trim())for(const childGeometry of geometry.children)if(childGeometry.isLabel&&childGeometry.isPointInBounds(pointInShapeSpace))return shape;if(this.isShapeOfType(shape,"frame")){const distance2=geometry.distanceToPoint(pointInShapeSpace,hitInside);if(Math.abs(distance2)<=margin)return inMarginClosestToEdgeHit||shape;if(geometry.hitTestPoint(pointInShapeSpace,0,!0))return inMarginClosestToEdgeHit||inHollowSmallestAreaHit||(hitFrameInside?shape:void 0);continue}let distance;if(isGroup){let minDistance=1/0;for(const childGeometry of geometry.children){if(childGeometry.isLabel&&!hitLabels)continue;const tDistance=childGeometry.distanceToPoint(pointInShapeSpace,hitInside);tDistance<minDistance&&(minDistance=tDistance)}distance=minDistance}else distance=0===margin&&(geometry.bounds.w<1||geometry.bounds.h<1)||geometry.bounds.containsPoint(pointInShapeSpace,margin)?geometry.distanceToPoint(pointInShapeSpace,hitInside):1/0;if(geometry.isClosed){if(distance<=margin){if(geometry.isFilled||isGroup&&geometry.children[0].isFilled)return inMarginClosestToEdgeHit||shape;if(this.getShapePageBounds(shape).contains(viewportPageBounds))continue;if(Math.abs(distance)<margin)Math.abs(distance)<inMarginClosestToEdgeDistance&&(inMarginClosestToEdgeDistance=Math.abs(distance),inMarginClosestToEdgeHit=shape);else if(!inMarginClosestToEdgeHit){const{area}=geometry;area<inHollowSmallestArea&&(inHollowSmallestArea=area,inHollowSmallestAreaHit=shape)}}}else if(distance<this.options.hitTestMargin/zoomLevel)return shape}return inMarginClosestToEdgeHit||inHollowSmallestAreaHit||void 0}getShapesAtPoint(point,opts={}){return this.getCurrentPageShapes().filter((shape=>!this.isShapeHidden(shape)&&this.isPointInShape(shape,point,opts)))}isPointInShape(shape,point,opts={}){const{hitInside=!1,margin=0}=opts,id="string"==typeof shape?shape:shape.id,pageMask=this.getShapeMask(id);return!(pageMask&&!pointInPolygon(point,pageMask))&&this.getShapeGeometry(id).hitTestPoint(this.getPointInShapeSpace(shape,point),margin,hitInside)}getPointInShapeSpace(shape,point){const id="string"==typeof shape?shape:shape.id;return this._getShapePageTransformCache().get(id).clone().invert().applyToPoint(point)}getPointInParentSpace(shape,point){const id="string"==typeof shape?shape:shape.id,freshShape=this.getShape(id);if(!freshShape)return new Vec(0,0);if(isPageId(freshShape.parentId))return Vec.From(point);const parentTransform=this.getShapePageTransform(freshShape.parentId);return parentTransform?parentTransform.clone().invert().applyToPoint(point):Vec.From(point)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),(id=>this.store.get(id)))}getCurrentPageShapesSorted(){const result=[],topLevelShapes=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let i=0,n=topLevelShapes.length;i<n;i++)pushShapeWithDescendants(this,topLevelShapes[i],result);return result}getCurrentPageRenderingShapesSorted(){const culledShapes=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter((({id})=>!culledShapes.has(id)&&!this.isShapeHidden(id)))}isShapeOfType(arg,type){const shape="string"==typeof arg?this.getShape(arg):arg;return!!shape&&shape.type===type}getShape(shape){const id="string"==typeof shape?shape:shape.id;if(isShapeId(id))return this.store.get(id)}getShapeParent(shape){const id="string"==typeof shape?shape:shape?.id;if(!id)return;const freshShape=this.getShape(id);return void 0!==freshShape&&isShapeId(freshShape.parentId)?this.store.get(freshShape.parentId):void 0}getShapeNearestSibling(siblingShape,targetShape){if(!targetShape)return;if(targetShape.parentId===siblingShape.parentId)return targetShape;return this.findShapeAncestor(targetShape,(ancestor2=>ancestor2.parentId===siblingShape.parentId))}isShapeInPage(shape,pageId=this.getCurrentPageId()){const id="string"==typeof shape?shape:shape.id,shapeToCheck=this.getShape(id);if(!shapeToCheck)return!1;let shapeIsInPage=!1;if(shapeToCheck.parentId===pageId)shapeIsInPage=!0;else{let parent=this.getShape(shapeToCheck.parentId);isInPageSearch:for(;parent;){if(parent.parentId===pageId){shapeIsInPage=!0;break isInPageSearch}parent=this.getShape(parent.parentId)}}return shapeIsInPage}getAncestorPageId(shape){const id="string"==typeof shape?shape:shape?.id,_shape=id&&this.getShape(id);if(_shape)return isPageId(_shape.parentId)?_shape.parentId:this.getAncestorPageId(this.getShape(_shape.parentId))}reparentShapes(shapes,parentId,insertIndex){const ids="string"==typeof shapes[0]?shapes:shapes.map((s=>s.id));if(0===ids.length)return this;const changes=[],parentTransform=isPageId(parentId)?Mat.Identity():this.getShapePageTransform(parentId),parentPageRotation=parentTransform.rotation();let indices=[];const sibs=(0,dist_esm.oE)(this.getSortedChildIdsForParent(parentId).map((id=>this.getShape(id))));if(insertIndex){const sibWithInsertIndex=sibs.find((s=>s.index===insertIndex));if(sibWithInsertIndex){const sibAbove=sibs[sibs.indexOf(sibWithInsertIndex)+1];indices=sibAbove?(0,dist_esm.MT)(insertIndex,sibAbove.index,ids.length):(0,dist_esm.Zo)(insertIndex,ids.length)}else{const sibAbove=sibs.sort(dist_esm.Ky).find((s=>s.index>insertIndex));indices=sibAbove?(0,dist_esm.MT)(insertIndex,sibAbove.index,ids.length):(0,dist_esm.Zo)(insertIndex,ids.length)}}else{const sib=sibs.length&&sibs[sibs.length-1];indices=sib?(0,dist_esm.Zo)(sib.index,ids.length):(0,dist_esm.uu)(ids.length)}const invertedParentTransform=parentTransform.clone().invert(),shapesToReparent=(0,dist_esm.oE)(ids.map((id=>this.getShape(id)))).sort(dist_esm.Ky);return this.run((()=>{for(let i=0;i<shapesToReparent.length;i++){const shape=shapesToReparent[i],pageTransform=this.getShapePageTransform(shape);if(!pageTransform)continue;const pagePoint=pageTransform.point();if(!pagePoint)continue;const newPoint=invertedParentTransform.applyToPoint(pagePoint),newRotation=pageTransform.rotation()-parentPageRotation;changes.push({id:shape.id,type:shape.type,parentId,x:newPoint.x,y:newPoint.y,rotation:newRotation,index:indices[i]})}this.updateShapes(changes)}),{ignoreShapeLock:!0}),this}getHighestIndexForParent(parent){const parentId="string"==typeof parent?parent:parent.id,children=this._parentIdsToChildIds.get()[parentId];if(!children||0===children.length)return"a1";const shape=this.getShape(children[children.length-1]);return(0,dist_esm.AQ)(shape.index)}getSortedChildIdsForParent(parent){const parentId="string"==typeof parent?parent:parent.id,ids=this._parentIdsToChildIds.get()[parentId];return ids||state_dist_esm.Ml}visitDescendants(parent,visitor){const parentId="string"==typeof parent?parent:parent.id,children=this.getSortedChildIdsForParent(parentId);for(const id of children)!1!==visitor(id)&&this.visitDescendants(id,visitor);return this}getShapeAndDescendantIds(ids){const shapeIds=new Set;for(const shape of ids.map((id=>this.getShape(id))).sort(dist_esm.Ky))shapeIds.add(shape.id),this.visitDescendants(shape,(descendantId=>{shapeIds.add(descendantId)}));return shapeIds}getDroppingOverShape(point,droppingShapes=[]){const currentPageShapesSorted=this.getCurrentPageShapesSorted();for(let i=currentPageShapesSorted.length-1;i>=0;i--){const shape=currentPageShapesSorted[i];if(this.isShapeHidden(shape)||this.getSelectedShapeIds().includes(shape.id)||!this.getShapeUtil(shape).canDropShapes(shape,droppingShapes)||droppingShapes.find((s=>s.id===shape.id||this.hasAncestor(shape,s.id))))continue;const maskedPageBounds=this.getShapeMaskedPageBounds(shape.id);if(maskedPageBounds&&maskedPageBounds.containsPoint(point)&&this.getShapeGeometry(shape).hitTestPoint(this.getPointInShapeSpace(shape,point),0,!0))return shape}}getOutermostSelectableShape(shape,filter){const id="string"==typeof shape?shape:shape.id,freshShape=this.getShape(id);let match=freshShape,node=freshShape;const focusedGroup=this.getFocusedGroup();for(;node;){if(this.isShapeOfType(node,"group")&&focusedGroup?.id!==node.id&&!this.hasAncestor(focusedGroup,node.id)&&(filter?.(node)??1))match=node;else if(focusedGroup?.id===node.id)break;node=this.getShapeParent(node)}return match}_getBindingsIndexCache(){const index=(editor=>{const{store}=editor,bindingsHistory=store.query.filterHistory("binding"),bindingsQuery=store.query.records("binding");function fromScratch(){const allBindings=bindingsQuery.get(),shape2Binding=new Map;for(const binding of allBindings){const{fromId,toId}=binding,bindingsForFromShape=shape2Binding.get(fromId);bindingsForFromShape?bindingsForFromShape.push(binding):shape2Binding.set(fromId,[binding]);const bindingsForToShape=shape2Binding.get(toId);bindingsForToShape?bindingsForToShape.push(binding):shape2Binding.set(toId,[binding])}return shape2Binding}return(0,state_dist_esm.EW)("arrowBindingsIndex",((_lastValue,lastComputedEpoch)=>{if((0,state_dist_esm._O)(_lastValue))return fromScratch();const lastValue=_lastValue,diff=bindingsHistory.getDiffSince(lastComputedEpoch);if(diff===state_dist_esm.c2)return fromScratch();let nextValue;function removingBinding(binding){nextValue??=new Map(lastValue);const prevFrom=nextValue.get(binding.fromId),nextFrom=prevFrom?.filter((b=>b.id!==binding.id));nextFrom?.length?nextValue.set(binding.fromId,nextFrom):nextValue.delete(binding.fromId);const prevTo=nextValue.get(binding.toId),nextTo=prevTo?.filter((b=>b.id!==binding.id));nextTo?.length?nextValue.set(binding.toId,nextTo):nextValue.delete(binding.toId)}function ensureNewArray(shapeId){nextValue??=new Map(lastValue);let result=nextValue.get(shapeId);return result?result===lastValue.get(shapeId)&&(result=result.slice(0),nextValue.set(shapeId,result)):(result=[],nextValue.set(shapeId,result)),result}function addBinding(binding){ensureNewArray(binding.fromId).push(binding),ensureNewArray(binding.toId).push(binding)}for(const changes of diff){for(const newBinding of(0,dist_esm.Ic)(changes.added))addBinding(newBinding);for(const[prev,next]of(0,dist_esm.Ic)(changes.updated))removingBinding(prev),addBinding(next);for(const prev of(0,dist_esm.Ic)(changes.removed))removingBinding(prev)}return nextValue??lastValue}))})(this);return this.store.createComputedCache("bindingsIndex",(shape=>index.get().get(shape.id)),{areRecordsEqual:()=>!0})}getBinding(id){return this.store.get(id)}getBindingsFromShape(shape,type){const id="string"==typeof shape?shape:shape.id;return this.getBindingsInvolvingShape(id).filter((b=>b.fromId===id&&b.type===type))}getBindingsToShape(shape,type){const id="string"==typeof shape?shape:shape.id;return this.getBindingsInvolvingShape(id).filter((b=>b.toId===id&&b.type===type))}getBindingsInvolvingShape(shape,type){const id="string"==typeof shape?shape:shape.id,result=this._getBindingsIndexCache().get(id)??state_dist_esm.Ml;return type?result.filter((b=>b.type===type)):result}createBindings(partials){const bindings=[];for(const partial of partials){const fromShape=this.getShape(partial.fromId),toShape=this.getShape(partial.toId);if(!fromShape||!toShape)continue;if(!this.canBindShapes({fromShape,toShape,binding:partial}))continue;const defaultProps=this.getBindingUtil(partial.type).getDefaultProps(),binding=this.store.schema.types.binding.create({...partial,id:partial.id??createBindingId(),props:{...defaultProps,...partial.props}});bindings.push(binding)}return this.store.put(bindings),this}createBinding(partial){return this.createBindings([partial])}updateBindings(partials){const updated=[];for(const partial of partials){if(!partial)continue;const current=this.getBinding(partial.id);if(!current)continue;const updatedBinding=applyPartialToRecordWithProps(current,partial);if(updatedBinding===current)continue;const fromShape=this.getShape(updatedBinding.fromId),toShape=this.getShape(updatedBinding.toId);fromShape&&toShape&&(this.canBindShapes({fromShape,toShape,binding:updatedBinding})&&updated.push(updatedBinding))}return this.store.put(updated),this}updateBinding(partial){return this.updateBindings([partial])}deleteBindings(bindings,{isolateShapes=!1}={}){const ids=bindings.map((binding=>"string"==typeof binding?binding:binding.id));return isolateShapes?this.store.atomic((()=>{for(const id of ids){const binding=this.getBinding(id);if(!binding)continue;const util=this.getBindingUtil(binding);util.onBeforeIsolateFromShape?.({binding,removedShape:this.getShape(binding.toId)}),util.onBeforeIsolateToShape?.({binding,removedShape:this.getShape(binding.fromId)}),this.store.remove([id])}})):this.store.remove(ids),this}deleteBinding(binding,opts){return this.deleteBindings([binding],opts)}canBindShapes({fromShape,toShape,binding}){const fromShapeType="string"==typeof fromShape?fromShape:fromShape.type,toShapeType="string"==typeof toShape?toShape:toShape.type,canBindOpts={fromShapeType,toShapeType,bindingType:"string"==typeof binding?binding:binding.type};return fromShapeType===toShapeType?this.getShapeUtil(fromShapeType).canBind(canBindOpts):this.getShapeUtil(fromShapeType).canBind(canBindOpts)&&this.getShapeUtil(toShapeType).canBind(canBindOpts)}rotateShapesBy(shapes,delta,opts){const ids="string"==typeof shapes[0]?shapes:shapes.map((s=>s.id));if(ids.length<=0)return this;const snapshot=getRotationSnapshot({editor:this,ids});return snapshot?(applyRotationToSnapshotShapes({delta,snapshot,editor:this,stage:"one-off",centerOverride:opts?.center}),this):this}getChangesToTranslateShape(initialShape,newShapeCoords){let workingShape=initialShape;const util=this.getShapeUtil(initialShape),afterTranslateStart=util.onTranslateStart?.(workingShape);afterTranslateStart&&(workingShape=applyPartialToRecordWithProps(workingShape,afterTranslateStart)),workingShape=applyPartialToRecordWithProps(workingShape,{id:initialShape.id,type:initialShape.type,x:newShapeCoords.x,y:newShapeCoords.y});const afterTranslate=util.onTranslate?.(initialShape,workingShape);afterTranslate&&(workingShape=applyPartialToRecordWithProps(workingShape,afterTranslate));const afterTranslateEnd=util.onTranslateEnd?.(initialShape,workingShape);return afterTranslateEnd&&(workingShape=applyPartialToRecordWithProps(workingShape,afterTranslateEnd)),workingShape}nudgeShapes(shapes,offset){const ids="string"==typeof shapes[0]?shapes:shapes.map((s=>s.id));if(ids.length<=0)return this;const changes=[];for(const id of ids){const shape=this.getShape(id),localDelta=Vec.From(offset),parentTransform=this.getShapeParentTransform(shape);parentTransform&&localDelta.rot(-parentTransform.rotation()),changes.push(this.getChangesToTranslateShape(shape,localDelta.add(shape)))}return this.updateShapes(changes),this}duplicateShapes(shapes,offset){return this.run((()=>{const ids="string"==typeof shapes[0]?shapes:shapes.map((s=>s.id));if(ids.length<=0)return this;const initialIds=new Set(ids),shapeIdSet=this.getShapeAndDescendantIds(ids),orderedShapeIds=[...shapeIdSet].reverse(),shapeIds=new Map;for(const shapeId of shapeIdSet)shapeIds.set(shapeId,createShapeId());const{shapesToCreateWithOriginals,bindingsToCreate}=withIsolatedShapes(this,shapeIdSet,(bindingIdsToMaintain=>{const bindingsToCreate2=[];for(const originalId of bindingIdsToMaintain){const originalBinding=this.getBinding(originalId);if(!originalBinding)continue;const duplicatedId=createBindingId();bindingsToCreate2.push({...originalBinding,id:duplicatedId,fromId:(0,dist_esm.Z1)(shapeIds.get(originalBinding.fromId)),toId:(0,dist_esm.Z1)(shapeIds.get(originalBinding.toId))})}const shapesToCreateWithOriginals2=[];for(const originalId of orderedShapeIds){const duplicatedId=(0,dist_esm.Z1)(shapeIds.get(originalId)),originalShape=this.getShape(originalId);if(!originalShape)continue;let ox=0,oy=0;if(offset&&initialIds.has(originalId)){const parentTransform=this.getShapeParentTransform(originalShape),vec=new Vec(offset.x,offset.y).rot(-parentTransform.rotation());ox=vec.x,oy=vec.y}shapesToCreateWithOriginals2.push({shape:{...originalShape,id:duplicatedId,x:originalShape.x+ox,y:originalShape.y+oy,index:"a1",parentId:shapeIds.get(originalShape.parentId)??originalShape.parentId},originalShape})}return{shapesToCreateWithOriginals:shapesToCreateWithOriginals2,bindingsToCreate:bindingsToCreate2}}));shapesToCreateWithOriginals.forEach((({shape,originalShape})=>{const parentId=originalShape.parentId,siblings=this.getSortedChildIdsForParent(parentId),currentIndex=siblings.indexOf(originalShape.id),siblingAboveId=siblings[currentIndex+1],siblingAbove=siblingAboveId?this.getShape(siblingAboveId):void 0,index=(0,dist_esm.HE)(originalShape.index,siblingAbove?.index);shape.index=index}));const shapesToCreate=shapesToCreateWithOriginals.map((({shape})=>shape));if(shapesToCreate.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)alertMaxShapes(this);else if(this.createShapes(shapesToCreate),this.createBindings(bindingsToCreate),this.setSelectedShapes((0,dist_esm.oE)(ids.map((id=>shapeIds.get(id))))),void 0!==offset){const selectionPageBounds=this.getSelectionPageBounds(),viewportPageBounds=this.getViewportPageBounds();selectionPageBounds&&!viewportPageBounds.contains(selectionPageBounds)&&this.centerOnPoint(selectionPageBounds.center,{animation:{duration:this.options.animationMediumMs}})}})),this}moveShapesToPage(shapes,pageId){const ids="string"==typeof shapes[0]?shapes:shapes.map((s=>s.id));if(0===ids.length)return this;if(this.getIsReadonly())return this;const currentPageId=this.getCurrentPageId();if(pageId===currentPageId)return this;if(!this.store.has(pageId))return this;const content=this.getContentFromCurrentPage(ids);if(!content)return this;if(this.getPageShapeIds(pageId).size+content.shapes.length>this.options.maxShapesPerPage)return alertMaxShapes(this,pageId),this;const fromPageZ=this.getCamera().z;return this.run((()=>{this.deleteShapes(ids),this.setCurrentPage(pageId),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(content,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:fromPageZ}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)})),this}toggleLock(shapes){const ids="string"==typeof shapes[0]?shapes:shapes.map((s=>s.id));if(this.getIsReadonly()||0===ids.length)return this;let allLocked=!0,allUnlocked=!0;const shapesToToggle=[];for(const id of ids){const shape=this.getShape(id);shape&&(shapesToToggle.push(shape),shape.isLocked?allUnlocked=!1:allLocked=!1)}return this.run((()=>{allUnlocked?(this.updateShapes(shapesToToggle.map((shape=>({id:shape.id,type:shape.type,isLocked:!0})))),this.setSelectedShapes([])):allLocked?this.updateShapes(shapesToToggle.map((shape=>({id:shape.id,type:shape.type,isLocked:!1})))):this.updateShapes(shapesToToggle.map((shape=>({id:shape.id,type:shape.type,isLocked:!0}))))})),this}sendToBack(shapes){const changes=getReorderingShapesChanges(this,"toBack","string"==typeof shapes[0]?shapes:shapes.map((s=>s.id)),{considerAllShapes:!0});return changes&&this.updateShapes(changes),this}sendBackward(shapes,opts={}){const changes=getReorderingShapesChanges(this,"backward","string"==typeof shapes[0]?shapes:shapes.map((s=>s.id)),opts);return changes&&this.updateShapes(changes),this}bringForward(shapes,opts={}){const changes=getReorderingShapesChanges(this,"forward","string"==typeof shapes[0]?shapes:shapes.map((s=>s.id)),opts);return changes&&this.updateShapes(changes),this}bringToFront(shapes){const changes=getReorderingShapesChanges(this,"toFront","string"==typeof shapes[0]?shapes:shapes.map((s=>s.id)));return changes&&this.updateShapes(changes),this}collectShapesViaArrowBindings(info){const{initialShapes,resultShapes,resultBounds,bindings,visited}=info;for(const binding of bindings)for(const id of[binding.fromId,binding.toId])if(!visited.has(id)){const aligningShape=initialShapes.find((s=>s.id===id));if(aligningShape&&!visited.has(aligningShape.id)){visited.add(aligningShape.id);const shapePageBounds=this.getShapePageBounds(aligningShape);if(!shapePageBounds)continue;resultShapes.push(aligningShape),resultBounds.push(shapePageBounds),this.collectShapesViaArrowBindings({...info,bindings:this.getBindingsInvolvingShape(aligningShape,"arrow")})}}}flipShapes(shapes,operation){if(this.getIsReadonly())return this;const ids="string"==typeof shapes[0]?shapes:shapes.map((s=>s.id)),shapesToFlipFirstPass=(0,dist_esm.oE)(ids.map((id=>this.getShape(id))));for(const shape of shapesToFlipFirstPass)if(this.isShapeOfType(shape,"group")){const childrenOfGroups=(0,dist_esm.oE)(this.getSortedChildIdsForParent(shape.id).map((id=>this.getShape(id))));shapesToFlipFirstPass.push(...childrenOfGroups)}const shapesToFlip=[],allBounds=[];for(const shape of shapesToFlipFirstPass){const util=this.getShapeUtil(shape);if(!util.canBeLaidOut(shape,{type:"flip",shapes:shapesToFlipFirstPass}))continue;const pageBounds=this.getShapePageBounds(shape),localBounds=this.getShapeGeometry(shape).bounds,pageTransform=this.getShapePageTransform(shape.id);pageBounds&&localBounds&&pageTransform&&(shapesToFlip.push({shape,localBounds,pageTransform,isAspectRatioLocked:util.isAspectRatioLocked(shape)}),allBounds.push(pageBounds))}if(!shapesToFlip.length)return this;const scaleOriginPage=Box.Common(allBounds).center;return this.run((()=>{for(const{shape,localBounds,pageTransform,isAspectRatioLocked}of shapesToFlip)this.resizeShape(shape.id,{x:"horizontal"===operation?-1:1,y:"vertical"===operation?-1:1},{initialBounds:localBounds,initialPageTransform:pageTransform,initialShape:shape,isAspectRatioLocked,mode:"scale_shape",scaleOrigin:scaleOriginPage,scaleAxisRotation:0})})),this}stackShapes(shapes,operation,gap){const _gap=gap??this.options.adjacentShapeMargin,ids="string"==typeof shapes[0]?shapes:shapes.map((s=>s.id));if(this.getIsReadonly())return this;const shapesToStackFirstPass=(0,dist_esm.oE)(ids.map((id=>this.getShape(id)))),shapeClustersToStack=[],allBounds=[],visited=new Set;for(const shape of shapesToStackFirstPass){if(visited.has(shape.id))continue;visited.add(shape.id);const shapePageBounds=this.getShapePageBounds(shape);if(!shapePageBounds)continue;if(!this.getShapeUtil(shape).canBeLaidOut?.(shape,{type:"stack",shapes:shapesToStackFirstPass}))continue;const shapesMovingTogether=[shape],boundsOfShapesMovingTogether=[shapePageBounds];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(shape.id,"arrow"),initialShapes:shapesToStackFirstPass,resultShapes:shapesMovingTogether,resultBounds:boundsOfShapesMovingTogether,visited});const commonPageBounds=Box.Common(boundsOfShapesMovingTogether);commonPageBounds&&(shapeClustersToStack.push({shapes:shapesMovingTogether,pageBounds:commonPageBounds}),allBounds.push(commonPageBounds))}const len=shapeClustersToStack.length;if(0===_gap&&len<3||len<2)return this;let val,min,max,dim;"horizontal"===operation?(val="x",min="minX",max="maxX",dim="width"):(val="y",min="minY",max="maxY",dim="height");let shapeGap=0;if(0===_gap){const gaps={};shapeClustersToStack.sort(((a,b)=>a.pageBounds[min]-b.pageBounds[min]));for(let i=0;i<len-1;i++){const currCluster=shapeClustersToStack[i],gap2=shapeClustersToStack[i+1].pageBounds[min]-currCluster.pageBounds[max];gaps[gap2]||(gaps[gap2]=0),gaps[gap2]++}let maxCount=1;for(const[gap2,count]of Object.entries(gaps))count>maxCount&&(maxCount=count,shapeGap=parseFloat(gap2));if(1===maxCount){let totalCount=0;for(const[gap2,count]of Object.entries(gaps))shapeGap+=parseFloat(gap2)*count,totalCount+=count;shapeGap/=totalCount}}else shapeGap=_gap;const changes=[];let v=shapeClustersToStack[0].pageBounds[max];for(let i=1;i<shapeClustersToStack.length;i++){const{shapes:shapes2,pageBounds}=shapeClustersToStack[i],delta=new Vec;delta[val]=v+shapeGap-pageBounds[val];for(const shape of shapes2){const shapeDelta=delta.clone(),parent=this.getShapeParent(shape);if(parent){const parentTransform=this.getShapePageTransform(parent);parentTransform&&shapeDelta.rot(-parentTransform.rotation())}shapeDelta.add(shape),changes.push(this.getChangesToTranslateShape(shape,shapeDelta))}v+=pageBounds[dim]+shapeGap}return this.updateShapes(changes),this}packShapes(shapes,_gap){if(this.getIsReadonly())return this;const gap=_gap??this.options.adjacentShapeMargin,ids="string"==typeof shapes[0]?shapes:shapes.map((s=>s.id)),shapesToPackFirstPass=(0,dist_esm.oE)(ids.map((id=>this.getShape(id)))),shapeClustersToPack=[],allBounds=[],visited=new Set;for(const shape of shapesToPackFirstPass){if(visited.has(shape.id))continue;visited.add(shape.id);const shapePageBounds=this.getShapePageBounds(shape);if(!shapePageBounds)continue;if(!this.getShapeUtil(shape).canBeLaidOut?.(shape,{type:"pack",shapes:shapesToPackFirstPass}))continue;const shapesMovingTogether=[shape],boundsOfShapesMovingTogether=[shapePageBounds];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(shape.id,"arrow"),initialShapes:shapesToPackFirstPass,resultShapes:shapesMovingTogether,resultBounds:boundsOfShapesMovingTogether,visited});const commonPageBounds=Box.Common(boundsOfShapesMovingTogether);commonPageBounds&&(shapeClustersToPack.push({shapes:shapesMovingTogether,pageBounds:commonPageBounds,nextPageBounds:commonPageBounds.clone()}),allBounds.push(commonPageBounds))}if(shapeClustersToPack.length<2)return this;let area=0;for(const{pageBounds}of shapeClustersToPack)area+=pageBounds.width*pageBounds.height;const commonBounds=Box.Common(allBounds),maxWidth=commonBounds.width;shapeClustersToPack.sort(((a,b)=>a.pageBounds.width-b.pageBounds.width)).sort(((a,b)=>a.pageBounds.height-b.pageBounds.height));const startWidth=Math.max(Math.ceil(Math.sqrt(area/.95)),maxWidth),spaces=[new Box(commonBounds.x,commonBounds.y,startWidth,1/0)];let space,last2,width=0,height=0;for(const{nextPageBounds}of shapeClustersToPack)for(let i=spaces.length-1;i>=0;i--)if(space=spaces[i],!(nextPageBounds.width>space.width||nextPageBounds.height>space.height)){nextPageBounds.x=space.x,nextPageBounds.y=space.y,height=Math.max(height,nextPageBounds.maxY),width=Math.max(width,nextPageBounds.maxX),nextPageBounds.width===space.width&&nextPageBounds.height===space.height?(last2=spaces.pop(),i<spaces.length&&(spaces[i]=last2)):nextPageBounds.height===space.height?(space.x+=nextPageBounds.width+gap,space.width-=nextPageBounds.width+gap):nextPageBounds.width===space.width?(space.y+=nextPageBounds.height+gap,space.height-=nextPageBounds.height+gap):(spaces.push(new Box(space.x+(nextPageBounds.width+gap),space.y,space.width-(nextPageBounds.width+gap),nextPageBounds.height)),space.y+=nextPageBounds.height+gap,space.height-=nextPageBounds.height+gap);break}const commonAfter=Box.Common(shapeClustersToPack.map((s=>s.nextPageBounds))),centerDelta=Vec.Sub(commonBounds.center,commonAfter.center),changes=[];for(const{shapes:shapes2,pageBounds,nextPageBounds}of shapeClustersToPack){const delta=Vec.Sub(nextPageBounds.point,pageBounds.point).add(centerDelta);for(const shape of shapes2){const shapeDelta=delta.clone();if(this.getShapeParent(shape)){const parentTransform=this.getShapeParentTransform(shape);parentTransform&&shapeDelta.rot(-parentTransform.rotation())}shapeDelta.add(shape),changes.push(this.getChangesToTranslateShape(shape,shapeDelta))}}return changes.length&&this.updateShapes(changes),this}alignShapes(shapes,operation){if(this.getIsReadonly())return this;const ids="string"==typeof shapes[0]?shapes:shapes.map((s=>s.id)),shapesToAlignFirstPass=(0,dist_esm.oE)(ids.map((id=>this.getShape(id)))),shapeClustersToAlign=[],allBounds=[],visited=new Set;for(const shape of shapesToAlignFirstPass){if(visited.has(shape.id))continue;visited.add(shape.id);const shapePageBounds=this.getShapePageBounds(shape);if(!shapePageBounds)continue;if(!this.getShapeUtil(shape).canBeLaidOut?.(shape,{type:"align",shapes:shapesToAlignFirstPass}))continue;const shapesMovingTogether=[shape],boundsOfShapesMovingTogether=[shapePageBounds];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(shape.id,"arrow"),initialShapes:shapesToAlignFirstPass,resultShapes:shapesMovingTogether,resultBounds:boundsOfShapesMovingTogether,visited});const commonPageBounds=Box.Common(boundsOfShapesMovingTogether);commonPageBounds&&(shapeClustersToAlign.push({shapes:shapesMovingTogether,pageBounds:commonPageBounds}),allBounds.push(commonPageBounds))}if(shapeClustersToAlign.length<2)return this;const commonBounds=Box.Common(allBounds),changes=[];return shapeClustersToAlign.forEach((({shapes:shapes2,pageBounds})=>{const delta=new Vec;switch(operation){case"top":delta.y=commonBounds.minY-pageBounds.minY;break;case"center-vertical":delta.y=commonBounds.midY-pageBounds.minY-pageBounds.height/2;break;case"bottom":delta.y=commonBounds.maxY-pageBounds.minY-pageBounds.height;break;case"left":delta.x=commonBounds.minX-pageBounds.minX;break;case"center-horizontal":delta.x=commonBounds.midX-pageBounds.minX-pageBounds.width/2;break;case"right":delta.x=commonBounds.maxX-pageBounds.minX-pageBounds.width}for(const shape of shapes2){const shapeDelta=delta.clone(),parent=this.getShapeParent(shape);if(parent){const parentTransform=this.getShapePageTransform(parent);parentTransform&&shapeDelta.rot(-parentTransform.rotation())}shapeDelta.add(shape),changes.push(this.getChangesToTranslateShape(shape,shapeDelta))}})),this.updateShapes(changes),this}distributeShapes(shapes,operation){if(this.getIsReadonly())return this;const ids="string"==typeof shapes[0]?shapes:shapes.map((s=>s.id)),shapesToDistributeFirstPass=(0,dist_esm.oE)(ids.map((id=>this.getShape(id)))),shapeClustersToDistribute=[],allBounds=[],visited=new Set;for(const shape of shapesToDistributeFirstPass){if(visited.has(shape.id))continue;visited.add(shape.id);const shapePageBounds=this.getShapePageBounds(shape);if(!shapePageBounds)continue;if(!this.getShapeUtil(shape).canBeLaidOut?.(shape,{type:"distribute",shapes:shapesToDistributeFirstPass}))continue;const shapesMovingTogether=[shape],boundsOfShapesMovingTogether=[shapePageBounds];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(shape.id,"arrow"),initialShapes:shapesToDistributeFirstPass,resultShapes:shapesMovingTogether,resultBounds:boundsOfShapesMovingTogether,visited});const commonPageBounds=Box.Common(boundsOfShapesMovingTogether);commonPageBounds&&(shapeClustersToDistribute.push({shapes:shapesMovingTogether,pageBounds:commonPageBounds}),allBounds.push(commonPageBounds))}if(shapeClustersToDistribute.length<3)return this;let val,min,max,dim;"horizontal"===operation?(val="x",min="minX",max="maxX",dim="width"):(val="y",min="minY",max="maxY",dim="height");const changes=[],first=shapeClustersToDistribute.sort(((a,b)=>a.pageBounds[min]-b.pageBounds[min]))[0],last2=shapeClustersToDistribute.sort(((a,b)=>b.pageBounds[max]-a.pageBounds[max]))[0];if(first===last2){const excludedShapeIds=new Set(first.shapes.map((s=>s.id)));return this.distributeShapes(ids.filter((id=>!excludedShapeIds.has(id))),operation)}const shapeClustersToMove=shapeClustersToDistribute.filter((shape=>shape!==first&&shape!==last2)).sort(((a,b)=>a.pageBounds[min]===b.pageBounds[min]?a.shapes[0].id<b.shapes[0].id?-1:1:a.pageBounds[min]-b.pageBounds[min])),maxFirst=first.pageBounds[max],gap=(last2.pageBounds[min]-maxFirst-shapeClustersToMove.reduce(((acc,s)=>acc+s.pageBounds[dim]),0))/(shapeClustersToMove.length+1);for(let v=maxFirst+gap,i=0;i<shapeClustersToMove.length;i++){const{shapes:shapes2,pageBounds}=shapeClustersToMove[i],delta=new Vec;delta[val]=v-pageBounds[val],v+pageBounds[dim]>last2.pageBounds[max]-1&&(delta[val]=last2.pageBounds[max]-pageBounds[max]-1);for(const shape of shapes2){const shapeDelta=delta.clone(),parent=this.getShapeParent(shape);if(parent){const parentTransform=this.getShapePageTransform(parent);parentTransform&&shapeDelta.rot(-parentTransform.rotation())}shapeDelta.add(shape),changes.push(this.getChangesToTranslateShape(shape,shapeDelta))}v+=pageBounds[dim]+gap}return this.updateShapes(changes),this}stretchShapes(shapes,operation){const ids="string"==typeof shapes[0]?shapes:shapes.map((s=>s.id));if(this.getIsReadonly())return this;const shapesToStretchFirstPass=(0,dist_esm.oE)(ids.map((id=>this.getShape(id)))).filter((s=>this.getShapePageTransform(s)?.rotation()%(utils_PI/2)==0)),shapeClustersToStretch=[],allBounds=[],visited=new Set;for(const shape of shapesToStretchFirstPass){if(visited.has(shape.id))continue;visited.add(shape.id);const shapePageBounds=this.getShapePageBounds(shape);if(!shapePageBounds)continue;const shapesMovingTogether=[shape],boundsOfShapesMovingTogether=[shapePageBounds];if(!this.getShapeUtil(shape).canBeLaidOut?.(shape,{type:"stretch",shapes:shapesToStretchFirstPass}))continue;this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(shape.id,"arrow"),initialShapes:shapesToStretchFirstPass,resultShapes:shapesMovingTogether,resultBounds:boundsOfShapesMovingTogether,visited});const commonPageBounds=Box.Common(boundsOfShapesMovingTogether);commonPageBounds&&(shapeClustersToStretch.push({shapes:shapesMovingTogether,pageBounds:commonPageBounds}),allBounds.push(commonPageBounds))}if(shapeClustersToStretch.length<2)return this;const commonBounds=Box.Common(allBounds);let val,min,dim;return"horizontal"===operation?(val="x",min="minX",dim="width"):(val="y",min="minY",dim="height"),this.run((()=>{shapeClustersToStretch.forEach((({shapes:shapes2,pageBounds})=>{const localOffset=new Vec;localOffset[val]=commonBounds[min]-pageBounds[min];const scaleOrigin=pageBounds.center.clone();scaleOrigin[val]=commonBounds[min];const scale=new Vec(1,1);scale[val]=commonBounds[dim]/pageBounds[dim];for(const shape of shapes2){const shapeLocalOffset=localOffset.clone(),parentTransform=this.getShapeParentTransform(shape);parentTransform&&localOffset.rot(-parentTransform.rotation()),shapeLocalOffset.add(shape);const changes=this.getChangesToTranslateShape(shape,shapeLocalOffset);this.updateShape(changes),this.resizeShape(shape.id,scale,{initialBounds:this.getShapeGeometry(shape).bounds,scaleOrigin,isAspectRatioLocked:this.getShapeUtil(shape).isAspectRatioLocked(shape),scaleAxisRotation:0})}}))})),this}resizeShape(shape,scale,opts={}){const id="string"==typeof shape?shape:shape.id;if(this.getIsReadonly())return this;Number.isFinite(scale.x)||(scale=new Vec(1,scale.y)),Number.isFinite(scale.y)||(scale=new Vec(scale.x,1));const initialShape=opts.initialShape??this.getShape(id);if(!initialShape)return this;const scaleOrigin=opts.scaleOrigin??this.getShapePageBounds(id)?.center;if(!scaleOrigin)return this;const pageTransform=opts.initialPageTransform?Mat.Cast(opts.initialPageTransform):this.getShapePageTransform(id);if(!pageTransform)return this;const pageRotation=pageTransform.rotation();if(null==pageRotation)return this;const scaleAxisRotation=opts.scaleAxisRotation??pageRotation,initialBounds=opts.initialBounds??this.getShapeGeometry(id).bounds;if(!initialBounds)return this;const isAspectRatioLocked=opts.isAspectRatioLocked??this.getShapeUtil(initialShape).isAspectRatioLocked(initialShape);if(!areAnglesCompatible(pageRotation,scaleAxisRotation))return this._resizeUnalignedShape(id,scale,{...opts,initialBounds,scaleOrigin,scaleAxisRotation,initialPageTransform:pageTransform,isAspectRatioLocked,initialShape});const util=this.getShapeUtil(initialShape);isAspectRatioLocked&&(scale=Math.abs(scale.x)>Math.abs(scale.y)?new Vec(scale.x,Math.sign(scale.y)*Math.abs(scale.x)):new Vec(Math.sign(scale.x)*Math.abs(scale.y),scale.y));let didResize=!1;if(util.onResize&&util.canResize(initialShape)){const newPagePoint=this._scalePagePoint(Mat.applyToPoint(pageTransform,new Vec(0,0)),scaleOrigin,scale,scaleAxisRotation),newLocalPoint=this.getPointInParentSpace(initialShape.id,newPagePoint),myScale=new Vec(scale.x,scale.y),areWidthAndHeightAlignedWithCorrectAxis=approximately((pageRotation-scaleAxisRotation)%Math.PI,0);myScale.x=areWidthAndHeightAlignedWithCorrectAxis?scale.x:scale.y,myScale.y=areWidthAndHeightAlignedWithCorrectAxis?scale.y:scale.x;const initialPagePoint=Mat.applyToPoint(pageTransform,new Vec),{x,y}=this.getPointInParentSpace(initialShape.id,initialPagePoint);let workingShape=initialShape;opts.skipStartAndEndCallbacks||(workingShape=applyPartialToRecordWithProps(initialShape,util.onResizeStart?.(initialShape)??void 0));const resizedShape=util.onResize({...initialShape,x,y},{newPoint:newLocalPoint,handle:opts.dragHandle??"bottom_right",mode:opts.mode??"scale_shape",scaleX:myScale.x,scaleY:myScale.y,initialBounds,initialShape});resizedShape&&(didResize=!0),workingShape=applyPartialToRecordWithProps(workingShape,{id,type:initialShape.type,x:newLocalPoint.x,y:newLocalPoint.y,...resizedShape}),opts.skipStartAndEndCallbacks||(workingShape=applyPartialToRecordWithProps(workingShape,util.onResizeEnd?.(initialShape,workingShape)??void 0)),this.updateShapes([workingShape])}if(!didResize){const initialPageCenter=Mat.applyToPoint(pageTransform,initialBounds.center),newPageCenter=this._scalePagePoint(initialPageCenter,scaleOrigin,scale,scaleAxisRotation),initialPageCenterInParentSpace=this.getPointInParentSpace(initialShape.id,initialPageCenter),newPageCenterInParentSpace=this.getPointInParentSpace(initialShape.id,newPageCenter),delta=Vec.Sub(newPageCenterInParentSpace,initialPageCenterInParentSpace);this.updateShapes([{id,type:initialShape.type,x:initialShape.x+delta.x,y:initialShape.y+delta.y}])}return this}_scalePagePoint(point,scaleOrigin,scale,scaleAxisRotation){const relativePoint=Vec.RotWith(point,scaleOrigin,-scaleAxisRotation).sub(scaleOrigin),newRelativePagePoint=Vec.MulV(relativePoint,scale);return Vec.Add(newRelativePagePoint,scaleOrigin).rotWith(scaleOrigin,scaleAxisRotation)}_resizeUnalignedShape(id,scale,options){const{type}=options.initialShape,shapeScale=new Vec(scale.x,scale.y);if(Math.abs(scale.x)>Math.abs(scale.y)?shapeScale.x=Math.sign(scale.x)*Math.abs(scale.y):shapeScale.y=Math.sign(scale.y)*Math.abs(scale.x),this.resizeShape(id,shapeScale,{initialShape:options.initialShape,initialBounds:options.initialBounds,isAspectRatioLocked:options.isAspectRatioLocked}),Math.sign(scale.x)*Math.sign(scale.y)<0){let{rotation}=Mat.Decompose(options.initialPageTransform);rotation-=2*rotation,this.updateShapes([{id,type,rotation}])}const preScaleShapePageCenter=Mat.applyToPoint(options.initialPageTransform,options.initialBounds.center),postScaleShapePageCenter=this._scalePagePoint(preScaleShapePageCenter,options.scaleOrigin,scale,options.scaleAxisRotation),pageBounds=this.getShapePageBounds(id),pageTransform=this.getShapePageTransform(id),currentPageCenter=pageBounds.center,shapePageTransformOrigin=pageTransform.point();if(!currentPageCenter||!shapePageTransformOrigin)return this;const pageDelta=Vec.Sub(postScaleShapePageCenter,currentPageCenter),postScaleShapePagePoint=Vec.Add(shapePageTransformOrigin,pageDelta),{x,y}=this.getPointInParentSpace(id,postScaleShapePagePoint);return this.updateShapes([{id,type,x,y}]),this}getInitialMetaForShape(_shape){return{}}createShape(shape){return this.createShapes([shape]),this}createShapes(shapes){if(!Array.isArray(shapes))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getIsReadonly())return this;if(shapes.length<=0)return this;const currentPageShapeIds=this.getCurrentPageShapeIds();if(shapes.length+currentPageShapeIds.size>this.options.maxShapesPerPage)return alertMaxShapes(this),this;const focusedGroupId=this.getFocusedGroupId();return this.run((()=>{const currentPageShapesSorted=this.getCurrentPageShapesSorted(),partials=shapes.map((partial=>{if(partial.id||(partial={id:createShapeId(),...partial}),!partial.parentId||!this.store.has(partial.parentId)&&!shapes.some((p=>p.id===partial.parentId))){let parentId=this.getFocusedGroupId();for(let i=currentPageShapesSorted.length-1;i>=0;i--){const parent=currentPageShapesSorted[i];if(!this.isShapeHidden(parent)&&this.getShapeUtil(parent).canReceiveNewChildrenOfType(parent,partial.type)&&this.isPointInShape(parent,{x:partial.x??0,y:partial.y??0},{margin:0,hitInside:!0})){parentId=parent.id;break}}const prevParentId=partial.parentId;if(parentId===partial.id&&(parentId=focusedGroupId),parentId!==prevParentId&&((partial={...partial}).parentId=parentId,isShapeId(parentId))){const point=this.getPointInShapeSpace(this.getShape(parentId),{x:partial.x??0,y:partial.y??0});partial.x=point.x,partial.y=point.y,partial.rotation=-this.getShapePageTransform(parentId).rotation()+(partial.rotation??0)}}return partial})),parentIndices=new Map,shapeRecordsToCreate=[],{opacityForNextShape}=this.getInstanceState();for(const partial of partials){const util=this.getShapeUtil(partial);let index=partial.index;if(!index){const parentId=partial.parentId??focusedGroupId;parentIndices.has(parentId)||parentIndices.set(parentId,this.getHighestIndexForParent(parentId)),index=parentIndices.get(parentId),parentIndices.set(parentId,(0,dist_esm.AQ)(index))}const initialProps=util.getDefaultProps();for(const[style,propKey]of this.styleProps[partial.type])initialProps[propKey]=this.getStyleForNextShape(style);let shapeRecordToCreate=this.store.schema.types.shape.create({...partial,index,opacity:partial.opacity??opacityForNextShape,parentId:partial.parentId??focusedGroupId,props:"props"in partial?{...initialProps,...partial.props}:initialProps});if(void 0===shapeRecordToCreate.index)throw Error("no index!");const next=this.getShapeUtil(shapeRecordToCreate).onBeforeCreate?.(shapeRecordToCreate);next&&(shapeRecordToCreate=next),shapeRecordsToCreate.push(shapeRecordToCreate)}shapeRecordsToCreate.forEach((shape=>{shape.meta={...this.getInitialMetaForShape(shape),...shape.meta}})),this.store.put(shapeRecordsToCreate)})),this}animateShape(partial,opts={animation:DEFAULT_ANIMATION_OPTIONS}){return this.animateShapes([partial],opts)}animateShapes(partials,opts={animation:DEFAULT_ANIMATION_OPTIONS}){if(!opts.animation)return this;const{duration=500,easing=EASINGS.linear}=opts.animation,animationId=(0,dist_esm.NF)();let t,remaining=duration;const animations=[];let partial,result;for(let i=0,n=partials.length;i<n;i++){if(partial=partials[i],!partial)continue;const shape=this.getShape(partial.id);shape&&(result={start:(0,dist_esm.pN)(shape),end:applyPartialToRecordWithProps((0,dist_esm.pN)(shape),partial)},animations.push(result),this.animatingShapes.set(shape.id,animationId))}const handleTick=elapsed=>{if(remaining-=elapsed,remaining<0){const{animatingShapes:animatingShapes2}=this,partialsToUpdate=partials.filter((p=>p&&animatingShapes2.get(p.id)===animationId));return partialsToUpdate.length&&this.updateShapes(partialsToUpdate),void this.off("tick",handleTick)}t=easing(1-remaining/duration);const{animatingShapes}=this,updates=[];let animationIdForShape;for(let i=0,n=animations.length;i<n;i++){const{start,end}=animations[i];animationIdForShape=animatingShapes.get(start.id),animationIdForShape===animationId&&updates.push({...end,x:start.x+(end.x-start.x)*t,y:start.y+(end.y-start.y)*t,opacity:start.opacity+(end.opacity-start.opacity)*t,rotation:start.rotation+(end.rotation-start.rotation)*t,props:this.getShapeUtil(end).getInterpolatedProps?.(start,end,t)??end.props})}this._updateShapes(updates)};return this.on("tick",handleTick),this}groupShapes(shapes,opts={}){const{groupId=createShapeId(),select=!0}=opts;if(!Array.isArray(shapes))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getIsReadonly())return this;const ids="string"==typeof shapes[0]?shapes:shapes.map((s=>s.id));if(ids.length<=1)return this;const shapesToGroup=(0,dist_esm.oE)((this._shouldIgnoreShapeLock?ids:this._getUnlockedShapeIds(ids)).map((id=>this.getShape(id)))),sortedShapeIds=shapesToGroup.sort(dist_esm.Ky).map((s=>s.id)),pageBounds=Box.Common((0,dist_esm.oE)(shapesToGroup.map((id=>this.getShapePageBounds(id))))),{x,y}=pageBounds.point,parentId=this.findCommonAncestor(shapesToGroup)??this.getCurrentPageId();if("select"!==this.getCurrentToolId())return this;this.isIn("select.idle")||this.cancel();const shapesWithRootParent=shapesToGroup.filter((shape=>shape.parentId===parentId)).sort(dist_esm.Ky),highestIndex=shapesWithRootParent[shapesWithRootParent.length-1]?.index;return this.run((()=>{this.createShapes([{id:groupId,type:"group",parentId,index:highestIndex,x,y,opacity:1,props:{}}]),this.reparentShapes(sortedShapeIds,groupId),select&&this.select(groupId)})),this}ungroupShapes(shapes,opts={}){if(this.getIsReadonly())return this;const{select=!0}=opts,ids="string"==typeof shapes[0]?shapes:shapes.map((s=>s.id)),shapesToUngroup=(0,dist_esm.oE)((this._shouldIgnoreShapeLock?ids:this._getUnlockedShapeIds(ids)).map((id=>this.getShape(id))));if(0===shapesToUngroup.length)return this;if("select"!==this.getCurrentToolId())return this;this.isIn("select.idle")||this.cancel();const idsToSelect=new Set,groups=[];return shapesToUngroup.forEach((shape=>{this.isShapeOfType(shape,"group")?groups.push(shape):idsToSelect.add(shape.id)})),0===groups.length||this.run((()=>{let group;for(let i=0,n=groups.length;i<n;i++){group=groups[i];const childIds=this.getSortedChildIdsForParent(group.id);for(let j=0,n2=childIds.length;j<n2;j++)idsToSelect.add(childIds[j]);this.reparentShapes(childIds,group.parentId,group.index)}this.deleteShapes(groups.map((group2=>group2.id))),select&&this.select(...idsToSelect)})),this}updateShape(partial){return this.updateShapes([partial]),this}updateShapes(partials){const compactedPartials=Array(partials.length);for(let i=0,n=partials.length;i<n;i++){const partial=partials[i];if(!partial)continue;const shape=this.getShape(partial.id);if(shape){if(!this._shouldIgnoreShapeLock)if(shape.isLocked){if(!Object.hasOwn(partial,"isLocked")||partial.isLocked)continue}else if(this.isShapeOrAncestorLocked(shape))continue;this.animatingShapes.delete(partial.id),compactedPartials.push(partial)}}return this._updateShapes(compactedPartials),this}_updateShapes(_partials){this.getIsReadonly()||this.run((()=>{const updates=[];let shape,updated;for(let i=0,n=_partials.length;i<n;i++){const partial=_partials[i];partial&&(shape=this.getShape(partial.id),shape&&(updated=applyPartialToRecordWithProps(shape,partial),updated!==shape&&(updated=this.getShapeUtil(shape).onBeforeUpdate?.(shape,updated)??updated,updates.push(updated))))}this.store.put(updates)}))}_getUnlockedShapeIds(ids){return ids.filter((id=>!this.getShape(id)?.isLocked))}deleteShapes(_ids){if(this.getIsReadonly())return this;if(!Array.isArray(_ids))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");const shapeIds="string"==typeof _ids[0]?_ids:_ids.map((s=>s.id)),shapeIdsToDelete=this._shouldIgnoreShapeLock?shapeIds:this._getUnlockedShapeIds(shapeIds);if(0===shapeIdsToDelete.length)return this;const allShapeIdsToDelete=new Set(shapeIdsToDelete);for(const id of shapeIdsToDelete)this.visitDescendants(id,(childId=>{allShapeIdsToDelete.add(childId)}));return this.run((()=>this.store.remove([...allShapeIdsToDelete])))}deleteShape(_id){return this.deleteShapes(["string"==typeof _id?_id:_id.id]),this}_extractSharedStyles(shape,sharedStyleMap){if(this.isShapeOfType(shape,"group")){const childIds=this._parentIdsToChildIds.get()[shape.id];if(!childIds)return;for(let i=0,n=childIds.length;i<n;i++)this._extractSharedStyles(this.getShape(childIds[i]),sharedStyleMap)}else for(const[style,propKey]of this.styleProps[shape.type])sharedStyleMap.applyValue(style,(0,dist_esm.g5)(shape.props,propKey))}_getSelectionSharedStyles(){const selectedShapes=this.getSelectedShapes(),sharedStyles=new SharedStyleMap;for(const selectedShape of selectedShapes)this._extractSharedStyles(selectedShape,sharedStyles);return sharedStyles}getStyleForNextShape(style){const value=this.getInstanceState().stylesForNextShape[style.id];return void 0===value?style.defaultValue:value}getShapeStyleIfExists(shape,style){const styleKey=this.styleProps[shape.type].get(style);if(void 0!==styleKey)return(0,dist_esm.g5)(shape.props,styleKey)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();const currentTool=this.root.getCurrent(),styles=new SharedStyleMap;if(!currentTool)return styles;if(currentTool.shapeType)if("frame"!==currentTool.shapeType||this.getShapeUtil("frame").options.showColors)for(const style of this.styleProps[currentTool.shapeType].keys())styles.applyValue(style,this.getStyleForNextShape(style));else for(const style of this.styleProps[currentTool.shapeType].keys())"tldraw:color"!==style.id&&styles.applyValue(style,this.getStyleForNextShape(style));return styles}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const shapesToCheck=[],addShape=shapeId=>{const shape=this.getShape(shapeId);if(shape)if(this.isShapeOfType(shape,"group"))for(const childId of this.getSortedChildIdsForParent(shape.id))addShape(childId);else shapesToCheck.push(shape)};for(const shapeId of this.getSelectedShapeIds())addShape(shapeId);let opacity=null;for(const shape of shapesToCheck)if(null===opacity)opacity=shape.opacity;else if(opacity!==shape.opacity)return{type:"mixed"};if(null!==opacity)return{type:"shared",value:opacity}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(opacity,historyOptions){return this.updateInstanceState({opacityForNextShape:opacity},historyOptions),this}setOpacityForSelectedShapes(opacity){const selectedShapes=this.getSelectedShapes();if(selectedShapes.length>0){const shapesToUpdate=[],addShapeById=shape=>{if(this.isShapeOfType(shape,"group")){const childIds=this.getSortedChildIdsForParent(shape);for(const childId of childIds)addShapeById(this.getShape(childId))}else shapesToUpdate.push(shape)};for(const id of selectedShapes)addShapeById(id);this.updateShapes(shapesToUpdate.map((shape=>({id:shape.id,type:shape.type,opacity}))))}return this}setStyleForNextShapes(style,value,historyOptions){const stylesForNextShape=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...stylesForNextShape,[style.id]:value}},historyOptions),this}setStyleForSelectedShapes(style,value){const selectedShapes=this.getSelectedShapes();if(selectedShapes.length>0){const updates=[],addShapeById=shape=>{if(this.isShapeOfType(shape,"group")){const childIds=this.getSortedChildIdsForParent(shape.id);for(const childId of childIds)addShapeById(this.getShape(childId))}else{const util=this.getShapeUtil(shape),stylePropKey=this.styleProps[shape.type].get(style);if(stylePropKey){const shapePartial={id:shape.id,type:shape.type,props:{[stylePropKey]:value}};updates.push({util,originalShape:shape,updatePartial:shapePartial})}}};for(const shape of selectedShapes)addShapeById(shape);this.updateShapes(updates.map((({updatePartial})=>updatePartial)))}return this}registerExternalAssetHandler(type,handler){return this.externalAssetContentHandlers[type]=handler,this}createTemporaryAssetPreview(assetId,file){if(this.temporaryAssetPreview.has(assetId))return this.temporaryAssetPreview.get(assetId);const objectUrl=URL.createObjectURL(file);return this.temporaryAssetPreview.set(assetId,objectUrl),setTimeout((()=>{this.temporaryAssetPreview.delete(assetId),URL.revokeObjectURL(objectUrl)}),this.options.temporaryAssetPreviewLifetimeMs),objectUrl}getTemporaryAssetPreview(assetId){return this.temporaryAssetPreview.get(assetId)}async getAssetForExternalContent(info){return await(this.externalAssetContentHandlers[info.type]?.(info))}hasExternalAssetHandler(type){return!!this.externalAssetContentHandlers[type]}registerExternalContentHandler(type,handler){return this.externalContentHandlers[type]=handler,this}async putExternalContent(info){return this.externalContentHandlers[info.type]?.(info)}getContentFromCurrentPage(shapes){const ids="string"==typeof shapes[0]?shapes:shapes.map((s=>s.id));if(!ids)return;if(0===ids.length)return;const shapeIds=this.getShapeAndDescendantIds(ids);return withIsolatedShapes(this,shapeIds,(bindingIdsToKeep=>{const bindings=[];for(const id of bindingIdsToKeep){const binding=this.getBinding(id);binding&&bindings.push(binding)}const rootShapeIds=[],shapes2=[];for(const shapeId of shapeIds){const shape=this.getShape(shapeId);if(!shape)continue;if(!shapeIds.has(shape.parentId)){const pageTransform=this.getShapePageTransform(shape.id),pagePoint=pageTransform.point();shapes2.push({...shape,x:pagePoint.x,y:pagePoint.y,rotation:pageTransform.rotation(),parentId:this.getCurrentPageId()}),rootShapeIds.push(shape.id)}else shapes2.push(shape)}const assets=[],seenAssetIds=new Set;for(const shape of shapes2){if(!("assetId"in shape.props))continue;const assetId=shape.props.assetId;if(!assetId||seenAssetIds.has(assetId))continue;seenAssetIds.add(assetId);const asset=this.getAsset(assetId);asset&&assets.push(asset)}return{schema:this.store.schema.serialize(),shapes:shapes2,rootShapeIds,bindings,assets}}))}async resolveAssetsInContent(content){if(!content)return;const assets=[];return await Promise.allSettled(content.assets.map((async asset=>{if("image"!==asset.type&&"video"!==asset.type||asset.props.src?.startsWith("data:image")||asset.props.src?.startsWith("data:video")||asset.props.src?.startsWith("http"))assets.push(asset);else{const assetWithDataUrl=(0,dist_esm.pN)(asset),objectUrl=await this.store.props.assets.resolve(asset,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginal:!0});assetWithDataUrl.props.src=await dist_esm.Sm.blobToDataUrl(await(0,dist_esm.hd)(objectUrl).then((r=>r.blob()))),assets.push(assetWithDataUrl)}}))),content.assets=assets,content}putContentOntoCurrentPage(content,opts={}){if(this.getIsReadonly())return this;if(!content.schema)throw Error("Could not put content:\ncontent is missing a schema.");const{select=!1,preserveIds=!1,preservePosition=!1}=opts;let{point}=opts;const currentPageId=this.getCurrentPageId(),{rootShapeIds}=content,assets=[],shapes=[],bindings=[],store={store:{...Object.fromEntries(content.assets.map((asset=>[asset.id,asset]))),...Object.fromEntries(content.shapes.map((shape=>[shape.id,shape]))),...Object.fromEntries(content.bindings?.map((bindings2=>[bindings2.id,bindings2]))??[])},schema:content.schema},result=this.store.schema.migrateStoreSnapshot(store);if("error"===result.type)throw Error("Could not put content: could not migrate content");for(const record of Object.values(result.value))switch(record.typeName){case"asset":assets.push(record);break;case"shape":shapes.push(record);break;case"binding":bindings.push(record)}const shapeIdMap=new Map(preserveIds?shapes.map((shape=>[shape.id,shape.id])):shapes.map((shape=>[shape.id,createShapeId()]))),bindingIdMap=new Map(preserveIds?bindings.map((binding=>[binding.id,binding.id])):bindings.map((binding=>[binding.id,createBindingId()])));let pasteParentId=this.getCurrentPageId(),lowestDepth=1/0,lowestAncestors=[];for(const shape of this.getSelectedShapes()){if(0===lowestDepth)break;const isFrame=this.isShapeOfType(shape,"frame"),ancestors=this.getShapeAncestors(shape);isFrame&&ancestors.push(shape);const depth=isFrame?ancestors.length+1:ancestors.length;if(depth<lowestDepth)lowestDepth=depth,lowestAncestors=ancestors,pasteParentId=isFrame?shape.id:shape.parentId;else if(depth===lowestDepth){if(lowestAncestors.length!==ancestors.length)throw Error(`Ancestors: ${lowestAncestors.length} !== ${ancestors.length}`);if(0===lowestAncestors.length){pasteParentId=currentPageId;break}pasteParentId=currentPageId;for(let i=0;i<lowestAncestors.length&&ancestors[i]===lowestAncestors[i];i++)pasteParentId=ancestors[i].id}}let isDuplicating=!1;if(!isPageId(pasteParentId)){const parent=this.getShape(pasteParentId);if(parent)if(this.getViewportPageBounds().includes(this.getShapePageBounds(parent))){if(1===rootShapeIds.length){const rootShape=shapes.find((s=>s.id===rootShapeIds[0]));this.isShapeOfType(parent,"frame")&&this.isShapeOfType(rootShape,"frame")&&rootShape.props.w===parent?.props.w&&rootShape.props.h===parent?.props.h&&(isDuplicating=!0)}}else pasteParentId=currentPageId;else pasteParentId=currentPageId}isDuplicating||(isDuplicating=shapeIdMap.has(pasteParentId)),isDuplicating&&(pasteParentId=this.getShape(pasteParentId).parentId);let index=this.getHighestIndexForParent(pasteParentId);const rootShapes=[],newShapes=shapes.map((oldShape=>{const newId=shapeIdMap.get(oldShape.id),newShape={...oldShape,id:newId};return rootShapeIds.includes(oldShape.id)&&(newShape.parentId=currentPageId,rootShapes.push(newShape)),shapeIdMap.has(newShape.parentId)?newShape.parentId=shapeIdMap.get(oldShape.parentId):(rootShapeIds.push(newShape.id),newShape.index=index,index=(0,dist_esm.AQ)(index)),newShape}));if(newShapes.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return alertMaxShapes(this),this;const newBindings=bindings.map((oldBinding=>({...oldBinding,id:(0,dist_esm.Z1)(bindingIdMap.get(oldBinding.id)),fromId:(0,dist_esm.Z1)(shapeIdMap.get(oldBinding.fromId)),toId:(0,dist_esm.Z1)(shapeIdMap.get(oldBinding.toId))}))),assetsToCreate=[],assetsToUpdate=[];for(const asset of assets)this.store.has(asset.id)||(("image"===asset.type&&asset.props.src?.startsWith("data:image")||"video"===asset.type&&asset.props.src?.startsWith("data:video"))&&(assetsToUpdate.push((0,dist_esm.pN)(asset)),asset.props.src=null),assetsToCreate.push(asset));return Promise.allSettled(assetsToUpdate.map((async asset=>{const file=await function dataUrlToFile(url,filename,mimeType){return(0,dist_esm.hd)(url).then((function(res){return res.arrayBuffer()})).then((function(buf){return new File([buf],filename,{type:mimeType})}))}(asset.props.src,asset.props.name,asset.props.mimeType??"image/png"),newAsset=await this.getAssetForExternalContent({type:"file",file,assetId:asset.id});newAsset?this.updateAssets([{...newAsset,id:asset.id}]):this.deleteAssets([asset.id])}))),this.run((()=>{assetsToCreate.length>0&&this.createAssets(assetsToCreate),this.createShapes(newShapes),this.createBindings(newBindings),select&&this.select(...rootShapes.map((s=>s.id))),pasteParentId!==currentPageId&&this.reparentShapes(rootShapes.map((s=>s.id)),pasteParentId);const newCreatedShapes=newShapes.map((s=>this.getShape(s.id))),bounds=Box.Common(newCreatedShapes.map((s=>this.getShapePageBounds(s))));if(void 0===point)if(isPageId(pasteParentId)){const viewportPageBounds=this.getViewportPageBounds();point=preservePosition||viewportPageBounds.includes(Box.From(bounds))?bounds.center:viewportPageBounds.center}else{const shape=this.getShape(pasteParentId);point=Mat.applyToPoint(this.getShapePageTransform(shape),this.getShapeGeometry(shape).bounds.center)}if(1===rootShapes.length){const onlyRoot=rootShapes[0];if(this.isShapeOfType(onlyRoot,"frame"))for(;this.getShapesAtPoint(point).some((shape=>this.isShapeOfType(shape,"frame")&&shape.props.w===onlyRoot.props.w&&shape.props.h===onlyRoot.props.h));)point.x+=bounds.w+16}const pageCenter=Box.Common((0,dist_esm.oE)(rootShapes.map((({id})=>this.getShapePageBounds(id))))).center,offset=Vec.Sub(point,pageCenter);this.updateShapes(rootShapes.map((({id})=>{const s=this.getShape(id),localRotation=this.getShapeParentTransform(id).decompose().rotation,localDelta=Vec.Rot(offset,-localRotation);return{id:s.id,type:s.type,x:s.x+localDelta.x,y:s.y+localDelta.y}})))})),this}async getSvgElement(shapes,opts={}){const ids=0===shapes.length?this.getCurrentPageShapeIdsSorted():"string"==typeof shapes[0]?shapes:shapes.map((s=>s.id));if(0!==ids.length)return exportToSvg(this,ids,opts)}async getSvgString(shapes,opts={}){const result=await this.getSvgElement(shapes,opts);if(!result)return;return{svg:(new XMLSerializer).serializeToString(result.svg),width:result.width,height:result.height}}async getSvg(shapes,opts={}){const result=await this.getSvgElement(shapes,opts);if(result)return result.svg}async toImage(shapes,opts={}){const withDefaults={format:"png",scale:1,pixelRatio:"svg"===opts.format?void 0:2,...opts},result=await this.getSvgString(shapes,withDefaults);if(!result)throw new Error("Could not create SVG");switch(withDefaults.format){case"svg":return{blob:new Blob([result.svg],{type:"image/svg+xml"}),width:result.width,height:result.height};case"jpeg":case"png":case"webp":{const blob=await async function getSvgAsImage(svgString,options){const{type,width,height,quality=1,pixelRatio=2}=options;let[clampedWidth,clampedHeight]=clampToBrowserMaxCanvasSize(width*pixelRatio,height*pixelRatio);clampedWidth=Math.floor(clampedWidth),clampedHeight=Math.floor(clampedHeight);const effectiveScale=clampedWidth/width,svgUrl=await dist_esm.Sm.blobToDataUrl(new Blob([svgString],{type:"image/svg+xml"})),canvas=await new Promise((resolve=>{const image=(0,dist_esm._V)();image.crossOrigin="anonymous",image.onload=async()=>{tlenv.isSafari&&await(0,dist_esm.yy)(250);const canvas2=document.createElement("canvas"),ctx=canvas2.getContext("2d");canvas2.width=clampedWidth,canvas2.height=clampedHeight,ctx.imageSmoothingEnabled=!0,ctx.imageSmoothingQuality="high",ctx.drawImage(image,0,0,clampedWidth,clampedHeight),URL.revokeObjectURL(svgUrl),resolve(canvas2)},image.onerror=()=>{resolve(null)},image.src=svgUrl}));if(!canvas)return null;const blob=await new Promise((resolve=>canvas.toBlob((blob2=>{blob2&&!debugFlags.throwToBlob.get()||resolve(null),resolve(blob2)}),"image/"+type,quality)));if(!blob)return null;if("png"===type){const view=new DataView(await blob.arrayBuffer());return dist_esm.ZA.setPhysChunk(view,effectiveScale,{type:"image/"+type})}return blob}(result.svg,{type:withDefaults.format,quality:withDefaults.quality,pixelRatio:withDefaults.pixelRatio,width:result.width,height:result.height});if(!blob)throw new Error("Could not construct image.");return{blob,width:result.width,height:result.height}}default:(0,dist_esm.h6)(withDefaults.format)}}_updateInputsFromEvent(info){const{pointerVelocity,previousScreenPoint,previousPagePoint,currentScreenPoint,currentPagePoint}=this.inputs,{screenBounds}=this.store.unsafeGetWithoutCapture(TLInstance_TLINSTANCE_ID),{x:cx,y:cy,z:cz}=(0,state_dist_esm.Pm)((()=>this.getCamera())),sx=info.point.x-screenBounds.x,sy=info.point.y-screenBounds.y,sz=info.point.z??.5;previousScreenPoint.setTo(currentScreenPoint),previousPagePoint.setTo(currentPagePoint),currentScreenPoint.set(sx,sy);const nx=sx/cz-cx,ny=sy/cz-cy;isFinite(nx)&&isFinite(ny)&&currentPagePoint.set(nx,ny,sz),this.inputs.isPen="pointer"===info.type&&info.isPen,("pointer_down"===info.name||this.inputs.isPinching)&&(pointerVelocity.set(0,0),this.inputs.originScreenPoint.setTo(currentScreenPoint),this.inputs.originPagePoint.setTo(currentPagePoint)),this.run((()=>{this.store.put([{id:TLPointer_TLPOINTER_ID,typeName:"pointer",x:currentPagePoint.x,y:currentPagePoint.y,lastActivityTimestamp:"pointer"===info.type&&info.pointerId===INTERNAL_POINTER_IDS_CAMERA_MOVE?this.store.unsafeGetWithoutCapture(TLPointer_TLPOINTER_ID)?.lastActivityTimestamp??this._tickManager.now:this._tickManager.now,meta:{}}])}),{history:"ignore"})}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}focus({focusContainer=!0}={}){return this.getIsFocused()||(focusContainer&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0})),this}blur({blurContainer=!0}={}){return this.getIsFocused()?(blurContainer?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1}),this):this}getIsFocused(){return this.getInstanceState().isFocused}getIsReadonly(){return this.getInstanceState().isReadonly}getSnapshot(){return getSnapshot(this.store)}loadSnapshot(snapshot,opts){return loadSnapshot(this.store,snapshot,opts),this}_zoomToFitPageContentAt100Percent(){const bounds=this.getCurrentPageBounds();bounds&&this.zoomToBounds(bounds,{immediate:!0,targetZoom:this.getBaseZoom()})}_navigateToDeepLink(deepLink){this.run((()=>{switch(deepLink.type){case"page":{const page=this.getPage(deepLink.pageId);return page&&this.setCurrentPage(page),void this._zoomToFitPageContentAt100Percent()}case"shapes":{const allShapes=(0,dist_esm.oE)(deepLink.shapeIds.map((id=>this.getShape(id)))),byPage={};for(const shape of allShapes){const pageId2=this.getAncestorPageId(shape);pageId2&&(byPage[pageId2]??=[],byPage[pageId2].push(shape))}const[pageId,shapes]=Object.entries(byPage).sort((([_,a],[__,b])=>b.length-a.length))[0]??["",[]];if(pageId&&shapes.length){this.setCurrentPage(pageId);const bounds=Box.Common(shapes.map((s=>this.getShapePageBounds(s))));this.zoomToBounds(bounds,{immediate:!0,targetZoom:this.getBaseZoom()})}else this._zoomToFitPageContentAt100Percent();return}case"viewport":if(deepLink.pageId){if(!this.getPage(deepLink.pageId))return void this._zoomToFitPageContentAt100Percent();this.setCurrentPage(deepLink.pageId)}return void this.zoomToBounds(deepLink.bounds,{immediate:!0,inset:0});default:(0,dist_esm.h6)(deepLink)}}))}navigateToDeepLink(opts){if(opts&&"type"in opts)return this._navigateToDeepLink(opts),this;const deepLinkString=new URL(opts?.url??window.location.href).searchParams.get(opts?.param??"d");if(!deepLinkString)return this._zoomToFitPageContentAt100Percent(),this;try{this._navigateToDeepLink(function parseDeepLinkString(deepLinkString){switch(deepLinkString[0]){case"s":return{type:"shapes",shapeIds:deepLinkString.slice(1).split(".").filter(Boolean).map((id=>createShapeId(decodeURIComponent(id))))};case"p":return{type:"page",pageId:PageRecordType.createId(decodeURIComponent(deepLinkString.slice(1)))};case"v":{const[x,y,w,h,pageId]=deepLinkString.slice(1).split(".");return{type:"viewport",bounds:new Box(Number(x),Number(y),Number(w),Number(h)),pageId:pageId?PageRecordType.createId(decodeURIComponent(pageId)):void 0}}default:throw Error("Invalid deep link string")}}(deepLinkString))}catch(e){console.warn(e),this._zoomToFitPageContentAt100Percent()}return this}createDeepLink(opts){const url=new URL(opts?.url??window.location.href);return url.searchParams.set(opts?.param??"d",function createDeepLinkString(deepLink){switch(deepLink.type){case"shapes":return`s${deepLink.shapeIds.map((id=>encodeId(id.slice(6)))).join(".")}`;case"page":return"p"+encodeId(PageRecordType.parseId(deepLink.pageId));case"viewport":{const{bounds,pageId}=deepLink;let res=`v${Math.round(bounds.x)}.${Math.round(bounds.y)}.${Math.round(bounds.w)}.${Math.round(bounds.h)}`;return pageId&&(res+="."+encodeId(PageRecordType.parseId(pageId))),res}default:(0,dist_esm.h6)(deepLink)}}(opts?.to??{type:"viewport",pageId:1===this.options.maxPages?void 0:this.getCurrentPageId(),bounds:this.getViewportPageBounds()})),url}registerDeepLinkListener(opts){if(opts?.getUrl&&!opts?.onChange)throw Error("[tldraw:urlStateSync] If you specify getUrl, you must also specify the onChange callback.");const url$=(0,state_dist_esm.EW)("url with state",(()=>{const url=opts?.getUrl?.(this)??window.location.href;return this.createDeepLink({param:opts?.param,url,to:opts?.getTarget?.(this)}).toString()})),announceChange=opts?.onChange??(()=>{const url=this.createDeepLink({param:opts?.param,to:opts?.getTarget?.(this)});window.history.replaceState({},document.title,url.toString())}),scheduleEffect=(0,dist_esm.sg)((execute=>execute()),opts?.debounceMs??500),unlisten=(0,state_dist_esm.wv)("update url on state change",(()=>announceChange(new URL(url$.get()),this)),{scheduleEffect});return()=>{unlisten(),scheduleEffect.cancel()}}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_setShiftKeyTimeout(){this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:isAccelKey(this.inputs),code:"ShiftLeft"})}_setAltKeyTimeout(){this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:isAccelKey(this.inputs),code:"AltLeft"})}_setCtrlKeyTimeout(){this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:isAccelKey(this.inputs),code:"ControlLeft"})}_setMetaKeyTimeout(){this.inputs.metaKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Meta",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:isAccelKey(this.inputs),code:"MetaLeft"})}dispatch(info){return this._pendingEventsForNextTick.push(info),"pointer"===info.type&&"pointer_move"===info.name||"wheel"===info.type||"pinch"===info.type||this._flushEventsForTick(0),this}_flushEventsForTick(elapsed){this.run((()=>{if(this._pendingEventsForNextTick.length>0){const events=[...this._pendingEventsForNextTick];this._pendingEventsForNextTick.length=0;for(const info of events)this._flushEventForTick(info)}elapsed>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed}),this.scribbles.tick(elapsed)}))}_flushEventForTick(info){if(this.getCrashingError())return this;this.emit("before-event",info);const{inputs}=this,{type}=info;if("misc"===info.type)return"cancel"!==info.name&&"complete"!==info.name||(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),void this.root.handleEvent(info);info.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,inputs.shiftKey=!0):!info.shiftKey&&inputs.shiftKey&&-1===this._shiftKeyTimeout&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),info.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,inputs.altKey=!0):!info.altKey&&inputs.altKey&&-1===this._altKeyTimeout&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),info.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,inputs.ctrlKey=!0):!info.ctrlKey&&inputs.ctrlKey&&-1===this._ctrlKeyTimeout&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150)),info.metaKey?(clearTimeout(this._metaKeyTimeout),this._metaKeyTimeout=-1,inputs.metaKey=!0):!info.metaKey&&inputs.metaKey&&-1===this._metaKeyTimeout&&(this._metaKeyTimeout=this.timers.setTimeout(this._setMetaKeyTimeout,150));const{originPagePoint,currentPagePoint}=inputs;inputs.isPointing||(inputs.isDragging=!1);const instanceState=this.store.unsafeGetWithoutCapture(TLInstance_TLINSTANCE_ID),pageState=this.store.get(this._getCurrentPageStateId()),cameraOptions=this._cameraOptions.__unsafe__getWithoutCapture();switch(type){case"pinch":if(cameraOptions.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(info),info.name){case"pinch_start":if(inputs.isPinching)return;return void(inputs.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...pageState.selectedShapeIds]),this._didPinch=!0,inputs.isPinching=!0,this.interrupt()));case"pinch":{if(!inputs.isPinching)return;const{point:{z=1},delta:{x:dx,y:dy}}=info,{x,y}=Vec.SubXY(info.point,instanceState.screenBounds.x,instanceState.screenBounds.y);this.stopCameraAnimation(),instanceState.followingUserId&&this.stopFollowingUser();const{x:cx,y:cy,z:cz}=(0,state_dist_esm.Pm)((()=>this.getCamera())),{panSpeed}=cameraOptions;return void this._setCamera(new Vec(cx+dx*panSpeed/cz-x/cz+x/z,cy+dy*panSpeed/cz-y/cz+y/z,z),{immediate:!0})}case"pinch_end":{if(!inputs.isPinching)return this;inputs.isPinching=!1;const{_selectedShapeIdsAtPointerDown:shapesToReselect}=this;return this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],void(this._didPinch&&(this._didPinch=!1,shapesToReselect.length>0&&this.once("tick",(()=>{this._didPinch||this.setSelectedShapes(shapesToReselect)}))))}}case"wheel":{if(cameraOptions.isLocked)return;this._updateInputsFromEvent(info);const{panSpeed,zoomSpeed,wheelBehavior}=cameraOptions;if("none"!==wheelBehavior){this.stopCameraAnimation(),instanceState.followingUserId&&this.stopFollowingUser();const{x:cx,y:cy,z:cz}=(0,state_dist_esm.Pm)((()=>this.getCamera())),{x:dx,y:dy,z:dz=0}=info.delta;let behavior=wheelBehavior;switch(info.ctrlKey&&(behavior="pan"===wheelBehavior?"zoom":"pan"),behavior){case"zoom":{const{x,y}=this.inputs.currentScreenPoint;let delta=dz;"zoom"===wheelBehavior&&(delta=Math.abs(dy)>10?10*Math.sign(dy)/100:dy/100);const zoom=cz+(delta??0)*zoomSpeed*cz;return this._setCamera(new Vec(cx+x/zoom-x/cz,cy+y/zoom-y/cz,zoom),{immediate:!0}),void this.maybeTrackPerformance("Zooming")}case"pan":return this._setCamera(new Vec(cx+dx*panSpeed/cz,cy+dy*panSpeed/cz,cz),{immediate:!0}),void this.maybeTrackPerformance("Panning")}}break}case"pointer":{if(inputs.isPinching)return;this._updateInputsFromEvent(info);const{isPen}=info,{isPenMode}=instanceState;switch(info.name){case"pointer_down":if(isPenMode&&!isPen)return;if(this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout((()=>{const vsb=this.getViewportScreenBounds();this.dispatch({...info,point:this.inputs.originScreenPoint.clone().addXY(vsb.x,vsb.y),name:"long_press"})}),this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),0===info.button&&(this.capturedPointerId=info.pointerId),inputs.buttons.add(info.button),inputs.isPointing=!0,inputs.isDragging=!1,!isPenMode&&isPen&&this.updateInstanceState({isPenMode:!0}),5===info.button?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):1===info.button&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break;case"pointer_move":{if(!isPen&&isPenMode)return;const{x:cx,y:cy,z:cz}=(0,state_dist_esm.Pm)((()=>this.getCamera()));if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint,previousScreenPoint}=this.inputs,offset=Vec.Sub(currentScreenPoint,previousScreenPoint);return this.setCamera(new Vec(cx+offset.x/cz,cy+offset.y/cz,cz),{immediate:!0}),void this.maybeTrackPerformance("Panning")}inputs.isPointing&&!inputs.isDragging&&Vec.Dist2(originPagePoint,currentPagePoint)*this.getZoomLevel()>(instanceState.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/cz&&(inputs.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":if(inputs.isDragging=!1,inputs.isPointing=!1,clearTimeout(this._longPressTimeout),inputs.buttons.delete(info.button),instanceState.isPenMode&&!isPen)return;if(this.capturedPointerId===info.pointerId&&(this.capturedPointerId=null,info.button=0),inputs.isPanning){inputs.keys.has("Space")||(inputs.isPanning=!1,inputs.isSpacebarPanning=!1);const slideDirection=this.inputs.pointerVelocity,slideSpeed=Math.min(2,slideDirection.len());switch(info.button){case 0:this.setCursor({type:"grab",rotation:0});break;case 1:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}slideSpeed>0&&this.slideCamera({speed:slideSpeed,direction:slideDirection})}else 5===info.button&&(this.complete(),this.setCurrentTool(this._restoreToolId))}break}case"keyboard":switch("ShiftRight"===info.key&&(info.key="ShiftLeft"),"AltRight"===info.key&&(info.key="AltLeft"),"ControlRight"===info.code&&(info.code="ControlLeft"),"MetaRight"===info.code&&(info.code="MetaLeft"),info.name){case"key_down":if(inputs.keys.add(info.code),"Space"!==info.code||info.ctrlKey||(this.inputs.isPanning||(this._prevCursor=instanceState.cursor.type),this.inputs.isPanning=!0,this.inputs.isSpacebarPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0})),this.inputs.isSpacebarPanning){let offset;switch(info.code){case"ArrowUp":offset=new Vec(0,-1);break;case"ArrowRight":offset=new Vec(1,0);break;case"ArrowDown":offset=new Vec(0,1);break;case"ArrowLeft":offset=new Vec(-1,0)}if(offset){const bounds=this.getViewportPageBounds(),next=bounds.clone().translate(offset.mulV({x:bounds.w,y:bounds.h}));this._animateToViewport(next,{animation:{duration:320}})}}break;case"key_up":inputs.keys.delete(info.code),"Space"===info.code&&(this.inputs.buttons.has(1)||(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})))}}if("pointer"===info.type){1===info.button?info.name="middle_click":info.button===RIGHT_MOUSE_BUTTON&&(info.name="right_click");const{isPenMode}=this.store.unsafeGetWithoutCapture(TLInstance_TLINSTANCE_ID);if(info.isPen===isPenMode){const clickInfo=this._clickManager.handlePointerEvent(info);if(info.name!==clickInfo.name)return this.root.handleEvent(info),this.emit("event",info),this.root.handleEvent(clickInfo),void this.emit("event",clickInfo)}}return this.root.handleEvent(info),this.emit("event",info),"pointer"===info.type&&"pointer_down"===info.name&&this.menus.clearOpenMenus(),this}maybeTrackPerformance(name){debugFlags.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(name),this.performanceTrackerTimeout=this.timers.setTimeout((()=>{this.performanceTracker.stop()}),50))}}function alertMaxShapes(editor,pageId=editor.getCurrentPageId()){const name=editor.getPage(pageId).name;editor.emit("max-shapes",{name,pageId,count:editor.options.maxShapesPerPage})}function applyPartialToRecordWithProps(prev,partial){if(!partial)return prev;let next=null;const entries=Object.entries(partial);for(let i=0,n=entries.length;i<n;i++){const[k,v]=entries[i];if(void 0!==v&&("id"!==k&&"type"!==k&&"typeName"!==k&&v!==prev[k]))if(next||(next={...prev}),"props"!==k&&"meta"!==k)next[k]=v;else{next[k]={...prev[k]};for(const[nextKey,nextValue]of Object.entries(v))next[k][nextKey]=nextValue}}return next||prev}function pushShapeWithDescendants(editor,id,result){const shape=editor.getShape(id);if(!shape)return;result.push(shape);const childIds=editor.getSortedChildIdsForParent(id);for(let i=0,n=childIds.length;i<n;i++)pushShapeWithDescendants(editor,childIds[i],result)}function withIsolatedShapes(editor,shapeIds,callback){let result;if(editor.run((()=>{const changes=editor.store.extractingChanges((()=>{const bindingsWithBoth=new Set,bindingsToRemove=new Set;for(const shapeId of shapeIds){if(editor.getShape(shapeId))for(const binding of editor.getBindingsInvolvingShape(shapeId)){const hasFrom=shapeIds.has(binding.fromId),hasTo=shapeIds.has(binding.toId);hasFrom&&hasTo?bindingsWithBoth.add(binding.id):hasFrom&&hasTo||bindingsToRemove.add(binding.id)}}editor.deleteBindings([...bindingsToRemove],{isolateShapes:!0});try{result=dist_esm.Q7.ok(callback(bindingsWithBoth))}catch(error){result=dist_esm.Q7.err(error)}}));editor.store.applyDiff((0,store_dist_esm.E8)(changes),{runCallbacks:!1})}),{history:"ignore"}),result.ok)return result.value;throw result.error}function getCameraFitXFitY(editor,cameraOptions){if(!cameraOptions.constraints)throw Error("Should have constraints here");const{padding:{x:px,y:py}}=cameraOptions.constraints,vsb=editor.getViewportScreenBounds(),bounds=Box.From(cameraOptions.constraints.bounds);return{zx:(vsb.w-2*px)/bounds.w,zy:(vsb.h-2*py)/bounds.h}}function useIsDarkMode(){const editor=useEditor_useEditor(),exportContext=useSvgExportContext();return useValue_useValue("isDarkMode",(()=>exportContext?.isDarkMode??editor.user.getIsDarkMode()),[exportContext,editor])}Editor_init=(base=>[,,,Editor_create(base?.[Editor_knownSymbol("metadata")]??null)])(_a),Editor_decorateElement(Editor_init,1,"getIsShapeHiddenCache",_getIsShapeHiddenCache_dec,Editor),Editor_decorateElement(Editor_init,1,"getCanUndo",_getCanUndo_dec,Editor),Editor_decorateElement(Editor_init,1,"getCanRedo",_getCanRedo_dec,Editor),Editor_decorateElement(Editor_init,1,"getPath",_getPath_dec,Editor),Editor_decorateElement(Editor_init,1,"getCurrentTool",_getCurrentTool_dec,Editor),Editor_decorateElement(Editor_init,1,"getCurrentToolId",_getCurrentToolId_dec,Editor),Editor_decorateElement(Editor_init,1,"getDocumentSettings",_getDocumentSettings_dec,Editor),Editor_decorateElement(Editor_init,1,"getInstanceState",_getInstanceState_dec,Editor),Editor_decorateElement(Editor_init,1,"getOpenMenus",_getOpenMenus_dec,Editor),Editor_decorateElement(Editor_init,1,"getIsMenuOpen",_getIsMenuOpen_dec,Editor),Editor_decorateElement(Editor_init,1,"getPageStates",_getPageStates_dec,Editor),Editor_decorateElement(Editor_init,1,"_getPageStatesQuery",__getPageStatesQuery_dec,Editor),Editor_decorateElement(Editor_init,1,"getCurrentPageState",_getCurrentPageState_dec,Editor),Editor_decorateElement(Editor_init,1,"_getCurrentPageStateId",__getCurrentPageStateId_dec,Editor),Editor_decorateElement(Editor_init,1,"getSelectedShapeIds",_getSelectedShapeIds_dec,Editor),Editor_decorateElement(Editor_init,1,"getSelectedShapes",_getSelectedShapes_dec,Editor),Editor_decorateElement(Editor_init,1,"getCurrentPageShapesInReadingOrder",_getCurrentPageShapesInReadingOrder_dec,Editor),Editor_decorateElement(Editor_init,1,"getOnlySelectedShapeId",_getOnlySelectedShapeId_dec,Editor),Editor_decorateElement(Editor_init,1,"getOnlySelectedShape",_getOnlySelectedShape_dec,Editor),Editor_decorateElement(Editor_init,1,"getSelectionPageBounds",_getSelectionPageBounds_dec,Editor),Editor_decorateElement(Editor_init,1,"getSelectionRotation",_getSelectionRotation_dec,Editor),Editor_decorateElement(Editor_init,1,"getSelectionRotatedPageBounds",_getSelectionRotatedPageBounds_dec,Editor),Editor_decorateElement(Editor_init,1,"getSelectionRotatedScreenBounds",_getSelectionRotatedScreenBounds_dec,Editor),Editor_decorateElement(Editor_init,1,"getFocusedGroupId",_getFocusedGroupId_dec,Editor),Editor_decorateElement(Editor_init,1,"getFocusedGroup",_getFocusedGroup_dec,Editor),Editor_decorateElement(Editor_init,1,"getEditingShapeId",_getEditingShapeId_dec,Editor),Editor_decorateElement(Editor_init,1,"getEditingShape",_getEditingShape_dec,Editor),Editor_decorateElement(Editor_init,1,"getRichTextEditor",_getRichTextEditor_dec,Editor),Editor_decorateElement(Editor_init,1,"getHoveredShapeId",_getHoveredShapeId_dec,Editor),Editor_decorateElement(Editor_init,1,"getHoveredShape",_getHoveredShape_dec,Editor),Editor_decorateElement(Editor_init,1,"getHintingShapeIds",_getHintingShapeIds_dec,Editor),Editor_decorateElement(Editor_init,1,"getHintingShape",_getHintingShape_dec,Editor),Editor_decorateElement(Editor_init,1,"getErasingShapeIds",_getErasingShapeIds_dec,Editor),Editor_decorateElement(Editor_init,1,"getErasingShapes",_getErasingShapes_dec,Editor),Editor_decorateElement(Editor_init,1,"_unsafe_getCameraId",__unsafe_getCameraId_dec,Editor),Editor_decorateElement(Editor_init,1,"getCamera",_getCamera_dec,Editor),Editor_decorateElement(Editor_init,1,"getViewportPageBoundsForFollowing",_getViewportPageBoundsForFollowing_dec,Editor),Editor_decorateElement(Editor_init,1,"getCameraForFollowing",_getCameraForFollowing_dec,Editor),Editor_decorateElement(Editor_init,1,"getZoomLevel",_getZoomLevel_dec,Editor),Editor_decorateElement(Editor_init,1,"getViewportScreenBounds",_getViewportScreenBounds_dec,Editor),Editor_decorateElement(Editor_init,1,"getViewportScreenCenter",_getViewportScreenCenter_dec,Editor),Editor_decorateElement(Editor_init,1,"getViewportPageBounds",_getViewportPageBounds_dec,Editor),Editor_decorateElement(Editor_init,1,"_getCollaboratorsQuery",__getCollaboratorsQuery_dec,Editor),Editor_decorateElement(Editor_init,1,"getCollaborators",_getCollaborators_dec,Editor),Editor_decorateElement(Editor_init,1,"getCollaboratorsOnCurrentPage",_getCollaboratorsOnCurrentPage_dec,Editor),Editor_decorateElement(Editor_init,1,"getRenderingShapes",_getRenderingShapes_dec,Editor),Editor_decorateElement(Editor_init,1,"_getAllPagesQuery",__getAllPagesQuery_dec,Editor),Editor_decorateElement(Editor_init,1,"getPages",_getPages_dec,Editor),Editor_decorateElement(Editor_init,1,"getCurrentPageId",_getCurrentPageId_dec,Editor),Editor_decorateElement(Editor_init,1,"getCurrentPageShapeIdsSorted",_getCurrentPageShapeIdsSorted_dec,Editor),Editor_decorateElement(Editor_init,1,"_getAllAssetsQuery",__getAllAssetsQuery_dec,Editor),Editor_decorateElement(Editor_init,1,"_getShapeHandlesCache",__getShapeHandlesCache_dec,Editor),Editor_decorateElement(Editor_init,1,"_getShapePageTransformCache",__getShapePageTransformCache_dec,Editor),Editor_decorateElement(Editor_init,1,"_getShapePageBoundsCache",__getShapePageBoundsCache_dec,Editor),Editor_decorateElement(Editor_init,1,"_getShapeClipPathCache",__getShapeClipPathCache_dec,Editor),Editor_decorateElement(Editor_init,1,"_getShapeMaskCache",__getShapeMaskCache_dec,Editor),Editor_decorateElement(Editor_init,1,"_getShapeMaskedPageBoundsCache",__getShapeMaskedPageBoundsCache_dec,Editor),Editor_decorateElement(Editor_init,1,"_notVisibleShapes",__notVisibleShapes_dec,Editor),Editor_decorateElement(Editor_init,1,"getCulledShapes",_getCulledShapes_dec,Editor),Editor_decorateElement(Editor_init,1,"getCurrentPageBounds",_getCurrentPageBounds_dec,Editor),Editor_decorateElement(Editor_init,1,"getCurrentPageShapes",_getCurrentPageShapes_dec,Editor),Editor_decorateElement(Editor_init,1,"getCurrentPageShapesSorted",_getCurrentPageShapesSorted_dec,Editor),Editor_decorateElement(Editor_init,1,"getCurrentPageRenderingShapesSorted",_getCurrentPageRenderingShapesSorted_dec,Editor),Editor_decorateElement(Editor_init,1,"_getBindingsIndexCache",__getBindingsIndexCache_dec,Editor),Editor_decorateElement(Editor_init,1,"_getSelectionSharedStyles",__getSelectionSharedStyles_dec,Editor),Editor_decorateElement(Editor_init,1,"getSharedStyles",_getSharedStyles_dec,Editor),Editor_decorateElement(Editor_init,1,"getSharedOpacity",_getSharedOpacity_dec,Editor),Editor_decorateElement(Editor_init,1,"getIsFocused",_getIsFocused_dec,Editor),Editor_decorateElement(Editor_init,1,"getIsReadonly",_getIsReadonly_dec,Editor),Editor_decorateElement(Editor_init,1,"_setShiftKeyTimeout",__setShiftKeyTimeout_dec,Editor),Editor_decorateElement(Editor_init,1,"_setAltKeyTimeout",__setAltKeyTimeout_dec,Editor),Editor_decorateElement(Editor_init,1,"_setCtrlKeyTimeout",__setCtrlKeyTimeout_dec,Editor),Editor_decorateElement(Editor_init,1,"_setMetaKeyTimeout",__setMetaKeyTimeout_dec,Editor),Editor_decoratorMetadata(Editor_init,Editor);const CORNER_SVG="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",EDGE_SVG="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",ROTATE_CORNER_SVG='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function getCursorCss(svg,r,tr,f,color,hotspotX=16,hotspotY=16){const a=utils_PI/180*(-tr-r),s=Math.sin(a),c=Math.cos(a);return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${color};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${1*c-1*s}' dy='${1*s+1*c}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${r+tr} 16 16)${f?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+svg.replaceAll('"',"'")+`</g></svg>") ${hotspotX} ${hotspotY}, pointer`}const STATIC_CURSORS=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],CURSORS={none:()=>"none","ew-resize":(r,f,c)=>getCursorCss(EDGE_SVG,r,0,f,c),"ns-resize":(r,f,c)=>getCursorCss(EDGE_SVG,r,90,f,c),"nesw-resize":(r,f,c)=>getCursorCss(CORNER_SVG,r,0,f,c),"nwse-resize":(r,f,c)=>getCursorCss(CORNER_SVG,r,90,f,c),"nwse-rotate":(r,f,c)=>getCursorCss(ROTATE_CORNER_SVG,r,0,f,c),"nesw-rotate":(r,f,c)=>getCursorCss(ROTATE_CORNER_SVG,r,90,f,c),"senw-rotate":(r,f,c)=>getCursorCss(ROTATE_CORNER_SVG,r,180,f,c),"swne-rotate":(r,f,c)=>getCursorCss(ROTATE_CORNER_SVG,r,270,f,c)};function getCursor(cursor,rotation=0,color="black"){return CURSORS[cursor](function radiansToDegrees(r){return 180*r/utils_PI}(rotation),!1,color)}const defaultAssetResolve=asset=>asset.props.src,inlineBase64AssetStore={upload:async(_,file)=>({src:await dist_esm.Sm.blobToDataUrl(file)})};function createTLStore({initialData,defaultName="",id,assets=inlineBase64AssetStore,onMount,collaboration,...rest}={}){const schema=function createTLStore_createTLSchemaFromUtils(opts){return"schema"in opts&&opts.schema?opts.schema:createTLSchema({shapes:"shapeUtils"in opts&&opts.shapeUtils?utilsToMap(checkShapesAndAddCore(opts.shapeUtils)):void 0,bindings:"bindingUtils"in opts&&opts.bindingUtils?utilsToMap(checkBindings(opts.bindingUtils)):void 0,migrations:"migrations"in opts?opts.migrations:void 0})}(rest),store=new store_dist_esm.il({id,schema,initialData,props:{defaultName,assets:{upload:assets.upload,resolve:assets.resolve??defaultAssetResolve,remove:assets.remove??(()=>Promise.resolve())},onMount:editor=>{(0,dist_esm.vA)(editor instanceof Editor),onMount?.(editor)},collaboration}});if(rest.snapshot){if(initialData)throw new Error("Cannot provide both initialData and snapshot");loadSnapshot(store,rest.snapshot,{forceOverwriteSessionState:!0})}return store}function utilsToMap(utils){return Object.fromEntries(utils.map((s=>[s.type,{props:s.props,migrations:s.migrations}])))}const instanceOfAny=(object,constructors)=>constructors.some((c=>object instanceof c));let idbProxyableTypes,cursorAdvanceMethods;const cursorRequestMap=new WeakMap,transactionDoneMap=new WeakMap,transactionStoreNamesMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;let idbProxyTraps={get(target,prop,receiver){if(target instanceof IDBTransaction){if("done"===prop)return transactionDoneMap.get(target);if("objectStoreNames"===prop)return target.objectStoreNames||transactionStoreNamesMap.get(target);if("store"===prop)return receiver.objectStoreNames[1]?void 0:receiver.objectStore(receiver.objectStoreNames[0])}return wrap(target[prop])},set:(target,prop,value)=>(target[prop]=value,!0),has:(target,prop)=>target instanceof IDBTransaction&&("done"===prop||"store"===prop)||prop in target};function wrapFunction(func){return func!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(func)?function(...args){return func.apply(unwrap(this),args),wrap(cursorRequestMap.get(this))}:function(...args){return wrap(func.apply(unwrap(this),args))}:function(storeNames,...args){const tx=func.call(unwrap(this),storeNames,...args);return transactionStoreNamesMap.set(tx,storeNames.sort?storeNames.sort():[storeNames]),wrap(tx)}}function transformCachableValue(value){return"function"==typeof value?wrapFunction(value):(value instanceof IDBTransaction&&function cacheDonePromiseForTransaction(tx){if(transactionDoneMap.has(tx))return;const done=new Promise(((resolve,reject)=>{const unlisten=()=>{tx.removeEventListener("complete",complete),tx.removeEventListener("error",error),tx.removeEventListener("abort",error)},complete=()=>{resolve(),unlisten()},error=()=>{reject(tx.error||new DOMException("AbortError","AbortError")),unlisten()};tx.addEventListener("complete",complete),tx.addEventListener("error",error),tx.addEventListener("abort",error)}));transactionDoneMap.set(tx,done)}(value),instanceOfAny(value,function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(value,idbProxyTraps):value)}function wrap(value){if(value instanceof IDBRequest)return function promisifyRequest(request){const promise=new Promise(((resolve,reject)=>{const unlisten=()=>{request.removeEventListener("success",success),request.removeEventListener("error",error)},success=()=>{resolve(wrap(request.result)),unlisten()},error=()=>{reject(request.error),unlisten()};request.addEventListener("success",success),request.addEventListener("error",error)}));return promise.then((value=>{value instanceof IDBCursor&&cursorRequestMap.set(value,request)})).catch((()=>{})),reverseTransformCache.set(promise,request),promise}(value);if(transformCache.has(value))return transformCache.get(value);const newValue=transformCachableValue(value);return newValue!==value&&(transformCache.set(value,newValue),reverseTransformCache.set(newValue,value)),newValue}const unwrap=value=>reverseTransformCache.get(value);function openDB(name,version,{blocked,upgrade,blocking,terminated}={}){const request=indexedDB.open(name,version),openPromise=wrap(request);return upgrade&&request.addEventListener("upgradeneeded",(event=>{upgrade(wrap(request.result),event.oldVersion,event.newVersion,wrap(request.transaction),event)})),blocked&&request.addEventListener("blocked",(event=>blocked(event.oldVersion,event.newVersion,event))),openPromise.then((db=>{terminated&&db.addEventListener("close",(()=>terminated())),blocking&&db.addEventListener("versionchange",(event=>blocking(event.oldVersion,event.newVersion,event)))})).catch((()=>{})),openPromise}function deleteDB(name,{blocked}={}){const request=indexedDB.deleteDatabase(name);return blocked&&request.addEventListener("blocked",(event=>blocked(event.oldVersion,event))),wrap(request).then((()=>{}))}const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(target,prop){if(!(target instanceof IDBDatabase)||prop in target||"string"!=typeof prop)return;if(cachedMethods.get(prop))return cachedMethods.get(prop);const targetFuncName=prop.replace(/FromIndex$/,""),useIndex=prop!==targetFuncName,isWrite=writeMethods.includes(targetFuncName);if(!(targetFuncName in(useIndex?IDBIndex:IDBObjectStore).prototype)||!isWrite&&!readMethods.includes(targetFuncName))return;const method=async function(storeName,...args){const tx=this.transaction(storeName,isWrite?"readwrite":"readonly");let target=tx.store;return useIndex&&(target=target.index(args.shift())),(await Promise.all([target[targetFuncName](...args),isWrite&&tx.done]))[0]};return cachedMethods.set(prop,method),method}!function replaceTraps(callback){idbProxyTraps=callback(idbProxyTraps)}((oldTraps=>({...oldTraps,get:(target,prop,receiver)=>getMethod(target,prop)||oldTraps.get(target,prop,receiver),has:(target,prop)=>!!getMethod(target,prop)||oldTraps.has(target,prop)})));const STORE_PREFIX="TLDRAW_DOCUMENT_v2",dbNameIndexKey="TLDRAW_DB_NAME_INDEX_v2",Table={Records:"records",Schema:"schema",SessionState:"session_state",Assets:"assets"};async function openLocalDb(persistenceKey){const storeId=STORE_PREFIX+persistenceKey;return function addDbName(name){const all=new Set(getAllIndexDbNames());all.add(name),(0,dist_esm.Yz)(dbNameIndexKey,JSON.stringify([...all]))}(storeId),await openDB(storeId,4,{upgrade(database){database.objectStoreNames.contains(Table.Records)||database.createObjectStore(Table.Records),database.objectStoreNames.contains(Table.Schema)||database.createObjectStore(Table.Schema),database.objectStoreNames.contains(Table.SessionState)||database.createObjectStore(Table.SessionState),database.objectStoreNames.contains(Table.Assets)||database.createObjectStore(Table.Assets)}})}class LocalIndexedDb{getDbPromise;isClosed=!1;pendingTransactionSet=new Set;static connectedInstances=new Set;constructor(persistenceKey){LocalIndexedDb.connectedInstances.add(this),this.getDbPromise=(async()=>(await async function migrateLegacyAssetDbIfNeeded(persistenceKey){const databases=window.indexedDB.databases?(await window.indexedDB.databases()).map((db=>db.name)):getAllIndexDbNames(),oldStoreId="TLDRAW_ASSET_STORE_v1"+persistenceKey;if(!databases.find((dbName=>dbName===oldStoreId)))return;const oldAssetDb=await openDB(oldStoreId,1,{upgrade(database){database.objectStoreNames.contains("assets")||database.createObjectStore("assets")}});if(!oldAssetDb.objectStoreNames.contains("assets"))return;const oldTx=oldAssetDb.transaction(["assets"],"readonly"),oldAssetStore=oldTx.objectStore("assets"),oldAssetsKeys=await oldAssetStore.getAllKeys(),oldAssets=await Promise.all(oldAssetsKeys.map((async key=>[key,await oldAssetStore.get(key)])));await oldTx.done;const newDb=await openLocalDb(persistenceKey),newTx=newDb.transaction([Table.Assets],"readwrite"),newAssetTable=newTx.objectStore(Table.Assets);for(const[key,value]of oldAssets)newAssetTable.put(value,key);await newTx.done,oldAssetDb.close(),newDb.close(),await deleteDB(oldStoreId)}(persistenceKey),await openLocalDb(persistenceKey)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(dist_esm.lQ)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),LocalIndexedDb.connectedInstances.delete(this))}tx(mode,names,cb){const txPromise=(async()=>{(0,dist_esm.vA)(!this.isClosed,"db is closed");const tx=(await this.getDb()).transaction(names,mode),done=tx.done.catch((e=>{if(!this.isClosed)throw e}));try{return await cb(tx)}finally{this.isClosed?tx.abort():await done}})();return this.pendingTransactionSet.add(txPromise),txPromise.finally((()=>this.pendingTransactionSet.delete(txPromise))),txPromise}async load({sessionId}={}){return await this.tx("readonly",[Table.Records,Table.Schema,Table.SessionState],(async tx=>{const recordsStore=tx.objectStore(Table.Records),schemaStore=tx.objectStore(Table.Schema),sessionStateStore=tx.objectStore(Table.SessionState);let sessionStateSnapshot=sessionId?(await sessionStateStore.get(sessionId))?.snapshot:null;if(!sessionStateSnapshot){const all=await sessionStateStore.getAll();sessionStateSnapshot=all.sort(((a,b)=>a.updatedAt-b.updatedAt)).pop()?.snapshot}return{records:await recordsStore.getAll(),schema:await schemaStore.get(Table.Schema),sessionStateSnapshot}}))}async storeChanges({schema,changes,sessionId,sessionStateSnapshot}){await this.tx("readwrite",[Table.Records,Table.Schema,Table.SessionState],(async tx=>{const recordsStore=tx.objectStore(Table.Records),schemaStore=tx.objectStore(Table.Schema),sessionStateStore=tx.objectStore(Table.SessionState);for(const[id,record]of Object.entries(changes.added))await recordsStore.put(record,id);for(const[_prev,updated]of Object.values(changes.updated))await recordsStore.put(updated,updated.id);for(const id of Object.keys(changes.removed))await recordsStore.delete(id);schemaStore.put(schema.serialize(),Table.Schema),sessionStateSnapshot&&sessionId?sessionStateStore.put({snapshot:sessionStateSnapshot,updatedAt:Date.now(),id:sessionId},sessionId):(sessionStateSnapshot||sessionId)&&console.error("sessionStateSnapshot and instanceId must be provided together")}))}async storeSnapshot({schema,snapshot,sessionId,sessionStateSnapshot}){await this.tx("readwrite",[Table.Records,Table.Schema,Table.SessionState],(async tx=>{const recordsStore=tx.objectStore(Table.Records),schemaStore=tx.objectStore(Table.Schema),sessionStateStore=tx.objectStore(Table.SessionState);await recordsStore.clear();for(const[id,record]of Object.entries(snapshot))await recordsStore.put(record,id);schemaStore.put(schema.serialize(),Table.Schema),sessionStateSnapshot&&sessionId?sessionStateStore.put({snapshot:sessionStateSnapshot,updatedAt:Date.now(),id:sessionId},sessionId):(sessionStateSnapshot||sessionId)&&console.error("sessionStateSnapshot and instanceId must be provided together")}))}async pruneSessions(){await this.tx("readwrite",[Table.SessionState],(async tx=>{const sessionStateStore=tx.objectStore(Table.SessionState),all=(await sessionStateStore.getAll()).sort(((a,b)=>a.updatedAt-b.updatedAt));if(all.length<10)return void await tx.done;const toDelete=all.slice(0,all.length-10);for(const{id}of toDelete)await sessionStateStore.delete(id)}))}async getAsset(assetId){return await this.tx("readonly",[Table.Assets],(async tx=>{const assetsStore=tx.objectStore(Table.Assets);return await assetsStore.get(assetId)}))}async storeAsset(assetId,blob){await this.tx("readwrite",[Table.Assets],(async tx=>{const assetsStore=tx.objectStore(Table.Assets);await assetsStore.put(blob,assetId)}))}async removeAssets(assetId){await this.tx("readwrite",[Table.Assets],(async tx=>{const assetsStore=tx.objectStore(Table.Assets);for(const id of assetId)await assetsStore.delete(id)}))}}function getAllIndexDbNames(){const result=JSON.parse((0,dist_esm.zM)(dbNameIndexKey)||"[]")??[];return Array.isArray(result)?result:[]}const UPDATE_INSTANCE_STATE=Symbol("UPDATE_INSTANCE_STATE");const BC="undefined"==typeof BroadcastChannel?class BroadcastChannelMock{onmessage;constructor(_name){}postMessage(_msg){}close(){}}:BroadcastChannel;class TLLocalSyncClient{constructor(store,{persistenceKey,sessionId=TAB_ID,onLoad,onLoadError},channel=new BC(`tldraw-tab-sync-${persistenceKey}`)){this.store=store,this.channel=channel,"undefined"!=typeof window&&(window.tlsync=this),this.persistenceKey=persistenceKey,this.sessionId=sessionId,this.db=new LocalIndexedDb(persistenceKey),this.disposables.add((()=>this.db.close())),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=createSessionStateSnapshotSignal(this.store),this.disposables.add(store.listen((({changes})=>{this.diffQueue.push(changes),this.channel.postMessage({type:"diff",storeId:this.store.id,changes,schema:this.serializedSchema}),this.schedulePersist()}),{source:"user",scope:"document"})),this.disposables.add(store.listen((()=>{this.diffQueue.push(UPDATE_INSTANCE_STATE),this.schedulePersist()}),{scope:"session"})),this.connect(onLoad,onLoadError),this.documentTypes=new Set(Object.values(this.store.schema.types).filter((t=>"document"===t.scope)).map((t=>t.typeName)))}disposables=new Set;diffQueue=[];didDispose=!1;shouldDoFullDBWrite=!0;isReloading=!1;persistenceKey;sessionId;serializedSchema;isDebugging=!1;documentTypes;$sessionStateSnapshot;db;initTime=Date.now();debug(...args){this.isDebugging&&console.debug(...args)}async connect(onLoad,onLoadError){let data;this.debug("connecting");try{data=await this.db.load({sessionId:this.sessionId})}catch(error){return onLoadError(error),void function showCantReadFromIndexDbAlert(){window.alert("Oops! We could not access your browser's storageâand the app won't work correctly without that. We now need to reload the page and try again.\n\nKeep seeing this message?\nâ¢ If you're using tldraw in a private or \"incognito\" window, try loading tldraw in a regular window or in a different browser.")}()}if(this.debug("loaded data from store",data,"didDispose",this.didDispose),!this.didDispose)try{if(data){const documentSnapshot=Object.fromEntries(data.records.map((r=>[r.id,r]))),sessionStateSnapshot=data.sessionStateSnapshot??function extractSessionStateFromLegacySnapshot(store){const instanceRecords=[];for(const record of Object.values(store))record.typeName?.match(/^(instance.*|pointer|camera)$/)&&instanceRecords.push(record);const oldInstance=instanceRecords.filter((r=>"instance"===r.typeName&&r.id!==TLInstance_TLINSTANCE_ID))[0];if(!oldInstance)return null;const result={version:CURRENT_SESSION_STATE_SNAPSHOT_VERSION,currentPageId:oldInstance.currentPageId,exportBackground:!!oldInstance.exportBackground,isFocusMode:!!oldInstance.isFocusMode,isDebugMode:!!oldInstance.isDebugMode,isToolLocked:!!oldInstance.isToolLocked,isGridMode:!1,pageStates:instanceRecords.filter((r=>"instance_page_state"===r.typeName&&r.instanceId===oldInstance.id)).map((ps=>{const camera=store[ps.cameraId]??{x:0,y:0,z:1};return{pageId:ps.pageId,camera:{x:camera.x,y:camera.y,z:camera.z},selectedShapeIds:ps.selectedShapeIds,focusedGroupId:ps.focusedGroupId}}))};try{return sessionStateSnapshotValidator.validate(result),result}catch{return null}}(documentSnapshot),migrationResult=this.store.schema.migrateStoreSnapshot({store:documentSnapshot,schema:data.schema??this.store.schema.serializeEarliestVersion()});if("error"===migrationResult.type)return console.error("failed to migrate store",migrationResult),void onLoadError(new Error(`Failed to migrate store: ${migrationResult.reason}`));const records=Object.values(migrationResult.value).filter((r=>this.documentTypes.has(r.typeName)));records.length>0&&this.store.mergeRemoteChanges((()=>{this.store.put(records,"initialize")})),sessionStateSnapshot&&loadSessionStateSnapshotIntoStore(this.store,sessionStateSnapshot,{forceOverwrite:!0})}this.channel.onmessage=({data:data2})=>{this.debug("got message",data2);const msg2=data2,res=this.store.schema.getMigrationsSince(msg2.schema);if(!res.ok){return Date.now()-this.initTime<5e3?void onLoadError(new Error("Schema mismatch, please close other tabs and reload the page")):(this.debug("reloading"),this.isReloading=!0,void window?.location?.reload?.())}if(res.value.length>0)return this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,void this.persistIfNeeded();"diff"===msg2.type&&(this.debug("applying diff"),(0,state_dist_esm.hL)((()=>{this.store.mergeRemoteChanges((()=>{this.store.applyDiff(msg2.changes)}))})))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add((()=>{this.channel.close()})),onLoad(this)}catch(e){if(this.debug("error loading data from store",e),this.didDispose)return;return void onLoadError(e)}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach((d=>d()))}isPersisting=!1;didLastWriteError=!1;scheduledPersistTimeout=null;schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),this.scheduledPersistTimeout||(this.scheduledPersistTimeout=setTimeout((()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()}),this.didLastWriteError?1e4:350))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),this.isPersisting||this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist()}async doPersist(){if((0,dist_esm.vA)(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");const diffQueue=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const diffs=(0,store_dist_esm.Dm)(diffQueue.filter((d=>d!==UPDATE_INSTANCE_STATE)));await this.db.storeChanges({changes:diffs,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(e){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",e),function showCantWriteToIndexDbAlert(){window.alert("Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.\n\nKeep seeing this message?\nâ¢ If you're using tldraw in a private or \"incognito\" window, try loading tldraw in a regular window or in a different browser.\nâ¢ If your hard disk is full, try clearing up some space and then reload the page.")}(),"undefined"!=typeof window&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function useRefState(initialValue){const ref=(0,react.useRef)(initialValue),[state,setState]=(0,react.useState)(initialValue);state!==ref.current&&setState(ref.current);return[state,(0,react.useCallback)((value=>{ref.current="function"==typeof value?value(ref.current):value,setState(ref.current)}),[])]}function str2ab(str){const buf=new ArrayBuffer(str.length),bufView=new Uint8Array(buf);for(let i=0,strLen=str.length;i<strLen;i++)bufView[i]=str.charCodeAt(i);return buf}const FLAGS={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4,WITH_WATERMARK:8},HIGHEST_FLAG=Math.max(...Object.values(FLAGS)),PROPERTIES={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},NUMBER_OF_KNOWN_PROPERTIES=Object.keys(PROPERTIES).length,WATERMARK_TRACK_SRC=`${getDefaultCdnBaseUrl()}/watermarks/watermark-track.svg`;class LicenseManager{publicKey="MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ";isDevelopment;isTest;isCryptoAvailable;state=(0,state_dist_esm.eU)("license state","pending");verbose=!0;constructor(licenseKey,testPublicKey,testEnvironment){this.isTest=!1,this.isDevelopment=this.getIsDevelopment(testEnvironment),this.publicKey=testPublicKey||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,this.getLicenseFromKey(licenseKey).then((result=>{const isUnlicensed=function isEditorUnlicensed(result){if(!result.isLicenseParseable)return!0;if(!result.isDomainValid&&!result.isDevelopment)return!0;if(result.isPerpetualLicenseExpired||result.isAnnualLicenseExpired){if(result.isInternalLicense)throw new Error("License: Internal license expired.");return!0}return!1}(result);!this.isDevelopment&&isUnlicensed&&(0,dist_esm.hd)(WATERMARK_TRACK_SRC),isUnlicensed?this.state.set("unlicensed"):result.isLicensedWithWatermark?this.state.set("licensed-with-watermark"):this.state.set("licensed")}))}getIsDevelopment(testEnvironment){return"development"===testEnvironment||"production"!==testEnvironment&&(!["https:","vscode-webview:"].includes(window.location.protocol)||"localhost"===window.location.hostname)}async extractLicenseKey(licenseKey){const[data,signature]=licenseKey.split("."),[prefix,encodedData]=data.split("/");if(!prefix.startsWith("tldraw-"))throw new Error(`Unsupported prefix '${prefix}'`);const publicCryptoKey=await function importPublicKey(pemContents){const binaryDer=str2ab(atob(pemContents));return crypto.subtle.importKey("spki",new Uint8Array(binaryDer),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}(this.publicKey);let isVerified,decodedData;try{isVerified=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},publicCryptoKey,new Uint8Array(str2ab(atob(signature))),new Uint8Array(str2ab(atob(encodedData))))}catch(e){throw console.error(e),new Error("Could not perform signature validation")}if(!isVerified)throw new Error("Invalid signature");try{decodedData=JSON.parse(atob(encodedData))}catch{throw new Error("Could not parse object")}return decodedData.length>NUMBER_OF_KNOWN_PROPERTIES&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:decodedData[PROPERTIES.ID],hosts:decodedData[PROPERTIES.HOSTS],flags:decodedData[PROPERTIES.FLAGS],expiryDate:decodedData[PROPERTIES.EXPIRY_DATE]}}async getLicenseFromKey(licenseKey){if(!licenseKey)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return this.verbose&&(console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately.")),{isLicenseParseable:!1,reason:"has-key-development-mode"};let cleanedLicenseKey=licenseKey.replace(/[\u200B-\u200D\uFEFF]/g,"");cleanedLicenseKey=cleanedLicenseKey.replace(/\r?\n|\r/g,"");try{const licenseInfo=await this.extractLicenseKey(cleanedLicenseKey),expiryDate=new Date(licenseInfo.expiryDate),isAnnualLicense=this.isFlagEnabled(licenseInfo.flags,FLAGS.ANNUAL_LICENSE),isPerpetualLicense=this.isFlagEnabled(licenseInfo.flags,FLAGS.PERPETUAL_LICENSE),result={license:licenseInfo,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(licenseInfo),expiryDate,isAnnualLicense,isAnnualLicenseExpired:isAnnualLicense&&this.isAnnualLicenseExpired(expiryDate),isPerpetualLicense,isPerpetualLicenseExpired:isPerpetualLicense&&this.isPerpetualLicenseExpired(expiryDate),isInternalLicense:this.isFlagEnabled(licenseInfo.flags,FLAGS.INTERNAL_LICENSE),isLicensedWithWatermark:this.isFlagEnabled(licenseInfo.flags,FLAGS.WITH_WATERMARK)};return this.outputLicenseInfoIfNeeded(result),result}catch(e){return this.outputInvalidLicenseKey(e.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(licenseInfo){const currentHostname=window.location.hostname.toLowerCase();return licenseInfo.hosts.some((host=>{const normalizedHost=host.toLowerCase().trim();if(normalizedHost===currentHostname||`www.${normalizedHost}`===currentHostname||normalizedHost===`www.${currentHostname}`)return!0;if("*"===host)return!0;if(host.includes("*")){const globToRegex=new RegExp(host.replace(/\*/g,".*?"));return globToRegex.test(currentHostname)||globToRegex.test(`www.${currentHostname}`)}if("vscode-webview:"===window.location.protocol){if(normalizedHost===new URL(window.location.href).searchParams.get("extensionId"))return!0}return!1}))}getExpirationDateWithoutGracePeriod(expiryDate){return new Date(expiryDate.getFullYear(),expiryDate.getMonth(),expiryDate.getDate())}getExpirationDateWithGracePeriod(expiryDate){return new Date(expiryDate.getFullYear(),expiryDate.getMonth(),expiryDate.getDate()+5+1)}isAnnualLicenseExpired(expiryDate){const expiration=this.getExpirationDateWithGracePeriod(expiryDate),isExpired=new Date>=expiration;return!isExpired&&new Date>=this.getExpirationDateWithoutGracePeriod(expiryDate)&&this.outputMessages(["tldraw license is about to expire, you are in a grace period.","Please reach out to sales@tldraw.com if you would like to renew your license."]),isExpired}isPerpetualLicenseExpired(expiryDate){const expiration=this.getExpirationDateWithGracePeriod(expiryDate),dates_major=new Date(publishDates_major),dates_minor=new Date(publishDates_minor);return dates_major>=expiration||dates_minor>=expiration}isFlagEnabled(flags,flag){return(flags&flag)===flag}outputNoLicenseKeyProvided(){}outputInvalidLicenseKey(msg){this.outputMessages(["Invalid tldraw license key",`Reason: ${msg}`])}outputLicenseInfoIfNeeded(result){result.isAnnualLicenseExpired&&this.outputMessages(["Your tldraw license has expired!","Please reach out to sales@tldraw.com to renew."]),result.isDomainValid||result.isDevelopment||this.outputMessages(["This tldraw license key is not valid for this domain!","Please reach out to sales@tldraw.com if you would like to use tldraw on other domains."]),result.license.flags>=2*HIGHEST_FLAG&&this.outputMessages(["This tldraw license contains some unknown flags.","You may want to update tldraw packages to a newer version to get access to new functionality."])}outputMessages(messages){if(!this.isTest&&this.verbose){this.outputDelimiter();for(const message of messages)console.log(`%c${message}`,"color: white; background: crimson; padding: 2px; border-radius: 3px;");this.outputDelimiter()}}outputDelimiter(){console.log("%c-------------------------------------------------------------------","color: white; background: crimson; padding: 2px; border-radius: 3px;")}static className="tl-watermark_SEE-LICENSE"}const LicenseContext=(0,react.createContext)({});function LicenseProvider({licenseKey,children}){const[licenseManager]=(0,react.useState)((()=>new LicenseManager(licenseKey)));return(0,jsx_runtime.jsx)(LicenseContext.Provider,{value:licenseManager,children})}function usePassThroughWheelEvents(ref){if(!ref)throw Error("usePassThroughWheelEvents must be passed a ref");const container=useContainer();(0,react.useEffect)((()=>{function onWheel(e){if(e.isSpecialRedispatchedEvent)return;const elm2=ref.current;if(elm2&&elm2.scrollHeight>elm2.clientHeight)return;preventDefault(e);const cvs=container.querySelector(".tl-canvas");if(!cvs)return;const newEvent=new WheelEvent("wheel",e);newEvent.isSpecialRedispatchedEvent=!0,cvs.dispatchEvent(newEvent)}const elm=ref.current;if(elm)return elm.addEventListener("wheel",onWheel,{passive:!1}),()=>{elm.removeEventListener("wheel",onWheel)}}),[container,ref])}const WATERMARK_DESKTOP_LOCAL_SRC=`data:image/svg+xml;utf8,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>')}`,WATERMARK_MOBILE_LOCAL_SRC=`data:image/svg+xml;utf8,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="400" height="1601" fill="none"><path fill="#000" d="M72 1319.8c0-10.73 7.071-20.18 17.372-23.22l215.823-63.62c15.519-4.57 31.078 7.05 31.078 23.22v28.26c0 11.31-7.824 21.1-18.85 23.61l-109.636 24.94c-9.254 2.1-9.487 15.2-.313 17.63l110.784 29.37a24.21 24.21 0 0 1 18.015 23.4v25.64c0 11-7.423 20.62-18.071 23.41l-109.659 28.79c-9.162 2.41-8.986 15.47.236 17.63l108.792 25.46c10.955 2.56 18.702 12.33 18.702 23.57v28.39c0 16.17-15.559 27.79-31.078 23.22l-215.823-63.62c-10.3-3.04-17.372-12.49-17.372-23.22v-32.72c0-10.59 6.883-19.95 16.994-23.11l104.523-32.67c8.547-2.67 8.479-14.79-.096-17.36l-104.17-31.3C79.01 1372.42 72 1363 72 1352.31zM72 572.638V495.43c0-13.336 10.846-24.147 24.225-24.147h215.823c13.379 0 24.225 10.811 24.225 24.147v76.179q0 40.645-15.872 70.228-15.743 29.712-45.422 45.79-29.55 16.206-70.843 16.206-41.292 0-70.971-16.078-29.55-16.077-45.422-45.532Q72 612.767 72 572.638m85.132-29.84c-13.379 0-24.225 10.81-24.225 24.146v3.122q0 19.55 6.323 33.313 6.323 13.89 21.807 21.094 15.485 7.332 43.099 7.331t43.1-7.46q15.484-7.33 21.807-21.608 6.323-14.15 6.323-34.728v-1.064c0-13.336-10.846-24.146-24.225-24.146zM72 285.858c0-13.363 10.846-24.197 24.225-24.197h215.823c13.379 0 24.225 10.834 24.225 24.197v23.27c0 13.364-10.846 24.197-24.225 24.197H154.035c-13.379 0-24.225 10.834-24.225 24.197v58.328c0 13.364-10.846 24.197-24.225 24.197h-9.36C82.845 440.047 72 429.214 72 415.85zM278.463 24.72c0-13.374 10.846-24.216 24.225-24.216h9.36c13.379 0 24.225 10.842 24.225 24.216v181.174c0 13.374-10.846 24.216-24.225 24.216h-9.36c-13.379 0-24.225-10.842-24.225-24.216v-40.108c0-8.359-6.779-15.135-15.141-15.135H96.225c-13.38 0-24.225-10.842-24.225-24.216v-22.256c0-13.374 10.846-24.216 24.225-24.216h167.097c8.362 0 15.141-6.776 15.141-15.135z"/><path fill="#000" fill-rule="evenodd" d="M89.224 1062.13C78.997 1059.04 72 1049.63 72 1038.96v-25.9c0-16.486 16.145-28.147 31.818-22.979l215.823 71.169a24.19 24.19 0 0 1 16.632 22.98v62.97c0 10.45-6.706 19.71-16.632 22.98l-215.823 71.17C88.145 1246.51 72 1234.86 72 1218.37v-25.9c0-10.67 6.997-20.08 17.224-23.17l22.595-6.81a15.13 15.13 0 0 0 10.765-14.48v-64.59a15.13 15.13 0 0 0-10.765-14.48zm98.672 77.53 49.299-14.39c8.601-2.51 8.755-14.62.22-17.35l-49.299-15.75c-5.861-1.88-11.852 2.49-11.852 8.64v30.14c0 6.05 5.817 10.41 11.632 8.71" clip-rule="evenodd"/><path fill="#000" d="M72 773.439c0-13.367 10.846-24.203 24.225-24.203h215.823c13.379 0 24.225 10.836 24.225 24.203v89.762q0 29.395-10.711 51.439-10.71 22.046-30.84 34.293t-48.261 12.248q-28.388 0-47.873-12.635-18.187-11.672-28.056-32.218c-8.303-17.289-11.301-36.661-11.301-55.705v-43.867c0-77.976 138.26 4.16 86.215 4.16h-8.138c-12.334 0-22.332 9.989-22.332 22.311 0 8.269.351 16.6 3.097 24.487q3.225 9.024 10.194 13.794 6.968 4.899 18.194 4.899 11.356 0 18.453-4.899 7.226-4.77 10.581-13.794c2.815-7.188 3.484-14.944 3.484-22.596 0-13.366-10.846-24.202-24.225-24.202h-48.56c-12.036 0-16.288 11.345-21.122 20.272-6.79 12.539-25.841 7.72-25.841-6.536 0-7.586-6.156-13.736-13.749-13.736H96.225C82.845 820.916 72 810.08 72 796.714zm108.66 137.378-10.128 5.511-62.72 34.131C91.67 959.243 72 947.569 72 929.205V906.52a24.2 24.2 0 0 1 12.719-21.299l66.199-35.696a15.82 15.82 0 0 0 8.313-13.921c0-43.012 83.618 41.371 21.429 75.213"/></svg>')}`,Watermark=(0,react.memo)((function Watermark2(){const licenseManager=(0,react.useContext)(LicenseContext),editor=useEditor_useEditor(),isMobile=useValue_useValue("is mobile",(()=>editor.getViewportScreenBounds().width<700),[editor]),licenseManagerState=function useLicenseManagerState(licenseManager){return useValue_useValue("watermarkState",(()=>licenseManager.state.get()),[licenseManager])}(licenseManager);return["licensed-with-watermark","unlicensed"].includes(licenseManagerState)?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LicenseStyles,{}),(0,jsx_runtime.jsx)(WatermarkInner,{src:isMobile?WATERMARK_MOBILE_LOCAL_SRC:WATERMARK_DESKTOP_LOCAL_SRC})]}):null})),WatermarkInner=(0,react.memo)((function WatermarkInner2({src}){const editor=useEditor_useEditor(),isDebugMode=useValue_useValue("debug mode",(()=>editor.getInstanceState().isDebugMode),[editor]),isMobile=useValue_useValue("is mobile",(()=>editor.getViewportScreenBounds().width<700),[editor]),events=useCanvasEvents(),ref=(0,react.useRef)(null);usePassThroughWheelEvents(ref);const maskCss=`url('${src}') center 100% / 100% no-repeat`;return(0,jsx_runtime.jsx)("div",{ref,className:LicenseManager.className,"data-debug":isDebugMode,"data-mobile":isMobile,draggable:!1,...events,children:(0,jsx_runtime.jsx)("button",{draggable:!1,role:"button",onPointerDown:e=>{stopEventPropagation(e),preventDefault(e)},title:"made with tldraw",onClick:()=>runtime.openWindow("https://tldraw.dev/?utm_source=dotcom&utm_medium=organic&utm_campaign=watermark","_blank"),style:{mask:maskCss,WebkitMask:maskCss}})})})),LicenseStyles=(0,react.memo)((function LicenseStyles2(){const editor=useEditor_useEditor(),className=LicenseManager.className,CSS=`/* ------------------- SEE LICENSE -------------------\nThe tldraw watermark is part of tldraw's license. It is shown for unlicensed\nor "licensed-with-watermark" users. By using this library, you agree to\npreserve the watermark's behavior, keeping it visible, unobscured, and\navailable to user-interaction.\n\nTo remove the watermark, please purchase a license at tldraw.dev.\n*/\n\n\t.${className} {\n\t\tposition: absolute;\n\t\tbottom: var(--space-2);\n\t\tright: var(--space-2);\n\t\twidth: 96px;\n\t\theight: 32px;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tz-index: var(--layer-watermark) !important;\n\t\tbackground-color: color-mix(in srgb, var(--color-background) 62%, transparent);\n\t\topacity: 1;\n\t\tborder-radius: 5px;\n\t\tpointer-events: all;\n\t\tpadding: 2px;\n\t\tbox-sizing: content-box;\n\t}\n\n\t.${className} > button {\n\t\tposition: absolute;\n\t\twidth: 96px;\n\t\theight: 32px;\n\t\tpointer-events: all;\n\t\tcursor: inherit;\n\t\tcolor: var(--color-text);\n\t\topacity: .38;\n\t\tborder: 0;\n\t\tpadding: 0;\n\t\tbackground-color: currentColor;\n\t}\n\n\t.${className}[data-debug='true'] {\n\t\tbottom: 46px;\n\t}\n\n\t.${className}[data-mobile='true'] {\n\t\tborder-radius: 4px 0px 0px 4px;\n\t\tright: -2px;\n\t\twidth: 8px;\n\t\theight: 48px;\n\t}\n\n\t.${className}[data-mobile='true'] > button {\n\t\twidth: 8px;\n\t\theight: 32px;\n\t}\n\n\t@media (hover: hover) {\n\t\t.${className} > button {\n\t\t\tpointer-events: none;\n\t\t}\n\n\t\t.${className}:hover {\n\t\t\tbackground-color: var(--color-background);\n\t\t\ttransition: background-color 0.2s ease-in-out;\n\t\t\ttransition-delay: 0.32s;\n\t\t}\n\n\t\t.${className}:hover > button {\n\t\t\tanimation: delayed_link 0.2s forwards ease-in-out;\n\t\t\tanimation-delay: 0.32s;\n\t\t}\n\n\t\t.${className} > button:focus-visible {\n\t\t\topacity: 1;\n\t\t}\n\t}\n\n\n\t@keyframes delayed_link {\n\t\t0% {\n\t\t\tcursor: inherit;\n\t\t\topacity: .38;\n\t\t\tpointer-events: none;\n\t\t}\n\t\t100% {\n\t\t\tcursor: pointer;\n\t\t\topacity: 1;\n\t\t\tpointer-events: all;\n\t\t}\n\t}`;return(0,jsx_runtime.jsx)("style",{nonce:editor.options.nonce,children:CSS})})),EMPTY_SHAPE_UTILS_ARRAY=[],EMPTY_BINDING_UTILS_ARRAY=[],EMPTY_TOOLS_ARRAY=[],TldrawEditor=(0,react.memo)((function TldrawEditor2({store,components,className,user:_user,options:_options,...rest}){const[container,setContainer]=(0,react.useState)(null),user=(0,react.useMemo)((()=>_user??createTLUser()),[_user]),ErrorFallback=void 0===components?.ErrorFallback?DefaultErrorFallback:components?.ErrorFallback,withDefaults={...rest,shapeUtils:rest.shapeUtils??EMPTY_SHAPE_UTILS_ARRAY,bindingUtils:rest.bindingUtils??EMPTY_BINDING_UTILS_ARRAY,tools:rest.tools??EMPTY_TOOLS_ARRAY,components,options:useIdentity_useShallowObjectIdentity(_options)};return(0,jsx_runtime.jsx)("div",{ref:setContainer,"data-tldraw":version,draggable:!1,className:classnames_default()("tl-container tl-theme__light",className),onPointerDown:stopEventPropagation,tabIndex:-1,role:"application","aria-label":_options?.branding??"tldraw",children:(0,jsx_runtime.jsx)(OptionalErrorBoundary,{fallback:ErrorFallback,onError:error=>(0,dist_esm.TF)(error,{tags:{origin:"react.tldraw-before-app"}}),children:container&&(0,jsx_runtime.jsx)(LicenseProvider,{licenseKey:rest.licenseKey,children:(0,jsx_runtime.jsx)(ContainerProvider,{container,children:(0,jsx_runtime.jsx)(EditorComponentsProvider,{overrides:components,children:store?store instanceof store_dist_esm.il?(0,jsx_runtime.jsx)(TldrawEditorWithReadyStore,{...withDefaults,store,user}):(0,jsx_runtime.jsx)(TldrawEditorWithLoadingStore,{...withDefaults,store,user}):(0,jsx_runtime.jsx)(TldrawEditorWithOwnStore,{...withDefaults,store,user})})})})})})}));function TldrawEditorWithOwnStore(props){const{defaultName,snapshot,initialData,shapeUtils,bindingUtils,persistenceKey,sessionId,user,assets,migrations}=props,syncedStore=function useLocalStore(options){const[state,setState]=useRefState({status:"loading"});return options=useIdentity_useShallowObjectIdentity(options),(0,react.useEffect)((()=>{const{persistenceKey,sessionId,...rest}=options;if(!persistenceKey)return void setState({status:"not-synced",store:createTLStore(rest)});setState({status:"loading"});const objectURLCache=new dist_esm.l,assets={upload:async(asset,file)=>(await client.db.storeAsset(asset.id,file),{src:asset.id}),resolve:async asset=>asset.props.src?asset.props.src.startsWith("asset:")?await objectURLCache.get(asset,(async()=>{const blob=await client.db.getAsset(asset.id);return blob?URL.createObjectURL(blob):null})):asset.props.src:null,remove:async assetIds=>{await client.db.removeAssets(assetIds)},...rest.assets},store=createTLStore({...rest,assets});let isClosed=!1;const client=new TLLocalSyncClient(store,{sessionId,persistenceKey,onLoad(){isClosed||setState({store,status:"synced-local"})},onLoadError(err){isClosed||setState({status:"error",error:err})}});return()=>{isClosed=!0,client.close()}}),[options,setState]),state}({shapeUtils,bindingUtils,initialData,persistenceKey,sessionId,defaultName,snapshot,assets,migrations});return(0,jsx_runtime.jsx)(TldrawEditorWithLoadingStore,{...props,store:syncedStore,user})}const TldrawEditorWithLoadingStore=(0,react.memo)((function TldrawEditorBeforeLoading({store,user,...rest}){const container=useContainer();(0,react.useLayoutEffect)((()=>{"dark"===user.userPreferences.get().colorScheme&&(container.classList.remove("tl-theme__light"),container.classList.add("tl-theme__dark"))}),[container,user]);const{LoadingScreen:LoadingScreen2}=useEditorComponents();switch(store.status){case"error":throw store.error;case"loading":return LoadingScreen2?(0,jsx_runtime.jsx)(LoadingScreen2,{}):null}return(0,jsx_runtime.jsx)(TldrawEditorWithReadyStore,{...rest,store:store.store,user})})),noAutoFocus=()=>document.location.search.includes("tldraw_preserve_focus");function TldrawEditorWithReadyStore({onMount,children,store,tools,shapeUtils,bindingUtils,user,initialState,autoFocus=!0,inferDarkMode,cameraOptions,textOptions,options,licenseKey,deepLinks:_deepLinks,isShapeHidden,getShapeVisibility,assetUrls}){const{ErrorFallback}=useEditorComponents(),container=useContainer(),[editor,setEditor]=useRefState(null),canvasRef=(0,react.useRef)(null),deepLinks=useIdentity_useShallowObjectIdentity(!0===_deepLinks?{}:_deepLinks),editorOptionsRef=(0,react.useRef)({autoFocus:autoFocus&&!noAutoFocus(),inferDarkMode,initialState,cameraOptions,deepLinks});(0,react.useLayoutEffect)((()=>{editorOptionsRef.current={autoFocus:autoFocus&&!noAutoFocus(),inferDarkMode,initialState,cameraOptions,deepLinks}}),[autoFocus,inferDarkMode,initialState,cameraOptions,deepLinks]),(0,react.useLayoutEffect)((()=>{const{autoFocus:autoFocus2,inferDarkMode:inferDarkMode2,initialState:initialState2,cameraOptions:cameraOptions2,deepLinks:deepLinks2}=editorOptionsRef.current,editor2=new Editor({store,shapeUtils,bindingUtils,tools,getContainer:()=>container,user,initialState:initialState2,autoFocus:autoFocus2,inferDarkMode:inferDarkMode2,cameraOptions:cameraOptions2,textOptions,options,licenseKey,isShapeHidden,getShapeVisibility,fontAssetUrls:assetUrls?.fonts});return editor2.updateViewportScreenBounds(canvasRef.current??container),deepLinks2&&(deepLinks2?.getUrl?editor2.navigateToDeepLink({...deepLinks2,url:deepLinks2.getUrl(editor2)}):editor2.navigateToDeepLink(deepLinks2)),setEditor(editor2),()=>{editor2.dispose()}}),[bindingUtils,container,options,shapeUtils,store,tools,user,setEditor,licenseKey,isShapeHidden,getShapeVisibility,textOptions,assetUrls]),(0,react.useLayoutEffect)((()=>{if(editor)return deepLinks?editor.registerDeepLinkListener(deepLinks):void 0}),[editor,deepLinks]),(0,react.useLayoutEffect)((()=>{editor&&cameraOptions&&editor.setCameraOptions(cameraOptions)}),[editor,cameraOptions]);const crashingError=(0,react.useSyncExternalStore)((0,react.useCallback)((onStoreChange=>editor?(editor.on("crash",onStoreChange),()=>editor.off("crash",onStoreChange)):()=>{}),[editor]),(()=>editor?.getCrashingError()??null));(0,react.useEffect)((function handleFocusOnPointerDownForPreserveFocusMode(){if(editor)return autoFocus&&noAutoFocus()?(editor.getContainer().addEventListener("pointerdown",handleFocusOnPointerDown),document.body.addEventListener("pointerdown",handleBlurOnPointerDown),()=>{editor.getContainer()?.removeEventListener("pointerdown",handleFocusOnPointerDown),document.body.removeEventListener("pointerdown",handleBlurOnPointerDown)}):void 0;function handleFocusOnPointerDown(){editor&&editor.focus()}function handleBlurOnPointerDown(){editor&&editor.blur()}}),[editor,autoFocus]);const[_fontLoadingState,setFontLoadingState]=(0,react.useState)(null);let fontLoadingState=_fontLoadingState;editor!==fontLoadingState?.editor&&(fontLoadingState=null),(0,react.useEffect)((()=>{if(!editor)return;let isCancelled=!1;return setFontLoadingState({editor,isLoaded:!1}),editor.fonts.loadRequiredFontsForCurrentPage(editor.options.maxFontsToLoadBeforeRender).finally((()=>{isCancelled||setFontLoadingState({editor,isLoaded:!0})})),()=>{isCancelled=!0}}),[editor]);const{Canvas,LoadingScreen:LoadingScreen2}=useEditorComponents();return editor&&fontLoadingState?.isLoaded?(0,jsx_runtime.jsx)(OptionalErrorBoundary,{fallback:ErrorFallback,onError:error=>editor.annotateError(error,{origin:"react.tldraw",willCrashApp:!0}),children:crashingError?(0,jsx_runtime.jsx)(Crash,{crashingError}):(0,jsx_runtime.jsx)(EditorProvider,{editor,children:(0,jsx_runtime.jsxs)(Layout,{onMount,children:[children??(Canvas?(0,jsx_runtime.jsx)(Canvas,{},editor.contextId):null),(0,jsx_runtime.jsx)(Watermark,{})]})})}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[LoadingScreen2&&(0,jsx_runtime.jsx)(LoadingScreen2,{}),(0,jsx_runtime.jsx)("div",{className:"tl-canvas",ref:canvasRef})]})}function Layout({children,onMount}){return function useZoomCss(){const editor=useEditor_useEditor(),container=useContainer();react.useEffect((()=>{const setScale=s=>container.style.setProperty("--tl-zoom",s.toString()),setScaleDebounced=(0,dist_esm.sg)(setScale,100),scheduler=new state_dist_esm.VM("useZoomCss",(()=>{editor.getCurrentPageShapeIds().size<300?setScale(editor.getZoomLevel()):setScaleDebounced(editor.getZoomLevel())}));return scheduler.attach(),scheduler.execute(),()=>{scheduler.detach(),setScaleDebounced.cancel()}}),[editor,container])}(),function useCursor(){const editor=useEditor_useEditor(),container=useContainer(),isDarkMode=useIsDarkMode();useQuickReactor("useCursor",(()=>{const{type,rotation}=editor.getInstanceState().cursor;STATIC_CURSORS.includes(type)?container.style.setProperty("--tl-cursor",`var(--tl-cursor-${type})`):container.style.setProperty("--tl-cursor",getCursor(type,rotation,isDarkMode?"white":"black"))}),[editor,container,isDarkMode])}(),function useDarkMode(){const editor=useEditor_useEditor(),container=useContainer(),isDarkMode=useIsDarkMode(),forceSrgb=useValue_useValue(debugFlags.forceSrgb);react.useEffect((()=>{isDarkMode?(container.setAttribute("data-color-mode","dark"),container.classList.remove("tl-theme__light"),container.classList.add("tl-theme__dark")):(container.setAttribute("data-color-mode","light"),container.classList.remove("tl-theme__dark"),container.classList.add("tl-theme__light")),forceSrgb?container.classList.add("tl-theme__force-sRGB"):container.classList.remove("tl-theme__force-sRGB")}),[editor,container,forceSrgb,isDarkMode])}(),function useForceUpdate(){const[_,ss]=(0,react.useState)(0);(0,react.useEffect)((()=>ss((s=>s+1))),[])}(),useOnMount((editor=>{const teardownStore=editor.store.props.onMount(editor),teardownCallback=onMount?.(editor);return()=>{teardownStore?.(),teardownCallback?.()}})),children}function Crash({crashingError}){throw crashingError}function LoadingScreen({children}){return(0,jsx_runtime.jsx)("div",{className:"tl-loading","aria-busy":"true",tabIndex:0,children})}function useOnMount(onMount){const editor=useEditor_useEditor(),onMountEvent=useEvent((editor2=>{let teardown;return editor2.run((()=>{teardown=onMount?.(editor2),editor2.emit("mount")}),{history:"ignore"}),window.tldrawReady=!0,teardown}));react.useLayoutEffect((()=>{if(editor)return onMountEvent?.(editor)}),[editor,onMountEvent])}function HTMLContainer({children,className="",...rest}){return(0,jsx_runtime.jsx)("div",{...rest,className:classnames_default()("tl-html-container",className),children})}class BindingUtil{constructor(editor){this.editor=editor}static props;static migrations;static type}function resizeBox(shape,info,opts={}){const{newPoint,handle,scaleX,scaleY}=info,{minWidth=1,maxWidth=1/0,minHeight=1,maxHeight=1/0}=opts;let w=shape.props.w*scaleX,h=shape.props.h*scaleY;const offset=new Vec(0,0);if(w>0){if(w<minWidth){switch(handle){case"top_left":case"left":case"bottom_left":offset.x=w-minWidth;break;case"top":case"bottom":offset.x=(w-minWidth)/2;break;default:offset.x=0}w=minWidth}}else if(offset.x=w,w=-w,w<minWidth){switch(handle){case"top_left":case"left":case"bottom_left":offset.x=-w;break;default:offset.x=-minWidth}w=minWidth}if(h>0){if(h<minHeight){switch(handle){case"top_left":case"top":case"top_right":offset.y=h-minHeight;break;case"right":case"left":offset.y=(h-minHeight)/2;break;default:offset.y=0}h=minHeight}}else if(offset.y=h,h=-h,h<minHeight){switch(handle){case"top_left":case"top":case"top_right":offset.y=-h;break;default:offset.y=-minHeight}h=minHeight}const{x,y}=offset.rot(shape.rotation).add(newPoint);return{...shape,x,y,props:{w:Math.min(maxWidth,w),h:Math.min(maxHeight,h)}}}class BaseBoxShapeUtil extends ShapeUtil{getGeometry(shape){return new Rectangle2d({width:shape.props.w,height:shape.props.h,isFilled:!0})}onResize(shape,info){return resizeBox(shape,info)}getHandleSnapGeometry(shape){return{points:this.getGeometry(shape).bounds.cornersAndCenter}}getInterpolatedProps(startShape,endShape,t){return{...endShape.props,w:(0,dist_esm.Cc)(startShape.props.w,endShape.props.w,t),h:(0,dist_esm.Cc)(startShape.props.h,endShape.props.h,t)}}}function resizeScaled(shape,{initialBounds,scaleX,scaleY,newPoint,handle}){let scaleDelta;switch(handle){case"bottom_left":case"bottom_right":case"top_left":case"top_right":scaleDelta=Math.max(.01,Math.max(Math.abs(scaleX),Math.abs(scaleY)));break;case"left":case"right":scaleDelta=Math.max(.01,Math.abs(scaleX));break;case"bottom":case"top":scaleDelta=Math.max(.01,Math.abs(scaleY));break;default:throw(0,dist_esm.h6)(handle)}const offset=new Vec(0,0);scaleX<0&&(offset.x=-initialBounds.width*scaleDelta),scaleY<0&&(offset.y=-initialBounds.height*scaleDelta);const{x,y}=Vec.Add(newPoint,offset.rot(shape.rotation));return{x,y,props:{scale:scaleDelta*shape.props.scale}}}class Idle extends StateNode{static id="idle";onPointerDown(info){this.parent.transition("pointing",info)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}}class Pointing extends StateNode{static id="pointing";onPointerMove(info){if(this.editor.inputs.isDragging){const{originPagePoint}=this.editor.inputs,shapeType=this.parent.shapeType,id=createShapeId(),creatingMarkId=this.editor.markHistoryStoppingPoint(`creating_box:${id}`),newPoint=maybeSnapToGrid(originPagePoint,this.editor);this.editor.createShapes([{id,type:shapeType,x:newPoint.x,y:newPoint.y,props:{w:1,h:1}}]).select(id);const parent=this.parent;this.editor.setCurrentTool("select.resizing",{...info,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:parent.onCreate?shape=>parent.onCreate?.(shape):void 0})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint}=this.editor.inputs,shapeType=this.parent.shapeType,id=createShapeId();this.editor.markHistoryStoppingPoint(`creating_box:${id}`),this.editor.createShapes([{id,type:shapeType,x:originPagePoint.x,y:originPagePoint.y}]);const shape=this.editor.getShape(id);if(!shape)return void this.cancel();let{w,h}=shape.props;const delta=new Vec(w/2,h/2),parentTransform=this.editor.getShapeParentTransform(shape);parentTransform&&delta.rot(-parentTransform.rotation());let scale=1;this.editor.user.getIsDynamicResizeMode()&&(scale=1/this.editor.getZoomLevel(),w*=scale,h*=scale,delta.mul(scale));const next=(0,dist_esm.pN)(shape),newPoint=maybeSnapToGrid(new Vec(shape.x-delta.x,shape.y-delta.y),this.editor);next.x=newPoint.x,next.y=newPoint.y,next.props.w=w,next.props.h=h,"scale"in shape.props&&(next.props.scale=scale),this.editor.updateShape(next),this.editor.setSelectedShapes([id]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}}function maybeSnapToGrid(point,editor){const isGridMode=editor.getInstanceState().isGridMode,gridSize=editor.getDocumentSettings().gridSize;return isGridMode?point.clone().snapToGrid(gridSize):point.clone()}class BaseBoxShapeTool extends StateNode{static id="box";static initial="idle";static children(){return[Idle,Pointing]}}function useGlobalMenuIsOpen(id,onChange,onEvent){const rIsOpen=(0,react.useRef)(!1),onOpenChange=(0,react.useCallback)((isOpen2=>{rIsOpen.current=isOpen2,isOpen2?tlmenus.addOpenMenu(id):tlmenus.deleteOpenMenu(id),onChange?.(isOpen2)}),[id,onChange]),isOpen=useValue_useValue("is menu open",(()=>tlmenus.getOpenMenus().includes(id)),[id]);return(0,react.useEffect)((()=>(rIsOpen.current&&(onEvent?.("open-menu"),tlmenus.addOpenMenu(id)),()=>{rIsOpen.current&&(tlmenus.deleteOpenMenu(id),tlmenus.getOpenMenus().forEach((menuId=>{menuId.startsWith(id)&&(onEvent?.("close-menu"),tlmenus.deleteOpenMenu(menuId))})),rIsOpen.current=!1)})),[id,onEvent]),[isOpen,onOpenChange]}function useIsEditing(shapeId){const editor=useEditor_useEditor();return useValue_useValue("isEditing",(()=>editor.getEditingShapeId()===shapeId),[editor,shapeId])}function usePassThroughMouseOverEvents(ref){if(!ref)throw Error("usePassThroughWheelEvents must be passed a ref");const container=useContainer();(0,react.useEffect)((()=>{function onMouseOver(e){if(e.isSpecialRedispatchedEvent)return;preventDefault(e);const cvs=container.querySelector(".tl-canvas");if(!cvs)return;const newEvent=new PointerEvent(e.type,e);newEvent.isSpecialRedispatchedEvent=!0,cvs.dispatchEvent(newEvent)}const elm=ref.current;if(elm)return elm.addEventListener("mouseover",onMouseOver,{passive:!1}),()=>{elm.removeEventListener("mouseover",onMouseOver)}}),[container,ref])}function useSelectionEvents(handle){const editor=useEditor_useEditor();return(0,react.useMemo)((function selectionEvents(){let lastX,lastY;return{onPointerDown:e=>{if(e.isKilled)return;if(e.button===RIGHT_MOUSE_BUTTON)return void editor.dispatch({type:"pointer",target:"selection",handle,name:"right_click",...getPointerInfo(e)});if(0!==e.button)return;const elm=loopToHtmlElement(e.currentTarget);setPointerCapture(elm,e),elm.addEventListener("pointerup",(function releaseCapture(){elm.removeEventListener("pointerup",releaseCapture),releasePointerCapture(elm,e)})),editor.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle,...getPointerInfo(e)}),stopEventPropagation(e)},onPointerMove:function onPointerMove(e){e.isKilled||0===e.button&&(e.clientX===lastX&&e.clientY===lastY||(lastX=e.clientX,lastY=e.clientY,editor.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle,...getPointerInfo(e)})))},onPointerUp:e=>{e.isKilled||0===e.button&&editor.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle,...getPointerInfo(e)})}}}),[editor,handle])}function useTLStore(opts){const[current,setCurrent]=(0,react.useState)((()=>({store:createTLStore(opts),opts})));if(!(0,dist_esm.zK)(current.opts,opts)){const next={store:createTLStore(opts),opts};return setCurrent(next),next.store}return current.store}function getVerticesCountForLength(length,spacing=20){return Math.max(8,Math.ceil(length/spacing))}class Arc2d extends Geometry2d{_center;radius;start;end;largeArcFlag;sweepFlag;measure;angleStart;angleEnd;constructor(config){super({...config,isFilled:!1,isClosed:!1});const{center,sweepFlag,largeArcFlag,start,end}=config;if(start.equals(end))throw Error("Arc must have different start and end points.");this.angleStart=Vec.Angle(center,start),this.angleEnd=Vec.Angle(center,end),this.radius=Vec.Dist(center,start),this.measure=function getArcMeasure(A,B,sweepFlag,largeArcFlag){const m=(B-A)%utils_PI2*2%utils_PI2-(B-A)%utils_PI2;return largeArcFlag?(utils_PI2-Math.abs(m))*(sweepFlag?1:-1):m}(this.angleStart,this.angleEnd,sweepFlag,largeArcFlag),this.start=start,this.end=end,this.sweepFlag=sweepFlag,this.largeArcFlag=largeArcFlag,this._center=center}nearestPoint(point){const{_center,measure,radius,angleEnd,angleStart,start:A,end:B}=this,t=getPointInArcT(measure,angleStart,angleEnd,_center.angle(point));if(t<=0)return A;if(t>=1)return B;const P=Vec.Sub(point,_center).uni().mul(radius).add(_center);let nearest,d,dist=1/0;for(const p of[A,B,P])d=Vec.Dist2(point,p),d<dist&&(nearest=p,dist=d);if(!nearest)throw Error("nearest point not found");return nearest}hitTestLineSegment(A,B){const{_center,radius,measure,angleStart,angleEnd}=this,intersection=intersectLineSegmentCircle(A,B,_center,radius);return null!==intersection&&intersection.some((p=>{const result=getPointInArcT(measure,angleStart,angleEnd,_center.angle(p));return result>=0&&result<=1}))}getVertices(){const{_center,measure,length,radius,angleStart}=this,vertices=[];for(let i=0,n=getVerticesCountForLength(Math.abs(length));i<n+1;i++){const angle=angleStart+i/n*measure;vertices.push(getPointOnCircle(_center,radius,angle))}return vertices}getSvgPathData(first=!0){const{start,end,radius,largeArcFlag,sweepFlag}=this;return`${first?`M${start.toFixed()}`:""} A${radius} ${radius} 0 ${largeArcFlag} ${sweepFlag} ${end.toFixed()}`}getLength(){return Math.abs(this.measure*this.radius)}}class Circle2d extends Geometry2d{constructor(config){super({isClosed:!0,...config}),this.config=config;const{x=0,y=0,radius}=config;this.x=x,this.y=y,this._center=new Vec(radius+x,radius+y),this.radius=radius}_center;radius;x;y;getBounds(){return new Box(this.x,this.y,2*this.radius,2*this.radius)}getVertices(){const{_center,radius}=this,vertices=[];for(let i=0,n=getVerticesCountForLength(utils_PI2*radius);i<n;i++){const angle=i/n*utils_PI2;vertices.push(getPointOnCircle(_center,radius,angle))}return vertices}nearestPoint(point){const{_center,radius}=this;return _center.equals(point)?Vec.AddXY(_center,radius,0):Vec.Sub(point,_center).uni().mul(radius).add(_center)}hitTestLineSegment(A,B,distance=0){const{_center,radius}=this;return null!==intersectLineSegmentCircle(A,B,_center,radius+distance)}getSvgPathData(){const{_center,radius}=this;return`M${_center.x+radius},${_center.y} a${radius},${radius} 0 1,0 ${2*radius},0a${radius},${radius} 0 1,0 -${2*radius},0`}}class CubicBezier2d extends Polyline2d{a;b;c;d;constructor(config){const{start:a,cp1:b,cp2:c,end:d}=config;super({...config,points:[a,d]}),this.a=a,this.b=b,this.c=c,this.d=d}getVertices(){const vertices=[],{a,b,c,d}=this;for(let i=0,n=10;i<=n;i++){const t=i/n;vertices.push(new Vec((1-t)*(1-t)*(1-t)*a.x+(1-t)*(1-t)*3*t*b.x+3*(1-t)*(t*t)*c.x+t*t*t*d.x,(1-t)*(1-t)*(1-t)*a.y+(1-t)*(1-t)*3*t*b.y+3*(1-t)*(t*t)*c.y+t*t*t*d.y))}return vertices}midPoint(){return CubicBezier2d.GetAtT(this,.5)}nearestPoint(A){let nearest,d,p,dist=1/0;for(const edge of this.segments)p=edge.nearestPoint(A),d=Vec.Dist2(p,A),d<dist&&(nearest=p,dist=d);if(!nearest)throw Error("nearest point not found");return nearest}getSvgPathData(first=!0){const{a,b,c,d}=this;return`${first?`M ${a.toFixed()} `:""} C${b.toFixed()} ${c.toFixed()} ${d.toFixed()}`}static GetAtT(segment,t){const{a,b,c,d}=segment;return new Vec((1-t)*(1-t)*(1-t)*a.x+(1-t)*(1-t)*3*t*b.x+3*(1-t)*(t*t)*c.x+t*t*t*d.x,(1-t)*(1-t)*(1-t)*a.y+(1-t)*(1-t)*3*t*b.y+3*(1-t)*(t*t)*c.y+t*t*t*d.y)}getLength(filters,precision=32){let n1,p1=this.a,length=0;for(let i=1;i<=precision;i++)n1=CubicBezier2d.GetAtT(this,i/precision),length+=Vec.Dist(p1,n1),p1=n1;return length}}class CubicSpline2d extends Geometry2d{points;constructor(config){super({...config,isClosed:!1,isFilled:!1});const{points}=config;this.points=points}_segments;get segments(){if(!this._segments){this._segments=[];const{points}=this,len=points.length,last=len-2,k=1.25;for(let i=0;i<len-1;i++){const p0=0===i?points[0]:points[i-1],p1=points[i],p2=points[i+1],p3=i===last?p2:points[i+2],start=p1,cp1=0===i?p0:new Vec(p1.x+(p2.x-p0.x)/6*k,p1.y+(p2.y-p0.y)/6*k),cp2=i===last?p2:new Vec(p2.x-(p3.x-p1.x)/6*k,p2.y-(p3.y-p1.y)/6*k),end=p2;this._segments.push(new CubicBezier2d({start,cp1,cp2,end}))}}return this._segments}getLength(){return this.segments.reduce(((acc,segment)=>acc+segment.length),0)}getVertices(){const vertices=this.segments.reduce(((acc,segment)=>acc.concat(segment.vertices)),[]);return vertices.push(this.points[this.points.length-1]),vertices}nearestPoint(A){let nearest,d,p,dist=1/0;for(const segment of this.segments)p=segment.nearestPoint(A),d=Vec.Dist2(p,A),d<dist&&(nearest=p,dist=d);if(!nearest)throw Error("nearest point not found");return nearest}hitTestLineSegment(A,B){return this.segments.some((segment=>segment.hitTestLineSegment(A,B)))}getSvgPathData(){let d=this.segments.reduce(((d2,segment,i)=>d2+segment.getSvgPathData(0===i)),"");return this.isClosed&&(d+="Z"),d}}class Ellipse2d extends Geometry2d{constructor(config){super({...config,isClosed:!0}),this.config=config;const{width,height}=config;this.w=width,this.h=height}w;h;_edges;get edges(){if(!this._edges){const{vertices}=this;this._edges=[];for(let i=0,n=vertices.length;i<n;i++){const start=vertices[i],end=vertices[(i+1)%n];this._edges.push(new Edge2d({start,end}))}}return this._edges}getVertices(){const cx=Math.max(1,this.w)/2,cy=Math.max(1,this.h)/2,q=Math.pow(cx-cy,2)/Math.pow(cx+cy,2),len=getVerticesCountForLength(utils_PI*(cx+cy)*(1+3*q/(10+Math.sqrt(4-3*q)))),step=utils_PI2/len,a=Math.cos(step),b=Math.sin(step);let sin=0,cos=1,ts=0,tc=1;const vertices=Array(len);for(let i=0;i<len;i++)vertices[i]=new Vec(cx+cx*cos,cy+cy*sin),ts=b*cos+a*sin,tc=a*cos-b*sin,sin=ts,cos=tc;return vertices}nearestPoint(A){let nearest,d,p,dist=1/0;for(const edge of this.edges)p=edge.nearestPoint(A),d=Vec.Dist2(p,A),d<dist&&(nearest=p,dist=d);if(!nearest)throw Error("nearest point not found");return nearest}hitTestLineSegment(A,B){return this.edges.some((edge=>edge.hitTestLineSegment(A,B)))}getBounds(){return new Box(0,0,this.w,this.h)}getLength(){const{w,h}=this,cx=w/2,cy=h/2;return perimeterOfEllipse(Math.max(0,cx),Math.max(0,cy))}getSvgPathData(first=!1){const{w,h}=this,cx=w/2,cy=h/2,rx=Math.max(0,cx),ry=Math.max(0,cy);return`${first?`M${cx-rx},${cy}`:""} a${rx},${ry},0,1,1,${2*rx},0a${rx},${ry},0,1,1,-${2*rx},0`}}class Stadium2d extends Geometry2d{constructor(config){super({...config,isClosed:!0}),this.config=config;const{width:w,height:h}=config;if(this.w=w,this.h=h,h>w){const r=w/2;this.a=new Arc2d({start:new Vec(0,r),end:new Vec(w,r),center:new Vec(w/2,r),sweepFlag:1,largeArcFlag:1}),this.b=new Edge2d({start:new Vec(w,r),end:new Vec(w,h-r)}),this.c=new Arc2d({start:new Vec(w,h-r),end:new Vec(0,h-r),center:new Vec(w/2,h-r),sweepFlag:1,largeArcFlag:1}),this.d=new Edge2d({start:new Vec(0,h-r),end:new Vec(0,r)})}else{const r=h/2;this.a=new Arc2d({start:new Vec(r,h),end:new Vec(r,0),center:new Vec(r,r),sweepFlag:1,largeArcFlag:1}),this.b=new Edge2d({start:new Vec(r,0),end:new Vec(w-r,0)}),this.c=new Arc2d({start:new Vec(w-r,0),end:new Vec(w-r,h),center:new Vec(w-r,r),sweepFlag:1,largeArcFlag:1}),this.d=new Edge2d({start:new Vec(w-r,h),end:new Vec(r,h)})}}w;h;a;b;c;d;nearestPoint(A){let nearest,_d,p,dist=1/0;const{a,b,c,d}=this;for(const part of[a,b,c,d])p=part.nearestPoint(A),_d=Vec.Dist2(p,A),_d<dist&&(nearest=p,dist=_d);if(!nearest)throw Error("nearest point not found");return nearest}hitTestLineSegment(A,B){const{a,b,c,d}=this;return[a,b,c,d].some((edge=>edge.hitTestLineSegment(A,B)))}getVertices(){const{a,b,c,d}=this;return[a,b,c,d].reduce(((a2,p)=>(a2.push(...p.vertices),a2)),[])}getBounds(){return new Box(0,0,this.w,this.h)}getLength(){const{h,w}=this;return h>w?2*(utils_PI*(w/2)+(h-w)):2*(utils_PI*(h/2)+(w-h))}getSvgPathData(){const{a,b,c,d}=this;return[a,b,c,d].map(((p,i)=>p.getSvgPathData(0===i))).join(" ")+" Z"}}var dist=__webpack_require__("./node_modules/@tiptap/core/dist/index.js"),prosemirror_model_dist=__webpack_require__("./node_modules/prosemirror-model/dist/index.js");function getFontsFromRichText(editor,richText,initialState){const{tipTapConfig,addFontsFromNode}=editor.getTextOptions();(0,dist_esm.vA)(tipTapConfig,"textOptions.tipTapConfig must be set to use rich text"),(0,dist_esm.vA)(addFontsFromNode,"textOptions.addFontsFromNode must be set to use rich text");const schema=(0,dist._w)(tipTapConfig.extensions??[]),rootNode=prosemirror_model_dist.bP.fromJSON(schema,richText),fonts=new Set;function addFont(font){fonts.add(font)}return function visit(node,state){state=addFontsFromNode(node,state,addFont);for(const child of node.children)visit(child,state)}(rootNode,initialState),Array.from(fonts)}function openWindow(url,target="_blank"){runtime.openWindow(url,target)}"undefined"!=typeof window&&(window.__tldraw__hardReset=async function hardReset({shouldReload=!0}={}){(0,dist_esm.D6)();for(const instance of LocalIndexedDb.connectedInstances)await instance.close();await Promise.all(getAllIndexDbNames().map((db=>deleteDB(db)))),(0,dist_esm.sw)(),shouldReload&&window.location.reload()}),(0,dist_esm.lF)("@tldraw/editor","3.13.1","esm")},"./node_modules/@tldraw/state/dist-esm/index.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Ml:()=>EMPTY_ARRAY,VM:()=>EffectScheduler,c2:()=>RESET_VALUE,UP:()=>UNINITIALIZED,eU:()=>atom,EW:()=>computed,_O:()=>isUninitialized,wv:()=>react,Px:()=>reactor,hL:()=>transact,Pm:()=>unsafe__withoutCapture,_D:()=>withDiff});var dist_esm=__webpack_require__("./node_modules/@tldraw/utils/dist-esm/index.mjs");function isChild(x){return x&&"object"==typeof x&&"parents"in x}function haveParentsChanged(child){for(let i=0,n=child.parents.length;i<n;i++)if(child.parents[i].__unsafe__getWithoutCapture(!0),child.parents[i].lastChangedEpoch!==child.parentEpochs[i])return!0;return!1}function detach(parent,child){if(parent.children.remove(child)&&parent.children.isEmpty&&isChild(parent))for(let i=0,n=parent.parents.length;i<n;i++)detach(parent.parents[i],parent)}function attach(parent,child){if(parent.children.add(child)&&isChild(parent))for(let i=0,n=parent.parents.length;i<n;i++)attach(parent.parents[i],parent)}function equals(a,b){return a===b||Object.is(a,b)||Boolean(a&&b&&"function"==typeof a.equals&&a.equals(b))}function singleton(key,init){const symbol=Symbol.for(`com.tldraw.state/${key}`),global=globalThis;return global[symbol]??=init(),global[symbol]}const EMPTY_ARRAY=singleton("empty_array",(()=>Object.freeze([])));class ArraySet{arraySize=0;array=Array(8);set=null;get isEmpty(){if(this.array)return 0===this.arraySize;if(this.set)return 0===this.set.size;throw new Error("no set or array")}add(elem){if(this.array){return-1===this.array.indexOf(elem)&&(this.arraySize<8?(this.array[this.arraySize]=elem,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(elem),!0))}if(this.set)return!this.set.has(elem)&&(this.set.add(elem),!0);throw new Error("no set or array")}remove(elem){if(this.array){const idx=this.array.indexOf(elem);return-1!==idx&&(this.array[idx]=void 0,this.arraySize--,idx!==this.arraySize&&(this.array[idx]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return!!this.set.has(elem)&&(this.set.delete(elem),!0);throw new Error("no set or array")}visit(visitor){if(this.array)for(let i=0;i<this.arraySize;i++){const elem=this.array[i];void 0!==elem&&visitor(elem)}else{if(!this.set)throw new Error("no set or array");this.set.forEach(visitor)}}*[Symbol.iterator](){if(this.array)for(let i=0;i<this.arraySize;i++){const elem=this.array[i];void 0!==elem&&(yield elem)}else{if(!this.set)throw new Error("no set or array");yield*this.set}}has(elem){return this.array?-1!==this.array.indexOf(elem):this.set.has(elem)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}const RESET_VALUE=Symbol.for("com.tldraw.state/RESET_VALUE");class HistoryBuffer{constructor(capacity){this.capacity=capacity,this.buffer=new Array(capacity)}index=0;buffer;pushEntry(lastComputedEpoch,currentEpoch,diff){void 0!==diff&&(diff!==RESET_VALUE?(this.buffer[this.index]=[lastComputedEpoch,currentEpoch,diff],this.index=(this.index+1)%this.capacity):this.clear())}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(sinceEpoch){const{index,capacity,buffer}=this;for(let i=0;i<capacity;i++){const offset=(index-1+capacity-i)%capacity,elem=buffer[offset];if(!elem)return RESET_VALUE;const[fromEpoch,toEpoch]=elem;if(0===i&&sinceEpoch>=toEpoch)return[];if(fromEpoch<=sinceEpoch&&sinceEpoch<toEpoch){const len=i+1,result=new Array(len);for(let j=0;j<len;j++)result[j]=buffer[(offset+j)%capacity][2];return result}}return RESET_VALUE}}class __EffectScheduler__{constructor(name,runEffect,options){this.name=name,this.runEffect=runEffect,this._scheduleEffect=options?.scheduleEffect}_isActivelyListening=!1;get isActivelyListening(){return this._isActivelyListening}lastTraversedEpoch=-1;lastReactedEpoch=-1;_scheduleCount=0;__debug_ancestor_epochs__=null;get scheduleCount(){return this._scheduleCount}parentSet=new ArraySet;parentEpochs=[];parents=[];_scheduleEffect;maybeScheduleEffect(){this._isActivelyListening&&this.lastReactedEpoch!==getGlobalEpoch()&&(!this.parents.length||haveParentsChanged(this)?this.scheduleEffect():this.lastReactedEpoch=getGlobalEpoch())}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}maybeExecute=()=>{this._isActivelyListening&&this.execute()};attach(){this._isActivelyListening=!0;for(let i=0,n=this.parents.length;i<n;i++)attach(this.parents[i],this)}detach(){this._isActivelyListening=!1;for(let i=0,n=this.parents.length;i<n;i++)detach(this.parents[i],this)}execute(){try{startCapturingParents(this);const currentEpoch=getGlobalEpoch(),result=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=currentEpoch,result}finally{stopCapturingParents()}}}const EffectScheduler=singleton("EffectScheduler",(()=>__EffectScheduler__));function react(name,fn,options){const scheduler=new EffectScheduler(name,fn,options);return scheduler.attach(),scheduler.scheduleEffect(),()=>{scheduler.detach()}}function reactor(name,fn,options){const scheduler=new EffectScheduler(name,fn,options);return{scheduler,start:options2=>{const force=options2?.force??!1;scheduler.attach(),force?scheduler.scheduleEffect():scheduler.maybeScheduleEffect()},stop:()=>{scheduler.detach()}}}class Transaction{constructor(parent){this.parent=parent}initialAtomValues=new Map;get isRoot(){return null===this.parent}commit(){if(inst.globalIsReacting)for(const atom of this.initialAtomValues.keys())traverseAtomForCleanup(atom);else this.isRoot?flushChanges(this.initialAtomValues.keys()):this.initialAtomValues.forEach(((value,atom)=>{this.parent.initialAtomValues.has(atom)||this.parent.initialAtomValues.set(atom,value)}))}abort(){inst.globalEpoch++,this.initialAtomValues.forEach(((value,atom)=>{atom.set(value),atom.historyBuffer?.clear()})),this.commit()}}const inst=singleton("transactions",(()=>({globalEpoch:0,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:0})));function getGlobalEpoch(){return inst.globalEpoch}function traverse(reactors,child){child.lastTraversedEpoch!==inst.globalEpoch&&(child.lastTraversedEpoch=inst.globalEpoch,child instanceof EffectScheduler?reactors.add(child):child.children.visit((c=>traverse(reactors,c))))}function flushChanges(atoms){if(inst.globalIsReacting)throw new Error("flushChanges cannot be called during a reaction");const outerTxn=inst.currentTransaction;try{inst.currentTransaction=null,inst.globalIsReacting=!0,inst.reactionEpoch=inst.globalEpoch;const reactors=new Set;for(const atom of atoms)atom.children.visit((child=>traverse(reactors,child)));for(const r of reactors)r.maybeScheduleEffect();let updateDepth=0;for(;inst.cleanupReactors?.size;){if(updateDepth++>1e3)throw new Error("Reaction update depth limit exceeded");const reactors2=inst.cleanupReactors;inst.cleanupReactors=null;for(const r of reactors2)r.maybeScheduleEffect()}}finally{inst.cleanupReactors=null,inst.globalIsReacting=!1,inst.currentTransaction=outerTxn}}function traverseAtomForCleanup(atom){const rs=inst.cleanupReactors??=new Set;atom.children.visit((child=>traverse(rs,child)))}function transact(fn){return inst.currentTransaction?fn():function transaction(fn){const txn=new Transaction(inst.currentTransaction);inst.currentTransaction=txn;try{let result,rollback=!1;try{result=fn((()=>rollback=!0))}catch(e){throw txn.abort(),e}return rollback?txn.abort():txn.commit(),result}finally{inst.currentTransaction=inst.currentTransaction.parent}}(fn)}let didWarnComputedGetter=!1;const UNINITIALIZED=Symbol.for("com.tldraw.state/UNINITIALIZED");function isUninitialized(value){return value===UNINITIALIZED}const WithDiff=singleton("WithDiff",(()=>class WithDiff{constructor(value,diff){this.value=value,this.diff=diff}}));function withDiff(value,diff){return new WithDiff(value,diff)}class __UNSAFE__Computed{constructor(name,derive,options){this.name=name,this.derive=derive,options?.historyLength&&(this.historyBuffer=new HistoryBuffer(options.historyLength)),this.computeDiff=options?.computeDiff,this.isEqual=options?.isEqual??equals}lastChangedEpoch=-1;lastTraversedEpoch=-1;__debug_ancestor_epochs__=null;lastCheckedEpoch=-1;parentSet=new ArraySet;parents=[];parentEpochs=[];children=new ArraySet;get isActivelyListening(){return!this.children.isEmpty}historyBuffer;state=UNINITIALIZED;error=null;computeDiff;isEqual;__unsafe__getWithoutCapture(ignoreErrors){const isNew=-1===this.lastChangedEpoch,globalEpoch=getGlobalEpoch();if(!isNew&&(this.lastCheckedEpoch===globalEpoch||this.isActivelyListening&&function getIsReacting(){return inst.globalIsReacting}()&&this.lastTraversedEpoch<function getReactionEpoch(){return inst.reactionEpoch}()||!haveParentsChanged(this))){if(this.lastCheckedEpoch=globalEpoch,this.error){if(ignoreErrors)return this.state;throw this.error.thrownValue}return this.state}try{startCapturingParents(this);const result=this.derive(this.state,this.lastCheckedEpoch),newState=result instanceof WithDiff?result.value:result,isUninitialized2=this.state===UNINITIALIZED;if(isUninitialized2||!this.isEqual(newState,this.state)){if(this.historyBuffer&&!isUninitialized2){const diff=result instanceof WithDiff?result.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,getGlobalEpoch(),diff??this.computeDiff?.(this.state,newState,this.lastCheckedEpoch,getGlobalEpoch())??RESET_VALUE)}this.lastChangedEpoch=getGlobalEpoch(),this.state=newState}return this.error=null,this.lastCheckedEpoch=getGlobalEpoch(),this.state}catch(e){if(this.state!==UNINITIALIZED&&(this.state=UNINITIALIZED,this.lastChangedEpoch=getGlobalEpoch()),this.lastCheckedEpoch=getGlobalEpoch(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:e},!ignoreErrors)throw e;return this.state}finally{stopCapturingParents()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{maybeCaptureParent(this)}}getDiffSince(epoch){return this.__unsafe__getWithoutCapture(!0),maybeCaptureParent(this),epoch>=this.lastChangedEpoch?EMPTY_ARRAY:this.historyBuffer?.getChangesSince(epoch)??RESET_VALUE}}const Computed_Computed=singleton("Computed",(()=>__UNSAFE__Computed));function computedDecorator(options={},args){if(2===args.length){const[originalMethod,context]=args;return function computedMethodTc39Decorator(options,compute,context){(0,dist_esm.vA)("method"===context.kind,"@computed can only be used on methods");const derivationKey=Symbol.for("__@tldraw/state__computed__"+String(context.name)),fn=function(){let d=this[derivationKey];return d||(d=new Computed_Computed(String(context.name),compute.bind(this),options),Object.defineProperty(this,derivationKey,{enumerable:!1,configurable:!1,writable:!1,value:d})),d.get()};return fn[isComputedMethodKey]=!0,fn}(options,originalMethod,context)}{const[_target,key,descriptor]=args;return descriptor.get?(function logComputedGetterWarning(){didWarnComputedGetter||(didWarnComputedGetter=!0,console.warn("Using `@computed` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use `@computed` as a decorator for methods.\n\n// Before\n@computed\nget foo() {\n\treturn 'foo'\n}\n\n// After\n@computed\ngetFoo() {\n\treturn 'foo'\n}\n"))}(),function computedGetterLegacyDecorator(options={},_target,key,descriptor){const originalMethod=descriptor.get,derivationKey=Symbol.for("__@tldraw/state__computed__"+key);return descriptor.get=function(){let d=this[derivationKey];return d||(d=new Computed_Computed(key,originalMethod.bind(this),options),Object.defineProperty(this,derivationKey,{enumerable:!1,configurable:!1,writable:!1,value:d})),d.get()},descriptor}(options,0,key,descriptor)):function computedMethodLegacyDecorator(options={},_target,key,descriptor){const originalMethod=descriptor.value,derivationKey=Symbol.for("__@tldraw/state__computed__"+key);return descriptor.value=function(){let d=this[derivationKey];return d||(d=new Computed_Computed(key,originalMethod.bind(this),options),Object.defineProperty(this,derivationKey,{enumerable:!1,configurable:!1,writable:!1,value:d})),d.get()},descriptor.value[isComputedMethodKey]=!0,descriptor}(options,0,key,descriptor)}}const isComputedMethodKey="@@__isComputedMethod__@@";function computed(){if(1===arguments.length){const options=arguments[0];return(...args)=>computedDecorator(options,args)}return"string"==typeof arguments[0]?new Computed_Computed(arguments[0],arguments[1],arguments[2]):computedDecorator(void 0,arguments)}function isComputed(value){return value&&value instanceof Computed_Computed}class CaptureStackFrame{constructor(below,child){this.below=below,this.child=child}offset=0;maybeRemoved}const capture_inst=singleton("capture",(()=>({stack:null})));function unsafe__withoutCapture(fn){const oldStack=capture_inst.stack;capture_inst.stack=null;try{return fn()}finally{capture_inst.stack=oldStack}}function startCapturingParents(child){if(capture_inst.stack=new CaptureStackFrame(capture_inst.stack,child),child.__debug_ancestor_epochs__){const previousAncestorEpochs=child.__debug_ancestor_epochs__;child.__debug_ancestor_epochs__=null;for(const p of child.parents)p.__unsafe__getWithoutCapture(!0);!function logChangedAncestors(child,ancestorEpochs){const changeTree=collectChangedAncestors(child,ancestorEpochs);if(0===Object.keys(changeTree).length)return void console.log(`Effect(${child.name}) was executed manually.`);let str=isComputed(child)?`Computed(${child.name}) is recomputing because:`:`Effect(${child.name}) is executing because:`;function logParent(tree,indent){const indentStr="\n"+" ".repeat(indent)+"â³ ";for(const[name,val]of Object.entries(tree))val?(str+=`${indentStr}Computed(${name}) changed`,logParent(val,indent+2)):str+=`${indentStr}Atom(${name}) changed`}logParent(changeTree,1),console.log(str)}(child,previousAncestorEpochs)}child.parentSet.clear()}function stopCapturingParents(){const frame=capture_inst.stack;if(capture_inst.stack=frame.below,frame.offset<frame.child.parents.length){for(let i=frame.offset;i<frame.child.parents.length;i++){const maybeRemovedParent=frame.child.parents[i];frame.child.parentSet.has(maybeRemovedParent)||detach(maybeRemovedParent,frame.child)}frame.child.parents.length=frame.offset,frame.child.parentEpochs.length=frame.offset}if(frame.maybeRemoved)for(let i=0;i<frame.maybeRemoved.length;i++){const maybeRemovedParent=frame.maybeRemoved[i];frame.child.parentSet.has(maybeRemovedParent)||detach(maybeRemovedParent,frame.child)}frame.child.__debug_ancestor_epochs__&&captureAncestorEpochs(frame.child,frame.child.__debug_ancestor_epochs__)}function maybeCaptureParent(p){if(capture_inst.stack){if(capture_inst.stack.child.parentSet.has(p))return;if(capture_inst.stack.child.parentSet.add(p),capture_inst.stack.child.isActivelyListening&&attach(p,capture_inst.stack.child),capture_inst.stack.offset<capture_inst.stack.child.parents.length){const maybeRemovedParent=capture_inst.stack.child.parents[capture_inst.stack.offset];maybeRemovedParent!==p&&(capture_inst.stack.maybeRemoved?capture_inst.stack.maybeRemoved.push(maybeRemovedParent):capture_inst.stack.maybeRemoved=[maybeRemovedParent])}capture_inst.stack.child.parents[capture_inst.stack.offset]=p,capture_inst.stack.child.parentEpochs[capture_inst.stack.offset]=p.lastChangedEpoch,capture_inst.stack.offset++}}function captureAncestorEpochs(child,ancestorEpochs){for(let i=0;i<child.parents.length;i++){const parent=child.parents[i],epoch=child.parentEpochs[i];ancestorEpochs.set(parent,epoch),isComputed(parent)&&captureAncestorEpochs(parent,ancestorEpochs)}return ancestorEpochs}function collectChangedAncestors(child,ancestorEpochs){const changeTree={};for(let i=0;i<child.parents.length;i++){const parent=child.parents[i];if(!ancestorEpochs.has(parent))continue;const prevEpoch=ancestorEpochs.get(parent);parent.lastChangedEpoch!==prevEpoch&&(isComputed(parent)?changeTree[parent.name]=collectChangedAncestors(parent,ancestorEpochs):changeTree[parent.name]=null)}return changeTree}class __Atom__{constructor(name,current,options){this.name=name,this.current=current,this.isEqual=options?.isEqual??null,options&&(options.historyLength&&(this.historyBuffer=new HistoryBuffer(options.historyLength)),this.computeDiff=options.computeDiff)}isEqual;computeDiff;lastChangedEpoch=getGlobalEpoch();children=new ArraySet;historyBuffer;__unsafe__getWithoutCapture(_ignoreErrors){return this.current}get(){return maybeCaptureParent(this),this.current}set(value,diff){if(this.isEqual?.(this.current,value)??equals(this.current,value))return this.current;!function advanceGlobalEpoch(){inst.globalEpoch++}(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,getGlobalEpoch(),diff??this.computeDiff?.(this.current,value,this.lastChangedEpoch,getGlobalEpoch())??RESET_VALUE),this.lastChangedEpoch=getGlobalEpoch();const oldValue=this.current;return this.current=value,function atomDidChange(atom,previousValue){inst.currentTransaction?inst.currentTransaction.initialAtomValues.has(atom)||inst.currentTransaction.initialAtomValues.set(atom,previousValue):inst.globalIsReacting?traverseAtomForCleanup(atom):flushChanges([atom])}(this,oldValue),value}update(updater){return this.set(updater(this.current))}getDiffSince(epoch){return maybeCaptureParent(this),epoch>=this.lastChangedEpoch?EMPTY_ARRAY:this.historyBuffer?.getChangesSince(epoch)??RESET_VALUE}}const Atom_Atom=singleton("Atom",(()=>__Atom__));function atom(name,initialValue,options){return new Atom_Atom(name,initialValue,options)}if(1!==singleton("apiVersion",(()=>1)))throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");(0,dist_esm.lF)("@tldraw/state","3.13.1","esm")},"./node_modules/@tldraw/store/dist-esm/index.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{_j:()=>AtomMap,zq:()=>IncrementalSetConstructor,ee:()=>RecordType,il:()=>Store,fX:()=>StoreSchema,uY:()=>createComputedCache,L4:()=>createEmptyRecordsDiff,bo:()=>createMigrationIds,_B:()=>createMigrationSequence,XD:()=>createRecordMigrationSequence,WE:()=>createRecordType,RF:()=>isRecordsDiffEmpty,E8:()=>reverseRecordsDiff,Dm:()=>squashRecordDiffs,Fl:()=>squashRecordDiffsMutable});var dist_esm=__webpack_require__("./node_modules/@tldraw/utils/dist-esm/index.mjs"),state_dist_esm=__webpack_require__("./node_modules/@tldraw/state/dist-esm/index.mjs");function smi(i32){return i32>>>1&1073741824|3221225471&i32}const defaultValueOf=Object.prototype.valueOf;function hash(o){if(null==o)return hashNullish(o);if("function"==typeof o.hashCode)return smi(o.hashCode(o));const v=function ImmutableMap_valueOf(obj){return obj.valueOf!==defaultValueOf&&"function"==typeof obj.valueOf?obj.valueOf(obj):obj}(o);if(null==v)return hashNullish(v);switch(typeof v){case"boolean":return v?1108378657:1108378656;case"number":return function hashNumber(n){if(n!=n||n===1/0)return 0;let hash2=0|n;hash2!==n&&(hash2^=4294967295*n);for(;n>4294967295;)hash2^=n/=4294967295;return smi(hash2)}(v);case"string":return v.length>STRING_HASH_CACHE_MIN_STRLEN?function cachedHashString(string){let hashed=stringHashCache[string];void 0===hashed&&(hashed=hashString(string),STRING_HASH_CACHE_SIZE===STRING_HASH_CACHE_MAX_SIZE&&(STRING_HASH_CACHE_SIZE=0,stringHashCache={}),STRING_HASH_CACHE_SIZE++,stringHashCache[string]=hashed);return hashed}(v):hashString(v);case"object":case"function":return function hashJSObj(obj){let hashed=weakMap.get(obj);if(void 0!==hashed)return hashed;return hashed=nextHash(),weakMap.set(obj,hashed),hashed}(v);case"symbol":return function hashSymbol(sym){let hashed=symbolMap[sym];if(void 0!==hashed)return hashed;return hashed=nextHash(),symbolMap[sym]=hashed,hashed}(v);default:if("function"==typeof v.toString)return hashString(v.toString());throw new Error("Value type "+typeof v+" cannot be hashed.")}}function hashNullish(nullish){return null===nullish?1108378658:1108378659}function hashString(string){let hashed=0;for(let ii=0;ii<string.length;ii++)hashed=31*hashed+string.charCodeAt(ii)|0;return smi(hashed)}function nextHash(){const nextHash2=++_objHashUID;return 1073741824&_objHashUID&&(_objHashUID=0),nextHash2}const weakMap=new WeakMap,symbolMap=Object.create(null);let _objHashUID=0;const STRING_HASH_CACHE_MIN_STRLEN=16,STRING_HASH_CACHE_MAX_SIZE=255;let STRING_HASH_CACHE_SIZE=0,stringHashCache={};const NOT_SET={};function SetRef(ref){ref&&(ref.value=!0)}function arrCopy(arr,offset){offset=offset||0;const len=Math.max(0,arr.length-offset),newArr=new Array(len);for(let ii=0;ii<len;ii++)newArr[ii]=arr[ii+offset];return newArr}const is=Object.is;class OwnerID{}class ImmutableMap{_root;size;__ownerID;__hash;__altered;constructor(value){return null==value?emptyMap():value instanceof ImmutableMap?value:emptyMap().withMutations((map=>{for(const[k,v]of value)map.set(k,v)}))}get(k,notSetValue){return this._root?this._root.get(0,void 0,k,notSetValue):notSetValue}set(k,v){return updateMap(this,k,v)}delete(k){return updateMap(this,k,NOT_SET)}deleteAll(keys){return this.withMutations((map=>{for(const key of keys)map.delete(key)}))}__ensureOwner(ownerID){return ownerID===this.__ownerID?this:ownerID?makeMap(this.size,this._root,ownerID,this.__hash):0===this.size?emptyMap():(this.__ownerID=ownerID,this.__altered=!1,this)}withMutations(fn){const mutable=this.asMutable();return fn(mutable),mutable.wasAltered()?mutable.__ensureOwner(this.__ownerID):this}wasAltered(){return this.__altered}asMutable(){return this.__ownerID?this:this.__ensureOwner(new OwnerID)}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}entries(){return new MapIterator(this,ITERATE_ENTRIES,!1)}keys(){return new MapIterator(this,ITERATE_KEYS,!1)}values(){return new MapIterator(this,ITERATE_VALUES,!1)}}class ArrayMapNode{constructor(ownerID,entries){this.ownerID=ownerID,this.entries=entries}get(_shift,_keyHash,key,notSetValue){const entries=this.entries;for(let ii=0,len=entries.length;ii<len;ii++)if(is(key,entries[ii][0]))return entries[ii][1];return notSetValue}update(ownerID,_shift,_keyHash,key,value,didChangeSize,didAlter){const removed=value===NOT_SET,entries=this.entries;let idx=0;const len=entries.length;for(;idx<len&&!is(key,entries[idx][0]);idx++);const exists=idx<len;if(exists?entries[idx][1]===value:removed)return this;if(SetRef(didAlter),(removed||!exists)&&SetRef(didChangeSize),removed&&1===entries.length)return;if(!exists&&!removed&&entries.length>=MAX_ARRAY_MAP_SIZE)return function createNodes(ownerID,entries,key,value){ownerID||(ownerID=new OwnerID);let node=new ValueNode(ownerID,hash(key),[key,value]);for(let ii=0;ii<entries.length;ii++){const entry=entries[ii];node=node.update(ownerID,0,void 0,entry[0],entry[1])}return node}(ownerID,entries,key,value);const isEditable=ownerID&&ownerID===this.ownerID,newEntries=isEditable?entries:arrCopy(entries);return exists?removed?idx===len-1?newEntries.pop():newEntries[idx]=newEntries.pop():newEntries[idx]=[key,value]:newEntries.push([key,value]),isEditable?(this.entries=newEntries,this):new ArrayMapNode(ownerID,newEntries)}}class BitmapIndexedNode{constructor(ownerID,bitmap,nodes){this.ownerID=ownerID,this.bitmap=bitmap,this.nodes=nodes}get(shift,keyHash,key,notSetValue){void 0===keyHash&&(keyHash=hash(key));const bit=1<<(31&(0===shift?keyHash:keyHash>>>shift)),bitmap=this.bitmap;return bitmap&bit?this.nodes[popCount(bitmap&bit-1)].get(shift+5,keyHash,key,notSetValue):notSetValue}update(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){void 0===keyHash&&(keyHash=hash(key));const keyHashFrag=31&(0===shift?keyHash:keyHash>>>shift),bit=1<<keyHashFrag,bitmap=this.bitmap,exists=!!(bitmap&bit);if(!exists&&value===NOT_SET)return this;const idx=popCount(bitmap&bit-1),nodes=this.nodes,node=exists?nodes[idx]:void 0,newNode=updateNode(node,ownerID,shift+5,keyHash,key,value,didChangeSize,didAlter);if(newNode===node)return this;if(!exists&&newNode&&nodes.length>=MAX_BITMAP_INDEXED_SIZE)return function expandNodes(ownerID,nodes,bitmap,including,node){let count=0;const expandedNodes=new Array(32);for(let ii=0;0!==bitmap;ii++,bitmap>>>=1)expandedNodes[ii]=1&bitmap?nodes[count++]:void 0;return expandedNodes[including]=node,new HashArrayMapNode(ownerID,count+1,expandedNodes)}(ownerID,nodes,bitmap,keyHashFrag,newNode);if(exists&&!newNode&&2===nodes.length&&isLeafNode(nodes[1^idx]))return nodes[1^idx];if(exists&&newNode&&1===nodes.length&&isLeafNode(newNode))return newNode;const isEditable=ownerID&&ownerID===this.ownerID,newBitmap=exists?newNode?bitmap:bitmap^bit:bitmap|bit,newNodes=exists?newNode?setAt(nodes,idx,newNode,isEditable):function spliceOut(array,idx,canEdit){const newLen=array.length-1;if(canEdit&&idx===newLen)return array.pop(),array;const newArray=new Array(newLen);let after=0;for(let ii=0;ii<newLen;ii++)ii===idx&&(after=1),newArray[ii]=array[ii+after];return newArray}(nodes,idx,isEditable):function spliceIn(array,idx,val,canEdit){const newLen=array.length+1;if(canEdit&&idx+1===newLen)return array[idx]=val,array;const newArray=new Array(newLen);let after=0;for(let ii=0;ii<newLen;ii++)ii===idx?(newArray[ii]=val,after=-1):newArray[ii]=array[ii+after];return newArray}(nodes,idx,newNode,isEditable);return isEditable?(this.bitmap=newBitmap,this.nodes=newNodes,this):new BitmapIndexedNode(ownerID,newBitmap,newNodes)}}class HashArrayMapNode{constructor(ownerID,count,nodes){this.ownerID=ownerID,this.count=count,this.nodes=nodes}get(shift,keyHash,key,notSetValue){void 0===keyHash&&(keyHash=hash(key));const idx=31&(0===shift?keyHash:keyHash>>>shift),node=this.nodes[idx];return node?node.get(shift+5,keyHash,key,notSetValue):notSetValue}update(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){void 0===keyHash&&(keyHash=hash(key));const idx=31&(0===shift?keyHash:keyHash>>>shift),removed=value===NOT_SET,nodes=this.nodes,node=nodes[idx];if(removed&&!node)return this;const newNode=updateNode(node,ownerID,shift+5,keyHash,key,value,didChangeSize,didAlter);if(newNode===node)return this;let newCount=this.count;if(node){if(!newNode&&(newCount--,newCount<MIN_HASH_ARRAY_MAP_SIZE))return function packNodes(ownerID,nodes,count,excluding){let bitmap=0,packedII=0;const packedNodes=new Array(count);for(let ii=0,bit=1,len=nodes.length;ii<len;ii++,bit<<=1){const node=nodes[ii];void 0!==node&&ii!==excluding&&(bitmap|=bit,packedNodes[packedII++]=node)}return new BitmapIndexedNode(ownerID,bitmap,packedNodes)}(ownerID,nodes,newCount,idx)}else newCount++;const isEditable=ownerID&&ownerID===this.ownerID,newNodes=setAt(nodes,idx,newNode,isEditable);return isEditable?(this.count=newCount,this.nodes=newNodes,this):new HashArrayMapNode(ownerID,newCount,newNodes)}}class HashCollisionNode{constructor(ownerID,keyHash,entries){this.ownerID=ownerID,this.keyHash=keyHash,this.entries=entries}get(shift,keyHash,key,notSetValue){const entries=this.entries;for(let ii=0,len=entries.length;ii<len;ii++)if(is(key,entries[ii][0]))return entries[ii][1];return notSetValue}update(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){void 0===keyHash&&(keyHash=hash(key));const removed=value===NOT_SET;if(keyHash!==this.keyHash)return removed?this:(SetRef(didAlter),SetRef(didChangeSize),mergeIntoNode(this,ownerID,shift,keyHash,[key,value]));const entries=this.entries;let idx=0;const len=entries.length;for(;idx<len&&!is(key,entries[idx][0]);idx++);const exists=idx<len;if(exists?entries[idx][1]===value:removed)return this;if(SetRef(didAlter),(removed||!exists)&&SetRef(didChangeSize),removed&&2===len)return new ValueNode(ownerID,this.keyHash,entries[1^idx]);const isEditable=ownerID&&ownerID===this.ownerID,newEntries=isEditable?entries:arrCopy(entries);return exists?removed?idx===len-1?newEntries.pop():newEntries[idx]=newEntries.pop():newEntries[idx]=[key,value]:newEntries.push([key,value]),isEditable?(this.entries=newEntries,this):new HashCollisionNode(ownerID,this.keyHash,newEntries)}}class ValueNode{constructor(ownerID,keyHash,entry){this.ownerID=ownerID,this.keyHash=keyHash,this.entry=entry}get(shift,keyHash,key,notSetValue){return is(key,this.entry[0])?this.entry[1]:notSetValue}update(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){const removed=value===NOT_SET,keyMatch=is(key,this.entry[0]);return(keyMatch?value===this.entry[1]:removed)?this:(SetRef(didAlter),removed?void SetRef(didChangeSize):keyMatch?ownerID&&ownerID===this.ownerID?(this.entry[1]=value,this):new ValueNode(ownerID,this.keyHash,[key,value]):(SetRef(didChangeSize),mergeIntoNode(this,ownerID,shift,hash(key),[key,value])))}}class MapIterator{constructor(map,_type,_reverse){this._type=_type,this._reverse=_reverse,this._stack=map._root&&mapIteratorFrame(map._root)}_stack;[Symbol.iterator](){return this}next(){const type=this._type;let stack=this._stack;for(;stack;){const node=stack.node,index=stack.index++;let maxIndex;if(node.entry){if(0===index)return mapIteratorValue(type,node.entry)}else if("entries"in node&&node.entries){if(maxIndex=node.entries.length-1,index<=maxIndex)return mapIteratorValue(type,node.entries[this._reverse?maxIndex-index:index])}else if(maxIndex=node.nodes.length-1,index<=maxIndex){const subNode=node.nodes[this._reverse?maxIndex-index:index];if(subNode){if(subNode.entry)return mapIteratorValue(type,subNode.entry);stack=this._stack=mapIteratorFrame(subNode,stack)}continue}stack=this._stack=this._stack.__prev}return{value:void 0,done:!0}}}function mapIteratorValue(type,entry){return function iteratorValue(type,k,v,iteratorResult){const value=type===ITERATE_KEYS?k:type===ITERATE_VALUES?v:[k,v];return iteratorResult?iteratorResult.value=value:iteratorResult={value,done:!1},iteratorResult}(type,entry[0],entry[1])}function mapIteratorFrame(node,prev){return{node,index:0,__prev:prev}}const ITERATE_KEYS=0,ITERATE_VALUES=1,ITERATE_ENTRIES=2;function makeMap(size,root,ownerID,hash2){const map=Object.create(ImmutableMap.prototype);return map.size=size,map._root=root,map.__ownerID=ownerID,map.__hash=hash2,map.__altered=!1,map}let EMPTY_MAP;function emptyMap(){return EMPTY_MAP||(EMPTY_MAP=makeMap(0))}function updateMap(map,k,v){let newRoot,newSize;if(map._root){const didChangeSize={value:!1},didAlter={value:!1};if(newRoot=updateNode(map._root,map.__ownerID,0,void 0,k,v,didChangeSize,didAlter),!didAlter.value)return map;newSize=map.size+(didChangeSize.value?v===NOT_SET?-1:1:0)}else{if(v===NOT_SET)return map;newSize=1,newRoot=new ArrayMapNode(map.__ownerID,[[k,v]])}return map.__ownerID?(map.size=newSize,map._root=newRoot,map.__hash=void 0,map.__altered=!0,map):newRoot?makeMap(newSize,newRoot):emptyMap()}function updateNode(node,ownerID,shift,keyHash,key,value,didChangeSize,didAlter){return node?node.update(ownerID,shift,keyHash,key,value,didChangeSize,didAlter):value===NOT_SET?node:(SetRef(didAlter),SetRef(didChangeSize),new ValueNode(ownerID,keyHash,[key,value]))}function isLeafNode(node){return node.constructor===ValueNode||node.constructor===HashCollisionNode}function mergeIntoNode(node,ownerID,shift,keyHash,entry){if(node.keyHash===keyHash)return new HashCollisionNode(ownerID,keyHash,[node.entry,entry]);const idx1=31&(0===shift?node.keyHash:node.keyHash>>>shift),idx2=31&(0===shift?keyHash:keyHash>>>shift);let newNode;const nodes=idx1===idx2?[mergeIntoNode(node,ownerID,shift+5,keyHash,entry)]:(newNode=new ValueNode(ownerID,keyHash,entry),idx1<idx2?[node,newNode]:[newNode,node]);return new BitmapIndexedNode(ownerID,1<<idx1|1<<idx2,nodes)}function popCount(x){return x=(x=(858993459&(x-=x>>1&1431655765))+(x>>2&858993459))+(x>>4)&252645135,x+=x>>8,127&(x+=x>>16)}function setAt(array,idx,val,canEdit){const newArray=canEdit?array:arrCopy(array);return newArray[idx]=val,newArray}const MAX_ARRAY_MAP_SIZE=8,MAX_BITMAP_INDEXED_SIZE=16,MIN_HASH_ARRAY_MAP_SIZE=8;class AtomMap{constructor(name,entries){this.name=name;let atoms=emptyMap();entries&&(atoms=atoms.withMutations((atoms2=>{for(const[k,v]of entries)atoms2.set(k,(0,state_dist_esm.eU)(`${name}:${String(k)}`,v))}))),this.atoms=(0,state_dist_esm.eU)(`${name}:atoms`,atoms)}atoms;getAtom(key){const valueAtom=this.atoms.__unsafe__getWithoutCapture().get(key);if(valueAtom)return valueAtom;this.atoms.get()}get(key){const value=this.getAtom(key)?.get();return(0,dist_esm.vA)(value!==state_dist_esm.UP),value}__unsafe__getWithoutCapture(key){const valueAtom=this.atoms.__unsafe__getWithoutCapture().get(key);if(!valueAtom)return;const value=valueAtom.__unsafe__getWithoutCapture();return(0,dist_esm.vA)(value!==state_dist_esm.UP),value}has(key){const valueAtom=this.getAtom(key);return!!valueAtom&&valueAtom.get()!==state_dist_esm.UP}__unsafe__hasWithoutCapture(key){const valueAtom=this.atoms.__unsafe__getWithoutCapture().get(key);return!!valueAtom&&((0,dist_esm.vA)(valueAtom.__unsafe__getWithoutCapture()!==state_dist_esm.UP),!0)}set(key,value){const existingAtom=this.atoms.__unsafe__getWithoutCapture().get(key);return existingAtom?existingAtom.set(value):this.atoms.update((atoms=>atoms.set(key,(0,state_dist_esm.eU)(`${this.name}:${String(key)}`,value)))),this}update(key,updater){const valueAtom=this.atoms.__unsafe__getWithoutCapture().get(key);if(!valueAtom)throw new Error(`AtomMap: key ${key} not found`);const value=valueAtom.__unsafe__getWithoutCapture();(0,dist_esm.vA)(value!==state_dist_esm.UP),valueAtom.set(updater(value))}delete(key){const valueAtom=this.atoms.__unsafe__getWithoutCapture().get(key);return!!valueAtom&&((0,state_dist_esm.hL)((()=>{valueAtom.set(state_dist_esm.UP),this.atoms.update((atoms=>atoms.delete(key)))})),!0)}deleteMany(keys){return(0,state_dist_esm.hL)((()=>{const deleted=[],newAtoms=this.atoms.get().withMutations((atoms=>{for(const key of keys){const valueAtom=atoms.get(key);if(!valueAtom)continue;const oldValue=valueAtom.get();(0,dist_esm.vA)(oldValue!==state_dist_esm.UP),deleted.push([key,oldValue]),atoms.delete(key),valueAtom.set(state_dist_esm.UP)}}));return deleted.length&&this.atoms.set(newAtoms),deleted}))}clear(){return(0,state_dist_esm.hL)((()=>{for(const valueAtom of this.atoms.__unsafe__getWithoutCapture().values())valueAtom.set(state_dist_esm.UP);this.atoms.set(emptyMap())}))}*entries(){for(const[key,valueAtom]of this.atoms.get()){const value=valueAtom.get();(0,dist_esm.vA)(value!==state_dist_esm.UP),yield[key,value]}}*keys(){for(const key of this.atoms.get().keys())yield key}*values(){for(const valueAtom of this.atoms.get().values()){const value=valueAtom.get();(0,dist_esm.vA)(value!==state_dist_esm.UP),yield value}}get size(){return this.atoms.get().size}forEach(callbackfn,thisArg){for(const[key,value]of this.entries())callbackfn.call(thisArg,value,key,this)}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="AtomMap"}class IncrementalSetConstructor{constructor(previousValue){this.previousValue=previousValue}nextValue;diff;get(){const numRemoved=this.diff?.removed?.size??0,numAdded=this.diff?.added?.size??0;if(0!==numRemoved||0!==numAdded)return{value:this.nextValue,diff:this.diff}}_add(item,wasAlreadyPresent){this.nextValue??=new Set(this.previousValue),this.nextValue.add(item),this.diff??={},wasAlreadyPresent?this.diff.removed?.delete(item):(this.diff.added??=new Set,this.diff.added.add(item))}add(item){const wasAlreadyPresent=this.previousValue.has(item);if(wasAlreadyPresent){const wasRemoved=this.diff?.removed?.has(item);if(!wasRemoved)return;return this._add(item,wasAlreadyPresent)}const isCurrentlyPresent=this.nextValue?.has(item);isCurrentlyPresent||this._add(item,wasAlreadyPresent)}_remove(item,wasAlreadyPresent){this.nextValue??=new Set(this.previousValue),this.nextValue.delete(item),this.diff??={},wasAlreadyPresent?(this.diff.removed??=new Set,this.diff.removed.add(item)):this.diff.added?.delete(item)}remove(item){const wasAlreadyPresent=this.previousValue.has(item);if(!wasAlreadyPresent){const wasAdded=this.diff?.added?.has(item);if(!wasAdded)return;return this._remove(item,wasAlreadyPresent)}const hasAlreadyBeenRemoved=this.diff?.removed?.has(item);hasAlreadyBeenRemoved||this._remove(item,wasAlreadyPresent)}}class RecordType{constructor(typeName,config){this.typeName=typeName,this.createDefaultProperties=config.createDefaultProperties,this.validator=config.validator??{validate:r=>r},this.scope=config.scope??"document",this.ephemeralKeys=config.ephemeralKeys;const ephemeralKeySet=new Set;if(config.ephemeralKeys)for(const[key,isEphemeral]of(0,dist_esm.iA)(config.ephemeralKeys))isEphemeral&&ephemeralKeySet.add(key);this.ephemeralKeySet=ephemeralKeySet}createDefaultProperties;validator;ephemeralKeys;ephemeralKeySet;scope;create(properties){const result={...this.createDefaultProperties(),id:"id"in properties?properties.id:this.createId()};for(const[k,v]of Object.entries(properties))void 0!==v&&(result[k]=v);return result.typeName=this.typeName,result}clone(record){return{...(0,dist_esm.pN)(record),id:this.createId()}}createId(customUniquePart){return this.typeName+":"+(customUniquePart??(0,dist_esm.NF)())}createCustomId(id){return this.typeName+":"+id}parseId(id){if(!this.isId(id))throw new Error(`ID "${id}" is not a valid ID for type "${this.typeName}"`);return id.slice(this.typeName.length+1)}isInstance(record){return record?.typeName===this.typeName}isId(id){if(!id)return!1;for(let i=0;i<this.typeName.length;i++)if(id[i]!==this.typeName[i])return!1;return":"===id[this.typeName.length]}withDefaultProperties(createDefaultProperties){return new RecordType(this.typeName,{createDefaultProperties,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(record,recordBefore){return recordBefore&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(recordBefore,record):this.validator.validate(record)}}function createRecordType(typeName,config){return new RecordType(typeName,{createDefaultProperties:()=>({}),validator:config.validator,scope:config.scope,ephemeralKeys:config.ephemeralKeys})}function createEmptyRecordsDiff(){return{added:{},updated:{},removed:{}}}function reverseRecordsDiff(diff){const result={added:diff.removed,removed:diff.added,updated:{}};for(const[from,to]of Object.values(diff.updated))result.updated[from.id]=[to,from];return result}function isRecordsDiffEmpty(diff){return 0===Object.keys(diff.added).length&&0===Object.keys(diff.updated).length&&0===Object.keys(diff.removed).length}function squashRecordDiffs(diffs){const result={added:{},removed:{},updated:{}};return squashRecordDiffsMutable(result,diffs),result}function squashRecordDiffsMutable(target,diffs){for(const diff of diffs){for(const[id,value]of(0,dist_esm.iA)(diff.added))if(target.removed[id]){const original=target.removed[id];delete target.removed[id],original!==value&&(target.updated[id]=[original,value])}else target.added[id]=value;for(const[id,[_from,to]]of(0,dist_esm.iA)(diff.updated))target.added[id]?(target.added[id]=to,delete target.updated[id],delete target.removed[id]):target.updated[id]?(target.updated[id]=[target.updated[id][0],to],delete target.removed[id]):(target.updated[id]=diff.updated[id],delete target.removed[id]);for(const[id,value]of(0,dist_esm.iA)(diff.removed))target.added[id]?delete target.added[id]:target.updated[id]?(target.removed[id]=target.updated[id][0],delete target.updated[id]):target.removed[id]=value}}var lodash_isequal=__webpack_require__("./node_modules/lodash.isequal/index.js"),lodash_isequal_default=__webpack_require__.n(lodash_isequal);function objectMatchesQuery(query,object){for(const[key,_matcher]of Object.entries(query)){const matcher=_matcher,value=object[key];if("eq"in matcher&&value!==matcher.eq)return!1;if("neq"in matcher&&value===matcher.neq)return!1;if("gt"in matcher&&("number"!=typeof value||value<=matcher.gt))return!1}return!0}function executeQuery(store,typeName,query){const matchIds=Object.fromEntries(Object.keys(query).map((key=>[key,new Set])));for(const[k,matcher]of Object.entries(query))if("eq"in matcher){const ids=store.index(typeName,k).get().get(matcher.eq);if(ids)for(const id of ids)matchIds[k].add(id)}else if("neq"in matcher){const index=store.index(typeName,k);for(const[value,ids]of index.get())if(value!==matcher.neq)for(const id of ids)matchIds[k].add(id)}else if("gt"in matcher){const index=store.index(typeName,k);for(const[value,ids]of index.get())if(value>matcher.gt)for(const id of ids)matchIds[k].add(id)}return function intersectSets(sets){if(0===sets.length)return new Set;const first=sets[0],rest=sets.slice(1),result=new Set;for(const val of first)rest.every((set=>set.has(val)))&&result.add(val);return result}(Object.values(matchIds))}class StoreQueries{constructor(recordMap,history){this.recordMap=recordMap,this.history=history}indexCache=new Map;historyCache=new Map;filterHistory(typeName){if(this.historyCache.has(typeName))return this.historyCache.get(typeName);const filtered=(0,state_dist_esm.EW)("filterHistory:"+typeName,((lastValue,lastComputedEpoch)=>{if((0,state_dist_esm._O)(lastValue))return this.history.get();const diff=this.history.getDiffSince(lastComputedEpoch);if(diff===state_dist_esm.c2)return this.history.get();const res={added:{},removed:{},updated:{}};let numAdded=0,numRemoved=0,numUpdated=0;for(const changes of diff){for(const added of(0,dist_esm.Ic)(changes.added))if(added.typeName===typeName)if(res.removed[added.id]){const original=res.removed[added.id];delete res.removed[added.id],numRemoved--,original!==added&&(res.updated[added.id]=[original,added],numUpdated++)}else res.added[added.id]=added,numAdded++;for(const[from,to]of(0,dist_esm.Ic)(changes.updated))to.typeName===typeName&&(res.added[to.id]?res.added[to.id]=to:res.updated[to.id]?res.updated[to.id]=[res.updated[to.id][0],to]:(res.updated[to.id]=[from,to],numUpdated++));for(const removed of(0,dist_esm.Ic)(changes.removed))removed.typeName===typeName&&(res.added[removed.id]?(delete res.added[removed.id],numAdded--):res.updated[removed.id]?(res.removed[removed.id]=res.updated[removed.id][0],delete res.updated[removed.id],numUpdated--,numRemoved++):(res.removed[removed.id]=removed,numRemoved++))}return numAdded||numRemoved||numUpdated?(0,state_dist_esm._D)(this.history.get(),res):lastValue}),{historyLength:100});return this.historyCache.set(typeName,filtered),filtered}index(typeName,property){const cacheKey=typeName+":"+property;if(this.indexCache.has(cacheKey))return this.indexCache.get(cacheKey);const index=this.__uncached_createIndex(typeName,property);return this.indexCache.set(cacheKey,index),index}__uncached_createIndex(typeName,property){const typeHistory=this.filterHistory(typeName),fromScratch=()=>{typeHistory.get();const res=new Map;for(const record of this.recordMap.values())if(record.typeName===typeName){const value=record[property];res.has(value)||res.set(value,new Set),res.get(value).add(record.id)}return res};return(0,state_dist_esm.EW)("index:"+typeName+":"+property,((prevValue,lastComputedEpoch)=>{if((0,state_dist_esm._O)(prevValue))return fromScratch();const history=typeHistory.getDiffSince(lastComputedEpoch);if(history===state_dist_esm.c2)return fromScratch();const setConstructors=new Map,add=(value,id)=>{let setConstructor=setConstructors.get(value);setConstructor||(setConstructor=new IncrementalSetConstructor(prevValue.get(value)??new Set)),setConstructor.add(id),setConstructors.set(value,setConstructor)},remove=(value,id)=>{let set=setConstructors.get(value);set||(set=new IncrementalSetConstructor(prevValue.get(value)??new Set)),set.remove(id),setConstructors.set(value,set)};for(const changes of history){for(const record of(0,dist_esm.Ic)(changes.added))if(record.typeName===typeName){add(record[property],record.id)}for(const[from,to]of(0,dist_esm.Ic)(changes.updated))if(to.typeName===typeName){const prev=from[property],next=to[property];prev!==next&&(remove(prev,to.id),add(next,to.id))}for(const record of(0,dist_esm.Ic)(changes.removed))if(record.typeName===typeName){remove(record[property],record.id)}}let nextValue,nextDiff;for(const[value,setConstructor]of setConstructors){const result=setConstructor.get();result&&(nextValue||(nextValue=new Map(prevValue)),nextDiff||(nextDiff=new Map),0===result.value.size?nextValue.delete(value):nextValue.set(value,result.value),nextDiff.set(value,result.diff))}return nextValue&&nextDiff?(0,state_dist_esm._D)(nextValue,nextDiff):prevValue}),{historyLength:100})}record(typeName,queryCreator=(()=>({})),name="record:"+typeName+(queryCreator?":"+queryCreator.toString():"")){const ids=this.ids(typeName,queryCreator,name);return(0,state_dist_esm.EW)(name,(()=>{for(const id of ids.get())return this.recordMap.get(id)}))}records(typeName,queryCreator=(()=>({})),name="records:"+typeName+(queryCreator?":"+queryCreator.toString():"")){const ids=this.ids(typeName,queryCreator,"ids:"+name);return(0,state_dist_esm.EW)(name,(()=>Array.from(ids.get(),(id=>this.recordMap.get(id)))),{isEqual:dist_esm.vq})}ids(typeName,queryCreator=(()=>({})),name="ids:"+typeName+(queryCreator?":"+queryCreator.toString():"")){const typeHistory=this.filterHistory(typeName),fromScratch=()=>{typeHistory.get();const query=queryCreator();if(0===Object.keys(query).length){const ids=new Set;for(const record of this.recordMap.values())record.typeName===typeName&&ids.add(record.id);return ids}return executeQuery(this,typeName,query)},fromScratchWithDiff=prevValue=>{const nextValue=fromScratch(),diff=function diffSets(prev,next){const result={};for(const val of next)prev.has(val)||(result.added??=new Set,result.added.add(val));for(const val of prev)next.has(val)||(result.removed??=new Set,result.removed.add(val));return result.added||result.removed?result:void 0}(prevValue,nextValue);return diff?(0,state_dist_esm._D)(nextValue,diff):prevValue},cachedQuery=(0,state_dist_esm.EW)("ids_query:"+name,queryCreator,{isEqual:lodash_isequal_default()});return(0,state_dist_esm.EW)("query:"+name,((prevValue,lastComputedEpoch)=>{const query=cachedQuery.get();if((0,state_dist_esm._O)(prevValue))return fromScratch();if(lastComputedEpoch<cachedQuery.lastChangedEpoch)return fromScratchWithDiff(prevValue);const history=typeHistory.getDiffSince(lastComputedEpoch);if(history===state_dist_esm.c2)return fromScratchWithDiff(prevValue);const setConstructor=new IncrementalSetConstructor(prevValue);for(const changes of history){for(const added of(0,dist_esm.Ic)(changes.added))added.typeName===typeName&&objectMatchesQuery(query,added)&&setConstructor.add(added.id);for(const[_,updated]of(0,dist_esm.Ic)(changes.updated))updated.typeName===typeName&&(objectMatchesQuery(query,updated)?setConstructor.add(updated.id):setConstructor.remove(updated.id));for(const removed of(0,dist_esm.Ic)(changes.removed))removed.typeName===typeName&&setConstructor.remove(removed.id)}const result=setConstructor.get();return result?(0,state_dist_esm._D)(result.value,result.diff):prevValue}),{historyLength:50})}exec(typeName,query){const ids=executeQuery(this,typeName,query);return 0===ids.size?state_dist_esm.Ml:Array.from(ids,(id=>this.recordMap.get(id)))}}class StoreSideEffects{constructor(store){this.store=store}_beforeCreateHandlers={};_afterCreateHandlers={};_beforeChangeHandlers={};_afterChangeHandlers={};_beforeDeleteHandlers={};_afterDeleteHandlers={};_operationCompleteHandlers=[];_isEnabled=!0;isEnabled(){return this._isEnabled}setIsEnabled(enabled){this._isEnabled=enabled}handleBeforeCreate(record,source){if(!this._isEnabled)return record;const handlers=this._beforeCreateHandlers[record.typeName];if(handlers){let r=record;for(const handler of handlers)r=handler(r,source);return r}return record}handleAfterCreate(record,source){if(!this._isEnabled)return;const handlers=this._afterCreateHandlers[record.typeName];if(handlers)for(const handler of handlers)handler(record,source)}handleBeforeChange(prev,next,source){if(!this._isEnabled)return next;const handlers=this._beforeChangeHandlers[next.typeName];if(handlers){let r=next;for(const handler of handlers)r=handler(prev,r,source);return r}return next}handleAfterChange(prev,next,source){if(!this._isEnabled)return;const handlers=this._afterChangeHandlers[next.typeName];if(handlers)for(const handler of handlers)handler(prev,next,source)}handleBeforeDelete(record,source){if(!this._isEnabled)return!0;const handlers=this._beforeDeleteHandlers[record.typeName];if(handlers)for(const handler of handlers)if(!1===handler(record,source))return!1;return!0}handleAfterDelete(record,source){if(!this._isEnabled)return;const handlers=this._afterDeleteHandlers[record.typeName];if(handlers)for(const handler of handlers)handler(record,source)}handleOperationComplete(source){if(this._isEnabled)for(const handler of this._operationCompleteHandlers)handler(source)}register(handlersByType){const disposes=[];for(const[type,handlers]of Object.entries(handlersByType))handlers?.beforeCreate&&disposes.push(this.registerBeforeCreateHandler(type,handlers.beforeCreate)),handlers?.afterCreate&&disposes.push(this.registerAfterCreateHandler(type,handlers.afterCreate)),handlers?.beforeChange&&disposes.push(this.registerBeforeChangeHandler(type,handlers.beforeChange)),handlers?.afterChange&&disposes.push(this.registerAfterChangeHandler(type,handlers.afterChange)),handlers?.beforeDelete&&disposes.push(this.registerBeforeDeleteHandler(type,handlers.beforeDelete)),handlers?.afterDelete&&disposes.push(this.registerAfterDeleteHandler(type,handlers.afterDelete));return()=>{for(const dispose of disposes)dispose()}}registerBeforeCreateHandler(typeName,handler){return this._beforeCreateHandlers[typeName]||(this._beforeCreateHandlers[typeName]=[]),this._beforeCreateHandlers[typeName].push(handler),()=>remove(this._beforeCreateHandlers[typeName],handler)}registerAfterCreateHandler(typeName,handler){return this._afterCreateHandlers[typeName]||(this._afterCreateHandlers[typeName]=[]),this._afterCreateHandlers[typeName].push(handler),()=>remove(this._afterCreateHandlers[typeName],handler)}registerBeforeChangeHandler(typeName,handler){return this._beforeChangeHandlers[typeName]||(this._beforeChangeHandlers[typeName]=[]),this._beforeChangeHandlers[typeName].push(handler),()=>remove(this._beforeChangeHandlers[typeName],handler)}registerAfterChangeHandler(typeName,handler){return this._afterChangeHandlers[typeName]||(this._afterChangeHandlers[typeName]=[]),this._afterChangeHandlers[typeName].push(handler),()=>remove(this._afterChangeHandlers[typeName],handler)}registerBeforeDeleteHandler(typeName,handler){return this._beforeDeleteHandlers[typeName]||(this._beforeDeleteHandlers[typeName]=[]),this._beforeDeleteHandlers[typeName].push(handler),()=>remove(this._beforeDeleteHandlers[typeName],handler)}registerAfterDeleteHandler(typeName,handler){return this._afterDeleteHandlers[typeName]||(this._afterDeleteHandlers[typeName]=[]),this._afterDeleteHandlers[typeName].push(handler),()=>remove(this._afterDeleteHandlers[typeName],handler)}registerOperationCompleteHandler(handler){return this._operationCompleteHandlers.push(handler),()=>remove(this._operationCompleteHandlers,handler)}}function remove(array,item){const index=array.indexOf(item);index>=0&&array.splice(index,1)}class Store{id;records;history=(0,state_dist_esm.eU)("history",0,{historyLength:1e3});query;listeners=new Set;historyAccumulator=new HistoryAccumulator;historyReactor;cancelHistoryReactor(){}schema;props;scopedTypes;sideEffects=new StoreSideEffects(this);constructor(config){const{initialData,schema,id}=config;this.id=id??(0,dist_esm.NF)(),this.schema=schema,this.props=config.props,this.records=initialData?new AtomMap("store",(0,dist_esm.iA)(initialData).map((([id2,record])=>[id2,this.schema.validateRecord(this,record,"initialize",null)]))):new AtomMap("store"),this.query=new StoreQueries(this.records,this.history),this.historyReactor=(0,state_dist_esm.Px)("Store.historyReactor",(()=>{this.history.get(),this._flushHistory()}),{scheduleEffect:cb=>this.cancelHistoryReactor=(0,dist_esm.Uo)(cb)}),this.scopedTypes={document:new Set((0,dist_esm.Ic)(this.schema.types).filter((t=>"document"===t.scope)).map((t=>t.typeName))),session:new Set((0,dist_esm.Ic)(this.schema.types).filter((t=>"session"===t.scope)).map((t=>t.typeName))),presence:new Set((0,dist_esm.Ic)(this.schema.types).filter((t=>"presence"===t.scope)).map((t=>t.typeName)))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){const entries=this.historyAccumulator.flush();for(const{changes,source}of entries){let instanceChanges=null,documentChanges=null,presenceChanges=null;for(const{onHistory,filters}of this.listeners)if("all"===filters.source||filters.source===source)if("all"!==filters.scope)if("document"===filters.scope){if(documentChanges??=this.filterChangesByScope(changes,"document"),!documentChanges)continue;onHistory({changes:documentChanges,source})}else if("session"===filters.scope){if(instanceChanges??=this.filterChangesByScope(changes,"session"),!instanceChanges)continue;onHistory({changes:instanceChanges,source})}else{if(presenceChanges??=this.filterChangesByScope(changes,"presence"),!presenceChanges)continue;onHistory({changes:presenceChanges,source})}else onHistory({changes,source})}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(change,scope){const result={added:(0,dist_esm.J2)(change.added,((_,r)=>this.scopedTypes[scope].has(r.typeName))),updated:(0,dist_esm.J2)(change.updated,((_,r)=>this.scopedTypes[scope].has(r[1].typeName))),removed:(0,dist_esm.J2)(change.removed,((_,r)=>this.scopedTypes[scope].has(r.typeName)))};return 0===Object.keys(result.added).length&&0===Object.keys(result.updated).length&&0===Object.keys(result.removed).length?null:result}updateHistory(changes){this.historyAccumulator.add({changes,source:this.isMergingRemoteChanges?"remote":"user"}),0===this.listeners.size&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,changes)}validate(phase){this.allRecords().forEach((record=>this.schema.validateRecord(this,record,phase,null)))}put(records,phaseOverride){this.atomic((()=>{const updates={},additions={};let record,didChange=!1;const source=this.isMergingRemoteChanges?"remote":"user";for(let i=0,n=records.length;i<n;i++){record=records[i];const initialValue=this.records.__unsafe__getWithoutCapture(record.id);if(initialValue){record=this.sideEffects.handleBeforeChange(initialValue,record,source);if(this.schema.validateRecord(this,record,phaseOverride??"updateRecord",initialValue)===initialValue)continue;this.records.set(record.id,record),didChange=!0,updates[record.id]=[initialValue,record],this.addDiffForAfterEvent(initialValue,record)}else record=this.sideEffects.handleBeforeCreate(record,source),didChange=!0,record=this.schema.validateRecord(this,record,phaseOverride??"createRecord",null),additions[record.id]=record,this.addDiffForAfterEvent(null,record),this.records.set(record.id,record)}didChange&&this.updateHistory({added:additions,updated:updates,removed:{}})}))}remove(ids){this.atomic((()=>{const toDelete=new Set(ids),source=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(const id of ids){const record=this.records.__unsafe__getWithoutCapture(id);record&&(!1===this.sideEffects.handleBeforeDelete(record,source)&&toDelete.delete(id))}const actuallyDeleted=this.records.deleteMany(toDelete);if(0===actuallyDeleted.length)return;const removed={};for(const[id,record]of actuallyDeleted)removed[id]=record,this.addDiffForAfterEvent(record,null);this.updateHistory({added:{},updated:{},removed})}))}get(id){return this.records.get(id)}unsafeGetWithoutCapture(id){return this.records.__unsafe__getWithoutCapture(id)}serialize(scope="document"){const result={};for(const[id,record]of this.records)("all"===scope||this.scopedTypes[scope].has(record.typeName))&&(result[id]=record);return result}getStoreSnapshot(scope="document"){return{store:this.serialize(scope),schema:this.schema.serialize()}}getSnapshot(scope="document"){return console.warn("[tldraw] `Store.getSnapshot` is deprecated and will be removed in a future release. Use `getSnapshot` from the `tldraw` package instead."),this.getStoreSnapshot(scope)}migrateSnapshot(snapshot){const migrationResult=this.schema.migrateStoreSnapshot(snapshot);if("error"===migrationResult.type)throw new Error(`Failed to migrate snapshot: ${migrationResult.reason}`);return{store:migrationResult.value,schema:this.schema.serialize()}}loadStoreSnapshot(snapshot){const migrationResult=this.schema.migrateStoreSnapshot(snapshot);if("error"===migrationResult.type)throw new Error(`Failed to migrate snapshot: ${migrationResult.reason}`);const prevSideEffectsEnabled=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic((()=>{this.clear(),this.put(Object.values(migrationResult.value)),this.ensureStoreIsUsable()}))}finally{this.sideEffects.setIsEnabled(prevSideEffectsEnabled)}}loadSnapshot(snapshot){console.warn("[tldraw] `Store.loadSnapshot` is deprecated and will be removed in a future release. Use `loadSnapshot` from the 'tldraw' package instead."),this.loadStoreSnapshot(snapshot)}allRecords(){return Array.from(this.records.values())}clear(){this.remove(Array.from(this.records.keys()))}update(id,updater){const existing=this.unsafeGetWithoutCapture(id);existing?this.put([updater(existing)]):console.error(`Record ${id} not found. This is probably an error`)}has(id){return this.records.has(id)}listen(onHistory,filters){this._flushHistory();const listener={onHistory,filters:{source:filters?.source??"all",scope:filters?.scope??"all"}};return this.historyReactor.scheduler.isActivelyListening||(this.historyReactor.start(),this.historyReactor.scheduler.execute()),this.listeners.add(listener),()=>{this.listeners.delete(listener),0===this.listeners.size&&this.historyReactor.stop()}}isMergingRemoteChanges=!1;mergeRemoteChanges(fn){if(this.isMergingRemoteChanges)return fn();if(this._isInAtomicOp)throw new Error("Cannot merge remote changes while in atomic operation");try{this.atomic(fn,!0,!0)}finally{this.ensureStoreIsUsable()}}extractingChanges(fn){const changes=[],dispose=this.historyAccumulator.addInterceptor((entry=>changes.push(entry.changes)));try{return(0,state_dist_esm.hL)(fn),squashRecordDiffs(changes)}finally{dispose()}}applyDiff(diff,{runCallbacks=!0,ignoreEphemeralKeys=!1}={}){this.atomic((()=>{const toPut=(0,dist_esm.Ic)(diff.added);for(const[_from,to]of(0,dist_esm.Ic)(diff.updated)){const type=this.schema.getType(to.typeName);if(ignoreEphemeralKeys&&type.ephemeralKeySet.size){const existing=this.get(to.id);if(!existing){toPut.push(to);continue}let changed=null;for(const[key,value]of Object.entries(to))type.ephemeralKeySet.has(key)||Object.is(value,(0,dist_esm.g5)(existing,key))||(changed||(changed={...existing}),changed[key]=value);changed&&toPut.push(changed)}else toPut.push(to)}const toRemove=(0,dist_esm.w$)(diff.removed);toPut.length&&this.put(toPut),toRemove.length&&this.remove(toRemove)}),runCallbacks)}createCache(create){const cache=new dist_esm.l;return{get:id=>{const atom2=this.records.getAtom(id);if(atom2)return cache.get(atom2,(()=>create(id,atom2))).get()}}}createComputedCache(name,derive,opts){return this.createCache(((id,record)=>{const recordSignal=opts?.areRecordsEqual?(0,state_dist_esm.EW)(`${name}:${id}:isEqual`,(()=>record.get()),{isEqual:opts.areRecordsEqual}):record;return(0,state_dist_esm.EW)(name+":"+id,(()=>derive(recordSignal.get())),{isEqual:opts?.areResultsEqual})}))}_integrityChecker;ensureStoreIsUsable(){this.atomic((()=>{this._integrityChecker??=this.schema.createIntegrityChecker(this),this._integrityChecker?.()}))}_isPossiblyCorrupted=!1;markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}pendingAfterEvents=null;addDiffForAfterEvent(before,after){if((0,dist_esm.vA)(this.pendingAfterEvents,"must be in event operation"),before===after)return;if(before&&after&&(0,dist_esm.vA)(before.id===after.id),!before&&!after)return;const id=(before||after).id,existing=this.pendingAfterEvents.get(id);existing?existing.after=after:this.pendingAfterEvents.set(id,{before,after})}flushAtomicCallbacks(isMergingRemoteChanges){let updateDepth=0,source=isMergingRemoteChanges?"remote":"user";for(;this.pendingAfterEvents;){const events=this.pendingAfterEvents;if(this.pendingAfterEvents=null,this.sideEffects.isEnabled()){if(updateDepth++,updateDepth>100)throw new Error("Maximum store update depth exceeded, bailing out");for(const{before,after}of events.values())before&&after&&before!==after&&!lodash_isequal_default()(before,after)?this.sideEffects.handleAfterChange(before,after,source):before&&!after?this.sideEffects.handleAfterDelete(before,source):!before&&after&&this.sideEffects.handleAfterCreate(after,source);this.pendingAfterEvents?source="user":this.sideEffects.handleOperationComplete(source)}}}_isInAtomicOp=!1;atomic(fn,runCallbacks=!0,isMergingRemoteChanges=!1){return(0,state_dist_esm.hL)((()=>{if(this._isInAtomicOp){this.pendingAfterEvents||(this.pendingAfterEvents=new Map);const prevSideEffectsEnabled2=this.sideEffects.isEnabled();(0,dist_esm.vA)(!isMergingRemoteChanges,"cannot call mergeRemoteChanges while in atomic operation");try{return prevSideEffectsEnabled2&&!runCallbacks&&this.sideEffects.setIsEnabled(!1),fn()}finally{this.sideEffects.setIsEnabled(prevSideEffectsEnabled2)}}this.pendingAfterEvents=new Map;const prevSideEffectsEnabled=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(runCallbacks??prevSideEffectsEnabled),this._isInAtomicOp=!0,isMergingRemoteChanges&&(this.isMergingRemoteChanges=!0);try{const result=fn();return this.isMergingRemoteChanges=!1,this.flushAtomicCallbacks(isMergingRemoteChanges),result}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(prevSideEffectsEnabled),this._isInAtomicOp=!1,this.isMergingRemoteChanges=!1}}))}addHistoryInterceptor(fn){return this.historyAccumulator.addInterceptor((entry=>fn(entry,this.isMergingRemoteChanges?"remote":"user")))}}class HistoryAccumulator{_history=[];_interceptors=new Set;addInterceptor(fn){return this._interceptors.add(fn),()=>{this._interceptors.delete(fn)}}add(entry){this._history.push(entry);for(const interceptor of this._interceptors)interceptor(entry)}flush(){const history=function squashHistoryEntries(entries){if(0===entries.length)return[];const chunked=[];let entry,chunk=[entries[0]];for(let i=1,n=entries.length;i<n;i++)entry=entries[i],chunk[0].source!==entry.source&&(chunked.push(chunk),chunk=[]),chunk.push(entry);return chunked.push(chunk),chunked.map((chunk2=>({source:chunk2[0].source,changes:squashRecordDiffs(chunk2.map((e=>e.changes)))})))}(this._history);return this._history=[],history}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function createComputedCache(name,derive,opts){const cache=new dist_esm.l;return{get:(context,id)=>cache.get(context,(()=>(context instanceof Store?context:context.store).createComputedCache(name,(record=>derive(context,record)),opts))).get(id)}}function squashDependsOn(sequence){const result=[];for(let i=sequence.length-1;i>=0;i--){const elem=sequence[i];if("id"in elem)result.unshift(elem);else{const dependsOn=elem.dependsOn,prev=result[0];prev&&(result[0]={...prev,dependsOn:dependsOn.concat(prev.dependsOn??[])})}}return result}function createMigrationSequence({sequence,sequenceId,retroactive=!0}){const migrations={sequenceId,retroactive,sequence:squashDependsOn(sequence)};return validateMigrations(migrations),migrations}function createMigrationIds(sequenceId,versions){return Object.fromEntries((0,dist_esm.iA)(versions).map((([key,version])=>[key,`${sequenceId}/${version}`])))}function createRecordMigrationSequence(opts){return createMigrationSequence({sequenceId:opts.sequenceId,retroactive:opts.retroactive??!0,sequence:opts.sequence.map((m=>"id"in m?{...m,scope:"record",filter:r=>r.typeName===opts.recordType&&(m.filter?.(r)??!0)&&(opts.filter?.(r)??!0)}:m))})}function parseMigrationId(id){const[sequenceId,version]=id.split("/");return{sequenceId,version:parseInt(version)}}function validateMigrationId(id,expectedSequenceId){expectedSequenceId&&(0,dist_esm.vA)(id.startsWith(expectedSequenceId+"/"),`Every migration in sequence '${expectedSequenceId}' must have an id starting with '${expectedSequenceId}/'. Got invalid id: '${id}'`),(0,dist_esm.vA)(id.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${id}'`)}function validateMigrations(migrations){if((0,dist_esm.vA)(!migrations.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${migrations.sequenceId}`),(0,dist_esm.vA)(migrations.sequenceId.length,"sequenceId must be a non-empty string"),0===migrations.sequence.length)return;validateMigrationId(migrations.sequence[0].id,migrations.sequenceId);let n=parseMigrationId(migrations.sequence[0].id).version;(0,dist_esm.vA)(1===n,`Expected the first migrationId to be '${migrations.sequenceId}/1' but got '${migrations.sequence[0].id}'`);for(let i=1;i<migrations.sequence.length;i++){const id=migrations.sequence[i].id;validateMigrationId(id,migrations.sequenceId);const m=parseMigrationId(id).version;(0,dist_esm.vA)(m===n+1,`Migration id numbers must increase in increments of 1, expected ${migrations.sequenceId}/${n+1} but got '${migrations.sequence[i].id}'`),n=m}}var MigrationFailureReason=(MigrationFailureReason2=>(MigrationFailureReason2.IncompatibleSubtype="incompatible-subtype",MigrationFailureReason2.UnknownType="unknown-type",MigrationFailureReason2.TargetVersionTooNew="target-version-too-new",MigrationFailureReason2.TargetVersionTooOld="target-version-too-old",MigrationFailureReason2.MigrationError="migration-error",MigrationFailureReason2.UnrecognizedSubtype="unrecognized-subtype",MigrationFailureReason2))(MigrationFailureReason||{});class StoreSchema{constructor(types,options){this.types=types,this.options=options;for(const m of options.migrations??[])(0,dist_esm.vA)(!this.migrations[m.sequenceId],`Duplicate migration sequenceId ${m.sequenceId}`),validateMigrations(m),this.migrations[m.sequenceId]=m;const allMigrations=Object.values(this.migrations).flatMap((m=>m.sequence));this.sortedMigrations=function sortMigrations(migrations){const byId=new Map(migrations.map((m=>[m.id,m]))),isProcessing=new Set,result=[];function process(m){(0,dist_esm.vA)(!isProcessing.has(m.id),`Circular dependency in migrations: ${m.id}`),isProcessing.add(m.id);const{version,sequenceId}=parseMigrationId(m.id),parent=byId.get(`${sequenceId}/${version-1}`);if(parent&&process(parent),m.dependsOn)for(const dep of m.dependsOn){const depMigration=byId.get(dep);depMigration&&process(depMigration)}byId.delete(m.id),result.push(m)}for(const m of byId.values())process(m);return result}(allMigrations);for(const migration of this.sortedMigrations)if(migration.dependsOn?.length)for(const dep of migration.dependsOn){const depMigration=allMigrations.find((m=>m.id===dep));(0,dist_esm.vA)(depMigration,`Migration '${migration.id}' depends on missing migration '${dep}'`)}}static create(types,options){return new StoreSchema(types,options??{})}migrations={};sortedMigrations;validateRecord(store,record,phase,recordBefore){try{const recordType=(0,dist_esm.g5)(this.types,record.typeName);if(!recordType)throw new Error(`Missing definition for record type ${record.typeName}`);return recordType.validate(record,recordBefore??void 0)}catch(error){if(this.options.onValidationFailure)return this.options.onValidationFailure({store,record,phase,recordBefore,error});throw error}}getMigrationsSince(persistedSchema){const upgradeResult=function upgradeSchema(schema){if(schema.schemaVersion>2||schema.schemaVersion<1)return dist_esm.Q7.err("Bad schema version");if(2===schema.schemaVersion)return dist_esm.Q7.ok(schema);const result={schemaVersion:2,sequences:{"com.tldraw.store":schema.storeVersion}};for(const[typeName,recordVersion]of Object.entries(schema.recordVersions))if(result.sequences[`com.tldraw.${typeName}`]=recordVersion.version,"subTypeKey"in recordVersion)for(const[subType,version]of Object.entries(recordVersion.subTypeVersions))result.sequences[`com.tldraw.${typeName}.${subType}`]=version;return dist_esm.Q7.ok(result)}(persistedSchema);if(!upgradeResult.ok)return upgradeResult;const schema=upgradeResult.value,sequenceIdsToInclude=new Set(Object.keys(schema.sequences).filter((sequenceId=>this.migrations[sequenceId])));for(const sequenceId in this.migrations)void 0===schema.sequences[sequenceId]&&this.migrations[sequenceId].retroactive&&sequenceIdsToInclude.add(sequenceId);if(0===sequenceIdsToInclude.size)return dist_esm.Q7.ok([]);const allMigrationsToInclude=new Set;for(const sequenceId of sequenceIdsToInclude){const theirVersion=schema.sequences[sequenceId];if("number"!=typeof theirVersion&&this.migrations[sequenceId].retroactive||0===theirVersion){for(const migration of this.migrations[sequenceId].sequence)allMigrationsToInclude.add(migration.id);continue}const theirVersionId=`${sequenceId}/${theirVersion}`,idx=this.migrations[sequenceId].sequence.findIndex((m=>m.id===theirVersionId));if(-1===idx)return dist_esm.Q7.err("Incompatible schema?");for(const migration of this.migrations[sequenceId].sequence.slice(idx+1))allMigrationsToInclude.add(migration.id)}return dist_esm.Q7.ok(this.sortedMigrations.filter((({id})=>allMigrationsToInclude.has(id))))}migratePersistedRecord(record,persistedSchema,direction="up"){const migrations=this.getMigrationsSince(persistedSchema);if(!migrations.ok)return console.error("Error migrating record",migrations.error),{type:"error",reason:MigrationFailureReason.MigrationError};let migrationsToApply=migrations.value;if(0===migrationsToApply.length)return{type:"success",value:record};if(migrationsToApply.some((m=>"store"===m.scope)))return{type:"error",reason:"down"===direction?MigrationFailureReason.TargetVersionTooOld:MigrationFailureReason.TargetVersionTooNew};if("down"===direction){if(!migrationsToApply.every((m=>m.down)))return{type:"error",reason:MigrationFailureReason.TargetVersionTooOld};migrationsToApply=migrationsToApply.slice().reverse()}record=(0,dist_esm.pN)(record);try{for(const migration of migrationsToApply){if("store"===migration.scope)throw new Error;if(!(!migration.filter||migration.filter(record)))continue;const result=migration[direction](record);result&&(record=(0,dist_esm.pN)(result))}}catch(e){return console.error("Error migrating record",e),{type:"error",reason:MigrationFailureReason.MigrationError}}return{type:"success",value:record}}migrateStoreSnapshot(snapshot){let{store}=snapshot;const migrations=this.getMigrationsSince(snapshot.schema);if(!migrations.ok)return console.error("Error migrating store",migrations.error),{type:"error",reason:MigrationFailureReason.MigrationError};const migrationsToApply=migrations.value;if(0===migrationsToApply.length)return{type:"success",value:store};store=(0,dist_esm.pN)(store);try{for(const migration of migrationsToApply)if("record"===migration.scope)for(const[id,record]of Object.entries(store)){if(!(!migration.filter||migration.filter(record)))continue;const result=migration.up(record);result&&(store[id]=(0,dist_esm.pN)(result))}else if("store"===migration.scope){const result=migration.up(store);result&&(store=(0,dist_esm.pN)(result))}else(0,dist_esm.h6)(migration)}catch(e){return console.error("Error migrating store",e),{type:"error",reason:MigrationFailureReason.MigrationError}}return{type:"success",value:store}}createIntegrityChecker(store){return this.options.createIntegrityChecker?.(store)??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map((({sequenceId,sequence})=>[sequenceId,sequence.length?parseMigrationId(sequence.at(-1).id).version:0])))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map((({sequenceId})=>[sequenceId,0])))}}getType(typeName){const type=(0,dist_esm.g5)(this.types,typeName);return(0,dist_esm.vA)(type,"record type does not exists"),type}}(0,dist_esm.lF)("@tldraw/store","3.13.1","esm")},"./node_modules/@tldraw/tldraw/dist-esm/index.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{ive:()=>dist_esm.ive,u8f:()=>dist_esm.u8f,yes:()=>dist_esm.yes,Sg3:()=>dist_esm.Sg3,F0h:()=>DefaultToolbar,y5O:()=>DefaultToolbarContent,hDc:()=>dist_esm.hDc,krb:()=>dist_esm.krb,inY:()=>dist_esm.inY,T:()=>dist_esm.T,Z1z:()=>Tldraw,LRd:()=>TldrawUiMenuItem,n6Y:()=>dist_esm.n6Y,AnR:()=>dist_esm.AnR,dVW:()=>dist_esm.dVW,N2B:()=>dist_esm.N2B,_As:()=>dist_esm._As,Pou:()=>useIsToolSelected,DKZ:()=>useTools});var dist_esm=__webpack_require__("./node_modules/@tldraw/editor/dist-esm/index.mjs"),react=__webpack_require__("./node_modules/react/index.js");function usePrefersReducedMotion(){const[prefersReducedMotion,setPrefersReducedMotion]=(0,react.useState)(!1);return(0,react.useEffect)((()=>{if("undefined"==typeof window||!("matchMedia"in window))return;const mql=window.matchMedia("(prefers-reduced-motion: reduce)"),handler=()=>{setPrefersReducedMotion(mql.matches)};return handler(),mql.addEventListener("change",handler),()=>mql.removeEventListener("change",handler)}),[]),prefersReducedMotion}var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const A11yContext=(0,react.createContext)(null);function TldrawUiA11yProvider({children}){const currentMsg=(0,dist_esm.fpl)("a11y",{msg:"",priority:"assertive"}),ctx=(0,react.useContext)(A11yContext),current=(0,react.useMemo)((()=>({currentMsg,announce(msg){msg&&currentMsg.set(msg)}})),[currentMsg]);return ctx?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children}):(0,jsx_runtime.jsx)(A11yContext.Provider,{value:current,children})}function useA11y(){const ctx=(0,react.useContext)(A11yContext);if(!ctx)throw new Error("useA11y must be used within a A11yContext.Provider");return ctx}const AssetUrlsContext=(0,react.createContext)(null);function AssetUrlsProvider({assetUrls,children}){return(0,react.useEffect)((()=>{for(const src of Object.values(assetUrls.icons)){if(!src)continue;const image=(0,dist_esm._V3)();image.src=src,image.decode()}for(const src of Object.values(assetUrls.embedIcons)){if(!src)continue;const image=(0,dist_esm._V3)();image.src=src,image.decode()}}),[assetUrls]),(0,jsx_runtime.jsx)(AssetUrlsContext.Provider,{value:assetUrls,children})}function useAssetUrls(){const assetUrls=(0,react.useContext)(AssetUrlsContext);if(!assetUrls)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return assetUrls}const DEFAULT_TRANSLATION={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.size-too-big":"File size is too big","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.files.amount-too-many":"Too many files","assets.url.failed":"Couldnât load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.cloud":"Cloud","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.heart":"Heart","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","arrow-kind-style.arc":"Arc","arrow-kind-style.elbow":"Elbow","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.heart":"Heart","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.media":"Media","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","tool.pointer-down":"Pointer down","tool.rich-text-bold":"Bold","tool.rich-text-italic":"Italic","tool.rich-text-code":"Code","tool.rich-text-highlight":"Highlight","tool.rich-text-strikethrough":"Strikethrough","tool.rich-text-link":"Link","tool.rich-text-link-visit":"Visit link","tool.rich-text-link-remove":"Remove link","tool.rich-text-header":"Header","tool.rich-text-bulletList":"Bulleted list","tool.rich-text-toolbar-title":"Text formatting","tool.rich-text-orderedList":"Ordered list","tool.bookmark":"Bookmark","a11y.status":"Status","a11y.skip-to-main-content":"Move focus to canvas","a11y.shape-index":"{num} of {total}","a11y.shape-image":"Image","a11y.shape-video":"Video","a11y.multiple-shapes":"{num} shapes selected","a11y.select-shape":"Select next shape","a11y.select-shape-direction":"Select shape in direction","a11y.enter-leave-container":"Enter/leave container","a11y.repeat-shape":"Repeat shape","a11y.move-shape":"Move shape","a11y.move-shape-faster":"Move shape faster","a11y.enlarge-shape":"Enlarge shape","a11y.shrink-shape":"Shrink shape","a11y.pan-camera":"Pan camera","a11y.adjust-shape-styles":"Adjust shape styles","menu.title":"Menu","menu.theme":"Theme","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","context-menu.title":"Context menu","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.copy-link":"Copy editor link","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project canât be shared because itâs too large. Weâre working on it!","share-menu.upload-failed":"Sorry, we couldnât upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new projectâ¦","share-menu.copied":"Copied link","document-name-menu.copy-link":"Copy link","status.offline":"Offline","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.avatar-color":"Avatar color","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","people-menu.anonymous-user":"New user","help-menu.import-tldr-file":"Import fileâ¦","help-menu.title":"Help and resources","help-menu.about":"About tldraw","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","help-menu.terms":"Terms of service","help-menu.privacy":"Privacy policy","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","edit-link-dialog.external-link":"External link","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the siteâs URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","shortcuts-dialog.a11y":"Accessibility","shortcuts-dialog.text-formatting":"Text formatting","style-panel.title":"Styles","style-panel.align":"Align","style-panel.label-align":"Label align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.arrow-kind":"Line","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.title":"Tools","tool-panel.more":"More","navigation-zone.title":"Navigation","navigation-zone.minimap":"Minimap","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","toast.success":"Success","toast.error":"Error","toast.info":"Info","toast.warning":"Warning","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesnât look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Donât ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Donât ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Donât ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"Weâve updated this document to work with the current version of tldraw. If youâd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Donât ask again","cursor-chat.type-to-chat":"Type to chatâ¦","app.loading":"Loading tldrawâ¦","handle.resize-top":"Resize top","handle.resize-bottom":"Resize bottom","handle.resize-left":"Resize left","handle.resize-right":"Resize right","handle.resize-top-left":"Resize top left","handle.resize-top-right":"Resize top right","handle.resize-bottom-left":"Resize bottom left","handle.resize-bottom-right":"Resize bottom right","handle.rotate.top_left_rotate":"Rotate top left","handle.rotate.top_right_rotate":"Rotate top right","handle.rotate.bottom_left_rotate":"Rotate bottom left","handle.rotate.bottom_right_rotate":"Rotate bottom right","handle.rotate.mobile_rotate":"Rotate","handle.crop.top":"Crop top","handle.crop.bottom":"Crop bottom","handle.crop.left":"Crop left","handle.crop.right":"Crop right","handle.crop.top-left":"Crop top left","handle.crop.top-right":"Crop top right","handle.crop.bottom-left":"Crop bottom left","handle.crop.bottom-right":"Crop bottom right","ui.close":"Close","ui.checked":"Checked","ui.unchecked":"Unchecked"},RTL_LANGUAGES=new Set(["ar","fa","he","ur","ku"]),EN_TRANSLATION={locale:"en",label:"English",messages:DEFAULT_TRANSLATION,dir:"ltr"};const TranslationsContext=react.createContext(null);function useCurrentTranslation(){const translations=react.useContext(TranslationsContext);if(!translations)throw new Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return translations}function TldrawUiTranslationProvider({overrides,locale,children}){const getAssetUrl=useAssetUrls(),[currentTranslation,setCurrentTranslation]=react.useState((()=>overrides&&overrides.en?{locale:"en",label:"English",dir:"ltr",messages:{...DEFAULT_TRANSLATION,...overrides.en}}:{locale:"en",label:"English",dir:"ltr",messages:DEFAULT_TRANSLATION}));return react.useEffect((()=>{let isCancelled=!1;return async function loadTranslation(){const translation=await async function fetchTranslation(locale,assetUrls){if(!(await(0,dist_esm.hdJ)(assetUrls.translations.en)).ok)return console.warn("No main translations found."),EN_TRANSLATION;if("en"===locale)return EN_TRANSLATION;const language=dist_esm.Yjb.find((t=>t.locale===locale));if(!language)return console.warn(`No translation found for locale ${locale}`),EN_TRANSLATION;const res=await(0,dist_esm.hdJ)(assetUrls.translations[language.locale]),messages=await res.json();if(!messages)return console.warn(`No messages found for locale ${locale}`),EN_TRANSLATION;const missing=[];for(const key in EN_TRANSLATION.messages)messages[key]||missing.push(key);return missing.length,{locale,label:language.label,dir:RTL_LANGUAGES.has(language.locale)?"rtl":"ltr",messages:{...EN_TRANSLATION.messages,...messages}}}(locale,getAssetUrl);translation&&!isCancelled&&(overrides&&overrides[locale]?setCurrentTranslation({...translation,messages:{...translation.messages,...overrides[locale]}}):setCurrentTranslation(translation))}(),()=>{isCancelled=!0}}),[getAssetUrl,locale,overrides]),(0,jsx_runtime.jsx)(TranslationsContext.Provider,{value:currentTranslation,children})}function useTranslation_useTranslation(){const translation=useCurrentTranslation();return react.useCallback((function msg(id){return translation.messages[id]??id}),[translation])}var classnames=__webpack_require__("./node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames);const TldrawUiButton=react.forwardRef((function TldrawUiButton2({children,type,isActive,...props},ref){return(0,jsx_runtime.jsx)("button",{ref,type:"button",draggable:!1,"data-isactive":isActive,...props,className:classnames_default()("tlui-button",`tlui-button__${type}`,props.className),children})}));function SkipToMainContent(){const editor=(0,dist_esm.hGv)(),msg=useTranslation_useTranslation(),button=(0,react.useRef)(null),handleNavigateToFirstShape=(0,react.useCallback)((e=>{(0,dist_esm.$6n)(e),button.current?.blur();const shapes=editor.getCurrentPageShapesInReadingOrder();shapes.length&&(editor.setSelectedShapes([shapes[0].id]),editor.zoomToSelectionIfOffscreen(256,{animation:{duration:editor.options.animationMediumMs},inset:0}),editor.timers.setTimeout((()=>editor.getContainer().focus()),100))}),[editor]);return(0,jsx_runtime.jsx)(TldrawUiButton,{ref:button,type:"low",tabIndex:0,className:"tl-skip-to-main-content",onClick:handleNavigateToFirstShape,children:msg("a11y.skip-to-main-content")})}const DefaultA11yAnnouncer=(0,react.memo)((function TldrawUiA11yAnnouncer(){const a11y=useA11y(),translation=useTranslation_useTranslation(),msg=(0,dist_esm.hau)("a11y-msg",(()=>a11y.currentMsg.get()),[]);return useA11yDebug(msg.msg),useSelectedShapesAnnouncer(),msg.msg&&(0,jsx_runtime.jsx)("div",{"aria-label":translation("a11y.status"),"aria-live":msg.priority||"assertive",role:"status","aria-hidden":"false",style:{position:"absolute",top:"-10000px",left:"-10000px"},children:msg.msg})}));function generateShapeAnnouncementMessage(args){const{editor,selectedShapeIds,msg}=args;let a11yLive="";const numShapes=selectedShapeIds.length;if(numShapes>1)a11yLive=msg("a11y.multiple-shapes").replace("{num}",numShapes.toString());else if(1===numShapes){const shapeId=selectedShapeIds[0],shape=editor.getShape(shapeId);if(!shape)return"";const shapeUtil=editor.getShapeUtil(shape.type),isMedia=["image","video"].includes(shape.type);let shapeType="";shapeType="geo"===shape.type?msg(`geo-style.${shape.props.geo}`):msg(isMedia?`a11y.shape-${shape.type}`:`tool.${shape.type}`);const readingOrderShapes=editor.getCurrentPageShapesInReadingOrder(),currentShapeIndex=(readingOrderShapes.findIndex((s=>s.id===shapeId))+1).toString(),totalShapes=readingOrderShapes.length.toString(),shapeIndex=msg("a11y.shape-index").replace("{num}",currentShapeIndex).replace("{total}",totalShapes),describingText=shapeUtil.getAriaDescriptor(shape)||shapeUtil.getText(shape)||"";a11yLive=(describingText?`${describingText}, `:"")+`${shapeType}. ${shapeIndex}`}return a11yLive}const useSelectedShapesAnnouncer=()=>{const editor=(0,dist_esm.frr)(),a11y=useA11y(),msg=useTranslation_useTranslation(),rPrevSelectedShapeIds=(0,react.useRef)([]);(0,dist_esm.a1r)("announce selection",(()=>{if(!editor)return;const isInSelecting=editor.isIn("select.idle"),selectedShapeIds=editor.getSelectedShapeIds();isInSelecting&&selectedShapeIds!==rPrevSelectedShapeIds.current&&(rPrevSelectedShapeIds.current=selectedShapeIds,(0,dist_esm.PmD)((()=>{const a11yLive=generateShapeAnnouncementMessage({editor,selectedShapeIds,msg});a11yLive&&a11y.announce({msg:a11yLive})})))}),[editor,a11y,msg])},useA11yDebug=msg=>{const container=(0,dist_esm.NFA)();(0,react.useEffect)((()=>{if(dist_esm.bGJ.a11y.get()){const log=msg2=>{console.debug(`%ca11y%c: ${msg2}`,"color: white; background: #40C057; padding: 2px;border-radius: 3px;","font-weight: normal")},handleKeyUp=e=>{const el=document.activeElement;if("Tab"===e.key&&el&&el!==document.body&&!el.classList.contains("tl-container")){const label=el.getAttribute("aria-label")||el.getAttribute("title")||el.textContent;label&&log(label)}};return msg&&log(msg),document.addEventListener("keyup",handleKeyUp),()=>document.removeEventListener("keyup",handleKeyUp)}}),[container,msg])},defaultEventHandler=()=>{},EventsContext=react.createContext(null);function TldrawUiEventsProvider({onEvent,children}){return(0,jsx_runtime.jsx)(EventsContext.Provider,{value:onEvent??defaultEventHandler,children})}function useUiEvents(){return react.useContext(EventsContext)??defaultEventHandler}var dist=__webpack_require__("./node_modules/@radix-ui/primitive/dist/index.mjs"),react_compose_refs_dist=__webpack_require__("./node_modules/@radix-ui/react-compose-refs/dist/index.mjs"),react_context_dist=__webpack_require__("./node_modules/@radix-ui/react-context/dist/index.mjs"),react_use_controllable_state_dist=__webpack_require__("./node_modules/@radix-ui/react-use-controllable-state/dist/index.mjs"),react_primitive_dist=__webpack_require__("./node_modules/@radix-ui/react-primitive/dist/index.mjs"),react_collection_dist=__webpack_require__("./node_modules/@radix-ui/react-collection/dist/index.mjs"),react_direction_dist=__webpack_require__("./node_modules/@radix-ui/react-direction/dist/index.mjs"),react_dismissable_layer_dist=__webpack_require__("./node_modules/@radix-ui/react-dismissable-layer/dist/index.mjs"),react_focus_guards_dist=__webpack_require__("./node_modules/@radix-ui/react-focus-guards/dist/index.mjs"),react_focus_scope_dist=__webpack_require__("./node_modules/@radix-ui/react-focus-scope/dist/index.mjs"),react_id_dist=__webpack_require__("./node_modules/@radix-ui/react-id/dist/index.mjs"),react_popper_dist=__webpack_require__("./node_modules/@radix-ui/react-popper/dist/index.mjs"),react_portal_dist=__webpack_require__("./node_modules/@radix-ui/react-portal/dist/index.mjs"),react_presence_dist=__webpack_require__("./node_modules/@radix-ui/react-presence/dist/index.mjs"),react_roving_focus_dist=__webpack_require__("./node_modules/@radix-ui/react-roving-focus/dist/index.mjs"),react_slot_dist=__webpack_require__("./node_modules/@radix-ui/react-slot/dist/index.mjs"),react_use_callback_ref_dist=__webpack_require__("./node_modules/@radix-ui/react-use-callback-ref/dist/index.mjs"),es2015=__webpack_require__("./node_modules/aria-hidden/dist/es2015/index.js"),Combination=__webpack_require__("./node_modules/react-remove-scroll/dist/es2015/Combination.js"),SELECTION_KEYS=["Enter"," "],LAST_KEYS=["ArrowUp","PageDown","End"],FIRST_LAST_KEYS=["ArrowDown","PageUp","Home",...LAST_KEYS],SUB_OPEN_KEYS={ltr:[...SELECTION_KEYS,"ArrowRight"],rtl:[...SELECTION_KEYS,"ArrowLeft"]},SUB_CLOSE_KEYS={ltr:["ArrowLeft"],rtl:["ArrowRight"]},[Collection,useCollection,createCollectionScope]=(0,react_collection_dist.N)("Menu"),[createMenuContext,createMenuScope]=(0,react_context_dist.A)("Menu",[createCollectionScope,react_popper_dist.Bk,react_roving_focus_dist.RG]),usePopperScope=(0,react_popper_dist.Bk)(),useRovingFocusGroupScope=(0,react_roving_focus_dist.RG)(),[MenuProvider,useMenuContext]=createMenuContext("Menu"),[MenuRootProvider,useMenuRootContext]=createMenuContext("Menu"),Menu=props=>{const{__scopeMenu,open=!1,children,dir,onOpenChange,modal=!0}=props,popperScope=usePopperScope(__scopeMenu),[content,setContent]=react.useState(null),isUsingKeyboardRef=react.useRef(!1),handleOpenChange=(0,react_use_callback_ref_dist.c)(onOpenChange),direction=(0,react_direction_dist.jH)(dir);return react.useEffect((()=>{const handleKeyDown=()=>{isUsingKeyboardRef.current=!0,document.addEventListener("pointerdown",handlePointer,{capture:!0,once:!0}),document.addEventListener("pointermove",handlePointer,{capture:!0,once:!0})},handlePointer=()=>isUsingKeyboardRef.current=!1;return document.addEventListener("keydown",handleKeyDown,{capture:!0}),()=>{document.removeEventListener("keydown",handleKeyDown,{capture:!0}),document.removeEventListener("pointerdown",handlePointer,{capture:!0}),document.removeEventListener("pointermove",handlePointer,{capture:!0})}}),[]),(0,jsx_runtime.jsx)(react_popper_dist.bL,{...popperScope,children:(0,jsx_runtime.jsx)(MenuProvider,{scope:__scopeMenu,open,onOpenChange:handleOpenChange,content,onContentChange:setContent,children:(0,jsx_runtime.jsx)(MenuRootProvider,{scope:__scopeMenu,onClose:react.useCallback((()=>handleOpenChange(!1)),[handleOpenChange]),isUsingKeyboardRef,dir:direction,modal,children})})})};Menu.displayName="Menu";var MenuAnchor=react.forwardRef(((props,forwardedRef)=>{const{__scopeMenu,...anchorProps}=props,popperScope=usePopperScope(__scopeMenu);return(0,jsx_runtime.jsx)(react_popper_dist.Mz,{...popperScope,...anchorProps,ref:forwardedRef})}));MenuAnchor.displayName="MenuAnchor";var[PortalProvider,usePortalContext]=createMenuContext("MenuPortal",{forceMount:void 0}),MenuPortal=props=>{const{__scopeMenu,forceMount,children,container}=props,context=useMenuContext("MenuPortal",__scopeMenu);return(0,jsx_runtime.jsx)(PortalProvider,{scope:__scopeMenu,forceMount,children:(0,jsx_runtime.jsx)(react_presence_dist.C,{present:forceMount||context.open,children:(0,jsx_runtime.jsx)(react_portal_dist.Z,{asChild:!0,container,children})})})};MenuPortal.displayName="MenuPortal";var[MenuContentProvider,useMenuContentContext]=createMenuContext("MenuContent"),MenuContent=react.forwardRef(((props,forwardedRef)=>{const portalContext=usePortalContext("MenuContent",props.__scopeMenu),{forceMount=portalContext.forceMount,...contentProps}=props,context=useMenuContext("MenuContent",props.__scopeMenu),rootContext=useMenuRootContext("MenuContent",props.__scopeMenu);return(0,jsx_runtime.jsx)(Collection.Provider,{scope:props.__scopeMenu,children:(0,jsx_runtime.jsx)(react_presence_dist.C,{present:forceMount||context.open,children:(0,jsx_runtime.jsx)(Collection.Slot,{scope:props.__scopeMenu,children:rootContext.modal?(0,jsx_runtime.jsx)(MenuRootContentModal,{...contentProps,ref:forwardedRef}):(0,jsx_runtime.jsx)(MenuRootContentNonModal,{...contentProps,ref:forwardedRef})})})})})),MenuRootContentModal=react.forwardRef(((props,forwardedRef)=>{const context=useMenuContext("MenuContent",props.__scopeMenu),ref=react.useRef(null),composedRefs=(0,react_compose_refs_dist.s)(forwardedRef,ref);return react.useEffect((()=>{const content=ref.current;if(content)return(0,es2015.Eq)(content)}),[]),(0,jsx_runtime.jsx)(MenuContentImpl,{...props,ref:composedRefs,trapFocus:context.open,disableOutsidePointerEvents:context.open,disableOutsideScroll:!0,onFocusOutside:(0,dist.m)(props.onFocusOutside,(event=>event.preventDefault()),{checkForDefaultPrevented:!1}),onDismiss:()=>context.onOpenChange(!1)})})),MenuRootContentNonModal=react.forwardRef(((props,forwardedRef)=>{const context=useMenuContext("MenuContent",props.__scopeMenu);return(0,jsx_runtime.jsx)(MenuContentImpl,{...props,ref:forwardedRef,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>context.onOpenChange(!1)})})),Slot=(0,react_slot_dist.TL)("MenuContent.ScrollLock"),MenuContentImpl=react.forwardRef(((props,forwardedRef)=>{const{__scopeMenu,loop=!1,trapFocus,onOpenAutoFocus,onCloseAutoFocus,disableOutsidePointerEvents,onEntryFocus,onEscapeKeyDown,onPointerDownOutside,onFocusOutside,onInteractOutside,onDismiss,disableOutsideScroll,...contentProps}=props,context=useMenuContext("MenuContent",__scopeMenu),rootContext=useMenuRootContext("MenuContent",__scopeMenu),popperScope=usePopperScope(__scopeMenu),rovingFocusGroupScope=useRovingFocusGroupScope(__scopeMenu),getItems=useCollection(__scopeMenu),[currentItemId,setCurrentItemId]=react.useState(null),contentRef=react.useRef(null),composedRefs=(0,react_compose_refs_dist.s)(forwardedRef,contentRef,context.onContentChange),timerRef=react.useRef(0),searchRef=react.useRef(""),pointerGraceTimerRef=react.useRef(0),pointerGraceIntentRef=react.useRef(null),pointerDirRef=react.useRef("right"),lastPointerXRef=react.useRef(0),ScrollLockWrapper=disableOutsideScroll?Combination.A:react.Fragment,scrollLockWrapperProps=disableOutsideScroll?{as:Slot,allowPinchZoom:!0}:void 0,handleTypeaheadSearch=key=>{const search=searchRef.current+key,items=getItems().filter((item=>!item.disabled)),currentItem=document.activeElement,currentMatch=items.find((item=>item.ref.current===currentItem))?.textValue,nextMatch=function getNextMatch(values,search,currentMatch){const isRepeated=search.length>1&&Array.from(search).every((char=>char===search[0])),normalizedSearch=isRepeated?search[0]:search,currentMatchIndex=currentMatch?values.indexOf(currentMatch):-1;let wrappedValues=function wrapArray(array,startIndex){return array.map(((_,index)=>array[(startIndex+index)%array.length]))}(values,Math.max(currentMatchIndex,0));1===normalizedSearch.length&&(wrappedValues=wrappedValues.filter((v=>v!==currentMatch)));const nextMatch=wrappedValues.find((value=>value.toLowerCase().startsWith(normalizedSearch.toLowerCase())));return nextMatch!==currentMatch?nextMatch:void 0}(items.map((item=>item.textValue)),search,currentMatch),newItem=items.find((item=>item.textValue===nextMatch))?.ref.current;!function updateSearch(value){searchRef.current=value,window.clearTimeout(timerRef.current),""!==value&&(timerRef.current=window.setTimeout((()=>updateSearch("")),1e3))}(search),newItem&&setTimeout((()=>newItem.focus()))};react.useEffect((()=>()=>window.clearTimeout(timerRef.current)),[]),(0,react_focus_guards_dist.Oh)();const isPointerMovingToSubmenu=react.useCallback((event=>pointerDirRef.current===pointerGraceIntentRef.current?.side&&function isPointerInGraceArea(event,area){if(!area)return!1;const cursorPos={x:event.clientX,y:event.clientY};return function isPointInPolygon(point,polygon){const{x,y}=point;let inside=!1;for(let i=0,j=polygon.length-1;i<polygon.length;j=i++){const ii=polygon[i],jj=polygon[j],xi=ii.x,yi=ii.y,xj=jj.x,yj=jj.y;yi>y!=yj>y&&x<(xj-xi)*(y-yi)/(yj-yi)+xi&&(inside=!inside)}return inside}(cursorPos,area)}(event,pointerGraceIntentRef.current?.area)),[]);return(0,jsx_runtime.jsx)(MenuContentProvider,{scope:__scopeMenu,searchRef,onItemEnter:react.useCallback((event=>{isPointerMovingToSubmenu(event)&&event.preventDefault()}),[isPointerMovingToSubmenu]),onItemLeave:react.useCallback((event=>{isPointerMovingToSubmenu(event)||(contentRef.current?.focus(),setCurrentItemId(null))}),[isPointerMovingToSubmenu]),onTriggerLeave:react.useCallback((event=>{isPointerMovingToSubmenu(event)&&event.preventDefault()}),[isPointerMovingToSubmenu]),pointerGraceTimerRef,onPointerGraceIntentChange:react.useCallback((intent=>{pointerGraceIntentRef.current=intent}),[]),children:(0,jsx_runtime.jsx)(ScrollLockWrapper,{...scrollLockWrapperProps,children:(0,jsx_runtime.jsx)(react_focus_scope_dist.n,{asChild:!0,trapped:trapFocus,onMountAutoFocus:(0,dist.m)(onOpenAutoFocus,(event=>{event.preventDefault(),contentRef.current?.focus({preventScroll:!0})})),onUnmountAutoFocus:onCloseAutoFocus,children:(0,jsx_runtime.jsx)(react_dismissable_layer_dist.qW,{asChild:!0,disableOutsidePointerEvents,onEscapeKeyDown,onPointerDownOutside,onFocusOutside,onInteractOutside,onDismiss,children:(0,jsx_runtime.jsx)(react_roving_focus_dist.bL,{asChild:!0,...rovingFocusGroupScope,dir:rootContext.dir,orientation:"vertical",loop,currentTabStopId:currentItemId,onCurrentTabStopIdChange:setCurrentItemId,onEntryFocus:(0,dist.m)(onEntryFocus,(event=>{rootContext.isUsingKeyboardRef.current||event.preventDefault()})),preventScrollOnEntryFocus:!0,children:(0,jsx_runtime.jsx)(react_popper_dist.UC,{role:"menu","aria-orientation":"vertical","data-state":getOpenState(context.open),"data-radix-menu-content":"",dir:rootContext.dir,...popperScope,...contentProps,ref:composedRefs,style:{outline:"none",...contentProps.style},onKeyDown:(0,dist.m)(contentProps.onKeyDown,(event=>{const isKeyDownInside=event.target.closest("[data-radix-menu-content]")===event.currentTarget,isModifierKey=event.ctrlKey||event.altKey||event.metaKey,isCharacterKey=1===event.key.length;isKeyDownInside&&("Tab"===event.key&&event.preventDefault(),!isModifierKey&&isCharacterKey&&handleTypeaheadSearch(event.key));const content=contentRef.current;if(event.target!==content)return;if(!FIRST_LAST_KEYS.includes(event.key))return;event.preventDefault();const candidateNodes=getItems().filter((item=>!item.disabled)).map((item=>item.ref.current));LAST_KEYS.includes(event.key)&&candidateNodes.reverse(),function focusFirst(candidates){const PREVIOUSLY_FOCUSED_ELEMENT=document.activeElement;for(const candidate of candidates){if(candidate===PREVIOUSLY_FOCUSED_ELEMENT)return;if(candidate.focus(),document.activeElement!==PREVIOUSLY_FOCUSED_ELEMENT)return}}(candidateNodes)})),onBlur:(0,dist.m)(props.onBlur,(event=>{event.currentTarget.contains(event.target)||(window.clearTimeout(timerRef.current),searchRef.current="")})),onPointerMove:(0,dist.m)(props.onPointerMove,whenMouse((event=>{const target=event.target,pointerXHasChanged=lastPointerXRef.current!==event.clientX;if(event.currentTarget.contains(target)&&pointerXHasChanged){const newDir=event.clientX>lastPointerXRef.current?"right":"left";pointerDirRef.current=newDir,lastPointerXRef.current=event.clientX}})))})})})})})})}));MenuContent.displayName="MenuContent";var MenuGroup=react.forwardRef(((props,forwardedRef)=>{const{__scopeMenu,...groupProps}=props;return(0,jsx_runtime.jsx)(react_primitive_dist.sG.div,{role:"group",...groupProps,ref:forwardedRef})}));MenuGroup.displayName="MenuGroup";var MenuLabel=react.forwardRef(((props,forwardedRef)=>{const{__scopeMenu,...labelProps}=props;return(0,jsx_runtime.jsx)(react_primitive_dist.sG.div,{...labelProps,ref:forwardedRef})}));MenuLabel.displayName="MenuLabel";var MenuItem=react.forwardRef(((props,forwardedRef)=>{const{disabled=!1,onSelect,...itemProps}=props,ref=react.useRef(null),rootContext=useMenuRootContext("MenuItem",props.__scopeMenu),contentContext=useMenuContentContext("MenuItem",props.__scopeMenu),composedRefs=(0,react_compose_refs_dist.s)(forwardedRef,ref),isPointerDownRef=react.useRef(!1);return(0,jsx_runtime.jsx)(MenuItemImpl,{...itemProps,ref:composedRefs,disabled,onClick:(0,dist.m)(props.onClick,(()=>{const menuItem=ref.current;if(!disabled&&menuItem){const itemSelectEvent=new CustomEvent("menu.itemSelect",{bubbles:!0,cancelable:!0});menuItem.addEventListener("menu.itemSelect",(event=>onSelect?.(event)),{once:!0}),(0,react_primitive_dist.hO)(menuItem,itemSelectEvent),itemSelectEvent.defaultPrevented?isPointerDownRef.current=!1:rootContext.onClose()}})),onPointerDown:event=>{props.onPointerDown?.(event),isPointerDownRef.current=!0},onPointerUp:(0,dist.m)(props.onPointerUp,(event=>{isPointerDownRef.current||event.currentTarget?.click()})),onKeyDown:(0,dist.m)(props.onKeyDown,(event=>{const isTypingAhead=""!==contentContext.searchRef.current;disabled||isTypingAhead&&" "===event.key||SELECTION_KEYS.includes(event.key)&&(event.currentTarget.click(),event.preventDefault())}))})}));MenuItem.displayName="MenuItem";var MenuItemImpl=react.forwardRef(((props,forwardedRef)=>{const{__scopeMenu,disabled=!1,textValue,...itemProps}=props,contentContext=useMenuContentContext("MenuItem",__scopeMenu),rovingFocusGroupScope=useRovingFocusGroupScope(__scopeMenu),ref=react.useRef(null),composedRefs=(0,react_compose_refs_dist.s)(forwardedRef,ref),[isFocused,setIsFocused]=react.useState(!1),[textContent,setTextContent]=react.useState("");return react.useEffect((()=>{const menuItem=ref.current;menuItem&&setTextContent((menuItem.textContent??"").trim())}),[itemProps.children]),(0,jsx_runtime.jsx)(Collection.ItemSlot,{scope:__scopeMenu,disabled,textValue:textValue??textContent,children:(0,jsx_runtime.jsx)(react_roving_focus_dist.q7,{asChild:!0,...rovingFocusGroupScope,focusable:!disabled,children:(0,jsx_runtime.jsx)(react_primitive_dist.sG.div,{role:"menuitem","data-highlighted":isFocused?"":void 0,"aria-disabled":disabled||void 0,"data-disabled":disabled?"":void 0,...itemProps,ref:composedRefs,onPointerMove:(0,dist.m)(props.onPointerMove,whenMouse((event=>{if(disabled)contentContext.onItemLeave(event);else if(contentContext.onItemEnter(event),!event.defaultPrevented){event.currentTarget.focus({preventScroll:!0})}}))),onPointerLeave:(0,dist.m)(props.onPointerLeave,whenMouse((event=>contentContext.onItemLeave(event)))),onFocus:(0,dist.m)(props.onFocus,(()=>setIsFocused(!0))),onBlur:(0,dist.m)(props.onBlur,(()=>setIsFocused(!1)))})})})})),MenuCheckboxItem=react.forwardRef(((props,forwardedRef)=>{const{checked=!1,onCheckedChange,...checkboxItemProps}=props;return(0,jsx_runtime.jsx)(ItemIndicatorProvider,{scope:props.__scopeMenu,checked,children:(0,jsx_runtime.jsx)(MenuItem,{role:"menuitemcheckbox","aria-checked":isIndeterminate(checked)?"mixed":checked,...checkboxItemProps,ref:forwardedRef,"data-state":getCheckedState(checked),onSelect:(0,dist.m)(checkboxItemProps.onSelect,(()=>onCheckedChange?.(!!isIndeterminate(checked)||!checked)),{checkForDefaultPrevented:!1})})})}));MenuCheckboxItem.displayName="MenuCheckboxItem";var[RadioGroupProvider,useRadioGroupContext]=createMenuContext("MenuRadioGroup",{value:void 0,onValueChange:()=>{}}),MenuRadioGroup=react.forwardRef(((props,forwardedRef)=>{const{value,onValueChange,...groupProps}=props,handleValueChange=(0,react_use_callback_ref_dist.c)(onValueChange);return(0,jsx_runtime.jsx)(RadioGroupProvider,{scope:props.__scopeMenu,value,onValueChange:handleValueChange,children:(0,jsx_runtime.jsx)(MenuGroup,{...groupProps,ref:forwardedRef})})}));MenuRadioGroup.displayName="MenuRadioGroup";var MenuRadioItem=react.forwardRef(((props,forwardedRef)=>{const{value,...radioItemProps}=props,context=useRadioGroupContext("MenuRadioItem",props.__scopeMenu),checked=value===context.value;return(0,jsx_runtime.jsx)(ItemIndicatorProvider,{scope:props.__scopeMenu,checked,children:(0,jsx_runtime.jsx)(MenuItem,{role:"menuitemradio","aria-checked":checked,...radioItemProps,ref:forwardedRef,"data-state":getCheckedState(checked),onSelect:(0,dist.m)(radioItemProps.onSelect,(()=>context.onValueChange?.(value)),{checkForDefaultPrevented:!1})})})}));MenuRadioItem.displayName="MenuRadioItem";var[ItemIndicatorProvider,useItemIndicatorContext]=createMenuContext("MenuItemIndicator",{checked:!1}),MenuItemIndicator=react.forwardRef(((props,forwardedRef)=>{const{__scopeMenu,forceMount,...itemIndicatorProps}=props,indicatorContext=useItemIndicatorContext("MenuItemIndicator",__scopeMenu);return(0,jsx_runtime.jsx)(react_presence_dist.C,{present:forceMount||isIndeterminate(indicatorContext.checked)||!0===indicatorContext.checked,children:(0,jsx_runtime.jsx)(react_primitive_dist.sG.span,{...itemIndicatorProps,ref:forwardedRef,"data-state":getCheckedState(indicatorContext.checked)})})}));MenuItemIndicator.displayName="MenuItemIndicator";var MenuSeparator=react.forwardRef(((props,forwardedRef)=>{const{__scopeMenu,...separatorProps}=props;return(0,jsx_runtime.jsx)(react_primitive_dist.sG.div,{role:"separator","aria-orientation":"horizontal",...separatorProps,ref:forwardedRef})}));MenuSeparator.displayName="MenuSeparator";var MenuArrow=react.forwardRef(((props,forwardedRef)=>{const{__scopeMenu,...arrowProps}=props,popperScope=usePopperScope(__scopeMenu);return(0,jsx_runtime.jsx)(react_popper_dist.i3,{...popperScope,...arrowProps,ref:forwardedRef})}));MenuArrow.displayName="MenuArrow";var[MenuSubProvider,useMenuSubContext]=createMenuContext("MenuSub"),MenuSub=props=>{const{__scopeMenu,children,open=!1,onOpenChange}=props,parentMenuContext=useMenuContext("MenuSub",__scopeMenu),popperScope=usePopperScope(__scopeMenu),[trigger,setTrigger]=react.useState(null),[content,setContent]=react.useState(null),handleOpenChange=(0,react_use_callback_ref_dist.c)(onOpenChange);return react.useEffect((()=>(!1===parentMenuContext.open&&handleOpenChange(!1),()=>handleOpenChange(!1))),[parentMenuContext.open,handleOpenChange]),(0,jsx_runtime.jsx)(react_popper_dist.bL,{...popperScope,children:(0,jsx_runtime.jsx)(MenuProvider,{scope:__scopeMenu,open,onOpenChange:handleOpenChange,content,onContentChange:setContent,children:(0,jsx_runtime.jsx)(MenuSubProvider,{scope:__scopeMenu,contentId:(0,react_id_dist.B)(),triggerId:(0,react_id_dist.B)(),trigger,onTriggerChange:setTrigger,children})})})};MenuSub.displayName="MenuSub";var MenuSubTrigger=react.forwardRef(((props,forwardedRef)=>{const context=useMenuContext("MenuSubTrigger",props.__scopeMenu),rootContext=useMenuRootContext("MenuSubTrigger",props.__scopeMenu),subContext=useMenuSubContext("MenuSubTrigger",props.__scopeMenu),contentContext=useMenuContentContext("MenuSubTrigger",props.__scopeMenu),openTimerRef=react.useRef(null),{pointerGraceTimerRef,onPointerGraceIntentChange}=contentContext,scope={__scopeMenu:props.__scopeMenu},clearOpenTimer=react.useCallback((()=>{openTimerRef.current&&window.clearTimeout(openTimerRef.current),openTimerRef.current=null}),[]);return react.useEffect((()=>clearOpenTimer),[clearOpenTimer]),react.useEffect((()=>{const pointerGraceTimer=pointerGraceTimerRef.current;return()=>{window.clearTimeout(pointerGraceTimer),onPointerGraceIntentChange(null)}}),[pointerGraceTimerRef,onPointerGraceIntentChange]),(0,jsx_runtime.jsx)(MenuAnchor,{asChild:!0,...scope,children:(0,jsx_runtime.jsx)(MenuItemImpl,{id:subContext.triggerId,"aria-haspopup":"menu","aria-expanded":context.open,"aria-controls":subContext.contentId,"data-state":getOpenState(context.open),...props,ref:(0,react_compose_refs_dist.t)(forwardedRef,subContext.onTriggerChange),onClick:event=>{props.onClick?.(event),props.disabled||event.defaultPrevented||(event.currentTarget.focus(),context.open||context.onOpenChange(!0))},onPointerMove:(0,dist.m)(props.onPointerMove,whenMouse((event=>{contentContext.onItemEnter(event),event.defaultPrevented||props.disabled||context.open||openTimerRef.current||(contentContext.onPointerGraceIntentChange(null),openTimerRef.current=window.setTimeout((()=>{context.onOpenChange(!0),clearOpenTimer()}),100))}))),onPointerLeave:(0,dist.m)(props.onPointerLeave,whenMouse((event=>{clearOpenTimer();const contentRect=context.content?.getBoundingClientRect();if(contentRect){const side=context.content?.dataset.side,rightSide="right"===side,bleed=rightSide?-5:5,contentNearEdge=contentRect[rightSide?"left":"right"],contentFarEdge=contentRect[rightSide?"right":"left"];contentContext.onPointerGraceIntentChange({area:[{x:event.clientX+bleed,y:event.clientY},{x:contentNearEdge,y:contentRect.top},{x:contentFarEdge,y:contentRect.top},{x:contentFarEdge,y:contentRect.bottom},{x:contentNearEdge,y:contentRect.bottom}],side}),window.clearTimeout(pointerGraceTimerRef.current),pointerGraceTimerRef.current=window.setTimeout((()=>contentContext.onPointerGraceIntentChange(null)),300)}else{if(contentContext.onTriggerLeave(event),event.defaultPrevented)return;contentContext.onPointerGraceIntentChange(null)}}))),onKeyDown:(0,dist.m)(props.onKeyDown,(event=>{const isTypingAhead=""!==contentContext.searchRef.current;props.disabled||isTypingAhead&&" "===event.key||SUB_OPEN_KEYS[rootContext.dir].includes(event.key)&&(context.onOpenChange(!0),context.content?.focus(),event.preventDefault())}))})})}));MenuSubTrigger.displayName="MenuSubTrigger";var MenuSubContent=react.forwardRef(((props,forwardedRef)=>{const portalContext=usePortalContext("MenuContent",props.__scopeMenu),{forceMount=portalContext.forceMount,...subContentProps}=props,context=useMenuContext("MenuContent",props.__scopeMenu),rootContext=useMenuRootContext("MenuContent",props.__scopeMenu),subContext=useMenuSubContext("MenuSubContent",props.__scopeMenu),ref=react.useRef(null),composedRefs=(0,react_compose_refs_dist.s)(forwardedRef,ref);return(0,jsx_runtime.jsx)(Collection.Provider,{scope:props.__scopeMenu,children:(0,jsx_runtime.jsx)(react_presence_dist.C,{present:forceMount||context.open,children:(0,jsx_runtime.jsx)(Collection.Slot,{scope:props.__scopeMenu,children:(0,jsx_runtime.jsx)(MenuContentImpl,{id:subContext.contentId,"aria-labelledby":subContext.triggerId,...subContentProps,ref:composedRefs,align:"start",side:"rtl"===rootContext.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:event=>{rootContext.isUsingKeyboardRef.current&&ref.current?.focus(),event.preventDefault()},onCloseAutoFocus:event=>event.preventDefault(),onFocusOutside:(0,dist.m)(props.onFocusOutside,(event=>{event.target!==subContext.trigger&&context.onOpenChange(!1)})),onEscapeKeyDown:(0,dist.m)(props.onEscapeKeyDown,(event=>{rootContext.onClose(),event.preventDefault()})),onKeyDown:(0,dist.m)(props.onKeyDown,(event=>{const isKeyDownInside=event.currentTarget.contains(event.target),isCloseKey=SUB_CLOSE_KEYS[rootContext.dir].includes(event.key);isKeyDownInside&&isCloseKey&&(context.onOpenChange(!1),subContext.trigger?.focus(),event.preventDefault())}))})})})})}));function getOpenState(open){return open?"open":"closed"}function isIndeterminate(checked){return"indeterminate"===checked}function getCheckedState(checked){return isIndeterminate(checked)?"indeterminate":checked?"checked":"unchecked"}function whenMouse(handler){return event=>"mouse"===event.pointerType?handler(event):void 0}MenuSubContent.displayName="MenuSubContent";var Root3=Menu,Anchor2=MenuAnchor,Portal=MenuPortal,Content2=MenuContent,Group=MenuGroup,Label=MenuLabel,Item2=MenuItem,CheckboxItem=MenuCheckboxItem,RadioGroup=MenuRadioGroup,RadioItem=MenuRadioItem,ItemIndicator=MenuItemIndicator,Separator=MenuSeparator,Arrow2=MenuArrow,Sub=MenuSub,SubTrigger=MenuSubTrigger,SubContent=MenuSubContent,[createDropdownMenuContext,createDropdownMenuScope]=(0,react_context_dist.A)("DropdownMenu",[createMenuScope]),useMenuScope=createMenuScope(),[DropdownMenuProvider,useDropdownMenuContext]=createDropdownMenuContext("DropdownMenu"),DropdownMenu=props=>{const{__scopeDropdownMenu,children,dir,open:openProp,defaultOpen,onOpenChange,modal=!0}=props,menuScope=useMenuScope(__scopeDropdownMenu),triggerRef=react.useRef(null),[open,setOpen]=(0,react_use_controllable_state_dist.i)({prop:openProp,defaultProp:defaultOpen??!1,onChange:onOpenChange,caller:"DropdownMenu"});return(0,jsx_runtime.jsx)(DropdownMenuProvider,{scope:__scopeDropdownMenu,triggerId:(0,react_id_dist.B)(),triggerRef,contentId:(0,react_id_dist.B)(),open,onOpenChange:setOpen,onOpenToggle:react.useCallback((()=>setOpen((prevOpen=>!prevOpen))),[setOpen]),modal,children:(0,jsx_runtime.jsx)(Root3,{...menuScope,open,onOpenChange:setOpen,dir,modal,children})})};DropdownMenu.displayName="DropdownMenu";var DropdownMenuTrigger=react.forwardRef(((props,forwardedRef)=>{const{__scopeDropdownMenu,disabled=!1,...triggerProps}=props,context=useDropdownMenuContext("DropdownMenuTrigger",__scopeDropdownMenu),menuScope=useMenuScope(__scopeDropdownMenu);return(0,jsx_runtime.jsx)(Anchor2,{asChild:!0,...menuScope,children:(0,jsx_runtime.jsx)(react_primitive_dist.sG.button,{type:"button",id:context.triggerId,"aria-haspopup":"menu","aria-expanded":context.open,"aria-controls":context.open?context.contentId:void 0,"data-state":context.open?"open":"closed","data-disabled":disabled?"":void 0,disabled,...triggerProps,ref:(0,react_compose_refs_dist.t)(forwardedRef,context.triggerRef),onPointerDown:(0,dist.m)(props.onPointerDown,(event=>{disabled||0!==event.button||!1!==event.ctrlKey||(context.onOpenToggle(),context.open||event.preventDefault())})),onKeyDown:(0,dist.m)(props.onKeyDown,(event=>{disabled||(["Enter"," "].includes(event.key)&&context.onOpenToggle(),"ArrowDown"===event.key&&context.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(event.key)&&event.preventDefault())}))})})}));DropdownMenuTrigger.displayName="DropdownMenuTrigger";var DropdownMenuPortal=props=>{const{__scopeDropdownMenu,...portalProps}=props,menuScope=useMenuScope(__scopeDropdownMenu);return(0,jsx_runtime.jsx)(Portal,{...menuScope,...portalProps})};DropdownMenuPortal.displayName="DropdownMenuPortal";var DropdownMenuContent=react.forwardRef(((props,forwardedRef)=>{const{__scopeDropdownMenu,...contentProps}=props,context=useDropdownMenuContext("DropdownMenuContent",__scopeDropdownMenu),menuScope=useMenuScope(__scopeDropdownMenu),hasInteractedOutsideRef=react.useRef(!1);return(0,jsx_runtime.jsx)(Content2,{id:context.contentId,"aria-labelledby":context.triggerId,...menuScope,...contentProps,ref:forwardedRef,onCloseAutoFocus:(0,dist.m)(props.onCloseAutoFocus,(event=>{hasInteractedOutsideRef.current||context.triggerRef.current?.focus(),hasInteractedOutsideRef.current=!1,event.preventDefault()})),onInteractOutside:(0,dist.m)(props.onInteractOutside,(event=>{const originalEvent=event.detail.originalEvent,ctrlLeftClick=0===originalEvent.button&&!0===originalEvent.ctrlKey,isRightClick=2===originalEvent.button||ctrlLeftClick;context.modal&&!isRightClick||(hasInteractedOutsideRef.current=!0)})),style:{...props.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})}));DropdownMenuContent.displayName="DropdownMenuContent";var DropdownMenuGroup=react.forwardRef(((props,forwardedRef)=>{const{__scopeDropdownMenu,...groupProps}=props,menuScope=useMenuScope(__scopeDropdownMenu);return(0,jsx_runtime.jsx)(Group,{...menuScope,...groupProps,ref:forwardedRef})}));DropdownMenuGroup.displayName="DropdownMenuGroup";var DropdownMenuLabel=react.forwardRef(((props,forwardedRef)=>{const{__scopeDropdownMenu,...labelProps}=props,menuScope=useMenuScope(__scopeDropdownMenu);return(0,jsx_runtime.jsx)(Label,{...menuScope,...labelProps,ref:forwardedRef})}));DropdownMenuLabel.displayName="DropdownMenuLabel";var DropdownMenuItem=react.forwardRef(((props,forwardedRef)=>{const{__scopeDropdownMenu,...itemProps}=props,menuScope=useMenuScope(__scopeDropdownMenu);return(0,jsx_runtime.jsx)(Item2,{...menuScope,...itemProps,ref:forwardedRef})}));DropdownMenuItem.displayName="DropdownMenuItem";var DropdownMenuCheckboxItem=react.forwardRef(((props,forwardedRef)=>{const{__scopeDropdownMenu,...checkboxItemProps}=props,menuScope=useMenuScope(__scopeDropdownMenu);return(0,jsx_runtime.jsx)(CheckboxItem,{...menuScope,...checkboxItemProps,ref:forwardedRef})}));DropdownMenuCheckboxItem.displayName="DropdownMenuCheckboxItem";var DropdownMenuRadioGroup=react.forwardRef(((props,forwardedRef)=>{const{__scopeDropdownMenu,...radioGroupProps}=props,menuScope=useMenuScope(__scopeDropdownMenu);return(0,jsx_runtime.jsx)(RadioGroup,{...menuScope,...radioGroupProps,ref:forwardedRef})}));DropdownMenuRadioGroup.displayName="DropdownMenuRadioGroup";var DropdownMenuRadioItem=react.forwardRef(((props,forwardedRef)=>{const{__scopeDropdownMenu,...radioItemProps}=props,menuScope=useMenuScope(__scopeDropdownMenu);return(0,jsx_runtime.jsx)(RadioItem,{...menuScope,...radioItemProps,ref:forwardedRef})}));DropdownMenuRadioItem.displayName="DropdownMenuRadioItem";var DropdownMenuItemIndicator=react.forwardRef(((props,forwardedRef)=>{const{__scopeDropdownMenu,...itemIndicatorProps}=props,menuScope=useMenuScope(__scopeDropdownMenu);return(0,jsx_runtime.jsx)(ItemIndicator,{...menuScope,...itemIndicatorProps,ref:forwardedRef})}));DropdownMenuItemIndicator.displayName="DropdownMenuItemIndicator";var DropdownMenuSeparator=react.forwardRef(((props,forwardedRef)=>{const{__scopeDropdownMenu,...separatorProps}=props,menuScope=useMenuScope(__scopeDropdownMenu);return(0,jsx_runtime.jsx)(Separator,{...menuScope,...separatorProps,ref:forwardedRef})}));DropdownMenuSeparator.displayName="DropdownMenuSeparator";var DropdownMenuArrow=react.forwardRef(((props,forwardedRef)=>{const{__scopeDropdownMenu,...arrowProps}=props,menuScope=useMenuScope(__scopeDropdownMenu);return(0,jsx_runtime.jsx)(Arrow2,{...menuScope,...arrowProps,ref:forwardedRef})}));DropdownMenuArrow.displayName="DropdownMenuArrow";var DropdownMenuSubTrigger=react.forwardRef(((props,forwardedRef)=>{const{__scopeDropdownMenu,...subTriggerProps}=props,menuScope=useMenuScope(__scopeDropdownMenu);return(0,jsx_runtime.jsx)(SubTrigger,{...menuScope,...subTriggerProps,ref:forwardedRef})}));DropdownMenuSubTrigger.displayName="DropdownMenuSubTrigger";var DropdownMenuSubContent=react.forwardRef(((props,forwardedRef)=>{const{__scopeDropdownMenu,...subContentProps}=props,menuScope=useMenuScope(__scopeDropdownMenu);return(0,jsx_runtime.jsx)(SubContent,{...menuScope,...subContentProps,ref:forwardedRef,style:{...props.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})}));DropdownMenuSubContent.displayName="DropdownMenuSubContent";var Root2=DropdownMenu,Trigger=DropdownMenuTrigger,Portal2=DropdownMenuPortal,dist_Content2=DropdownMenuContent,dist_Item2=DropdownMenuItem,CheckboxItem2=DropdownMenuCheckboxItem,Sub2=props=>{const{__scopeDropdownMenu,children,open:openProp,onOpenChange,defaultOpen}=props,menuScope=useMenuScope(__scopeDropdownMenu),[open,setOpen]=(0,react_use_controllable_state_dist.i)({prop:openProp,defaultProp:defaultOpen??!1,onChange:onOpenChange,caller:"DropdownMenuSub"});return(0,jsx_runtime.jsx)(Sub,{...menuScope,open,onOpenChange:setOpen,children})},SubTrigger2=DropdownMenuSubTrigger,SubContent2=DropdownMenuSubContent,[createContextMenuContext,createContextMenuScope]=(0,react_context_dist.A)("ContextMenu",[createMenuScope]),dist_useMenuScope=createMenuScope(),[ContextMenuProvider,useContextMenuContext]=createContextMenuContext("ContextMenu"),ContextMenu=props=>{const{__scopeContextMenu,children,onOpenChange,dir,modal=!0}=props,[open,setOpen]=react.useState(!1),menuScope=dist_useMenuScope(__scopeContextMenu),handleOpenChangeProp=(0,react_use_callback_ref_dist.c)(onOpenChange),handleOpenChange=react.useCallback((open2=>{setOpen(open2),handleOpenChangeProp(open2)}),[handleOpenChangeProp]);return(0,jsx_runtime.jsx)(ContextMenuProvider,{scope:__scopeContextMenu,open,onOpenChange:handleOpenChange,modal,children:(0,jsx_runtime.jsx)(Root3,{...menuScope,dir,open,onOpenChange:handleOpenChange,modal,children})})};ContextMenu.displayName="ContextMenu";var ContextMenuTrigger=react.forwardRef(((props,forwardedRef)=>{const{__scopeContextMenu,disabled=!1,...triggerProps}=props,context=useContextMenuContext("ContextMenuTrigger",__scopeContextMenu),menuScope=dist_useMenuScope(__scopeContextMenu),pointRef=react.useRef({x:0,y:0}),virtualRef=react.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...pointRef.current})}),longPressTimerRef=react.useRef(0),clearLongPress=react.useCallback((()=>window.clearTimeout(longPressTimerRef.current)),[]),handleOpen=event=>{pointRef.current={x:event.clientX,y:event.clientY},context.onOpenChange(!0)};return react.useEffect((()=>clearLongPress),[clearLongPress]),react.useEffect((()=>{disabled&&clearLongPress()}),[disabled,clearLongPress]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Anchor2,{...menuScope,virtualRef}),(0,jsx_runtime.jsx)(react_primitive_dist.sG.span,{"data-state":context.open?"open":"closed","data-disabled":disabled?"":void 0,...triggerProps,ref:forwardedRef,style:{WebkitTouchCallout:"none",...props.style},onContextMenu:disabled?props.onContextMenu:(0,dist.m)(props.onContextMenu,(event=>{clearLongPress(),handleOpen(event),event.preventDefault()})),onPointerDown:disabled?props.onPointerDown:(0,dist.m)(props.onPointerDown,whenTouchOrPen((event=>{clearLongPress(),longPressTimerRef.current=window.setTimeout((()=>handleOpen(event)),700)}))),onPointerMove:disabled?props.onPointerMove:(0,dist.m)(props.onPointerMove,whenTouchOrPen(clearLongPress)),onPointerCancel:disabled?props.onPointerCancel:(0,dist.m)(props.onPointerCancel,whenTouchOrPen(clearLongPress)),onPointerUp:disabled?props.onPointerUp:(0,dist.m)(props.onPointerUp,whenTouchOrPen(clearLongPress))})]})}));ContextMenuTrigger.displayName="ContextMenuTrigger";var ContextMenuPortal=props=>{const{__scopeContextMenu,...portalProps}=props,menuScope=dist_useMenuScope(__scopeContextMenu);return(0,jsx_runtime.jsx)(Portal,{...menuScope,...portalProps})};ContextMenuPortal.displayName="ContextMenuPortal";var ContextMenuContent=react.forwardRef(((props,forwardedRef)=>{const{__scopeContextMenu,...contentProps}=props,context=useContextMenuContext("ContextMenuContent",__scopeContextMenu),menuScope=dist_useMenuScope(__scopeContextMenu),hasInteractedOutsideRef=react.useRef(!1);return(0,jsx_runtime.jsx)(Content2,{...menuScope,...contentProps,ref:forwardedRef,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:event=>{props.onCloseAutoFocus?.(event),!event.defaultPrevented&&hasInteractedOutsideRef.current&&event.preventDefault(),hasInteractedOutsideRef.current=!1},onInteractOutside:event=>{props.onInteractOutside?.(event),event.defaultPrevented||context.modal||(hasInteractedOutsideRef.current=!0)},style:{...props.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})}));ContextMenuContent.displayName="ContextMenuContent";var ContextMenuGroup=react.forwardRef(((props,forwardedRef)=>{const{__scopeContextMenu,...groupProps}=props,menuScope=dist_useMenuScope(__scopeContextMenu);return(0,jsx_runtime.jsx)(Group,{...menuScope,...groupProps,ref:forwardedRef})}));ContextMenuGroup.displayName="ContextMenuGroup";var ContextMenuLabel=react.forwardRef(((props,forwardedRef)=>{const{__scopeContextMenu,...labelProps}=props,menuScope=dist_useMenuScope(__scopeContextMenu);return(0,jsx_runtime.jsx)(Label,{...menuScope,...labelProps,ref:forwardedRef})}));ContextMenuLabel.displayName="ContextMenuLabel";var ContextMenuItem=react.forwardRef(((props,forwardedRef)=>{const{__scopeContextMenu,...itemProps}=props,menuScope=dist_useMenuScope(__scopeContextMenu);return(0,jsx_runtime.jsx)(Item2,{...menuScope,...itemProps,ref:forwardedRef})}));ContextMenuItem.displayName="ContextMenuItem";var ContextMenuCheckboxItem=react.forwardRef(((props,forwardedRef)=>{const{__scopeContextMenu,...checkboxItemProps}=props,menuScope=dist_useMenuScope(__scopeContextMenu);return(0,jsx_runtime.jsx)(CheckboxItem,{...menuScope,...checkboxItemProps,ref:forwardedRef})}));ContextMenuCheckboxItem.displayName="ContextMenuCheckboxItem";var ContextMenuRadioGroup=react.forwardRef(((props,forwardedRef)=>{const{__scopeContextMenu,...radioGroupProps}=props,menuScope=dist_useMenuScope(__scopeContextMenu);return(0,jsx_runtime.jsx)(RadioGroup,{...menuScope,...radioGroupProps,ref:forwardedRef})}));ContextMenuRadioGroup.displayName="ContextMenuRadioGroup";var ContextMenuRadioItem=react.forwardRef(((props,forwardedRef)=>{const{__scopeContextMenu,...radioItemProps}=props,menuScope=dist_useMenuScope(__scopeContextMenu);return(0,jsx_runtime.jsx)(RadioItem,{...menuScope,...radioItemProps,ref:forwardedRef})}));ContextMenuRadioItem.displayName="ContextMenuRadioItem";var ContextMenuItemIndicator=react.forwardRef(((props,forwardedRef)=>{const{__scopeContextMenu,...itemIndicatorProps}=props,menuScope=dist_useMenuScope(__scopeContextMenu);return(0,jsx_runtime.jsx)(ItemIndicator,{...menuScope,...itemIndicatorProps,ref:forwardedRef})}));ContextMenuItemIndicator.displayName="ContextMenuItemIndicator";var ContextMenuSeparator=react.forwardRef(((props,forwardedRef)=>{const{__scopeContextMenu,...separatorProps}=props,menuScope=dist_useMenuScope(__scopeContextMenu);return(0,jsx_runtime.jsx)(Separator,{...menuScope,...separatorProps,ref:forwardedRef})}));ContextMenuSeparator.displayName="ContextMenuSeparator";var ContextMenuArrow=react.forwardRef(((props,forwardedRef)=>{const{__scopeContextMenu,...arrowProps}=props,menuScope=dist_useMenuScope(__scopeContextMenu);return(0,jsx_runtime.jsx)(Arrow2,{...menuScope,...arrowProps,ref:forwardedRef})}));ContextMenuArrow.displayName="ContextMenuArrow";var ContextMenuSub=props=>{const{__scopeContextMenu,children,onOpenChange,open:openProp,defaultOpen}=props,menuScope=dist_useMenuScope(__scopeContextMenu),[open,setOpen]=(0,react_use_controllable_state_dist.i)({prop:openProp,defaultProp:defaultOpen??!1,onChange:onOpenChange,caller:"ContextMenuSub"});return(0,jsx_runtime.jsx)(Sub,{...menuScope,open,onOpenChange:setOpen,children})};ContextMenuSub.displayName="ContextMenuSub";var ContextMenuSubTrigger=react.forwardRef(((props,forwardedRef)=>{const{__scopeContextMenu,...triggerItemProps}=props,menuScope=dist_useMenuScope(__scopeContextMenu);return(0,jsx_runtime.jsx)(SubTrigger,{...menuScope,...triggerItemProps,ref:forwardedRef})}));ContextMenuSubTrigger.displayName="ContextMenuSubTrigger";var ContextMenuSubContent=react.forwardRef(((props,forwardedRef)=>{const{__scopeContextMenu,...subContentProps}=props,menuScope=dist_useMenuScope(__scopeContextMenu);return(0,jsx_runtime.jsx)(SubContent,{...menuScope,...subContentProps,ref:forwardedRef,style:{...props.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})}));function whenTouchOrPen(handler){return event=>"mouse"!==event.pointerType?handler(event):void 0}ContextMenuSubContent.displayName="ContextMenuSubContent";var dist_Root2=ContextMenu,dist_Trigger=ContextMenuTrigger,dist_Portal2=ContextMenuPortal,react_context_menu_dist_Content2=ContextMenuContent,react_context_menu_dist_Item2=ContextMenuItem,dist_CheckboxItem2=ContextMenuCheckboxItem;function kickoutOccludedShapes(editor,shapeIds){const parentsToCheck=new Set;for(const id of shapeIds){const shape=editor.getShape(id);if(!shape)continue;editor.getShapeUtil(shape).onDragShapesOut&&parentsToCheck.add(shape);const parent=editor.getShape(shape.parentId);parent&&(editor.getShapeUtil(parent).onDragShapesOut&&parentsToCheck.add(parent))}const parentsWithKickedOutChildren=new Map;for(const parent of parentsToCheck){const occludedChildren=getOccludedChildren(editor,parent);occludedChildren.length&&parentsWithKickedOutChildren.set(parent,occludedChildren)}for(const[parent,kickedOutChildrenIds]of parentsWithKickedOutChildren){const shapeUtil=editor.getShapeUtil(parent),kickedOutChildren=(0,dist_esm.oE7)(kickedOutChildrenIds.map((id=>editor.getShape(id))));shapeUtil.onDragShapesOut?.(parent,kickedOutChildren)}}function getOccludedChildren(editor,parent){const childIds=editor.getSortedChildIdsForParent(parent.id);if(0===childIds.length)return[];const parentPageBounds=editor.getShapePageBounds(parent);if(!parentPageBounds)return[];let parentGeometry,parentPageTransform,parentPageCorners;const results=[];for(const childId of childIds){const shapePageBounds=editor.getShapePageBounds(childId);if(!shapePageBounds)continue;if(!parentPageBounds.includes(shapePageBounds)){results.push(childId);continue}parentGeometry??=editor.getShapeGeometry(parent),parentPageTransform??=editor.getShapePageTransform(parent),parentPageCorners??=parentPageTransform.applyToPoints(parentGeometry.vertices);const parentCornersInShapeSpace=editor.getShapePageTransform(childId).clone().invert().applyToPoints(parentPageCorners),{vertices,isClosed}=editor.getShapeGeometry(childId);if(!vertices.some((v=>(0,dist_esm.s3y)(v,parentCornersInShapeSpace)))){if(isClosed){if((0,dist_esm.Rx2)(parentCornersInShapeSpace,vertices))continue}else if((0,dist_esm.j0P)(parentCornersInShapeSpace,vertices))continue;results.push(childId)}}return results}function startEditingShapeWithLabel(editor,shape,selectAll=!1){editor.select(shape),editor.setEditingShape(shape),editor.setCurrentTool("select.editing_shape",{target:"shape",shape}),selectAll&&editor.emit("select-all-text",{shapeId:shape.id})}const DEFAULT_FRAME_PADDING=50;function getFrameChildrenBounds(children,editor,opts={padding:DEFAULT_FRAME_PADDING}){const bounds=dist_esm.azJ.FromPoints(children.flatMap((shape=>{if(!shape)return[];const geometry=editor.getShapeGeometry(shape.id),transform=editor.getShapeLocalTransform(shape);return transform?.applyToPoints(geometry.vertices)??[]}))),padding=opts.padding??DEFAULT_FRAME_PADDING;return{w:bounds.w+2*padding,h:bounds.h+2*padding,dx:padding-bounds.minX,dy:padding-bounds.minY}}function fitFrameToContent(editor,id,opts={}){const frame=editor.getShape(id);if(!frame)return;const childIds=editor.getSortedChildIdsForParent(frame.id),children=(0,dist_esm.oE7)(childIds.map((id2=>editor.getShape(id2))));if(!children.length)return;const{w,h,dx,dy}=getFrameChildrenBounds(children,editor,opts);if(0===dx&&0===dy&&frame.props.w===w&&frame.props.h===h)return;const diff=new dist_esm.l2P(dx,dy).rot(frame.rotation);editor.run((()=>{const changes=childIds.map((child=>{const shape=editor.getShape(child);return{id:shape.id,type:shape.type,x:shape.x+dx,y:shape.y+dy}}));changes.push({id:frame.id,type:frame.type,x:frame.x-diff.x,y:frame.y-diff.y,props:{w,h}}),editor.updateShapes(changes)}))}function TldrawUiButtonLabel({children}){return(0,jsx_runtime.jsx)("span",{className:"tlui-button__label",children})}var[createDialogContext,createDialogScope]=(0,react_context_dist.A)("Dialog"),[DialogProvider,useDialogContext]=createDialogContext("Dialog"),Dialog=props=>{const{__scopeDialog,children,open:openProp,defaultOpen,onOpenChange,modal=!0}=props,triggerRef=react.useRef(null),contentRef=react.useRef(null),[open,setOpen]=(0,react_use_controllable_state_dist.i)({prop:openProp,defaultProp:defaultOpen??!1,onChange:onOpenChange,caller:"Dialog"});return(0,jsx_runtime.jsx)(DialogProvider,{scope:__scopeDialog,triggerRef,contentRef,contentId:(0,react_id_dist.B)(),titleId:(0,react_id_dist.B)(),descriptionId:(0,react_id_dist.B)(),open,onOpenChange:setOpen,onOpenToggle:react.useCallback((()=>setOpen((prevOpen=>!prevOpen))),[setOpen]),modal,children})};Dialog.displayName="Dialog";var DialogTrigger=react.forwardRef(((props,forwardedRef)=>{const{__scopeDialog,...triggerProps}=props,context=useDialogContext("DialogTrigger",__scopeDialog),composedTriggerRef=(0,react_compose_refs_dist.s)(forwardedRef,context.triggerRef);return(0,jsx_runtime.jsx)(react_primitive_dist.sG.button,{type:"button","aria-haspopup":"dialog","aria-expanded":context.open,"aria-controls":context.contentId,"data-state":getState(context.open),...triggerProps,ref:composedTriggerRef,onClick:(0,dist.m)(props.onClick,context.onOpenToggle)})}));DialogTrigger.displayName="DialogTrigger";var[dist_PortalProvider,dist_usePortalContext]=createDialogContext("DialogPortal",{forceMount:void 0}),DialogPortal=props=>{const{__scopeDialog,forceMount,children,container}=props,context=useDialogContext("DialogPortal",__scopeDialog);return(0,jsx_runtime.jsx)(dist_PortalProvider,{scope:__scopeDialog,forceMount,children:react.Children.map(children,(child=>(0,jsx_runtime.jsx)(react_presence_dist.C,{present:forceMount||context.open,children:(0,jsx_runtime.jsx)(react_portal_dist.Z,{asChild:!0,container,children:child})})))})};DialogPortal.displayName="DialogPortal";var DialogOverlay=react.forwardRef(((props,forwardedRef)=>{const portalContext=dist_usePortalContext("DialogOverlay",props.__scopeDialog),{forceMount=portalContext.forceMount,...overlayProps}=props,context=useDialogContext("DialogOverlay",props.__scopeDialog);return context.modal?(0,jsx_runtime.jsx)(react_presence_dist.C,{present:forceMount||context.open,children:(0,jsx_runtime.jsx)(DialogOverlayImpl,{...overlayProps,ref:forwardedRef})}):null}));DialogOverlay.displayName="DialogOverlay";var dist_Slot=(0,react_slot_dist.TL)("DialogOverlay.RemoveScroll"),DialogOverlayImpl=react.forwardRef(((props,forwardedRef)=>{const{__scopeDialog,...overlayProps}=props,context=useDialogContext("DialogOverlay",__scopeDialog);return(0,jsx_runtime.jsx)(Combination.A,{as:dist_Slot,allowPinchZoom:!0,shards:[context.contentRef],children:(0,jsx_runtime.jsx)(react_primitive_dist.sG.div,{"data-state":getState(context.open),...overlayProps,ref:forwardedRef,style:{pointerEvents:"auto",...overlayProps.style}})})})),DialogContent=react.forwardRef(((props,forwardedRef)=>{const portalContext=dist_usePortalContext("DialogContent",props.__scopeDialog),{forceMount=portalContext.forceMount,...contentProps}=props,context=useDialogContext("DialogContent",props.__scopeDialog);return(0,jsx_runtime.jsx)(react_presence_dist.C,{present:forceMount||context.open,children:context.modal?(0,jsx_runtime.jsx)(DialogContentModal,{...contentProps,ref:forwardedRef}):(0,jsx_runtime.jsx)(DialogContentNonModal,{...contentProps,ref:forwardedRef})})}));DialogContent.displayName="DialogContent";var DialogContentModal=react.forwardRef(((props,forwardedRef)=>{const context=useDialogContext("DialogContent",props.__scopeDialog),contentRef=react.useRef(null),composedRefs=(0,react_compose_refs_dist.s)(forwardedRef,context.contentRef,contentRef);return react.useEffect((()=>{const content=contentRef.current;if(content)return(0,es2015.Eq)(content)}),[]),(0,jsx_runtime.jsx)(DialogContentImpl,{...props,ref:composedRefs,trapFocus:context.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,dist.m)(props.onCloseAutoFocus,(event=>{event.preventDefault(),context.triggerRef.current?.focus()})),onPointerDownOutside:(0,dist.m)(props.onPointerDownOutside,(event=>{const originalEvent=event.detail.originalEvent,ctrlLeftClick=0===originalEvent.button&&!0===originalEvent.ctrlKey;(2===originalEvent.button||ctrlLeftClick)&&event.preventDefault()})),onFocusOutside:(0,dist.m)(props.onFocusOutside,(event=>event.preventDefault()))})})),DialogContentNonModal=react.forwardRef(((props,forwardedRef)=>{const context=useDialogContext("DialogContent",props.__scopeDialog),hasInteractedOutsideRef=react.useRef(!1),hasPointerDownOutsideRef=react.useRef(!1);return(0,jsx_runtime.jsx)(DialogContentImpl,{...props,ref:forwardedRef,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:event=>{props.onCloseAutoFocus?.(event),event.defaultPrevented||(hasInteractedOutsideRef.current||context.triggerRef.current?.focus(),event.preventDefault()),hasInteractedOutsideRef.current=!1,hasPointerDownOutsideRef.current=!1},onInteractOutside:event=>{props.onInteractOutside?.(event),event.defaultPrevented||(hasInteractedOutsideRef.current=!0,"pointerdown"===event.detail.originalEvent.type&&(hasPointerDownOutsideRef.current=!0));const target=event.target,targetIsTrigger=context.triggerRef.current?.contains(target);targetIsTrigger&&event.preventDefault(),"focusin"===event.detail.originalEvent.type&&hasPointerDownOutsideRef.current&&event.preventDefault()}})})),DialogContentImpl=react.forwardRef(((props,forwardedRef)=>{const{__scopeDialog,trapFocus,onOpenAutoFocus,onCloseAutoFocus,...contentProps}=props,context=useDialogContext("DialogContent",__scopeDialog),contentRef=react.useRef(null),composedRefs=(0,react_compose_refs_dist.s)(forwardedRef,contentRef);return(0,react_focus_guards_dist.Oh)(),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(react_focus_scope_dist.n,{asChild:!0,loop:!0,trapped:trapFocus,onMountAutoFocus:onOpenAutoFocus,onUnmountAutoFocus:onCloseAutoFocus,children:(0,jsx_runtime.jsx)(react_dismissable_layer_dist.qW,{role:"dialog",id:context.contentId,"aria-describedby":context.descriptionId,"aria-labelledby":context.titleId,"data-state":getState(context.open),...contentProps,ref:composedRefs,onDismiss:()=>context.onOpenChange(!1)})}),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(TitleWarning,{titleId:context.titleId}),(0,jsx_runtime.jsx)(DescriptionWarning,{contentRef,descriptionId:context.descriptionId})]})]})})),DialogTitle=react.forwardRef(((props,forwardedRef)=>{const{__scopeDialog,...titleProps}=props,context=useDialogContext("DialogTitle",__scopeDialog);return(0,jsx_runtime.jsx)(react_primitive_dist.sG.h2,{id:context.titleId,...titleProps,ref:forwardedRef})}));DialogTitle.displayName="DialogTitle";var DialogDescription=react.forwardRef(((props,forwardedRef)=>{const{__scopeDialog,...descriptionProps}=props,context=useDialogContext("DialogDescription",__scopeDialog);return(0,jsx_runtime.jsx)(react_primitive_dist.sG.p,{id:context.descriptionId,...descriptionProps,ref:forwardedRef})}));DialogDescription.displayName="DialogDescription";var DialogClose=react.forwardRef(((props,forwardedRef)=>{const{__scopeDialog,...closeProps}=props,context=useDialogContext("DialogClose",__scopeDialog);return(0,jsx_runtime.jsx)(react_primitive_dist.sG.button,{type:"button",...closeProps,ref:forwardedRef,onClick:(0,dist.m)(props.onClick,(()=>context.onOpenChange(!1)))})}));function getState(open){return open?"open":"closed"}DialogClose.displayName="DialogClose";var[WarningProvider,useWarningContext]=(0,react_context_dist.q)("DialogTitleWarning",{contentName:"DialogContent",titleName:"DialogTitle",docsSlug:"dialog"}),TitleWarning=({titleId})=>{const titleWarningContext=useWarningContext("DialogTitleWarning"),MESSAGE=`\`${titleWarningContext.contentName}\` requires a \`${titleWarningContext.titleName}\` for the component to be accessible for screen reader users.\n\nIf you want to hide the \`${titleWarningContext.titleName}\`, you can wrap it with our VisuallyHidden component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/${titleWarningContext.docsSlug}`;return react.useEffect((()=>{if(titleId){document.getElementById(titleId)||console.error(MESSAGE)}}),[MESSAGE,titleId]),null},DescriptionWarning=({contentRef,descriptionId})=>{const MESSAGE=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${useWarningContext("DialogDescriptionWarning").contentName}}.`;return react.useEffect((()=>{const describedById=contentRef.current?.getAttribute("aria-describedby");if(descriptionId&&describedById){document.getElementById(descriptionId)||console.warn(MESSAGE)}}),[MESSAGE,contentRef,descriptionId]),null},Root=Dialog,dist_Portal=DialogPortal,Overlay=DialogOverlay,Content=DialogContent,Title=DialogTitle;const TldrawUiIcon_TldrawUiIcon=(0,react.memo)((function TldrawUiIcon2({label,small,invertIcon,icon,color,className,...props}){const assetUrls=useAssetUrls(),asset=assetUrls.icons[icon]??assetUrls.icons["question-mark-circle"],ref=(0,react.useRef)(null);return(0,react.useLayoutEffect)((()=>{asset||console.error(`Icon not found: ${icon}. Add it to the assetUrls.icons object.`),ref?.current&&(ref.current.style.webkitMask=`url(${asset}) center 100% / 100% no-repeat`)}),[ref,asset,icon]),"none"===icon?(0,jsx_runtime.jsx)("div",{className:classnames_default()("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":small},className)}):(0,jsx_runtime.jsx)("div",{...props,ref,"aria-label":label,role:"img",className:classnames_default()("tlui-icon",{"tlui-icon__small":small},className),style:{color,mask:`url(${asset}) center 100% / 100% no-repeat`,transform:invertIcon?"scale(-1, 1)":void 0}})}));function TldrawUiButtonIcon({icon,small,invertIcon}){return(0,jsx_runtime.jsx)(TldrawUiIcon_TldrawUiIcon,{"aria-hidden":"true",label:"",className:"tlui-button__icon",icon,small,invertIcon})}function TldrawUiDialogHeader({className,children}){return(0,jsx_runtime.jsx)("div",{className:classnames_default()("tlui-dialog__header",className),children})}function TldrawUiDialogTitle({className,children,style}){return(0,jsx_runtime.jsx)(Title,{dir:"ltr",className:classnames_default()("tlui-dialog__header__title",className),style,children})}function TldrawUiDialogCloseButton(){const msg=useTranslation_useTranslation();return(0,jsx_runtime.jsx)("div",{className:"tlui-dialog__header__close",children:(0,jsx_runtime.jsx)(DialogClose,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:(0,jsx_runtime.jsx)(TldrawUiButton,{type:"icon","aria-label":msg("ui.close"),onTouchEnd:e=>e.target.click(),children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{small:!0,icon:"cross-2"})})})})}function TldrawUiDialogBody({className,children,style}){return(0,jsx_runtime.jsx)("div",{className:classnames_default()("tlui-dialog__body",className),style,children})}function TldrawUiDialogFooter({className,children}){return(0,jsx_runtime.jsx)("div",{className:classnames_default()("tlui-dialog__footer",className),children})}const TldrawUiInput=react.forwardRef((function TldrawUiInput2({className,label,icon,iconLeft,iconLabel,autoSelect=!1,autoFocus=!1,defaultValue,placeholder,onComplete,onValueChange,onCancel,onFocus,onBlur,shouldManuallyMaintainScrollPositionWhenFocused=!1,children,value,"data-testid":dataTestId},ref){const editor=(0,dist_esm.frr)(),rInputRef=react.useRef(null);react.useImperativeHandle(ref,(()=>rInputRef.current));const msg=useTranslation_useTranslation(),rInitialValue=react.useRef(defaultValue??""),rCurrentValue=react.useRef(defaultValue??""),isComposing=react.useRef(!1),[isFocused,setIsFocused]=react.useState(!1),handleFocus=react.useCallback((e=>{setIsFocused(!0);const elm=e.currentTarget;rCurrentValue.current=elm.value,editor?editor.timers.requestAnimationFrame((()=>{autoSelect&&elm.select()})):dist_esm.slq.requestAnimationFrame("anon",(()=>{autoSelect&&elm.select()})),onFocus?.()}),[autoSelect,editor,onFocus]),handleChange=react.useCallback((e=>{const value2=e.currentTarget.value;rCurrentValue.current=value2,onValueChange?.(value2)}),[onValueChange]),handleKeyDownCapture=react.useCallback((e=>{switch(e.key){case"Enter":if(isComposing.current)return;e.currentTarget.blur(),(0,dist_esm.$6n)(e),onComplete?.(e.currentTarget.value);break;case"Escape":e.currentTarget.value=rInitialValue.current,onCancel?.(e.currentTarget.value),e.currentTarget.blur(),(0,dist_esm.$6n)(e)}}),[onComplete,onCancel]),handleBlur=react.useCallback((e=>{setIsFocused(!1);const value2=e.currentTarget.value;onBlur?.(value2)}),[onBlur]),handleCompositionStart=react.useCallback((()=>isComposing.current=!0),[]),handleCompositionEnd=react.useCallback((()=>isComposing.current=!1),[]);return react.useEffect((()=>{if(!dist_esm.YZA.isIos)return;const visualViewport=window.visualViewport;if(isFocused&&shouldManuallyMaintainScrollPositionWhenFocused&&visualViewport){const onViewportChange=()=>{rInputRef.current?.scrollIntoView({block:"center"})};return visualViewport.addEventListener("resize",onViewportChange),visualViewport.addEventListener("scroll",onViewportChange),editor?editor.timers.requestAnimationFrame((()=>{rInputRef.current?.scrollIntoView({block:"center"})})):dist_esm.slq.requestAnimationFrame("anon",(()=>{rInputRef.current?.scrollIntoView({block:"center"})})),()=>{visualViewport.removeEventListener("resize",onViewportChange),visualViewport.removeEventListener("scroll",onViewportChange)}}}),[isFocused,editor,shouldManuallyMaintainScrollPositionWhenFocused]),(0,jsx_runtime.jsxs)("div",{draggable:!1,className:"tlui-input__wrapper",children:[children,label&&(0,jsx_runtime.jsx)("label",{children:msg(label)}),iconLeft&&(0,jsx_runtime.jsx)(TldrawUiIcon_TldrawUiIcon,{label:iconLabel?msg(iconLabel):"",icon:iconLeft,className:"tlui-icon-left",small:!0}),(0,jsx_runtime.jsx)("input",{ref:rInputRef,className:classnames_default()("tlui-input",className),type:"text",defaultValue,onKeyDownCapture:handleKeyDownCapture,onChange:handleChange,onFocus:handleFocus,onBlur:handleBlur,onCompositionStart:handleCompositionStart,onCompositionEnd:handleCompositionEnd,autoFocus,placeholder,value,"data-testid":dataTestId}),icon&&(0,jsx_runtime.jsx)(TldrawUiIcon_TldrawUiIcon,{label:iconLabel?msg(iconLabel):"",icon,small:!!label})]})}));function validateUrl(url){return dist_esm.T.linkUrl.isValid(url)?{isValid:!0,hasProtocol:!0}:dist_esm.T.linkUrl.isValid("https://"+url)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const EditLinkDialog=(0,dist_esm.u4I)((function EditLinkDialog2({onClose}){const selectedShape=(0,dist_esm.hGv)().getOnlySelectedShape();return selectedShape&&"url"in selectedShape.props&&"string"==typeof selectedShape.props.url?(0,jsx_runtime.jsx)(EditLinkDialogInner,{onClose,selectedShape}):null})),EditLinkDialogInner=(0,dist_esm.u4I)((function EditLinkDialogInner2({onClose,selectedShape}){const editor=(0,dist_esm.hGv)(),msg=useTranslation_useTranslation(),rInput=(0,react.useRef)(null);(0,react.useEffect)((()=>{editor.timers.requestAnimationFrame((()=>rInput.current?.focus()))}),[editor]);const rInitialValue=(0,react.useRef)(selectedShape.props.url),[urlInputState,setUrlInputState]=(0,react.useState)((()=>{const urlValidResult=validateUrl(selectedShape.props.url),initialValue=!0===urlValidResult.isValid?urlValidResult.hasProtocol?selectedShape.props.url:"https://"+selectedShape.props.url:"https://";return{actual:initialValue,safe:initialValue,valid:!0}})),handleChange=(0,react.useCallback)((rawValue=>{const fixedRawValue=rawValue.replace(/https?:\/\/(https?:\/\/)/,((_match,arg1)=>arg1)),urlValidResult=validateUrl(fixedRawValue),safeValue=!0===urlValidResult.isValid?urlValidResult.hasProtocol?fixedRawValue:"https://"+fixedRawValue:"https://";setUrlInputState({actual:fixedRawValue,safe:safeValue,valid:urlValidResult.isValid})}),[]),handleClear=(0,react.useCallback)((()=>{const onlySelectedShape=editor.getOnlySelectedShape();onlySelectedShape&&(editor.updateShapes([{id:onlySelectedShape.id,type:onlySelectedShape.type,props:{url:""}}]),onClose())}),[editor,onClose]),handleComplete=(0,react.useCallback)((()=>{const onlySelectedShape=editor.getOnlySelectedShape();onlySelectedShape&&(onlySelectedShape&&"url"in onlySelectedShape.props&&onlySelectedShape.props.url!==urlInputState.safe&&editor.updateShapes([{id:onlySelectedShape.id,type:onlySelectedShape.type,props:{url:urlInputState.safe}}]),onClose())}),[editor,onClose,urlInputState]),handleCancel=(0,react.useCallback)((()=>{onClose()}),[onClose]);if(!selectedShape)return onClose(),null;const isRemoving=rInitialValue.current&&!urlInputState.valid;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(TldrawUiDialogHeader,{children:[(0,jsx_runtime.jsx)(TldrawUiDialogTitle,{children:msg("edit-link-dialog.title")}),(0,jsx_runtime.jsx)(TldrawUiDialogCloseButton,{})]}),(0,jsx_runtime.jsx)(TldrawUiDialogBody,{children:(0,jsx_runtime.jsxs)("div",{className:"tlui-edit-link-dialog",children:[(0,jsx_runtime.jsx)(TldrawUiInput,{ref:rInput,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,autoSelect:!0,placeholder:"https://example.com",value:urlInputState.actual,onValueChange:handleChange,onComplete:handleComplete,onCancel:handleCancel}),(0,jsx_runtime.jsx)("div",{children:urlInputState.valid?msg("edit-link-dialog.detail"):msg("edit-link-dialog.invalid-url")})]})}),(0,jsx_runtime.jsxs)(TldrawUiDialogFooter,{className:"tlui-dialog__footer__actions",children:[(0,jsx_runtime.jsx)(TldrawUiButton,{type:"normal",onClick:handleCancel,onTouchEnd:handleCancel,children:(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:msg("edit-link-dialog.cancel")})}),isRemoving?(0,jsx_runtime.jsx)(TldrawUiButton,{type:"danger",onTouchEnd:handleClear,onClick:handleClear,children:(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:msg("edit-link-dialog.clear")})}):(0,jsx_runtime.jsx)(TldrawUiButton,{type:"primary",disabled:!urlInputState.valid,onTouchEnd:handleComplete,onClick:handleComplete,children:(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:msg("edit-link-dialog.save")})})]})]})}));var process=__webpack_require__("./node_modules/process/browser.js");const TLDRAW_APP_RE=/(^\/[f|p|r|ro|s|v]\/[^/]+\/?$)/,DEFAULT_EMBED_DEFINITIONS=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj&&urlObj.pathname.match(TLDRAW_APP_RE))return urlObj.searchParams.append("embed","true"),url},fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj&&urlObj.pathname.match(TLDRAW_APP_RE))return urlObj.searchParams.delete("embed"),url}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:url=>{if(url.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto|design)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!url.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${url}`},fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj&&urlObj.pathname.match(/^\/embed\/?$/)){const outUrl=urlObj.searchParams.get("url");if(outUrl)return outUrl}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:url=>{if(url.includes("/maps/embed?"))return url;if(url.includes("/maps/")){const match=url.match(/@(.*?),(.*?),(.*?)(z|m)/);let result;if(match){const[,lat,lng,zoomOrMeters,mapTypeSymbol]=match,mapType="z"===mapTypeSymbol?"roadmap":"satellite",z="roadmap"===mapType?zoomOrMeters:-Math.log2(parseInt(zoomOrMeters)/14772321)/.8;result=`https://${new URL(url).host.replace("www.","")}/maps/embed/v1/view?key=${process.env.NEXT_PUBLIC_GC_API_KEY}&center=${lat},${lng}&zoom=${z}&maptype=${mapType}`}else result="";return result}},fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(!urlObj)return;if(urlObj.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&urlObj.searchParams.has("center")&&urlObj.searchParams.get("zoom")){const zoom=urlObj.searchParams.get("zoom")??"12",mapType=urlObj.searchParams.get("maptype")??"roadmap",zoomOrMeters="roadmap"===mapType?zoom:14772321*Math.pow(2,-.8*parseInt(zoom)),[lat,lon]=urlObj.searchParams.get("center").split(",");return`https://www.google.com/maps/@${lat},${lon},${zoomOrMeters}${"roadmap"===mapType?"z":"m"}`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url),matches=urlObj&&urlObj.pathname.match(/\/v\/(.+)\/?/);if(matches)return`https://www.val.town/embed/${matches[1]}`},fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url),matches=urlObj&&urlObj.pathname.match(/\/embed\/(.+)\/?/);if(matches)return`https://www.val.town/v/${matches[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url),matches=urlObj&&urlObj.pathname.match(/\/s\/([^/]+)\/?/);if(matches)return`https://codesandbox.io/embed/${matches[1]}`},fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url),matches=urlObj&&urlObj.pathname.match(/\/embed\/([^/]+)\/?/);if(matches)return`https://codesandbox.io/s/${matches[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:url=>{const matches=url.match(/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/);if(matches){const[_,user,id]=matches;return`https://codepen.io/${user}/embed/${id}`}},fromEmbedUrl:url=>{const matches=url.match(/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/);if(matches){const[_,user,id]=matches;return`https://codepen.io/${user}/pen/${id}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,toEmbedUrl:url=>{const matches=url.match(/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/);if(matches){const[_,id]=matches;return`https://scratch.mit.edu/projects/embed/${id}`}},fromEmbedUrl:url=>{const matches=url.match(/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/);if(matches){const[_,id]=matches;return`https://scratch.mit.edu/projects/${id}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,toEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(!urlObj)return;const hostname=urlObj.hostname.replace(/^www./,"");if("youtu.be"===hostname){const videoId=urlObj.pathname.split("/").filter(Boolean)[0],searchParams=new URLSearchParams(urlObj.search),timeStart=searchParams.get("t");timeStart&&(searchParams.set("start",timeStart),searchParams.delete("t"));return`https://www.youtube.com/embed/${videoId}${searchParams.toString()?"?"+searchParams.toString():""}`}if(("youtube.com"===hostname||"m.youtube.com"===hostname)&&urlObj.pathname.match(/^\/watch/)){const videoId=urlObj.searchParams.get("v"),searchParams=new URLSearchParams(urlObj.search);searchParams.delete("v");const timeStart=searchParams.get("t");timeStart&&(searchParams.set("start",timeStart),searchParams.delete("t"));return`https://www.youtube.com/embed/${videoId}${searchParams.toString()?"?"+searchParams.toString():""}`}},fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(!urlObj)return;if("youtube.com"===urlObj.hostname.replace(/^www./,"")){const matches=urlObj.pathname.match(/^\/embed\/([^/]+)\/?/);if(matches){const params=new URLSearchParams(urlObj.search);params.set("v",matches?.[1]??"");const timeStart=params.get("start");return timeStart&&(params.set("t",timeStart),params.delete("start")),`https://www.youtube.com/watch?${params.toString()}`}}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url),cidQs=urlObj?.searchParams.get("cid");if(urlObj?.pathname.match(/\/calendar\/u\/0/)&&cidQs){urlObj.pathname="/calendar/embed";const keys=Array.from(urlObj.searchParams.keys());for(const key of keys)urlObj.searchParams.delete(key);return urlObj.searchParams.set("src",cidQs),urlObj.href}},fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url),srcQs=urlObj?.searchParams.get("src");if(urlObj?.pathname.match(/\/calendar\/embed/)&&srcQs){urlObj.pathname="/calendar/u/0";const keys=Array.from(urlObj.searchParams.keys());for(const key of keys)urlObj.searchParams.delete(key);return urlObj.searchParams.set("cid",srcQs),urlObj.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj?.pathname.match(/^\/presentation/)&&urlObj?.pathname.match(/\/pub\/?$/)){urlObj.pathname=urlObj.pathname.replace(/\/pub$/,"/embed");const keys=Array.from(urlObj.searchParams.keys());for(const key of keys)urlObj.searchParams.delete(key);return urlObj.href}},fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj?.pathname.match(/^\/presentation/)&&urlObj?.pathname.match(/\/embed\/?$/)){urlObj.pathname=urlObj.pathname.replace(/\/embed$/,"/pub");const keys=Array.from(urlObj.searchParams.keys());for(const key of keys)urlObj.searchParams.delete(key);return urlObj.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,toEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj&&urlObj.pathname.match(/\/([^/]+)\/([0-9a-f]+)$/)){if(!url.split("/").pop())return;return url}},fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj&&urlObj.pathname.match(/\/([^/]+)\/([0-9a-f]+)$/)){if(!url.split("/").pop())return;return url}}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,toEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj&&urlObj.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${url}?embed=true`},fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj&&urlObj.pathname.match(/\/@([^/]+)\/([^/]+)/)&&urlObj.searchParams.has("embed"))return urlObj.searchParams.delete("embed"),urlObj.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,toEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj&&urlObj.pathname.match(/^\/map\//))return urlObj.origin+"/embed"+urlObj.pathname},fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj&&urlObj.pathname.match(/^\/embed\/map\//))return urlObj.pathname=urlObj.pathname.replace(/^\/embed/,""),urlObj.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,toEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj&&urlObj.pathname.match(/^\/(artist|album)\//))return urlObj.origin+"/embed"+urlObj.pathname},fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj&&urlObj.pathname.match(/^\/embed\/(artist|album)\//))return urlObj.origin+urlObj.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj&&"vimeo.com"===urlObj.hostname&&urlObj.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+urlObj.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj&&"player.vimeo.com"===urlObj.hostname){const matches=urlObj.pathname.match(/^\/video\/([^/]+)\/?$/);if(matches)return"https://vimeo.com/"+matches[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj&&urlObj.hash.match(/#room=/))return url},fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj&&urlObj.hash.match(/#room=/))return url}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj&&urlObj.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${urlObj.origin}/embed${urlObj.pathname}?cell=*`;if(urlObj&&urlObj.pathname.match(/^\/d\/([^/]+)\/?$/)){const pathName=urlObj.pathname.replace(/^\/d/,"");return`${urlObj.origin}/embed${pathName}?cell=*`}},fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);return urlObj&&urlObj.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/)?`${urlObj.origin}${urlObj.pathname.replace("/embed","")}#cell-*`:urlObj&&urlObj.pathname.match(/^\/embed\/([^/]+)\/?$/)?`${urlObj.origin}${urlObj.pathname.replace("/embed","/d")}#cell-*`:void 0}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,toEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj&&"www.desmos.com"===urlObj.hostname&&urlObj.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&""===urlObj.search&&""===urlObj.hash)return`${url}?embed`},fromEmbedUrl:url=>{const urlObj=(0,dist_esm.yCG)(url);if(urlObj&&"www.desmos.com"===urlObj.hostname&&urlObj.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&"?embed"===urlObj.search&&""===urlObj.hash)return url.replace("?embed","")}}],embedShapePermissionDefaults={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},DEFAULT_EMBED_DEFINITION_TYPES=DEFAULT_EMBED_DEFINITIONS.map((def=>def.type));function useGetEmbedShapeUtil(){const editor=(0,dist_esm.frr)();if(editor)return editor.hasShapeUtil("embed")?editor.getShapeUtil("embed"):void 0}function useGetEmbedDefinition(){const embedUtil=useGetEmbedShapeUtil();return url=>embedUtil?embedUtil.getEmbedDefinition(url):void 0}const EmbedDialog=(0,dist_esm.u4I)((function EmbedDialog2({onClose}){const editor=(0,dist_esm.hGv)(),msg=useTranslation_useTranslation(),assetUrls=useAssetUrls(),[embedDefinition,setEmbedDefinition]=(0,react.useState)(null),[url,setUrl]=(0,react.useState)(""),[embedInfoForUrl,setEmbedInfoForUrl]=(0,react.useState)(null),[showError,setShowError]=(0,react.useState)(!1),rShowErrorTimeout=(0,react.useRef)(-1),definitions=function useGetEmbedDefinitions(){const embedUtil=useGetEmbedShapeUtil();return embedUtil?embedUtil.getEmbedDefinitions():[]}(),getEmbedDefinition=useGetEmbedDefinition();return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(TldrawUiDialogHeader,{children:[(0,jsx_runtime.jsx)(TldrawUiDialogTitle,{children:embedDefinition?`${msg("embed-dialog.title")} â ${embedDefinition.title}`:msg("embed-dialog.title")}),(0,jsx_runtime.jsx)(TldrawUiDialogCloseButton,{})]}),embedDefinition?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(TldrawUiDialogBody,{className:"tlui-embed-dialog__enter",children:[(0,jsx_runtime.jsx)(TldrawUiInput,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"https://example.com",autoFocus:!0,onValueChange:value=>{setUrl(value);const embedInfo=getEmbedDefinition(value);setEmbedInfoForUrl(embedInfo&&embedInfo.definition.type===embedDefinition.type?embedInfo:null),setShowError(!1),clearTimeout(rShowErrorTimeout.current),rShowErrorTimeout.current=editor.timers.setTimeout((()=>setShowError(!embedInfo)),320)}}),""===url?(0,jsx_runtime.jsxs)("div",{className:"tlui-embed-dialog__instruction",children:[(0,jsx_runtime.jsx)("span",{children:msg("embed-dialog.instruction")})," ",embedDefinition.instructionLink&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:embedDefinition.instructionLink,className:"tlui-embed-dialog__instruction__link",children:"Learn more"}),"."]})]}):(0,jsx_runtime.jsx)("div",{className:"tlui-embed-dialog__warning",children:showError?msg("embed-dialog.invalid-url"):"Â "})]}),(0,jsx_runtime.jsxs)(TldrawUiDialogFooter,{className:"tlui-dialog__footer__actions",children:[(0,jsx_runtime.jsx)(TldrawUiButton,{type:"normal",onClick:()=>{setEmbedDefinition(null),setEmbedInfoForUrl(null),setUrl("")},children:(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:msg("embed-dialog.back")})}),(0,jsx_runtime.jsx)("div",{className:"tlui-embed__spacer"}),(0,jsx_runtime.jsx)(TldrawUiButton,{type:"normal",onClick:onClose,children:(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:msg("embed-dialog.cancel")})}),(0,jsx_runtime.jsx)(TldrawUiButton,{type:"primary",disabled:!embedInfoForUrl,onClick:()=>{embedInfoForUrl&&(editor.putExternalContent({type:"embed",url,point:editor.getViewportPageBounds().center,embed:embedInfoForUrl.definition}),onClose())},children:(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:msg("embed-dialog.create")})})]})]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(TldrawUiDialogBody,{className:"tlui-embed-dialog__list",children:definitions.map((def=>{const url2=function isDefaultEmbedDefinitionType(type){return DEFAULT_EMBED_DEFINITION_TYPES.includes(type)}(def.type)?assetUrls.embedIcons[def.type]:function isCustomEmbedDefinition(def){return"icon"in def}(def)?def.icon:void 0;return(0,jsx_runtime.jsxs)(TldrawUiButton,{type:"menu",onClick:()=>setEmbedDefinition(def),children:[(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:def.title}),url2&&(0,jsx_runtime.jsx)("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${url2})`}})]},def.type)}))})})]})}));function useShowCollaborationUi(){const editor=(0,dist_esm.frr)();return void 0!==editor?.store.props.collaboration}async function flattenShapesToImages(editor,shapeIds,flattenImageBoundsExpand){const shapes=(0,dist_esm.oE7)(shapeIds.map((id=>{const shape=editor.getShape(id);if(!shape)return;return void 0!==editor.getShapeUtil(shape.type).toSvg?shape:void 0})));if(0===shapes.length)return;if(1===shapes.length){const shape=shapes[0];if(!shape)return;if(editor.isShapeOfType(shape,"image"))return}const groups=[];if(void 0!==flattenImageBoundsExpand){const expandedBounds=shapes.map((shape=>({shape,bounds:editor.getShapeMaskedPageBounds(shape).clone().expandBy(flattenImageBoundsExpand)})));for(let i=0;i<expandedBounds.length;i++){const item=expandedBounds[i];if(0===i){groups[0]={shapes:[item.shape],bounds:item.bounds};continue}let didLand=!1;for(const group of groups)if(group.bounds.includes(item.bounds)){group.shapes.push(item.shape),group.bounds.expand(item.bounds),didLand=!0;break}didLand||groups.push({shapes:[item.shape],bounds:item.bounds})}}else{const bounds=dist_esm.azJ.Common(shapes.map((shape=>editor.getShapeMaskedPageBounds(shape))));groups.push({shapes,bounds})}const padding=editor.options.flattenImageBoundsPadding;for(const group of groups){void 0!==flattenImageBoundsExpand&&group.bounds.expandBy(-flattenImageBoundsExpand);const svgResult=await editor.getSvgString(group.shapes,{padding,background:!1});if(!svgResult?.svg)continue;const asset=await editor.getAssetForExternalContent({type:"file",file:new File([svgResult.svg],"asset.svg",{type:"image/svg+xml"})});asset&&(group.asset=asset)}const createdShapeIds=[];return(0,dist_esm.hLc)((()=>{for(const group of groups){const{asset,bounds,shapes:shapes2}=group;if(!asset)continue;const commonAncestorId=editor.findCommonAncestor(shapes2)??editor.getCurrentPageId();if(!commonAncestorId)continue;let x,y,rotation,index="a1";for(const shape of shapes2)if(shape.parentId===commonAncestorId){shape.index>index&&(index=shape.index);break}if((0,dist_esm.vc4)(commonAncestorId)){const commonAncestor=editor.getShape(commonAncestorId);if(!commonAncestor)continue;const point=editor.getPointInShapeSpace(commonAncestor,{x:bounds.x,y:bounds.y});rotation=editor.getShapePageTransform(commonAncestorId).rotation(),point.sub(new dist_esm.l2P(padding,padding).rot(-rotation)),x=point.x,y=point.y}else x=bounds.x-padding,y=bounds.y-padding,rotation=0;editor.deleteShapes(shapes2),editor.createAssets([{...asset,id:asset.id}]);const shapeId=(0,dist_esm.n6Y)();editor.createShape({id:shapeId,type:"image",index,parentId:commonAncestorId,x,y,rotation:-rotation,props:{assetId:asset.id,w:bounds.w+2*padding,h:bounds.h+2*padding}}),createdShapeIds.push(shapeId)}})),createdShapeIds}const PORTRAIT_BREAKPOINTS=[0,389,436,476,580,640,840,1023];var PORTRAIT_BREAKPOINT=(PORTRAIT_BREAKPOINT2=>(PORTRAIT_BREAKPOINT2[PORTRAIT_BREAKPOINT2.ZERO=0]="ZERO",PORTRAIT_BREAKPOINT2[PORTRAIT_BREAKPOINT2.MOBILE_XXS=1]="MOBILE_XXS",PORTRAIT_BREAKPOINT2[PORTRAIT_BREAKPOINT2.MOBILE_XS=2]="MOBILE_XS",PORTRAIT_BREAKPOINT2[PORTRAIT_BREAKPOINT2.MOBILE_SM=3]="MOBILE_SM",PORTRAIT_BREAKPOINT2[PORTRAIT_BREAKPOINT2.MOBILE=4]="MOBILE",PORTRAIT_BREAKPOINT2[PORTRAIT_BREAKPOINT2.TABLET_SM=5]="TABLET_SM",PORTRAIT_BREAKPOINT2[PORTRAIT_BREAKPOINT2.TABLET=6]="TABLET",PORTRAIT_BREAKPOINT2[PORTRAIT_BREAKPOINT2.DESKTOP=7]="DESKTOP",PORTRAIT_BREAKPOINT2))(PORTRAIT_BREAKPOINT||{});const BreakpointContext=react.createContext(null);function BreakPointProvider({forceMobile=!1,children}){const editor=(0,dist_esm.frr)(),breakpoint=(0,dist_esm.hau)("breakpoint",(()=>{const{width}=editor?.getViewportScreenBounds()??{width:window.innerWidth},maxBreakpoint=forceMobile?PORTRAIT_BREAKPOINT.MOBILE_SM:PORTRAIT_BREAKPOINTS.length-1;for(let i=0;i<maxBreakpoint;i++)if(width>PORTRAIT_BREAKPOINTS[i]&&width<=PORTRAIT_BREAKPOINTS[i+1])return i;return maxBreakpoint}),[editor]);return(0,jsx_runtime.jsx)(BreakpointContext.Provider,{value:breakpoint,children})}function useBreakpoint(){const breakpoint=(0,react.useContext)(BreakpointContext);if(null===breakpoint)throw new Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return breakpoint}const DialogsContext=(0,react.createContext)(null);function TldrawUiDialogsProvider({context,children}){const ctx=(0,react.useContext)(DialogsContext),trackEvent=useUiEvents(),dialogs=(0,dist_esm.fpl)("dialogs",[]),content=(0,react.useMemo)((()=>({dialogs,addDialog(dialog){const id=dialog.id??(0,dist_esm.NF7)();return dialogs.update((d=>[...d.filter((m=>m.id!==dialog.id)),{...dialog,id}])),trackEvent("open-menu",{source:"dialog",id}),dist_esm.NlK.addOpenMenu(id,context),id},removeDialog(id){const dialog=dialogs.get().find((d=>d.id===id));return dialog&&(dialog.onClose?.(),trackEvent("close-menu",{source:"dialog",id}),dist_esm.NlK.deleteOpenMenu(id,context),dialogs.update((d=>d.filter((m=>m!==dialog))))),id},clearDialogs(){const current=dialogs.get();0!==current.length&&(current.forEach((d=>{d.onClose?.(),trackEvent("close-menu",{source:"dialog",id:d.id}),dist_esm.NlK.deleteOpenMenu(d.id,context)})),dialogs.set([]))}})),[trackEvent,dialogs,context]);return ctx?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children}):(0,jsx_runtime.jsx)(DialogsContext.Provider,{value:content,children})}function useDialogs(){const ctx=(0,react.useContext)(DialogsContext);if(!ctx)throw new Error("useDialogs must be used within a DialogsProvider");return ctx}var react_dom=__webpack_require__("./node_modules/react-dom/index.js"),react_use_layout_effect_dist=__webpack_require__("./node_modules/@radix-ui/react-use-layout-effect/dist/index.mjs"),react_visually_hidden_dist=__webpack_require__("./node_modules/@radix-ui/react-visually-hidden/dist/index.mjs"),[dist_Collection,dist_useCollection,dist_createCollectionScope]=(0,react_collection_dist.N)("Toast"),[createToastContext,createToastScope]=(0,react_context_dist.A)("Toast",[dist_createCollectionScope]),[ToastProviderProvider,useToastProviderContext]=createToastContext("ToastProvider"),ToastProvider=props=>{const{__scopeToast,label="Notification",duration=5e3,swipeDirection="right",swipeThreshold=50,children}=props,[viewport,setViewport]=react.useState(null),[toastCount,setToastCount]=react.useState(0),isFocusedToastEscapeKeyDownRef=react.useRef(!1),isClosePausedRef=react.useRef(!1);return label.trim()||console.error("Invalid prop `label` supplied to `ToastProvider`. Expected non-empty `string`."),(0,jsx_runtime.jsx)(dist_Collection.Provider,{scope:__scopeToast,children:(0,jsx_runtime.jsx)(ToastProviderProvider,{scope:__scopeToast,label,duration,swipeDirection,swipeThreshold,toastCount,viewport,onViewportChange:setViewport,onToastAdd:react.useCallback((()=>setToastCount((prevCount=>prevCount+1))),[]),onToastRemove:react.useCallback((()=>setToastCount((prevCount=>prevCount-1))),[]),isFocusedToastEscapeKeyDownRef,isClosePausedRef,children})})};ToastProvider.displayName="ToastProvider";var VIEWPORT_DEFAULT_HOTKEY=["F8"],ToastViewport=react.forwardRef(((props,forwardedRef)=>{const{__scopeToast,hotkey=VIEWPORT_DEFAULT_HOTKEY,label="Notifications ({hotkey})",...viewportProps}=props,context=useToastProviderContext("ToastViewport",__scopeToast),getItems=dist_useCollection(__scopeToast),wrapperRef=react.useRef(null),headFocusProxyRef=react.useRef(null),tailFocusProxyRef=react.useRef(null),ref=react.useRef(null),composedRefs=(0,react_compose_refs_dist.s)(forwardedRef,ref,context.onViewportChange),hotkeyLabel=hotkey.join("+").replace(/Key/g,"").replace(/Digit/g,""),hasToasts=context.toastCount>0;react.useEffect((()=>{const handleKeyDown=event=>{0!==hotkey.length&&hotkey.every((key=>event[key]||event.code===key))&&ref.current?.focus()};return document.addEventListener("keydown",handleKeyDown),()=>document.removeEventListener("keydown",handleKeyDown)}),[hotkey]),react.useEffect((()=>{const wrapper=wrapperRef.current,viewport=ref.current;if(hasToasts&&wrapper&&viewport){const handlePause=()=>{if(!context.isClosePausedRef.current){const pauseEvent=new CustomEvent("toast.viewportPause");viewport.dispatchEvent(pauseEvent),context.isClosePausedRef.current=!0}},handleResume=()=>{if(context.isClosePausedRef.current){const resumeEvent=new CustomEvent("toast.viewportResume");viewport.dispatchEvent(resumeEvent),context.isClosePausedRef.current=!1}},handleFocusOutResume=event=>{!wrapper.contains(event.relatedTarget)&&handleResume()},handlePointerLeaveResume=()=>{wrapper.contains(document.activeElement)||handleResume()};return wrapper.addEventListener("focusin",handlePause),wrapper.addEventListener("focusout",handleFocusOutResume),wrapper.addEventListener("pointermove",handlePause),wrapper.addEventListener("pointerleave",handlePointerLeaveResume),window.addEventListener("blur",handlePause),window.addEventListener("focus",handleResume),()=>{wrapper.removeEventListener("focusin",handlePause),wrapper.removeEventListener("focusout",handleFocusOutResume),wrapper.removeEventListener("pointermove",handlePause),wrapper.removeEventListener("pointerleave",handlePointerLeaveResume),window.removeEventListener("blur",handlePause),window.removeEventListener("focus",handleResume)}}}),[hasToasts,context.isClosePausedRef]);const getSortedTabbableCandidates=react.useCallback((({tabbingDirection})=>{const tabbableCandidates=getItems().map((toastItem=>{const toastNode=toastItem.ref.current,toastTabbableCandidates=[toastNode,...getTabbableCandidates(toastNode)];return"forwards"===tabbingDirection?toastTabbableCandidates:toastTabbableCandidates.reverse()}));return("forwards"===tabbingDirection?tabbableCandidates.reverse():tabbableCandidates).flat()}),[getItems]);return react.useEffect((()=>{const viewport=ref.current;if(viewport){const handleKeyDown=event=>{const isMetaKey=event.altKey||event.ctrlKey||event.metaKey;if("Tab"===event.key&&!isMetaKey){const focusedElement=document.activeElement,isTabbingBackwards=event.shiftKey;if(event.target===viewport&&isTabbingBackwards)return void headFocusProxyRef.current?.focus();const sortedCandidates=getSortedTabbableCandidates({tabbingDirection:isTabbingBackwards?"backwards":"forwards"}),index=sortedCandidates.findIndex((candidate=>candidate===focusedElement));dist_focusFirst(sortedCandidates.slice(index+1))?event.preventDefault():isTabbingBackwards?headFocusProxyRef.current?.focus():tailFocusProxyRef.current?.focus()}};return viewport.addEventListener("keydown",handleKeyDown),()=>viewport.removeEventListener("keydown",handleKeyDown)}}),[getItems,getSortedTabbableCandidates]),(0,jsx_runtime.jsxs)(react_dismissable_layer_dist.lg,{ref:wrapperRef,role:"region","aria-label":label.replace("{hotkey}",hotkeyLabel),tabIndex:-1,style:{pointerEvents:hasToasts?void 0:"none"},children:[hasToasts&&(0,jsx_runtime.jsx)(FocusProxy,{ref:headFocusProxyRef,onFocusFromOutsideViewport:()=>{dist_focusFirst(getSortedTabbableCandidates({tabbingDirection:"forwards"}))}}),(0,jsx_runtime.jsx)(dist_Collection.Slot,{scope:__scopeToast,children:(0,jsx_runtime.jsx)(react_primitive_dist.sG.ol,{tabIndex:-1,...viewportProps,ref:composedRefs})}),hasToasts&&(0,jsx_runtime.jsx)(FocusProxy,{ref:tailFocusProxyRef,onFocusFromOutsideViewport:()=>{dist_focusFirst(getSortedTabbableCandidates({tabbingDirection:"backwards"}))}})]})}));ToastViewport.displayName="ToastViewport";var FocusProxy=react.forwardRef(((props,forwardedRef)=>{const{__scopeToast,onFocusFromOutsideViewport,...proxyProps}=props,context=useToastProviderContext("ToastFocusProxy",__scopeToast);return(0,jsx_runtime.jsx)(react_visually_hidden_dist.s6,{"aria-hidden":!0,tabIndex:0,...proxyProps,ref:forwardedRef,style:{position:"fixed"},onFocus:event=>{const prevFocusedElement=event.relatedTarget;!context.viewport?.contains(prevFocusedElement)&&onFocusFromOutsideViewport()}})}));FocusProxy.displayName="ToastFocusProxy";var Toast=react.forwardRef(((props,forwardedRef)=>{const{forceMount,open:openProp,defaultOpen,onOpenChange,...toastProps}=props,[open,setOpen]=(0,react_use_controllable_state_dist.i)({prop:openProp,defaultProp:defaultOpen??!0,onChange:onOpenChange,caller:"Toast"});return(0,jsx_runtime.jsx)(react_presence_dist.C,{present:forceMount||open,children:(0,jsx_runtime.jsx)(ToastImpl,{open,...toastProps,ref:forwardedRef,onClose:()=>setOpen(!1),onPause:(0,react_use_callback_ref_dist.c)(props.onPause),onResume:(0,react_use_callback_ref_dist.c)(props.onResume),onSwipeStart:(0,dist.m)(props.onSwipeStart,(event=>{event.currentTarget.setAttribute("data-swipe","start")})),onSwipeMove:(0,dist.m)(props.onSwipeMove,(event=>{const{x,y}=event.detail.delta;event.currentTarget.setAttribute("data-swipe","move"),event.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${x}px`),event.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${y}px`)})),onSwipeCancel:(0,dist.m)(props.onSwipeCancel,(event=>{event.currentTarget.setAttribute("data-swipe","cancel"),event.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),event.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),event.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),event.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")})),onSwipeEnd:(0,dist.m)(props.onSwipeEnd,(event=>{const{x,y}=event.detail.delta;event.currentTarget.setAttribute("data-swipe","end"),event.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),event.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),event.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${x}px`),event.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${y}px`),setOpen(!1)}))})})}));Toast.displayName="Toast";var[ToastInteractiveProvider,useToastInteractiveContext]=createToastContext("Toast",{onClose(){}}),ToastImpl=react.forwardRef(((props,forwardedRef)=>{const{__scopeToast,type="foreground",duration:durationProp,open,onClose,onEscapeKeyDown,onPause,onResume,onSwipeStart,onSwipeMove,onSwipeCancel,onSwipeEnd,...toastProps}=props,context=useToastProviderContext("Toast",__scopeToast),[node,setNode]=react.useState(null),composedRefs=(0,react_compose_refs_dist.s)(forwardedRef,(node2=>setNode(node2))),pointerStartRef=react.useRef(null),swipeDeltaRef=react.useRef(null),duration=durationProp||context.duration,closeTimerStartTimeRef=react.useRef(0),closeTimerRemainingTimeRef=react.useRef(duration),closeTimerRef=react.useRef(0),{onToastAdd,onToastRemove}=context,handleClose=(0,react_use_callback_ref_dist.c)((()=>{const isFocusInToast=node?.contains(document.activeElement);isFocusInToast&&context.viewport?.focus(),onClose()})),startTimer=react.useCallback((duration2=>{duration2&&duration2!==1/0&&(window.clearTimeout(closeTimerRef.current),closeTimerStartTimeRef.current=(new Date).getTime(),closeTimerRef.current=window.setTimeout(handleClose,duration2))}),[handleClose]);react.useEffect((()=>{const viewport=context.viewport;if(viewport){const handleResume=()=>{startTimer(closeTimerRemainingTimeRef.current),onResume?.()},handlePause=()=>{const elapsedTime=(new Date).getTime()-closeTimerStartTimeRef.current;closeTimerRemainingTimeRef.current=closeTimerRemainingTimeRef.current-elapsedTime,window.clearTimeout(closeTimerRef.current),onPause?.()};return viewport.addEventListener("toast.viewportPause",handlePause),viewport.addEventListener("toast.viewportResume",handleResume),()=>{viewport.removeEventListener("toast.viewportPause",handlePause),viewport.removeEventListener("toast.viewportResume",handleResume)}}}),[context.viewport,duration,onPause,onResume,startTimer]),react.useEffect((()=>{open&&!context.isClosePausedRef.current&&startTimer(duration)}),[open,duration,context.isClosePausedRef,startTimer]),react.useEffect((()=>(onToastAdd(),()=>onToastRemove())),[onToastAdd,onToastRemove]);const announceTextContent=react.useMemo((()=>node?getAnnounceTextContent(node):null),[node]);return context.viewport?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[announceTextContent&&(0,jsx_runtime.jsx)(ToastAnnounce,{__scopeToast,role:"status","aria-live":"foreground"===type?"assertive":"polite","aria-atomic":!0,children:announceTextContent}),(0,jsx_runtime.jsx)(ToastInteractiveProvider,{scope:__scopeToast,onClose:handleClose,children:react_dom.createPortal((0,jsx_runtime.jsx)(dist_Collection.ItemSlot,{scope:__scopeToast,children:(0,jsx_runtime.jsx)(react_dismissable_layer_dist.bL,{asChild:!0,onEscapeKeyDown:(0,dist.m)(onEscapeKeyDown,(()=>{context.isFocusedToastEscapeKeyDownRef.current||handleClose(),context.isFocusedToastEscapeKeyDownRef.current=!1})),children:(0,jsx_runtime.jsx)(react_primitive_dist.sG.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":open?"open":"closed","data-swipe-direction":context.swipeDirection,...toastProps,ref:composedRefs,style:{userSelect:"none",touchAction:"none",...props.style},onKeyDown:(0,dist.m)(props.onKeyDown,(event=>{"Escape"===event.key&&(onEscapeKeyDown?.(event.nativeEvent),event.nativeEvent.defaultPrevented||(context.isFocusedToastEscapeKeyDownRef.current=!0,handleClose()))})),onPointerDown:(0,dist.m)(props.onPointerDown,(event=>{0===event.button&&(pointerStartRef.current={x:event.clientX,y:event.clientY})})),onPointerMove:(0,dist.m)(props.onPointerMove,(event=>{if(!pointerStartRef.current)return;const x=event.clientX-pointerStartRef.current.x,y=event.clientY-pointerStartRef.current.y,hasSwipeMoveStarted=Boolean(swipeDeltaRef.current),isHorizontalSwipe=["left","right"].includes(context.swipeDirection),clamp=["left","up"].includes(context.swipeDirection)?Math.min:Math.max,clampedX=isHorizontalSwipe?clamp(0,x):0,clampedY=isHorizontalSwipe?0:clamp(0,y),moveStartBuffer="touch"===event.pointerType?10:2,delta={x:clampedX,y:clampedY},eventDetail={originalEvent:event,delta};hasSwipeMoveStarted?(swipeDeltaRef.current=delta,handleAndDispatchCustomEvent("toast.swipeMove",onSwipeMove,eventDetail,{discrete:!1})):isDeltaInDirection(delta,context.swipeDirection,moveStartBuffer)?(swipeDeltaRef.current=delta,handleAndDispatchCustomEvent("toast.swipeStart",onSwipeStart,eventDetail,{discrete:!1}),event.target.setPointerCapture(event.pointerId)):(Math.abs(x)>moveStartBuffer||Math.abs(y)>moveStartBuffer)&&(pointerStartRef.current=null)})),onPointerUp:(0,dist.m)(props.onPointerUp,(event=>{const delta=swipeDeltaRef.current,target=event.target;if(target.hasPointerCapture(event.pointerId)&&target.releasePointerCapture(event.pointerId),swipeDeltaRef.current=null,pointerStartRef.current=null,delta){const toast=event.currentTarget,eventDetail={originalEvent:event,delta};isDeltaInDirection(delta,context.swipeDirection,context.swipeThreshold)?handleAndDispatchCustomEvent("toast.swipeEnd",onSwipeEnd,eventDetail,{discrete:!0}):handleAndDispatchCustomEvent("toast.swipeCancel",onSwipeCancel,eventDetail,{discrete:!0}),toast.addEventListener("click",(event2=>event2.preventDefault()),{once:!0})}}))})})}),context.viewport)})]}):null})),ToastAnnounce=props=>{const{__scopeToast,children,...announceProps}=props,context=useToastProviderContext("Toast",__scopeToast),[renderAnnounceText,setRenderAnnounceText]=react.useState(!1),[isAnnounced,setIsAnnounced]=react.useState(!1);return function useNextFrame(callback=(()=>{})){const fn=(0,react_use_callback_ref_dist.c)(callback);(0,react_use_layout_effect_dist.N)((()=>{let raf1=0,raf2=0;return raf1=window.requestAnimationFrame((()=>raf2=window.requestAnimationFrame(fn))),()=>{window.cancelAnimationFrame(raf1),window.cancelAnimationFrame(raf2)}}),[fn])}((()=>setRenderAnnounceText(!0))),react.useEffect((()=>{const timer=window.setTimeout((()=>setIsAnnounced(!0)),1e3);return()=>window.clearTimeout(timer)}),[]),isAnnounced?null:(0,jsx_runtime.jsx)(react_portal_dist.Z,{asChild:!0,children:(0,jsx_runtime.jsx)(react_visually_hidden_dist.s6,{...announceProps,children:renderAnnounceText&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[context.label," ",children]})})})},ToastTitle=react.forwardRef(((props,forwardedRef)=>{const{__scopeToast,...titleProps}=props;return(0,jsx_runtime.jsx)(react_primitive_dist.sG.div,{...titleProps,ref:forwardedRef})}));ToastTitle.displayName="ToastTitle";var ToastDescription=react.forwardRef(((props,forwardedRef)=>{const{__scopeToast,...descriptionProps}=props;return(0,jsx_runtime.jsx)(react_primitive_dist.sG.div,{...descriptionProps,ref:forwardedRef})}));ToastDescription.displayName="ToastDescription";var ToastAction=react.forwardRef(((props,forwardedRef)=>{const{altText,...actionProps}=props;return altText.trim()?(0,jsx_runtime.jsx)(ToastAnnounceExclude,{altText,asChild:!0,children:(0,jsx_runtime.jsx)(ToastClose,{...actionProps,ref:forwardedRef})}):(console.error("Invalid prop `altText` supplied to `ToastAction`. Expected non-empty `string`."),null)}));ToastAction.displayName="ToastAction";var ToastClose=react.forwardRef(((props,forwardedRef)=>{const{__scopeToast,...closeProps}=props,interactiveContext=useToastInteractiveContext("ToastClose",__scopeToast);return(0,jsx_runtime.jsx)(ToastAnnounceExclude,{asChild:!0,children:(0,jsx_runtime.jsx)(react_primitive_dist.sG.button,{type:"button",...closeProps,ref:forwardedRef,onClick:(0,dist.m)(props.onClick,interactiveContext.onClose)})})}));ToastClose.displayName="ToastClose";var ToastAnnounceExclude=react.forwardRef(((props,forwardedRef)=>{const{__scopeToast,altText,...announceExcludeProps}=props;return(0,jsx_runtime.jsx)(react_primitive_dist.sG.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":altText||void 0,...announceExcludeProps,ref:forwardedRef})}));function getAnnounceTextContent(container){const textContent=[];return Array.from(container.childNodes).forEach((node=>{if(node.nodeType===node.TEXT_NODE&&node.textContent&&textContent.push(node.textContent),function isHTMLElement(node){return node.nodeType===node.ELEMENT_NODE}(node)){const isHidden=node.ariaHidden||node.hidden||"none"===node.style.display,isExcluded=""===node.dataset.radixToastAnnounceExclude;if(!isHidden)if(isExcluded){const altText=node.dataset.radixToastAnnounceAlt;altText&&textContent.push(altText)}else textContent.push(...getAnnounceTextContent(node))}})),textContent}function handleAndDispatchCustomEvent(name,handler,detail,{discrete}){const currentTarget=detail.originalEvent.currentTarget,event=new CustomEvent(name,{bubbles:!0,cancelable:!0,detail});handler&&currentTarget.addEventListener(name,handler,{once:!0}),discrete?(0,react_primitive_dist.hO)(currentTarget,event):currentTarget.dispatchEvent(event)}var isDeltaInDirection=(delta,direction,threshold=0)=>{const deltaX=Math.abs(delta.x),deltaY=Math.abs(delta.y),isDeltaX=deltaX>deltaY;return"left"===direction||"right"===direction?isDeltaX&&deltaX>threshold:!isDeltaX&&deltaY>threshold};function getTabbableCandidates(container){const nodes=[],walker=document.createTreeWalker(container,NodeFilter.SHOW_ELEMENT,{acceptNode:node=>{const isHiddenInput="INPUT"===node.tagName&&"hidden"===node.type;return node.disabled||node.hidden||isHiddenInput?NodeFilter.FILTER_SKIP:node.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;walker.nextNode();)nodes.push(walker.currentNode);return nodes}function dist_focusFirst(candidates){const previouslyFocusedElement=document.activeElement;return candidates.some((candidate=>candidate===previouslyFocusedElement||(candidate.focus(),document.activeElement!==previouslyFocusedElement)))}var Provider=ToastProvider,react_toast_dist_Root2=Toast,dist_Title=ToastTitle,dist_Description=ToastDescription,Action=ToastAction,dist_Close=ToastClose;const ToastsContext=(0,react.createContext)(null);function TldrawUiToastsProvider({children}){const toasts=(0,dist_esm.fpl)("toasts",[]),ctx=(0,react.useContext)(ToastsContext),current=(0,react.useMemo)((()=>({toasts,addToast(toast){const id=toast.id??(0,dist_esm.NF7)();return toasts.update((d=>[...d.filter((m=>m.id!==toast.id)),{...toast,id}])),id},removeToast:id=>(toasts.update((d=>d.filter((m=>m.id!==id)))),id),clearToasts(){toasts.set([])}})),[toasts]);return ctx?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children}):(0,jsx_runtime.jsx)(Provider,{children:(0,jsx_runtime.jsx)(ToastsContext.Provider,{value:current,children})})}function useToasts(){const ctx=(0,react.useContext)(ToastsContext);if(!ctx)throw new Error("useToasts must be used within a ToastsProvider");return ctx}var lz_string=__webpack_require__("./node_modules/lz-string/libs/lz-string.js"),lz_string_default=__webpack_require__.n(lz_string);const TLDRAW_CUSTOM_PNG_MIME_TYPE="web image/vnd.tldraw+png",additionalClipboardWriteTypes={png:"web image/vnd.tldraw+png"},canonicalClipboardReadTypes={[TLDRAW_CUSTOM_PNG_MIME_TYPE]:"image/png"};async function pasteUrl(editor,url,point,sources){return editor.markHistoryStoppingPoint("paste"),await editor.putExternalContent({type:"url",point,url,sources})}const expectedPasteFileMimeTypes=["web image/vnd.tldraw+png","image/png","image/jpeg","image/webp","image/svg+xml"];function stripHtml(html){const doc=document.implementation.createHTMLDocument("");return doc.documentElement.innerHTML=html.trim(),doc.body.textContent||doc.body.innerText||""}const INPUTS=["input","select","textarea"];function areShortcutsDisabled(editor){const{activeElement}=document;return editor.menus.hasAnyOpenMenus()||activeElement&&(activeElement.isContentEditable||INPUTS.indexOf(activeElement.tagName.toLowerCase())>-1)}const handleText=(editor,data,point,sources)=>{const validUrlList=(url=>{const urls=url.split(/[\n\s]/);for(const url2 of urls)try{const u=new URL(url2);if("http:"!==u.protocol&&"https:"!==u.protocol)return}catch{return}return(0,dist_esm.sbv)(urls)})(data);if(validUrlList)for(const url of validUrlList)pasteUrl(editor,url,point);else(url=>{try{const u=new URL(url);return"http:"===u.protocol||"https:"===u.protocol}catch{return!1}})(data)?pasteUrl(editor,data,point):/^<svg/.test(data)?(editor.markHistoryStoppingPoint("paste"),editor.putExternalContent({type:"svg-text",text:data,point,sources})):(editor.markHistoryStoppingPoint("paste"),editor.putExternalContent({type:"text",text:data,point,sources}))},handlePasteFromClipboardApi=async({editor,clipboardItems,point,fallbackFiles})=>{const things=[];for(const item of clipboardItems){for(const type of expectedPasteFileMimeTypes)if(item.types.includes(type)){const blobPromise=item.getType(type).then((blob=>{return dist_esm.SmQ.rewriteMimeType(blob,(mimeType=type,(0,dist_esm.g50)(canonicalClipboardReadTypes,mimeType)??mimeType));var mimeType}));things.push({type:"blob",source:blobPromise});break}item.types.includes("text/html")&&things.push({type:"html",source:(async()=>{const blob=await item.getType("text/html");return await dist_esm.SmQ.blobToText(blob)})()}),item.types.includes("text/uri-list")&&things.push({type:"url",source:(async()=>{const blob=await item.getType("text/uri-list");return await dist_esm.SmQ.blobToText(blob)})()}),item.types.includes("text/plain")&&things.push({type:"text",source:(async()=>{const blob=await item.getType("text/plain");return await dist_esm.SmQ.blobToText(blob)})()})}return fallbackFiles?.length&&1===things.length&&"text"===things[0].type?(things.pop(),things.push(...fallbackFiles.map((f=>({type:"file",source:Promise.resolve(f)}))))):fallbackFiles?.length&&0===things.length&&things.push(...fallbackFiles.map((f=>({type:"file",source:Promise.resolve(f)})))),await handleClipboardThings(editor,things,point)};async function handleClipboardThings(editor,things,point){const files=things.filter((t=>("file"===t.type||"blob"===t.type)&&null!==t.source));if(files.length){if(files.length>editor.options.maxFilesAtOnce)throw Error("Too many files");const fileBlobs=(0,dist_esm.oE7)(await Promise.all(files.map((t=>t.source))));return await async function pasteFiles(editor,blobs,point,sources){const files=blobs.map((blob=>blob instanceof File?blob:new File([blob],"tldrawFile",{type:blob.type})));editor.markHistoryStoppingPoint("paste"),await editor.putExternalContent({type:"files",files,point,ignoreParent:!1,sources})}(editor,fileBlobs,point)}const results=await Promise.all(things.filter((t=>"file"!==t.type)).map((t=>new Promise((r=>{const thing=t;"file"!==thing.type?thing.source.then((text=>{const tldrawHtmlComment=text.match(/<div data-tldraw[^>]*>(.*)<\/div>/)?.[1];if(tldrawHtmlComment)try{const jsonComment=lz_string_default().decompressFromBase64(tldrawHtmlComment);if(null===jsonComment)return void r({type:"error",data:jsonComment,reason:"found tldraw data comment but could not parse base64"});{const json=JSON.parse(jsonComment);return"application/tldraw"!==json.type&&r({type:"error",data:json,reason:`found tldraw data comment but JSON was of a different type: ${json.type}`}),"string"==typeof json.data?void r({type:"error",data:json,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"}):void r({type:"tldraw",data:json.data})}}catch{return void r({type:"error",data:tldrawHtmlComment,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"})}else{if("html"===thing.type)return void r({type:"text",data:text,subtype:"html"});if("url"===thing.type)return void r({type:"text",data:text,subtype:"url"});try{const json=JSON.parse(text);return"excalidraw/clipboard"===json.type?void r({type:"excalidraw",data:json}):void r({type:"text",data:text,subtype:"json"})}catch{return void r({type:"text",data:text,subtype:"text"})}}r({type:"error",data:text,reason:"unhandled case"})})):r({type:"error",data:null,reason:"unexpected file"})})))));for(const result of results)if("tldraw"===result.type)return editor.markHistoryStoppingPoint("paste"),void editor.putExternalContent({type:"tldraw",content:result.data,point});for(const result of results)if("excalidraw"===result.type)return editor.markHistoryStoppingPoint("paste"),void editor.putExternalContent({type:"excalidraw",content:result.data,point});for(const result of results){if("text"===result.type&&"html"===result.subtype){const bodyNode=(new DOMParser).parseFromString(result.data,"text/html").querySelector("body");if(bodyNode&&1===Array.from(bodyNode.children).filter((el=>1===el.nodeType)).length&&bodyNode.firstElementChild&&"A"===bodyNode.firstElementChild.tagName&&bodyNode.firstElementChild.hasAttribute("href")&&""!==bodyNode.firstElementChild.getAttribute("href")){const href=bodyNode.firstElementChild.getAttribute("href");return void handleText(editor,href,point,results)}if(!results.some((r=>"text"===r.type&&"html"!==r.subtype))&&result.data.trim()){if(stripHtml(result.data)??"")return void handleText(editor,stripHtml(result.data),point,results)}if(results.some((r=>"text"===r.type&&"html"!==r.subtype))){const html=stripHtml(result.data)??"";if(html)return editor.markHistoryStoppingPoint("paste"),void editor.putExternalContent({type:"text",text:html,html:result.data,point,sources:results})}}if("text"===result.type&&"text"===result.subtype&&result.data.startsWith("<iframe ")){const bodyNode=(new DOMParser).parseFromString(result.data,"text/html").querySelector("body");if(bodyNode&&1===Array.from(bodyNode.children).filter((el=>1===el.nodeType)).length&&bodyNode.firstElementChild&&"IFRAME"===bodyNode.firstElementChild.tagName&&bodyNode.firstElementChild.hasAttribute("src")&&""!==bodyNode.firstElementChild.getAttribute("src")){const src=bodyNode.firstElementChild.getAttribute("src");return void handleText(editor,src,point,results)}}}for(const result of results)if("text"===result.type&&"url"===result.subtype)return void pasteUrl(editor,result.data,point,results);for(const result of results)if("text"===result.type&&"text"===result.subtype&&result.data.trim())return void handleText(editor,result.data,point,results)}const handleNativeOrMenuCopy=async editor=>{const content=await editor.resolveAssetsInContent(editor.getContentFromCurrentPage(editor.getSelectedShapeIds()));if(!content)return void(navigator&&navigator.clipboard&&navigator.clipboard.writeText(""));const stringifiedClipboard=lz_string_default().compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:content}));if("undefined"!=typeof navigator){const textItems=content.shapes.map((shape=>editor.getShapeUtil(shape).getText(shape))).filter(dist_esm.O9V);if(navigator.clipboard?.write){const htmlBlob=new Blob([`<div data-tldraw>${stringifiedClipboard}</div>`],{type:"text/html"});let textContent=textItems.join(" ");""===textContent&&(textContent=" "),navigator.clipboard.write([new ClipboardItem({"text/html":htmlBlob,"text/plain":new Blob([textContent],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<div data-tldraw>${stringifiedClipboard}</div>`)}};function useNativeClipboardEvents(){const editor=(0,dist_esm.hGv)(),trackEvent=useUiEvents(),appIsFocused=(0,dist_esm.hau)("editor.isFocused",(()=>editor.getInstanceState().isFocused),[editor]);(0,react.useEffect)((()=>{if(!appIsFocused)return;const copy=async e=>{0===editor.getSelectedShapeIds().length||null!==editor.getEditingShapeId()||areShortcutsDisabled(editor)||((0,dist_esm.woC)(e),await handleNativeOrMenuCopy(editor),trackEvent("copy",{source:"kbd"}))};async function cut(e){0===editor.getSelectedShapeIds().length||null!==editor.getEditingShapeId()||areShortcutsDisabled(editor)||((0,dist_esm.woC)(e),await handleNativeOrMenuCopy(editor),editor.deleteShapes(editor.getSelectedShapeIds()),trackEvent("cut",{source:"kbd"}))}let disablingMiddleClickPaste=!1;const pointerUpHandler=e=>{1===e.button&&(disablingMiddleClickPaste=!0,editor.timers.requestAnimationFrame((()=>{disablingMiddleClickPaste=!1})))},paste=e=>{if(disablingMiddleClickPaste)return void(0,dist_esm.$6n)(e);if(null!==editor.getEditingShapeId()||areShortcutsDisabled(editor))return;let point,pasteAtCursor=!1;editor.inputs.shiftKey&&(pasteAtCursor=!0),editor.user.getIsPasteAtCursorMode()&&(pasteAtCursor=!pasteAtCursor),pasteAtCursor&&(point=editor.inputs.currentPagePoint);const pasteFromEvent=()=>{e.clipboardData&&(async(editor,clipboardData,point)=>{if(null!==editor.getEditingShapeId())return;if(!clipboardData)throw Error("No clipboard data");const things=[];for(const item of Object.values(clipboardData.items))switch(item.kind){case"file":things.push({type:"file",source:new Promise((r=>r(item.getAsFile())))});break;case"string":"text/html"===item.type?things.push({type:"html",source:new Promise((r=>item.getAsString(r)))}):"text/plain"===item.type?things.push({type:"text",source:new Promise((r=>item.getAsString(r)))}):things.push({type:item.type,source:new Promise((r=>item.getAsString(r)))})}handleClipboardThings(editor,things,point)})(editor,e.clipboardData,point)};if(navigator.clipboard?.read){const fallbackFiles=Array.from(e.clipboardData?.files||[]);navigator.clipboard.read().then((clipboardItems=>{Array.isArray(clipboardItems)&&clipboardItems[0]instanceof ClipboardItem&&handlePasteFromClipboardApi({editor,clipboardItems,point,fallbackFiles})}),(()=>{pasteFromEvent()}))}else pasteFromEvent();(0,dist_esm.woC)(e),trackEvent("paste",{source:"kbd"})};return document.addEventListener("copy",copy),document.addEventListener("cut",cut),document.addEventListener("paste",paste),document.addEventListener("pointerup",pointerUpHandler),()=>{document.removeEventListener("copy",copy),document.removeEventListener("cut",cut),document.removeEventListener("paste",paste),document.removeEventListener("pointerup",pointerUpHandler)}}),[editor,trackEvent,appIsFocused])}const clipboardMimeTypesByFormat={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",svg:"text/plain"};function copyAs(...args){const[editor,ids,opts]="string"==typeof args[2]?[args[0],args[1],{...args[3],format:args[2]}]:args;if(!navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(navigator.clipboard.write){const{blobPromise,mimeType}=function exportToImagePromiseForClipboard(editor,ids,opts={}){const idsToUse=ids?.length?ids:[...editor.getCurrentPageShapeIds()],format=opts.format??"png";return{blobPromise:editor.toImage(idsToUse,opts).then((result=>dist_esm.SmQ.rewriteMimeType(result.blob,clipboardMimeTypesByFormat[format]))),mimeType:clipboardMimeTypesByFormat[format]}}(editor,ids,opts),types={[mimeType]:blobPromise},additionalMimeType=function getAdditionalClipboardWriteType(format){return(0,dist_esm.g50)(additionalClipboardWriteTypes,format)??null}(opts.format);return additionalMimeType&&function doesClipboardSupportType(mimeType){return"undefined"!=typeof ClipboardItem&&"supports"in ClipboardItem&&ClipboardItem.supports(mimeType)}(additionalMimeType)&&(types[additionalMimeType]=blobPromise.then((blob=>dist_esm.SmQ.rewriteMimeType(blob,additionalMimeType)))),function clipboardWrite(types){const entries=Object.entries(types);for(const[_,promise]of entries)promise.catch((err=>console.error(err)));return navigator.clipboard.write([new ClipboardItem(types)]).catch((err=>(console.error(err),Promise.all(entries.map((async([type,promise])=>[type,await promise]))).then((entries2=>{const resolvedTypes=(0,dist_esm._ed)(entries2);return navigator.clipboard.write([new ClipboardItem(resolvedTypes)])})))))}(types)}switch(opts.format){case"svg":return async function fallbackWriteTextAsync(getText){await(navigator.clipboard?.writeText?.(await getText()))}((async()=>{const result=await editor.getSvgString(ids,opts);if(!result)throw new Error("Failed to copy");return result.svg}));case"png":throw new Error("Copy not supported");default:(0,dist_esm.h6G)(opts.format)}}function useCopyAs(){const editor=(0,dist_esm.frr)(),{addToast}=useToasts(),msg=useTranslation_useTranslation();return(0,react.useCallback)(((ids,format="svg")=>{(0,dist_esm.vAR)(editor,"useCopyAs: editor is required"),copyAs(editor,ids,{format}).catch((()=>{addToast({id:"copy-fail",severity:"warning",title:msg("toast.error.copy-fail.title"),description:msg("toast.error.copy-fail.desc")})}))}),[editor,addToast,msg])}async function exportAs(...args){const[editor,ids,opts]="object"==typeof args[2]?args:[args[0],args[1],{...args[4],format:args[2]??"png",name:args[3]}];let name=opts.name;if(!name&&(name=`shapes at ${getTimestamp()}`,1===ids.length)){const first=editor.getShape(ids[0]);name=editor.isShapeOfType(first,"frame")?first.props.name||"frame":`${(0,dist_esm.ni0)(first.id)} at ${getTimestamp()}`}name+=`.${opts.format}`;const{blob}=await editor.toImage(ids,opts);!function downloadFile(file){const link=document.createElement("a"),url=URL.createObjectURL(file);link.href=url,link.download=file.name,link.click(),URL.revokeObjectURL(url)}(new File([blob],name,{type:blob.type}))}function getTimestamp(){const now=new Date;return`${String(now.getFullYear()).slice(2)}-${String(now.getMonth()+1).padStart(2,"0")}-${String(now.getDate()).padStart(2,"0")} ${String(now.getHours()).padStart(2,"0")}.${String(now.getMinutes()).padStart(2,"0")}.${String(now.getSeconds()).padStart(2,"0")}`}function useExportAs(){const editor=(0,dist_esm.frr)(),{addToast}=useToasts(),msg=useTranslation_useTranslation();return(0,react.useCallback)(((ids,format="png",name)=>{(0,dist_esm.vAR)(editor,"useExportAs: editor is required"),exportAs(editor,ids,{format,name,scale:1}).catch((e=>{console.error(e.message),addToast({id:"export-fail",title:msg("toast.error.export-fail.title"),description:msg("toast.error.export-fail.desc"),severity:"error"})}))}),[editor,addToast,msg])}const MimeTypeContext=react.createContext([]);function useDefaultHelpers(){const{addToast,removeToast,clearToasts}=useToasts(),{addDialog,clearDialogs,removeDialog}=useDialogs(),msg=useTranslation_useTranslation(),insertMedia=function useInsertMedia(){const _editor=(0,dist_esm.frr)(),inputRef=(0,react.useRef)(),mimeTypes=(0,dist_esm.H80)(react.useContext(MimeTypeContext));return(0,react.useEffect)((()=>{const editor=_editor;if(!editor)return;const input=window.document.createElement("input");async function onchange(e){const fileList=e.target.files;fileList&&0!==fileList.length&&(editor.markHistoryStoppingPoint("insert media"),await editor.putExternalContent({type:"files",files:Array.from(fileList),point:editor.getViewportPageBounds().center,ignoreParent:!1}),input.value="")}return input.type="file",input.accept=mimeTypes?.join(",")??dist_esm.MM6,input.multiple=!0,inputRef.current=input,input.addEventListener("change",onchange),()=>{inputRef.current=void 0,input.removeEventListener("change",onchange)}}),[_editor,mimeTypes]),(0,react.useCallback)((()=>{inputRef.current?.click()}),[inputRef])}(),printSelectionOrPages=function usePrint(){const editor=(0,dist_esm.frr)(),prevPrintEl=(0,react.useRef)(null),prevStyleEl=(0,react.useRef)(null);return(0,react.useCallback)((async function printSelectionOrPages(){(0,dist_esm.vAR)(editor,"usePrint: editor is required");const el=document.createElement("div"),style=document.createElement("style"),clearElements=(printEl,styleEl)=>{printEl&&(printEl.innerHTML=""),styleEl&&document.head.contains(styleEl)&&document.head.removeChild(styleEl),printEl&&document.body.contains(printEl)&&document.body.removeChild(printEl)};clearElements(prevPrintEl.current,prevStyleEl.current),prevPrintEl.current=el,prevStyleEl.current=style;const className=`tl-print-surface-${(0,dist_esm.NF7)()}`;el.className=className,style.innerHTML=`\n\t\t\t.${className} {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\n\t\t\t.${className} svg {\n\t\t\t\tmax-width: 100%;\n\t\t\t\theight: 100%;\n\t\t\t\tdisplay: block;\n\t\t\t}\n\n\t\t\t@media print {\t\t\t\t  \n\t\t\t\thtml, body {\n\t\t\t\t\tmin-height: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tmargin: 0;\n\t\t\t\t}\n\n\t\t\t\tbody {\n\t\t\t\t\tposition: relative;\n\t\t\t\t}\n\n\t\t\t\tbody > * {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t.tldraw__editor {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t.${className} {\n\t\t\t\t\tdisplay: block !important;\n\t\t\t\t\tbackground: white;\n\t\t\t\t\tmin-height: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tmax-width: 100%;\n\t\t\t\t}\n\n\t\t\t\t.${className}__item {\n\t\t\t\t\tpadding: 10mm;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tmin-height: 100%;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t\tpage-break-after: always;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t\theight: 100%;\n\t\t\t\t}\n\n\t\t\t\t.${className}__item__main {\n\t\t\t\t\tflex: 1;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tmax-height: 100%;\n\t\t\t\t}\n\n\t\t\t\t.${className}__item__header {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t.${className}__item__footer {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t\ttext-align: right;\n\t\t\t\t}\n\n\t\t\t\t.${className}__item__footer__hide {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t\n\t\t\t}\n\n\t\t`;const beforePrintHandler=()=>{document.head.appendChild(style),document.body.appendChild(el)},afterPrintHandler=()=>{editor.once("tick",(()=>{clearElements(el,style)}))};function addPageToPrint(title,footer,svg){try{el.innerHTML+=`<div class="${className}__item">\n        <div class="${className}__item__header">\n          ${title.replace(/</g,"&lt;").replace(/>/g,"&gt;")}\n        </div>\n        <div class="${className}__item__main">\n          ${svg}\n        </div>\n        <div class="${className}__item__footer ${className}__item__footer__${footer?"":"hide"}">\n          ${footer??""}\n        </div>\n      </div>`}catch(e){console.error(e)}}function triggerPrint(){dist_esm.YZA.isChromeForIos?(beforePrintHandler(),window.print()):dist_esm.YZA.isSafari?(beforePrintHandler(),document.execCommand("print",!1)):window.print()}window.addEventListener("beforeprint",beforePrintHandler),window.addEventListener("afterprint",afterPrintHandler);const selectedShapeIds=editor.getSelectedShapeIds(),currentPageId=editor.getCurrentPageId(),pages=editor.getPages(),svgOpts={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(editor.getSelectedShapeIds().length>0){const svgExport=await editor.getSvgString(selectedShapeIds,svgOpts);if(svgExport){const page=pages.find((p=>p.id===currentPageId));addPageToPrint(`tldraw â ${page?.name}`,null,svgExport.svg),triggerPrint()}}else{const page=editor.getCurrentPage(),svgExport=await editor.getSvgString(editor.getSortedChildIdsForParent(page.id),svgOpts);svgExport&&(addPageToPrint(`tldraw â ${page.name}`,null,svgExport.svg),triggerPrint())}window.removeEventListener("beforeprint",beforePrintHandler),window.removeEventListener("afterprint",afterPrintHandler)}),[editor])}(),{cut,copy,paste}=function useMenuClipboardEvents(){const editor=(0,dist_esm.frr)(),trackEvent=useUiEvents(),copy=(0,react.useCallback)((async function onCopy(source){(0,dist_esm.vAR)(editor,"editor is required for copy"),0!==editor.getSelectedShapeIds().length&&(await handleNativeOrMenuCopy(editor),trackEvent("copy",{source}))}),[editor,trackEvent]),cut=(0,react.useCallback)((async function onCut(source){editor&&0!==editor.getSelectedShapeIds().length&&(await handleNativeOrMenuCopy(editor),editor.deleteShapes(editor.getSelectedShapeIds()),trackEvent("cut",{source}))}),[editor,trackEvent]),paste=(0,react.useCallback)((async function onPaste(data,source,point){editor&&null===editor.getEditingShapeId()&&(Array.isArray(data)&&data[0]instanceof ClipboardItem?(handlePasteFromClipboardApi({editor,clipboardItems:data,point}),trackEvent("paste",{source:"menu"})):navigator.clipboard.read().then((clipboardItems=>{paste(clipboardItems,source,point)})))}),[editor,trackEvent]);return{copy,cut,paste}}(),copyAs=useCopyAs(),exportAs=useExportAs(),getEmbedDefinition=useGetEmbedDefinition(),isMobile=useBreakpoint()<PORTRAIT_BREAKPOINT.TABLET_SM;return(0,react.useMemo)((()=>({addToast,removeToast,clearToasts,addDialog,removeDialog,clearDialogs,msg,isMobile,insertMedia,printSelectionOrPages,cut,copy,paste,copyAs,exportAs,getEmbedDefinition})),[addToast,removeToast,clearToasts,addDialog,removeDialog,clearDialogs,msg,isMobile,insertMedia,printSelectionOrPages,cut,copy,paste,copyAs,exportAs,getEmbedDefinition])}function useShallowArrayEquality(array){return(0,react.useMemo)((()=>array),array)}function useMergedTranslationOverrides(overrides){const overridesArray=useShallowArrayEquality(null==overrides?[]:Array.isArray(overrides)?overrides:[overrides]);return(0,react.useMemo)((()=>{const mergedTranslations={};for(const override of overridesArray)if(override.translations)for(const[key,value]of(0,dist_esm.iAN)(override.translations)){let strings=mergedTranslations[key];strings||(strings=mergedTranslations[key]={}),Object.assign(strings,value)}return mergedTranslations}),[overridesArray])}function useMergedOverrides(overrides){const defaultHelpers=useDefaultHelpers(),overridesArray=useShallowArrayEquality(null==overrides?[]:Array.isArray(overrides)?overrides:[overrides]);return(0,react.useMemo)((()=>function mergeOverrides(overrides,defaultHelpers){const mergedTranslations={};for(const override of overrides)if(override.translations)for(const[key,value]of(0,dist_esm.iAN)(override.translations)){let strings=mergedTranslations[key];strings||(strings=mergedTranslations[key]={}),Object.assign(strings,value)}return{actions:(editor,schema,helpers)=>{for(const override of overrides)override.actions&&(schema=override.actions(editor,schema,helpers));return schema},tools:(editor,schema,helpers)=>{for(const override of overrides)override.tools&&(schema=override.tools(editor,schema,{...defaultHelpers,...helpers}));return schema},translations:mergedTranslations}}(overridesArray,defaultHelpers)),[overridesArray,defaultHelpers])}const ActionsContext=react.createContext(null);function getExportName(editor,defaultName){if(0===editor.getSelectedShapes().length)return editor.getDocumentSettings().name||defaultName}function ActionsProvider({overrides,children}){const _editor=(0,dist_esm.frr)(),showCollaborationUi=useShowCollaborationUi(),helpers=useDefaultHelpers(),trackEvent=useUiEvents(),a11y=useA11y(),msg=useTranslation_useTranslation(),defaultDocumentName=helpers.msg("document.default-name"),actions=react.useMemo((()=>{const editor=_editor;if(!editor)return{};function mustGoBackToSelectToolFirst(){return editor.isIn("select")||(editor.complete(),editor.setCurrentTool("select")),!1}function canApplySelectionAction(){return editor.isIn("select")&&editor.getSelectedShapeIds().length>0}function scaleShapes(scaleFactor){if(!canApplySelectionAction())return;if(mustGoBackToSelectToolFirst())return;editor.markHistoryStoppingPoint("resize shapes");const selectedShapeIds=editor.getSelectedShapeIds();0!==selectedShapeIds.length&&editor.run((()=>{selectedShapeIds.map((id=>editor.getShape(id))).filter(Boolean).forEach((shape=>{editor.resizeShape(shape.id,new dist_esm.l2P(scaleFactor,scaleFactor),{scaleOrigin:editor.getSelectionPageBounds()?.center})}))}))}const actionItems=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("edit-link",{source}),editor.markHistoryStoppingPoint("edit-link"),helpers.addDialog({component:EditLinkDialog})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"cmd+i,ctrl+i",onSelect(source){trackEvent("insert-embed",{source}),helpers.addDialog({component:EmbedDialog})}},{id:"insert-media",label:"action.insert-media",kbd:"cmd+u,ctrl+u",onSelect(source){trackEvent("insert-media",{source}),helpers.insertMedia()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"cmd+z,ctrl+z",onSelect(source){trackEvent("undo",{source}),editor.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"cmd+shift+z,ctrl+shift+z",onSelect(source){trackEvent("redo",{source}),editor.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(source){let ids=editor.getSelectedShapeIds();0===ids.length&&(ids=Array.from(editor.getCurrentPageShapeIds().values())),0!==ids.length&&(trackEvent("export-as",{format:"svg",source}),helpers.exportAs(ids,"svg",getExportName(editor,defaultDocumentName)))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(source){let ids=editor.getSelectedShapeIds();0===ids.length&&(ids=Array.from(editor.getCurrentPageShapeIds().values())),0!==ids.length&&(trackEvent("export-as",{format:"png",source}),helpers.exportAs(ids,"png",getExportName(editor,defaultDocumentName)))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(source){let ids=editor.getSelectedShapeIds();0===ids.length&&(ids=Array.from(editor.getCurrentPageShapeIds().values())),0!==ids.length&&(trackEvent("export-all-as",{format:"svg",source}),helpers.exportAs(Array.from(editor.getCurrentPageShapeIds()),"svg",getExportName(editor,defaultDocumentName)))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(source){const ids=Array.from(editor.getCurrentPageShapeIds().values());0!==ids.length&&(trackEvent("export-all-as",{format:"png",source}),helpers.exportAs(ids,"png",getExportName(editor,defaultDocumentName)))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"cmd+shift+c,ctrl+shift+c",readonlyOk:!0,onSelect(source){let ids=editor.getSelectedShapeIds();0===ids.length&&(ids=Array.from(editor.getCurrentPageShapeIds().values())),0!==ids.length&&(trackEvent("copy-as",{format:"svg",source}),helpers.copyAs(ids,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(source){let ids=editor.getSelectedShapeIds();0===ids.length&&(ids=Array.from(editor.getCurrentPageShapeIds().values())),0!==ids.length&&(trackEvent("copy-as",{format:"png",source}),helpers.copyAs(ids,"png"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("toggle-auto-size",{source}),editor.markHistoryStoppingPoint("toggling auto size"),editor.run((()=>{const shapes=editor.getSelectedShapes().filter((shape=>editor.isShapeOfType(shape,"text")&&!1===shape.props.autoSize));editor.updateShapes(shapes.map((shape=>({id:shape.id,type:shape.type,props:{...shape.props,w:8,autoSize:!0}})))),kickoutOccludedShapes(editor,shapes.map((shape=>shape.id)))}))))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(source){trackEvent("open-embed-link",{source});const ids=editor.getSelectedShapeIds(),warnMsg="No embed shapes selected";if(1!==ids.length)return void console.error(warnMsg);const shape=editor.getShape(ids[0]);shape&&editor.isShapeOfType(shape,"embed")?(0,dist_esm.D1x)(shape.props.url,"_blank"):console.error(warnMsg)}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(source){if("zoom"!==editor.root.getCurrent()?.id&&(trackEvent("zoom-tool",{source}),!editor.inputs.shiftKey&&!editor.inputs.ctrlKey)){const currentTool=editor.root.getCurrent();currentTool&&"idle"===currentTool.getCurrent()?.id&&editor.setCurrentTool("zoom",{onInteractionEnd:currentTool.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||editor.run((()=>{trackEvent("convert-to-bookmark",{source});const shapes=editor.getSelectedShapes(),createList=[],deleteList=[];for(const shape of shapes){if(!shape||!editor.isShapeOfType(shape,"embed")||!shape.props.url)continue;const newPos=new dist_esm.l2P(shape.x,shape.y);newPos.rot(-shape.rotation),newPos.add(new dist_esm.l2P(shape.props.w/2-150,shape.props.h/2-160)),newPos.rot(shape.rotation);const partial={id:(0,dist_esm.n6Y)(),type:"bookmark",rotation:shape.rotation,x:newPos.x,y:newPos.y,opacity:1,props:{url:shape.props.url}};createList.push(partial),deleteList.push(shape.id)}editor.markHistoryStoppingPoint("convert shapes to bookmark"),editor.deleteShapes(deleteList),editor.createShapes(createList)})))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("convert-to-embed",{source}),editor.run((()=>{const ids=editor.getSelectedShapeIds(),shapes=(0,dist_esm.oE7)(ids.map((id=>editor.getShape(id)))),createList=[],deleteList=[];for(const shape of shapes){if(!editor.isShapeOfType(shape,"bookmark"))continue;const{url}=shape.props,embedInfo=helpers.getEmbedDefinition(url);if(!embedInfo)continue;if(!embedInfo.definition)continue;const{width,height}=embedInfo.definition,newPos=new dist_esm.l2P(shape.x,shape.y);newPos.rot(-shape.rotation),newPos.add(new dist_esm.l2P(shape.props.w/2-width/2,shape.props.h/2-height/2)),newPos.rot(shape.rotation);const shapeToCreate={id:(0,dist_esm.n6Y)(),type:"embed",x:newPos.x,y:newPos.y,rotation:shape.rotation,props:{url,w:width,h:height}};createList.push(shapeToCreate),deleteList.push(shape.id)}editor.markHistoryStoppingPoint("convert shapes to embed"),editor.deleteShapes(deleteList),editor.createShapes(createList)}))))}},{id:"duplicate",kbd:"cmd+d,ctrl+d",label:"action.duplicate",icon:"duplicate",onSelect(source){if(!canApplySelectionAction())return;if(mustGoBackToSelectToolFirst())return;trackEvent("duplicate-shapes",{source});const instanceState=editor.getInstanceState();let ids,offset;if(instanceState.duplicateProps)ids=instanceState.duplicateProps.shapeIds,offset=instanceState.duplicateProps.offset;else{ids=editor.getSelectedShapeIds();const commonBounds=dist_esm.azJ.Common((0,dist_esm.oE7)(ids.map((id=>editor.getShapePageBounds(id)))));offset=editor.getCameraOptions().isLocked?{x:editor.options.adjacentShapeMargin,y:editor.options.adjacentShapeMargin}:{x:commonBounds.width+editor.options.adjacentShapeMargin,y:0}}editor.markHistoryStoppingPoint("duplicate shapes"),editor.duplicateShapes(ids,offset),instanceState.duplicateProps&&editor.updateInstanceState({duplicateProps:{...instanceState.duplicateProps,shapeIds:editor.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"cmd+shift+g,ctrl+shift+g",icon:"ungroup",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("ungroup-shapes",{source}),editor.markHistoryStoppingPoint("ungroup"),editor.ungroupShapes(editor.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"cmd+g,ctrl+g",icon:"group",onSelect(source){if(!canApplySelectionAction())return;if(mustGoBackToSelectToolFirst())return;trackEvent("group-shapes",{source});const onlySelectedShape=editor.getOnlySelectedShape();onlySelectedShape&&editor.isShapeOfType(onlySelectedShape,"group")?(editor.markHistoryStoppingPoint("ungroup"),editor.ungroupShapes(editor.getSelectedShapeIds())):(editor.markHistoryStoppingPoint("group"),editor.groupShapes(editor.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"cmd+shift+f,ctrl+shift+f",onSelect(source){if(!canApplySelectionAction())return;trackEvent("remove-frame",{source});const selectedShapes=editor.getSelectedShapes();selectedShapes.length>0&&selectedShapes.every((shape=>editor.isShapeOfType(shape,"frame")))&&(editor.markHistoryStoppingPoint("remove-frame"),function removeFrame(editor,ids){const frames=(0,dist_esm.oE7)(ids.map((id=>editor.getShape(id))).filter((f=>f&&editor.isShapeOfType(f,"frame"))));if(!frames.length)return;const allChildren=[];editor.run((()=>{frames.map((frame=>{const children=editor.getSortedChildIdsForParent(frame.id);children.length&&(editor.reparentShapes(children,frame.parentId,frame.index),allChildren.push(...children))})),editor.setSelectedShapes(allChildren),editor.deleteShapes(ids)}))}(editor,selectedShapes.map((shape=>shape.id))))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(source){if(!canApplySelectionAction())return;trackEvent("fit-frame-to-content",{source});const onlySelectedShape=editor.getOnlySelectedShape();onlySelectedShape&&editor.isShapeOfType(onlySelectedShape,"frame")&&(editor.markHistoryStoppingPoint("fit-frame-to-content"),fitFrameToContent(editor,onlySelectedShape.id))}},{id:"align-left",label:"action.align-left",kbd:"alt+A",icon:"align-left",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("align-shapes",{operation:"left",source}),editor.markHistoryStoppingPoint("align left"),editor.run((()=>{const selectedShapeIds=editor.getSelectedShapeIds();editor.alignShapes(selectedShapeIds,"left"),kickoutOccludedShapes(editor,selectedShapeIds)}))))}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"alt+H",icon:"align-center-horizontal",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("align-shapes",{operation:"center-horizontal",source}),editor.markHistoryStoppingPoint("align center horizontal"),editor.run((()=>{const selectedShapeIds=editor.getSelectedShapeIds();editor.alignShapes(selectedShapeIds,"center-horizontal"),kickoutOccludedShapes(editor,selectedShapeIds)}))))}},{id:"align-right",label:"action.align-right",kbd:"alt+D",icon:"align-right",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("align-shapes",{operation:"right",source}),editor.markHistoryStoppingPoint("align right"),editor.run((()=>{const selectedShapeIds=editor.getSelectedShapeIds();editor.alignShapes(selectedShapeIds,"right"),kickoutOccludedShapes(editor,selectedShapeIds)}))))}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"alt+V",icon:"align-center-vertical",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("align-shapes",{operation:"center-vertical",source}),editor.markHistoryStoppingPoint("align center vertical"),editor.run((()=>{const selectedShapeIds=editor.getSelectedShapeIds();editor.alignShapes(selectedShapeIds,"center-vertical"),kickoutOccludedShapes(editor,selectedShapeIds)}))))}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"alt+W",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("align-shapes",{operation:"top",source}),editor.markHistoryStoppingPoint("align top"),editor.run((()=>{const selectedShapeIds=editor.getSelectedShapeIds();editor.alignShapes(selectedShapeIds,"top"),kickoutOccludedShapes(editor,selectedShapeIds)}))))}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"alt+S",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("align-shapes",{operation:"bottom",source}),editor.markHistoryStoppingPoint("align bottom"),editor.run((()=>{const selectedShapeIds=editor.getSelectedShapeIds();editor.alignShapes(selectedShapeIds,"bottom"),kickoutOccludedShapes(editor,selectedShapeIds)}))))}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"alt+shift+h",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("distribute-shapes",{operation:"horizontal",source}),editor.markHistoryStoppingPoint("distribute horizontal"),editor.run((()=>{const selectedShapeIds=editor.getSelectedShapeIds();editor.distributeShapes(selectedShapeIds,"horizontal"),kickoutOccludedShapes(editor,selectedShapeIds)}))))}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"alt+shift+V",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("distribute-shapes",{operation:"vertical",source}),editor.markHistoryStoppingPoint("distribute vertical"),editor.run((()=>{const selectedShapeIds=editor.getSelectedShapeIds();editor.distributeShapes(selectedShapeIds,"vertical"),kickoutOccludedShapes(editor,selectedShapeIds)}))))}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("stretch-shapes",{operation:"horizontal",source}),editor.markHistoryStoppingPoint("stretch horizontal"),editor.run((()=>{const selectedShapeIds=editor.getSelectedShapeIds();editor.stretchShapes(selectedShapeIds,"horizontal"),kickoutOccludedShapes(editor,selectedShapeIds)}))))}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("stretch-shapes",{operation:"vertical",source}),editor.markHistoryStoppingPoint("stretch vertical"),editor.run((()=>{const selectedShapeIds=editor.getSelectedShapeIds();editor.stretchShapes(selectedShapeIds,"vertical"),kickoutOccludedShapes(editor,selectedShapeIds)}))))}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"shift+h",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("flip-shapes",{operation:"horizontal",source}),editor.markHistoryStoppingPoint("flip horizontal"),editor.run((()=>{const selectedShapeIds=editor.getSelectedShapeIds();editor.flipShapes(selectedShapeIds,"horizontal"),kickoutOccludedShapes(editor,selectedShapeIds)}))))}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"shift+v",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("flip-shapes",{operation:"vertical",source}),editor.markHistoryStoppingPoint("flip vertical"),editor.run((()=>{const selectedShapeIds=editor.getSelectedShapeIds();editor.flipShapes(selectedShapeIds,"vertical"),kickoutOccludedShapes(editor,selectedShapeIds)}))))}},{id:"pack",label:"action.pack",icon:"pack",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("pack-shapes",{source}),editor.markHistoryStoppingPoint("pack"),editor.run((()=>{const selectedShapeIds=editor.getSelectedShapeIds();editor.packShapes(selectedShapeIds,editor.options.adjacentShapeMargin),kickoutOccludedShapes(editor,selectedShapeIds)}))))}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("stack-shapes",{operation:"vertical",source}),editor.markHistoryStoppingPoint("stack-vertical"),editor.run((()=>{const selectedShapeIds=editor.getSelectedShapeIds();editor.stackShapes(selectedShapeIds,"vertical",editor.options.adjacentShapeMargin),kickoutOccludedShapes(editor,selectedShapeIds)}))))}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("stack-shapes",{operation:"horizontal",source}),editor.markHistoryStoppingPoint("stack-horizontal"),editor.run((()=>{const selectedShapeIds=editor.getSelectedShapeIds();editor.stackShapes(selectedShapeIds,"horizontal",editor.options.adjacentShapeMargin),kickoutOccludedShapes(editor,selectedShapeIds)}))))}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("reorder-shapes",{operation:"toFront",source}),editor.markHistoryStoppingPoint("bring to front"),editor.bringToFront(editor.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"alt+]",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("reorder-shapes",{operation:"forward",source}),editor.markHistoryStoppingPoint("bring forward"),editor.bringForward(editor.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"alt+[",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("reorder-shapes",{operation:"backward",source}),editor.markHistoryStoppingPoint("send backward"),editor.sendBackward(editor.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("reorder-shapes",{operation:"toBack",source}),editor.markHistoryStoppingPoint("send to back"),editor.sendToBack(editor.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"cmd+x,ctrl+x",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(editor.markHistoryStoppingPoint("cut"),helpers.cut(source)))}},{id:"copy",label:"action.copy",kbd:"cmd+c,ctrl+c",readonlyOk:!0,onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||helpers.copy(source))}},{id:"paste",label:"action.paste",kbd:"cmd+v,ctrl+v",onSelect(source){navigator.clipboard?.read().then((clipboardItems=>{helpers.paste(clipboardItems,source,"context-menu"===source?editor.inputs.currentPagePoint:void 0)})).catch((()=>{helpers.addToast({title:helpers.msg("action.paste-error-title"),description:helpers.msg("action.paste-error-description"),severity:"error"})}))}},{id:"select-all",label:"action.select-all",kbd:"cmd+a,ctrl+a",readonlyOk:!0,onSelect(source){editor.run((()=>{mustGoBackToSelectToolFirst()||(trackEvent("select-all-shapes",{source}),editor.markHistoryStoppingPoint("select all kbd"),editor.selectAll())}))}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("select-none-shapes",{source}),editor.markHistoryStoppingPoint("select none"),editor.selectNone()))}},{id:"delete",label:"action.delete",kbd:"â«,del",icon:"trash",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("delete-shapes",{source}),editor.markHistoryStoppingPoint("delete"),editor.deleteShapes(editor.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("rotate-cw",{source}),editor.markHistoryStoppingPoint("rotate-cw"),editor.run((()=>{const offset=editor.getSelectionRotation()%(dist_esm.sKG/2),dontUseOffset=(0,dist_esm.YY0)(offset,0)||(0,dist_esm.YY0)(offset,dist_esm.sKG/2),selectedShapeIds=editor.getSelectedShapeIds();editor.rotateShapesBy(selectedShapeIds,dist_esm.sKG/2-(dontUseOffset?0:offset)),kickoutOccludedShapes(editor,selectedShapeIds)}))))}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("rotate-ccw",{source}),editor.markHistoryStoppingPoint("rotate-ccw"),editor.run((()=>{const offset=editor.getSelectionRotation()%(dist_esm.sKG/2),offsetCloseToZero=(0,dist_esm.YY0)(offset,0),selectedShapeIds=editor.getSelectedShapeIds();editor.rotateShapesBy(selectedShapeIds,offsetCloseToZero?-dist_esm.sKG/2:-offset),kickoutOccludedShapes(editor,selectedShapeIds)}))))}},{id:"zoom-in",label:"action.zoom-in",kbd:"cmd+=,ctrl+=,=",readonlyOk:!0,onSelect(source){trackEvent("zoom-in",{source,towardsCursor:!1}),editor.zoomIn(void 0,{animation:{duration:editor.options.animationMediumMs}})}},{id:"zoom-in-on-cursor",label:"action.zoom-in",kbd:"shift+cmd+=,shift+ctrl+=,shift+=",readonlyOk:!0,onSelect(source){trackEvent("zoom-in",{source,towardsCursor:!0}),editor.zoomIn(editor.inputs.currentScreenPoint,{animation:{duration:editor.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"cmd+-,ctrl+-,-",readonlyOk:!0,onSelect(source){trackEvent("zoom-out",{source,towardsCursor:!1}),editor.zoomOut(void 0,{animation:{duration:editor.options.animationMediumMs}})}},{id:"zoom-out-on-cursor",label:"action.zoom-out",kbd:"shift+cmd+-,shift+ctrl+-,shift+-",readonlyOk:!0,onSelect(source){trackEvent("zoom-out",{source,towardsCursor:!0}),editor.zoomOut(editor.inputs.currentScreenPoint,{animation:{duration:editor.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"shift+0",readonlyOk:!0,onSelect(source){trackEvent("reset-zoom",{source}),editor.resetZoom(void 0,{animation:{duration:editor.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"shift+1",readonlyOk:!0,onSelect(source){trackEvent("zoom-to-fit",{source}),editor.zoomToFit({animation:{duration:editor.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"shift+2",readonlyOk:!0,onSelect(source){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(trackEvent("zoom-to-selection",{source}),editor.zoomToSelection({animation:{duration:editor.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(source){trackEvent("toggle-snap-mode",{source}),editor.user.updateUserPreferences({isSnapMode:!editor.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"cmd+/,ctrl+/",readonlyOk:!0,onSelect(source){const value=editor.user.getIsDarkMode()?"light":"dark";trackEvent("color-scheme",{source,value}),editor.user.updateUserPreferences({colorScheme:value})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(source){trackEvent("toggle-wrap-mode",{source}),editor.user.updateUserPreferences({isWrapMode:!editor.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(source){trackEvent("toggle-dynamic-size-mode",{source}),editor.user.updateUserPreferences({isDynamicSizeMode:!editor.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(source){trackEvent("toggle-paste-at-cursor",{source}),editor.user.updateUserPreferences({isPasteAtCursorMode:!editor.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(source){trackEvent("toggle-reduce-motion",{source}),editor.user.updateUserPreferences({animationSpeed:0===editor.user.getAnimationSpeed()?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(source){trackEvent("toggle-edge-scrolling",{source}),editor.user.updateUserPreferences({edgeScrollSpeed:0===editor.user.getEdgeScrollSpeed()?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(source){trackEvent("toggle-transparent",{source}),editor.updateInstanceState({exportBackground:!editor.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(source){trackEvent("toggle-tool-lock",{source}),editor.updateInstanceState({isToolLocked:!editor.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(source){trackEvent("unlock-all",{source});const updates=[];for(const shape of editor.getCurrentPageShapes())shape.isLocked&&updates.push({id:shape.id,type:shape.type,isLocked:!1});updates.length>0&&editor.updateShapes(updates)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"cmd+.,ctrl+.",checkbox:!0,onSelect(source){editor.timers.requestAnimationFrame((()=>{editor.run((()=>{trackEvent("toggle-focus-mode",{source}),helpers.clearDialogs(),helpers.clearToasts(),editor.updateInstanceState({isFocusMode:!editor.getInstanceState().isFocusMode})}))}))}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"cmd+',ctrl+'",onSelect(source){trackEvent("toggle-grid-mode",{source}),editor.updateInstanceState({isGridMode:!editor.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(source){trackEvent("toggle-debug-mode",{source}),editor.updateInstanceState({isDebugMode:!editor.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"cmd+p,ctrl+p",readonlyOk:!0,onSelect(source){trackEvent("print",{source}),helpers.printSelectionOrPages()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(source){trackEvent("exit-pen-mode",{source}),editor.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(source){trackEvent("stop-following",{source}),editor.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(source){trackEvent("zoom-to-content",{source});const bounds=editor.getSelectionPageBounds()??editor.getCurrentPageBounds();bounds&&editor.zoomToBounds(bounds,{targetZoom:Math.min(1,editor.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"shift+l",onSelect(source){editor.markHistoryStoppingPoint("locking"),trackEvent("toggle-lock",{source}),editor.toggleLock(editor.getSelectedShapeIds())}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(source){const newPageId=dist_esm.tvM.createId(),ids=editor.getSelectedShapeIds();editor.run((()=>{editor.markHistoryStoppingPoint("move_shapes_to_page"),editor.createPage({name:helpers.msg("page-menu.new-page-initial-name"),id:newPageId}),editor.moveShapesToPage(ids,newPageId)})),trackEvent("move-to-new-page",{source})}},{id:"select-white-color",label:"color-style.white",kbd:"alt+t",onSelect(source){const style=dist_esm.ive;editor.run((()=>{editor.markHistoryStoppingPoint("change-color"),editor.isIn("select")&&editor.setStyleForSelectedShapes(style,"white"),editor.setStyleForNextShapes(style,"white")})),trackEvent("set-style",{source,id:style.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"alt+f",onSelect(source){const style=dist_esm.u8f;editor.run((()=>{editor.markHistoryStoppingPoint("change-fill"),editor.isIn("select")&&editor.setStyleForSelectedShapes(style,"fill"),editor.setStyleForNextShapes(style,"fill")})),trackEvent("set-style",{source,id:style.id,value:"fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"shift+f",onSelect:async source=>{const ids=editor.getSelectedShapeIds();if(0===ids.length)return;editor.markHistoryStoppingPoint("flattening to image"),trackEvent("flatten-to-image",{source});const newShapeIds=await flattenShapesToImages(editor,ids,editor.options.flattenImageBoundsExpand);newShapeIds?.length&&editor.setSelectedShapes(newShapeIds)}},{id:"select-geo-tool",kbd:"g",onSelect:async source=>{trackEvent("select-tool",{source,id:"geo-previous"}),editor.setCurrentTool("geo")}},{id:"change-page-prev",kbd:"alt+left,alt+up",readonlyOk:!0,onSelect:async source=>{const pages=editor.getPages(),currentPageIndex=pages.findIndex((page=>page.id===editor.getCurrentPageId()));currentPageIndex<1||(trackEvent("change-page",{source,direction:"prev"}),editor.setCurrentPage(pages[currentPageIndex-1].id))}},{id:"change-page-next",kbd:"alt+right,alt+down",readonlyOk:!0,onSelect:async source=>{const pages=editor.getPages(),currentPageIndex=pages.findIndex((page=>page.id===editor.getCurrentPageId()));if(-1===currentPageIndex||currentPageIndex>=pages.length-1){if(editor.getCurrentPageShapes().length<=0||editor.getIsReadonly())return;return trackEvent("new-page",{source}),void editor.run((()=>{editor.markHistoryStoppingPoint("creating page");const newPageId=dist_esm.tvM.createId();editor.createPage({name:helpers.msg("page-menu.new-page-initial-name"),id:newPageId}),editor.setCurrentPage(newPageId)}))}editor.setCurrentPage(pages[currentPageIndex+1].id),trackEvent("change-page",{source,direction:"next"})}},{id:"adjust-shape-styles",label:"a11y.adjust-shape-styles",kbd:"cmd+Enter,ctrl+Enter",onSelect:async source=>{if(!canApplySelectionAction())return;const firstButton=editor.getContainer().querySelector(".tlui-style-panel button");firstButton?.focus(),trackEvent("adjust-shape-styles",{source})}},{id:"enlarge-shapes",label:"a11y.enlarge-shape",kbd:"cmd+alt+shift+=,ctrl+alt+shift+=",onSelect:async source=>{scaleShapes(1.1),trackEvent("enlarge-shapes",{source})}},{id:"shrink-shapes",label:"a11y.shrink-shape",kbd:"cmd+alt+shift+-,ctrl+alt+shift+-",onSelect:async source=>{scaleShapes(1/1.1),trackEvent("shrink-shapes",{source})}},{id:"a11y-repeat-shape-announce",kbd:"alt+r",label:"a11y.repeat-shape",readonlyOk:!0,onSelect:async source=>{const selectedShapeIds=editor.getSelectedShapeIds();if(!selectedShapeIds.length)return;const a11yLive=generateShapeAnnouncementMessage({editor,selectedShapeIds,msg});a11yLive&&(a11y.announce({msg:""}),editor.timers.requestAnimationFrame((()=>{a11y.announce({msg:a11yLive})})),trackEvent("a11y-repeat-shape-announce",{source}))}}];showCollaborationUi&&actionItems.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(source){trackEvent("open-cursor-chat",{source}),editor.getInstanceState().isCoarsePointer||editor.timers.requestAnimationFrame((()=>{editor.updateInstanceState({isChatting:!0})}))}});const actions2=function makeActions(actions){return Object.fromEntries(actions.map((action=>[action.id,action])))}(actionItems);return overrides?overrides(editor,actions2,helpers):actions2}),[helpers,_editor,trackEvent,overrides,defaultDocumentName,showCollaborationUi,msg,a11y]);return(0,jsx_runtime.jsx)(ActionsContext.Provider,{value:actions,children})}function useActions(){const ctx=react.useContext(ActionsContext);if(!ctx)throw new Error("useTools must be used within a ToolProvider");return ctx}function unwrapLabel(label,menuType){return label?"string"==typeof label?label:menuType?label[menuType]??label.default:void 0:void 0}function useReadonly(){const editor=(0,dist_esm.frr)();return(0,dist_esm.hau)("isReadonlyMode",(()=>!!editor?.getIsReadonly()),[editor])}const cmdKey=dist_esm.YZA.isDarwin?"â":"Ctrl",altKey=dist_esm.YZA.isDarwin?"â¥":"Alt";function kbd(str){return","===str?[","]:str.split(",")[0].split(/(\[\[[^\]]+\]\])/g).map((s=>s.startsWith("[[")?s.replace(/[[\]]/g,""):s.replace(/cmd\+/g,cmdKey).replace(/ctrl\+/g,cmdKey).replace(/alt\+/g,altKey).replace(/shift\+/g,"â§").replace(/\$/g,cmdKey).replace(/\?/g,altKey).replace(/!/g,"â§").split(""))).flat().map((sub=>sub[0].toUpperCase()+sub.slice(1)))}function kbdStr(str){return"â "+kbd(str).join("â")}function TldrawUiKbd({children,visibleOnMobileLayout=!1}){const breakpoint=useBreakpoint();return!visibleOnMobileLayout&&breakpoint<PORTRAIT_BREAKPOINT.MOBILE?null:(0,jsx_runtime.jsx)("kbd",{className:"tlui-kbd",children:kbd(children).map(((k,i)=>(0,jsx_runtime.jsx)("span",{children:k},i)))})}const menuContext=(0,react.createContext)(null);function useTldrawUiMenuContext(){const context=(0,react.useContext)(menuContext);if(!context)throw new Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return context}function TldrawUiMenuContextProvider({type,sourceId,children}){return(0,jsx_runtime.jsx)(menuContext.Provider,{value:{type,sourceId},children})}function TldrawUiMenuCheckboxItem({id,kbd,label,readonlyOk,onSelect,toggle=!1,disabled=!1,checked=!1}){const{type:menuType,sourceId}=useTldrawUiMenuContext(),isReadonlyMode=useReadonly(),msg=useTranslation_useTranslation();if(isReadonlyMode&&!readonlyOk)return null;const labelToUse=unwrapLabel(label,menuType),labelStr=labelToUse?msg(labelToUse):void 0;switch(menuType){case"menu":return(0,jsx_runtime.jsxs)(CheckboxItem2,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:labelStr,onSelect:e=>{onSelect?.(sourceId),(0,dist_esm.woC)(e)},disabled,checked,children:[(0,jsx_runtime.jsx)(TldrawUiIcon_TldrawUiIcon,{small:!0,label:msg(checked?"ui.checked":"ui.unchecked"),icon:toggle?checked?"toggle-on":"toggle-off":checked?"check":"none"}),labelStr&&(0,jsx_runtime.jsx)("span",{className:"tlui-button__label",draggable:!1,children:labelStr}),kbd&&(0,jsx_runtime.jsx)(TldrawUiKbd,{children:kbd})]});case"context-menu":return(0,jsx_runtime.jsxs)(dist_CheckboxItem2,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:labelStr,onSelect:e=>{onSelect(sourceId),(0,dist_esm.woC)(e)},disabled,checked,children:[(0,jsx_runtime.jsx)(TldrawUiIcon_TldrawUiIcon,{small:!0,label:msg(checked?"ui.checked":"ui.unchecked"),icon:toggle?checked?"toggle-on":"toggle-off":checked?"check":"none"}),labelStr&&(0,jsx_runtime.jsx)("span",{className:"tlui-button__label",draggable:!1,children:labelStr}),kbd&&(0,jsx_runtime.jsx)(TldrawUiKbd,{children:kbd})]},id);default:return null}}function useMenuIsOpen(id,cb){const editor=(0,dist_esm.frr)(),onChange=(0,react.useCallback)((isOpen=>{isOpen&&editor?.complete(),cb?.(isOpen)}),[editor,cb]),trackEvent=useUiEvents(),onEvent=(0,react.useCallback)((eventName=>{trackEvent(eventName,{source:"unknown",id})}),[id,trackEvent]);return(0,dist_esm.ofB)(editor?`${id}-${editor.contextId}`:id,onChange,onEvent)}function TldrawUiDropdownMenuRoot({id,children,modal=!1,debugOpen=!1}){const[open,onOpenChange]=useMenuIsOpen(id);return(0,jsx_runtime.jsx)(Root2,{open:debugOpen||open,dir:"ltr",modal,onOpenChange,children})}function TldrawUiDropdownMenuTrigger({children,...rest}){return(0,jsx_runtime.jsx)(Trigger,{dir:"ltr",asChild:!0,onTouchEnd:e=>(0,dist_esm.woC)(e),...rest,children})}function TldrawUiDropdownMenuContent({className,side="bottom",align="start",sideOffset=8,alignOffset=8,children}){const container=(0,dist_esm.NFA)();return(0,jsx_runtime.jsx)(Portal2,{container,children:(0,jsx_runtime.jsx)(dist_Content2,{className:classnames_default()("tlui-menu",className),side,sideOffset,align,alignOffset,collisionPadding:4,children})})}function TldrawUiDropdownMenuSub({id,children}){const[open,onOpenChange]=useMenuIsOpen(id);return(0,jsx_runtime.jsx)(Sub2,{open,onOpenChange,children})}function TldrawUiDropdownMenuSubTrigger({id,label,title,disabled}){return(0,jsx_runtime.jsx)(SubTrigger2,{dir:"ltr",asChild:!0,disabled,children:(0,jsx_runtime.jsxs)(TldrawUiButton,{"data-testid":id,type:"menu",className:"tlui-menu__submenu__trigger",disabled,title,children:[(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:label}),(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:"chevron-right",small:!0})]})})}function TldrawUiDropdownMenuSubContent({id,alignOffset=-1,sideOffset=-6,size="small",children}){const container=(0,dist_esm.NFA)();return(0,jsx_runtime.jsx)(Portal2,{container,children:(0,jsx_runtime.jsx)(SubContent2,{"data-testid":id,className:"tlui-menu tlui-menu__submenu__content",alignOffset,sideOffset,collisionPadding:4,"data-size":size,children})})}function TldrawUiDropdownMenuGroup({className,children}){return(0,jsx_runtime.jsx)("div",{dir:"ltr",className:classnames_default()("tlui-menu__group",className),children})}function TldrawUiDropdownMenuItem({noClose,children}){return(0,jsx_runtime.jsx)(dist_Item2,{dir:"ltr",asChild:!0,onClick:noClose?dist_esm.woC:void 0,children})}function TldrawUiMenuGroup({id,label,className,children}){const{type:menuType,sourceId}=useTldrawUiMenuContext(),msg=useTranslation_useTranslation(),labelToUse=unwrapLabel(label,menuType),labelStr=labelToUse?msg(labelToUse):void 0;switch(menuType){case"panel":return(0,jsx_runtime.jsx)("div",{className:classnames_default()("tlui-menu__group",className),"data-testid":`${sourceId}-group.${id}`,children});case"menu":return(0,jsx_runtime.jsx)(TldrawUiDropdownMenuGroup,{className,"data-testid":`${sourceId}-group.${id}`,children});case"context-menu":return(0,jsx_runtime.jsx)("div",{dir:"ltr",className:classnames_default()("tlui-menu__group",className),"data-testid":`${sourceId}-group.${id}`,children});case"keyboard-shortcuts":return(0,jsx_runtime.jsxs)("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${sourceId}-group.${id}`,children:[(0,jsx_runtime.jsx)("h2",{className:"tlui-shortcuts-dialog__group__title",children:labelStr}),(0,jsx_runtime.jsx)("div",{className:"tlui-shortcuts-dialog__group__content",children})]});default:return children}}function TldrawUiMenuSubmenu({id,disabled=!1,label,size="small",children}){const{type:menuType,sourceId}=useTldrawUiMenuContext(),container=(0,dist_esm.NFA)(),msg=useTranslation_useTranslation(),labelToUse=label?"string"==typeof label?label:label[menuType]??label.default:void 0,labelStr=labelToUse?msg(labelToUse):void 0;switch(menuType){case"menu":return(0,jsx_runtime.jsxs)(TldrawUiDropdownMenuSub,{id:`${sourceId}-sub.${id}`,children:[(0,jsx_runtime.jsx)(TldrawUiDropdownMenuSubTrigger,{id:`${sourceId}-sub.${id}-button`,disabled,label:labelStr,title:labelStr}),(0,jsx_runtime.jsx)(TldrawUiDropdownMenuSubContent,{id:`${sourceId}-sub.${id}-content`,size,children})]});case"context-menu":return disabled?null:(0,jsx_runtime.jsxs)(ContextMenuSubWithMenu,{id:`${sourceId}-sub.${id}`,children:[(0,jsx_runtime.jsx)(ContextMenuSubTrigger,{dir:"ltr",disabled,asChild:!0,children:(0,jsx_runtime.jsxs)(TldrawUiButton,{"data-testid":`${sourceId}-sub.${id}-button`,type:"menu",className:"tlui-menu__submenu__trigger",children:[(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:labelStr}),(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:"chevron-right",small:!0})]})}),(0,jsx_runtime.jsx)(ContextMenuPortal,{container,children:(0,jsx_runtime.jsx)(ContextMenuSubContent,{"data-testid":`${sourceId}-sub.${id}-content`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":size,children})})]});default:return children}}function ContextMenuSubWithMenu({id,children}){const[open,onOpenChange]=useMenuIsOpen(id);return(0,jsx_runtime.jsx)(ContextMenuSub,{open,onOpenChange,children})}const COLOR_SCHEMES=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function ColorSchemeMenu(){const editor=(0,dist_esm.hGv)(),trackEvent=useUiEvents(),currentColorScheme=(0,dist_esm.hau)("colorScheme",(()=>editor.user.getUserPreferences().colorScheme??(editor.user.getIsDarkMode()?"dark":"light")),[editor]);return(0,jsx_runtime.jsx)(TldrawUiMenuSubmenu,{id:"help menu color-scheme",label:"menu.theme",children:(0,jsx_runtime.jsx)(TldrawUiMenuGroup,{id:"theme",children:COLOR_SCHEMES.map((({colorScheme,label})=>(0,jsx_runtime.jsx)(TldrawUiMenuCheckboxItem,{id:`color-scheme-${colorScheme}`,label,checked:colorScheme===currentColorScheme,readonlyOk:!0,onSelect:()=>{editor.user.updateUserPreferences({colorScheme}),trackEvent("color-scheme",{source:"menu",value:colorScheme})}},colorScheme)))})})}const TldrawUiDialog=({id,component:ModalContent,onClose,preventBackgroundClose})=>{const{removeDialog}=useDialogs(),mouseDownInsideContentRef=(0,react.useRef)(!1),container=(0,dist_esm.NFA)(),handleOpenChange=(0,react.useCallback)((isOpen=>{if(!isOpen){if(onClose)try{onClose()}catch(err){console.warn(err)}removeDialog(id)}}),[id,onClose,removeDialog]);return(0,jsx_runtime.jsx)(Root,{onOpenChange:handleOpenChange,defaultOpen:!0,children:(0,jsx_runtime.jsx)(dist_Portal,{container,children:(0,jsx_runtime.jsx)(Overlay,{dir:"ltr",className:"tlui-dialog__overlay",onClick:e=>{mouseDownInsideContentRef.current||preventBackgroundClose||e.target!==e.currentTarget||handleOpenChange(!1)},children:(0,jsx_runtime.jsx)(Content,{dir:"ltr",className:"tlui-dialog__content","aria-describedby":void 0,onMouseDown:()=>mouseDownInsideContentRef.current=!0,onMouseUp:()=>mouseDownInsideContentRef.current=!1,onInteractOutside:e=>{mouseDownInsideContentRef.current=!1,preventBackgroundClose&&e.preventDefault()},children:(0,jsx_runtime.jsx)(ModalContent,{onClose:()=>{mouseDownInsideContentRef.current=!1,handleOpenChange(!1)}})})})})})},DefaultDialogs=(0,react.memo)((function DefaultDialogs2(){const{dialogs}=useDialogs();return(0,dist_esm.hau)("dialogs",(()=>dialogs.get()),[dialogs]).map((dialog=>(0,jsx_runtime.jsx)(TldrawUiDialog,{...dialog},dialog.id)))})),SEVERITY_TO_ICON={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function TldrawUiToast({toast}){const{removeToast}=useToasts(),msg=useTranslation_useTranslation(),hasActions=toast.actions&&toast.actions.length>0,icon=toast.icon||toast.severity&&SEVERITY_TO_ICON[toast.severity],iconLabel=toast.iconLabel||(toast.severity?msg(`toast.${toast.severity}`):"");return(0,jsx_runtime.jsxs)(react_toast_dist_Root2,{onOpenChange:isOpen=>{isOpen||removeToast(toast.id)},className:"tlui-toast__container",duration:toast.keepOpen?1/0:4e3,"data-severity":toast.severity,children:[icon&&(0,jsx_runtime.jsx)("div",{className:"tlui-toast__icon",children:(0,jsx_runtime.jsx)(TldrawUiIcon_TldrawUiIcon,{label:iconLabel,icon})}),(0,jsx_runtime.jsxs)("div",{className:"tlui-toast__main","data-title":!!toast.title,"data-description":!!toast.description,"data-actions":!!toast.actions,children:[(0,jsx_runtime.jsxs)("div",{className:"tlui-toast__content",children:[toast.title&&(0,jsx_runtime.jsx)(dist_Title,{className:"tlui-toast__title",children:toast.title}),toast.description&&(0,jsx_runtime.jsx)(dist_Description,{className:"tlui-toast__description",children:toast.description})]}),toast.actions&&(0,jsx_runtime.jsxs)("div",{className:"tlui-toast__actions",children:[toast.actions.map(((action,i)=>(0,jsx_runtime.jsx)(Action,{altText:action.label,asChild:!0,onClick:action.onClick,children:(0,jsx_runtime.jsx)(TldrawUiButton,{type:action.type,children:(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:action.label})})},i))),(0,jsx_runtime.jsx)(dist_Close,{asChild:!0,children:(0,jsx_runtime.jsx)(TldrawUiButton,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:toast.closeLabel??msg("toast.close")})})})]})]}),!hasActions&&(0,jsx_runtime.jsx)(dist_Close,{asChild:!0,children:(0,jsx_runtime.jsx)(TldrawUiButton,{type:"normal",className:"tlui-toast__close",children:(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:toast.closeLabel??msg("toast.close")})})})]})}const DefaultToasts=(0,react.memo)((function TldrawUiToasts(){const{toasts}=useToasts(),toastsArray=(0,dist_esm.hau)("toasts",(()=>toasts.get()),[]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[toastsArray.map((toast=>(0,jsx_runtime.jsx)(TldrawUiToast,{toast},toast.id))),(0,jsx_runtime.jsx)(ToastViewport,{className:"tlui-toast__viewport"})]})}));function TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem({actionId="",...rest}){const action=useActions()[actionId];return action?(0,jsx_runtime.jsx)(TldrawUiMenuCheckboxItem,{...action,...rest}):null}function Spinner(props){const msg=useTranslation_useTranslation();return(0,jsx_runtime.jsx)("svg",{width:16,height:16,viewBox:"0 0 16 16",...props,"aria-label":msg("app.loading"),"aria-hidden":"false",children:(0,jsx_runtime.jsxs)("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[(0,jsx_runtime.jsx)("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),(0,jsx_runtime.jsx)("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:(0,jsx_runtime.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}var react_toolbar_dist=__webpack_require__("./node_modules/@radix-ui/react-toolbar/dist/index.mjs");const TldrawUiToolbar=react.forwardRef((({children,className,label,...props},ref)=>(0,jsx_runtime.jsx)(react_toolbar_dist.bL,{ref,...props,className:classnames_default()("tlui-toolbar-container",className),"aria-label":label,children}))),TldrawUiToolbarButton=react.forwardRef((({asChild,children,type,isActive,...props},ref)=>(0,jsx_runtime.jsx)(react_toolbar_dist.$n,{ref,asChild,draggable:!1,"data-isactive":isActive,...props,className:classnames_default()("tlui-button",`tlui-button__${type}`,props.className),children}))),TldrawUiToolbarToggleGroup=({children,className,type,...props})=>(0,jsx_runtime.jsx)(react_toolbar_dist.OY,{type,...props,className:classnames_default()("tlui-toolbar-toggle-group",className),children}),TldrawUiToolbarToggleItem=({children,className,type,value,...props})=>(0,jsx_runtime.jsx)(react_toolbar_dist.sy,{...props,className:classnames_default()("tlui-button",`tlui-button__${type}`,"tlui-toolbar-toggle-group-item",className),value,children});function TldrawUiMenuItem({disabled=!1,spinner=!1,readonlyOk=!1,id,kbd,label,icon,iconLeft,onSelect,noClose,isSelected}){const{type:menuType,sourceId}=useTldrawUiMenuContext(),msg=useTranslation_useTranslation(),[disableClicks,setDisableClicks]=(0,react.useState)(!1);if(useReadonly()&&!readonlyOk)return null;const labelToUse=unwrapLabel(label,menuType),kbdToUse=kbd?kbdStr(kbd):void 0,labelStr=labelToUse?msg(labelToUse):void 0,titleStr=labelStr&&kbdToUse?`${labelStr} ${kbdToUse}`:labelStr;switch(menuType){case"menu":return(0,jsx_runtime.jsx)(TldrawUiDropdownMenuItem,{children:(0,jsx_runtime.jsxs)(TldrawUiButton,{type:"menu","data-testid":`${sourceId}.${id}`,disabled,title:titleStr,onClick:e=>{noClose&&(0,dist_esm.woC)(e),disableClicks?setDisableClicks(!1):onSelect(sourceId)},children:[iconLeft&&(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:iconLeft,small:!0}),(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:labelStr}),kbd&&(0,jsx_runtime.jsx)(TldrawUiKbd,{children:kbd})]})});case"context-menu":return disabled?null:(0,jsx_runtime.jsxs)(react_context_menu_dist_Item2,{dir:"ltr",title:titleStr,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${sourceId}.${id}`,onSelect:e=>{noClose&&(0,dist_esm.woC)(e),disableClicks?setDisableClicks(!1):onSelect(sourceId)},children:[(0,jsx_runtime.jsx)("span",{className:"tlui-button__label",draggable:!1,children:labelStr}),iconLeft&&(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:iconLeft,small:!0}),kbd&&(0,jsx_runtime.jsx)(TldrawUiKbd,{children:kbd}),spinner&&(0,jsx_runtime.jsx)(Spinner,{})]});case"panel":return(0,jsx_runtime.jsxs)(TldrawUiButton,{"data-testid":`${sourceId}.${id}`,type:"menu",title:titleStr,disabled,onClick:()=>onSelect(sourceId),children:[(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:labelStr}),spinner?(0,jsx_runtime.jsx)(Spinner,{}):icon&&(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon})]});case"small-icons":case"icons":return(0,jsx_runtime.jsx)(TldrawUiToolbarButton,{"data-testid":`${sourceId}.${id}`,type:"icon",title:titleStr,disabled,onClick:()=>onSelect(sourceId),children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon,small:!0})});case"keyboard-shortcuts":return kbd?(0,jsx_runtime.jsxs)("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${sourceId}.${id}`,children:[(0,jsx_runtime.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:labelStr}),(0,jsx_runtime.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:(0,jsx_runtime.jsx)(TldrawUiKbd,{visibleOnMobileLayout:!0,children:kbd})})]}):(console.warn(`Menu item '${label}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null);case"helper-buttons":return(0,jsx_runtime.jsxs)(TldrawUiButton,{type:"low",onClick:()=>onSelect(sourceId),children:[(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon}),(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:labelStr})]});case"toolbar":return(0,jsx_runtime.jsx)(TldrawUiToolbarButton,{"aria-label":labelStr,"aria-pressed":isSelected?"true":"false","data-testid":`tools.${id}`,"data-value":id,disabled,onClick:()=>onSelect("toolbar"),onTouchStart:e=>{(0,dist_esm.woC)(e),onSelect("toolbar")},role:"option",title:titleStr,type:"tool",children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon})});case"toolbar-overflow":return(0,jsx_runtime.jsx)(TldrawUiToolbarButton,{"aria-label":labelStr,"aria-pressed":isSelected?"true":"false",isActive:isSelected,className:"tlui-button-grid__button","data-testid":`tools.more.${id}`,"data-value":id,disabled,onClick:()=>onSelect("toolbar"),role:"option",title:titleStr,type:"icon",children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon})});default:throw(0,dist_esm.h6G)(menuType)}}function TldrawUiMenuActionItem_TldrawUiMenuActionItem({actionId="",...rest}){const action=useActions()[actionId];return action?(0,jsx_runtime.jsx)(TldrawUiMenuItem,{...action,...rest}):null}const ToolsContext=react.createContext(null);function ToolsProvider({overrides,children}){const editor=(0,dist_esm.frr)(),trackEvent=useUiEvents(),a11y=useA11y(),msg=useTranslation_useTranslation(),helpers=useDefaultHelpers(),onToolSelect=react.useCallback(((source,tool,id)=>{a11y.announce({msg:msg(tool.label)}),trackEvent("select-tool",{source,id:id??tool.id})}),[a11y,msg,trackEvent]),tools=react.useMemo((()=>{if(!editor)return{};const toolsArray=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(source){if(editor.isIn("select")){const currentNode=editor.root.getCurrent();currentNode.exit({},currentNode.id),currentNode.enter({},currentNode.id)}editor.setCurrentTool("select"),onToolSelect(source,this)}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(source){editor.setCurrentTool("hand"),onToolSelect(source,this)}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(source){editor.setCurrentTool("eraser"),onToolSelect(source,this)}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(source){editor.setCurrentTool("draw"),onToolSelect(source,this)}},...[...dist_esm.tg8.values].map((id=>({id,label:`tool.${id}`,meta:{geo:id},kbd:"rectangle"===id?"r":"ellipse"===id?"o":void 0,icon:"geo-"+id,onSelect(source){editor.run((()=>{editor.setStyleForNextShapes(dist_esm.tg8,id),editor.setCurrentTool("geo"),onToolSelect(source,this,`geo-${id}`)}))}}))),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(source){editor.setCurrentTool("arrow"),onToolSelect(source,this)}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(source){editor.setCurrentTool("line"),onToolSelect(source,this)}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(source){editor.setCurrentTool("frame"),onToolSelect(source,this)}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(source){editor.setCurrentTool("text"),onToolSelect(source,this)}},{id:"asset",label:"tool.media",icon:"tool-media",kbd:"cmd+u,ctrl+u",onSelect(source){helpers.insertMedia(),onToolSelect(source,this,"media")}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(source){editor.setCurrentTool("note"),onToolSelect(source,this)}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(source){editor.setCurrentTool("laser"),onToolSelect(source,this)}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(source){helpers.addDialog({component:EmbedDialog}),onToolSelect(source,this)}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"shift+d",onSelect(source){editor.setCurrentTool("highlight"),onToolSelect(source,this)}}];toolsArray.forEach((t=>t.onSelect=t.onSelect.bind(t)));const tools2=Object.fromEntries(toolsArray.map((t=>[t.id,t])));return overrides?overrides(editor,tools2,helpers):tools2}),[overrides,editor,helpers,onToolSelect]);return(0,jsx_runtime.jsx)(ToolsContext.Provider,{value:tools,children})}function useTools(){const ctx=react.useContext(ToolsContext);if(!ctx)throw new Error("useTools must be used within a ToolProvider");return ctx}function TldrawUiMenuToolItem({toolId="",...rest}){const tool=useTools()[toolId];return tool?(0,jsx_runtime.jsx)(TldrawUiMenuItem,{...tool,...rest}):null}function TldrawHandles({children}){const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("shouldDisplayHandles",(()=>{if(editor.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(editor.isInAny("select.editing_shape")){const onlySelectedShape=editor.getOnlySelectedShape();return onlySelectedShape&&editor.isShapeOfType(onlySelectedShape,"note")}return!1}),[editor])?(0,jsx_runtime.jsx)("svg",{className:"tl-user-handles tl-overlays__item",children}):null}const ElbowArrowSides=["right","bottom","left","top"],ElbowArrowSideDeltas={top:{x:0,y:-1},right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0}},ElbowArrowSideAxes={left:"x",right:"x",top:"y",bottom:"y"},ElbowArrowSideOpposites={top:"bottom",right:"left",bottom:"top",left:"right"},ElbowArrowAxes={x:{v:(x,y)=>new dist_esm.l2P(x,y),loEdge:"left",hiEdge:"right",crossMid:"midY",gap:"gapX",midRange:"midXRange",self:"x",cross:"y",size:"width"},y:{v:(y,x)=>new dist_esm.l2P(x,y),loEdge:"top",hiEdge:"bottom",crossMid:"midX",gap:"gapY",midRange:"midYRange",self:"y",cross:"x",size:"height"}},arrowTargetStore=new dist_esm.laH;function getArrowTargetAtom(editor){return arrowTargetStore.get(editor,(()=>(0,dist_esm.eUv)("arrowTarget",null)))}function clearArrowTargetState(editor){getArrowTargetAtom(editor).set(null)}function updateArrowTargetState({editor,pointInPageSpace,arrow,isPrecise,isExact,currentBinding,oppositeBinding}){if(editor.inputs.ctrlKey)return getArrowTargetAtom(editor).set(null),null;const util=editor.getShapeUtil("arrow"),arrowKind=arrow?arrow.props.kind:editor.getStyleForNextShape(dist_esm.qfG),target=editor.getShapeAtPoint(pointInPageSpace,{hitInside:!0,hitFrameInside:!0,margin:"elbow"===arrowKind?8:0,filter:targetShape=>!targetShape.isLocked&&editor.canBindShapes({fromShape:arrow??targetFilterFallback,toShape:targetShape,binding:"arrow"})});if(!target)return getArrowTargetAtom(editor).set(null),null;const targetGeometryInTargetSpace=editor.getShapeGeometry(target),targetBoundsInTargetSpace=dist_esm.azJ.ZeroFix(targetGeometryInTargetSpace.bounds),targetCenterInTargetSpace=targetGeometryInTargetSpace.center,targetTransform=editor.getShapePageTransform(target),pointInTargetSpace=editor.getPointInShapeSpace(target,pointInPageSpace),castDistance=Math.max(targetGeometryInTargetSpace.bounds.width,targetGeometryInTargetSpace.bounds.height),handlesInPageSpace=(0,dist_esm._Hz)(ElbowArrowSideDeltas,((side,delta)=>{const axis=ElbowArrowAxes[ElbowArrowSideAxes[side]],farPoint=dist_esm.l2P.Mul(delta,castDistance).add(targetCenterInTargetSpace);let isEnabled=!1,handlePointInTargetSpace=axis.v(targetBoundsInTargetSpace[side],targetBoundsInTargetSpace[axis.crossMid]),furthestDistance=0;const intersections=targetGeometryInTargetSpace.intersectLineSegment(targetCenterInTargetSpace,farPoint,dist_esm.MI8.EXCLUDE_NON_STANDARD);for(const intersection of intersections){const distance=dist_esm.l2P.Dist2(intersection,targetCenterInTargetSpace);distance>furthestDistance&&(furthestDistance=distance,handlePointInTargetSpace=intersection,isEnabled=targetGeometryInTargetSpace.isClosed)}return{point:targetTransform.applyToPoint(handlePointInTargetSpace),isEnabled,far:targetTransform.applyToPoint(farPoint)}})),zoomLevel=editor.getZoomLevel(),minDistScaled=util.options.minElbowHandleDistance/zoomLevel,targetCenterInPageSpace=targetTransform.applyToPoint(targetCenterInTargetSpace);for(const side of(0,dist_esm.w$g)(handlesInPageSpace)){const handle=handlesInPageSpace[side];dist_esm.l2P.DistMin(handle.point,targetCenterInPageSpace,minDistScaled)&&(handle.isEnabled=!1)}let precise=isPrecise||isExact;precise||(!currentBinding||currentBinding&&target.id!==currentBinding.toId)&&(precise=editor.inputs.pointerVelocity.len()<.5),isPrecise||(targetGeometryInTargetSpace.isClosed||(precise=!0),oppositeBinding&&target.id===oppositeBinding.toId&&oppositeBinding.props.isPrecise&&(precise=!0));const shouldSnapCenter=!isExact&&precise&&targetGeometryInTargetSpace.isClosed,shouldSnapEdges=!isExact&&(precise&&"elbow"===arrowKind||!targetGeometryInTargetSpace.isClosed),shouldSnapEdgePoints=!isExact&&precise&&"elbow"===arrowKind&&targetGeometryInTargetSpace.isClosed,shouldSnapNone=precise&&(targetGeometryInTargetSpace.isClosed||isExact),shouldSnapCenterAxis=!isExact&&precise&&"elbow"===arrowKind&&targetGeometryInTargetSpace.isClosed;let snap="none",anchorInPageSpace=pointInPageSpace;if(shouldSnapNone||(snap="center",anchorInPageSpace=targetCenterInPageSpace),shouldSnapEdges){const snapDistance=shouldSnapNone?calculateSnapDistance(editor,targetBoundsInTargetSpace,util.options.elbowArrowEdgeSnapDistance):1/0,nearestPointOnEdgeInTargetSpace=targetGeometryInTargetSpace.nearestPoint(pointInTargetSpace,{includeLabels:!1,includeInternal:!1}),nearestPointOnEdgeInPageSpace=targetTransform.applyToPoint(nearestPointOnEdgeInTargetSpace);dist_esm.l2P.Dist(nearestPointOnEdgeInPageSpace,pointInPageSpace)<snapDistance&&(snap="edge",anchorInPageSpace=nearestPointOnEdgeInPageSpace)}if(shouldSnapCenterAxis){const snapDistance=calculateSnapDistance(editor,targetBoundsInTargetSpace,util.options.elbowArrowAxisSnapDistance),distanceFromXAxis=dist_esm.l2P.DistanceToLineSegment(handlesInPageSpace.left.far,handlesInPageSpace.right.far,pointInPageSpace),distanceFromYAxis=dist_esm.l2P.DistanceToLineSegment(handlesInPageSpace.top.far,handlesInPageSpace.bottom.far,pointInPageSpace),snapAxis=distanceFromXAxis<distanceFromYAxis&&distanceFromXAxis<snapDistance?"x":distanceFromYAxis<snapDistance?"y":null;if(snapAxis){const axis=ElbowArrowAxes[snapAxis],side=dist_esm.l2P.Dist2(handlesInPageSpace[axis.loEdge].far,pointInPageSpace)<dist_esm.l2P.Dist2(handlesInPageSpace[axis.hiEdge].far,pointInPageSpace)?axis.loEdge:axis.hiEdge;handlesInPageSpace[side].isEnabled&&(snap="edge-point",anchorInPageSpace=handlesInPageSpace[side].point)}}if(shouldSnapEdgePoints){const snapDistance=calculateSnapDistance(editor,targetBoundsInTargetSpace,util.options.elbowArrowPointSnapDistance);let closestSide=null,closestDistance=1/0;for(const[side,handle]of(0,dist_esm.iAN)(handlesInPageSpace)){if(!handle.isEnabled)continue;const distance=dist_esm.l2P.Dist(handle.point,pointInPageSpace);distance<snapDistance&&distance<closestDistance&&(closestDistance=distance,closestSide=side)}closestSide&&(snap="edge-point",anchorInPageSpace=handlesInPageSpace[closestSide].point)}if(shouldSnapCenter){const snapDistance=calculateSnapDistance(editor,targetBoundsInTargetSpace,"elbow"===arrowKind?util.options.elbowArrowCenterSnapDistance:util.options.arcArrowCenterSnapDistance);dist_esm.l2P.Dist(pointInTargetSpace,targetBoundsInTargetSpace.center)<snapDistance&&(snap="center",anchorInPageSpace=targetCenterInPageSpace)}const snapPointInTargetSpace=editor.getPointInShapeSpace(target,anchorInPageSpace),result={target,arrowKind,handlesInPageSpace,centerInPageSpace:targetCenterInPageSpace,anchorInPageSpace,isExact,isPrecise:precise,snap,normalizedAnchor:{x:(0,dist_esm.Fg_)(targetBoundsInTargetSpace.minX,targetBoundsInTargetSpace.maxX,snapPointInTargetSpace.x),y:(0,dist_esm.Fg_)(targetBoundsInTargetSpace.minY,targetBoundsInTargetSpace.maxY,snapPointInTargetSpace.y)}};return getArrowTargetAtom(editor).set(result),result}const targetFilterFallback={type:"arrow"};function calculateSnapDistance(editor,targetBoundsInTargetSpace,idealSnapDistance){return(0,dist_esm.qE8)(.15*Math.min(targetBoundsInTargetSpace.width,targetBoundsInTargetSpace.height),4,idealSnapDistance)/editor.getZoomLevel()}function TldrawOverlays(){const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("should show arrow hints",(()=>{if(editor.isInAny("arrow.idle","arrow.pointing"))return!0;if(editor.isIn("select.pointing_handle")){const node=editor.getStateDescendant("select.pointing_handle");if("arrow"===node.info.shape.type&&("start"===node.info.handle.id||"end"===node.info.handle.id))return!0}if(editor.isIn("select.dragging_handle")){const node=editor.getStateDescendant("select.dragging_handle");if("arrow"===node.info.shape.type&&("start"===node.info.handle.id||"end"===node.info.handle.id))return!0}return!1}),[editor])?(0,jsx_runtime.jsx)(TldrawArrowHints,{}):null}function TldrawArrowHints(){const editor=(0,dist_esm.hGv)(),{ShapeIndicator}=(0,dist_esm.BSi)(),targetInfo=(0,dist_esm.hau)("arrow target info",(()=>function getArrowTargetState(editor){return getArrowTargetAtom(editor).get()}(editor)),[editor]);if(!targetInfo)return null;const{handlesInPageSpace,snap,anchorInPageSpace,arrowKind,isExact,isPrecise}=targetInfo,showEdgeHints=!isExact&&"elbow"===arrowKind;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[ShapeIndicator&&(0,jsx_runtime.jsx)(ShapeIndicator,{shapeId:targetInfo.target.id}),showEdgeHints&&(0,jsx_runtime.jsxs)("svg",{className:"tl-overlays__item",children:[(0,jsx_runtime.jsx)("circle",{cx:anchorInPageSpace.x,cy:anchorInPageSpace.y,className:`tl-arrow-hint-snap tl-arrow-hint-snap__${isPrecise?snap??"none":"none"}`}),Object.entries(handlesInPageSpace).map((([side,handle])=>handle.isEnabled?(0,jsx_runtime.jsx)("circle",{cx:handle.point.x,cy:handle.point.y,className:"tl-arrow-hint-handle"},side):null))]})]})}const{PI}=Math,FIXED_PI=PI+1e-4;function getStrokeOutlineTracks(strokePoints,options={}){const{size=16,smoothing=.5}=options;if(0===strokePoints.length||size<=0)return{left:[],right:[]};const firstStrokePoint=strokePoints[0],lastStrokePoint=strokePoints[strokePoints.length-1],totalLength=lastStrokePoint.runningLength,minDistance=Math.pow(size*smoothing,2),leftPts=[],rightPts=[];let strokePoint,prevVector=strokePoints[0].vector,pl=strokePoints[0].point,pr=pl,tl=pl,tr=pr,isPrevPointSharpCorner=!1;for(let i=0;i<strokePoints.length;i++){strokePoint=strokePoints[i];const{point,vector}=strokePoints[i],prevDpr=strokePoint.vector.dpr(prevVector),nextVector=(i<strokePoints.length-1?strokePoints[i+1]:strokePoints[i]).vector,nextDpr=i<strokePoints.length-1?nextVector.dpr(strokePoint.vector):1,isNextPointSharpCorner=null!==nextDpr&&nextDpr<.2;if(prevDpr<0&&!isPrevPointSharpCorner||isNextPointSharpCorner){if(nextDpr>-.62&&totalLength-strokePoint.runningLength>strokePoint.radius){const offset2=prevVector.clone().mul(strokePoint.radius);prevVector.clone().cpr(nextVector)<0?(tl=dist_esm.l2P.Add(point,offset2),tr=dist_esm.l2P.Sub(point,offset2)):(tl=dist_esm.l2P.Sub(point,offset2),tr=dist_esm.l2P.Add(point,offset2)),leftPts.push(tl),rightPts.push(tr)}else{const offset2=prevVector.clone().mul(strokePoint.radius).per(),start=dist_esm.l2P.Sub(strokePoint.input,offset2);for(let step=1/13,t=0;t<1;t+=step)tl=dist_esm.l2P.RotWith(start,strokePoint.input,FIXED_PI*t),leftPts.push(tl),tr=dist_esm.l2P.RotWith(start,strokePoint.input,FIXED_PI+FIXED_PI*-t),rightPts.push(tr)}pl=tl,pr=tr,isNextPointSharpCorner&&(isPrevPointSharpCorner=!0);continue}if(isPrevPointSharpCorner=!1,strokePoint===firstStrokePoint||strokePoint===lastStrokePoint){const offset2=dist_esm.l2P.Per(vector).mul(strokePoint.radius);leftPts.push(dist_esm.l2P.Sub(point,offset2)),rightPts.push(dist_esm.l2P.Add(point,offset2));continue}const offset=dist_esm.l2P.Lrp(nextVector,vector,nextDpr).per().mul(strokePoint.radius);tl=dist_esm.l2P.Sub(point,offset),(i<=1||dist_esm.l2P.Dist2(pl,tl)>minDistance)&&(leftPts.push(tl),pl=tl),tr=dist_esm.l2P.Add(point,offset),(i<=1||dist_esm.l2P.Dist2(pr,tr)>minDistance)&&(rightPts.push(tr),pr=tr),prevVector=vector}return{left:leftPts,right:rightPts}}function getStrokeOutlinePoints(strokePoints,options={}){const{size=16,start={},end={},last:isComplete=!1}=options,{cap:capStart=!0}=start,{cap:capEnd=!0}=end;if(0===strokePoints.length||size<=0)return[];const firstStrokePoint=strokePoints[0],lastStrokePoint=strokePoints[strokePoints.length-1],totalLength=lastStrokePoint.runningLength,taperStart=!1===start.taper?0:!0===start.taper?Math.max(size,totalLength):start.taper,taperEnd=!1===end.taper?0:!0===end.taper?Math.max(size,totalLength):end.taper,{left:leftPts,right:rightPts}=getStrokeOutlineTracks(strokePoints,options),firstPoint=firstStrokePoint.point,lastPoint=strokePoints.length>1?strokePoints[strokePoints.length-1].point:dist_esm.l2P.AddXY(firstStrokePoint.point,1,1);if(1===strokePoints.length&&(!taperStart&&!taperEnd||isComplete)){const start2=dist_esm.l2P.Add(firstPoint,dist_esm.l2P.Sub(firstPoint,lastPoint).uni().per().mul(-firstStrokePoint.radius)),dotPts=[];for(let step=1/13,t=step;t<=1;t+=step)dotPts.push(dist_esm.l2P.RotWith(start2,firstPoint,2*FIXED_PI*t));return dotPts}const startCap=[];if(taperStart||taperEnd&&1===strokePoints.length);else if(capStart)for(let step=1/8,t=step;t<=1;t+=step){const pt=dist_esm.l2P.RotWith(rightPts[0],firstPoint,FIXED_PI*t);startCap.push(pt)}else{const cornersVector=dist_esm.l2P.Sub(leftPts[0],rightPts[0]),offsetA=dist_esm.l2P.Mul(cornersVector,.5),offsetB=dist_esm.l2P.Mul(cornersVector,.51);startCap.push(dist_esm.l2P.Sub(firstPoint,offsetA),dist_esm.l2P.Sub(firstPoint,offsetB),dist_esm.l2P.Add(firstPoint,offsetB),dist_esm.l2P.Add(firstPoint,offsetA))}const endCap=[],direction=lastStrokePoint.vector.clone().per().neg();if(taperEnd||taperStart&&1===strokePoints.length)endCap.push(lastPoint);else if(capEnd){const start2=dist_esm.l2P.Add(lastPoint,dist_esm.l2P.Mul(direction,lastStrokePoint.radius));for(let step=1/29,t=step;t<1;t+=step)endCap.push(dist_esm.l2P.RotWith(start2,lastPoint,3*FIXED_PI*t))}else endCap.push(dist_esm.l2P.Add(lastPoint,dist_esm.l2P.Mul(direction,lastStrokePoint.radius)),dist_esm.l2P.Add(lastPoint,dist_esm.l2P.Mul(direction,.99*lastStrokePoint.radius)),dist_esm.l2P.Sub(lastPoint,dist_esm.l2P.Mul(direction,.99*lastStrokePoint.radius)),dist_esm.l2P.Sub(lastPoint,dist_esm.l2P.Mul(direction,lastStrokePoint.radius)));return leftPts.concat(endCap,rightPts.reverse(),startCap)}const MIN_START_PRESSURE=.025,MIN_END_PRESSURE=.01;function getStrokePoints(rawInputPoints,options={}){const{streamline=.5,size=16,simulatePressure=!1}=options;if(0===rawInputPoints.length)return[];const t=.15+.85*(1-streamline);let pts=rawInputPoints.map(dist_esm.l2P.From),pointsRemovedFromNearEnd=0;if(!simulatePressure){let pt2=pts[0];for(;pt2&&!(pt2.z>=MIN_START_PRESSURE);)pts.shift(),pt2=pts[0]}if(!simulatePressure){let pt2=pts[pts.length-1];for(;pt2&&!(pt2.z>=MIN_END_PRESSURE);)pts.pop(),pt2=pts[pts.length-1]}if(0===pts.length)return[{point:dist_esm.l2P.From(rawInputPoints[0]),input:dist_esm.l2P.From(rawInputPoints[0]),pressure:simulatePressure?.5:.15,vector:new dist_esm.l2P(1,1),distance:0,runningLength:0,radius:1}];let pt=pts[1];for(;pt&&!(dist_esm.l2P.Dist2(pt,pts[0])>(size/3)**2);)pts[0].z=Math.max(pts[0].z,pt.z),pts.splice(1,1),pt=pts[1];const last=pts.pop();for(pt=pts[pts.length-1];pt&&!(dist_esm.l2P.Dist2(pt,last)>(size/3)**2);)pts.pop(),pt=pts[pts.length-1],pointsRemovedFromNearEnd++;pts.push(last);const isComplete=options.last||!options.simulatePressure||pts.length>1&&dist_esm.l2P.Dist2(pts[pts.length-1],pts[pts.length-2])<size**2||pointsRemovedFromNearEnd>0;if(2===pts.length&&options.simulatePressure){const last2=pts[1];pts=pts.slice(0,-1);for(let i=1;i<5;i++){const next=dist_esm.l2P.Lrp(pts[0],last2,i/4);next.z=(pts[0].z+(last2.z-pts[0].z))*i/4,pts.push(next)}}const strokePoints=[{point:pts[0],input:pts[0],pressure:simulatePressure?.5:pts[0].z,vector:new dist_esm.l2P(1,1),distance:0,runningLength:0,radius:1}];let point,distance,totalLength=0,prev=strokePoints[0];isComplete&&streamline>0&&pts.push(pts[pts.length-1].clone());for(let i=1,n=pts.length;i<n;i++)point=!t||options.last&&i===n-1?pts[i].clone():pts[i].clone().lrp(prev.point,1-t),prev.point.equals(point)||(distance=dist_esm.l2P.Dist(point,prev.point),totalLength+=distance,i<4&&totalLength<size||(prev={input:pts[i],point,pressure:simulatePressure?.5:pts[i].z,vector:dist_esm.l2P.Sub(prev.point,point).uni(),distance,runningLength:totalLength,radius:1},strokePoints.push(prev)));if(strokePoints[1]?.vector&&(strokePoints[0].vector=strokePoints[1].vector.clone()),totalLength<1){const maxPressureAmongPoints=Math.max(.5,...strokePoints.map((s=>s.pressure)));strokePoints.forEach((s=>s.pressure=maxPressureAmongPoints))}return strokePoints}const{min}=Math,RATE_OF_PRESSURE_CHANGE=.275;function setStrokePointRadii(strokePoints,options){const{size=16,thinning=.5,simulatePressure=!0,easing=t=>t,start={},end={}}=options,{easing:taperStartEase=dist_esm.Z4H.easeOutQuad}=start,{easing:taperEndEase=dist_esm.Z4H.easeOutCubic}=end,totalLength=strokePoints[strokePoints.length-1].runningLength;let firstRadius,strokePoint,prevPressure=strokePoints[0].pressure;if(!simulatePressure&&totalLength<size){const max=strokePoints.reduce(((max2,curr)=>Math.max(max2,curr.pressure)),.5);return strokePoints.forEach((sp=>{sp.pressure=max,sp.radius=size*easing(.5-thinning*(.5-sp.pressure))})),strokePoints}{let p;for(let i=0,n=strokePoints.length;i<n&&(strokePoint=strokePoints[i],!(strokePoint.runningLength>5*size));i++){const sp=min(1,strokePoint.distance/size);if(simulatePressure){const rp=min(1,1-sp);p=min(1,prevPressure+sp*RATE_OF_PRESSURE_CHANGE*(rp-prevPressure))}else p=min(1,prevPressure+.5*(strokePoint.pressure-prevPressure));prevPressure+=.5*(p-prevPressure)}for(let i=0;i<strokePoints.length;i++){if(strokePoint=strokePoints[i],thinning){let{pressure}=strokePoint;const sp=min(1,strokePoint.distance/size);if(simulatePressure){const rp=min(1,1-sp);pressure=min(1,prevPressure+sp*RATE_OF_PRESSURE_CHANGE*(rp-prevPressure))}else pressure=min(1,prevPressure+sp*RATE_OF_PRESSURE_CHANGE*(pressure-prevPressure));strokePoint.radius=size*easing(.5-thinning*(.5-pressure)),prevPressure=pressure}else strokePoint.radius=size/2;void 0===firstRadius&&(firstRadius=strokePoint.radius)}}const taperStart=!1===start.taper?0:!0===start.taper?Math.max(size,totalLength):start.taper,taperEnd=!1===end.taper?0:!0===end.taper?Math.max(size,totalLength):end.taper;if(taperStart||taperEnd)for(let i=0;i<strokePoints.length;i++){strokePoint=strokePoints[i];const{runningLength}=strokePoint,ts=runningLength<taperStart?taperStartEase(runningLength/taperStart):1,te=totalLength-runningLength<taperEnd?taperEndEase((totalLength-runningLength)/taperEnd):1;strokePoint.radius=Math.max(.01,strokePoint.radius*Math.min(ts,te))}return strokePoints}function TldrawScribble({scribble,zoom,color,opacity,className}){if(!scribble.points.length)return null;const stroke=function getStroke(points,options={}){return getStrokeOutlinePoints(setStrokePointRadii(getStrokePoints(points,options),options),options)}(scribble.points,{size:scribble.size/zoom,start:{taper:scribble.taper,easing:dist_esm.Z4H.linear},last:"stopping"===scribble.state,simulatePressure:!1,streamline:.32});let d;if(stroke.length<4){const r=scribble.size/zoom/2,{x,y}=scribble.points[scribble.points.length-1];d=`M ${x-r},${y} a ${r},${r} 0 1,0 ${2*r},0 a ${r},${r} 0 1,0 ${2*-r},0`}else d=(0,dist_esm.JDT)(stroke);return(0,jsx_runtime.jsx)("svg",{className:className?classnames_default()("tl-overlays__item",className):className,children:(0,jsx_runtime.jsx)("path",{className:"tl-scribble",d,fill:color??`var(--color-${scribble.color})`,opacity:opacity??scribble.opacity})})}function TldrawCropHandles({size,width,height,hideAlternateHandles}){const cropStrokeWidth=(0,dist_esm.WMC)(size/3),offset=cropStrokeWidth/2,msg=useTranslation_useTranslation();return(0,jsx_runtime.jsxs)("svg",{className:"tl-overlays__item",children:[(0,jsx_runtime.jsx)("polyline",{className:"tl-corner-crop-handle",points:`\n\t\t\t\t\t\t${(0,dist_esm.WMC)(0-offset)},${(0,dist_esm.WMC)(size)} \n\t\t\t\t\t\t${(0,dist_esm.WMC)(0-offset)},${(0,dist_esm.WMC)(0-offset)} \n\t\t\t\t\t\t${(0,dist_esm.WMC)(size)},${(0,dist_esm.WMC)(0-offset)}`,strokeWidth:cropStrokeWidth,"data-testid":"selection.crop.top_left",role:"button","aria-label":msg("handle.crop.top-left")}),(0,jsx_runtime.jsx)("line",{className:classnames_default()("tl-corner-crop-edge-handle",{"tl-hidden":hideAlternateHandles}),x1:(0,dist_esm.WMC)(width/2-size),y1:(0,dist_esm.WMC)(0-offset),x2:(0,dist_esm.WMC)(width/2+size),y2:(0,dist_esm.WMC)(0-offset),strokeWidth:cropStrokeWidth,"data-testid":"selection.crop.top",role:"button","aria-label":msg("handle.crop.top")}),(0,jsx_runtime.jsx)("polyline",{className:classnames_default()("tl-corner-crop-handle",{"tl-hidden":hideAlternateHandles}),points:`\n\t\t\t\t\t\t${(0,dist_esm.WMC)(width-size)},${(0,dist_esm.WMC)(0-offset)} \n\t\t\t\t\t\t${(0,dist_esm.WMC)(width+offset)},${(0,dist_esm.WMC)(0-offset)} \n\t\t\t\t\t\t${(0,dist_esm.WMC)(width+offset)},${(0,dist_esm.WMC)(size)}`,strokeWidth:cropStrokeWidth,"data-testid":"selection.crop.top_right",role:"button","aria-label":msg("handle.crop.top-right")}),(0,jsx_runtime.jsx)("line",{className:classnames_default()("tl-corner-crop-edge-handle",{"tl-hidden":hideAlternateHandles}),x1:(0,dist_esm.WMC)(width+offset),y1:(0,dist_esm.WMC)(height/2-size),x2:(0,dist_esm.WMC)(width+offset),y2:(0,dist_esm.WMC)(height/2+size),strokeWidth:cropStrokeWidth,"data-testid":"selection.crop.right",role:"button","aria-label":msg("handle.crop.right")}),(0,jsx_runtime.jsx)("polyline",{className:"tl-corner-crop-handle",points:`\n\t\t\t\t\t\t${(0,dist_esm.WMC)(width+offset)},${(0,dist_esm.WMC)(height-size)} \n\t\t\t\t\t\t${(0,dist_esm.WMC)(width+offset)},${(0,dist_esm.WMC)(height+offset)}\n\t\t\t\t\t\t${(0,dist_esm.WMC)(width-size)},${(0,dist_esm.WMC)(height+offset)}`,strokeWidth:cropStrokeWidth,"data-testid":"selection.crop.bottom_right",role:"button","aria-label":msg("handle.crop.bottom-right")}),(0,jsx_runtime.jsx)("line",{className:classnames_default()("tl-corner-crop-edge-handle",{"tl-hidden":hideAlternateHandles}),x1:(0,dist_esm.WMC)(width/2-size),y1:(0,dist_esm.WMC)(height+offset),x2:(0,dist_esm.WMC)(width/2+size),y2:(0,dist_esm.WMC)(height+offset),strokeWidth:cropStrokeWidth,"data-testid":"selection.crop.bottom",role:"button","aria-label":msg("handle.crop.bottom")}),(0,jsx_runtime.jsx)("polyline",{className:classnames_default()("tl-corner-crop-handle",{"tl-hidden":hideAlternateHandles}),points:`\n\t\t\t\t\t\t${(0,dist_esm.WMC)(0+size)},${(0,dist_esm.WMC)(height+offset)} \n\t\t\t\t\t\t${(0,dist_esm.WMC)(0-offset)},${(0,dist_esm.WMC)(height+offset)}\n\t\t\t\t\t\t${(0,dist_esm.WMC)(0-offset)},${(0,dist_esm.WMC)(height-size)}`,strokeWidth:cropStrokeWidth,"data-testid":"selection.crop.bottom_left",role:"button","aria-label":msg("handle.crop.bottom-left")}),(0,jsx_runtime.jsx)("line",{className:classnames_default()("tl-corner-crop-edge-handle",{"tl-hidden":hideAlternateHandles}),x1:(0,dist_esm.WMC)(0-offset),y1:(0,dist_esm.WMC)(height/2-size),x2:(0,dist_esm.WMC)(0-offset),y2:(0,dist_esm.WMC)(height/2+size),strokeWidth:cropStrokeWidth,"data-testid":"selection.crop.left",role:"button","aria-label":msg("handle.crop.left")})]})}const TldrawSelectionForeground=(0,dist_esm.u4I)((function TldrawSelectionForeground2({bounds,rotation}){const editor=(0,dist_esm.hGv)(),msg=useTranslation_useTranslation(),rSvg=(0,react.useRef)(null),isReadonlyMode=useReadonly(),topEvents=(0,dist_esm.bQe)("top"),rightEvents=(0,dist_esm.bQe)("right"),bottomEvents=(0,dist_esm.bQe)("bottom"),leftEvents=(0,dist_esm.bQe)("left"),topLeftEvents=(0,dist_esm.bQe)("top_left"),topRightEvents=(0,dist_esm.bQe)("top_right"),bottomRightEvents=(0,dist_esm.bQe)("bottom_right"),bottomLeftEvents=(0,dist_esm.bQe)("bottom_left"),isDefaultCursor="default"===editor.getInstanceState().cursor.type,isCoarsePointer=editor.getInstanceState().isCoarsePointer,onlyShape=editor.getOnlySelectedShape(),isLockedShape=onlyShape&&editor.isShapeOrAncestorLocked(onlyShape),expandOutlineBy=onlyShape?editor.getShapeUtil(onlyShape).expandSelectionOutlinePx(onlyShape):0,expandedBounds=expandOutlineBy instanceof dist_esm.azJ?bounds.clone().expand(expandOutlineBy).zeroFix():bounds.clone().expandBy(expandOutlineBy).zeroFix();if((0,dist_esm.Gyu)(rSvg,bounds?.x,bounds?.y,1,editor.getSelectionRotation(),{x:expandedBounds.x-bounds.x,y:expandedBounds.y-bounds.y}),onlyShape&&editor.isShapeHidden(onlyShape))return null;const zoom=editor.getZoomLevel(),isChangingStyle=editor.getInstanceState().isChangingStyle,width=expandedBounds.width,height=expandedBounds.height,size=8/zoom,isTinyX=width<2*size,isTinyY=height<2*size,isSmallX=width<4*size,isSmallY=height<4*size,isSmallCropX=width<5*size,isSmallCropY=height<5*size,mobileHandleMultiplier=isCoarsePointer?1.75:1,targetSize=6/zoom*mobileHandleMultiplier,targetSizeX=(isSmallX?targetSize/2:targetSize)*(.75*mobileHandleMultiplier),targetSizeY=(isSmallY?targetSize/2:targetSize)*(.75*mobileHandleMultiplier),showSelectionBounds=!(onlyShape&&editor.getShapeUtil(onlyShape).hideSelectionBoundsFg(onlyShape)||isChangingStyle);let shouldDisplayBox=showSelectionBounds&&editor.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||showSelectionBounds&&editor.isIn("select.resizing")&&onlyShape&&editor.isShapeOfType(onlyShape,"text");onlyShape&&shouldDisplayBox&&dist_esm.YZA.isFirefox&&editor.isShapeOfType(onlyShape,"embed")&&(shouldDisplayBox=!1);const showCropHandles=editor.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!isChangingStyle&&!isReadonlyMode,shouldDisplayControls=editor.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!isChangingStyle&&!isReadonlyMode,showCornerRotateHandles=!isCoarsePointer&&!(isTinyX||isTinyY)&&(shouldDisplayControls||showCropHandles)&&(!onlyShape||!editor.getShapeUtil(onlyShape).hideRotateHandle(onlyShape))&&!isLockedShape,showMobileRotateHandle=isCoarsePointer&&(!isSmallX||!isSmallY)&&(shouldDisplayControls||showCropHandles)&&(!onlyShape||!editor.getShapeUtil(onlyShape).hideRotateHandle(onlyShape))&&!isLockedShape,showResizeHandles=shouldDisplayControls&&(!onlyShape||editor.getShapeUtil(onlyShape).canResize(onlyShape)&&!editor.getShapeUtil(onlyShape).hideResizeHandles(onlyShape))&&!showCropHandles&&!isLockedShape,hideAlternateCornerHandles=isTinyX||isTinyY,showOnlyOneHandle=isTinyX&&isTinyY,hideAlternateCropHandles=isSmallCropX||isSmallCropY,showHandles=showResizeHandles||showCropHandles,hideRotateCornerHandles=!showCornerRotateHandles,hideMobileRotateHandle=!shouldDisplayControls||!showMobileRotateHandle,hideTopLeftCorner=!shouldDisplayControls||!showHandles,hideTopRightCorner=!shouldDisplayControls||!showHandles||hideAlternateCornerHandles,hideBottomLeftCorner=!shouldDisplayControls||!showHandles||hideAlternateCornerHandles,hideBottomRightCorner=!shouldDisplayControls||!showHandles||showOnlyOneHandle&&!showCropHandles;let hideVerticalEdgeTargets=!0,hideHorizontalEdgeTargets=!0;if(showCropHandles)hideVerticalEdgeTargets=hideAlternateCropHandles,hideHorizontalEdgeTargets=hideAlternateCropHandles;else if(showResizeHandles){hideVerticalEdgeTargets=hideAlternateCornerHandles||showOnlyOneHandle||isCoarsePointer;const isMobileAndTextShape=isCoarsePointer&&onlyShape&&"text"===onlyShape.type;hideHorizontalEdgeTargets=hideVerticalEdgeTargets&&!isMobileAndTextShape}const textHandleHeight=Math.min(24/zoom,height-3*targetSizeY),showTextResizeHandles=shouldDisplayControls&&isCoarsePointer&&onlyShape&&editor.isShapeOfType(onlyShape,"text")&&textHandleHeight*zoom>=4;return(0,jsx_runtime.jsx)("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:(0,jsx_runtime.jsxs)("g",{ref:rSvg,children:[shouldDisplayBox&&(0,jsx_runtime.jsx)("rect",{className:"tl-selection__fg__outline",width:(0,dist_esm.WMC)(width),height:(0,dist_esm.WMC)(height)}),(0,jsx_runtime.jsx)(RotateCornerHandle,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize,corner:"top_left_rotate",cursor:isDefaultCursor?(0,dist_esm.BEc)("nwse-rotate",rotation):void 0,isHidden:hideRotateCornerHandles}),(0,jsx_runtime.jsx)(RotateCornerHandle,{"data-testid":"selection.rotate.top-right",cx:width+3*targetSize,cy:0,targetSize,corner:"top_right_rotate",cursor:isDefaultCursor?(0,dist_esm.BEc)("nesw-rotate",rotation):void 0,isHidden:hideRotateCornerHandles}),(0,jsx_runtime.jsx)(RotateCornerHandle,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:height+3*targetSize,targetSize,corner:"bottom_left_rotate",cursor:isDefaultCursor?(0,dist_esm.BEc)("swne-rotate",rotation):void 0,isHidden:hideRotateCornerHandles}),(0,jsx_runtime.jsx)(RotateCornerHandle,{"data-testid":"selection.rotate.bottom-right",cx:width+3*targetSize,cy:height+3*targetSize,targetSize,corner:"bottom_right_rotate",cursor:isDefaultCursor?(0,dist_esm.BEc)("senw-rotate",rotation):void 0,isHidden:hideRotateCornerHandles}),(0,jsx_runtime.jsx)(MobileRotateHandle,{"data-testid":"selection.rotate.mobile",cx:isSmallX?1.5*-targetSize:width/2,cy:isSmallX?height/2:1.5*-targetSize,size,isHidden:hideMobileRotateHandle}),(0,jsx_runtime.jsx)(ResizeHandle,{hide:hideVerticalEdgeTargets,dataTestId:"selection.resize.top",ariaLabel:msg("handle.resize-top"),x:0,y:(0,dist_esm.WMC)(0-(isSmallY?2*targetSizeY:targetSizeY)),width:(0,dist_esm.WMC)(width),height:(0,dist_esm.WMC)(Math.max(1,2*targetSizeY)),cursor:isDefaultCursor?(0,dist_esm.BEc)("ns-resize",rotation):void 0,events:topEvents}),(0,jsx_runtime.jsx)(ResizeHandle,{hide:hideHorizontalEdgeTargets,dataTestId:"selection.resize.right",ariaLabel:msg("handle.resize-right"),x:(0,dist_esm.WMC)(width-(isSmallX?0:targetSizeX)),y:0,height:(0,dist_esm.WMC)(height),width:(0,dist_esm.WMC)(Math.max(1,2*targetSizeX)),cursor:isDefaultCursor?(0,dist_esm.BEc)("ew-resize",rotation):void 0,events:rightEvents}),(0,jsx_runtime.jsx)(ResizeHandle,{hide:hideVerticalEdgeTargets,dataTestId:"selection.resize.bottom",ariaLabel:msg("handle.resize-bottom"),x:0,y:(0,dist_esm.WMC)(height-(isSmallY?0:targetSizeY)),width:(0,dist_esm.WMC)(width),height:(0,dist_esm.WMC)(Math.max(1,2*targetSizeY)),cursor:isDefaultCursor?(0,dist_esm.BEc)("ns-resize",rotation):void 0,events:bottomEvents}),(0,jsx_runtime.jsx)(ResizeHandle,{hide:hideHorizontalEdgeTargets,dataTestId:"selection.resize.left",ariaLabel:msg("handle.resize-left"),x:(0,dist_esm.WMC)(0-(isSmallX?2*targetSizeX:targetSizeX)),y:0,height:(0,dist_esm.WMC)(height),width:(0,dist_esm.WMC)(Math.max(1,2*targetSizeX)),cursor:isDefaultCursor?(0,dist_esm.BEc)("ew-resize",rotation):void 0,events:leftEvents}),(0,jsx_runtime.jsx)(ResizeHandle,{hide:hideTopLeftCorner,dataTestId:"selection.target.top-left",ariaLabel:msg("handle.resize-top-left"),x:(0,dist_esm.WMC)(0-(isSmallX?2*targetSizeX:1.5*targetSizeX)),y:(0,dist_esm.WMC)(0-(isSmallY?2*targetSizeY:1.5*targetSizeY)),width:(0,dist_esm.WMC)(3*targetSizeX),height:(0,dist_esm.WMC)(3*targetSizeY),cursor:isDefaultCursor?(0,dist_esm.BEc)("nwse-resize",rotation):void 0,events:topLeftEvents}),(0,jsx_runtime.jsx)(ResizeHandle,{hide:hideTopRightCorner,dataTestId:"selection.target.top-right",ariaLabel:msg("handle.resize-top-right"),x:(0,dist_esm.WMC)(width-(isSmallX?0:1.5*targetSizeX)),y:(0,dist_esm.WMC)(0-(isSmallY?2*targetSizeY:1.5*targetSizeY)),width:(0,dist_esm.WMC)(3*targetSizeX),height:(0,dist_esm.WMC)(3*targetSizeY),cursor:isDefaultCursor?(0,dist_esm.BEc)("nesw-resize",rotation):void 0,events:topRightEvents}),(0,jsx_runtime.jsx)(ResizeHandle,{hide:hideBottomRightCorner,dataTestId:"selection.target.bottom-right",ariaLabel:msg("handle.resize-bottom-right"),x:(0,dist_esm.WMC)(width-(isSmallX?targetSizeX:1.5*targetSizeX)),y:(0,dist_esm.WMC)(height-(isSmallY?targetSizeY:1.5*targetSizeY)),width:(0,dist_esm.WMC)(3*targetSizeX),height:(0,dist_esm.WMC)(3*targetSizeY),cursor:isDefaultCursor?(0,dist_esm.BEc)("nwse-resize",rotation):void 0,events:bottomRightEvents}),(0,jsx_runtime.jsx)(ResizeHandle,{hide:hideBottomLeftCorner,dataTestId:"selection.target.bottom-left",ariaLabel:msg("handle.resize-bottom-left"),x:(0,dist_esm.WMC)(0-(isSmallX?3*targetSizeX:1.5*targetSizeX)),y:(0,dist_esm.WMC)(height-(isSmallY?0:1.5*targetSizeY)),width:(0,dist_esm.WMC)(3*targetSizeX),height:(0,dist_esm.WMC)(3*targetSizeY),cursor:isDefaultCursor?(0,dist_esm.BEc)("nesw-resize",rotation):void 0,events:bottomLeftEvents}),showResizeHandles&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("rect",{"data-testid":"selection.resize.top-left",className:classnames_default()("tl-corner-handle",{"tl-hidden":hideTopLeftCorner}),x:(0,dist_esm.WMC)(0-size/2),y:(0,dist_esm.WMC)(0-size/2),width:(0,dist_esm.WMC)(size),height:(0,dist_esm.WMC)(size)}),(0,jsx_runtime.jsx)("rect",{"data-testid":"selection.resize.top-right",className:classnames_default()("tl-corner-handle",{"tl-hidden":hideTopRightCorner}),x:(0,dist_esm.WMC)(width-size/2),y:(0,dist_esm.WMC)(0-size/2),width:(0,dist_esm.WMC)(size),height:(0,dist_esm.WMC)(size)}),(0,jsx_runtime.jsx)("rect",{"data-testid":"selection.resize.bottom-right",className:classnames_default()("tl-corner-handle",{"tl-hidden":hideBottomRightCorner}),x:(0,dist_esm.WMC)(width-size/2),y:(0,dist_esm.WMC)(height-size/2),width:(0,dist_esm.WMC)(size),height:(0,dist_esm.WMC)(size)}),(0,jsx_runtime.jsx)("rect",{"data-testid":"selection.resize.bottom-left",className:classnames_default()("tl-corner-handle",{"tl-hidden":hideBottomLeftCorner}),x:(0,dist_esm.WMC)(0-size/2),y:(0,dist_esm.WMC)(height-size/2),width:(0,dist_esm.WMC)(size),height:(0,dist_esm.WMC)(size)})]}),showTextResizeHandles&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle",x:(0,dist_esm.WMC)(0-size/4),y:(0,dist_esm.WMC)(height/2-textHandleHeight/2),rx:size/4,width:(0,dist_esm.WMC)(size/2),height:(0,dist_esm.WMC)(textHandleHeight)}),(0,jsx_runtime.jsx)("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle",rx:size/4,x:(0,dist_esm.WMC)(width-size/4),y:(0,dist_esm.WMC)(height/2-textHandleHeight/2),width:(0,dist_esm.WMC)(size/2),height:(0,dist_esm.WMC)(textHandleHeight)})]}),showCropHandles&&(0,jsx_runtime.jsx)(TldrawCropHandles,{size,width,height,hideAlternateHandles:hideAlternateCropHandles})]})})})),ResizeHandle=function ResizeHandle2({hide,dataTestId,ariaLabel,x,y,width,height,cursor,events}){return(0,jsx_runtime.jsx)("rect",{className:classnames_default()("tl-resize-handle","tl-transparent",{"tl-hidden":hide}),"data-testid":dataTestId,role:"button","aria-label":ariaLabel,pointerEvents:"all",x,y,width,height,cursor,...events})},RotateCornerHandle=function RotateCornerHandle2({cx,cy,targetSize,corner,cursor,isHidden,"data-testid":testId}){const events=(0,dist_esm.bQe)(corner),label=useTranslation_useTranslation()(`handle.rotate.${corner}`);return(0,jsx_runtime.jsx)("rect",{className:classnames_default()("tl-transparent","tl-rotate-corner",{"tl-hidden":isHidden}),"data-testid":testId,role:"button","aria-label":label,pointerEvents:"all",x:(0,dist_esm.WMC)(cx-3*targetSize),y:(0,dist_esm.WMC)(cy-3*targetSize),width:(0,dist_esm.WMC)(Math.max(1,3*targetSize)),height:(0,dist_esm.WMC)(Math.max(1,3*targetSize)),cursor,...events})},SQUARE_ROOT_PI=Math.sqrt(Math.PI),MobileRotateHandle=function RotateHandle({cx,cy,size,isHidden,"data-testid":testId}){const events=(0,dist_esm.bQe)("mobile_rotate"),editor=(0,dist_esm.hGv)(),zoom=(0,dist_esm.hau)("zoom level",(()=>editor.getZoomLevel()),[editor]),bgRadius=Math.max(1/zoom*14,20/Math.max(1,zoom)),msg=useTranslation_useTranslation();return(0,jsx_runtime.jsxs)("g",{role:"button","aria-label":msg("handle.rotate.mobile_rotate"),children:[(0,jsx_runtime.jsx)("circle",{"data-testid":testId,pointerEvents:"all",className:classnames_default()("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":isHidden}),cx,cy,r:bgRadius,...events}),(0,jsx_runtime.jsx)("circle",{className:classnames_default()("tl-mobile-rotate__fg",{"tl-hidden":isHidden}),cx,cy,r:size/SQUARE_ROOT_PI})]})};function TldrawShapeIndicators(){const editor=(0,dist_esm.hGv)(),isInSelectState=(0,dist_esm.hau)("is in a valid select state",(()=>editor.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")),[editor]);return(0,jsx_runtime.jsx)(dist_esm.X$1,{hideAll:!isInSelectState})}var store_dist_esm=__webpack_require__("./node_modules/@tldraw/store/dist-esm/index.mjs");function getStraightArrowInfo(editor,shape,bindings){const{arrowheadStart,arrowheadEnd}=shape.props,terminalsInArrowSpace=getArrowTerminalsInArrowSpace(editor,shape,bindings),a=terminalsInArrowSpace.start.clone(),b=terminalsInArrowSpace.end.clone(),c=dist_esm.l2P.Med(a,b);if(dist_esm.l2P.Equals(a,b))return{bindings,type:"straight",start:{handle:a,point:a,arrowhead:shape.props.arrowheadStart},end:{handle:b,point:b,arrowhead:shape.props.arrowheadEnd},middle:c,isValid:!1,length:0};const uAB=dist_esm.l2P.Sub(b,a).uni(),startShapeInfo=getBoundShapeInfoForTerminal(editor,shape,"start"),endShapeInfo=getBoundShapeInfoForTerminal(editor,shape,"end"),arrowPageTransform=editor.getShapePageTransform(shape);updateArrowheadPointWithBoundShape(b,terminalsInArrowSpace.start,arrowPageTransform,endShapeInfo),updateArrowheadPointWithBoundShape(a,terminalsInArrowSpace.end,arrowPageTransform,startShapeInfo);let offsetA=0,offsetB=0,strokeOffsetA=0,strokeOffsetB=0,minLength=MIN_ARROW_LENGTH*shape.props.scale;const isSelfIntersection=startShapeInfo&&endShapeInfo&&startShapeInfo.shape===endShapeInfo.shape,relationship=startShapeInfo&&endShapeInfo?getBoundShapeRelationships(editor,startShapeInfo.shape.id,endShapeInfo.shape.id):"safe";"safe"!==relationship||!startShapeInfo||!endShapeInfo||isSelfIntersection||startShapeInfo.isExact||endShapeInfo.isExact||(endShapeInfo.didIntersect&&!startShapeInfo.didIntersect?startShapeInfo.isClosed&&a.setTo(b.clone().add(uAB.clone().mul(MIN_ARROW_LENGTH*shape.props.scale))):endShapeInfo.didIntersect||endShapeInfo.isClosed&&b.setTo(a.clone().sub(uAB.clone().mul(MIN_ARROW_LENGTH*shape.props.scale))));const distance=dist_esm.l2P.Sub(b,a),u=dist_esm.l2P.Len(distance)?distance.uni():dist_esm.l2P.From(distance),didFlip=!dist_esm.l2P.Equals(u,uAB);isSelfIntersection||("start-contains-end"!==relationship&&startShapeInfo&&"none"!==arrowheadStart&&!startShapeInfo.isExact&&(strokeOffsetA=STROKE_SIZES[shape.props.size]/2+("size"in startShapeInfo.shape.props?STROKE_SIZES[startShapeInfo.shape.props.size]/2:0),offsetA=(BOUND_ARROW_OFFSET+strokeOffsetA)*shape.props.scale,minLength+=strokeOffsetA*shape.props.scale),"end-contains-start"!==relationship&&endShapeInfo&&"none"!==arrowheadEnd&&!endShapeInfo.isExact&&(strokeOffsetB=STROKE_SIZES[shape.props.size]/2+("size"in endShapeInfo.shape.props?STROKE_SIZES[endShapeInfo.shape.props.size]/2:0),offsetB=(BOUND_ARROW_OFFSET+strokeOffsetB)*shape.props.scale,minLength+=strokeOffsetB*shape.props.scale));const tA=a.clone().add(u.clone().mul(offsetA*(didFlip?-1:1))),tB=b.clone().sub(u.clone().mul(offsetB*(didFlip?-1:1)));dist_esm.l2P.DistMin(tA,tB,minLength)&&(0!==offsetA&&0!==offsetB?(offsetA*=-1.5,offsetB*=-1.5):0!==offsetA?offsetA*=-1:0!==offsetB&&(offsetB*=-1)),a.add(u.clone().mul(offsetA*(didFlip?-1:1))),b.sub(u.clone().mul(offsetB*(didFlip?-1:1))),didFlip?(startShapeInfo&&endShapeInfo&&b.setTo(dist_esm.l2P.Add(a,u.clone().mul(-MIN_ARROW_LENGTH*shape.props.scale))),c.setTo(dist_esm.l2P.Med(terminalsInArrowSpace.start,terminalsInArrowSpace.end))):c.setTo(dist_esm.l2P.Med(a,b));const length=dist_esm.l2P.Dist(a,b);return{bindings,type:"straight",start:{handle:terminalsInArrowSpace.start,point:a,arrowhead:shape.props.arrowheadStart},end:{handle:terminalsInArrowSpace.end,point:b,arrowhead:shape.props.arrowheadEnd},middle:c,isValid:length>0,length}}function updateArrowheadPointWithBoundShape(point,opposite,arrowPageTransform,targetShapeInfo){if(void 0===targetShapeInfo)return;if(targetShapeInfo.isExact)return;const pageFrom=dist_esm.V8r.applyToPoint(arrowPageTransform,opposite),pageTo=dist_esm.V8r.applyToPoint(arrowPageTransform,point),targetFrom=dist_esm.V8r.applyToPoint(dist_esm.V8r.Inverse(targetShapeInfo.transform),pageFrom),targetTo=dist_esm.V8r.applyToPoint(dist_esm.V8r.Inverse(targetShapeInfo.transform),pageTo),intersection=Array.from(targetShapeInfo.geometry.intersectLineSegment(targetFrom,targetTo,{includeLabels:!1,includeInternal:!1}));let targetInt;if(intersection.length&&(targetInt=intersection.sort(((p1,p2)=>dist_esm.l2P.Dist2(p1,targetFrom)-dist_esm.l2P.Dist2(p2,targetFrom)))[0]??(targetShapeInfo.isClosed?void 0:targetTo)),void 0===targetInt&&(targetInt=targetShapeInfo.geometry.nearestPoint(targetTo),!dist_esm.l2P.DistMin(targetInt,targetTo,1)))return;const pageInt=dist_esm.V8r.applyToPoint(targetShapeInfo.transform,targetInt),arrowInt=dist_esm.V8r.applyToPoint(dist_esm.V8r.Inverse(arrowPageTransform),pageInt);point.setTo(arrowInt),targetShapeInfo.didIntersect=!0}function getCurvedArrowInfo(editor,shape,bindings){const{arrowheadEnd,arrowheadStart}=shape.props,bend=shape.props.bend;if(Math.abs(bend)>Math.abs(shape.props.bend*(WAY_TOO_BIG_ARROW_BEND_FACTOR*shape.props.scale)))return getStraightArrowInfo(editor,shape,bindings);const terminalsInArrowSpace=getArrowTerminalsInArrowSpace(editor,shape,bindings),med=dist_esm.l2P.Med(terminalsInArrowSpace.start,terminalsInArrowSpace.end),distance=dist_esm.l2P.Sub(terminalsInArrowSpace.end,terminalsInArrowSpace.start),u=dist_esm.l2P.Len(distance)?distance.uni():dist_esm.l2P.From(distance),middle=dist_esm.l2P.Add(med,u.per().mul(-bend)),startShapeInfo=getBoundShapeInfoForTerminal(editor,shape,"start"),endShapeInfo=getBoundShapeInfoForTerminal(editor,shape,"end"),a=terminalsInArrowSpace.start.clone(),b=terminalsInArrowSpace.end.clone(),c=middle.clone();if(dist_esm.l2P.Equals(a,b))return{bindings,type:"straight",start:{handle:a,point:a,arrowhead:shape.props.arrowheadStart},end:{handle:b,point:b,arrowhead:shape.props.arrowheadEnd},middle:c,isValid:!1,length:0};const isClockwise=shape.props.bend<0,distFn=isClockwise?dist_esm.KMq:dist_esm.IM4,handleArc=getArcInfo(a,b,c),handle_aCA=dist_esm.l2P.Angle(handleArc.center,a),handle_aCB=dist_esm.l2P.Angle(handleArc.center,b),handle_dAB=distFn(handle_aCA,handle_aCB);if(0===handleArc.length||0===handleArc.size||!(0,dist_esm._Bd)(handleArc.length)||!(0,dist_esm._Bd)(handleArc.size))return getStraightArrowInfo(editor,shape,bindings);const tempA=a.clone(),tempB=b.clone(),tempC=c.clone(),arrowPageTransform=editor.getShapePageTransform(shape);let offsetA=0,offsetB=0,minLength=MIN_ARROW_LENGTH*shape.props.scale;if(startShapeInfo&&!startShapeInfo.isExact){const startInPageSpace=dist_esm.V8r.applyToPoint(arrowPageTransform,tempA),centerInPageSpace=dist_esm.V8r.applyToPoint(arrowPageTransform,handleArc.center),endInPageSpace=dist_esm.V8r.applyToPoint(arrowPageTransform,tempB),inverseTransform=dist_esm.V8r.Inverse(startShapeInfo.transform),startInStartShapeLocalSpace=dist_esm.V8r.applyToPoint(inverseTransform,startInPageSpace),centerInStartShapeLocalSpace=dist_esm.V8r.applyToPoint(inverseTransform,centerInPageSpace),endInStartShapeLocalSpace=dist_esm.V8r.applyToPoint(inverseTransform,endInPageSpace),{isClosed}=startShapeInfo;let point,intersections=Array.from(startShapeInfo.geometry.intersectCircle(centerInStartShapeLocalSpace,handleArc.radius,{includeLabels:!1,includeInternal:!1}));if(intersections.length){const angleToStart=centerInStartShapeLocalSpace.angle(startInStartShapeLocalSpace),angleToEnd=centerInStartShapeLocalSpace.angle(endInStartShapeLocalSpace),dAB2=distFn(angleToStart,angleToEnd);intersections=intersections.filter((pt=>distFn(angleToStart,centerInStartShapeLocalSpace.angle(pt))<=dAB2));const targetDist=.25*dAB2;intersections.sort(isClosed?(p0,p1)=>Math.abs(distFn(angleToStart,centerInStartShapeLocalSpace.angle(p0))-targetDist)<Math.abs(distFn(angleToStart,centerInStartShapeLocalSpace.angle(p1))-targetDist)?-1:1:(p0,p1)=>distFn(angleToStart,centerInStartShapeLocalSpace.angle(p0))<distFn(angleToStart,centerInStartShapeLocalSpace.angle(p1))?-1:1),point=intersections[0]}if(!point)if(isClosed){const nearestPoint=startShapeInfo.geometry.nearestPoint(startInStartShapeLocalSpace);dist_esm.l2P.DistMin(nearestPoint,startInStartShapeLocalSpace,1)&&(point=nearestPoint)}else point=startInStartShapeLocalSpace;if(point&&(tempA.setTo(editor.getPointInShapeSpace(shape,dist_esm.V8r.applyToPoint(startShapeInfo.transform,point))),startShapeInfo.didIntersect=!0,"none"!==arrowheadStart)){const strokeOffset=STROKE_SIZES[shape.props.size]/2+("size"in startShapeInfo.shape.props?STROKE_SIZES[startShapeInfo.shape.props.size]/2:0);offsetA=(BOUND_ARROW_OFFSET+strokeOffset)*shape.props.scale,minLength+=strokeOffset*shape.props.scale}}if(endShapeInfo&&!endShapeInfo.isExact){const startInPageSpace=dist_esm.V8r.applyToPoint(arrowPageTransform,tempA),endInPageSpace=dist_esm.V8r.applyToPoint(arrowPageTransform,tempB),centerInPageSpace=dist_esm.V8r.applyToPoint(arrowPageTransform,handleArc.center),inverseTransform=dist_esm.V8r.Inverse(endShapeInfo.transform),startInEndShapeLocalSpace=dist_esm.V8r.applyToPoint(inverseTransform,startInPageSpace),centerInEndShapeLocalSpace=dist_esm.V8r.applyToPoint(inverseTransform,centerInPageSpace),endInEndShapeLocalSpace=dist_esm.V8r.applyToPoint(inverseTransform,endInPageSpace),isClosed=endShapeInfo.isClosed;let point,intersections=Array.from(endShapeInfo.geometry.intersectCircle(centerInEndShapeLocalSpace,handleArc.radius,{includeLabels:!1,includeInternal:!1}));if(intersections.length){const angleToStart=centerInEndShapeLocalSpace.angle(startInEndShapeLocalSpace),angleToEnd=centerInEndShapeLocalSpace.angle(endInEndShapeLocalSpace),dAB2=distFn(angleToStart,angleToEnd),targetDist=.75*dAB2;intersections=intersections.filter((pt=>distFn(angleToStart,centerInEndShapeLocalSpace.angle(pt))<=dAB2)),intersections.sort(isClosed?(p0,p1)=>Math.abs(distFn(angleToStart,centerInEndShapeLocalSpace.angle(p0))-targetDist)<Math.abs(distFn(angleToStart,centerInEndShapeLocalSpace.angle(p1))-targetDist)?-1:1:(p0,p1)=>distFn(angleToStart,centerInEndShapeLocalSpace.angle(p0))<distFn(angleToStart,centerInEndShapeLocalSpace.angle(p1))?-1:1),point=intersections[0]}if(!point)if(isClosed){const nearestPoint=endShapeInfo.geometry.nearestPoint(endInEndShapeLocalSpace);dist_esm.l2P.DistMin(nearestPoint,endInEndShapeLocalSpace,1)&&(point=nearestPoint)}else point=endInEndShapeLocalSpace;if(point&&(tempB.setTo(editor.getPointInShapeSpace(shape,dist_esm.V8r.applyToPoint(endShapeInfo.transform,point))),endShapeInfo.didIntersect=!0,"none"!==arrowheadEnd)){const strokeOffset=STROKE_SIZES[shape.props.size]/2+("size"in endShapeInfo.shape.props?STROKE_SIZES[endShapeInfo.shape.props.size]/2:0);offsetB=(BOUND_ARROW_OFFSET+strokeOffset)*shape.props.scale,minLength+=strokeOffset*shape.props.scale}}let aCA=dist_esm.l2P.Angle(handleArc.center,tempA),aCB=dist_esm.l2P.Angle(handleArc.center,tempB),dAB=distFn(aCA,aCB),lAB=dAB*handleArc.radius;const tA=tempA.clone(),tB=tempB.clone();if(0!==offsetA&&tA.setTo(handleArc.center).add(dist_esm.l2P.FromAngle(aCA+dAB*(offsetA/lAB*(isClockwise?1:-1))).mul(handleArc.radius)),0!==offsetB&&tB.setTo(handleArc.center).add(dist_esm.l2P.FromAngle(aCB+dAB*(offsetB/lAB*(isClockwise?-1:1))).mul(handleArc.radius)),dist_esm.l2P.DistMin(tA,tB,minLength)){0!==offsetA&&0!==offsetB?(offsetA*=-1.5,offsetB*=-1.5):0!==offsetA?offsetA*=-2:0!==offsetB&&(offsetB*=-2);const minOffsetA=.1-distFn(handle_aCA,aCA)*handleArc.radius,minOffsetB=.1-distFn(aCB,handle_aCB)*handleArc.radius;offsetA=Math.max(offsetA,minOffsetA),offsetB=Math.max(offsetB,minOffsetB)}if(0!==offsetA&&tempA.setTo(handleArc.center).add(dist_esm.l2P.FromAngle(aCA+dAB*(offsetA/lAB*(isClockwise?1:-1))).mul(handleArc.radius)),0!==offsetB&&tempB.setTo(handleArc.center).add(dist_esm.l2P.FromAngle(aCB+dAB*(offsetB/lAB*(isClockwise?-1:1))).mul(handleArc.radius)),startShapeInfo&&endShapeInfo&&!startShapeInfo.isExact&&!endShapeInfo.isExact){aCA=dist_esm.l2P.Angle(handleArc.center,tempA),aCB=dist_esm.l2P.Angle(handleArc.center,tempB),dAB=distFn(aCA,aCB),lAB=dAB*handleArc.radius;const relationship=getBoundShapeRelationships(editor,startShapeInfo.shape.id,endShapeInfo.shape.id);"double-bound"===relationship&&lAB<30?(tempA.setTo(a),tempB.setTo(b),tempC.setTo(c)):"safe"===relationship&&(startShapeInfo&&!startShapeInfo.didIntersect&&tempA.setTo(a),(endShapeInfo&&!endShapeInfo.didIntersect||distFn(handle_aCA,aCA)>distFn(handle_aCA,aCB))&&tempB.setTo(handleArc.center).add(dist_esm.l2P.FromAngle(aCA+dAB*(Math.min(.9,MIN_ARROW_LENGTH*shape.props.scale/lAB)*(isClockwise?1:-1))).mul(handleArc.radius)))}!function placeCenterHandle(center,radius,tempA,tempB,tempC,originalArcLength,isClockwise){const aCA=dist_esm.l2P.Angle(center,tempA),aCB=dist_esm.l2P.Angle(center,tempB);let dAB=(0,dist_esm.KMq)(aCA,aCB);isClockwise||(dAB=dist_esm.uAR-dAB);if(tempC.setTo(center).add(dist_esm.l2P.FromAngle(aCA+dAB*(.5*(isClockwise?1:-1))).mul(radius)),dAB>originalArcLength){tempC.rotWith(center,dist_esm.PI);const t=tempB.clone();tempB.setTo(tempA),tempA.setTo(t)}}(handleArc.center,handleArc.radius,tempA,tempB,tempC,handle_dAB,isClockwise),tempA.equals(tempB)&&(tempA.setTo(tempC.clone().addXY(1,1)),tempB.setTo(tempC.clone().subXY(1,1))),a.setTo(tempA),b.setTo(tempB),c.setTo(tempC);const bodyArc=getArcInfo(a,b,c);return{bindings,type:"arc",start:{point:a,handle:terminalsInArrowSpace.start,arrowhead:shape.props.arrowheadStart},end:{point:b,handle:terminalsInArrowSpace.end,arrowhead:shape.props.arrowheadEnd},middle:c,handleArc,bodyArc,isValid:0!==bodyArc.length&&isFinite(bodyArc.center.x)&&isFinite(bodyArc.center.y)}}function getArcInfo(a,b,c){const center=(0,dist_esm.oj6)(a,b,c)??dist_esm.l2P.Med(a,b),radius=dist_esm.l2P.Dist(center,a),sweepFlag=+dist_esm.l2P.Clockwise(a,c,b),ab=((a.y-b.y)**2+(a.x-b.x)**2)**.5,bc=((b.y-c.y)**2+(b.x-c.x)**2)**.5,ca=((c.y-a.y)**2+(c.x-a.x)**2)**.5,theta=2*Math.acos((bc*bc+ca*ca-ab*ab)/(2*bc*ca)),largeArcFlag=+(dist_esm.PI>theta),size=(dist_esm.uAR-theta)*(sweepFlag?1:-1);return{center,radius,size,length:size*radius,largeArcFlag,sweepFlag}}function createRange(a,b){return{min:Math.min(a,b),max:Math.max(a,b)}}function isWithinRange(value,range){return value>=range.min&&value<=range.max}function rangeSize(range){return range.max-range.min}function flipEdgeCrossInPlace(edge){if(!edge)return;const tmp=edge.cross.min;edge.cross.min=-edge.cross.max,edge.cross.max=-tmp,edge.crossTarget=-edge.crossTarget}function flipEdgeValueInPlace(edge){edge&&(edge.value=-edge.value,edge.expanded=null===edge.expanded?null:-edge.expanded)}const ElbowArrowTransform={Identity:{x:1,y:1,transpose:!1},Rotate90:{x:-1,y:1,transpose:!0},Rotate180:{x:-1,y:-1,transpose:!1},Rotate270:{x:1,y:-1,transpose:!0},FlipX:{x:-1,y:1,transpose:!1},FlipY:{x:1,y:-1,transpose:!1}};function swap(object,a,b){const temp=object[a];object[a]=object[b],object[b]=temp}function transformVecInPlace(transform,point){point.x=transform.x*point.x,point.y=transform.y*point.y,transform.transpose&&swap(point,"x","y")}function transformBoxInPlace(transform,box){-1===transform.x&&(box.x=-(box.x+box.width)),-1===transform.y&&(box.y=-(box.y+box.height)),transform.transpose&&(swap(box,"x","y"),swap(box,"width","height"))}function transformEdgesInPlace(transform,edges){-1===transform.x&&(swap(edges,"left","right"),flipEdgeCrossInPlace(edges.top),flipEdgeCrossInPlace(edges.bottom),flipEdgeValueInPlace(edges.left),flipEdgeValueInPlace(edges.right)),-1===transform.y&&(swap(edges,"top","bottom"),flipEdgeCrossInPlace(edges.left),flipEdgeCrossInPlace(edges.right),flipEdgeValueInPlace(edges.top),flipEdgeValueInPlace(edges.bottom)),transform.transpose&&(swap(edges,"left","top"),swap(edges,"right","bottom"))}class ElbowArrowWorkingInfo{options;A;B;common;gapX;gapY;midX;midY;bias;constructor(info){this.options=info.options,this.A=info.A,this.B=info.B,this.common=info.common,this.midX=info.midX,this.midY=info.midY,this.gapX=info.gapX,this.gapY=info.gapY,this.bias=new dist_esm.l2P(1,1)}transform=ElbowArrowTransform.Identity;inverse=ElbowArrowTransform.Identity;apply(transform){if(this.transform=function transformElbowArrowTransform(a,b){const next={...a};return b.transpose&&(swap(next,"x","y"),next.transpose=!next.transpose),-1===b.x&&(next.x=-next.x),-1===b.y&&(next.y=-next.y),next}(transform,this.transform),this.inverse=function invertElbowArrowTransform(transform){return transform.transpose?{x:transform.y,y:transform.x,transpose:!0}:transform}(this.transform),transformBoxInPlace(transform,this.A.original),transformBoxInPlace(transform,this.B.original),transformBoxInPlace(transform,this.common.original),transformBoxInPlace(transform,this.A.expanded),transformBoxInPlace(transform,this.B.expanded),transformBoxInPlace(transform,this.common.expanded),transformEdgesInPlace(transform,this.A.edges),transformEdgesInPlace(transform,this.B.edges),transformVecInPlace(transform,this.bias),-1===transform.x&&(this.gapX=-this.gapX,this.midX=null===this.midX?null:-this.midX),-1===transform.y&&(this.gapY=-this.gapY,this.midY=null===this.midY?null:-this.midY),transform.transpose){let temp=this.midX;this.midX=this.midY,this.midY=temp,temp=this.gapX,this.gapX=this.gapY,this.gapY=temp}}reset(){this.apply(this.inverse)}vec(x,y){const point=new dist_esm.l2P(x,y);return transformVecInPlace(this.inverse,point),point}}class ElbowArrowRouteBuilder{constructor(info,name){this.info=info,this.name=name}points=[];add(x,y){return this.points.push(this.info.vec(x,y)),this}_midpointHandle=null;midpointHandle(axis){(0,dist_esm.vAR)(null===this._midpointHandle,"midX/midY called multiple times");const point=dist_esm.l2P.Lrp(this.points[this.points.length-2],this.points[this.points.length-1],.5);return this._midpointHandle={axis:this.info.transform.transpose?"x"===axis?"y":"x":axis,point,segmentStart:this.points[this.points.length-2].clone(),segmentEnd:this.points[this.points.length-1].clone()},this}build(){const finalPoints=[];for(let i=0;i<this.points.length;i++){const p0=this.points[i],p1=finalPoints[finalPoints.length-1],p2=finalPoints[finalPoints.length-2];if(p1&&p2){const d1x=Math.abs(p0.x-p1.x),d1y=Math.abs(p0.y-p1.y),d2x=Math.abs(p0.x-p2.x),d2y=Math.abs(p0.y-p2.y);d1x<.01&&d1y<.01||(d1x<.01&&d2x<.01?p1.y=p0.y:d1y<.01&&d2y<.01?p1.x=p0.x:finalPoints.push(p0))}else finalPoints.push(p0)}return{name:this.name,points:finalPoints,distance:measureRouteManhattanDistance(finalPoints),aEdgePicking:"manual",bEdgePicking:"manual",skipPointsWhenDrawing:new Set,midpointHandle:this._midpointHandle}}}function measureRouteManhattanDistance(path){let distance=0;for(let i=0;i<path.length-1;i++){const start=path[i],end=path[i+1];distance+=Math.abs(end.x-start.x)+Math.abs(end.y-start.y)}return distance}function routeRightToLeft(info){const aEdge=info.A.edges.right,bEdge=info.B.edges.left;if(!aEdge||!bEdge)return null;if(aEdge.crossTarget>bEdge.crossTarget&&info.apply(ElbowArrowTransform.FlipY),info.gapX>0&&null!==info.midX)return new ElbowArrowRouteBuilder(info,"to left 1").add(aEdge.value,aEdge.crossTarget).add(info.midX,aEdge.crossTarget).add(info.midX,bEdge.crossTarget).midpointHandle("x").add(bEdge.value,bEdge.crossTarget).build();if(null===aEdge.expanded||null===bEdge.expanded)return null;if(null!==info.midY)return new ElbowArrowRouteBuilder(info,"to left 2").add(aEdge.value,aEdge.crossTarget).add(aEdge.expanded,aEdge.crossTarget).add(aEdge.expanded,info.midY).add(bEdge.expanded,info.midY).midpointHandle("y").add(bEdge.expanded,bEdge.crossTarget).add(bEdge.value,bEdge.crossTarget).build();const arrow3Distance=Math.abs(aEdge.value-info.common.expanded.right)+Math.abs(aEdge.crossTarget-info.common.expanded.bottom)+Math.abs(info.common.expanded.right-bEdge.expanded)+Math.abs(info.common.expanded.bottom-bEdge.crossTarget)+info.options.expandElbowLegLength+6,arrow4Distance=info.options.expandElbowLegLength+Math.abs(aEdge.crossTarget-info.common.expanded.top)+Math.abs(aEdge.expanded-info.common.expanded.left)+Math.abs(info.common.expanded.top-bEdge.crossTarget)+Math.abs(info.common.expanded.left-bEdge.value)+6+info.bias.y,arrow5Distance=info.gapX<0&&null!==info.midX?info.options.expandElbowLegLength+Math.abs(aEdge.crossTarget-info.A.expanded.bottom)+info.common.expanded.width+Math.abs(info.A.expanded.bottom-info.B.expanded.top)+Math.abs(info.B.expanded.top-bEdge.crossTarget)+info.options.expandElbowLegLength+8:1/0;return arrow3Distance<arrow4Distance&&arrow3Distance<arrow5Distance?new ElbowArrowRouteBuilder(info,"to left 3").add(aEdge.value,aEdge.crossTarget).add(info.common.expanded.right,aEdge.crossTarget).add(info.common.expanded.right,info.common.expanded.bottom).add(bEdge.expanded,info.common.expanded.bottom).add(bEdge.expanded,bEdge.crossTarget).add(bEdge.value,bEdge.crossTarget).build():arrow4Distance<arrow5Distance?new ElbowArrowRouteBuilder(info,"to left 4").add(aEdge.value,aEdge.crossTarget).add(aEdge.expanded,aEdge.crossTarget).add(aEdge.expanded,info.common.expanded.top).add(info.common.expanded.left,info.common.expanded.top).add(info.common.expanded.left,bEdge.crossTarget).add(bEdge.value,bEdge.crossTarget).build():null!==info.midX?new ElbowArrowRouteBuilder(info,"to left 5").add(aEdge.value,aEdge.crossTarget).add(aEdge.expanded,aEdge.crossTarget).add(aEdge.expanded,info.A.expanded.bottom).add(info.midX,info.A.expanded.bottom).add(info.midX,info.B.expanded.top).midpointHandle("y").add(bEdge.expanded,info.B.expanded.top).add(bEdge.expanded,bEdge.crossTarget).add(bEdge.value,bEdge.crossTarget).build():null}function routeRightToTop(info){const aEdge=info.A.edges.right,bEdge=info.B.edges.top;if(!aEdge||!bEdge)return null;if(aEdge.crossTarget<(bEdge.expanded??bEdge.value)&&bEdge.crossTarget>(aEdge.expanded??aEdge.value)||info.A.isPoint&&info.B.expanded.containsPoint(info.A.original.center))return new ElbowArrowRouteBuilder(info,"to top 1").add(aEdge.value,aEdge.crossTarget).add(bEdge.crossTarget,aEdge.crossTarget).add(bEdge.crossTarget,bEdge.value).build();if(info.gapX>0&&null!==info.midX&&null!==bEdge.expanded)return new ElbowArrowRouteBuilder(info,"to top 2").add(aEdge.value,aEdge.crossTarget).add(info.midX,aEdge.crossTarget).add(info.midX,bEdge.expanded).midpointHandle("x").add(bEdge.crossTarget,bEdge.expanded).add(bEdge.crossTarget,bEdge.value).build();if(info.gapY>0&&null!==aEdge.expanded&&bEdge.crossTarget<aEdge.expanded&&null!==info.midY)return new ElbowArrowRouteBuilder(info,"to top 3").add(aEdge.value,aEdge.crossTarget).add(aEdge.expanded,aEdge.crossTarget).add(aEdge.expanded,info.midY).add(bEdge.crossTarget,info.midY).midpointHandle("y").add(bEdge.crossTarget,bEdge.value).build();const arrow4Length=Math.abs(aEdge.value-info.common.expanded.right)+Math.abs(aEdge.crossTarget-info.common.expanded.top)+Math.abs(bEdge.crossTarget-info.common.expanded.right)+Math.abs(bEdge.value-info.common.expanded.top),arrow5Length=null!==aEdge.expanded&&null!==info.midY&&null!==bEdge.expanded?Math.abs(aEdge.value-aEdge.expanded)+Math.abs(info.B.expanded.left-aEdge.expanded)+Math.abs(info.B.expanded.left-bEdge.crossTarget)+Math.abs(aEdge.crossTarget-info.B.expanded.top)+Math.abs(bEdge.value-bEdge.expanded):1/0,arrow6Length=null!==aEdge.expanded&&null!==info.midX&&null!==bEdge.expanded?Math.abs(aEdge.value-info.common.expanded.right)+Math.abs(aEdge.crossTarget-info.A.expanded.bottom)+Math.abs(aEdge.expanded-bEdge.crossTarget)+Math.abs(info.A.expanded.bottom-bEdge.expanded)+Math.abs(bEdge.expanded-bEdge.value):1/0;return arrow4Length<arrow5Length&&arrow4Length<arrow6Length?new ElbowArrowRouteBuilder(info,"to top 4").add(aEdge.value,aEdge.crossTarget).add(info.common.expanded.right,aEdge.crossTarget).add(info.common.expanded.right,info.common.expanded.top).add(bEdge.crossTarget,info.common.expanded.top).add(bEdge.crossTarget,bEdge.value).build():null!==bEdge.expanded&&null!==aEdge.expanded&&null!==info.midY&&arrow5Length<arrow6Length?new ElbowArrowRouteBuilder(info,"to top 5").add(aEdge.value,aEdge.crossTarget).add(aEdge.expanded,aEdge.crossTarget).add(aEdge.expanded,info.midY).add(info.B.expanded.left,info.midY).midpointHandle("y").add(info.B.expanded.left,bEdge.expanded).add(bEdge.crossTarget,bEdge.expanded).add(bEdge.crossTarget,bEdge.value).build():null!==bEdge.expanded&&null!==aEdge.expanded&&null!==info.midX?new ElbowArrowRouteBuilder(info,"to top 6").add(aEdge.value,aEdge.crossTarget).add(aEdge.expanded,aEdge.crossTarget).add(aEdge.expanded,info.A.expanded.bottom).add(info.midX,info.A.expanded.bottom).add(info.midX,bEdge.expanded).midpointHandle("x").add(bEdge.crossTarget,bEdge.expanded).add(bEdge.crossTarget,bEdge.value).build():null}function routeRightToBottom(info){return info.apply(ElbowArrowTransform.FlipY),routeRightToTop(info)}function routeRightToRight(info){const aEdge=info.A.edges.right,bEdge=info.B.edges.right;if(!aEdge||!bEdge)return null;if((info.gapX<=0||aEdge.crossTarget>info.B.expanded.bottom||aEdge.crossTarget<info.B.expanded.top)&&(bEdge.value>info.A.original.left||bEdge.crossTarget>info.A.expanded.bottom||bEdge.crossTarget<info.A.expanded.top))return new ElbowArrowRouteBuilder(info,"to right 1").add(aEdge.value,aEdge.crossTarget).add(info.common.expanded.right,aEdge.crossTarget).add(info.common.expanded.right,bEdge.crossTarget).add(bEdge.value,bEdge.crossTarget).build();if(null===info.midX)return null;if(null!==bEdge.expanded&&info.gapX>=0){const topOrBottom=Math.abs(bEdge.crossTarget-info.B.expanded.bottom)+Math.abs(aEdge.crossTarget-info.B.expanded.bottom)<Math.abs(bEdge.crossTarget-info.B.expanded.top)+Math.abs(aEdge.crossTarget-info.B.expanded.top)?"bottom":"top";return new ElbowArrowRouteBuilder(info,`to right 2 via ${topOrBottom}`).add(aEdge.value,aEdge.crossTarget).add(info.midX,aEdge.crossTarget).add(info.midX,info.B.expanded[topOrBottom]).midpointHandle("x").add(bEdge.expanded,info.B.expanded[topOrBottom]).add(bEdge.expanded,bEdge.crossTarget).add(bEdge.value,bEdge.crossTarget).build()}if(null!==aEdge.expanded&&info.gapX<=0){const topOrBottom=Math.abs(bEdge.crossTarget-info.A.expanded.bottom)+Math.abs(aEdge.crossTarget-info.A.expanded.bottom)<Math.abs(bEdge.crossTarget-info.A.expanded.top)+Math.abs(aEdge.crossTarget-info.A.expanded.top)?"bottom":"top";return new ElbowArrowRouteBuilder(info,`to right 3 via ${topOrBottom}`).add(aEdge.value,aEdge.crossTarget).add(aEdge.expanded,aEdge.crossTarget).add(aEdge.expanded,info.A.expanded[topOrBottom]).add(info.midX,info.A.expanded[topOrBottom]).add(info.midX,bEdge.crossTarget).midpointHandle("x").add(bEdge.value,bEdge.crossTarget).build()}return null}const routes={top:{top:[ElbowArrowTransform.Rotate270,routeRightToRight],left:[ElbowArrowTransform.Rotate270,routeRightToTop],bottom:[ElbowArrowTransform.Rotate270,routeRightToLeft],right:[ElbowArrowTransform.Rotate270,routeRightToBottom]},right:{top:[ElbowArrowTransform.Identity,routeRightToTop],right:[ElbowArrowTransform.Identity,routeRightToRight],bottom:[ElbowArrowTransform.Identity,routeRightToBottom],left:[ElbowArrowTransform.Identity,routeRightToLeft]},bottom:{top:[ElbowArrowTransform.Rotate90,routeRightToLeft],left:[ElbowArrowTransform.Rotate90,routeRightToBottom],bottom:[ElbowArrowTransform.Rotate90,routeRightToRight],right:[ElbowArrowTransform.Rotate90,routeRightToTop]},left:{top:[ElbowArrowTransform.Rotate180,routeRightToBottom],left:[ElbowArrowTransform.Rotate180,routeRightToRight],bottom:[ElbowArrowTransform.Rotate180,routeRightToTop],right:[ElbowArrowTransform.Rotate180,routeRightToLeft]}};function tryRouteArrow(info,aEdge,bEdge){const[transform,routeFn]=routes[aEdge][bEdge];info.apply(transform);const route=routeFn(info);return info.reset(),route}function pickBest(info,edges){let bestRoute=null,bestCornerCount=1/0,bestDistance=1/0,distanceBias=0;for(const[aSide,bSide,aEdgePicking,bEdgePicking]of edges){distanceBias+=1;const route=tryRouteArrow(info,aSide,bSide);route&&(route.aEdgePicking=aEdgePicking,route.bEdgePicking=bEdgePicking,route.points.length<bestCornerCount?(bestCornerCount=route.points.length,bestDistance=route.distance,bestRoute=route):route.points.length===bestCornerCount&&route.distance+distanceBias<bestDistance&&(bestDistance=route.distance,bestRoute=route))}return bestRoute}function getElbowArrowInfo(editor,arrow,bindings){const shapeOptions=editor.getShapeUtil(arrow.type).options,options={elbowMidpoint:arrow.props.elbowMidPoint,expandElbowLegLength:shapeOptions.expandElbowLegLength[arrow.props.size]*arrow.props.scale,minElbowLegLength:shapeOptions.minElbowLegLength[arrow.props.size]*arrow.props.scale};let startTerminal=getElbowArrowTerminalInfo(editor,arrow,bindings.start,arrow.props.start),endTerminal=getElbowArrowTerminalInfo(editor,arrow,bindings.end,arrow.props.end);startTerminal=adjustTerminalForUnclosedPathIfNeeded(startTerminal,endTerminal,options),endTerminal=adjustTerminalForUnclosedPathIfNeeded(endTerminal,startTerminal,options);const swapOrder=!(startTerminal.side||!endTerminal.side);let{aTerminal,bTerminal}=swapOrder?{aTerminal:endTerminal,bTerminal:startTerminal}:{aTerminal:startTerminal,bTerminal:endTerminal},edgesA={top:getUsableEdge(aTerminal,bTerminal,"top",options),right:getUsableEdge(aTerminal,bTerminal,"right",options),bottom:getUsableEdge(aTerminal,bTerminal,"bottom",options),left:getUsableEdge(aTerminal,bTerminal,"left",options)},edgesB={top:getUsableEdge(bTerminal,aTerminal,"top",options),right:getUsableEdge(bTerminal,aTerminal,"right",options),bottom:getUsableEdge(bTerminal,aTerminal,"bottom",options),left:getUsableEdge(bTerminal,aTerminal,"left",options)};const aIsUsable=hasUsableEdge(edgesA,aTerminal.side),bIsUsable=hasUsableEdge(edgesB,bTerminal.side);let needsNewEdges=!1;aIsUsable&&bIsUsable||(needsNewEdges=!0,aIsUsable||(bTerminal=convertTerminalToPoint(bTerminal)),bIsUsable||(aTerminal=convertTerminalToPoint(aTerminal)),bTerminal.bounds.containsPoint(aTerminal.target,options.expandElbowLegLength)&&(bTerminal=convertTerminalToPoint(bTerminal)),aTerminal.bounds.containsPoint(bTerminal.target,options.expandElbowLegLength)&&(aTerminal=convertTerminalToPoint(aTerminal))),needsNewEdges&&(edgesA={top:getUsableEdge(aTerminal,bTerminal,"top",options),right:getUsableEdge(aTerminal,bTerminal,"right",options),bottom:getUsableEdge(aTerminal,bTerminal,"bottom",options),left:getUsableEdge(aTerminal,bTerminal,"left",options)},edgesB={top:getUsableEdge(bTerminal,aTerminal,"top",options),right:getUsableEdge(bTerminal,aTerminal,"right",options),bottom:getUsableEdge(bTerminal,aTerminal,"bottom",options),left:getUsableEdge(bTerminal,aTerminal,"left",options)});const expandedA=aTerminal.isPoint?aTerminal.bounds:aTerminal.bounds.clone().expandBy(options.expandElbowLegLength),expandedB=bTerminal.isPoint?bTerminal.bounds:bTerminal.bounds.clone().expandBy(options.expandElbowLegLength),common={original:dist_esm.azJ.Common([aTerminal.bounds,bTerminal.bounds]),expanded:dist_esm.azJ.Common([expandedA,expandedB])};let gapX=bTerminal.bounds.minX-aTerminal.bounds.maxX;gapX<0&&(gapX=aTerminal.bounds.minX-bTerminal.bounds.maxX,gapX<0&&(gapX=0),gapX=-gapX);let gapY=bTerminal.bounds.minY-aTerminal.bounds.maxY;gapY<0&&(gapY=aTerminal.bounds.minY-bTerminal.bounds.maxY,gapY<0&&(gapY=0),gapY=-gapY);const aMinLength=3*aTerminal.minEndSegmentLength,bMinLength=3*bTerminal.minEndSegmentLength,minLegDistanceNeeded=(aTerminal.isPoint?aMinLength:options.minElbowLegLength)+(bTerminal.isPoint?bMinLength:options.minElbowLegLength);let mxRange=null;gapX>minLegDistanceNeeded?mxRange={a:aTerminal.isPoint?aTerminal.bounds.maxX+aMinLength:expandedA.maxX,b:bTerminal.isPoint?bTerminal.bounds.minX-bMinLength:expandedB.minX}:gapX<-minLegDistanceNeeded&&(mxRange={a:aTerminal.isPoint?aTerminal.bounds.minX-aMinLength:expandedA.minX,b:bTerminal.isPoint?bTerminal.bounds.maxX+bMinLength:expandedB.maxX});let myRange=null;gapY>minLegDistanceNeeded?myRange={a:aTerminal.isPoint?aTerminal.bounds.maxY+aMinLength:expandedA.maxY,b:bTerminal.isPoint?bTerminal.bounds.minY-bMinLength:expandedB.minY}:gapY<-minLegDistanceNeeded&&(myRange={a:aTerminal.isPoint?aTerminal.bounds.minY-aMinLength:expandedA.minY,b:bTerminal.isPoint?bTerminal.bounds.maxY+bMinLength:expandedB.maxY});const midpoint=swapOrder?1-options.elbowMidpoint:options.elbowMidpoint,mx=mxRange?(0,dist_esm.CcK)(mxRange.a,mxRange.b,midpoint):null,my=myRange?(0,dist_esm.CcK)(myRange.a,myRange.b,midpoint):null,info={options,swapOrder,A:{isPoint:aTerminal.isPoint,target:aTerminal.target,isExact:aTerminal.isExact,arrowheadOffset:aTerminal.arrowheadOffset,minEndSegmentLength:aTerminal.minEndSegmentLength,original:aTerminal.bounds,expanded:expandedA,edges:edgesA,geometry:aTerminal.geometry},B:{isPoint:bTerminal.isPoint,target:bTerminal.target,isExact:bTerminal.isExact,arrowheadOffset:bTerminal.arrowheadOffset,minEndSegmentLength:bTerminal.minEndSegmentLength,original:bTerminal.bounds,expanded:expandedB,edges:edgesB,geometry:bTerminal.geometry},common,gapX,gapY,midX:mx,midY:my},workingInfo=new ElbowArrowWorkingInfo(info),aSide=getSideToUse(aTerminal,bTerminal,info.A.edges),bSide=getSideToUse(bTerminal,aTerminal,info.B.edges);let route;return aSide&&bSide?route=function routeArrowWithManualEdgePicking(info,aSide,bSide){const route=tryRouteArrow(info,aSide,bSide);return route||(info.A.isPoint&&info.B.isPoint?pickBest(info,[[ElbowArrowSideOpposites[aSide],ElbowArrowSideOpposites[bSide],"manual","manual"],[aSide,ElbowArrowSideOpposites[bSide],"manual","auto"],[ElbowArrowSideOpposites[aSide],bSide,"auto","manual"]]):info.A.isPoint?tryRouteArrow(info,ElbowArrowSideOpposites[aSide],bSide):info.B.isPoint?tryRouteArrow(info,aSide,ElbowArrowSideOpposites[bSide]):null)}(workingInfo,aSide,bSide):aSide&&!bSide&&(route=function routeArrowWithPartialEdgePicking(info,aSide){let idealRoute=null;const aRight=info.A.edges.right,aLeft=info.A.edges.left,bTop=info.B.edges.top,bBottom=info.B.edges.bottom;switch(aSide){case"right":info.gapX>0&&info.gapX>Math.abs(info.gapY)&&null!==info.midX?idealRoute=tryRouteArrow(info,"right","left"):aRight&&bTop&&(aRight.expanded??aRight.value)<=bTop.crossTarget&&aRight.crossTarget<=(bTop.expanded??bTop.value)?idealRoute=tryRouteArrow(info,"right","top"):aRight&&bBottom&&(aRight.expanded??aRight.value)<=bBottom.crossTarget&&aRight.crossTarget>=(bBottom.expanded??bBottom.value)&&(idealRoute=tryRouteArrow(info,"right","bottom"));break;case"left":info.gapX<0&&Math.abs(info.gapX)>Math.abs(info.gapY)&&null!==info.midX?idealRoute=tryRouteArrow(info,"left","right"):aLeft&&bTop&&(aLeft.expanded??aLeft.value)>=bTop.crossTarget&&aLeft.crossTarget<=(bTop.expanded??bTop.value)?idealRoute=tryRouteArrow(info,"left","top"):aLeft&&bBottom&&(aLeft.expanded??aLeft.value)>=bBottom.crossTarget&&aLeft.crossTarget>=(bBottom.expanded??bBottom.value)&&(idealRoute=tryRouteArrow(info,"left","bottom"));break;case"top":case"bottom":break;default:(0,dist_esm.h6G)(aSide)}if(idealRoute)return idealRoute.aEdgePicking="manual",idealRoute.bEdgePicking="auto",idealRoute;switch(aSide){case"top":return pickBest(info,[["top","bottom","manual","auto"],["top","right","manual","auto"],["top","left","manual","auto"],["top","top","manual","auto"]]);case"bottom":return pickBest(info,[["bottom","top","manual","auto"],["bottom","right","manual","auto"],["bottom","left","manual","auto"],["bottom","bottom","manual","auto"]]);case"left":return pickBest(info,[["left","right","manual","auto"],["left","bottom","manual","auto"],["left","left","manual","auto"],["left","top","manual","auto"]]);case"right":return pickBest(info,[["right","left","manual","auto"],["right","bottom","manual","auto"],["right","right","manual","auto"],["right","top","manual","auto"]])}}(workingInfo,aSide)),route||(route=function routeArrowWithAutoEdgePicking(info,reason){let idealRoute=null;if(Math.abs(info.gapX)+1>Math.abs(info.gapY)&&null!==info.midX)idealRoute=info.gapX>0?tryRouteArrow(info,"right","left"):tryRouteArrow(info,"left","right");else{const aRight=info.A.edges.right,aLeft=info.A.edges.left,bTop=info.B.edges.top,bBottom=info.B.edges.bottom;info.A.isPoint&&info.B.isPoint?idealRoute=info.gapY>0?tryRouteArrow(info,"bottom","top"):tryRouteArrow(info,"top","bottom"):aRight&&bTop&&(aRight.expanded??aRight.value)<=bTop.crossTarget&&aRight.crossTarget<=(bTop.expanded??bTop.value)?idealRoute=tryRouteArrow(info,"right","top"):aRight&&bBottom&&(aRight.expanded??aRight.value)<=bBottom.crossTarget&&aRight.crossTarget>=(bBottom.expanded??bBottom.value)?idealRoute=tryRouteArrow(info,"right","bottom"):aLeft&&bTop&&(aLeft.expanded??aLeft.value)>=bTop.crossTarget&&aLeft.crossTarget<=(bTop.expanded??bTop.value)?idealRoute=tryRouteArrow(info,"left","top"):aLeft&&bBottom&&(aLeft.expanded??aLeft.value)>=bBottom.crossTarget&&aLeft.crossTarget>=(bBottom.expanded??bBottom.value)?idealRoute=tryRouteArrow(info,"left","bottom"):info.gapY>0&&null!==info.midY?idealRoute=tryRouteArrow(info,"bottom","top"):info.gapY<0&&null!==info.midY&&(idealRoute=tryRouteArrow(info,"top","bottom"))}if(idealRoute)return idealRoute.aEdgePicking=reason,idealRoute.bEdgePicking=reason,idealRoute;const aAvailableSide=ElbowArrowSides.filter((side=>info.A.edges[side])),bAvailableSides=ElbowArrowSides.filter((side=>info.B.edges[side])),nonPartialRouteCandidates=aAvailableSide.flatMap((aSide=>bAvailableSides.map((bSide=>[aSide,bSide,reason,reason]))));return pickBest(info,nonPartialRouteCandidates)}(workingInfo,aSide||bSide?"fallback":"auto")),route&&(castPathSegmentIntoGeometry("first",info.A,info.B,route),castPathSegmentIntoGeometry("last",info.B,info.A,route),function fixTinyEndNubs(route,aTerminal,bTerminal){if(!route)return;if(route.points.length>=3){const a=route.points[0],b=route.points[1];if(dist_esm.l2P.ManhattanDist(a,b)<aTerminal.minEndSegmentLength&&(route.points.splice(1,1),route.points.length>=3)){const matchAxis=(0,dist_esm.YY0)(a.x,b.x)?"y":"x";route.points[1][matchAxis]=a[matchAxis]}}if(route.points.length>=3){const a=route.points[route.points.length-1],b=route.points[route.points.length-2];if(dist_esm.l2P.ManhattanDist(a,b)<bTerminal.minEndSegmentLength&&(route.points.splice(route.points.length-2,1),route.points.length>=3)){const matchAxis=(0,dist_esm.YY0)(a.x,b.x)?"y":"x";route.points[route.points.length-2][matchAxis]=a[matchAxis]}}}(route,aTerminal,bTerminal),swapOrder&&route.points.reverse()),{...info,route,midXRange:mxRange?swapOrder?{lo:mxRange.b,hi:mxRange.a}:{lo:mxRange.a,hi:mxRange.b}:null,midYRange:myRange?swapOrder?{lo:myRange.b,hi:myRange.a}:{lo:myRange.a,hi:myRange.b}:null}}function getElbowArrowTerminalInfo(editor,arrow,binding,point){const arrowStrokeSize=STROKE_SIZES[arrow.props.size]*arrow.props.scale/2,minEndSegmentLength=arrowStrokeSize*arrow.props.scale*3;if(binding){const target=editor.getShape(binding.toId),geometry=function getBindingGeometryInArrowSpace(editor,arrow,targetId,bindingProps){const hasArrowhead="start"===bindingProps.terminal?"none"!==arrow.props.arrowheadStart:"none"!==arrow.props.arrowheadEnd,targetGeometryInTargetSpace=editor.getShapeGeometry(targetId,hasArrowhead?void 0:{context:"@tldraw/arrow-without-arrowhead"});if(!targetGeometryInTargetSpace)return null;const arrowTransform=editor.getShapePageTransform(arrow.id),shapeTransform=editor.getShapePageTransform(targetId),shapeToArrowTransform=arrowTransform.clone().invert().multiply(shapeTransform),targetGeometryInArrowSpace=targetGeometryInTargetSpace.transform(shapeToArrowTransform),center={x:.5,y:.5},normalizedAnchor=bindingProps.isPrecise?bindingProps.normalizedAnchor:center,targetInShapeSpace={x:(0,dist_esm.CcK)(targetGeometryInTargetSpace.bounds.minX,targetGeometryInTargetSpace.bounds.maxX,normalizedAnchor.x),y:(0,dist_esm.CcK)(targetGeometryInTargetSpace.bounds.minY,targetGeometryInTargetSpace.bounds.maxY,normalizedAnchor.y)},centerInShapeSpace={x:(0,dist_esm.CcK)(targetGeometryInTargetSpace.bounds.minX,targetGeometryInTargetSpace.bounds.maxX,center.x),y:(0,dist_esm.CcK)(targetGeometryInTargetSpace.bounds.minY,targetGeometryInTargetSpace.bounds.maxY,center.y)},targetInArrowSpace=dist_esm.V8r.applyToPoint(shapeToArrowTransform,targetInShapeSpace),centerInArrowSpace=dist_esm.V8r.applyToPoint(shapeToArrowTransform,centerInShapeSpace);return{bounds:targetGeometryInArrowSpace.bounds,geometry:targetGeometryInArrowSpace,target:targetInArrowSpace,center:centerInArrowSpace,shapeToArrowTransform}}(editor,arrow,binding.toId,binding.props);if(geometry&&target){let arrowheadOffset=0;const arrowheadProp="start"===binding.props.terminal?"arrowheadStart":"arrowheadEnd";if("none"!==arrow.props[arrowheadProp]){const targetScale="scale"in target.props?target.props.scale:1;arrowheadOffset=arrowStrokeSize+("size"in target.props?(STROKE_SIZES[target.props.size]??0)*targetScale/2:0)+BOUND_ARROW_OFFSET*arrow.props.scale}let side=null;const targetPoint=geometry.target;return binding.props.isPrecise&&(side=function getEdgeFromNormalizedAnchor(normalizedAnchor){return(0,dist_esm.YY0)(normalizedAnchor.x,.5)&&(0,dist_esm.YY0)(normalizedAnchor.y,.5)?null:Math.abs(normalizedAnchor.x-.5)>Math.abs(normalizedAnchor.y-.5)-1e-4?normalizedAnchor.x<.5?"left":"right":normalizedAnchor.y<.5?"top":"bottom"}(dist_esm.l2P.RotWith(binding.props.normalizedAnchor,{x:.5,y:.5},geometry.shapeToArrowTransform.rotation()))),{targetShapeId:binding.toId,isPoint:!1,isExact:binding.props.isExact,bounds:geometry.bounds,geometry:geometry.geometry,target:targetPoint,arrowheadOffset,minEndSegmentLength,side,snap:binding.props.snap}}}return{targetShapeId:null,bounds:dist_esm.azJ.FromCenter(point,{x:0,y:0}),geometry:null,isExact:!1,isPoint:!0,target:dist_esm.l2P.From(point),arrowheadOffset:0,minEndSegmentLength,side:null,snap:"none"}}const sideProps={top:{expand:-1,main:"minY",opposite:"maxY",crossMid:"midX",crossMin:"minX",crossMax:"maxX",bRangeExpand:"max",crossAxis:"x"},bottom:{expand:1,main:"maxY",opposite:"minY",crossMid:"midX",crossMin:"minX",crossMax:"maxX",bRangeExpand:"min",crossAxis:"x"},left:{expand:-1,main:"minX",opposite:"maxX",crossMid:"midY",crossMin:"minY",crossMax:"maxY",bRangeExpand:"max",crossAxis:"y"},right:{expand:1,main:"maxX",opposite:"minX",crossMid:"midY",crossMin:"minY",crossMax:"maxY",bRangeExpand:"min",crossAxis:"y"}};function getUsableEdge(a,b,side,options){const props=sideProps[side],isSelfBoundAndShouldRouteExternal=!(a.targetShapeId!==b.targetShapeId||null===a.targetShapeId||"edge"!==a.snap&&"edge-point"!==a.snap||"edge"!==b.snap&&"edge-point"!==b.snap),aValue=a.bounds[props.main],aExpanded=a.isPoint?null:aValue+props.expand*options.expandElbowLegLength,originalACrossRange=createRange(a.bounds[props.crossMin],a.bounds[props.crossMax]);let aCrossRange=originalACrossRange;if(!aCrossRange)return null;(0,dist_esm.vAR)(originalACrossRange);const bRange=createRange(b.bounds[props.main],b.bounds[props.opposite]);b.isPoint||(bRange[props.bRangeExpand]-=2*options.minElbowLegLength*props.expand);const bCrossRange=function expandRange(range,amount){const newRange={min:range.min-amount,max:range.max+amount};return newRange.min>newRange.max?null:newRange}(createRange(b.bounds[props.crossMin],b.bounds[props.crossMax]),options.expandElbowLegLength);(0,dist_esm.vAR)(bRange&&bCrossRange);let isPartial=!1;if(isWithinRange(aValue,bRange)&&!a.isPoint&&!b.isPoint&&!isSelfBoundAndShouldRouteExternal){const subtracted=function subtractRange(a,b){return(0,dist_esm.vAR)(a.min<=a.max&&b.min<=b.max),a.min<=b.min&&b.max<=a.max?[{min:a.min,max:b.min},{min:b.max,max:a.max}]:b.max<=a.min||b.min>=a.max?[a]:b.min<=a.min&&a.max<=b.max?[]:isWithinRange(a.min,b)?[{min:b.max,max:a.max}]:isWithinRange(a.max,b)?[{min:a.min,max:b.min}]:[]}(aCrossRange,bCrossRange);switch(subtracted.length){case 0:return null;case 1:isPartial=subtracted[0]!==aCrossRange,aCrossRange=subtracted[0];break;case 2:isPartial=!0,aCrossRange=rangeSize(subtracted[0])>rangeSize(subtracted[1])?subtracted[0]:subtracted[1];break;default:(0,dist_esm.h6G)(subtracted)}}if(!isWithinRange(a.target[props.crossAxis],aCrossRange))return null;return{value:aValue,expanded:aExpanded,cross:aCrossRange,crossTarget:a.target[props.crossAxis],isPartial}}function hasUsableEdge(edges,side){return null===side?!!(edges.bottom||edges.left||edges.right||edges.top):"x"===side?!!edges.left||!!edges.right:"y"===side?!!edges.top||!!edges.bottom:!!edges[side]}function getSideToUse(binding,other,edges){switch(binding.side){case null:return null;case"x":return binding.bounds.center.x>other.bounds.center.x&&edges?.left?"left":edges?.right?"right":null;case"y":return binding.bounds.center.y>other.bounds.center.y&&edges?.top?"top":edges?.bottom?"bottom":null;default:return binding.side}}function convertTerminalToPoint(terminal){if(terminal.isPoint)return terminal;let side=null,arrowheadOffset=0;return"edge"!==terminal.snap&&"edge-point"!==terminal.snap||(arrowheadOffset=terminal.arrowheadOffset,"x"!==terminal.side&&"left"!==terminal.side&&"right"!==terminal.side||(side="x"),"y"!==terminal.side&&"top"!==terminal.side&&"bottom"!==terminal.side||(side="y")),{targetShapeId:terminal.targetShapeId,side,bounds:new dist_esm.azJ(terminal.target.x,terminal.target.y,0,0),geometry:terminal.geometry,target:terminal.target,arrowheadOffset,minEndSegmentLength:terminal.minEndSegmentLength,isExact:terminal.isExact,isPoint:!0,snap:terminal.snap}}function castPathSegmentIntoGeometry(segment,target,other,route){if(!target.geometry)return;const point1="first"===segment?route.points[0]:route.points[route.points.length-1],point2="first"===segment?route.points[1]:route.points[route.points.length-2],pointToFindClosestIntersectionTo=target.geometry.isClosed?point2:target.target,initialDistance=dist_esm.l2P.ManhattanDist(point1,pointToFindClosestIntersectionTo);let nearestIntersectionToPoint2=null,nearestDistanceToPoint2=1/0;if(target.isExact)nearestIntersectionToPoint2=target.target;else if(target.geometry){const intersections=target.geometry.intersectLineSegment(point2,target.target,{includeLabels:!1,includeInternal:!1});target.geometry.hitTestPoint(target.target,Math.max(1,target.arrowheadOffset),!0,dist_esm.MI8.EXCLUDE_NON_STANDARD)&&intersections.push(target.target);for(const intersection of intersections){const point2Distance=dist_esm.l2P.ManhattanDist(pointToFindClosestIntersectionTo,intersection);point2Distance<nearestDistanceToPoint2&&(nearestDistanceToPoint2=point2Distance,nearestIntersectionToPoint2=intersection)}}if(nearestIntersectionToPoint2){let offset=target.arrowheadOffset;const currentFinalSegmentLength=dist_esm.l2P.ManhattanDist(point2,nearestIntersectionToPoint2),minLength=2*target.arrowheadOffset;if(currentFinalSegmentLength<minLength){offset=currentFinalSegmentLength-(minLength-target.arrowheadOffset)}offset<target.minEndSegmentLength&&(offset=target.geometry.bounds.containsPoint(other.target)?Math.max(0,offset):-target.arrowheadOffset);let nudgedPoint=nearestIntersectionToPoint2,shouldAddExtraPointForNudge=!1;if(!target.isExact&&0!==offset){const nudged=dist_esm.l2P.Nudge(nearestIntersectionToPoint2,point2,offset);nudgedPoint=nudged,offset<0&&!target.geometry.hitTestPoint(nudged,0,!0,dist_esm.MI8.EXCLUDE_NON_STANDARD)?nudgedPoint=nearestIntersectionToPoint2:(offset<0&&(shouldAddExtraPointForNudge=!0),nudgedPoint=nudged)}const newDistance=dist_esm.l2P.ManhattanDist(point2,nudgedPoint);if(route.distance+=newDistance-initialDistance,point1.x=nudgedPoint.x,point1.y=nudgedPoint.y,shouldAddExtraPointForNudge){const midPoint=dist_esm.l2P.Lrp(point2,point1,.5);route.skipPointsWhenDrawing.add(midPoint),route.points.splice("first"===segment?1:route.points.length-1,0,midPoint)}}}function adjustTerminalForUnclosedPathIfNeeded(terminal,otherTerminal,options){if(!terminal.geometry||terminal.geometry.isClosed)return terminal;const normalizedPointAlongPath=terminal.geometry.uninterpolateAlongEdge(terminal.target,dist_esm.MI8.EXCLUDE_NON_STANDARD),prev=terminal.geometry.interpolateAlongEdge(normalizedPointAlongPath-.01/terminal.geometry.length),normal=terminal.geometry.interpolateAlongEdge(normalizedPointAlongPath+.01/terminal.geometry.length).sub(prev).per().uni(),axis=Math.abs(normal.x)>Math.abs(normal.y)?ElbowArrowAxes.x:ElbowArrowAxes.y;if(terminal.geometry.bounds.containsPoint(otherTerminal.target,options.expandElbowLegLength))return terminal.side=axis.self,convertTerminalToPoint(terminal);const min=axis.v(terminal.target[axis.self]-2*terminal.bounds[axis.size],terminal.target[axis.cross]),max=axis.v(terminal.target[axis.self]+2*terminal.bounds[axis.size],terminal.target[axis.cross]);let furthestIntersectionTowardsMin=null,furthestIntersectionTowardsMinDistance=0,furthestIntersectionTowardsMax=null,furthestIntersectionTowardsMaxDistance=0,side=axis.self;for(const intersection of terminal.geometry.intersectLineSegment(min,max,dist_esm.MI8.EXCLUDE_NON_STANDARD))Math.abs(intersection[axis.self]-terminal.target[axis.self])<1||(intersection[axis.self]<terminal.target[axis.self]?dist_esm.l2P.ManhattanDist(intersection,terminal.target)>furthestIntersectionTowardsMinDistance&&(furthestIntersectionTowardsMinDistance=dist_esm.l2P.ManhattanDist(intersection,terminal.target),furthestIntersectionTowardsMin=intersection):dist_esm.l2P.ManhattanDist(intersection,terminal.target)>furthestIntersectionTowardsMaxDistance&&(furthestIntersectionTowardsMaxDistance=dist_esm.l2P.ManhattanDist(intersection,terminal.target),furthestIntersectionTowardsMax=intersection));return furthestIntersectionTowardsMin&&furthestIntersectionTowardsMax?side=furthestIntersectionTowardsMinDistance>furthestIntersectionTowardsMaxDistance?axis.hiEdge:axis.loEdge:furthestIntersectionTowardsMin&&!furthestIntersectionTowardsMax?side=axis.hiEdge:!furthestIntersectionTowardsMin&&furthestIntersectionTowardsMax&&(side=axis.loEdge),terminal.side=side,terminal}function getBoundShapeInfoForTerminal(editor,arrow,terminalName){const binding=editor.getBindingsFromShape(arrow,"arrow").find((b=>b.props.terminal===terminalName));if(!binding)return;const boundShape=editor.getShape(binding.toId);if(!boundShape)return;const transform=editor.getShapePageTransform(boundShape),hasArrowhead="start"===terminalName?"none"!==arrow.props.arrowheadStart:"none"!==arrow.props.arrowheadEnd,geometry=editor.getShapeGeometry(boundShape,hasArrowhead?void 0:{context:"@tldraw/arrow-without-arrowhead"});return{shape:boundShape,transform,isClosed:geometry.isClosed,isExact:binding.props.isExact,didIntersect:!1,geometry}}function getArrowTerminalInArrowSpace(editor,arrowPageTransform,binding,forceImprecise){const boundShape=editor.getShape(binding.toId);if(boundShape){const{point,size}=editor.getShapeGeometry(boundShape).bounds,shapePoint=dist_esm.l2P.Add(point,dist_esm.l2P.MulV(binding.props.isPrecise||forceImprecise?binding.props.normalizedAnchor:{x:.5,y:.5},size)),pagePoint=dist_esm.V8r.applyToPoint(editor.getShapePageTransform(boundShape),shapePoint);return dist_esm.V8r.applyToPoint(dist_esm.V8r.Inverse(arrowPageTransform),pagePoint)}return new dist_esm.l2P(0,0)}function shared_getArrowBindings(editor,shape){const bindings=editor.getBindingsFromShape(shape,"arrow");return{start:bindings.find((b=>"start"===b.props.terminal)),end:bindings.find((b=>"end"===b.props.terminal))}}const arrowInfoCache=(0,store_dist_esm.uY)("arrow info",((editor,shape)=>{const bindings=shared_getArrowBindings(editor,shape);if("elbow"===shape.props.kind){const elbowInfo=getElbowArrowInfo(editor,shape,bindings);if(!elbowInfo?.route)return getStraightArrowInfo(editor,shape,bindings);const start=elbowInfo.swapOrder?elbowInfo.B:elbowInfo.A,end=elbowInfo.swapOrder?elbowInfo.A:elbowInfo.B;return{type:"elbow",bindings,start:{handle:start.target,point:elbowInfo.route.points[0],arrowhead:shape.props.arrowheadStart},end:{handle:end.target,point:elbowInfo.route.points[elbowInfo.route.points.length-1],arrowhead:shape.props.arrowheadEnd},elbow:elbowInfo,route:elbowInfo.route,isValid:!0}}return function getIsArrowStraight(shape){return"arc"===shape.props.kind&&Math.abs(shape.props.bend)<8*shape.props.scale}(shape)?getStraightArrowInfo(editor,shape,bindings):getCurvedArrowInfo(editor,shape,bindings)}));function shared_getArrowInfo(editor,shape){const id="string"==typeof shape?shape:shape.id;return arrowInfoCache.get(editor,id)}function getArrowTerminalsInArrowSpace(editor,shape,bindings){const arrowPageTransform=editor.getShapePageTransform(shape),boundShapeRelationships=getBoundShapeRelationships(editor,bindings.start?.toId,bindings.end?.toId);return{start:bindings.start?getArrowTerminalInArrowSpace(editor,arrowPageTransform,bindings.start,"double-bound"===boundShapeRelationships||"start-contains-end"===boundShapeRelationships):dist_esm.l2P.From(shape.props.start),end:bindings.end?getArrowTerminalInArrowSpace(editor,arrowPageTransform,bindings.end,"double-bound"===boundShapeRelationships||"end-contains-start"===boundShapeRelationships):dist_esm.l2P.From(shape.props.end)}}function createOrUpdateArrowBinding(editor,arrow,target,props){const arrowId="string"==typeof arrow?arrow:arrow.id,targetId="string"==typeof target?target:target.id,existingMany=editor.getBindingsFromShape(arrowId,"arrow").filter((b=>b.props.terminal===props.terminal));existingMany.length>1&&editor.deleteBindings(existingMany.slice(1));const existing=existingMany[0];existing?editor.updateBinding({...existing,toId:targetId,props}):editor.createBinding({type:"arrow",fromId:arrowId,toId:targetId,props})}function removeArrowBinding(editor,arrow,terminal){const existing=editor.getBindingsFromShape(arrow,"arrow").filter((b=>b.props.terminal===terminal));editor.deleteBindings(existing)}const MIN_ARROW_LENGTH=10,BOUND_ARROW_OFFSET=10,WAY_TOO_BIG_ARROW_BEND_FACTOR=10,STROKE_SIZES={s:2,m:3.5,l:5,xl:10};function getBoundShapeRelationships(editor,startShapeId,endShapeId){if(!startShapeId||!endShapeId)return"safe";if(startShapeId===endShapeId)return"double-bound";const startBounds=editor.getShapePageBounds(startShapeId),endBounds=editor.getShapePageBounds(endShapeId);if(startBounds&&endBounds){if(startBounds.contains(endBounds))return"start-contains-end";if(endBounds.contains(startBounds))return"end-contains-start"}return"safe"}class ArrowBindingUtil extends dist_esm.mbh{static type="arrow";static props=dist_esm.P_i;static migrations=dist_esm.g8l;getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5},snap:"none"}}onAfterCreate({binding}){const arrow=this.editor.getShape(binding.fromId);arrow&&arrowDidUpdate(this.editor,arrow)}onAfterChange({bindingAfter}){const arrow=this.editor.getShape(bindingAfter.fromId);arrow&&arrowDidUpdate(this.editor,arrow)}onAfterChangeFromShape({shapeAfter}){arrowDidUpdate(this.editor,shapeAfter)}onAfterChangeToShape({binding}){reparentArrow(this.editor,binding.fromId)}onBeforeIsolateFromShape({binding}){const arrow=this.editor.getShape(binding.fromId);arrow&&updateArrowTerminal({editor:this.editor,arrow,terminal:binding.props.terminal})}}function reparentArrow(editor,arrowId){const arrow=editor.getShape(arrowId);if(!arrow)return;const bindings=shared_getArrowBindings(editor,arrow),{start,end}=bindings,startShape=start?editor.getShape(start.toId):void 0,endShape=end?editor.getShape(end.toId):void 0,parentPageId=editor.getAncestorPageId(arrow);if(!parentPageId)return;let nextParentId;if(startShape&&endShape)nextParentId=editor.findCommonAncestor([startShape,endShape])??parentPageId;else{if(!startShape&&!endShape)return;{const bindingParentId=(startShape||endShape)?.parentId;nextParentId=bindingParentId&&bindingParentId===arrow.parentId?arrow.parentId:parentPageId}}nextParentId&&nextParentId!==arrow.parentId&&editor.reparentShapes([arrowId],nextParentId);const reparentedArrow=editor.getShape(arrowId);if(!reparentedArrow)throw Error("no reparented arrow");const startSibling=editor.getShapeNearestSibling(reparentedArrow,startShape),endSibling=editor.getShapeNearestSibling(reparentedArrow,endShape);let highestSibling,finalIndex;if(startSibling&&endSibling)highestSibling=startSibling.index>endSibling.index?startSibling:endSibling;else if(startSibling&&!endSibling)highestSibling=startSibling;else{if(!endSibling||startSibling)return;highestSibling=endSibling}const higherSiblings=editor.getSortedChildIdsForParent(highestSibling.parentId).map((id=>editor.getShape(id))).filter((sibling=>sibling.index>highestSibling.index));if(higherSiblings.length){const nextHighestNonArrowSibling=higherSiblings.find((sibling=>"arrow"!==sibling.type));if(reparentedArrow.index>highestSibling.index&&(!nextHighestNonArrowSibling||reparentedArrow.index<nextHighestNonArrowSibling.index))return;finalIndex=(0,dist_esm.HEt)(highestSibling.index,higherSiblings[0].index)}else finalIndex=(0,dist_esm.AQy)(highestSibling.index);finalIndex!==reparentedArrow.index&&editor.updateShapes([{id:arrowId,type:"arrow",index:finalIndex}])}function arrowDidUpdate(editor,arrow){const bindings=shared_getArrowBindings(editor,arrow);for(const handle of["start","end"]){const binding=bindings[handle];if(!binding)continue;const boundShape=editor.getShape(binding.toId),isShapeInSamePageAsArrow=editor.getAncestorPageId(arrow)===editor.getAncestorPageId(boundShape);boundShape&&isShapeInSamePageAsArrow||updateArrowTerminal({editor,arrow,terminal:handle,unbind:!0})}reparentArrow(editor,arrow.id)}function updateArrowTerminal({editor,arrow,terminal,unbind=!1,useHandle=!1}){const info=shared_getArrowInfo(editor,arrow);if(!info)throw new Error("expected arrow info");const startPoint=useHandle?info.start.handle:info.start.point,endPoint=useHandle?info.end.handle:info.end.point,point="start"===terminal?startPoint:endPoint,update={id:arrow.id,type:"arrow",props:{[terminal]:{x:point.x,y:point.y},bend:arrow.props.bend}};if("arc"===info.type){const newStart="start"===terminal?startPoint:info.start.handle,newEnd="end"===terminal?endPoint:info.end.handle,newMidPoint=dist_esm.l2P.Med(newStart,newEnd),lineSegment=dist_esm.l2P.Sub(newStart,newEnd).per().uni().mul(2*info.handleArc.radius*Math.sign(arrow.props.bend)),intersections=(0,dist_esm.vrM)(info.handleArc.center,dist_esm.l2P.Add(newMidPoint,lineSegment),info.handleArc.center,info.handleArc.radius);(0,dist_esm.vAR)(1===intersections?.length);const bend=dist_esm.l2P.Dist(newMidPoint,intersections[0])*Math.sign(arrow.props.bend);(0,dist_esm.YY0)(bend,update.props.bend)||(update.props.bend=bend)}editor.updateShape(update),unbind&&removeArrowBinding(editor,arrow,terminal)}const defaultBindingUtils=[ArrowBindingUtil],TEXT_PROPS={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},default_shape_constants_STROKE_SIZES={s:2,m:3.5,l:5,xl:10},FONT_SIZES={s:18,m:24,l:36,xl:44},LABEL_FONT_SIZES={s:18,m:22,l:26,xl:32},ARROW_LABEL_FONT_SIZES={s:18,m:20,l:24,xl:28},FONT_FAMILIES={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"},LABEL_TO_ARROW_PADDING=20,LABEL_PADDING=16;const getOpacity=opacity=>{const t=opacity/100;return t<.2?.1:t<.4?.25:t<.6?.5:t<.8?.75:1},strokeWidthsToSizes={1:"s",2:"m",3:"l",4:"xl"},fontSizesToSizes={16:"s",20:"m",28:"l",36:"xl"};function getFontSizeAndScale(fontSize){const size=fontSizesToSizes[fontSize];return size?{size,scale:1}:fontSize<16?{size:"s",scale:fontSize/16}:fontSize>36?{size:"xl",scale:fontSize/36}:{size:"m",scale:1}}const fontFamilyToFontType={1:"draw",2:"sans",3:"mono"},oc={gray:["#f8f9fa","#e9ecef","#ced4da","#868e96","#343a40"],red:["#fff5f5","#ffc9c9","#ff8787","#fa5252","#e03131"],pink:["#fff0f6","#fcc2d7","#f783ac","#e64980","#c2255c"],grape:["#f8f0fc","#eebefa","#da77f2","#be4bdb","#9c36b5"],violet:["#f3f0ff","#d0bfff","#9775fa","#7950f2","#6741d9"],indigo:["#edf2ff","#bac8ff","#748ffc","#4c6ef5","#3b5bdb"],blue:["#e7f5ff","#a5d8ff","#4dabf7","#228be6","#1971c2"],cyan:["#e3fafc","#99e9f2","#3bc9db","#15aabf","#0c8599"],teal:["#e6fcf5","#96f2d7","#38d9a9","#12b886","#099268"],green:["#ebfbee","#b2f2bb","#69db7c","#40c057","#2f9e44"],lime:["#f4fce3","#d8f5a2","#a9e34b","#82c91e","#66a80f"],yellow:["#fff9db","#ffec99","#ffd43b","#fab005","#f08c00"],orange:["#fff4e6","#ffd8a8","#ffa94d","#fd7e14","#e8590c"]};function mapExcalidrawColorToTldrawColors(excalidrawColor,light,dark){const colors=[0,1,2,3,4].map((index=>oc[excalidrawColor][index]));return Object.fromEntries(colors.map(((c,i)=>[c,i<3?light:dark])))}const colorsToColors={...mapExcalidrawColorToTldrawColors("gray","grey","black"),...mapExcalidrawColorToTldrawColors("red","light-red","red"),...mapExcalidrawColorToTldrawColors("pink","light-red","red"),...mapExcalidrawColorToTldrawColors("grape","light-violet","violet"),...mapExcalidrawColorToTldrawColors("blue","light-blue","blue"),...mapExcalidrawColorToTldrawColors("cyan","light-blue","blue"),...mapExcalidrawColorToTldrawColors("teal","light-green","green"),...mapExcalidrawColorToTldrawColors("green","light-green","green"),...mapExcalidrawColorToTldrawColors("yellow","yellow","orange"),...mapExcalidrawColorToTldrawColors("orange","yellow","orange"),"#ffffff":"white","#000000":"black"},strokeStylesToStrokeTypes={solid:"draw",dashed:"dashed",dotted:"dotted"},fillStylesToFillType={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},textAlignToAlignTypes={left:"start",center:"middle",right:"end"},textAlignToTextAlignTypes={left:"start",center:"middle",right:"end"},arrowheadsToArrowheadTypes={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function getBend(element,startPoint,endPoint){let bend=0;if(element.points.length>2){const start=new dist_esm.l2P(startPoint[0],startPoint[1]),end=new dist_esm.l2P(endPoint[0],endPoint[1]),handle=new dist_esm.l2P(element.points[1][0],element.points[1][1]),delta=dist_esm.l2P.Sub(end,start),v=dist_esm.l2P.Per(delta),med=dist_esm.l2P.Med(end,start),A=dist_esm.l2P.Sub(med,v),B=dist_esm.l2P.Add(med,v),point=dist_esm.l2P.NearestPointOnLineSegment(A,B,handle,!1);bend=dist_esm.l2P.Dist(point,med),dist_esm.l2P.Clockwise(point,end,med)&&(bend*=-1)}return bend}const getDash=element=>{let dash=strokeStylesToStrokeTypes[element.strokeStyle]??"draw";return"draw"===dash&&0===element.roughness&&(dash="solid"),dash},getFill=element=>"transparent"===element.backgroundColor?"none":fillStylesToFillType[element.fillStyle]??"solid";var core_dist=__webpack_require__("./node_modules/@tiptap/core/dist/index.js");const inputRegex=/(^|[^`])`([^`]+)`(?!`)/,pasteRegex=/(^|[^`])`([^`]+)`(?!`)/g,Code=core_dist.CU.create({name:"code",addOptions:()=>({HTMLAttributes:{}}),excludes:"_",code:!0,exitable:!0,parseHTML:()=>[{tag:"code"}],renderHTML({HTMLAttributes}){return["code",(0,core_dist.KV)(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{setCode:()=>({commands})=>commands.setMark(this.name),toggleCode:()=>({commands})=>commands.toggleMark(this.name),unsetCode:()=>({commands})=>commands.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[(0,core_dist.OX)({find:inputRegex,type:this.type})]},addPasteRules(){return[(0,core_dist.Zc)({find:pasteRegex,type:this.type})]}}),dist_inputRegex=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,dist_pasteRegex=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,Highlight=core_dist.CU.create({name:"highlight",addOptions:()=>({multicolor:!1,HTMLAttributes:{}}),addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:element=>element.getAttribute("data-color")||element.style.backgroundColor,renderHTML:attributes=>attributes.color?{"data-color":attributes.color,style:`background-color: ${attributes.color}; color: inherit`}:{}}}:{}},parseHTML:()=>[{tag:"mark"}],renderHTML({HTMLAttributes}){return["mark",(0,core_dist.KV)(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{setHighlight:attributes=>({commands})=>commands.setMark(this.name,attributes),toggleHighlight:attributes=>({commands})=>commands.toggleMark(this.name,attributes),unsetHighlight:()=>({commands})=>commands.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[(0,core_dist.OX)({find:dist_inputRegex,type:this.type})]},addPasteRules(){return[(0,core_dist.Zc)({find:dist_pasteRegex,type:this.type})]}}),encodedTlds="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0america6xi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mÃ¶gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",encodedUtlds="ÎµÎ»1Ï2Ð±Ð³1ÐµÐ»3Ð´ÐµÑÐ¸4ÐµÑ2ÐºÐ°ÑÐ¾Ð»Ð¸Ðº6Ð¾Ð¼3Ð¼ÐºÐ´2Ð¾Ð½1ÑÐºÐ²Ð°6Ð¾Ð½Ð»Ð°Ð¹Ð½5ÑÐ³3ÑÑÑ2Ñ2ÑÐ°Ð¹Ñ3ÑÐ±3ÑÐºÑ3ÒÐ°Ð·3Õ°Õ¡Õµ3××©×¨××5×§××3Ø§Ø¨ÙØ¸Ø¨Ù5Ø±Ø§ÙÙÙ5ÙØ§Ø±Ø¯Ù4Ø¨Ø­Ø±ÙÙ5Ø¬Ø²Ø§Ø¦Ø±5Ø³Ø¹ÙØ¯ÙØ©6Ø¹ÙÙØ§Ù5ÙØºØ±Ø¨5ÙØ§Ø±Ø§Øª5ÛØ±Ø§Ù5Ø¨Ø§Ø±Øª2Ø²Ø§Ø±4ÙØªÙ3Ú¾Ø§Ø±Øª5ØªÙÙØ³4Ø³ÙØ¯Ø§Ù3Ø±ÙØ©5Ø´Ø¨ÙØ©4Ø¹Ø±Ø§Ù2Ø¨2ÙØ§Ù4ÙÙØ³Ø·ÙÙ6ÙØ·Ø±3ÙØ§Ø«ÙÙÙÙ6ÙÙ3ÙØµØ±2ÙÙØ³ÙØ§5ÙØ±ÙØªØ§ÙÙØ§7ÙØ¹4ÙÙØ±Ø§Ù5Ù¾Ø§Ú©Ø³ØªØ§Ù7ÚØ§Ø±Øª4à¤à¥à¤®3à¤¨à¥à¤3à¤­à¤¾à¤°à¤¤0à¤®à¥3à¥à¤¤5à¤¸à¤à¤à¤ à¤¨5à¦¬à¦¾à¦à¦²à¦¾5à¦­à¦¾à¦°à¦¤2à§°à¦¤4à¨­à¨¾à¨°à¨¤4àª­àª¾àª°àª¤4à¬­à¬¾à¬°à¬¤4à®à®¨à¯à®¤à®¿à®¯à®¾6à®²à®à¯à®à¯6à®à®¿à®à¯à®à®ªà¯à®ªà¯à®°à¯11à°­à°¾à°°à°¤à±5à²­à²¾à²°à²¤4à´­à´¾à´°à´¤à´5à¶½à¶à¶à·4à¸à¸­à¸¡3à¹à¸à¸¢3àº¥àº²àº§3áá2ã¿ããª3ã¢ãã¾ã³4ã¯ã©ã¦ã4ã°ã¼ã°ã«4ã³ã 2ã¹ãã¢3ã»ã¼ã«3ãã¡ãã·ã§ã³6ãã¤ã³ã4ä¸ç2ä¸­ä¿¡1å½1å1æç½3äºé©¬é3ä¼ä¸2ä½å±±2ä¿¡æ¯2å¥åº·2å«å¦2å¬å¸1ç2å°æ¹¾1ç£2åå1åº1æ 2åé0å¤§éåº5å¨çº¿2å¤§æ¿2å¤©ä¸»æ3å¨±ä¹2å®¶é»2å¹¿ä¸2å¾®å2æå2æç±ä½ 3ææº2æè2æ¿å¡1åº2æ°å å¡2é»2æ¶å°2æ¸ç±2æºæ2æ·¡é©¬é¡3æ¸¸æ2æ¾³é2ç¹ç2ç§»å¨2ç»ç»æºæ4ç½å1åº1ç«1ç»2èé2è°·æ­2è´­ç©2éè²©2éå¢2é»è¨çç§4é£å©æµ¦3é£å2é¤å2é¦æ ¼éæ3æ¸¯2ë·ë·1ì»´2ì¼ì±2íêµ­2",linkify_assign=(target,properties)=>{for(const key in properties)target[key]=properties[key];return target},numeric="numeric",ascii="ascii",alpha="alpha",asciinumeric="asciinumeric",alphanumeric="alphanumeric",domain="domain",emoji="emoji",scheme="scheme",slashscheme="slashscheme",whitespace="whitespace";function registerGroup(name,groups){return name in groups||(groups[name]=[]),groups[name]}function addToGroups(t,flags,groups){flags[numeric]&&(flags[asciinumeric]=!0,flags[alphanumeric]=!0),flags[ascii]&&(flags[asciinumeric]=!0,flags[alpha]=!0),flags[asciinumeric]&&(flags[alphanumeric]=!0),flags[alpha]&&(flags[alphanumeric]=!0),flags[alphanumeric]&&(flags[domain]=!0),flags[emoji]&&(flags[domain]=!0);for(const k in flags){const group=registerGroup(k,groups);group.indexOf(t)<0&&group.push(t)}}function State(token=null){this.j={},this.jr=[],this.jd=null,this.t=token}State.groups={},State.prototype={accepts(){return!!this.t},go(input){const state=this,nextState=state.j[input];if(nextState)return nextState;for(let i=0;i<state.jr.length;i++){const regex=state.jr[i][0],nextState=state.jr[i][1];if(nextState&&regex.test(input))return nextState}return state.jd},has(input,exactOnly=!1){return exactOnly?input in this.j:!!this.go(input)},ta(inputs,next,flags,groups){for(let i=0;i<inputs.length;i++)this.tt(inputs[i],next,flags,groups)},tr(regexp,next,flags,groups){let nextState;return groups=groups||State.groups,next&&next.j?nextState=next:(nextState=new State(next),flags&&groups&&addToGroups(next,flags,groups)),this.jr.push([regexp,nextState]),nextState},ts(input,next,flags,groups){let state=this;const len=input.length;if(!len)return state;for(let i=0;i<len-1;i++)state=state.tt(input[i]);return state.tt(input[len-1],next,flags,groups)},tt(input,next,flags,groups){groups=groups||State.groups;const state=this;if(next&&next.j)return state.j[input]=next,next;const t=next;let nextState,templateState=state.go(input);if(templateState?(nextState=new State,linkify_assign(nextState.j,templateState.j),nextState.jr.push.apply(nextState.jr,templateState.jr),nextState.jd=templateState.jd,nextState.t=templateState.t):nextState=new State,t){if(groups)if(nextState.t&&"string"==typeof nextState.t){const allFlags=linkify_assign(function flagsForToken(t,groups){const result={};for(const c in groups)groups[c].indexOf(t)>=0&&(result[c]=!0);return result}(nextState.t,groups),flags);addToGroups(t,allFlags,groups)}else flags&&addToGroups(t,flags,groups);nextState.t=t}return state.j[input]=nextState,nextState}};const ta=(state,input,next,flags,groups)=>state.ta(input,next,flags,groups),tr=(state,regexp,next,flags,groups)=>state.tr(regexp,next,flags,groups),ts=(state,input,next,flags,groups)=>state.ts(input,next,flags,groups),tt=(state,input,next,flags,groups)=>state.tt(input,next,flags,groups),WORD="WORD",UWORD="UWORD",ASCIINUMERICAL="ASCIINUMERICAL",ALPHANUMERICAL="ALPHANUMERICAL",LOCALHOST="LOCALHOST",TLD="TLD",UTLD="UTLD",SCHEME="SCHEME",SLASH_SCHEME="SLASH_SCHEME",NUM="NUM",WS="WS",NL="NL",OPENBRACE="OPENBRACE",CLOSEBRACE="CLOSEBRACE",OPENBRACKET="OPENBRACKET",CLOSEBRACKET="CLOSEBRACKET",OPENPAREN="OPENPAREN",CLOSEPAREN="CLOSEPAREN",OPENANGLEBRACKET="OPENANGLEBRACKET",CLOSEANGLEBRACKET="CLOSEANGLEBRACKET",FULLWIDTHLEFTPAREN="FULLWIDTHLEFTPAREN",FULLWIDTHRIGHTPAREN="FULLWIDTHRIGHTPAREN",LEFTCORNERBRACKET="LEFTCORNERBRACKET",RIGHTCORNERBRACKET="RIGHTCORNERBRACKET",LEFTWHITECORNERBRACKET="LEFTWHITECORNERBRACKET",RIGHTWHITECORNERBRACKET="RIGHTWHITECORNERBRACKET",FULLWIDTHLESSTHAN="FULLWIDTHLESSTHAN",FULLWIDTHGREATERTHAN="FULLWIDTHGREATERTHAN",AMPERSAND="AMPERSAND",APOSTROPHE="APOSTROPHE",ASTERISK="ASTERISK",AT="AT",BACKSLASH="BACKSLASH",BACKTICK="BACKTICK",CARET="CARET",COLON="COLON",COMMA="COMMA",DOLLAR="DOLLAR",DOT="DOT",EQUALS="EQUALS",EXCLAMATION="EXCLAMATION",HYPHEN="HYPHEN",PERCENT="PERCENT",PIPE="PIPE",PLUS="PLUS",POUND="POUND",QUERY="QUERY",QUOTE="QUOTE",FULLWIDTHMIDDLEDOT="FULLWIDTHMIDDLEDOT",SEMI="SEMI",SLASH="SLASH",TILDE="TILDE",UNDERSCORE="UNDERSCORE",EMOJI$1="EMOJI",SYM="SYM";var tk=Object.freeze({__proto__:null,ALPHANUMERICAL,AMPERSAND,APOSTROPHE,ASCIINUMERICAL,ASTERISK,AT,BACKSLASH,BACKTICK,CARET,CLOSEANGLEBRACKET,CLOSEBRACE,CLOSEBRACKET,CLOSEPAREN,COLON,COMMA,DOLLAR,DOT,EMOJI:EMOJI$1,EQUALS,EXCLAMATION,FULLWIDTHGREATERTHAN,FULLWIDTHLEFTPAREN,FULLWIDTHLESSTHAN,FULLWIDTHMIDDLEDOT,FULLWIDTHRIGHTPAREN,HYPHEN,LEFTCORNERBRACKET,LEFTWHITECORNERBRACKET,LOCALHOST,NL,NUM,OPENANGLEBRACKET,OPENBRACE,OPENBRACKET,OPENPAREN,PERCENT,PIPE,PLUS,POUND,QUERY,QUOTE,RIGHTCORNERBRACKET,RIGHTWHITECORNERBRACKET,SCHEME,SEMI,SLASH,SLASH_SCHEME,SYM,TILDE,TLD,UNDERSCORE,UTLD,UWORD,WORD,WS});const ASCII_LETTER=/[a-z]/,LETTER=/\p{L}/u,EMOJI=/\p{Emoji}/u,DIGIT=/\d/,SPACE=/\s/;const CR="\r",LF="\n",EMOJI_VARIATION="ï¸",EMOJI_JOINER="â",OBJECT_REPLACEMENT="ï¿¼";let tlds=null,utlds=null;function run$1(start,str){const iterable=function stringToArray(str){const result=[],len=str.length;let index=0;for(;index<len;){let second,first=str.charCodeAt(index),char=first<55296||first>56319||index+1===len||(second=str.charCodeAt(index+1))<56320||second>57343?str[index]:str.slice(index,index+2);result.push(char),index+=char.length}return result}(str.replace(/[A-Z]/g,(c=>c.toLowerCase()))),charCount=iterable.length,tokens=[];let cursor=0,charCursor=0;for(;charCursor<charCount;){let state=start,nextState=null,tokenLength=0,latestAccepting=null,sinceAccepts=-1,charsSinceAccepts=-1;for(;charCursor<charCount&&(nextState=state.go(iterable[charCursor]));)state=nextState,state.accepts()?(sinceAccepts=0,charsSinceAccepts=0,latestAccepting=state):sinceAccepts>=0&&(sinceAccepts+=iterable[charCursor].length,charsSinceAccepts++),tokenLength+=iterable[charCursor].length,cursor+=iterable[charCursor].length,charCursor++;cursor-=sinceAccepts,charCursor-=charsSinceAccepts,tokenLength-=sinceAccepts,tokens.push({t:latestAccepting.t,v:str.slice(cursor-tokenLength,cursor),s:cursor-tokenLength,e:cursor})}return tokens}function fastts(state,input,t,defaultt,jr){let next;const len=input.length;for(let i=0;i<len-1;i++){const char=input[i];state.j[char]?next=state.j[char]:(next=new State(defaultt),next.jr=jr.slice(),state.j[char]=next),state=next}return next=new State(t),next.jr=jr.slice(),state.j[input[len-1]]=next,next}function decodeTlds(encoded){const words=[],stack=[];let i=0;for(;i<encoded.length;){let popDigitCount=0;for(;"0123456789".indexOf(encoded[i+popDigitCount])>=0;)popDigitCount++;if(popDigitCount>0){words.push(stack.join(""));for(let popCount=parseInt(encoded.substring(i,i+popDigitCount),10);popCount>0;popCount--)stack.pop();i+=popDigitCount}else stack.push(encoded[i]),i++}return words}const defaults={defaultProtocol:"http",events:null,format:noop,formatHref:noop,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Options(opts,defaultRender=null){let o=linkify_assign({},defaults);opts&&(o=linkify_assign(o,opts instanceof Options?opts.o:opts));const ignoredTags=o.ignoreTags,uppercaseIgnoredTags=[];for(let i=0;i<ignoredTags.length;i++)uppercaseIgnoredTags.push(ignoredTags[i].toUpperCase());this.o=o,defaultRender&&(this.defaultRender=defaultRender),this.ignoreTags=uppercaseIgnoredTags}function noop(val){return val}Options.prototype={o:defaults,ignoreTags:[],defaultRender:ir=>ir,check(token){return this.get("validate",token.toString(),token)},get(key,operator,token){const isCallable=null!=operator;let option=this.o[key];return option?("object"==typeof option?(option=token.t in option?option[token.t]:defaults[key],"function"==typeof option&&isCallable&&(option=option(operator,token))):"function"==typeof option&&isCallable&&(option=option(operator,token.t,token)),option):option},getObj(key,operator,token){let obj=this.o[key];return"function"==typeof obj&&null!=operator&&(obj=obj(operator,token.t,token)),obj},render(token){const ir=token.render(this);return(this.get("render",null,token)||this.defaultRender)(ir,token.t,token)}};function MultiToken(value,tokens){this.t="token",this.v=value,this.tk=tokens}function createTokenClass(type,props){class Token extends MultiToken{constructor(value,tokens){super(value,tokens),this.t=type}}for(const p in props)Token.prototype[p]=props[p];return Token.t=type,Token}MultiToken.prototype={isLink:!1,toString(){return this.v},toHref(scheme){return this.toString()},toFormattedString(options){const val=this.toString(),truncate=options.get("truncate",val,this),formatted=options.get("format",val,this);return truncate&&formatted.length>truncate?formatted.substring(0,truncate)+"â¦":formatted},toFormattedHref(options){return options.get("formatHref",this.toHref(options.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(protocol=defaults.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(protocol),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(options){return{type:this.t,value:this.toFormattedString(options),isLink:this.isLink,href:this.toFormattedHref(options),start:this.startIndex(),end:this.endIndex()}},validate(options){return options.get("validate",this.toString(),this)},render(options){const href=this.toHref(options.get("defaultProtocol")),formattedHref=options.get("formatHref",href,this),tagName=options.get("tagName",href,this),content=this.toFormattedString(options),attributes={},className=options.get("className",href,this),target=options.get("target",href,this),rel=options.get("rel",href,this),attrs=options.getObj("attributes",href,this),eventListeners=options.getObj("events",href,this);return attributes.href=formattedHref,className&&(attributes.class=className),target&&(attributes.target=target),rel&&(attributes.rel=rel),attrs&&linkify_assign(attributes,attrs),{tagName,attributes,content,eventListeners}}};const Email=createTokenClass("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),Text=createTokenClass("text"),Nl=createTokenClass("nl"),Url=createTokenClass("url",{isLink:!0,toHref(scheme=defaults.defaultProtocol){return this.hasProtocol()?this.v:`${scheme}://${this.v}`},hasProtocol(){const tokens=this.tk;return tokens.length>=2&&tokens[0].t!==LOCALHOST&&tokens[1].t===COLON}});const makeState=arg=>new State(arg);function initMultiToken(Multi,input,tokens){const startIdx=tokens[0].s,endIdx=tokens[tokens.length-1].e;return new Multi(input.slice(startIdx,endIdx),tokens)}const warn="undefined"!=typeof console&&console&&console.warn||(()=>{}),warnAdvice="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",INIT={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function registerCustomProtocol(scheme,optionalSlashSlash=!1){if(INIT.initialized&&warn(`linkifyjs: already initialized - will not register custom scheme "${scheme}" ${warnAdvice}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(scheme))throw new Error('linkifyjs: incorrect scheme format.\n1. Must only contain digits, lowercase ASCII letters or "-"\n2. Cannot start or end with "-"\n3. "-" cannot repeat');INIT.customSchemes.push([scheme,optionalSlashSlash])}function init(){INIT.scanner=function init$2(customSchemes=[]){const groups={};State.groups=groups;const Start=new State;null==tlds&&(tlds=decodeTlds(encodedTlds)),null==utlds&&(utlds=decodeTlds(encodedUtlds)),tt(Start,"'",APOSTROPHE),tt(Start,"{",OPENBRACE),tt(Start,"}",CLOSEBRACE),tt(Start,"[",OPENBRACKET),tt(Start,"]",CLOSEBRACKET),tt(Start,"(",OPENPAREN),tt(Start,")",CLOSEPAREN),tt(Start,"<",OPENANGLEBRACKET),tt(Start,">",CLOSEANGLEBRACKET),tt(Start,"ï¼",FULLWIDTHLEFTPAREN),tt(Start,"ï¼",FULLWIDTHRIGHTPAREN),tt(Start,"ã",LEFTCORNERBRACKET),tt(Start,"ã",RIGHTCORNERBRACKET),tt(Start,"ã",LEFTWHITECORNERBRACKET),tt(Start,"ã",RIGHTWHITECORNERBRACKET),tt(Start,"ï¼",FULLWIDTHLESSTHAN),tt(Start,"ï¼",FULLWIDTHGREATERTHAN),tt(Start,"&",AMPERSAND),tt(Start,"*",ASTERISK),tt(Start,"@",AT),tt(Start,"`",BACKTICK),tt(Start,"^",CARET),tt(Start,":",COLON),tt(Start,",",COMMA),tt(Start,"$",DOLLAR),tt(Start,".",DOT),tt(Start,"=",EQUALS),tt(Start,"!",EXCLAMATION),tt(Start,"-",HYPHEN),tt(Start,"%",PERCENT),tt(Start,"|",PIPE),tt(Start,"+",PLUS),tt(Start,"#",POUND),tt(Start,"?",QUERY),tt(Start,'"',QUOTE),tt(Start,"/",SLASH),tt(Start,";",SEMI),tt(Start,"~",TILDE),tt(Start,"_",UNDERSCORE),tt(Start,"\\",BACKSLASH),tt(Start,"ã»",FULLWIDTHMIDDLEDOT);const Num=tr(Start,DIGIT,NUM,{[numeric]:!0});tr(Num,DIGIT,Num);const Asciinumeric=tr(Num,ASCII_LETTER,ASCIINUMERICAL,{[asciinumeric]:!0}),Alphanumeric=tr(Num,LETTER,ALPHANUMERICAL,{[alphanumeric]:!0}),Word=tr(Start,ASCII_LETTER,WORD,{[ascii]:!0});tr(Word,DIGIT,Asciinumeric),tr(Word,ASCII_LETTER,Word),tr(Asciinumeric,DIGIT,Asciinumeric),tr(Asciinumeric,ASCII_LETTER,Asciinumeric);const UWord=tr(Start,LETTER,UWORD,{[alpha]:!0});tr(UWord,ASCII_LETTER),tr(UWord,DIGIT,Alphanumeric),tr(UWord,LETTER,UWord),tr(Alphanumeric,DIGIT,Alphanumeric),tr(Alphanumeric,ASCII_LETTER),tr(Alphanumeric,LETTER,Alphanumeric);const Nl=tt(Start,LF,NL,{[whitespace]:!0}),Cr=tt(Start,CR,WS,{[whitespace]:!0}),Ws=tr(Start,SPACE,WS,{[whitespace]:!0});tt(Start,OBJECT_REPLACEMENT,Ws),tt(Cr,LF,Nl),tt(Cr,OBJECT_REPLACEMENT,Ws),tr(Cr,SPACE,Ws),tt(Ws,CR),tt(Ws,LF),tr(Ws,SPACE,Ws),tt(Ws,OBJECT_REPLACEMENT,Ws);const Emoji=tr(Start,EMOJI,EMOJI$1,{[emoji]:!0});tt(Emoji,"#"),tr(Emoji,EMOJI,Emoji),tt(Emoji,EMOJI_VARIATION,Emoji);const EmojiJoiner=tt(Emoji,EMOJI_JOINER);tt(EmojiJoiner,"#"),tr(EmojiJoiner,EMOJI,Emoji);const wordjr=[[ASCII_LETTER,Word],[DIGIT,Asciinumeric]],uwordjr=[[ASCII_LETTER,null],[LETTER,UWord],[DIGIT,Alphanumeric]];for(let i=0;i<tlds.length;i++)fastts(Start,tlds[i],TLD,WORD,wordjr);for(let i=0;i<utlds.length;i++)fastts(Start,utlds[i],UTLD,UWORD,uwordjr);addToGroups(TLD,{tld:!0,ascii:!0},groups),addToGroups(UTLD,{utld:!0,alpha:!0},groups),fastts(Start,"file",SCHEME,WORD,wordjr),fastts(Start,"mailto",SCHEME,WORD,wordjr),fastts(Start,"http",SLASH_SCHEME,WORD,wordjr),fastts(Start,"https",SLASH_SCHEME,WORD,wordjr),fastts(Start,"ftp",SLASH_SCHEME,WORD,wordjr),fastts(Start,"ftps",SLASH_SCHEME,WORD,wordjr),addToGroups(SCHEME,{scheme:!0,ascii:!0},groups),addToGroups(SLASH_SCHEME,{slashscheme:!0,ascii:!0},groups),customSchemes=customSchemes.sort(((a,b)=>a[0]>b[0]?1:-1));for(let i=0;i<customSchemes.length;i++){const sch=customSchemes[i][0],flags=customSchemes[i][1]?{[scheme]:!0}:{[slashscheme]:!0};sch.indexOf("-")>=0?flags[domain]=!0:ASCII_LETTER.test(sch)?DIGIT.test(sch)?flags[asciinumeric]=!0:flags[ascii]=!0:flags[numeric]=!0,ts(Start,sch,sch,flags)}return ts(Start,"localhost",LOCALHOST,{ascii:!0}),Start.jd=new State(SYM),{start:Start,tokens:linkify_assign({groups},tk)}}(INIT.customSchemes);for(let i=0;i<INIT.tokenQueue.length;i++)INIT.tokenQueue[i][1]({scanner:INIT.scanner});INIT.parser=function init$1({groups}){const qsAccepting=groups.domain.concat([AMPERSAND,ASTERISK,AT,BACKSLASH,BACKTICK,CARET,DOLLAR,EQUALS,HYPHEN,NUM,PERCENT,PIPE,PLUS,POUND,SLASH,SYM,TILDE,UNDERSCORE]),qsNonAccepting=[APOSTROPHE,COLON,COMMA,DOT,EXCLAMATION,PERCENT,QUERY,QUOTE,SEMI,OPENANGLEBRACKET,CLOSEANGLEBRACKET,OPENBRACE,CLOSEBRACE,CLOSEBRACKET,OPENBRACKET,OPENPAREN,CLOSEPAREN,FULLWIDTHLEFTPAREN,FULLWIDTHRIGHTPAREN,LEFTCORNERBRACKET,RIGHTCORNERBRACKET,LEFTWHITECORNERBRACKET,RIGHTWHITECORNERBRACKET,FULLWIDTHLESSTHAN,FULLWIDTHGREATERTHAN],localpartAccepting=[AMPERSAND,APOSTROPHE,ASTERISK,BACKSLASH,BACKTICK,CARET,DOLLAR,EQUALS,HYPHEN,OPENBRACE,CLOSEBRACE,PERCENT,PIPE,PLUS,POUND,QUERY,SLASH,SYM,TILDE,UNDERSCORE],Start=makeState(),Localpart=tt(Start,TILDE);ta(Localpart,localpartAccepting,Localpart),ta(Localpart,groups.domain,Localpart);const Domain=makeState(),Scheme=makeState(),SlashScheme=makeState();ta(Start,groups.domain,Domain),ta(Start,groups.scheme,Scheme),ta(Start,groups.slashscheme,SlashScheme),ta(Domain,localpartAccepting,Localpart),ta(Domain,groups.domain,Domain);const LocalpartAt=tt(Domain,AT);tt(Localpart,AT,LocalpartAt),tt(Scheme,AT,LocalpartAt),tt(SlashScheme,AT,LocalpartAt);const LocalpartDot=tt(Localpart,DOT);ta(LocalpartDot,localpartAccepting,Localpart),ta(LocalpartDot,groups.domain,Localpart);const EmailDomain=makeState();ta(LocalpartAt,groups.domain,EmailDomain),ta(EmailDomain,groups.domain,EmailDomain);const EmailDomainDot=tt(EmailDomain,DOT);ta(EmailDomainDot,groups.domain,EmailDomain);const Email$1=makeState(Email);ta(EmailDomainDot,groups.tld,Email$1),ta(EmailDomainDot,groups.utld,Email$1),tt(LocalpartAt,LOCALHOST,Email$1);const EmailDomainHyphen=tt(EmailDomain,HYPHEN);tt(EmailDomainHyphen,HYPHEN,EmailDomainHyphen),ta(EmailDomainHyphen,groups.domain,EmailDomain),ta(Email$1,groups.domain,EmailDomain),tt(Email$1,DOT,EmailDomainDot),tt(Email$1,HYPHEN,EmailDomainHyphen);const EmailColon=tt(Email$1,COLON);ta(EmailColon,groups.numeric,Email);const DomainHyphen=tt(Domain,HYPHEN),DomainDot=tt(Domain,DOT);tt(DomainHyphen,HYPHEN,DomainHyphen),ta(DomainHyphen,groups.domain,Domain),ta(DomainDot,localpartAccepting,Localpart),ta(DomainDot,groups.domain,Domain);const DomainDotTld=makeState(Url);ta(DomainDot,groups.tld,DomainDotTld),ta(DomainDot,groups.utld,DomainDotTld),ta(DomainDotTld,groups.domain,Domain),ta(DomainDotTld,localpartAccepting,Localpart),tt(DomainDotTld,DOT,DomainDot),tt(DomainDotTld,HYPHEN,DomainHyphen),tt(DomainDotTld,AT,LocalpartAt);const DomainDotTldColon=tt(DomainDotTld,COLON),DomainDotTldColonPort=makeState(Url);ta(DomainDotTldColon,groups.numeric,DomainDotTldColonPort);const Url$1=makeState(Url),UrlNonaccept=makeState();ta(Url$1,qsAccepting,Url$1),ta(Url$1,qsNonAccepting,UrlNonaccept),ta(UrlNonaccept,qsAccepting,Url$1),ta(UrlNonaccept,qsNonAccepting,UrlNonaccept),tt(DomainDotTld,SLASH,Url$1),tt(DomainDotTldColonPort,SLASH,Url$1);const SchemeColon=tt(Scheme,COLON),SlashSchemeColon=tt(SlashScheme,COLON),SlashSchemeColonSlash=tt(SlashSchemeColon,SLASH),UriPrefix=tt(SlashSchemeColonSlash,SLASH);ta(Scheme,groups.domain,Domain),tt(Scheme,DOT,DomainDot),tt(Scheme,HYPHEN,DomainHyphen),ta(SlashScheme,groups.domain,Domain),tt(SlashScheme,DOT,DomainDot),tt(SlashScheme,HYPHEN,DomainHyphen),ta(SchemeColon,groups.domain,Url$1),tt(SchemeColon,SLASH,Url$1),tt(SchemeColon,QUERY,Url$1),ta(UriPrefix,groups.domain,Url$1),ta(UriPrefix,qsAccepting,Url$1),tt(UriPrefix,SLASH,Url$1);const bracketPairs=[[OPENBRACE,CLOSEBRACE],[OPENBRACKET,CLOSEBRACKET],[OPENPAREN,CLOSEPAREN],[OPENANGLEBRACKET,CLOSEANGLEBRACKET],[FULLWIDTHLEFTPAREN,FULLWIDTHRIGHTPAREN],[LEFTCORNERBRACKET,RIGHTCORNERBRACKET],[LEFTWHITECORNERBRACKET,RIGHTWHITECORNERBRACKET],[FULLWIDTHLESSTHAN,FULLWIDTHGREATERTHAN]];for(let i=0;i<bracketPairs.length;i++){const[OPEN,CLOSE]=bracketPairs[i],UrlOpen=tt(Url$1,OPEN);tt(UrlNonaccept,OPEN,UrlOpen),tt(UrlOpen,CLOSE,Url$1);const UrlOpenQ=makeState(Url);ta(UrlOpen,qsAccepting,UrlOpenQ);const UrlOpenSyms=makeState();ta(UrlOpen,qsNonAccepting),ta(UrlOpenQ,qsAccepting,UrlOpenQ),ta(UrlOpenQ,qsNonAccepting,UrlOpenSyms),ta(UrlOpenSyms,qsAccepting,UrlOpenQ),ta(UrlOpenSyms,qsNonAccepting,UrlOpenSyms),tt(UrlOpenQ,CLOSE,Url$1),tt(UrlOpenSyms,CLOSE,Url$1)}return tt(Start,LOCALHOST,DomainDotTld),tt(Start,NL,Nl),{start:Start,tokens:tk}}(INIT.scanner.tokens);for(let i=0;i<INIT.pluginQueue.length;i++)INIT.pluginQueue[i][1]({scanner:INIT.scanner,parser:INIT.parser});return INIT.initialized=!0,INIT}function tokenize(str){return INIT.initialized||init(),function run(start,input,tokens){let len=tokens.length,cursor=0,multis=[],textTokens=[];for(;cursor<len;){let state=start,secondState=null,nextState=null,multiLength=0,latestAccepting=null,sinceAccepts=-1;for(;cursor<len&&!(secondState=state.go(tokens[cursor].t));)textTokens.push(tokens[cursor++]);for(;cursor<len&&(nextState=secondState||state.go(tokens[cursor].t));)secondState=null,state=nextState,state.accepts()?(sinceAccepts=0,latestAccepting=state):sinceAccepts>=0&&sinceAccepts++,cursor++,multiLength++;if(sinceAccepts<0)cursor-=multiLength,cursor<len&&(textTokens.push(tokens[cursor]),cursor++);else{textTokens.length>0&&(multis.push(initMultiToken(Text,input,textTokens)),textTokens=[]),cursor-=sinceAccepts,multiLength-=sinceAccepts;const Multi=latestAccepting.t,subtokens=tokens.slice(cursor-multiLength,cursor);multis.push(initMultiToken(Multi,input,subtokens))}}return textTokens.length>0&&multis.push(initMultiToken(Text,input,textTokens)),multis}(INIT.parser.start,str,run$1(INIT.scanner.start,str))}function find(str,type=null,opts=null){if(type&&"object"==typeof type){if(opts)throw Error(`linkifyjs: Invalid link type ${type}; must be a string`);opts=type,type=null}const options=new Options(opts),tokens=tokenize(str),filtered=[];for(let i=0;i<tokens.length;i++){const token=tokens[i];!token.isLink||type&&token.t!==type||!options.check(token)||filtered.push(token.toFormattedObject(options))}return filtered}tokenize.scan=run$1;var prosemirror_state_dist=__webpack_require__("./node_modules/prosemirror-state/dist/index.js");const ATTR_WHITESPACE=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g;function isAllowedUri(uri,protocols){const allowedProtocols=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return protocols&&protocols.forEach((protocol=>{const nextProtocol="string"==typeof protocol?protocol:protocol.scheme;nextProtocol&&allowedProtocols.push(nextProtocol)})),!uri||uri.replace(ATTR_WHITESPACE,"").match(new RegExp(`^(?:(?:${allowedProtocols.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}const Link=core_dist.CU.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach((protocol=>{"string"!=typeof protocol?registerCustomProtocol(protocol.scheme,protocol.optionalSlashes):registerCustomProtocol(protocol)}))},onDestroy(){!function linkify_reset(){return State.groups={},INIT.scanner=null,INIT.parser=null,INIT.tokenQueue=[],INIT.pluginQueue=[],INIT.customSchemes=[],INIT.initialized=!1,INIT}()},inclusive(){return this.options.autolink},addOptions:()=>({openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(url,ctx)=>!!isAllowedUri(url,ctx.protocols),validate:url=>!!url,shouldAutoLink:url=>!!url}),addAttributes(){return{href:{default:null,parseHTML:element=>element.getAttribute("href")},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:dom=>{const href=dom.getAttribute("href");return!(!href||!this.options.isAllowedUri(href,{defaultValidate:url=>!!isAllowedUri(url,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol}))&&null}}]},renderHTML({HTMLAttributes}){return this.options.isAllowedUri(HTMLAttributes.href,{defaultValidate:href=>!!isAllowedUri(href,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",(0,core_dist.KV)(this.options.HTMLAttributes,HTMLAttributes),0]:["a",(0,core_dist.KV)(this.options.HTMLAttributes,{...HTMLAttributes,href:""}),0]},addCommands(){return{setLink:attributes=>({chain})=>{const{href}=attributes;return!!this.options.isAllowedUri(href,{defaultValidate:url=>!!isAllowedUri(url,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})&&chain().setMark(this.name,attributes).setMeta("preventAutolink",!0).run()},toggleLink:attributes=>({chain})=>{const{href}=attributes;return!!this.options.isAllowedUri(href,{defaultValidate:url=>!!isAllowedUri(url,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})&&chain().toggleMark(this.name,attributes,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain})=>chain().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[(0,core_dist.Zc)({find:text=>{const foundLinks=[];if(text){const{protocols,defaultProtocol}=this.options,links=find(text).filter((item=>item.isLink&&this.options.isAllowedUri(item.value,{defaultValidate:href=>!!isAllowedUri(href,protocols),protocols,defaultProtocol})));links.length&&links.forEach((link=>foundLinks.push({text:link.value,data:{href:link.href},index:link.start})))}return foundLinks},type:this.type,getAttributes:match=>{var _a;return{href:null===(_a=match.data)||void 0===_a?void 0:_a.href}}})]},addProseMirrorPlugins(){const plugins=[],{protocols,defaultProtocol}=this.options;return this.options.autolink&&plugins.push(function autolink(options){return new prosemirror_state_dist.k_({key:new prosemirror_state_dist.hs("autolink"),appendTransaction:(transactions,oldState,newState)=>{const docChanges=transactions.some((transaction=>transaction.docChanged))&&!oldState.doc.eq(newState.doc),preventAutolink=transactions.some((transaction=>transaction.getMeta("preventAutolink")));if(!docChanges||preventAutolink)return;const{tr}=newState,transform=(0,core_dist.T7)(oldState.doc,[...transactions]);return(0,core_dist.FF)(transform).forEach((({newRange})=>{const nodesInChangedRanges=(0,core_dist.Nx)(newState.doc,newRange,(node=>node.isTextblock));let textBlock,textBeforeWhitespace;if(nodesInChangedRanges.length>1?(textBlock=nodesInChangedRanges[0],textBeforeWhitespace=newState.doc.textBetween(textBlock.pos,textBlock.pos+textBlock.node.nodeSize,void 0," ")):nodesInChangedRanges.length&&newState.doc.textBetween(newRange.from,newRange.to," "," ").endsWith(" ")&&(textBlock=nodesInChangedRanges[0],textBeforeWhitespace=newState.doc.textBetween(textBlock.pos,newRange.to,void 0," ")),textBlock&&textBeforeWhitespace){const wordsBeforeWhitespace=textBeforeWhitespace.split(" ").filter((s=>""!==s));if(wordsBeforeWhitespace.length<=0)return!1;const lastWordBeforeSpace=wordsBeforeWhitespace[wordsBeforeWhitespace.length-1],lastWordAndBlockOffset=textBlock.pos+textBeforeWhitespace.lastIndexOf(lastWordBeforeSpace);if(!lastWordBeforeSpace)return!1;const linksBeforeSpace=tokenize(lastWordBeforeSpace).map((t=>t.toObject(options.defaultProtocol)));if(!function isValidLinkStructure(tokens){return 1===tokens.length?tokens[0].isLink:!(3!==tokens.length||!tokens[1].isLink)&&["()","[]"].includes(tokens[0].value+tokens[2].value)}(linksBeforeSpace))return!1;linksBeforeSpace.filter((link=>link.isLink)).map((link=>({...link,from:lastWordAndBlockOffset+link.start+1,to:lastWordAndBlockOffset+link.end+1}))).filter((link=>!newState.schema.marks.code||!newState.doc.rangeHasMark(link.from,link.to,newState.schema.marks.code))).filter((link=>options.validate(link.value))).filter((link=>options.shouldAutoLink(link.value))).forEach((link=>{(0,core_dist.hO)(link.from,link.to,newState.doc).some((item=>item.mark.type===options.type))||tr.addMark(link.from,link.to,options.type.create({href:link.href}))}))}})),tr.steps.length?tr:void 0}})}({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:url=>this.options.isAllowedUri(url,{defaultValidate:href=>!!isAllowedUri(href,protocols),protocols,defaultProtocol}),shouldAutoLink:this.options.shouldAutoLink})),!0===this.options.openOnClick&&plugins.push(function clickHandler(options){return new prosemirror_state_dist.k_({key:new prosemirror_state_dist.hs("handleClickLink"),props:{handleClick:(view,pos,event)=>{var _a,_b;if(0!==event.button)return!1;if(!view.editable)return!1;let a=event.target;const els=[];for(;"DIV"!==a.nodeName;)els.push(a),a=a.parentNode;if(!els.find((value=>"A"===value.nodeName)))return!1;const attrs=(0,core_dist.gu)(view.state,options.type.name),link=event.target,href=null!==(_a=null==link?void 0:link.href)&&void 0!==_a?_a:attrs.href,target=null!==(_b=null==link?void 0:link.target)&&void 0!==_b?_b:attrs.target;return!(!link||!href||(window.open(href,target),0))}}})}({type:this.type})),this.options.linkOnPaste&&plugins.push(function pasteHandler(options){return new prosemirror_state_dist.k_({key:new prosemirror_state_dist.hs("handlePasteLink"),props:{handlePaste:(view,event,slice)=>{const{state}=view,{selection}=state,{empty}=selection;if(empty)return!1;let textContent="";slice.content.forEach((node=>{textContent+=node.textContent}));const link=find(textContent,{defaultProtocol:options.defaultProtocol}).find((item=>item.isLink&&item.value===textContent));return!(!textContent||!link)&&options.editor.commands.setMark(options.type,{href:link.href})}}})}({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),plugins}}),extension_blockquote_dist_inputRegex=/^\s*>\s$/,Blockquote=core_dist.bP.create({name:"blockquote",addOptions:()=>({HTMLAttributes:{}}),content:"block+",group:"block",defining:!0,parseHTML:()=>[{tag:"blockquote"}],renderHTML({HTMLAttributes}){return["blockquote",(0,core_dist.KV)(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{setBlockquote:()=>({commands})=>commands.wrapIn(this.name),toggleBlockquote:()=>({commands})=>commands.toggleWrap(this.name),unsetBlockquote:()=>({commands})=>commands.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[(0,core_dist.tG)({find:extension_blockquote_dist_inputRegex,type:this.type})]}}),starInputRegex=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,starPasteRegex=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,underscoreInputRegex=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,underscorePasteRegex=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Bold=core_dist.CU.create({name:"bold",addOptions:()=>({HTMLAttributes:{}}),parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:node=>"normal"!==node.style.fontWeight&&null},{style:"font-weight=400",clearMark:mark=>mark.type.name===this.name},{style:"font-weight",getAttrs:value=>/^(bold(er)?|[5-9]\d{2,})$/.test(value)&&null}]},renderHTML({HTMLAttributes}){return["strong",(0,core_dist.KV)(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{setBold:()=>({commands})=>commands.setMark(this.name),toggleBold:()=>({commands})=>commands.toggleMark(this.name),unsetBold:()=>({commands})=>commands.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[(0,core_dist.OX)({find:starInputRegex,type:this.type}),(0,core_dist.OX)({find:underscoreInputRegex,type:this.type})]},addPasteRules(){return[(0,core_dist.Zc)({find:starPasteRegex,type:this.type}),(0,core_dist.Zc)({find:underscorePasteRegex,type:this.type})]}}),extension_bullet_list_dist_inputRegex=/^\s*([-+*])\s$/,BulletList=core_dist.bP.create({name:"bulletList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML:()=>[{tag:"ul"}],renderHTML({HTMLAttributes}){return["ul",(0,core_dist.KV)(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{toggleBulletList:()=>({commands,chain})=>this.options.keepAttributes?chain().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes("listItem",this.editor.getAttributes("textStyle")).run():commands.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let inputRule=(0,core_dist.tG)({find:extension_bullet_list_dist_inputRegex,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(inputRule=(0,core_dist.tG)({find:extension_bullet_list_dist_inputRegex,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes("textStyle"),editor:this.editor})),[inputRule]}}),backtickInputRegex=/^```([a-z]+)?[\s\n]$/,tildeInputRegex=/^~~~([a-z]+)?[\s\n]$/,CodeBlock=core_dist.bP.create({name:"codeBlock",addOptions:()=>({languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}),content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:element=>{var _a;const{languageClassPrefix}=this.options,language=[...(null===(_a=element.firstElementChild)||void 0===_a?void 0:_a.classList)||[]].filter((className=>className.startsWith(languageClassPrefix))).map((className=>className.replace(languageClassPrefix,"")))[0];return language||null},rendered:!1}}},parseHTML:()=>[{tag:"pre",preserveWhitespace:"full"}],renderHTML({node,HTMLAttributes}){return["pre",(0,core_dist.KV)(this.options.HTMLAttributes,HTMLAttributes),["code",{class:node.attrs.language?this.options.languageClassPrefix+node.attrs.language:null},0]]},addCommands(){return{setCodeBlock:attributes=>({commands})=>commands.setNode(this.name,attributes),toggleCodeBlock:attributes=>({commands})=>commands.toggleNode(this.name,"paragraph",attributes)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty,$anchor}=this.editor.state.selection,isAtStart=1===$anchor.pos;return!(!empty||$anchor.parent.type.name!==this.name)&&(!(!isAtStart&&$anchor.parent.textContent.length)&&this.editor.commands.clearNodes())},Enter:({editor})=>{if(!this.options.exitOnTripleEnter)return!1;const{state}=editor,{selection}=state,{$from,empty}=selection;if(!empty||$from.parent.type!==this.type)return!1;const isAtEnd=$from.parentOffset===$from.parent.nodeSize-2,endsWithDoubleNewline=$from.parent.textContent.endsWith("\n\n");return!(!isAtEnd||!endsWithDoubleNewline)&&editor.chain().command((({tr})=>(tr.delete($from.pos-2,$from.pos),!0))).exitCode().run()},ArrowDown:({editor})=>{if(!this.options.exitOnArrowDown)return!1;const{state}=editor,{selection,doc}=state,{$from,empty}=selection;if(!empty||$from.parent.type!==this.type)return!1;if(!($from.parentOffset===$from.parent.nodeSize-2))return!1;const after=$from.after();if(void 0===after)return!1;return doc.nodeAt(after)?editor.commands.command((({tr})=>(tr.setSelection(prosemirror_state_dist.LN.near(doc.resolve(after))),!0))):editor.commands.exitCode()}}},addInputRules(){return[(0,core_dist.JJ)({find:backtickInputRegex,type:this.type,getAttributes:match=>({language:match[1]})}),(0,core_dist.JJ)({find:tildeInputRegex,type:this.type,getAttributes:match=>({language:match[1]})})]},addProseMirrorPlugins(){return[new prosemirror_state_dist.k_({key:new prosemirror_state_dist.hs("codeBlockVSCodeHandler"),props:{handlePaste:(view,event)=>{if(!event.clipboardData)return!1;if(this.editor.isActive(this.type.name))return!1;const text=event.clipboardData.getData("text/plain"),vscode=event.clipboardData.getData("vscode-editor-data"),vscodeData=vscode?JSON.parse(vscode):void 0,language=null==vscodeData?void 0:vscodeData.mode;if(!text||!language)return!1;const{tr,schema}=view.state,textNode=schema.text(text.replace(/\r\n?/g,"\n"));return tr.replaceSelectionWith(this.type.create({language},textNode)),tr.selection.$from.parent.type!==this.type&&tr.setSelection(prosemirror_state_dist.U3.near(tr.doc.resolve(Math.max(0,tr.selection.from-2)))),tr.setMeta("paste",!0),view.dispatch(tr),!0}}})]}}),Document=core_dist.bP.create({name:"doc",topNode:!0,content:"block+"});var prosemirror_transform_dist=__webpack_require__("./node_modules/prosemirror-transform/dist/index.js");function dropCursor(options={}){return new prosemirror_state_dist.k_({view:editorView=>new DropCursorView(editorView,options)})}class DropCursorView{constructor(editorView,options){var _a;this.editorView=editorView,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!==(_a=options.width)&&void 0!==_a?_a:1,this.color=!1===options.color?void 0:options.color||"black",this.class=options.class,this.handlers=["dragover","dragend","drop","dragleave"].map((name=>{let handler=e=>{this[name](e)};return editorView.dom.addEventListener(name,handler),{name,handler}}))}destroy(){this.handlers.forEach((({name,handler})=>this.editorView.dom.removeEventListener(name,handler)))}update(editorView,prevState){null!=this.cursorPos&&prevState.doc!=editorView.state.doc&&(this.cursorPos>editorView.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(pos){pos!=this.cursorPos&&(this.cursorPos=pos,null==pos?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let rect,$pos=this.editorView.state.doc.resolve(this.cursorPos),isBlock=!$pos.parent.inlineContent,editorDOM=this.editorView.dom,editorRect=editorDOM.getBoundingClientRect(),scaleX=editorRect.width/editorDOM.offsetWidth,scaleY=editorRect.height/editorDOM.offsetHeight;if(isBlock){let before=$pos.nodeBefore,after=$pos.nodeAfter;if(before||after){let node=this.editorView.nodeDOM(this.cursorPos-(before?before.nodeSize:0));if(node){let nodeRect=node.getBoundingClientRect(),top=before?nodeRect.bottom:nodeRect.top;before&&after&&(top=(top+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let halfWidth=this.width/2*scaleY;rect={left:nodeRect.left,right:nodeRect.right,top:top-halfWidth,bottom:top+halfWidth}}}}if(!rect){let coords=this.editorView.coordsAtPos(this.cursorPos),halfWidth=this.width/2*scaleX;rect={left:coords.left-halfWidth,right:coords.left+halfWidth,top:coords.top,bottom:coords.bottom}}let parentLeft,parentTop,parent=this.editorView.dom.offsetParent;if(this.element||(this.element=parent.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",isBlock),this.element.classList.toggle("prosemirror-dropcursor-inline",!isBlock),!parent||parent==document.body&&"static"==getComputedStyle(parent).position)parentLeft=-pageXOffset,parentTop=-pageYOffset;else{let rect=parent.getBoundingClientRect(),parentScaleX=rect.width/parent.offsetWidth,parentScaleY=rect.height/parent.offsetHeight;parentLeft=rect.left-parent.scrollLeft*parentScaleX,parentTop=rect.top-parent.scrollTop*parentScaleY}this.element.style.left=(rect.left-parentLeft)/scaleX+"px",this.element.style.top=(rect.top-parentTop)/scaleY+"px",this.element.style.width=(rect.right-rect.left)/scaleX+"px",this.element.style.height=(rect.bottom-rect.top)/scaleY+"px"}scheduleRemoval(timeout){clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.setCursor(null)),timeout)}dragover(event){if(!this.editorView.editable)return;let pos=this.editorView.posAtCoords({left:event.clientX,top:event.clientY}),node=pos&&pos.inside>=0&&this.editorView.state.doc.nodeAt(pos.inside),disableDropCursor=node&&node.type.spec.disableDropCursor,disabled="function"==typeof disableDropCursor?disableDropCursor(this.editorView,pos,event):disableDropCursor;if(pos&&!disabled){let target=pos.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let point=(0,prosemirror_transform_dist.Um)(this.editorView.state.doc,target,this.editorView.dragging.slice);null!=point&&(target=point)}this.setCursor(target),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(event){this.editorView.dom.contains(event.relatedTarget)||this.setCursor(null)}}const Dropcursor=core_dist.YY.create({name:"dropCursor",addOptions:()=>({color:"currentColor",width:1,class:void 0}),addProseMirrorPlugins(){return[dropCursor(this.options)]}});var prosemirror_keymap_dist=__webpack_require__("./node_modules/prosemirror-keymap/dist/index.js"),prosemirror_model_dist=__webpack_require__("./node_modules/prosemirror-model/dist/index.js"),prosemirror_view_dist=__webpack_require__("./node_modules/prosemirror-view/dist/index.js");class GapCursor extends prosemirror_state_dist.LN{constructor($pos){super($pos,$pos)}map(doc,mapping){let $pos=doc.resolve(mapping.map(this.head));return GapCursor.valid($pos)?new GapCursor($pos):prosemirror_state_dist.LN.near($pos)}content(){return prosemirror_model_dist.Ji.empty}eq(other){return other instanceof GapCursor&&other.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(doc,json){if("number"!=typeof json.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new GapCursor(doc.resolve(json.pos))}getBookmark(){return new GapBookmark(this.anchor)}static valid($pos){let parent=$pos.parent;if(parent.isTextblock||!function closedBefore($pos){for(let d=$pos.depth;d>=0;d--){let index=$pos.index(d),parent=$pos.node(d);if(0!=index)for(let before=parent.child(index-1);;before=before.lastChild){if(0==before.childCount&&!before.inlineContent||before.isAtom||before.type.spec.isolating)return!0;if(before.inlineContent)return!1}else if(parent.type.spec.isolating)return!0}return!0}($pos)||!function closedAfter($pos){for(let d=$pos.depth;d>=0;d--){let index=$pos.indexAfter(d),parent=$pos.node(d);if(index!=parent.childCount)for(let after=parent.child(index);;after=after.firstChild){if(0==after.childCount&&!after.inlineContent||after.isAtom||after.type.spec.isolating)return!0;if(after.inlineContent)return!1}else if(parent.type.spec.isolating)return!0}return!0}($pos))return!1;let override=parent.type.spec.allowGapCursor;if(null!=override)return override;let deflt=parent.contentMatchAt($pos.index()).defaultType;return deflt&&deflt.isTextblock}static findGapCursorFrom($pos,dir,mustMove=!1){search:for(;;){if(!mustMove&&GapCursor.valid($pos))return $pos;let pos=$pos.pos,next=null;for(let d=$pos.depth;;d--){let parent=$pos.node(d);if(dir>0?$pos.indexAfter(d)<parent.childCount:$pos.index(d)>0){next=parent.child(dir>0?$pos.indexAfter(d):$pos.index(d)-1);break}if(0==d)return null;pos+=dir;let $cur=$pos.doc.resolve(pos);if(GapCursor.valid($cur))return $cur}for(;;){let inside=dir>0?next.firstChild:next.lastChild;if(!inside){if(next.isAtom&&!next.isText&&!prosemirror_state_dist.nh.isSelectable(next)){$pos=$pos.doc.resolve(pos+next.nodeSize*dir),mustMove=!1;continue search}break}next=inside,pos+=dir;let $cur=$pos.doc.resolve(pos);if(GapCursor.valid($cur))return $cur}return null}}}GapCursor.prototype.visible=!1,GapCursor.findFrom=GapCursor.findGapCursorFrom,prosemirror_state_dist.LN.jsonID("gapcursor",GapCursor);class GapBookmark{constructor(pos){this.pos=pos}map(mapping){return new GapBookmark(mapping.map(this.pos))}resolve(doc){let $pos=doc.resolve(this.pos);return GapCursor.valid($pos)?new GapCursor($pos):prosemirror_state_dist.LN.near($pos)}}const handleKeyDown=(0,prosemirror_keymap_dist.K)({ArrowLeft:arrow("horiz",-1),ArrowRight:arrow("horiz",1),ArrowUp:arrow("vert",-1),ArrowDown:arrow("vert",1)});function arrow(axis,dir){const dirStr="vert"==axis?dir>0?"down":"up":dir>0?"right":"left";return function(state,dispatch,view){let sel=state.selection,$start=dir>0?sel.$to:sel.$from,mustMove=sel.empty;if(sel instanceof prosemirror_state_dist.U3){if(!view.endOfTextblock(dirStr)||0==$start.depth)return!1;mustMove=!1,$start=state.doc.resolve(dir>0?$start.after():$start.before())}let $found=GapCursor.findGapCursorFrom($start,dir,mustMove);return!!$found&&(dispatch&&dispatch(state.tr.setSelection(new GapCursor($found))),!0)}}function handleClick(view,pos,event){if(!view||!view.editable)return!1;let $pos=view.state.doc.resolve(pos);if(!GapCursor.valid($pos))return!1;let clickPos=view.posAtCoords({left:event.clientX,top:event.clientY});return!(clickPos&&clickPos.inside>-1&&prosemirror_state_dist.nh.isSelectable(view.state.doc.nodeAt(clickPos.inside)))&&(view.dispatch(view.state.tr.setSelection(new GapCursor($pos))),!0)}function beforeinput(view,event){if("insertCompositionText"!=event.inputType||!(view.state.selection instanceof GapCursor))return!1;let{$from}=view.state.selection,insert=$from.parent.contentMatchAt($from.index()).findWrapping(view.state.schema.nodes.text);if(!insert)return!1;let frag=prosemirror_model_dist.FK.empty;for(let i=insert.length-1;i>=0;i--)frag=prosemirror_model_dist.FK.from(insert[i].createAndFill(null,frag));let tr=view.state.tr.replace($from.pos,$from.pos,new prosemirror_model_dist.Ji(frag,0,0));return tr.setSelection(prosemirror_state_dist.U3.near(tr.doc.resolve($from.pos+1))),view.dispatch(tr),!1}function drawGapCursor(state){if(!(state.selection instanceof GapCursor))return null;let node=document.createElement("div");return node.className="ProseMirror-gapcursor",prosemirror_view_dist.zF.create(state.doc,[prosemirror_view_dist.NZ.widget(state.selection.head,node,{key:"gapcursor"})])}const Gapcursor=core_dist.YY.create({name:"gapCursor",addProseMirrorPlugins:()=>[new prosemirror_state_dist.k_({props:{decorations:drawGapCursor,createSelectionBetween:(_view,$anchor,$head)=>$anchor.pos==$head.pos&&GapCursor.valid($head)?new GapCursor($head):null,handleClick,handleKeyDown,handleDOMEvents:{beforeinput}}})],extendNodeSchema(extension){var _a;const context={name:extension.name,options:extension.options,storage:extension.storage};return{allowGapCursor:null!==(_a=(0,core_dist.gk)((0,core_dist.iI)(extension,"allowGapCursor",context)))&&void 0!==_a?_a:null}}}),HardBreak=core_dist.bP.create({name:"hardBreak",addOptions:()=>({keepMarks:!0,HTMLAttributes:{}}),inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML:()=>[{tag:"br"}],renderHTML({HTMLAttributes}){return["br",(0,core_dist.KV)(this.options.HTMLAttributes,HTMLAttributes)]},renderText:()=>"\n",addCommands(){return{setHardBreak:()=>({commands,chain,state,editor})=>commands.first([()=>commands.exitCode(),()=>commands.command((()=>{const{selection,storedMarks}=state;if(selection.$from.parent.type.spec.isolating)return!1;const{keepMarks}=this.options,{splittableMarks}=editor.extensionManager,marks=storedMarks||selection.$to.parentOffset&&selection.$from.marks();return chain().insertContent({type:this.name}).command((({tr,dispatch})=>{if(dispatch&&marks&&keepMarks){const filteredMarks=marks.filter((mark=>splittableMarks.includes(mark.type.name)));tr.ensureMarks(filteredMarks)}return!0})).run()}))])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Heading=core_dist.bP.create({name:"heading",addOptions:()=>({levels:[1,2,3,4,5,6],HTMLAttributes:{}}),content:"inline*",group:"block",defining:!0,addAttributes:()=>({level:{default:1,rendered:!1}}),parseHTML(){return this.options.levels.map((level=>({tag:`h${level}`,attrs:{level}})))},renderHTML({node,HTMLAttributes}){return[`h${this.options.levels.includes(node.attrs.level)?node.attrs.level:this.options.levels[0]}`,(0,core_dist.KV)(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{setHeading:attributes=>({commands})=>!!this.options.levels.includes(attributes.level)&&commands.setNode(this.name,attributes),toggleHeading:attributes=>({commands})=>!!this.options.levels.includes(attributes.level)&&commands.toggleNode(this.name,"paragraph",attributes)}},addKeyboardShortcuts(){return this.options.levels.reduce(((items,level)=>({...items,[`Mod-Alt-${level}`]:()=>this.editor.commands.toggleHeading({level})})),{})},addInputRules(){return this.options.levels.map((level=>(0,core_dist.JJ)({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${level}})\\s$`),type:this.type,getAttributes:{level}})))}});var RopeSequence=function RopeSequence(){};RopeSequence.prototype.append=function append(other){return other.length?(other=RopeSequence.from(other),!this.length&&other||other.length<200&&this.leafAppend(other)||this.length<200&&other.leafPrepend(this)||this.appendInner(other)):this},RopeSequence.prototype.prepend=function prepend(other){return other.length?RopeSequence.from(other).append(this):this},RopeSequence.prototype.appendInner=function appendInner(other){return new Append(this,other)},RopeSequence.prototype.slice=function slice(from,to){return void 0===from&&(from=0),void 0===to&&(to=this.length),from>=to?RopeSequence.empty:this.sliceInner(Math.max(0,from),Math.min(this.length,to))},RopeSequence.prototype.get=function get(i){if(!(i<0||i>=this.length))return this.getInner(i)},RopeSequence.prototype.forEach=function forEach(f,from,to){void 0===from&&(from=0),void 0===to&&(to=this.length),from<=to?this.forEachInner(f,from,to,0):this.forEachInvertedInner(f,from,to,0)},RopeSequence.prototype.map=function map(f,from,to){void 0===from&&(from=0),void 0===to&&(to=this.length);var result=[];return this.forEach((function(elt,i){return result.push(f(elt,i))}),from,to),result},RopeSequence.from=function from(values){return values instanceof RopeSequence?values:values&&values.length?new Leaf(values):RopeSequence.empty};var Leaf=function(RopeSequence){function Leaf(values){RopeSequence.call(this),this.values=values}RopeSequence&&(Leaf.__proto__=RopeSequence),Leaf.prototype=Object.create(RopeSequence&&RopeSequence.prototype),Leaf.prototype.constructor=Leaf;var prototypeAccessors={length:{configurable:!0},depth:{configurable:!0}};return Leaf.prototype.flatten=function flatten(){return this.values},Leaf.prototype.sliceInner=function sliceInner(from,to){return 0==from&&to==this.length?this:new Leaf(this.values.slice(from,to))},Leaf.prototype.getInner=function getInner(i){return this.values[i]},Leaf.prototype.forEachInner=function forEachInner(f,from,to,start){for(var i=from;i<to;i++)if(!1===f(this.values[i],start+i))return!1},Leaf.prototype.forEachInvertedInner=function forEachInvertedInner(f,from,to,start){for(var i=from-1;i>=to;i--)if(!1===f(this.values[i],start+i))return!1},Leaf.prototype.leafAppend=function leafAppend(other){if(this.length+other.length<=200)return new Leaf(this.values.concat(other.flatten()))},Leaf.prototype.leafPrepend=function leafPrepend(other){if(this.length+other.length<=200)return new Leaf(other.flatten().concat(this.values))},prototypeAccessors.length.get=function(){return this.values.length},prototypeAccessors.depth.get=function(){return 0},Object.defineProperties(Leaf.prototype,prototypeAccessors),Leaf}(RopeSequence);RopeSequence.empty=new Leaf([]);var Append=function(RopeSequence){function Append(left,right){RopeSequence.call(this),this.left=left,this.right=right,this.length=left.length+right.length,this.depth=Math.max(left.depth,right.depth)+1}return RopeSequence&&(Append.__proto__=RopeSequence),Append.prototype=Object.create(RopeSequence&&RopeSequence.prototype),Append.prototype.constructor=Append,Append.prototype.flatten=function flatten(){return this.left.flatten().concat(this.right.flatten())},Append.prototype.getInner=function getInner(i){return i<this.left.length?this.left.get(i):this.right.get(i-this.left.length)},Append.prototype.forEachInner=function forEachInner(f,from,to,start){var leftLen=this.left.length;return!(from<leftLen&&!1===this.left.forEachInner(f,from,Math.min(to,leftLen),start))&&(!(to>leftLen&&!1===this.right.forEachInner(f,Math.max(from-leftLen,0),Math.min(this.length,to)-leftLen,start+leftLen))&&void 0)},Append.prototype.forEachInvertedInner=function forEachInvertedInner(f,from,to,start){var leftLen=this.left.length;return!(from>leftLen&&!1===this.right.forEachInvertedInner(f,from-leftLen,Math.max(to,leftLen)-leftLen,start+leftLen))&&(!(to<leftLen&&!1===this.left.forEachInvertedInner(f,Math.min(from,leftLen),to,start))&&void 0)},Append.prototype.sliceInner=function sliceInner(from,to){if(0==from&&to==this.length)return this;var leftLen=this.left.length;return to<=leftLen?this.left.slice(from,to):from>=leftLen?this.right.slice(from-leftLen,to-leftLen):this.left.slice(from,leftLen).append(this.right.slice(0,to-leftLen))},Append.prototype.leafAppend=function leafAppend(other){var inner=this.right.leafAppend(other);if(inner)return new Append(this.left,inner)},Append.prototype.leafPrepend=function leafPrepend(other){var inner=this.left.leafPrepend(other);if(inner)return new Append(inner,this.right)},Append.prototype.appendInner=function appendInner(other){return this.left.depth>=Math.max(this.right.depth,other.depth)+1?new Append(this.left,new Append(this.right,other)):new Append(this,other)},Append}(RopeSequence);const rope_sequence_dist=RopeSequence;class Branch{constructor(items,eventCount){this.items=items,this.eventCount=eventCount}popEvent(state,preserveItems){if(0==this.eventCount)return null;let remap,mapFrom,end=this.items.length;for(;;end--){if(this.items.get(end-1).selection){--end;break}}preserveItems&&(remap=this.remapping(end,this.items.length),mapFrom=remap.maps.length);let selection,remaining,transform=state.tr,addAfter=[],addBefore=[];return this.items.forEach(((item,i)=>{if(!item.step)return remap||(remap=this.remapping(end,i+1),mapFrom=remap.maps.length),mapFrom--,void addBefore.push(item);if(remap){addBefore.push(new Item(item.map));let map,step=item.step.map(remap.slice(mapFrom));step&&transform.maybeStep(step).doc&&(map=transform.mapping.maps[transform.mapping.maps.length-1],addAfter.push(new Item(map,void 0,void 0,addAfter.length+addBefore.length))),mapFrom--,map&&remap.appendMap(map,mapFrom)}else transform.maybeStep(item.step);return item.selection?(selection=remap?item.selection.map(remap.slice(mapFrom)):item.selection,remaining=new Branch(this.items.slice(0,end).append(addBefore.reverse().concat(addAfter)),this.eventCount-1),!1):void 0}),this.items.length,0),{remaining,transform,selection}}addTransform(transform,selection,histOptions,preserveItems){let newItems=[],eventCount=this.eventCount,oldItems=this.items,lastItem=!preserveItems&&oldItems.length?oldItems.get(oldItems.length-1):null;for(let i=0;i<transform.steps.length;i++){let merged,step=transform.steps[i].invert(transform.docs[i]),item=new Item(transform.mapping.maps[i],step,selection);(merged=lastItem&&lastItem.merge(item))&&(item=merged,i?newItems.pop():oldItems=oldItems.slice(0,oldItems.length-1)),newItems.push(item),selection&&(eventCount++,selection=void 0),preserveItems||(lastItem=item)}let overflow=eventCount-histOptions.depth;return overflow>DEPTH_OVERFLOW&&(oldItems=function cutOffEvents(items,n){let cutPoint;return items.forEach(((item,i)=>{if(item.selection&&0==n--)return cutPoint=i,!1})),items.slice(cutPoint)}(oldItems,overflow),eventCount-=overflow),new Branch(oldItems.append(newItems),eventCount)}remapping(from,to){let maps=new prosemirror_transform_dist.X9;return this.items.forEach(((item,i)=>{let mirrorPos=null!=item.mirrorOffset&&i-item.mirrorOffset>=from?maps.maps.length-item.mirrorOffset:void 0;maps.appendMap(item.map,mirrorPos)}),from,to),maps}addMaps(array){return 0==this.eventCount?this:new Branch(this.items.append(array.map((map=>new Item(map)))),this.eventCount)}rebased(rebasedTransform,rebasedCount){if(!this.eventCount)return this;let rebasedItems=[],start=Math.max(0,this.items.length-rebasedCount),mapping=rebasedTransform.mapping,newUntil=rebasedTransform.steps.length,eventCount=this.eventCount;this.items.forEach((item=>{item.selection&&eventCount--}),start);let iRebased=rebasedCount;this.items.forEach((item=>{let pos=mapping.getMirror(--iRebased);if(null==pos)return;newUntil=Math.min(newUntil,pos);let map=mapping.maps[pos];if(item.step){let step=rebasedTransform.steps[pos].invert(rebasedTransform.docs[pos]),selection=item.selection&&item.selection.map(mapping.slice(iRebased+1,pos));selection&&eventCount++,rebasedItems.push(new Item(map,step,selection))}else rebasedItems.push(new Item(map))}),start);let newMaps=[];for(let i=rebasedCount;i<newUntil;i++)newMaps.push(new Item(mapping.maps[i]));let items=this.items.slice(0,start).append(newMaps).append(rebasedItems),branch=new Branch(items,eventCount);return branch.emptyItemCount()>500&&(branch=branch.compress(this.items.length-rebasedItems.length)),branch}emptyItemCount(){let count=0;return this.items.forEach((item=>{item.step||count++})),count}compress(upto=this.items.length){let remap=this.remapping(0,upto),mapFrom=remap.maps.length,items=[],events=0;return this.items.forEach(((item,i)=>{if(i>=upto)items.push(item),item.selection&&events++;else if(item.step){let step=item.step.map(remap.slice(mapFrom)),map=step&&step.getMap();if(mapFrom--,map&&remap.appendMap(map,mapFrom),step){let selection=item.selection&&item.selection.map(remap.slice(mapFrom));selection&&events++;let merged,newItem=new Item(map.invert(),step,selection),last=items.length-1;(merged=items.length&&items[last].merge(newItem))?items[last]=merged:items.push(newItem)}}else item.map&&mapFrom--}),this.items.length,0),new Branch(rope_sequence_dist.from(items.reverse()),events)}}Branch.empty=new Branch(rope_sequence_dist.empty,0);class Item{constructor(map,step,selection,mirrorOffset){this.map=map,this.step=step,this.selection=selection,this.mirrorOffset=mirrorOffset}merge(other){if(this.step&&other.step&&!other.selection){let step=other.step.merge(this.step);if(step)return new Item(step.getMap().invert(),step,this.selection)}}}class HistoryState{constructor(done,undone,prevRanges,prevTime,prevComposition){this.done=done,this.undone=undone,this.prevRanges=prevRanges,this.prevTime=prevTime,this.prevComposition=prevComposition}}const DEPTH_OVERFLOW=20;function rangesFor(maps){let result=[];for(let i=maps.length-1;i>=0&&0==result.length;i--)maps[i].forEach(((_from,_to,from,to)=>result.push(from,to)));return result}function mapRanges(ranges,mapping){if(!ranges)return null;let result=[];for(let i=0;i<ranges.length;i+=2){let from=mapping.map(ranges[i],1),to=mapping.map(ranges[i+1],-1);from<=to&&result.push(from,to)}return result}let cachedPreserveItems=!1,cachedPreserveItemsPlugins=null;function mustPreserveItems(state){let plugins=state.plugins;if(cachedPreserveItemsPlugins!=plugins){cachedPreserveItems=!1,cachedPreserveItemsPlugins=plugins;for(let i=0;i<plugins.length;i++)if(plugins[i].spec.historyPreserveItems){cachedPreserveItems=!0;break}}return cachedPreserveItems}const historyKey=new prosemirror_state_dist.hs("history"),closeHistoryKey=new prosemirror_state_dist.hs("closeHistory");function dist_history(config={}){return config={depth:config.depth||100,newGroupDelay:config.newGroupDelay||500},new prosemirror_state_dist.k_({key:historyKey,state:{init:()=>new HistoryState(Branch.empty,Branch.empty,null,0,-1),apply:(tr,hist,state)=>function applyTransaction(history,state,tr,options){let rebased,historyTr=tr.getMeta(historyKey);if(historyTr)return historyTr.historyState;tr.getMeta(closeHistoryKey)&&(history=new HistoryState(history.done,history.undone,null,0,-1));let appended=tr.getMeta("appendedTransaction");if(0==tr.steps.length)return history;if(appended&&appended.getMeta(historyKey))return appended.getMeta(historyKey).redo?new HistoryState(history.done.addTransform(tr,void 0,options,mustPreserveItems(state)),history.undone,rangesFor(tr.mapping.maps),history.prevTime,history.prevComposition):new HistoryState(history.done,history.undone.addTransform(tr,void 0,options,mustPreserveItems(state)),null,history.prevTime,history.prevComposition);if(!1===tr.getMeta("addToHistory")||appended&&!1===appended.getMeta("addToHistory"))return(rebased=tr.getMeta("rebased"))?new HistoryState(history.done.rebased(tr,rebased),history.undone.rebased(tr,rebased),mapRanges(history.prevRanges,tr.mapping),history.prevTime,history.prevComposition):new HistoryState(history.done.addMaps(tr.mapping.maps),history.undone.addMaps(tr.mapping.maps),mapRanges(history.prevRanges,tr.mapping),history.prevTime,history.prevComposition);{let composition=tr.getMeta("composition"),newGroup=0==history.prevTime||!appended&&history.prevComposition!=composition&&(history.prevTime<(tr.time||0)-options.newGroupDelay||!function isAdjacentTo(transform,prevRanges){if(!prevRanges)return!1;if(!transform.docChanged)return!0;let adjacent=!1;return transform.mapping.maps[0].forEach(((start,end)=>{for(let i=0;i<prevRanges.length;i+=2)start<=prevRanges[i+1]&&end>=prevRanges[i]&&(adjacent=!0)})),adjacent}(tr,history.prevRanges)),prevRanges=appended?mapRanges(history.prevRanges,tr.mapping):rangesFor(tr.mapping.maps);return new HistoryState(history.done.addTransform(tr,newGroup?state.selection.getBookmark():void 0,options,mustPreserveItems(state)),Branch.empty,prevRanges,tr.time,null==composition?history.prevComposition:composition)}}(hist,state,tr,config)},config,props:{handleDOMEvents:{beforeinput(view,e){let inputType=e.inputType,command="historyUndo"==inputType?undo:"historyRedo"==inputType?redo:null;return!!command&&(e.preventDefault(),command(view.state,view.dispatch))}}}})}function buildCommand(redo,scroll){return(state,dispatch)=>{let hist=historyKey.getState(state);if(!hist||0==(redo?hist.undone:hist.done).eventCount)return!1;if(dispatch){let tr=function histTransaction(history,state,redo){let preserveItems=mustPreserveItems(state),histOptions=historyKey.get(state).spec.config,pop=(redo?history.undone:history.done).popEvent(state,preserveItems);if(!pop)return null;let selection=pop.selection.resolve(pop.transform.doc),added=(redo?history.done:history.undone).addTransform(pop.transform,state.selection.getBookmark(),histOptions,preserveItems),newHist=new HistoryState(redo?added:pop.remaining,redo?pop.remaining:added,null,0,-1);return pop.transform.setSelection(selection).setMeta(historyKey,{redo,historyState:newHist})}(hist,state,redo);tr&&dispatch(scroll?tr.scrollIntoView():tr)}return!0}}const undo=buildCommand(!1,!0),redo=buildCommand(!0,!0);buildCommand(!1,!1),buildCommand(!0,!1);const History=core_dist.YY.create({name:"history",addOptions:()=>({depth:100,newGroupDelay:500}),addCommands:()=>({undo:()=>({state,dispatch})=>undo(state,dispatch),redo:()=>({state,dispatch})=>redo(state,dispatch)}),addProseMirrorPlugins(){return[dist_history(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-Ñ":()=>this.editor.commands.undo(),"Shift-Mod-Ñ":()=>this.editor.commands.redo()}}}),HorizontalRule=core_dist.bP.create({name:"horizontalRule",addOptions:()=>({HTMLAttributes:{}}),group:"block",parseHTML:()=>[{tag:"hr"}],renderHTML({HTMLAttributes}){return["hr",(0,core_dist.KV)(this.options.HTMLAttributes,HTMLAttributes)]},addCommands(){return{setHorizontalRule:()=>({chain,state})=>{const{selection}=state,{$from:$originFrom,$to:$originTo}=selection,currentChain=chain();return 0===$originFrom.parentOffset?currentChain.insertContentAt({from:Math.max($originFrom.pos-1,0),to:$originTo.pos},{type:this.name}):(0,core_dist.BQ)(selection)?currentChain.insertContentAt($originTo.pos,{type:this.name}):currentChain.insertContent({type:this.name}),currentChain.command((({tr,dispatch})=>{var _a;if(dispatch){const{$to}=tr.selection,posAfter=$to.end();if($to.nodeAfter)$to.nodeAfter.isTextblock?tr.setSelection(prosemirror_state_dist.U3.create(tr.doc,$to.pos+1)):$to.nodeAfter.isBlock?tr.setSelection(prosemirror_state_dist.nh.create(tr.doc,$to.pos)):tr.setSelection(prosemirror_state_dist.U3.create(tr.doc,$to.pos));else{const node=null===(_a=$to.parent.type.contentMatch.defaultType)||void 0===_a?void 0:_a.create();node&&(tr.insert(posAfter,node),tr.setSelection(prosemirror_state_dist.U3.create(tr.doc,posAfter+1)))}tr.scrollIntoView()}return!0})).run()}}},addInputRules(){return[(0,core_dist.jT)({find:/^(?:---|â-|___\s|\*\*\*\s)$/,type:this.type})]}}),dist_starInputRegex=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,dist_starPasteRegex=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,dist_underscoreInputRegex=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,dist_underscorePasteRegex=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Italic=core_dist.CU.create({name:"italic",addOptions:()=>({HTMLAttributes:{}}),parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:node=>"normal"!==node.style.fontStyle&&null},{style:"font-style=normal",clearMark:mark=>mark.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes}){return["em",(0,core_dist.KV)(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{setItalic:()=>({commands})=>commands.setMark(this.name),toggleItalic:()=>({commands})=>commands.toggleMark(this.name),unsetItalic:()=>({commands})=>commands.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[(0,core_dist.OX)({find:dist_starInputRegex,type:this.type}),(0,core_dist.OX)({find:dist_underscoreInputRegex,type:this.type})]},addPasteRules(){return[(0,core_dist.Zc)({find:dist_starPasteRegex,type:this.type}),(0,core_dist.Zc)({find:dist_underscorePasteRegex,type:this.type})]}}),ListItem=core_dist.bP.create({name:"listItem",addOptions:()=>({HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes}){return["li",(0,core_dist.KV)(this.options.HTMLAttributes,HTMLAttributes),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),extension_ordered_list_dist_inputRegex=/^(\d+)\.\s$/,OrderedList=core_dist.bP.create({name:"orderedList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes:()=>({start:{default:1,parseHTML:element=>element.hasAttribute("start")?parseInt(element.getAttribute("start")||"",10):1},type:{default:null,parseHTML:element=>element.getAttribute("type")}}),parseHTML:()=>[{tag:"ol"}],renderHTML({HTMLAttributes}){const{start,...attributesWithoutStart}=HTMLAttributes;return 1===start?["ol",(0,core_dist.KV)(this.options.HTMLAttributes,attributesWithoutStart),0]:["ol",(0,core_dist.KV)(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{toggleOrderedList:()=>({commands,chain})=>this.options.keepAttributes?chain().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes("listItem",this.editor.getAttributes("textStyle")).run():commands.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let inputRule=(0,core_dist.tG)({find:extension_ordered_list_dist_inputRegex,type:this.type,getAttributes:match=>({start:+match[1]}),joinPredicate:(match,node)=>node.childCount+node.attrs.start===+match[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(inputRule=(0,core_dist.tG)({find:extension_ordered_list_dist_inputRegex,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:match=>({start:+match[1],...this.editor.getAttributes("textStyle")}),joinPredicate:(match,node)=>node.childCount+node.attrs.start===+match[1],editor:this.editor})),[inputRule]}}),Paragraph=core_dist.bP.create({name:"paragraph",priority:1e3,addOptions:()=>({HTMLAttributes:{}}),group:"block",content:"inline*",parseHTML:()=>[{tag:"p"}],renderHTML({HTMLAttributes}){return["p",(0,core_dist.KV)(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{setParagraph:()=>({commands})=>commands.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),extension_strike_dist_inputRegex=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,extension_strike_dist_pasteRegex=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,Strike=core_dist.CU.create({name:"strike",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:style=>!!style.includes("line-through")&&{}}],renderHTML({HTMLAttributes}){return["s",(0,core_dist.KV)(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{setStrike:()=>({commands})=>commands.setMark(this.name),toggleStrike:()=>({commands})=>commands.toggleMark(this.name),unsetStrike:()=>({commands})=>commands.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[(0,core_dist.OX)({find:extension_strike_dist_inputRegex,type:this.type})]},addPasteRules(){return[(0,core_dist.Zc)({find:extension_strike_dist_pasteRegex,type:this.type})]}}),dist_Text=core_dist.bP.create({name:"text",group:"inline"}),StarterKit=core_dist.YY.create({name:"starterKit",addExtensions(){const extensions=[];return!1!==this.options.bold&&extensions.push(Bold.configure(this.options.bold)),!1!==this.options.blockquote&&extensions.push(Blockquote.configure(this.options.blockquote)),!1!==this.options.bulletList&&extensions.push(BulletList.configure(this.options.bulletList)),!1!==this.options.code&&extensions.push(Code.configure(this.options.code)),!1!==this.options.codeBlock&&extensions.push(CodeBlock.configure(this.options.codeBlock)),!1!==this.options.document&&extensions.push(Document.configure(this.options.document)),!1!==this.options.dropcursor&&extensions.push(Dropcursor.configure(this.options.dropcursor)),!1!==this.options.gapcursor&&extensions.push(Gapcursor.configure(this.options.gapcursor)),!1!==this.options.hardBreak&&extensions.push(HardBreak.configure(this.options.hardBreak)),!1!==this.options.heading&&extensions.push(Heading.configure(this.options.heading)),!1!==this.options.history&&extensions.push(History.configure(this.options.history)),!1!==this.options.horizontalRule&&extensions.push(HorizontalRule.configure(this.options.horizontalRule)),!1!==this.options.italic&&extensions.push(Italic.configure(this.options.italic)),!1!==this.options.listItem&&extensions.push(ListItem.configure(this.options.listItem)),!1!==this.options.orderedList&&extensions.push(OrderedList.configure(this.options.orderedList)),!1!==this.options.paragraph&&extensions.push(Paragraph.configure(this.options.paragraph)),!1!==this.options.strike&&extensions.push(Strike.configure(this.options.strike)),!1!==this.options.text&&extensions.push(dist_Text.configure(this.options.text)),extensions}}),DefaultFontFaces={tldraw_draw:{normal:{normal:{family:"tldraw_draw",src:{url:"tldraw_draw",format:"woff2"},weight:"normal"},bold:{family:"tldraw_draw",src:{url:"tldraw_draw_bold",format:"woff2"},weight:"bold"}},italic:{normal:{family:"tldraw_draw",src:{url:"tldraw_draw_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_draw",src:{url:"tldraw_draw_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_sans:{normal:{normal:{family:"tldraw_sans",src:{url:"tldraw_sans",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_sans",src:{url:"tldraw_sans_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_sans",src:{url:"tldraw_sans_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_sans",src:{url:"tldraw_sans_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_serif:{normal:{normal:{family:"tldraw_serif",src:{url:"tldraw_serif",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_serif",src:{url:"tldraw_serif_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_serif",src:{url:"tldraw_serif_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_serif",src:{url:"tldraw_serif_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_mono:{normal:{normal:{family:"tldraw_mono",src:{url:"tldraw_mono",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_mono",src:{url:"tldraw_mono_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_mono",src:{url:"tldraw_mono_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_mono",src:{url:"tldraw_mono_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}}},allDefaultFontFaces=(0,dist_esm.Ics)(DefaultFontFaces).flatMap((font=>(0,dist_esm.Ics)(font).flatMap((fontFace=>Object.values(fontFace))))),TextDirection=core_dist.YY.create({name:"textDirection",addGlobalAttributes:()=>[{types:["heading","paragraph"],attributes:{dir:{default:"auto",parseHTML:element=>{const dirAttribute=element.getAttribute("dir");return dirAttribute&&["ltr","rtl","auto"].includes(dirAttribute)?dirAttribute:"auto"},renderHTML:attributes=>({dir:attributes.dir})}}}]}),KeyboardShiftEnterTweakExtension=core_dist.YY.create({name:"keyboardShiftEnterHandler",addKeyboardShortcuts:()=>({"Shift-Enter":({editor})=>editor.commands.enter()})});Code.config.excludes=void 0,Highlight.config.priority=1100;const tipTapDefaultExtensions=[StarterKit.configure({blockquote:!1,codeBlock:!1,horizontalRule:!1}),Link.configure({openOnClick:!1,autolink:!0}),Highlight,KeyboardShiftEnterTweakExtension,TextDirection];function renderHtmlFromRichText(editor,richText){const tipTapExtensions=editor.getTextOptions().tipTapConfig?.extensions??tipTapDefaultExtensions;return(0,core_dist.Zx)(richText,tipTapExtensions).replaceAll('<p dir="auto"></p>',"<p><br /></p>")??""}function renderHtmlFromRichTextForMeasurement(editor,richText){return`<div class="tl-rich-text">${renderHtmlFromRichText(editor,richText)}</div>`}const plainTextFromRichTextCache=new dist_esm.laH;function isEmptyRichText(richText){return 1===richText.content.length&&!richText.content[0].content}function renderPlaintextFromRichText(editor,richText){return isEmptyRichText(richText)?"":plainTextFromRichTextCache.get(richText,(()=>{const tipTapExtensions=editor.getTextOptions().tipTapConfig?.extensions??tipTapDefaultExtensions;return(0,core_dist.Df)(richText,tipTapExtensions,{blockSeparator:"\n"})}))}function defaultAddFontsFromNode(node,state,addFont){for(const mark of node.marks)"bold"===mark.type.name&&"bold"!==state.weight&&(state={...state,weight:"bold"}),"italic"===mark.type.name&&"italic"!==state.style&&(state={...state,style:"italic"}),"code"===mark.type.name&&"tldraw_mono"!==state.family&&(state={...state,family:"tldraw_mono"});const fontsForFamily=(0,dist_esm.g50)(DefaultFontFaces,state.family);if(!fontsForFamily)return state;const fontsForStyle=(0,dist_esm.g50)(fontsForFamily,state.style);if(!fontsForStyle)return state;const fontsForWeight=(0,dist_esm.g50)(fontsForStyle,state.weight);return fontsForWeight?(addFont(fontsForWeight),state):state}const INDENT="  ";class TextHelpers{static fixNewLines=/\r?\n|\r/g;static normalizeText(text){return text.replace(TextHelpers.fixNewLines,"\n")}static normalizeTextForDom(text){return text.replace(TextHelpers.fixNewLines,"\n").split("\n").map((x=>x||" ")).join("\n")}}const rtlRegex=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function isRightToLeftLanguage(text){return rtlRegex.test(text)}const COMMON_ENTITY_MAP={"&amp;":"&","&quot;":'"',"&apos;":"'","&#27;":"'","&#34;":'"',"&#38;":"&","&#39;":"'","&#8211;":"â","&#8212;":"â","&#8216;":"â","&#8217;":"â","&#8220;":"â","&#8221;":"â","&#8230;":"â¦"},entityRegex=new RegExp(Object.keys(COMMON_ENTITY_MAP).join("|"),"g");function convertCommonTitleHTMLEntities(text){return text.replace(entityRegex,(m=>COMMON_ENTITY_MAP[m]))}function cleanupText(text){return function stripTrailingWhitespace(text){return text.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}(function stripCommonMinimumIndentation(text){const lines=text.split("\n");for(;lines[0]&&0===lines[0].trim().length;)lines.shift();let minIndentation=1/0;for(const line of lines)if(line.trim().length>0){const indentation=line.length-line.trimStart().length;minIndentation=Math.min(minIndentation,indentation)}return lines.map((line=>line.slice(minIndentation))).join("\n")}(function replaceTabsWithSpaces(text){return text.replace(/\t/g,INDENT)}(text)))}const DEFAULT_MAX_IMAGE_DIMENSION=5e3,DEFAULT_MAX_ASSET_SIZE=10485760;function registerDefaultExternalContentHandlers(editor,options){editor.registerExternalAssetHandler("file",(async externalAsset=>async function defaultHandleExternalFileAsset(editor,{file,assetId},{acceptedImageMimeTypes=dist_esm.RBp,acceptedVideoMimeTypes=dist_esm.qSO,maxAssetSize=DEFAULT_MAX_ASSET_SIZE,maxImageDimension=DEFAULT_MAX_IMAGE_DIMENSION,toasts,msg}){const isImageType=acceptedImageMimeTypes.includes(file.type),isVideoType=acceptedVideoMimeTypes.includes(file.type);isImageType||isVideoType||toasts.addToast({title:msg("assets.files.type-not-allowed"),severity:"error"});(0,dist_esm.vAR)(isImageType||isVideoType,`File type not allowed: ${file.type}`),file.size>maxAssetSize&&toasts.addToast({title:msg("assets.files.size-too-big"),severity:"error"});(0,dist_esm.vAR)(file.size<=maxAssetSize,`File size too big: ${(file.size/1024).toFixed()}kb > ${(maxAssetSize/1024).toFixed()}kb`);const hash=(0,dist_esm.Gwq)(await file.arrayBuffer());assetId=assetId??dist_esm.Kx3.createId(hash);const assetInfo=await getMediaAssetInfoPartial(file,assetId,isImageType,isVideoType,maxImageDimension),result=await editor.uploadAsset(assetInfo,file);assetInfo.props.src=result.src,result.meta&&(assetInfo.meta={...assetInfo.meta,...result.meta});return dist_esm.Kx3.create(assetInfo)}(editor,externalAsset,options))),editor.registerExternalAssetHandler("url",(async externalAsset=>async function defaultHandleExternalUrlAsset(editor,{url},{toasts,msg}){let meta;try{const resp=await(0,dist_esm.hdJ)(url,{method:"GET",mode:"no-cors"}),html=await resp.text(),doc=(new DOMParser).parseFromString(html,"text/html");meta={image:doc.head.querySelector('meta[property="og:image"]')?.getAttribute("content")??"",favicon:doc.head.querySelector('link[rel="apple-touch-icon"]')?.getAttribute("href")??doc.head.querySelector('link[rel="icon"]')?.getAttribute("href")??"",title:doc.head.querySelector('meta[property="og:title"]')?.getAttribute("content")??url,description:doc.head.querySelector('meta[property="og:description"]')?.getAttribute("content")??""},meta.image.startsWith("http")||(meta.image=new URL(meta.image,url).href),meta.favicon.startsWith("http")||(meta.favicon=new URL(meta.favicon,url).href)}catch(error){console.error(error),toasts.addToast({title:msg("assets.url.failed"),severity:"error"}),meta={image:"",favicon:"",title:"",description:""}}return{id:dist_esm.Kx3.createId((0,dist_esm.xpx)(url)),typeName:"asset",type:"bookmark",props:{src:url,description:meta.description,image:meta.image,favicon:meta.favicon,title:meta.title},meta:{}}}(0,externalAsset,options))),editor.registerExternalContentHandler("svg-text",(async externalContent=>async function defaultHandleExternalSvgTextContent(editor,{point,text}){const position=point??(editor.inputs.shiftKey?editor.inputs.currentPagePoint:editor.getViewportPageBounds().center),svg=(new DOMParser).parseFromString(text,"image/svg+xml").querySelector("svg");if(!svg)throw new Error("No <svg/> element present");let width=parseFloat(svg.getAttribute("width")||"0"),height=parseFloat(svg.getAttribute("height")||"0");if(!width||!height){document.body.appendChild(svg);const box=svg.getBoundingClientRect();document.body.removeChild(svg),width=box.width,height=box.height}const asset=await editor.getAssetForExternalContent({type:"file",file:new File([text],"asset.svg",{type:"image/svg+xml"})});if(!asset)throw Error("Could not create an asset");createShapesForAssets(editor,[asset],position)}(editor,externalContent))),editor.registerExternalContentHandler("embed",(externalContent=>function defaultHandleExternalEmbedContent(editor,{point,url,embed}){const position=point??(editor.inputs.shiftKey?editor.inputs.currentPagePoint:editor.getViewportPageBounds().center),{width,height}=embed,id=(0,dist_esm.n6Y)(),newPoint=(0,dist_esm.Y8F)(new dist_esm.l2P(position.x-(width||450)/2,position.y-(height||450)/2),editor),shapePartial={id,type:"embed",x:newPoint.x,y:newPoint.y,props:{w:width,h:height,url}};editor.createShapes([shapePartial]).select(id)}(editor,externalContent))),editor.registerExternalContentHandler("files",(async externalContent=>async function defaultHandleExternalFileContent(editor,{point,files},{maxAssetSize=DEFAULT_MAX_ASSET_SIZE,maxImageDimension=DEFAULT_MAX_IMAGE_DIMENSION,acceptedImageMimeTypes=dist_esm.RBp,acceptedVideoMimeTypes=dist_esm.qSO,toasts,msg}){if(files.length>editor.options.maxFilesAtOnce)return void toasts.addToast({title:msg("assets.files.amount-too-big"),severity:"error"});const position=point??(editor.inputs.shiftKey?editor.inputs.currentPagePoint:editor.getViewportPageBounds().center),pagePoint=new dist_esm.l2P(position.x,position.y),assetPartials=[],assetsToUpdate=[];for(const file of files){if(file.size>maxAssetSize){toasts.addToast({title:msg("assets.files.size-too-big"),severity:"error"}),console.warn(`File size too big: ${(file.size/1024).toFixed()}kb > ${(maxAssetSize/1024).toFixed()}kb`);continue}if(!file.type){toasts.addToast({title:msg("assets.files.upload-failed"),severity:"error"}),console.error("No mime type");continue}if(![...acceptedImageMimeTypes,...acceptedVideoMimeTypes].includes(file.type)){toasts.addToast({title:msg("assets.files.type-not-allowed"),severity:"error"}),console.warn(`${file.name} not loaded - Mime type not allowed ${file.type}.`);continue}const isImageType=acceptedImageMimeTypes.includes(file.type),isVideoType=acceptedVideoMimeTypes.includes(file.type),hash=(0,dist_esm.Gwq)(await file.arrayBuffer()),assetId=dist_esm.Kx3.createId(hash),assetInfo=await getMediaAssetInfoPartial(file,assetId,isImageType,isVideoType,maxImageDimension);let temporaryAssetPreview;isImageType&&(temporaryAssetPreview=editor.createTemporaryAssetPreview(assetId,file)),assetPartials.push(assetInfo),assetsToUpdate.push({asset:assetInfo,file,temporaryAssetPreview})}Promise.allSettled(assetsToUpdate.map((async assetAndFile=>{try{const newAsset=await editor.getAssetForExternalContent({type:"file",file:assetAndFile.file});if(!newAsset)throw Error("Could not create an asset");editor.updateAssets([{...newAsset,id:assetAndFile.asset.id}])}catch(error){return toasts.addToast({title:msg("assets.files.upload-failed"),severity:"error"}),console.error(error),void editor.deleteAssets([assetAndFile.asset.id])}}))),createShapesForAssets(editor,assetPartials,pagePoint)}(editor,externalContent,options))),editor.registerExternalContentHandler("text",(async externalContent=>async function defaultHandleExternalTextContent(editor,{point,text,html}){const p=point??(editor.inputs.shiftKey?editor.inputs.currentPagePoint:editor.getViewportPageBounds().center),defaultProps=editor.getShapeUtil("text").getDefaultProps(),cleanedUpPlaintext=cleanupText(text),richTextToPaste=html?function renderRichTextFromHTML(editor,html){const tipTapExtensions=editor.getTextOptions().tipTapConfig?.extensions??tipTapDefaultExtensions;return(0,core_dist.yQ)(html,tipTapExtensions)}(editor,html):(0,dist_esm.TP3)(cleanedUpPlaintext);let w,h,autoSize,align="middle";const htmlToMeasure=html??cleanedUpPlaintext.replace(/\n/g,"<br>"),isMultiLine=html?richTextToPaste.content.length>1:cleanedUpPlaintext.split("\n").length>1,isRtl=isRightToLeftLanguage(cleanedUpPlaintext);isMultiLine&&(align=isMultiLine?isRtl?"end":"start":"middle");const rawSize=editor.textMeasure.measureHtml(htmlToMeasure,{...TEXT_PROPS,fontFamily:FONT_FAMILIES[defaultProps.font],fontSize:FONT_SIZES[defaultProps.size],maxWidth:null}),minWidth=Math.min(isMultiLine?.9*editor.getViewportPageBounds().width:920,Math.max(200,.9*editor.getViewportPageBounds().width));if(rawSize.w>minWidth){const shrunkSize=editor.textMeasure.measureHtml(htmlToMeasure,{...TEXT_PROPS,fontFamily:FONT_FAMILIES[defaultProps.font],fontSize:FONT_SIZES[defaultProps.size],maxWidth:minWidth});w=shrunkSize.w,h=shrunkSize.h,autoSize=!1,align=isRtl?"end":"start"}else w=rawSize.w,h=rawSize.h,autoSize=!0;p.y-h/2<editor.getViewportPageBounds().minY+40&&(p.y=editor.getViewportPageBounds().minY+40+h/2);const newPoint=(0,dist_esm.Y8F)(new dist_esm.l2P(p.x-w/2,p.y-h/2),editor);editor.createShapes([{id:(0,dist_esm.n6Y)(),type:"text",x:newPoint.x,y:newPoint.y,props:{richText:richTextToPaste,textAlign:align,autoSize,w}}])}(editor,externalContent))),editor.registerExternalContentHandler("url",(async externalContent=>async function defaultHandleExternalUrlContent(editor,{point,url},{toasts,msg}){const embedUtil=editor.getShapeUtil("embed"),embedInfo=embedUtil?.getEmbedDefinition(url);if(embedInfo)return editor.putExternalContent({type:"embed",url:embedInfo.url,point,embed:embedInfo.definition});const position=point??(editor.inputs.shiftKey?editor.inputs.currentPagePoint:editor.getViewportPageBounds().center),assetId=dist_esm.Kx3.createId((0,dist_esm.xpx)(url)),shape=function createEmptyBookmarkShape(editor,url,position){const partial={id:(0,dist_esm.n6Y)(),type:"bookmark",x:position.x-150,y:position.y-160,opacity:1,props:{assetId:null,url}};return editor.run((()=>{editor.createShapes([partial]).select(partial.id),centerSelectionAroundPoint(editor,position)})),editor.getShape(partial.id)}(editor,url,position);let asset=editor.getAsset(assetId),shouldAlsoCreateAsset=!1;if(!asset){shouldAlsoCreateAsset=!0;try{const bookmarkAsset=await editor.getAssetForExternalContent({type:"url",url});if(!bookmarkAsset)throw Error("Could not create an asset");asset=bookmarkAsset}catch{return void toasts.addToast({title:msg("assets.url.failed"),severity:"error"})}}editor.run((()=>{shouldAlsoCreateAsset&&editor.createAssets([asset]),editor.updateShapes([{id:shape.id,type:shape.type,props:{assetId:asset.id}}])}))}(editor,externalContent,options))),editor.registerExternalContentHandler("tldraw",(async externalContent=>async function defaultHandleExternalTldrawContent(editor,{point,content}){editor.run((()=>{const selectionBoundsBefore=editor.getSelectionPageBounds();editor.markHistoryStoppingPoint("paste"),editor.putContentOntoCurrentPage(content,{point,select:!0});const selectedBoundsAfter=editor.getSelectionPageBounds();selectionBoundsBefore&&selectedBoundsAfter&&selectionBoundsBefore?.collides(selectedBoundsAfter)&&(editor.updateInstanceState({isChangingStyle:!0}),editor.timers.setTimeout((()=>{editor.updateInstanceState({isChangingStyle:!1})}),150))}))}(editor,externalContent))),editor.registerExternalContentHandler("excalidraw",(async externalContent=>async function defaultHandleExternalExcalidrawContent(editor,{point,content}){editor.run((()=>{!async function putExcalidrawContent(editor,excalidrawClipboardContent,point){const{elements,files}=excalidrawClipboardContent,tldrawContent={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:editor.store.schema.serialize()},groupShapeIdToChildren=new Map,rotatedElements=new Map,currentPageId=editor.getCurrentPageId(),excElementIdsToTldrawShapeIds=new Map,rootShapeIds=[],skipIds=new Set;elements.forEach((element=>{if(excElementIdsToTldrawShapeIds.set(element.id,(0,dist_esm.n6Y)()),null!==element.boundElements)for(const boundElement of element.boundElements)"text"===boundElement.type&&skipIds.add(boundElement.id)}));let index=dist_esm.as9;for(const element of elements){if(skipIds.has(element.id))continue;const id=excElementIdsToTldrawShapeIds.get(element.id),base={id,typeName:"shape",parentId:currentPageId,index,x:element.x,y:element.y,rotation:0,isLocked:element.locked,opacity:getOpacity(element.opacity),meta:{}};switch(0!==element.angle&&rotatedElements.set(id,element.angle),element.groupIds&&element.groupIds.length>0?groupShapeIdToChildren.has(element.groupIds[0])?groupShapeIdToChildren.get(element.groupIds[0])?.push(id):groupShapeIdToChildren.set(element.groupIds[0],[id]):rootShapeIds.push(id),element.type){case"rectangle":case"ellipse":case"diamond":{let text="",align="middle";if(null!==element.boundElements)for(const boundElement of element.boundElements)if("text"===boundElement.type){const labelElement=elements.find((elm=>elm.id===boundElement.id));labelElement&&(text=labelElement.text,align=textAlignToAlignTypes[labelElement.textAlign])}const colorToUse="transparent"===element.backgroundColor?element.strokeColor:element.backgroundColor;tldrawContent.shapes.push({...base,type:"geo",props:{geo:element.type,url:element.link??"",w:element.width,h:element.height,size:strokeWidthsToSizes[element.strokeWidth]??"draw",color:colorsToColors[colorToUse]??"black",richText:(0,dist_esm.TP3)(text),align,dash:getDash(element),fill:getFill(element)}});break}case"freedraw":tldrawContent.shapes.push({...base,type:"draw",props:{dash:getDash(element),size:strokeWidthsToSizes[element.strokeWidth],color:colorsToColors[element.strokeColor]??"black",segments:[{type:"free",points:element.points.map((([x,y,z=.5])=>({x,y,z})))}]}});break;case"line":{if(element.points.slice().length<2)break;const indices=(0,dist_esm.uud)(element.points.length);tldrawContent.shapes.push({...base,type:"line",props:{dash:getDash(element),size:strokeWidthsToSizes[element.strokeWidth],color:colorsToColors[element.strokeColor]??"black",spline:element.roundness?"cubic":"line",points:{...Object.fromEntries(element.points.map((([x,y],i)=>{const index2=indices[i];return[index2,{id:index2,index:index2,x,y}]})))}}});break}case"arrow":{let text="";if(null!==element.boundElements)for(const boundElement of element.boundElements)if("text"===boundElement.type){const labelElement=elements.find((elm=>elm.id===boundElement.id));labelElement&&(text=labelElement.text)}const start=element.points[0],end=element.points[element.points.length-1],startTargetId=excElementIdsToTldrawShapeIds.get(element.startBinding?.elementId),endTargetId=excElementIdsToTldrawShapeIds.get(element.endBinding?.elementId);tldrawContent.shapes.push({...base,type:"arrow",props:{text,kind:element.elbowed?"elbow":"arc",bend:getBend(element,start,end),dash:getDash(element),size:strokeWidthsToSizes[element.strokeWidth]??"m",color:colorsToColors[element.strokeColor]??"black",start:{x:start[0],y:start[1]},end:{x:end[0],y:end[1]},arrowheadEnd:arrowheadsToArrowheadTypes[element.endArrowhead]??"none",arrowheadStart:arrowheadsToArrowheadTypes[element.startArrowhead]??"none"}}),startTargetId&&tldrawContent.bindings.push({id:(0,dist_esm.BNi)(),typeName:"binding",type:"arrow",fromId:id,toId:startTargetId,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),endTargetId&&tldrawContent.bindings.push({id:(0,dist_esm.BNi)(),typeName:"binding",type:"arrow",fromId:id,toId:endTargetId,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{const{size,scale}=getFontSizeAndScale(element.fontSize);tldrawContent.shapes.push({...base,type:"text",props:{size,scale,font:fontFamilyToFontType[element.fontFamily]??"draw",color:colorsToColors[element.strokeColor]??"black",richText:(0,dist_esm.TP3)(element.text),textAlign:textAlignToTextAlignTypes[element.textAlign]}});break}case"image":{const file=files[element.fileId];if(!file)break;const assetId=dist_esm.Kx3.createId();tldrawContent.assets.push({id:assetId,typeName:"asset",type:"image",props:{w:element.width,h:element.height,fileSize:file.size,name:element.id??"Untitled",isAnimated:!1,mimeType:file.mimeType,src:file.dataURL},meta:{}}),tldrawContent.shapes.push({...base,type:"image",props:{w:element.width,h:element.height,assetId}})}}index=(0,dist_esm.AQy)(index)}const p=point??(editor.inputs.shiftKey?editor.inputs.currentPagePoint:void 0);editor.putContentOntoCurrentPage(tldrawContent,{point:p,select:!1,preserveIds:!0});for(const groupedShapeIds of groupShapeIdToChildren.values())if(groupedShapeIds.length>1){editor.groupShapes(groupedShapeIds);const groupShape=editor.getShape(groupedShapeIds[0]);groupShape?.parentId&&(0,dist_esm.vc4)(groupShape.parentId)&&rootShapeIds.push(groupShape.parentId)}for(const[id,angle]of rotatedElements)editor.select(id),editor.rotateShapesBy([id],angle);const rootShapes=(0,dist_esm.oE7)(rootShapeIds.map((id=>editor.getShape(id)))),bounds=dist_esm.azJ.Common(rootShapes.map((s=>editor.getShapePageBounds(s)))),viewPortCenter=editor.getViewportPageBounds().center;editor.updateShapes(rootShapes.map((s=>{const delta_x=(s.x??0)-(bounds.x+bounds.w/2),delta_y=(s.y??0)-(bounds.y+bounds.h/2);return{id:s.id,type:s.type,x:viewPortCenter.x+delta_x,y:viewPortCenter.y+delta_y}}))),editor.setSelectedShapes(rootShapeIds)}(editor,content,point)}))}(editor,externalContent)))}async function getMediaAssetInfoPartial(file,assetId,isImageType,isVideoType,maxImageDimension){let fileType=file.type;"video/quicktime"===file.type&&(fileType="video/mp4");const size=isImageType?await dist_esm.K4L.getImageSize(file):await dist_esm.K4L.getVideoSize(file),isAnimated=await dist_esm.K4L.isAnimated(file)||isVideoType,assetInfo={id:assetId,type:isImageType?"image":"video",typeName:"asset",props:{name:file.name,src:"",w:size.w,h:size.h,fileSize:file.size,mimeType:fileType,isAnimated},meta:{}};if(maxImageDimension&&isFinite(maxImageDimension)){const size2={w:assetInfo.props.w,h:assetInfo.props.h},resizedSize=function containBoxSize(originalSize,containBoxSize2){const overByXScale=originalSize.w/containBoxSize2.w,overByYScale=originalSize.h/containBoxSize2.h;return overByXScale<=1&&overByYScale<=1?originalSize:overByXScale>overByYScale?{w:originalSize.w/overByXScale,h:originalSize.h/overByXScale}:{w:originalSize.w/overByYScale,h:originalSize.h/overByYScale}}(size2,{w:maxImageDimension,h:maxImageDimension});size2!==resizedSize&&dist_esm.K4L.isStaticImageType(file.type)&&(assetInfo.props.w=resizedSize.w,assetInfo.props.h=resizedSize.h)}return assetInfo}async function createShapesForAssets(editor,assets,position){if(!assets.length)return[];const currentPoint=dist_esm.l2P.From(position),partials=[];for(let i=0;i<assets.length;i++){const asset=assets[i];switch(asset.type){case"image":partials.push({id:(0,dist_esm.n6Y)(),type:"image",x:currentPoint.x,y:currentPoint.y,opacity:1,props:{assetId:asset.id,w:asset.props.w,h:asset.props.h}}),currentPoint.x+=asset.props.w;break;case"video":partials.push({id:(0,dist_esm.n6Y)(),type:"video",x:currentPoint.x,y:currentPoint.y,opacity:1,props:{assetId:asset.id,w:asset.props.w,h:asset.props.h}}),currentPoint.x+=asset.props.w}}return editor.run((()=>{const assetsToCreate=assets.filter((asset=>!editor.getAsset(asset.id)));editor.store.atomic((()=>{assetsToCreate.length&&editor.createAssets(assetsToCreate),editor.createShapes(partials).select(...partials.map((p=>p.id))),centerSelectionAroundPoint(editor,position)}))})),partials.map((p=>p.id))}function centerSelectionAroundPoint(editor,position){const viewportPageBounds=editor.getViewportPageBounds();let selectionPageBounds=editor.getSelectionPageBounds();if(selectionPageBounds){const offset=selectionPageBounds.center.sub(position);editor.updateShapes(editor.getSelectedShapes().map((shape=>{const localRotation=editor.getShapeParentTransform(shape).decompose().rotation,localDelta=dist_esm.l2P.Rot(offset,-localRotation);return{id:shape.id,type:shape.type,x:shape.x-localDelta.x,y:shape.y-localDelta.y}})))}if(selectionPageBounds=editor.getSelectionPageBounds(),selectionPageBounds&&editor.getInstanceState().isGridMode){const gridSize=editor.getDocumentSettings().gridSize,topLeft=new dist_esm.l2P(selectionPageBounds.minX,selectionPageBounds.minY),gridSnappedPoint=topLeft.clone().snapToGrid(gridSize),delta=dist_esm.l2P.Sub(topLeft,gridSnappedPoint);editor.updateShapes(editor.getSelectedShapes().map((shape=>{const newPoint={x:shape.x-delta.x,y:shape.y-delta.y};return{id:shape.id,type:shape.type,x:newPoint.x,y:newPoint.y}})))}selectionPageBounds=editor.getSelectionPageBounds(),selectionPageBounds&&!viewportPageBounds.contains(selectionPageBounds)&&editor.zoomToSelection({animation:{duration:editor.options.animationMediumMs}})}class Idle extends dist_esm.YM5{static id="idle";options=this.editor.getShapeUtil("arrow").options;isPrecise=!1;isPreciseTimerId=null;preciseTargetId=null;onPointerMove(){this.update()}onPointerDown(info){this.parent.transition("pointing",{...info,isPrecise:this.isPrecise})}onEnter(){this.editor.setCursor({type:"cross",rotation:0}),this.update()}onCancel(){this.editor.setCurrentTool("select")}onExit(){clearArrowTargetState(this.editor),null!==this.isPreciseTimerId&&clearTimeout(this.isPreciseTimerId)}onKeyDown(){this.update()}onKeyUp(info){if(this.update(),"Enter"===info.key){if(this.editor.getIsReadonly())return null;const onlySelectedShape=this.editor.getOnlySelectedShape();onlySelectedShape&&this.editor.getShapeUtil(onlySelectedShape).canEdit(onlySelectedShape)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(onlySelectedShape.id),this.editor.root.getCurrent()?.transition("editing_shape",{...info,target:"shape",shape:onlySelectedShape}))}}update(){const targetState=updateArrowTargetState({editor:this.editor,pointInPageSpace:this.editor.inputs.currentPagePoint,arrow:void 0,isPrecise:this.isPrecise,isExact:this.editor.inputs.altKey,currentBinding:void 0,oppositeBinding:void 0});targetState&&targetState.target.id!==this.preciseTargetId?(null!==this.isPreciseTimerId&&clearTimeout(this.isPreciseTimerId),this.preciseTargetId=targetState.target.id,this.isPreciseTimerId=this.editor.timers.setTimeout((()=>{this.isPrecise=!0,this.update()}),this.options.hoverPreciseTimeout)):!targetState&&this.preciseTargetId&&(this.isPrecise=!1,this.preciseTargetId=null,null!==this.isPreciseTimerId&&clearTimeout(this.isPreciseTimerId))}}class Pointing extends dist_esm.YM5{static id="pointing";options=this.editor.getShapeUtil("arrow").options;shape;isPrecise=!1;isPreciseTimerId=null;markId="";onEnter(info){this.markId="",this.isPrecise=!!info.isPrecise;updateArrowTargetState({editor:this.editor,pointInPageSpace:this.editor.inputs.currentPagePoint,arrow:void 0,isPrecise:this.isPrecise,isExact:this.editor.inputs.altKey,currentBinding:void 0,oppositeBinding:void 0})||this.createArrowShape(),this.startPreciseTimeout()}onExit(){this.shape=void 0,clearArrowTargetState(this.editor),this.clearPreciseTimeout()}onPointerMove(){if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,creatingMarkId:this.markId||void 0,onInteractionEnd:"arrow"})}}onPointerUp(){this.cancel()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.parent.transition("idle")}createArrowShape(){const{originPagePoint}=this.editor.inputs,id=(0,dist_esm.n6Y)();this.markId=this.editor.markHistoryStoppingPoint(`creating_arrow:${id}`);const newPoint=(0,dist_esm.Y8F)(originPagePoint,this.editor);this.editor.createShape({id,type:"arrow",x:newPoint.x,y:newPoint.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const shape=this.editor.getShape(id);if(!shape)throw Error("expected shape");const handles=this.editor.getShapeHandles(shape);if(!handles)throw Error("expected handles for arrow");const util=this.editor.getShapeUtil("arrow"),initial=this.shape,startHandle=handles.find((h=>"start"===h.id)),change=util.onHandleDrag?.(shape,{handle:{...startHandle,x:0,y:0},isPrecise:!0,initial});change&&this.editor.updateShapes([change]),this.shape=this.editor.getShape(id),this.editor.select(id)}updateArrowShapeEndHandle(){const shape=this.shape;if(!shape)throw Error("expected shape");const handles=this.editor.getShapeHandles(shape);if(!handles)throw Error("expected handles for arrow");{const util=this.editor.getShapeUtil("arrow"),initial=this.shape,startHandle=handles.find((h=>"start"===h.id)),change=util.onHandleDrag?.(shape,{handle:{...startHandle,x:0,y:0},isPrecise:this.isPrecise,initial});change&&this.editor.updateShapes([change])}{const util=this.editor.getShapeUtil("arrow"),initial=this.shape,point=this.editor.getPointInShapeSpace(shape,this.editor.inputs.currentPagePoint),endHandle=handles.find((h=>"end"===h.id)),change=util.onHandleDrag?.(this.editor.getShape(shape),{handle:{...endHandle,x:point.x,y:point.y},isPrecise:!1,initial});change&&this.editor.updateShapes([change])}this.shape=this.editor.getShape(shape.id)}startPreciseTimeout(){this.isPreciseTimerId=this.editor.timers.setTimeout((()=>{this.getIsActive()&&(this.isPrecise=!0)}),this.options.pointingPreciseTimeout)}clearPreciseTimeout(){null!==this.isPreciseTimerId&&clearTimeout(this.isPreciseTimerId)}}class ArrowShapeTool extends dist_esm.YM5{static id="arrow";static initial="idle";static children(){return[Idle,Pointing]}shapeType="arrow"}class Drawing extends dist_esm.YM5{static id="drawing";info={};initialShape;shapeType="highlight"===this.parent.id?"highlight":"draw";util=this.editor.getShapeUtil(this.shapeType);isPen=!1;isPenOrStylus=!1;segmentMode="free";didJustShiftClickToExtendPreviousShapeLine=!1;pagePointWhereCurrentSegmentChanged={};pagePointWhereNextSegmentChanged=null;lastRecordedPoint={};mergeNextPoint=!1;currentLineLength=0;markId=null;onEnter(info){this.markId=null,this.info=info,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.startShape()}onPointerMove(){const{inputs}=this.editor;if(this.isPen&&!inputs.isPen&&this.markId)return this.editor.bailToMark(this.markId),void this.startShape();this.isPenOrStylus?dist_esm.l2P.Dist(inputs.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=inputs.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape()}onKeyDown(info){if("Shift"===info.key)switch(this.segmentMode){case"free":this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()}onKeyUp(info){if("Shift"===info.key)switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_straight":this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free"}this.updateDrawingShape()}onExit(){this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()}canClose(){return"highlight"!==this.shapeType}getIsClosed(segments,size,scale){if(!this.canClose())return!1;const strokeWidth=default_shape_constants_STROKE_SIZES[size],firstPoint=segments[0].points[0],lastSegment=segments[segments.length-1],lastPoint=lastSegment.points[lastSegment.points.length-1];return firstPoint!==lastPoint&&this.currentLineLength>4*strokeWidth*scale&&dist_esm.l2P.DistMin(firstPoint,lastPoint,2*strokeWidth*scale)}startShape(){const{inputs:{originPagePoint,isPen}}=this.editor;this.markId=this.editor.markHistoryStoppingPoint("draw start");const{z=.5}=this.info.point;this.isPen=isPen,this.isPenOrStylus=isPen||z>0&&z<.5||z>.5&&z<1;const pressure=this.isPenOrStylus?1.25*z:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=originPagePoint.clone(),this.initialShape){const shape=this.editor.getShape(this.initialShape.id);if(shape&&"straight"===this.segmentMode){this.didJustShiftClickToExtendPreviousShapeLine=!0;const prevSegment=(0,dist_esm.HVh)(shape.props.segments);if(!prevSegment)throw Error("Expected a previous segment!");const prevPoint=(0,dist_esm.HVh)(prevSegment.points);if(!prevPoint)throw Error("Expected a previous point!");const{x,y}=this.editor.getPointInShapeSpace(shape,originPagePoint).toFixed(),newSegment={type:this.segmentMode,points:[{x:prevPoint.x,y:prevPoint.y,z:+pressure.toFixed(2)},{x,y,z:+pressure.toFixed(2)}]},prevPointPageSpace=dist_esm.V8r.applyToPoint(this.editor.getShapePageTransform(shape.id),prevPoint);this.pagePointWhereCurrentSegmentChanged=prevPointPageSpace,this.pagePointWhereNextSegmentChanged=null;const segments=[...shape.props.segments,newSegment];this.currentLineLength<4*default_shape_constants_STROKE_SIZES[shape.props.size]&&(this.currentLineLength=this.getLineLength(segments));const shapePartial={id:shape.id,type:this.shapeType,props:{segments}};return this.canClose()&&(shapePartial.props.isClosed=this.getIsClosed(segments,shape.props.size,shape.props.scale)),void this.editor.updateShapes([shapePartial])}}this.pagePointWhereCurrentSegmentChanged=originPagePoint.clone();const id=(0,dist_esm.n6Y)();this.editor.createShapes([{id,type:this.shapeType,x:originPagePoint.x,y:originPagePoint.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+pressure.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(id)}updateDrawingShape(){const{initialShape}=this,{inputs}=this.editor;if(!initialShape)return;const{id,props:{size,scale}}=initialShape,shape=this.editor.getShape(id);if(!shape)return;const{segments}=shape.props,{x,y,z}=this.editor.getPointInShapeSpace(shape,inputs.currentPagePoint).toFixed(),newPoint={x,y,z:this.isPenOrStylus?+(1.25*inputs.currentPagePoint.z).toFixed(2):.5};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged}=this;if(null===pagePointWhereNextSegmentChanged)throw Error("We should have a point where the segment changed");if(dist_esm.l2P.Dist2(pagePointWhereNextSegmentChanged,inputs.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const prevSegment=(0,dist_esm.HVh)(segments);if(!prevSegment)throw Error("Expected a previous segment!");const prevLastPoint=(0,dist_esm.HVh)(prevSegment.points);if(!prevLastPoint)throw Error("Expected a previous last point!");let newSegment;const newLastPoint=this.editor.getPointInShapeSpace(shape,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if("straight"===prevSegment.type){this.currentLineLength+=dist_esm.l2P.Dist(prevLastPoint,newLastPoint),newSegment={type:"straight",points:[{...prevLastPoint},newLastPoint]};const transform=this.editor.getShapePageTransform(shape);this.pagePointWhereCurrentSegmentChanged=dist_esm.V8r.applyToPoint(transform,prevLastPoint)}else newSegment={type:"straight",points:[newLastPoint,newPoint]};const shapePartial={id,type:this.shapeType,props:{segments:[...segments,newSegment]}};this.canClose()&&(shapePartial.props.isClosed=this.getIsClosed(segments,size,scale)),this.editor.updateShapes([shapePartial])}break}case"starting_free":{const{pagePointWhereNextSegmentChanged}=this;if(null===pagePointWhereNextSegmentChanged)throw Error("We should have a point where the segment changed");if(dist_esm.l2P.Dist2(pagePointWhereNextSegmentChanged,inputs.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const newSegments=segments.slice(),prevStraightSegment=newSegments[newSegments.length-1],prevPoint=(0,dist_esm.HVh)(prevStraightSegment.points);if(!prevPoint)throw Error("No previous point!");const newFreeSegment={type:"free",points:[...dist_esm.l2P.PointsBetween(prevPoint,newPoint,6).map((p=>({x:(0,dist_esm.Mg8)(p.x),y:(0,dist_esm.Mg8)(p.y),z:(0,dist_esm.Mg8)(p.z)})))]},finalSegments=[...newSegments,newFreeSegment];this.currentLineLength<4*default_shape_constants_STROKE_SIZES[shape.props.size]&&(this.currentLineLength=this.getLineLength(finalSegments));const shapePartial={id,type:this.shapeType,props:{segments:finalSegments}};this.canClose()&&(shapePartial.props.isClosed=this.getIsClosed(finalSegments,size,scale)),this.editor.updateShapes([shapePartial])}break}case"straight":{const newSegments=segments.slice(),newSegment=newSegments[newSegments.length-1],{pagePointWhereCurrentSegmentChanged}=this,{ctrlKey,currentPagePoint}=this.editor.inputs;if(!pagePointWhereCurrentSegmentChanged)throw Error("We should have a point where the segment changed");let pagePoint,shouldSnapToAngle=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(shouldSnapToAngle=!ctrlKey,this.didJustShiftClickToExtendPreviousShapeLine=!1):shouldSnapToAngle=!ctrlKey;let snapSegment,newPoint2=this.editor.getPointInShapeSpace(shape,currentPagePoint).toFixed().toJson(),didSnap=!1;if((this.editor.user.getIsSnapMode()?!ctrlKey:ctrlKey)&&newSegments.length>2){let nearestPoint,minDistance=8/this.editor.getZoomLevel();for(let i=0,n=segments.length-2;i<n;i++){const segment=segments[i];if(!segment)break;if("free"===segment.type)continue;const first=segment.points[0],lastPoint=(0,dist_esm.HVh)(segment.points);if(!first||!lastPoint)continue;const nearestPointOnSegment=dist_esm.l2P.NearestPointOnLineSegment(first,lastPoint,newPoint2);if(dist_esm.l2P.DistMin(nearestPointOnSegment,newPoint2,minDistance)){nearestPoint=nearestPointOnSegment.toFixed().toJson(),minDistance=dist_esm.l2P.Dist(nearestPointOnSegment,newPoint2),snapSegment=segment;break}}nearestPoint&&(didSnap=!0,newPoint2=nearestPoint)}if(didSnap&&snapSegment){const transform=this.editor.getShapePageTransform(shape),first=snapSegment.points[0],lastPoint=(0,dist_esm.HVh)(snapSegment.points);if(!lastPoint)throw Error("Expected a last point!");const A=dist_esm.V8r.applyToPoint(transform,first),B=dist_esm.V8r.applyToPoint(transform,lastPoint),snappedPoint=dist_esm.V8r.applyToPoint(transform,newPoint2);this.editor.snaps.setIndicators([{id:(0,dist_esm.NF7)(),type:"points",points:[A,snappedPoint,B]}])}else{if(this.editor.snaps.clearIndicators(),shouldSnapToAngle){const currentAngle=dist_esm.l2P.Angle(pagePointWhereCurrentSegmentChanged,currentPagePoint),angleDiff=(0,dist_esm.cL9)(currentAngle,24)-currentAngle;pagePoint=dist_esm.l2P.RotWith(currentPagePoint,pagePointWhereCurrentSegmentChanged,angleDiff)}else pagePoint=currentPagePoint;newPoint2=this.editor.getPointInShapeSpace(shape,pagePoint).toFixed().toJson()}this.currentLineLength+=dist_esm.l2P.Dist(newSegment.points[0],newPoint2),newSegments[newSegments.length-1]={...newSegment,type:"straight",points:[newSegment.points[0],newPoint2]};const shapePartial={id,type:this.shapeType,props:{segments:newSegments}};this.canClose()&&(shapePartial.props.isClosed=this.getIsClosed(segments,size,scale)),this.editor.updateShapes([shapePartial]);break}case"free":{const newSegments=segments.slice(),newSegment=newSegments[newSegments.length-1],newPoints=[...newSegment.points];if(newPoints.length&&this.mergeNextPoint){const{z:z2}=newPoints[newPoints.length-1];newPoints[newPoints.length-1]={x:newPoint.x,y:newPoint.y,z:z2?Math.max(z2,newPoint.z):newPoint.z}}else this.currentLineLength+=dist_esm.l2P.Dist(newPoints[newPoints.length-1],newPoint),newPoints.push(newPoint);newSegments[newSegments.length-1]={...newSegment,points:newPoints},this.currentLineLength<4*default_shape_constants_STROKE_SIZES[shape.props.size]&&(this.currentLineLength=this.getLineLength(newSegments));const shapePartial={id,type:this.shapeType,props:{segments:newSegments}};if(this.canClose()&&(shapePartial.props.isClosed=this.getIsClosed(newSegments,size,scale)),this.editor.updateShapes([shapePartial]),newPoints.length>this.util.options.maxPointsPerShape){this.editor.updateShapes([{id,type:this.shapeType,props:{isComplete:!0}}]);const newShapeId=(0,dist_esm.n6Y)(),props=this.editor.getShape(id).props;this.editor.createShapes([{id:newShapeId,type:this.shapeType,x:(0,dist_esm.Mg8)(inputs.currentPagePoint.x),y:(0,dist_esm.Mg8)(inputs.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:props.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(1.25*z).toFixed():.5}]}]}}]),this.initialShape=(0,dist_esm.pN9)(this.editor.getShape(newShapeId)),this.mergeNextPoint=!1,this.lastRecordedPoint=inputs.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(segments){let length=0;for(const segment of segments)for(let i=0;i<segment.points.length-1;i++){const A=segment.points[i],B=segment.points[i+1];length+=dist_esm.l2P.Dist2(B,A)}return Math.sqrt(length)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())}complete(){const{initialShape}=this;initialShape&&(this.editor.updateShapes([{id:initialShape.id,type:initialShape.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}class Idle_Idle extends dist_esm.YM5{static id="idle";onPointerDown(info){this.parent.transition("drawing",info)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}}class DrawShapeTool extends dist_esm.YM5{static id="draw";static initial="idle";static isLockable=!1;static useCoalescedEvents=!0;static children(){return[Idle_Idle,Drawing]}shapeType="draw";onExit(){this.children.drawing.initialShape=void 0}}class FrameShapeTool extends dist_esm.QVi{static id="frame";static initial="idle";shapeType="frame";onCreate(shape){if(!shape)return;const bounds=this.editor.getShapePageBounds(shape),shapesToAddToFrame=[],ancestorIds=this.editor.getShapeAncestors(shape).map((shape2=>shape2.id));this.editor.getSortedChildIdsForParent(shape.parentId).map((siblingShapeId=>{const siblingShape=this.editor.getShape(siblingShapeId);if(!siblingShape)return;if(siblingShape.id===shape.id)return;if(siblingShape.isLocked)return;const pageShapeBounds=this.editor.getShapePageBounds(siblingShape);pageShapeBounds&&bounds.contains(pageShapeBounds)&&function canEnclose(shape,ancestorIds,frame){if(ancestorIds.includes(shape.id))return!1;if(shape.parentId===frame.parentId)return!0;return!1}(siblingShape,ancestorIds,shape)&&shapesToAddToFrame.push(siblingShape.id)})),this.editor.reparentShapes(shapesToAddToFrame,shape.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}}class toolStates_Idle_Idle extends dist_esm.YM5{static id="idle";onPointerDown(info){this.parent.transition("pointing",info)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onKeyUp(info){if("Enter"===info.key){if(this.editor.getIsReadonly())return null;const onlySelectedShape=this.editor.getOnlySelectedShape();onlySelectedShape&&this.editor.getShapeUtil(onlySelectedShape).canEdit(onlySelectedShape)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(onlySelectedShape.id),this.editor.root.getCurrent()?.transition("editing_shape",{...info,target:"shape",shape:onlySelectedShape}))}}onCancel(){this.editor.setCurrentTool("select")}}class Pointing_Pointing extends dist_esm.YM5{static id="pointing";onPointerUp(){this.complete()}onPointerMove(info){if(this.editor.inputs.isDragging){const{originPagePoint}=this.editor.inputs,id=(0,dist_esm.n6Y)(),creatingMarkId=this.editor.markHistoryStoppingPoint(`creating_geo:${id}`),newPoint=(0,dist_esm.Y8F)(originPagePoint,this.editor);this.editor.createShapes([{id,type:"geo",x:newPoint.x,y:newPoint.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(dist_esm.tg8),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(id).setCurrentTool("select.resizing",{...info,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint}=this.editor.inputs,id=(0,dist_esm.n6Y)();this.editor.markHistoryStoppingPoint(`creating_geo:${id}`);const scale=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,geo=this.editor.getStyleForNextShape(dist_esm.tg8),size="star"===geo?{w:200,h:190}:"cloud"===geo?{w:300,h:180}:{w:200,h:200};this.editor.createShapes([{id,type:"geo",x:originPagePoint.x,y:originPagePoint.y,props:{geo:this.editor.getStyleForNextShape(dist_esm.tg8),scale,...size}}]);const shape=this.editor.getShape(id);if(!shape)return;const{w,h}=shape.props,delta=new dist_esm.l2P(w/2,h/2).mul(scale),parentTransform=this.editor.getShapeParentTransform(shape);parentTransform&&delta.rot(-parentTransform.rotation());const newPoint=(0,dist_esm.Y8F)(new dist_esm.l2P(shape.x-delta.x,shape.y-delta.y),this.editor);this.editor.select(id),this.editor.updateShape({id:shape.id,type:"geo",x:newPoint.x,y:newPoint.y,props:{geo:this.editor.getStyleForNextShape(dist_esm.tg8),w:w*scale,h:h*scale}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}}class GeoShapeTool extends dist_esm.YM5{static id="geo";static initial="idle";static children(){return[toolStates_Idle_Idle,Pointing_Pointing]}shapeType="geo"}class HighlightShapeTool extends dist_esm.YM5{static id="highlight";static initial="idle";static useCoalescedEvents=!0;static children(){return[Idle_Idle,Drawing]}static isLockable=!1;shapeType="highlight";onExit(){this.children.drawing.initialShape=void 0}}class line_toolStates_Idle_Idle extends dist_esm.YM5{static id="idle";shapeId="";onEnter(info){this.shapeId=info.shapeId,this.editor.setCursor({type:"cross",rotation:0})}onPointerDown(){this.parent.transition("pointing",{shapeId:this.shapeId})}onCancel(){this.editor.setCurrentTool("select")}}class toolStates_Pointing_Pointing extends dist_esm.YM5{static id="pointing";shape={};markId;onEnter(info){const{inputs}=this.editor,{currentPagePoint}=inputs;this.markId=void 0;const shape=info.shapeId&&this.editor.getShape(info.shapeId);if(shape&&inputs.shiftKey){this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${shape.id}`),this.shape=shape;const handles=this.editor.getShapeHandles(this.shape);if(!handles)return;const vertexHandles=handles.filter((h=>"vertex"===h.type)).sort(dist_esm.Ky),endHandle=vertexHandles[vertexHandles.length-1],prevEndHandle=vertexHandles[vertexHandles.length-2],shapePagePoint=dist_esm.V8r.applyToPoint(this.editor.getShapeParentTransform(this.shape),new dist_esm.l2P(this.shape.x,this.shape.y)),nudgedPoint=dist_esm.l2P.Sub(currentPagePoint,shapePagePoint).addXY(.1,.1),nextPoint=(0,dist_esm.Y8F)(nudgedPoint,this.editor),points=(0,dist_esm.pN9)(this.shape.props.points);if(dist_esm.l2P.DistMin(endHandle,prevEndHandle,2)||dist_esm.l2P.DistMin(nextPoint,endHandle,2))points[endHandle.id]={id:endHandle.id,index:endHandle.index,x:nextPoint.x,y:nextPoint.y};else{const nextIndex=(0,dist_esm.AQy)(endHandle.index);points[nextIndex]={id:nextIndex,index:nextIndex,x:nextPoint.x,y:nextPoint.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points}}])}else{const id=(0,dist_esm.n6Y)();this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${id}`);const newPoint=(0,dist_esm.Y8F)(currentPagePoint,this.editor);this.editor.createShapes([{id,type:"line",x:newPoint.x,y:newPoint.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),this.editor.select(id),this.shape=this.editor.getShape(id)}}onPointerMove(){if(this.shape&&this.editor.inputs.isDragging){const handles=this.editor.getShapeHandles(this.shape);if(!handles)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const lastHandle=(0,dist_esm.HVh)(handles);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,creatingMarkId:this.markId,handle:{...lastHandle,x:lastHandle.x-.1,y:lastHandle.y-.1},onInteractionEnd:"line"})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}}class LineShapeTool extends dist_esm.YM5{static id="line";static initial="idle";static children(){return[line_toolStates_Idle_Idle,toolStates_Pointing_Pointing]}shapeType="line"}class note_toolStates_Idle_Idle extends dist_esm.YM5{static id="idle";onPointerDown(info){this.parent.transition("pointing",info)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}}const NOTE_SIZE=200,NOTE_CENTER_OFFSET=new dist_esm.l2P(NOTE_SIZE/2,NOTE_SIZE/2),BASE_NOTE_POSITIONS=editor=>[[["a1"],new dist_esm.l2P(.5*NOTE_SIZE,-.5*NOTE_SIZE-editor.options.adjacentShapeMargin)],[["a2"],new dist_esm.l2P(1.5*NOTE_SIZE+editor.options.adjacentShapeMargin,.5*NOTE_SIZE)],[["a3"],new dist_esm.l2P(.5*NOTE_SIZE,1.5*NOTE_SIZE+editor.options.adjacentShapeMargin)],[["a4"],new dist_esm.l2P(-.5*NOTE_SIZE-editor.options.adjacentShapeMargin,.5*NOTE_SIZE)]];function getNoteAdjacentPositions(editor,pagePoint,pageRotation,growY,extraHeight,scale){return Object.fromEntries(function getBaseAdjacentNotePositions(editor,scale){if(1===scale)return BASE_NOTE_POSITIONS(editor);const s=NOTE_SIZE*scale,m=editor.options.adjacentShapeMargin*scale;return[[["a1"],new dist_esm.l2P(.5*s,-.5*s-m)],[["a2"],new dist_esm.l2P(1.5*s+m,.5*s)],[["a3"],new dist_esm.l2P(.5*s,1.5*s+m)],[["a4"],new dist_esm.l2P(-.5*s-m,.5*s)]]}(editor,scale).map((([id,v],i)=>{const point=v.clone();return 0===i&&extraHeight?point.y-=extraHeight:2===i&&growY&&(point.y+=growY),[id,point.rot(pageRotation).add(pagePoint)]})))}function getAvailableNoteAdjacentPositions(editor,rotation,scale,extraHeight){const selectedShapeIds=new Set(editor.getSelectedShapeIds()),minSize=(NOTE_SIZE+editor.options.adjacentShapeMargin+extraHeight)**2,allCenters=new Map,positions=[];for(const shape of editor.getCurrentPageShapes()){if(!editor.isShapeOfType(shape,"note")||scale!==shape.props.scale||selectedShapeIds.has(shape.id))continue;const transform=editor.getShapePageTransform(shape.id);rotation===transform.rotation()&&(allCenters.set(shape,editor.getShapePageBounds(shape).center),positions.push(...Object.values(getNoteAdjacentPositions(editor,transform.point(),rotation,shape.props.growY,extraHeight,scale))))}const len=positions.length;let position;for(const[shape,center]of allCenters)for(let i=0;i<len;i++)position=positions[i],position&&(dist_esm.l2P.Dist2(center,position)>minSize||editor.isPointInShape(shape,position)&&(positions[i]=void 0));return(0,dist_esm.oE7)(positions)}function getNoteShapeForAdjacentPosition(editor,shape,center,pageRotation,forceNew=!1){let nextNote;const allShapesOnPage=editor.getCurrentPageShapesSorted(),minDistance=(NOTE_SIZE+editor.options.adjacentShapeMargin**2)**shape.props.scale;for(let i=allShapesOnPage.length-1;i>=0;i--){const otherNote=allShapesOnPage[i];if("note"===otherNote.type&&otherNote.id!==shape.id){const otherBounds=editor.getShapePageBounds(otherNote);if(otherBounds&&dist_esm.l2P.Dist2(otherBounds.center,center)<minDistance&&editor.isPointInShape(otherNote,center)){nextNote=otherNote;break}}}if(editor.complete(),!nextNote||forceNew){editor.markHistoryStoppingPoint("creating note shape");const id=(0,dist_esm.n6Y)();editor.createShape({id,type:"note",x:center.x,y:center.y,rotation:pageRotation,opacity:shape.opacity,props:{...shape.props,richText:(0,dist_esm.TP3)(""),growY:0,fontSizeAdjustment:0,url:""}});const createdShape=editor.getShape(id);if(!createdShape)return;const topLeft=editor.getPointInParentSpace(createdShape,dist_esm.l2P.Sub(center,dist_esm.l2P.Rot(NOTE_CENTER_OFFSET.clone().mul(createdShape.props.scale),pageRotation)));editor.updateShape({id,type:"note",x:topLeft.x,y:topLeft.y}),nextNote=editor.getShape(id)}return editor.zoomToSelectionIfOffscreen(16,{animation:{duration:editor.options.animationMediumMs},inset:0}),nextNote}class note_toolStates_Pointing_Pointing extends dist_esm.YM5{static id="pointing";dragged=!1;info={};markId="";shape={};onEnter(){const{editor}=this,id=(0,dist_esm.n6Y)();this.markId=editor.markHistoryStoppingPoint(`creating_note:${id}`);const center=this.editor.inputs.originPagePoint.clone(),offset=function getNoteShapeAdjacentPositionOffset(editor,center,scale){let offset,min=10/editor.getZoomLevel();for(const pit of getAvailableNoteAdjacentPositions(editor,0,scale,0)){const deltaToPit=dist_esm.l2P.Sub(center,pit),dist=deltaToPit.len();dist<min&&(min=dist,offset=deltaToPit)}return offset}(this.editor,center,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);offset&&center.sub(offset),this.shape=function createNoteShape(editor,id,center){editor.createShape({id,type:"note",x:center.x,y:center.y,props:{scale:editor.user.getIsDynamicResizeMode()?1/editor.getZoomLevel():1}}).select(id);const shape=editor.getShape(id),bounds=editor.getShapeGeometry(shape).bounds,newPoint=(0,dist_esm.Y8F)(new dist_esm.l2P(shape.x-bounds.width/2,shape.y-bounds.height/2),editor);return editor.updateShapes([{id,type:"note",x:newPoint.x,y:newPoint.y}]),editor.getShape(id)}(this.editor,id,center)}onPointerMove(info){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.translating",{...info,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,creatingMarkId:this.markId,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}onPointerUp(){this.complete()}onInterrupt(){this.cancel()}onComplete(){this.complete()}onCancel(){this.cancel()}complete(){this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape}))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}}class NoteShapeTool extends dist_esm.YM5{static id="note";static initial="idle";static children(){return[note_toolStates_Idle_Idle,note_toolStates_Pointing_Pointing]}shapeType="note"}const updateHoveredShapeId=(0,dist_esm.nFR)((function _updateHoveredShapeId(editor){const hitShape=editor.getShapeAtPoint(editor.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:editor.options.hitTestMargin/editor.getZoomLevel(),renderingOnly:!0});if(!hitShape)return editor.setHoveredShape(null);let shapeToHover;const outermostShape=editor.getOutermostSelectableShape(hitShape);return shapeToHover=outermostShape===hitShape||outermostShape.id===editor.getFocusedGroupId()||editor.getSelectedShapeIds().includes(outermostShape.id)?hitShape:outermostShape,editor.setHoveredShape(shapeToHover.id)}),32);class text_toolStates_Idle_Idle extends dist_esm.YM5{static id="idle";onPointerMove(info){switch(info.target){case"shape":case"canvas":updateHoveredShapeId(this.editor)}}onPointerDown(info){this.parent.transition("pointing",info)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onExit(){updateHoveredShapeId.cancel()}onKeyDown(info){if("Enter"===info.key){if(this.editor.getIsReadonly())return null;const onlySelectedShape=this.editor.getOnlySelectedShape();onlySelectedShape&&this.editor.getShapeUtil(onlySelectedShape).canEdit(onlySelectedShape)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(onlySelectedShape.id),this.editor.root.getCurrent()?.transition("editing_shape",{...info,target:"shape",shape:onlySelectedShape}))}}onCancel(){this.editor.setCurrentTool("select")}}class text_toolStates_Pointing_Pointing extends dist_esm.YM5{static id="pointing";shape;markId="";enterTime=0;onEnter(){this.enterTime=Date.now()}onExit(){this.editor.setHintingShapes([])}onPointerMove(info){if(Date.now()-this.enterTime<150)return;const{editor}=this,{isPointing}=editor.inputs;if(!isPointing)return;const{originPagePoint,currentPagePoint}=editor.inputs,currentDragDist=Math.abs(originPagePoint.x-currentPagePoint.x);if(currentDragDist>6*Math.sqrt(editor.getInstanceState().isCoarsePointer?editor.options.coarseDragDistanceSquared:editor.options.dragDistanceSquared)/editor.getZoomLevel()){const id=(0,dist_esm.n6Y)();this.markId=editor.markHistoryStoppingPoint(`creating_text:${id}`);const shape=this.createTextShape(id,originPagePoint,!1,currentDragDist);if(!shape)return void this.cancel();this.shape=editor.getShape(shape),editor.select(id),editor.setCurrentTool("select.resizing",{...info,target:"selection",handle:"right",isCreating:!0,creatingMarkId:this.markId,creationCursorOffset:{x:currentDragDist,y:1},onInteractionEnd:"text",onCreate:()=>{editor.setEditingShape(shape.id)}})}}onPointerUp(){this.complete()}onComplete(){this.cancel()}onCancel(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.editor.markHistoryStoppingPoint("creating text shape");const id=(0,dist_esm.n6Y)(),{originPagePoint}=this.editor.inputs;this.createTextShape(id,originPagePoint,!0,20)&&(this.editor.select(id),this.editor.setEditingShape(id))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(id,point,autoSize,width){this.editor.createShape({id,type:"text",x:point.x,y:point.y,props:{richText:(0,dist_esm.TP3)(""),autoSize,w:width,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const shape=this.editor.getShape(id);if(!shape)return void this.cancel();const bounds=this.editor.getShapePageBounds(shape),delta=new dist_esm.l2P;if(autoSize)switch(shape.props.textAlign){case"start":delta.x=0;break;case"middle":delta.x=-bounds.width/2;break;case"end":delta.x=-bounds.width}else delta.x=0;if(delta.y=-bounds.height/2,(0,dist_esm.vc4)(shape.parentId)){const transform=this.editor.getShapeParentTransform(shape);delta.rot(-transform.rotation())}const shapeX=shape.x+delta.x,shapeY=shape.y+delta.y;if(this.editor.getInstanceState().isGridMode){const topLeft=new dist_esm.l2P(shapeX,shapeY),gridSnappedPoint=(0,dist_esm.Y8F)(topLeft,this.editor),gridDelta=dist_esm.l2P.Sub(topLeft,gridSnappedPoint);this.editor.updateShape({...shape,x:shapeX-gridDelta.x,y:shapeY-gridDelta.y})}else this.editor.updateShape({...shape,x:shapeX,y:shapeY});return shape}}class TextShapeTool extends dist_esm.YM5{static id="text";static initial="idle";static children(){return[text_toolStates_Idle_Idle,text_toolStates_Pointing_Pointing]}shapeType="text"}const defaultShapeTools=[TextShapeTool,DrawShapeTool,GeoShapeTool,NoteShapeTool,LineShapeTool,FrameShapeTool,ArrowShapeTool,HighlightShapeTool];function getVerticesCountForLength(length,spacing=20){return Math.max(8,Math.ceil(length/spacing))}class PathBuilder{static throughPoints(points,opts){const path=new PathBuilder;path.moveTo(points[0].x,points[0].y,opts);for(let i=1;i<points.length;i++)path.lineTo(points[i].x,points[i].y);return path}constructor(){}lines=[];currentLine(){const lastLine=this.lines[this.lines.length-1];return(0,dist_esm.vAR)(lastLine,"Start an SVGPathBuilder with `.moveTo()`"),(0,dist_esm.vAR)(!lastLine.closed,"Cannot work on a closed line"),lastLine}moveTo(x,y,opts){return this.lines.push({initial:{type:"moveTo",x,y,opts},segments:[],closed:!1}),this}lineTo(x,y,opts){return this.currentLine().segments.push({type:"lineTo",x,y,opts}),this}arcTo(radius,largeArcFlag,sweepFlag,x,y,opts){return this.currentLine().segments.push({type:"arcTo",radius,largeArcFlag,sweepFlag,x,y,opts}),this}close(){return this.currentLine().closed=!0,this}toD(opts={}){const closedOnly=opts.closedOnly??!1,parts=[];for(const{initial,segments,closed}of this.lines)if(!closedOnly||closed){parts.push("M",(0,dist_esm.WMC)(initial.x),(0,dist_esm.WMC)(initial.y));for(const segment of segments)switch(segment.type){case"lineTo":parts.push("L",(0,dist_esm.WMC)(segment.x),(0,dist_esm.WMC)(segment.y));break;case"arcTo":parts.push("A",segment.radius,segment.radius,0,segment.largeArcFlag?"1":"0",segment.sweepFlag?"1":"0",(0,dist_esm.WMC)(segment.x),(0,dist_esm.WMC)(segment.y))}closed&&parts.push("Z")}return parts.join(" ")}toSvg(opts){if(opts.forceSolid)return this.toSolidSvg(opts);switch(opts.style){case"solid":return this.toSolidSvg(opts);case"dashed":case"dotted":return this.toDashedSvg(opts);case"draw":return this.toDrawSvg(opts);default:(0,dist_esm.h6G)(opts,"style")}}toGeometry(){const geometries=[];for(const{initial,segments,closed}of this.lines){if(!1===initial.opts?.geometry)continue;const vertices=[new dist_esm.l2P(initial.x,initial.y)];for(const segment of segments)switch(segment.type){case"lineTo":vertices.push(new dist_esm.l2P(segment.x,segment.y));break;case"arcTo":{const info=getArcSegmentInfo(vertices[vertices.length-1],segment);if(null===info)break;if("straight-line"===info){vertices.push(new dist_esm.l2P(segment.x,segment.y));break}const verticesCount=getVerticesCountForLength(info.length);for(let i=0;i<verticesCount+1;i++){const t=i/verticesCount*info.sweepAngle,point=dist_esm.l2P.Rot(info.startVector,t).mul(info.radius).add(info.center);vertices.push(point)}break}default:(0,dist_esm.h6G)(segment,"type")}const geometry=closed?new dist_esm.dxv({points:vertices,isFilled:!1,...initial.opts?.geometry}):new dist_esm.Hes({points:vertices,...initial.opts?.geometry});geometries.push(geometry)}return 0===geometries.length?null:1===geometries.length?geometries[0]:new dist_esm.IQE({children:geometries})}toSolidSvg(opts){const{strokeWidth,props}=opts;return(0,jsx_runtime.jsx)("path",{strokeWidth,d:this.toD(),...props})}toDashedSvg(opts){const{style,strokeWidth,snap,end,start,lengthRatio,props:{markerStart,markerEnd,...props}={}}=opts,parts=[];for(const{initial,segments,closed}of this.lines){let lastPoint=initial;for(let i=0;i<segments.length;i++){const segment=segments[i],isFirst=0===i,isLast=i===segments.length-1&&!closed,segmentLength=this.segmentLength(lastPoint,segment),{strokeDasharray,strokeDashoffset}=(0,dist_esm.EK8)(segmentLength,strokeWidth,{style,snap,lengthRatio,start:isFirst?closed?"none":start:"outset",end:isLast?closed?"none":end:"outset"});switch(segment.type){case"lineTo":parts.push((0,jsx_runtime.jsx)("line",{x1:(0,dist_esm.WMC)(lastPoint.x),y1:(0,dist_esm.WMC)(lastPoint.y),x2:(0,dist_esm.WMC)(segment.x),y2:(0,dist_esm.WMC)(segment.y),strokeDasharray,strokeDashoffset,markerStart:isFirst?markerStart:void 0,markerEnd:isLast?markerEnd:void 0},i));break;case"arcTo":parts.push((0,jsx_runtime.jsx)("path",{d:["M",(0,dist_esm.WMC)(lastPoint.x),(0,dist_esm.WMC)(lastPoint.y),"A",segment.radius,segment.radius,0,segment.largeArcFlag?"1":"0",segment.sweepFlag?"1":"0",(0,dist_esm.WMC)(segment.x),(0,dist_esm.WMC)(segment.y)].join(" "),strokeDasharray,strokeDashoffset,markerStart:isFirst?markerStart:void 0,markerEnd:isLast?markerEnd:void 0},i));break;default:(0,dist_esm.h6G)(segment,"type")}lastPoint=segment}if(closed&&lastPoint!==initial){const dist=dist_esm.l2P.Dist(lastPoint,initial),{strokeDasharray,strokeDashoffset}=(0,dist_esm.EK8)(dist,strokeWidth,{style,snap,lengthRatio,start:"outset",end:"none"});parts.push((0,jsx_runtime.jsx)("line",{x1:(0,dist_esm.WMC)(lastPoint.x),y1:(0,dist_esm.WMC)(lastPoint.y),x2:(0,dist_esm.WMC)(initial.x),y2:(0,dist_esm.WMC)(initial.y),strokeDasharray,strokeDashoffset,markerEnd},"last"))}}return(0,jsx_runtime.jsx)("g",{strokeWidth,...props,children:parts})}toDrawSvg(opts){const{strokeWidth,randomSeed,offset:defaultOffset=strokeWidth/3,roundness:defaultRoundness=2*strokeWidth,passes=2,props}=opts,parts=[],tangents=this.lines.map((({initial,segments,closed})=>{const tangents2=[],segmentCount=closed?segments.length+1:segments.length;for(let i=0;i<segmentCount;i++){let tangentBefore,tangentAfter,previous=segments[i-1],current=segments[i],next=segments[i+1];switch(previous||(previous=initial),current||(current=initial,next=segments[0]),next||(next=initial),current.type){case"lineTo":case"moveTo":tangentBefore=dist_esm.l2P.Sub(previous,current).norm();break;case"arcTo":{const info=getArcSegmentInfo(previous,current);if(null===info||"straight-line"===info){tangentBefore=dist_esm.l2P.Sub(current,previous).norm().per();break}tangentBefore=dist_esm.l2P.Per(info.endVector).mul(Math.sign(info.sweepAngle));break}default:(0,dist_esm.h6G)(current,"type")}switch(next.type){case"lineTo":case"moveTo":tangentAfter=dist_esm.l2P.Sub(next,current).norm();break;case"arcTo":{const info=getArcSegmentInfo(current,next);if(null===info||"straight-line"===info){tangentAfter=dist_esm.l2P.Sub(next,current).norm().per();break}tangentAfter=dist_esm.l2P.Per(info.startVector).mul(Math.sign(info.sweepAngle));break}default:(0,dist_esm.h6G)(next,"type")}tangents2.push({tangentBefore,tangentAfter})}return tangents2}));for(let pass=0;pass<passes;pass++)for(let lineIdx=0;lineIdx<this.lines.length;lineIdx++){const{initial,segments,closed}=this.lines[lineIdx],random=(0,dist_esm.She)(randomSeed+pass+lineIdx),initialOffset=initial.opts?.offset??defaultOffset,initialPOffset={x:initial.x+random()*initialOffset,y:initial.y+random()*initialOffset},offsetPoints=[];let lastDistance=dist_esm.l2P.Dist(initialPOffset,segments[0]);for(let i=0;i<segments.length;i++){const segment=segments[i],nextSegment=i===segments.length-1?closed?segments[0]:null:segments[i+1],nextDistance=nextSegment?dist_esm.l2P.Dist(segment,nextSegment):1/0,shortestDistance=Math.min(lastDistance,nextDistance)-(segment.opts?.roundness??defaultRoundness),offset=(0,dist_esm.qE8)(segment.opts?.offset??defaultOffset,0,shortestDistance/10),offsetPoint={x:segment.x+random()*offset,y:segment.y+random()*offset};offsetPoints.push(offsetPoint),lastDistance=nextDistance}if(closed){const roundness=initial.opts?.roundness??defaultRoundness;offsetPoints.push(initialPOffset);const next=offsetPoints[0],nudgeAmount=Math.min(dist_esm.l2P.Dist(initialPOffset,next)/2,roundness),nudged=dist_esm.l2P.Nudge(initialPOffset,next,nudgeAmount);parts.push("M",(0,dist_esm.WMC)(nudged.x),(0,dist_esm.WMC)(nudged.y))}else parts.push("M",(0,dist_esm.WMC)(initialPOffset.x),(0,dist_esm.WMC)(initialPOffset.y));const segmentCount=closed?segments.length+1:segments.length;for(let i=0;i<segmentCount;i++){const segment=i===segments.length?initial:segments[i],roundness=segment.opts?.roundness??defaultRoundness,offsetP=offsetPoints[i],{tangentBefore,tangentAfter}=tangents[lineIdx][i],previousOffsetP=0===i?initialPOffset:offsetPoints[i-1],nextOffsetP=i!==segments.length-1||closed?offsetPoints[(i+1)%offsetPoints.length]:null;switch(segment.type){case"lineTo":case"moveTo":{if(!nextOffsetP||0===roundness){parts.push("L",(0,dist_esm.WMC)(offsetP.x),(0,dist_esm.WMC)(offsetP.y));break}const clampedRoundness=(0,dist_esm.CcK)(roundness,0,(0,dist_esm.qE8)((0,dist_esm.Fg_)(Math.PI/2,Math.PI,Math.abs(dist_esm.l2P.AngleBetween(tangentBefore,tangentAfter))),0,1)),nudgeBeforeAmount=Math.min(dist_esm.l2P.Dist(previousOffsetP,offsetP)/2,clampedRoundness),nudgeBefore=dist_esm.l2P.Mul(tangentBefore,nudgeBeforeAmount).add(offsetP),nudgeAfterAmount=Math.min(dist_esm.l2P.Dist(nextOffsetP,offsetP)/2,clampedRoundness),nudgeAfter=dist_esm.l2P.Mul(tangentAfter,nudgeAfterAmount).add(offsetP);parts.push("L",(0,dist_esm.WMC)(nudgeBefore.x),(0,dist_esm.WMC)(nudgeBefore.y),"Q",(0,dist_esm.WMC)(offsetP.x),(0,dist_esm.WMC)(offsetP.y),(0,dist_esm.WMC)(nudgeAfter.x),(0,dist_esm.WMC)(nudgeAfter.y));break}case"arcTo":parts.push("A",segment.radius,segment.radius,0,segment.largeArcFlag?"1":"0",segment.sweepFlag?"1":"0",(0,dist_esm.WMC)(offsetP.x),(0,dist_esm.WMC)(offsetP.y));break;default:(0,dist_esm.h6G)(segment,"type")}}closed&&parts.push("Z")}return(0,jsx_runtime.jsx)("path",{strokeWidth,d:parts.join(" "),...props})}segmentLength(lastPoint,segment){switch(segment.type){case"lineTo":return dist_esm.l2P.Dist(lastPoint,segment);case"arcTo":{const info=getArcSegmentInfo(lastPoint,segment);return null===info?0:"straight-line"===info?dist_esm.l2P.Dist(lastPoint,segment):info.length}default:(0,dist_esm.h6G)(segment,"type")}}}function getArcSegmentInfo(lastPoint,{radius,largeArcFlag,sweepFlag,x,y}){if(radius=Math.abs(radius),lastPoint.x===x&&lastPoint.y===y)return null;if(0===radius)return"straight-line";const dx=(lastPoint.x-x)/2,dy=(lastPoint.y-y)/2,radiiCheck=Math.pow(dx,2)/Math.pow(radius,2)+Math.pow(dy,2)/Math.pow(radius,2);radiiCheck>1&&(radius=Math.sqrt(radiiCheck)*radius);let cRadicand=(Math.pow(radius,2)*Math.pow(radius,2)-Math.pow(radius,2)*Math.pow(dy,2)-Math.pow(radius,2)*Math.pow(dx,2))/(Math.pow(radius,2)*Math.pow(dy,2)+Math.pow(radius,2)*Math.pow(dx,2));cRadicand=cRadicand<0?0:cRadicand;const cCoef=(largeArcFlag!==sweepFlag?1:-1)*Math.sqrt(cRadicand),transformedCenter_x=cCoef*(radius*dy/radius),transformedCenter_y=cCoef*(-radius*dx/radius),center={x:transformedCenter_x+(lastPoint.x+x)/2,y:transformedCenter_y+(lastPoint.y+y)/2},startVector={x:(dx-transformedCenter_x)/radius,y:(dy-transformedCenter_y)/radius},endVector={x:(-dx-transformedCenter_x)/radius,y:(-dy-transformedCenter_y)/radius};let sweepAngle=dist_esm.l2P.AngleBetween(startVector,endVector);return!sweepFlag&&sweepAngle>0?sweepAngle-=2*Math.PI:sweepFlag&&sweepAngle<0&&(sweepAngle+=2*Math.PI),sweepAngle%=2*Math.PI,{length:Math.abs(sweepAngle*radius),radius,sweepAngle,startVector,endVector,center}}const PlainTextArea=react.forwardRef((function TextArea({isEditing,text,handleFocus,handleChange,handleKeyDown,handleBlur,handleInputPointerDown,handleDoubleClick},ref){return(0,jsx_runtime.jsx)("textarea",{ref,className:"tl-text tl-text-input",name:"text",tabIndex:-1,disabled:!isEditing,readOnly:!isEditing,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:text,onFocus:handleFocus,onChange:e=>{handleChange({plaintext:e.target.value})},onKeyDown:e=>handleKeyDown(e.nativeEvent),onBlur:handleBlur,onTouchEnd:dist_esm.$6n,onContextMenu:isEditing?dist_esm.$6n:void 0,onPointerDown:handleInputPointerDown,onDoubleClick:handleDoubleClick,onDragStart:dist_esm.woC})}));function isLegacyAlign(align){return"start-legacy"===align||"middle-legacy"===align||"end-legacy"===align}function useEditablePlainText(shapeId,type,text){const commonUseEditableTextHandlers=useEditableTextCommon(shapeId),isEditing=commonUseEditableTextHandlers.isEditing,editor=(0,dist_esm.hGv)(),rInput=(0,react.useRef)(null),isEmpty=0===(text||"").trim().length;(0,react.useEffect)((()=>{function selectAllIfEditing(event){event.shapeId===shapeId&&rInput.current?.select?.()}return editor.on("select-all-text",selectAllIfEditing),()=>{editor.off("select-all-text",selectAllIfEditing)}}),[editor,shapeId,isEditing]),(0,react.useEffect)((()=>{isEditing&&(document.activeElement!==rInput.current&&rInput.current?.focus(),editor.getInstanceState().isCoarsePointer&&rInput.current?.select(),dist_esm.YZA.isSafari&&(rInput.current?.blur(),rInput.current?.focus()))}),[editor,isEditing]);const handleKeyDown=(0,react.useCallback)((e=>{if(editor.getEditingShapeId()===shapeId&&"Enter"===e.key)(e.ctrlKey||e.metaKey)&&editor.complete()}),[editor,shapeId]),handleChange=(0,react.useCallback)((({plaintext})=>{if(editor.getEditingShapeId()!==shapeId)return;const normalizedPlaintext=TextHelpers.normalizeText(plaintext||"");editor.updateShape({id:shapeId,type,props:{text:normalizedPlaintext}})}),[editor,shapeId,type]);return{rInput,handleKeyDown,handleChange,isEmpty,...commonUseEditableTextHandlers}}function useIsReadyForEditing(editor,shapeId){return(0,dist_esm.hau)("isReadyForEditing",(()=>{const editingShapeId=editor.getEditingShapeId();return null!==editingShapeId&&(editingShapeId===shapeId||editor.getHoveredShapeId()===shapeId)}),[editor,shapeId])}function useEditableTextCommon(shapeId){const editor=(0,dist_esm.hGv)(),isEditing=(0,dist_esm.hau)("isEditing",(()=>editor.getEditingShapeId()===shapeId),[editor]),isReadyForEditing=useIsReadyForEditing(editor,shapeId),handleInputPointerDown=(0,react.useCallback)((e=>{editor.dispatch({...(0,dist_esm.yGT)(e),type:"pointer",name:"pointer_down",target:"shape",shape:editor.getShape(shapeId)}),(0,dist_esm.$6n)(e)}),[editor,shapeId]);return{handleFocus:dist_esm.lQ1,handleBlur:dist_esm.lQ1,handleInputPointerDown,handleDoubleClick:dist_esm.$6n,isEditing,isReadyForEditing}}const PlainTextLabel=react.memo((function PlainTextLabel2({shapeId,type,text:plaintext,labelColor,font,fontSize,lineHeight,align,verticalAlign,wrap,isSelected,padding=0,onKeyDown:handleKeyDownCustom,classNamePrefix,style,textWidth,textHeight}){const{rInput,isEmpty,isEditing,isReadyForEditing,...editableTextRest}=useEditablePlainText(shapeId,type,plaintext),finalPlainText=TextHelpers.normalizeTextForDom(plaintext||""),hasText=finalPlainText.length>0,legacyAlign=isLegacyAlign(align);if(!isEditing&&!hasText)return null;const cssPrefix=classNamePrefix||"tl-text";return(0,jsx_runtime.jsx)("div",{className:`${cssPrefix}-label tl-text-wrapper tl-plain-text-wrapper`,"data-font":font,"data-align":align,"data-hastext":!isEmpty,"data-isediting":isEditing,"data-is-ready-for-editing":isReadyForEditing,"data-textwrap":!!wrap,"data-isselected":isSelected,style:{justifyContent:"middle"===align||legacyAlign?"center":align,alignItems:"middle"===verticalAlign?"center":verticalAlign,padding,...style},children:(0,jsx_runtime.jsxs)("div",{className:`${cssPrefix}-label__inner tl-text-content__wrapper`,style:{fontSize,lineHeight:Math.floor(fontSize*lineHeight)+"px",minHeight:Math.floor(fontSize*lineHeight)+"px",minWidth:Math.ceil(textWidth||0),color:labelColor,width:textWidth?Math.ceil(textWidth):void 0,height:textHeight?Math.ceil(textHeight):void 0},children:[(0,jsx_runtime.jsx)("div",{className:`${cssPrefix} tl-text tl-text-content`,dir:"auto",children:finalPlainText.split("\n").map(((lineOfText,index)=>(0,jsx_runtime.jsx)("div",{dir:"auto",children:lineOfText},index)))}),(isReadyForEditing||isSelected)&&(0,jsx_runtime.jsx)(PlainTextArea,{ref:rInput,text:plaintext,isEditing,shapeId,...editableTextRest,handleKeyDown:handleKeyDownCustom??editableTextRest.handleKeyDown})]})})}));function useDefaultColorTheme(){return(0,dist_esm.AnR)({isDarkMode:(0,dist_esm.hJo)()})}function getFillDefForExport(fill){return{key:`${dist_esm.yes.id}:${fill}`,getElement:async()=>"pattern"!==fill?null:(0,jsx_runtime.jsx)(HashPatternForExport,{})}}function HashPatternForExport(){const getHashPatternZoomName=useGetHashPatternZoomName(),maskId=(0,dist_esm.LsA)(),theme=useDefaultColorTheme(),t=8/12;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("mask",{id:maskId,children:[(0,jsx_runtime.jsx)("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),(0,jsx_runtime.jsxs)("g",{strokeLinecap:"round",stroke:"black",children:[(0,jsx_runtime.jsx)("line",{x1:1*t,y1:2,x2:2,y2:1*t}),(0,jsx_runtime.jsx)("line",{x1:5*t,y1:7*t,x2:7*t,y2:5*t}),(0,jsx_runtime.jsx)("line",{x1:6,y1:11*t,x2:11*t,y2:6})]})]}),(0,jsx_runtime.jsx)("pattern",{id:getHashPatternZoomName(1,theme.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:(0,jsx_runtime.jsx)("rect",{x:"0",y:"0",width:"8",height:"8",fill:theme.solid,mask:`url(#${maskId})`})})]})}function getFillDefForCanvas(){return{key:`${dist_esm.yes.id}:pattern`,component:PatternFillDefForCanvas}}const TILE_PATTERN_SIZE=8,generateImage=(dpr,currentZoom,darkMode)=>new Promise(((resolve,reject)=>{const size=TILE_PATTERN_SIZE*currentZoom*dpr,canvasEl=document.createElement("canvas");canvasEl.width=size,canvasEl.height=size;const ctx=canvasEl.getContext("2d");if(!ctx)return;ctx.fillStyle=darkMode?dist_esm.Rmu.darkMode.solid:dist_esm.Rmu.lightMode.solid,ctx.fillRect(0,0,size,size),ctx.globalCompositeOperation="destination-out",ctx.lineCap="round",ctx.lineWidth=1.25*currentZoom*dpr;const t=8/12,s=v=>v*currentZoom*dpr;ctx.beginPath(),ctx.moveTo(s(1*t),s(2)),ctx.lineTo(s(2),s(1*t)),ctx.moveTo(s(5*t),s(7*t)),ctx.lineTo(s(7*t),s(5*t)),ctx.moveTo(s(6),s(11*t)),ctx.lineTo(s(11*t),s(6)),ctx.stroke(),canvasEl.toBlob((blob=>{!blob||dist_esm.bGJ.throwToBlob.get()?reject():resolve(blob)}))})),canvasBlob=(size,fn)=>{const canvas=document.createElement("canvas");canvas.width=size[0],canvas.height=size[1];const ctx=canvas.getContext("2d");return ctx?(fn(ctx),canvas.toDataURL()):""};let defaultPixels=null;function getPatternLodForZoomLevel(zoom){return Math.ceil(Math.log2(Math.max(1,zoom)))}function useGetHashPatternZoomName(){const id=(0,dist_esm.Xhk)("hash_pattern");return(0,react.useCallback)(((zoom,theme)=>{const lod=getPatternLodForZoomLevel(zoom);return(0,dist_esm.oX2)(id,`${theme}_${lod}`)}),[id])}function getPatternLodsToGenerate(maxZoom){const levels=[],maxLod=getPatternLodForZoomLevel(maxZoom);for(let i=0;i<=maxLod;i++)levels.push(Math.pow(2,i));return levels}function getDefaultPatterns(maxZoom){const defaultPixels2=function getDefaultPixels(){return defaultPixels||(defaultPixels={white:canvasBlob([1,1],(ctx=>{ctx.fillStyle="#f8f9fa",ctx.fillRect(0,0,1,1)})),black:canvasBlob([1,1],(ctx=>{ctx.fillStyle="#212529",ctx.fillRect(0,0,1,1)}))}),defaultPixels}();return getPatternLodsToGenerate(maxZoom).flatMap((zoom=>[{zoom,url:defaultPixels2.white,theme:"light"},{zoom,url:defaultPixels2.black,theme:"dark"}]))}function PatternFillDefForCanvas(){const editor=(0,dist_esm.hGv)(),containerRef=(0,react.useRef)(null),{defs,isReady}=function usePattern(){const editor=(0,dist_esm.hGv)(),dpr=(0,dist_esm.hau)("devicePixelRatio",(()=>editor.getInstanceState().devicePixelRatio),[editor]),maxZoom=(0,dist_esm.hau)("maxZoom",(()=>Math.ceil((0,dist_esm.HVh)(editor.getCameraOptions().zoomSteps))),[editor]),[isReady,setIsReady]=(0,react.useState)(!1),[backgroundUrls,setBackgroundUrls]=(0,react.useState)((()=>getDefaultPatterns(maxZoom))),getHashPatternZoomName=useGetHashPatternZoomName();return(0,react.useEffect)((()=>{const promise=Promise.all(getPatternLodsToGenerate(maxZoom).flatMap((zoom=>[generateImage(dpr,zoom,!1).then((blob=>({zoom,theme:"light",url:URL.createObjectURL(blob)}))),generateImage(dpr,zoom,!0).then((blob=>({zoom,theme:"dark",url:URL.createObjectURL(blob)})))])));let isCancelled=!1;return promise.then((urls=>{isCancelled||(setBackgroundUrls(urls),setIsReady(!0))})),()=>{isCancelled=!0,setIsReady(!1),promise.then((patterns=>{for(const{url}of patterns)URL.revokeObjectURL(url)}))}}),[dpr,maxZoom]),{defs:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:backgroundUrls.map((item=>{const id=getHashPatternZoomName(item.zoom,item.theme);return(0,jsx_runtime.jsx)("pattern",{id,width:TILE_PATTERN_SIZE,height:TILE_PATTERN_SIZE,patternUnits:"userSpaceOnUse",children:(0,jsx_runtime.jsx)("image",{href:item.url,width:TILE_PATTERN_SIZE,height:TILE_PATTERN_SIZE})},id)}))}),isReady}}();return(0,react.useEffect)((()=>{if(isReady&&dist_esm.YZA.isSafari){const htmlLayer=findHtmlLayerParent(containerRef.current);htmlLayer&&editor.timers.requestAnimationFrame((()=>{htmlLayer.style.display="none",editor.timers.requestAnimationFrame((()=>{htmlLayer.style.display=""}))}))}}),[editor,isReady]),(0,jsx_runtime.jsx)("g",{ref:containerRef,"data-testid":isReady?"ready-pattern-fill-defs":void 0,children:defs})}function findHtmlLayerParent(element){return element.classList.contains("tl-html-layer")?element:element.parentElement?findHtmlLayerParent(element.parentElement):null}const ShapeFill=react.memo((function ShapeFill2({theme,d,color,fill,scale}){switch(fill){case"none":return null;case"solid":return(0,jsx_runtime.jsx)("path",{fill:theme[color].semi,d});case"semi":return(0,jsx_runtime.jsx)("path",{fill:theme.solid,d});case"fill":return(0,jsx_runtime.jsx)("path",{fill:theme[color].fill,d});case"pattern":return(0,jsx_runtime.jsx)(PatternFill,{theme,color,fill,d,scale})}}));function PatternFill({d,color,theme}){const editor=(0,dist_esm.hGv)(),svgExport=(0,dist_esm.Jf5)(),zoomLevel=(0,dist_esm.hau)("zoomLevel",(()=>editor.getZoomLevel()),[editor]),getHashPatternZoomName=useGetHashPatternZoomName(),teenyTiny=editor.getZoomLevel()<=.18;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("path",{fill:theme[color].pattern,d}),(0,jsx_runtime.jsx)("path",{fill:svgExport?`url(#${getHashPatternZoomName(1,theme.id)})`:teenyTiny?theme[color].semi:`url(#${getHashPatternZoomName(zoomLevel,theme.id)})`,d})]})}function createTextJsxFromSpans(editor,spans,opts){const{padding=0}=opts;if(0===spans.length)return null;const bounds=dist_esm.azJ.From(spans[0].box);for(const{box}of spans)bounds.union(box);const offsetX=padding+(opts.offsetX??0),offsetY=(opts.offsetY??0)+opts.fontSize/2+("start"===opts.verticalTextAlign?padding:"end"===opts.verticalTextAlign?opts.height-padding-bounds.height:(Math.ceil(opts.height)-bounds.height)/2);let currentLineTop=null;const children=[];for(const{text,box}of spans){null!==currentLineTop&&box.y>currentLineTop&&children.push((0,jsx_runtime.jsx)("tspan",{alignmentBaseline:"mathematical",x:offsetX,y:box.y+offsetY,children:"\n"},children.length)),children.push((0,jsx_runtime.jsx)("tspan",{alignmentBaseline:"mathematical",x:box.x+offsetX,y:box.y+offsetY,unicodeBidi:"plaintext",children:(input=text,input.replace(/\s/g,"Â "))},children.length)),currentLineTop=box.y}var input;return(0,jsx_runtime.jsx)("text",{fontSize:opts.fontSize,fontFamily:opts.fontFamily,fontStyle:opts.fontStyle,fontWeight:opts.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:opts.stroke,strokeWidth:opts.strokeWidth,fill:opts.fill,children})}function SvgTextLabel({fontSize,font,align,verticalAlign,text,labelColor,bounds,padding=16,stroke=!0}){const editor=(0,dist_esm.hGv)(),theme=useDefaultColorTheme(),opts={fontSize,fontFamily:dist_esm.xXD[font],textAlign:align,verticalTextAlign:verticalAlign,width:Math.ceil(bounds.width),height:Math.ceil(bounds.height),padding,lineHeight:TEXT_PROPS.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0,offsetY:0,fill:labelColor,stroke:void 0,strokeWidth:void 0},spans=editor.textMeasure.measureTextSpans(text,opts),offsetX=function getLegacyOffsetX(align,padding,spans,totalWidth){if(("start-legacy"===align||"end-legacy"===align)&&0!==spans.length){const spansBounds=dist_esm.azJ.From(spans[0].box);for(const{box}of spans)spansBounds.union(box);if("start-legacy"===align)return(totalWidth-2*padding-spansBounds.width)/2;if("end-legacy"===align)return-(totalWidth-2*padding-spansBounds.width)/2}}(align,padding,spans,bounds.width);offsetX&&(opts.offsetX=offsetX),opts.offsetX+=bounds.x,opts.offsetY+=bounds.y;const mainSpans=createTextJsxFromSpans(0,spans,opts);let outlineSpans=null;return stroke&&(opts.fill=theme.background,opts.stroke=theme.background,opts.strokeWidth=2,outlineSpans=createTextJsxFromSpans(0,spans,opts)),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[outlineSpans,mainSpans]})}function getArrowBodyPath(shape,info,opts){switch(info.type){case"straight":return(new PathBuilder).moveTo(info.start.point.x,info.start.point.y,{offset:0,roundness:0}).lineTo(info.end.point.x,info.end.point.y,{offset:0,roundness:0}).toSvg(opts);case"arc":return(new PathBuilder).moveTo(info.start.point.x,info.start.point.y,{offset:0,roundness:0}).arcTo(info.bodyArc.radius,!!info.bodyArc.largeArcFlag,!!info.bodyArc.sweepFlag,info.end.point.x,info.end.point.y,{offset:0,roundness:0}).toSvg(opts);case"elbow":{const path=new PathBuilder;path.moveTo(info.start.point.x,info.start.point.y,{offset:0});for(let i=1;i<info.route.points.length;i++){const point=info.route.points[i];info.route.skipPointsWhenDrawing.has(point)||path.lineTo(point.x,point.y,{offset:i===info.route.points.length-1?0:void 0})}return path.toSvg(opts)}default:(0,dist_esm.h6G)(info,"type")}}function getArrowHandlePath(info,opts){switch(info.type){case"straight":return(new PathBuilder).moveTo(info.start.handle.x,info.start.handle.y).lineTo(info.end.handle.x,info.end.handle.y).toSvg(opts);case"arc":return(new PathBuilder).moveTo(info.start.handle.x,info.start.handle.y).arcTo(info.handleArc.radius,!!info.handleArc.largeArcFlag,!!info.handleArc.sweepFlag,info.end.handle.x,info.end.handle.y).toSvg(opts);case"elbow":{const handleRoute=function getRouteHandlePath(info,route){const startTarget=info.swapOrder?info.B.target:info.A.target,endTarget=info.swapOrder?info.A.target:info.B.target,firstSegmentLength=dist_esm.l2P.ManhattanDist(route.points[0],route.points[1]),lastSegmentLength=dist_esm.l2P.ManhattanDist(route.points[route.points.length-2],route.points[route.points.length-1]),firstSegmentLengthChange=firstSegmentLength-dist_esm.l2P.ManhattanDist(startTarget,route.points[1]),lastSegmentLengthChange=lastSegmentLength-dist_esm.l2P.ManhattanDist(route.points[route.points.length-2],endTarget),newPoints=[startTarget,...route.points,endTarget];return{name:route.name,distance:route.distance+firstSegmentLengthChange+lastSegmentLengthChange,points:newPoints.filter((p=>!route.skipPointsWhenDrawing.has(p))),aEdgePicking:route.aEdgePicking,bEdgePicking:route.bEdgePicking,skipPointsWhenDrawing:route.skipPointsWhenDrawing,midpointHandle:route.midpointHandle}}(info.elbow,info.route);return PathBuilder.throughPoints(handleRoute.points).toSvg(opts)}default:(0,dist_esm.h6G)(info,"type")}}const arrowBodyGeometryCache=(0,dist_esm.uYT)("arrow body geometry",((editor,shape)=>{const info=shared_getArrowInfo(editor,shape);switch(info.type){case"straight":return new dist_esm.AoN({start:dist_esm.l2P.From(info.start.point),end:dist_esm.l2P.From(info.end.point)});case"arc":return new dist_esm.xGO({center:dist_esm.l2P.Cast(info.handleArc.center),start:dist_esm.l2P.Cast(info.start.point),end:dist_esm.l2P.Cast(info.end.point),sweepFlag:info.bodyArc.sweepFlag,largeArcFlag:info.bodyArc.largeArcFlag});case"elbow":return new dist_esm.Hes({points:info.route.points});default:(0,dist_esm.h6G)(info,"type")}})),labelSizeCache=(0,dist_esm.uYT)("arrow label size",((editor,shape)=>{editor.fonts.trackFontsForShape(shape);let width=0,height=0;const bodyGeom=arrowBodyGeometryCache.get(editor,shape.id),text=shape.props.text||"i",bodyBounds=bodyGeom.bounds,fontSize=getArrowLabelFontSize(shape),{w,h}=editor.textMeasure.measureText(text,{...TEXT_PROPS,fontFamily:FONT_FAMILIES[shape.props.font],fontSize,maxWidth:null});width=w,height=h;let shouldSquish=!1;const info=shared_getArrowInfo(editor,shape),labelToArrowPadding=getLabelToArrowPadding(shape),margin="elbow"===info.type?Math.max(info.elbow.A.arrowheadOffset+labelToArrowPadding,32)+Math.max(info.elbow.B.arrowheadOffset+labelToArrowPadding,32):64;if(bodyBounds.width>bodyBounds.height?(width=Math.max(Math.min(w,margin),Math.min(bodyBounds.width-margin,w)),shouldSquish=!0):width>16*fontSize&&(width=16*fontSize,shouldSquish=!0),shouldSquish){const{w:squishedWidth,h:squishedHeight}=editor.textMeasure.measureText(text,{...TEXT_PROPS,fontFamily:FONT_FAMILIES[shape.props.font],fontSize,maxWidth:width});width=squishedWidth,height=squishedHeight}return new dist_esm.l2P(width,height).addScalar(8.5*shape.props.scale)}),{areRecordsEqual:(a,b)=>a.props===b.props});function getArrowLabelSize(editor,shape){return labelSizeCache.get(editor,shape.id)??new dist_esm.l2P(0,0)}function getLabelToArrowPadding(shape){const strokeWidth=default_shape_constants_STROKE_SIZES[shape.props.size];return(LABEL_TO_ARROW_PADDING+2*(strokeWidth-default_shape_constants_STROKE_SIZES.s)+(strokeWidth===default_shape_constants_STROKE_SIZES.xl?20:0))*shape.props.scale}function getArrowLabelPosition(editor,shape){const debugGeom=[],info=shared_getArrowInfo(editor,shape),arrowheadInfo={hasStartBinding:!!info.bindings.start,hasEndBinding:!!info.bindings.end,hasStartArrowhead:"none"!==info.start.arrowhead,hasEndArrowhead:"none"!==info.end.arrowhead},range=function getArrowLabelRange(editor,shape,info){const bodyGeom=arrowBodyGeometryCache.get(editor,shape.id),dbgPoints=[],dbg=[new dist_esm.IQE({children:[bodyGeom],debugColor:"lime"})],labelSize=getArrowLabelSize(editor,shape),labelToArrowPadding=getLabelToArrowPadding(shape),paddingRelative=labelToArrowPadding/bodyGeom.length;let startBox,endBox;if("elbow"===info.type)dbgPoints.push(info.start.point,info.end.point),startBox=dist_esm.azJ.FromCenter(info.start.point,labelSize).expandBy(labelToArrowPadding),endBox=dist_esm.azJ.FromCenter(info.end.point,labelSize).expandBy(labelToArrowPadding);else{const startPoint=bodyGeom.interpolateAlongEdge(paddingRelative),endPoint=bodyGeom.interpolateAlongEdge(1-paddingRelative);dbgPoints.push(startPoint,endPoint),startBox=dist_esm.azJ.FromCenter(startPoint,labelSize),endBox=dist_esm.azJ.FromCenter(endPoint,labelSize)}const startIntersections=bodyGeom.intersectPolygon(startBox.corners),endIntersections=bodyGeom.intersectPolygon(endBox.corners),startConstrained=furthest(info.start.point,startIntersections),endConstrained=furthest(info.end.point,endIntersections);let startRelative=startConstrained?bodyGeom.uninterpolateAlongEdge(startConstrained):.5,endRelative=endConstrained?bodyGeom.uninterpolateAlongEdge(endConstrained):.5;startRelative>endRelative&&(startRelative=.5,endRelative=.5);for(const pt of[...startIntersections,...endIntersections,...dbgPoints])dbg.push(new dist_esm.PUi({x:pt.x-3,y:pt.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));return dbg.push(new dist_esm.dxv({points:startBox.corners,debugColor:"lime",isFilled:!1,ignore:!0}),new dist_esm.dxv({points:endBox.corners,debugColor:"lime",isFilled:!1,ignore:!0})),{start:startRelative,end:endRelative,dbg}}(editor,shape,info);range.dbg&&debugGeom.push(...range.dbg);const clampedPosition=function getClampedPosition(shape,range,arrowheadInfo){const{hasEndArrowhead,hasEndBinding,hasStartBinding,hasStartArrowhead}=arrowheadInfo,clampedPosition=(0,dist_esm.qE8)(shape.props.labelPosition,hasStartArrowhead||hasStartBinding?range.start:0,hasEndArrowhead||hasEndBinding?range.end:1);return clampedPosition}(shape,range,arrowheadInfo),labelCenter=arrowBodyGeometryCache.get(editor,shape.id).interpolateAlongEdge(clampedPosition),labelSize=getArrowLabelSize(editor,shape);return{box:dist_esm.azJ.FromCenter(labelCenter,labelSize),debugGeom}}function furthest(from,candidates){let furthest2=null,furthestDist=-1/0;for(const candidate of candidates){const dist=dist_esm.l2P.Dist2(from,candidate);dist>furthestDist&&(furthest2=candidate,furthestDist=dist)}return furthest2}function getArrowLabelFontSize(shape){return ARROW_LABEL_FONT_SIZES[shape.props.size]*shape.props.scale}function getArrowLabelDefaultPosition(editor,shape){const info=shared_getArrowInfo(editor,shape);switch(info.type){case"straight":case"arc":return.5;case"elbow":{const midpointHandle=info.route.midpointHandle,bodyGeom=arrowBodyGeometryCache.get(editor,shape.id);return midpointHandle&&bodyGeom?bodyGeom.uninterpolateAlongEdge(midpointHandle.point):.5}default:(0,dist_esm.h6G)(info,"type")}}function getArrowheadPathForType(info,side,strokeWidth){const type="end"===side?info.end.arrowhead:info.start.arrowhead;if("none"===type)return;const points=function getArrowPoints(info,side,strokeWidth){const point="end"===side?info.end.point:info.start.point;let int;switch(info.type){case"straight":{const opposite="end"===side?info.start.point:info.end.point,compareLength=dist_esm.l2P.Dist(opposite,point),length=(0,dist_esm.qE8)(compareLength/5,strokeWidth,3*strokeWidth);int=dist_esm.l2P.Nudge(point,opposite,length);break}case"arc":{const compareLength=Math.abs(info.bodyArc.length),length=(0,dist_esm.qE8)(compareLength/5,strokeWidth,3*strokeWidth),intersections=(0,dist_esm.OpZ)(point,length,info.handleArc.center,info.handleArc.radius);int="end"===side?info.handleArc.sweepFlag?intersections[0]:intersections[1]:info.handleArc.sweepFlag?intersections[1]:intersections[0];break}case"elbow":{const previousPoint="end"===side?info.route.points[info.route.points.length-2]:info.route.points[1],previousSegmentLength=dist_esm.l2P.ManhattanDist(previousPoint,point),length=(0,dist_esm.qE8)(previousSegmentLength/2,strokeWidth,3*strokeWidth);int=previousPoint?dist_esm.l2P.Nudge(point,previousPoint,length):point;break}default:(0,dist_esm.h6G)(info,"type")}return dist_esm.l2P.IsNaN(int)&&(int=point),{point,int}}(info,side,strokeWidth);if(points){switch(type){case"bar":return function getBarHead({int,point}){const d=dist_esm.l2P.Sub(int,point).div(2),PL=dist_esm.l2P.Add(point,dist_esm.l2P.Rot(d,dist_esm.sKG)),PR=dist_esm.l2P.Sub(point,dist_esm.l2P.Rot(d,dist_esm.sKG));return`M ${PL.x} ${PL.y} L ${PR.x} ${PR.y}`}(points);case"square":return function getSquareHead({int,point}){const PB=dist_esm.l2P.Lrp(point,int,.85),d=dist_esm.l2P.Sub(PB,point).div(2),PL1=dist_esm.l2P.Add(point,dist_esm.l2P.Rot(d,dist_esm.sKG)),PR1=dist_esm.l2P.Sub(point,dist_esm.l2P.Rot(d,dist_esm.sKG)),PL2=dist_esm.l2P.Add(PB,dist_esm.l2P.Rot(d,dist_esm.sKG)),PR2=dist_esm.l2P.Sub(PB,dist_esm.l2P.Rot(d,dist_esm.sKG));return`M ${PL1.x} ${PL1.y} L ${PL2.x} ${PL2.y} L ${PR2.x} ${PR2.y} L ${PR1.x} ${PR1.y} Z`}(points);case"diamond":return function getDiamondHead({point,int}){const PB=dist_esm.l2P.Lrp(point,int,.75),PL=dist_esm.l2P.RotWith(PB,point,dist_esm.PI/4),PR=dist_esm.l2P.RotWith(PB,point,-dist_esm.PI/4),PQ=dist_esm.l2P.Lrp(PL,PR,.5);return PQ.add(dist_esm.l2P.Sub(PQ,point)),`M ${PQ.x} ${PQ.y} L ${PR.x} ${PR.y} ${point.x} ${point.y} L ${PL.x} ${PL.y} Z`}(points);case"dot":return function getDotHead({point,int}){const A=dist_esm.l2P.Lrp(point,int,.45),r=dist_esm.l2P.Dist(A,point);return`M ${A.x-r},${A.y}\n  a ${r},${r} 0 1,0 ${2*r},0\n  a ${r},${r} 0 1,0 -${2*r},0 `}(points);case"inverted":return function getInvertedTriangleHead({point,int}){const d=dist_esm.l2P.Sub(int,point).div(2),PL=dist_esm.l2P.Add(point,dist_esm.l2P.Rot(d,dist_esm.sKG)),PR=dist_esm.l2P.Sub(point,dist_esm.l2P.Rot(d,dist_esm.sKG));return`M ${PL.x} ${PL.y} L ${int.x} ${int.y} L ${PR.x} ${PR.y} Z`}(points);case"arrow":return function getArrowhead({point,int}){const PL=dist_esm.l2P.RotWith(int,point,dist_esm.PI/6),PR=dist_esm.l2P.RotWith(int,point,-dist_esm.PI/6);return`M ${PL.x} ${PL.y} L ${point.x} ${point.y} L ${PR.x} ${PR.y}`}(points);case"triangle":return function getTriangleHead({point,int}){const PL=dist_esm.l2P.RotWith(int,point,dist_esm.PI/6),PR=dist_esm.l2P.RotWith(int,point,-dist_esm.PI/6);return`M ${PL.x} ${PL.y} L ${PR.x} ${PR.y} L ${point.x} ${point.y} Z`}(points)}return""}}function ElbowArrowDebug({arrow}){const editor=(0,dist_esm.hGv)(),info=(0,dist_esm.hau)("elbow arrow grid",(()=>{try{return getElbowArrowInfo(editor,editor.getShape(arrow.id),shared_getArrowBindings(editor,arrow))}catch(err){return void console.error(err)}}),[editor,arrow.id]);if(!info)return null;const fullBox=dist_esm.azJ.Common([info.A.original,info.B.original]).expandBy(50),label=info.route?.name??"",midPoint=info.route?.midpointHandle;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[null!==info.midX&&(0,jsx_runtime.jsx)(DebugLine,{a:{x:info.midX,y:fullBox.minY},b:{x:info.midX,y:fullBox.maxY},stroke:"red"}),null!==info.midY&&(0,jsx_runtime.jsx)(DebugLine,{a:{x:fullBox.minX,y:info.midY},b:{x:fullBox.maxX,y:info.midY},stroke:"blue"}),"x"===midPoint?.axis&&info.midXRange&&(0,jsx_runtime.jsx)(DebugLine,{a:{x:info.midXRange.lo,y:midPoint.point.y},b:{x:info.midXRange.hi,y:midPoint.point.y},stroke:"red",strokeDasharray:"0 2"}),"y"===midPoint?.axis&&info.midYRange&&(0,jsx_runtime.jsx)(DebugLine,{a:{x:midPoint.point.x,y:info.midYRange.lo},b:{x:midPoint.point.x,y:info.midYRange.hi},stroke:"blue",strokeDasharray:"0 2"}),(0,jsx_runtime.jsx)(DebugBox,{box:info.A.original,stroke:"orange"}),(0,jsx_runtime.jsx)(DebugBox,{box:info.A.expanded,stroke:"orange",strokeWidth:.5}),(0,jsx_runtime.jsx)(DebugBox,{box:info.A.original.clone().expandBy(info.options.minElbowLegLength),stroke:"orange",strokeWidth:.5}),(0,jsx_runtime.jsx)(DebugBox,{box:info.B.original,stroke:"lightskyblue"}),(0,jsx_runtime.jsx)(DebugBox,{box:info.B.expanded,stroke:"lightskyblue",strokeWidth:.5}),(0,jsx_runtime.jsx)(DebugBox,{box:info.B.original.clone().expandBy(info.options.minElbowLegLength),stroke:"lightskyblue",strokeWidth:.5}),(0,jsx_runtime.jsx)(DebugEdge,{edge:info.A.edges.top,axis:"x",stroke:"orange"}),(0,jsx_runtime.jsx)(DebugEdge,{edge:info.B.edges.top,axis:"x",stroke:"lightskyblue"}),(0,jsx_runtime.jsx)(DebugEdge,{edge:info.A.edges.right,axis:"y",stroke:"orange"}),(0,jsx_runtime.jsx)(DebugEdge,{edge:info.B.edges.right,axis:"y",stroke:"lightskyblue"}),(0,jsx_runtime.jsx)(DebugEdge,{edge:info.A.edges.bottom,axis:"x",stroke:"orange"}),(0,jsx_runtime.jsx)(DebugEdge,{edge:info.B.edges.bottom,axis:"x",stroke:"lightskyblue"}),(0,jsx_runtime.jsx)(DebugEdge,{edge:info.A.edges.left,axis:"y",stroke:"orange"}),(0,jsx_runtime.jsx)(DebugEdge,{edge:info.B.edges.left,axis:"y",stroke:"lightskyblue"}),info.route&&(0,jsx_runtime.jsx)(DebugRoute,{route:info.route.points,strokeWidth:10}),(0,jsx_runtime.jsx)("text",{x:fullBox.minX+5,y:fullBox.minY-3,fontSize:10,fill:"black",stroke:"var(--color-background)",strokeWidth:2,paintOrder:"stroke",children:label}),(0,jsx_runtime.jsxs)("text",{x:info.A.expanded.x,y:info.A.expanded.y,fontSize:10,fill:"black",stroke:"var(--color-background)",strokeWidth:2,paintOrder:"stroke",children:["A",info.route&&`, ${info.route.aEdgePicking}`,info.A.isPoint&&", point"]}),(0,jsx_runtime.jsxs)("text",{x:info.B.expanded.x,y:info.B.expanded.y,fontSize:10,fill:"black",stroke:"var(--color-background)",strokeWidth:2,paintOrder:"stroke",children:["B",info.route&&`, ${info.route.bEdgePicking}`,info.B.isPoint&&", point"]})]})}function DebugLine({a,b,...props}){return(0,jsx_runtime.jsx)("line",{fill:"none",strokeWidth:1,strokeDasharray:"4,4",stroke:"green",x1:a.x,y1:a.y,x2:b.x,y2:b.y,...props})}function DebugRoute({route,...props}){return(0,jsx_runtime.jsx)("polyline",{fill:"none",stroke:"darkorchid",strokeWidth:3,opacity:.5,points:route.map((r=>`${r.x},${r.y}`)).join(" "),...props})}function DebugEdge({edge,axis,...props}){if(!edge||null===edge.expanded)return null;const vec=vec2=>"x"===axis?{x:vec2.y,y:vec2.x}:vec2;return(0,jsx_runtime.jsxs)("g",{children:[(0,jsx_runtime.jsx)(DebugLine,{a:vec({x:edge.expanded,y:edge.cross.min}),b:vec({x:edge.expanded,y:edge.cross.max}),strokeDasharray:"0",strokeWidth:1.5,...props}),(0,jsx_runtime.jsx)(DebugLine,{a:vec({x:edge.expanded-4,y:edge.cross.min}),b:vec({x:edge.expanded+4,y:edge.cross.min}),strokeDasharray:"0",strokeWidth:1.5,...props}),(0,jsx_runtime.jsx)(DebugLine,{a:vec({x:edge.expanded-4,y:edge.cross.max}),b:vec({x:edge.expanded+4,y:edge.cross.max}),strokeDasharray:"0",strokeWidth:1.5,...props})]})}function DebugBox({box,...props}){return(0,jsx_runtime.jsx)("rect",{x:box.minX,y:box.minY,width:box.width,height:box.height,strokeDasharray:"4,4",strokeWidth:1,fill:"none",...props})}const snapLinesStore=new dist_esm.laH;function perpDistanceToLineAngle(pointOnLine,lineAngle){const perpDir=dist_esm.l2P.FromAngle(lineAngle).per();return dist_esm.l2P.Dpr(pointOnLine,perpDir)}class ArrowShapeUtil extends dist_esm.inY{static type="arrow";static props=dist_esm.FXh;static migrations=dist_esm.udf;options={expandElbowLegLength:{s:28,m:36,l:44,xl:66},minElbowLegLength:{s:3*default_shape_constants_STROKE_SIZES.s,m:3*default_shape_constants_STROKE_SIZES.m,l:3*default_shape_constants_STROKE_SIZES.l,xl:3*default_shape_constants_STROKE_SIZES.xl},minElbowHandleDistance:16,arcArrowCenterSnapDistance:16,elbowArrowCenterSnapDistance:24,elbowArrowEdgeSnapDistance:20,elbowArrowPointSnapDistance:24,elbowArrowAxisSnapDistance:16,labelCenterSnapDistance:10,elbowMidpointSnapDistance:10,elbowMinSegmentLengthToShowMidpointHandle:20,hoverPreciseTimeout:600,pointingPreciseTimeout:320};canEdit(){return!0}canBind({toShapeType}){return"arrow"!==toShapeType}canSnap(){return!1}canTabTo(shape){const bindings=shared_getArrowBindings(this.editor,shape);return!!(bindings.start||bindings.end||shape.props.text)}hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsBg(){return!0}hideSelectionBoundsFg(){return!0}canBeLaidOut(shape,info){if("flip"===info.type){const bindings=shared_getArrowBindings(this.editor,shape),{start,end}=bindings,{shapes=[]}=info;if(start&&!shapes.find((s=>s.id===start.toId)))return!1;if(end&&!shapes.find((s=>s.id===end.toId)))return!1}return!0}getFontFaces(shape){return shape.props.text?[DefaultFontFaces[`tldraw_${shape.props.font}`].normal.normal]:dist_esm.Mlv}getDefaultProps(){return{kind:"arc",elbowMidPoint:.5,dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw",scale:1}}getGeometry(shape){const isEditing=this.editor.getEditingShapeId()===shape.id,info=shared_getArrowInfo(this.editor,shape),debugGeom=[],bodyGeom="straight"===info.type?new dist_esm.AoN({start:dist_esm.l2P.From(info.start.point),end:dist_esm.l2P.From(info.end.point)}):"arc"===info.type?new dist_esm.xGO({center:dist_esm.l2P.Cast(info.handleArc.center),start:dist_esm.l2P.Cast(info.start.point),end:dist_esm.l2P.Cast(info.end.point),sweepFlag:info.bodyArc.sweepFlag,largeArcFlag:info.bodyArc.largeArcFlag}):new dist_esm.Hes({points:info.route.points});let labelGeom;if(isEditing||shape.props.text.trim()){const labelPosition=getArrowLabelPosition(this.editor,shape);dist_esm.bGJ.debugGeometry.get()&&debugGeom.push(...labelPosition.debugGeom),labelGeom=new dist_esm.krb({x:labelPosition.box.x,y:labelPosition.box.y,width:labelPosition.box.w,height:labelPosition.box.h,isFilled:!0,isLabel:!0})}return new dist_esm.IQE({children:[...labelGeom?[bodyGeom,labelGeom]:[bodyGeom],...debugGeom]})}getHandles(shape){const info=shared_getArrowInfo(this.editor,shape),handles=[{id:"start",type:"vertex",index:"a1",x:info.start.handle.x,y:info.start.handle.y},{id:"end",type:"vertex",index:"a3",x:info.end.handle.x,y:info.end.handle.y}];if("arc"!==shape.props.kind||"straight"!==info.type&&"arc"!==info.type||handles.push({id:"middle",type:"virtual",index:"a2",x:info.middle.x,y:info.middle.y}),"elbow"===shape.props.kind&&"elbow"===info.type&&info.route.midpointHandle){const shapePageTransform=this.editor.getShapePageTransform(shape.id),segmentStart=shapePageTransform.applyToPoint(info.route.midpointHandle.segmentStart),segmentEnd=shapePageTransform.applyToPoint(info.route.midpointHandle.segmentEnd);dist_esm.l2P.Dist(segmentStart,segmentEnd)*this.editor.getZoomLevel()>this.options.elbowMinSegmentLengthToShowMidpointHandle&&handles.push({id:"middle",type:"vertex",index:"a2",x:info.route.midpointHandle.point.x,y:info.route.midpointHandle.point.y})}return handles}getText(shape){return shape.props.text}onHandleDrag(shape,info){const handleId=info.handle.id;switch(handleId){case"middle":switch(shape.props.kind){case"arc":return this.onArcMidpointHandleDrag(shape,info);case"elbow":return this.onElbowMidpointHandleDrag(shape,info);default:(0,dist_esm.h6G)(shape.props.kind)}case"start":case"end":return this.onTerminalHandleDrag(shape,info,handleId);default:(0,dist_esm.h6G)(handleId)}}onArcMidpointHandleDrag(shape,{handle}){const bindings=shared_getArrowBindings(this.editor,shape),{start,end}=getArrowTerminalsInArrowSpace(this.editor,shape,bindings),delta=dist_esm.l2P.Sub(end,start),v=dist_esm.l2P.Per(delta),med=dist_esm.l2P.Med(end,start),A=dist_esm.l2P.Sub(med,v),B=dist_esm.l2P.Add(med,v),point=dist_esm.l2P.NearestPointOnLineSegment(A,B,handle,!1);let bend=dist_esm.l2P.Dist(point,med);return dist_esm.l2P.Clockwise(point,end,med)&&(bend*=-1),{id:shape.id,type:shape.type,props:{bend}}}onElbowMidpointHandleDrag(shape,{handle}){const info=shared_getArrowInfo(this.editor,shape);if("elbow"!==info?.type)return;const shapeToPageTransform=this.editor.getShapePageTransform(shape.id),handlePagePoint=shapeToPageTransform.applyToPoint(handle),axisName=info.route.midpointHandle?.axis;if(!axisName)return;const axis=ElbowArrowAxes[axisName],midRange=info.elbow[axis.midRange];if(!midRange)return;let angle=dist_esm.l2P.Angle(shapeToPageTransform.applyToPoint(axis.v(0,0)),shapeToPageTransform.applyToPoint(axis.v(0,1)));angle<0&&(angle+=Math.PI);const handlePoint=perpDistanceToLineAngle(handlePagePoint,angle),loPoint=perpDistanceToLineAngle(shapeToPageTransform.applyToPoint(axis.v(midRange.lo,0)),angle),hiPoint=perpDistanceToLineAngle(shapeToPageTransform.applyToPoint(axis.v(midRange.hi,0)),angle),maxSnapDistance=this.options.elbowMidpointSnapDistance/this.editor.getZoomLevel(),midPoint=perpDistanceToLineAngle(shapeToPageTransform.applyToPoint(axis.v((0,dist_esm.CcK)(midRange.lo,midRange.hi,.5),0)),angle);let snapPoint=midPoint,snapDistance=Math.abs(midPoint-handlePoint);for(const[snapAngle,snapLines]of function getElbowArrowSnapLines(editor){return snapLinesStore.get(editor,(editor2=>{const currentSelectedArrowShape=(0,dist_esm.EWP)("current selected arrow shape",(()=>{const shape=editor2.getOnlySelectedShape();return shape&&editor2.isShapeOfType(shape,"arrow")?shape.id:null})),unselectedArrowShapeIds=editor2.store.query.ids("shape",(()=>{const activeArrowShapeId=currentSelectedArrowShape.get();return activeArrowShapeId?{type:{eq:"arrow"},id:{neq:activeArrowShapeId}}:{type:{eq:"arrow"}}}));return(0,dist_esm.EWP)("elbow arrow snap lines",(()=>{const result=new Map,currentPageShapeIds=editor2.getCurrentPageShapeIds(),viewportBounds=editor2.getViewportPageBounds();for(const id of unselectedArrowShapeIds.get()){if(!currentPageShapeIds.has(id))continue;const shape=editor2.getShape(id);if("arrow"!==shape?.type)continue;const shapeBounds=editor2.getShapePageBounds(id);if(!shapeBounds||!viewportBounds.includes(shapeBounds))continue;const bindings=shared_getArrowBindings(editor2,shape),vertices=editor2.getShapePageGeometry(id).getVertices({includeInternal:!1,includeLabels:!1});for(let i=1;i<vertices.length;i++){const prev=vertices[i-1],curr=vertices[i];let angle=dist_esm.l2P.Angle(prev,curr);angle<0&&(angle+=Math.PI);let set=result.get(angle);set||(set=new Set,result.set(angle,set));const perpDistance=perpDistanceToLineAngle(prev,angle);set.add({perpDistance,startBoundShapeId:bindings.start?.toId,endBoundShapeId:bindings.end?.toId})}}return result}))})).get()}(this.editor)){const{isParallel,isFlippedParallel}=anglesAreApproximatelyParallel(angle,snapAngle);if(isParallel||isFlippedParallel)for(const snapLine of snapLines){const doesShareStartIntersection=snapLine.startBoundShapeId&&(snapLine.startBoundShapeId===info.bindings.start?.toId||snapLine.startBoundShapeId===info.bindings.end?.toId),doesShareEndIntersection=snapLine.endBoundShapeId&&(snapLine.endBoundShapeId===info.bindings.start?.toId||snapLine.endBoundShapeId===info.bindings.end?.toId);if(!doesShareStartIntersection&&!doesShareEndIntersection)continue;const point=isFlippedParallel?-snapLine.perpDistance:snapLine.perpDistance,distance=Math.abs(point-handlePoint);distance<snapDistance&&(snapPoint=point,snapDistance=distance)}}snapDistance>maxSnapDistance&&(snapPoint=handlePoint);const newMid=(0,dist_esm.qE8)((0,dist_esm.Fg_)(loPoint,hiPoint,snapPoint),0,1);return{id:shape.id,type:shape.type,props:{elbowMidPoint:newMid}}}onTerminalHandleDrag(shape,{handle,isPrecise},handleId){const bindings=shared_getArrowBindings(this.editor,shape),update={id:shape.id,type:"arrow",props:{}},currentBinding=bindings[handleId],oppositeBinding=bindings["start"===handleId?"end":"start"],targetInfo=updateArrowTargetState({editor:this.editor,pointInPageSpace:this.editor.getShapePageTransform(shape.id).applyToPoint(handle),arrow:shape,isPrecise,isExact:this.editor.inputs.altKey,currentBinding,oppositeBinding});if(!targetInfo){removeArrowBinding(this.editor,shape,handleId);const newPoint=(0,dist_esm.Y8F)(new dist_esm.l2P(handle.x,handle.y),this.editor);return update.props[handleId]={x:newPoint.x,y:newPoint.y},update}const bindingProps={terminal:handleId,normalizedAnchor:targetInfo.normalizedAnchor,isPrecise:targetInfo.isPrecise,isExact:this.editor.inputs.altKey,snap:targetInfo.snap};createOrUpdateArrowBinding(this.editor,shape,targetInfo.target.id,bindingProps);const newBindings=shared_getArrowBindings(this.editor,shape);return newBindings.start&&newBindings.end&&newBindings.start.toId===newBindings.end.toId&&dist_esm.l2P.Equals(newBindings.start.props.normalizedAnchor,newBindings.end.props.normalizedAnchor)&&createOrUpdateArrowBinding(this.editor,shape,newBindings.end.toId,{...newBindings.end.props,normalizedAnchor:{x:newBindings.end.props.normalizedAnchor.x+.05,y:newBindings.end.props.normalizedAnchor.y}}),update}onTranslateStart(shape){const bindings=shared_getArrowBindings(this.editor,shape);if("elbow"===shape.props.kind&&this.editor.getOnlySelectedShapeId()===shape.id){const info=shared_getArrowInfo(this.editor,shape);if(!info)return;const update={id:shape.id,type:"arrow",props:{}};return bindings.start&&(update.props.start={x:info.start.point.x,y:info.start.point.y},removeArrowBinding(this.editor,shape,"start")),bindings.end&&(update.props.end={x:info.end.point.x,y:info.end.point.y},removeArrowBinding(this.editor,shape,"end")),update}const terminalsInArrowSpace=getArrowTerminalsInArrowSpace(this.editor,shape,bindings),shapePageTransform=this.editor.getShapePageTransform(shape.id),selectedShapeIds=this.editor.getSelectedShapeIds();if(!(bindings.start&&(selectedShapeIds.includes(bindings.start.toId)||this.editor.isAncestorSelected(bindings.start.toId))||bindings.end&&(selectedShapeIds.includes(bindings.end.toId)||this.editor.isAncestorSelected(bindings.end.toId)))){shapeAtTranslationStart.set(shape,{pagePosition:shapePageTransform.applyToPoint(shape),terminalBindings:(0,dist_esm._Hz)(terminalsInArrowSpace,((terminalName,point)=>{const binding=bindings[terminalName];return binding?{binding,shapePosition:point,pagePosition:shapePageTransform.applyToPoint(point)}:null}))}),bindings.start&&(updateArrowTerminal({editor:this.editor,arrow:shape,terminal:"start",useHandle:!0}),shape=this.editor.getShape(shape.id)),bindings.end&&updateArrowTerminal({editor:this.editor,arrow:shape,terminal:"end",useHandle:!0});for(const handleName of["start","end"]){const binding=bindings[handleName];binding&&this.editor.updateBinding({...binding,props:{...binding.props,isPrecise:!0}})}}}onTranslate(initialShape,shape){const atTranslationStart=shapeAtTranslationStart.get(initialShape);if(!atTranslationStart)return;const shapePageTransform=this.editor.getShapePageTransform(shape.id),pageDelta=dist_esm.l2P.Sub(shapePageTransform.applyToPoint(shape),atTranslationStart.pagePosition);for(const terminalBinding of Object.values(atTranslationStart.terminalBindings)){if(!terminalBinding)continue;const newPagePoint=dist_esm.l2P.Add(terminalBinding.pagePosition,dist_esm.l2P.Mul(pageDelta,.5)),newTarget=this.editor.getShapeAtPoint(newPagePoint,{hitInside:!0,hitFrameInside:!0,margin:0,filter:targetShape=>!targetShape.isLocked&&this.editor.canBindShapes({fromShape:shape,toShape:targetShape,binding:"arrow"})});if(newTarget?.id===terminalBinding.binding.toId){const targetBounds=dist_esm.azJ.ZeroFix(this.editor.getShapeGeometry(newTarget).bounds),pointInTargetSpace=this.editor.getPointInShapeSpace(newTarget,newPagePoint),normalizedAnchor={x:(pointInTargetSpace.x-targetBounds.minX)/targetBounds.width,y:(pointInTargetSpace.y-targetBounds.minY)/targetBounds.height};createOrUpdateArrowBinding(this.editor,shape,newTarget.id,{...terminalBinding.binding.props,normalizedAnchor,isPrecise:!0})}else removeArrowBinding(this.editor,shape,terminalBinding.binding.props.terminal)}}_resizeInitialBindings=new dist_esm.laH;onResize(shape,info){const{scaleX,scaleY}=info,bindings=this._resizeInitialBindings.get(shape,(()=>shared_getArrowBindings(this.editor,shape))),terminals=getArrowTerminalsInArrowSpace(this.editor,shape,bindings),{start,end}=(0,dist_esm.pN9)(shape.props);let{bend}=shape.props;bindings.start||(start.x=terminals.start.x*scaleX,start.y=terminals.start.y*scaleY),bindings.end||(end.x=terminals.end.x*scaleX,end.y=terminals.end.y*scaleY);const mx=Math.abs(scaleX),my=Math.abs(scaleY),startNormalizedAnchor=bindings?.start?dist_esm.l2P.From(bindings.start.props.normalizedAnchor):null,endNormalizedAnchor=bindings?.end?dist_esm.l2P.From(bindings.end.props.normalizedAnchor):null;scaleX<0&&scaleY>=0?(0!==bend&&(bend*=-1,bend*=Math.max(mx,my)),startNormalizedAnchor&&(startNormalizedAnchor.x=1-startNormalizedAnchor.x),endNormalizedAnchor&&(endNormalizedAnchor.x=1-endNormalizedAnchor.x)):scaleX>=0&&scaleY<0?(0!==bend&&(bend*=-1,bend*=Math.max(mx,my)),startNormalizedAnchor&&(startNormalizedAnchor.y=1-startNormalizedAnchor.y),endNormalizedAnchor&&(endNormalizedAnchor.y=1-endNormalizedAnchor.y)):scaleX>=0&&scaleY>=0?0!==bend&&(bend*=Math.max(mx,my)):scaleX<0&&scaleY<0&&(0!==bend&&(bend*=Math.max(mx,my)),startNormalizedAnchor&&(startNormalizedAnchor.x=1-startNormalizedAnchor.x,startNormalizedAnchor.y=1-startNormalizedAnchor.y),endNormalizedAnchor&&(endNormalizedAnchor.x=1-endNormalizedAnchor.x,endNormalizedAnchor.y=1-endNormalizedAnchor.y)),bindings.start&&startNormalizedAnchor&&createOrUpdateArrowBinding(this.editor,shape,bindings.start.toId,{...bindings.start.props,normalizedAnchor:startNormalizedAnchor.toJson()}),bindings.end&&endNormalizedAnchor&&createOrUpdateArrowBinding(this.editor,shape,bindings.end.toId,{...bindings.end.props,normalizedAnchor:endNormalizedAnchor.toJson()});return{props:{start,end,bend}}}onDoubleClickHandle(shape,handle){switch(handle.id){case"start":return{id:shape.id,type:shape.type,props:{...shape.props,arrowheadStart:"none"===shape.props.arrowheadStart?"arrow":"none"}};case"end":return{id:shape.id,type:shape.type,props:{...shape.props,arrowheadEnd:"none"===shape.props.arrowheadEnd?"arrow":"none"}}}}component(shape){const theme=useDefaultColorTheme(),onlySelectedShape=this.editor.getOnlySelectedShape(),shouldDisplayHandles=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getIsReadonly(),info=shared_getArrowInfo(this.editor,shape);if(!info?.isValid)return null;const labelPosition=getArrowLabelPosition(this.editor,shape),isSelected=shape.id===this.editor.getOnlySelectedShapeId(),showArrowLabel=this.editor.getEditingShapeId()===shape.id||shape.props.text;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(dist_esm.ULM,{style:{minWidth:50,minHeight:50},children:[(0,jsx_runtime.jsx)(ArrowSvg,{shape,shouldDisplayHandles:shouldDisplayHandles&&onlySelectedShape?.id===shape.id}),"elbow"===shape.props.kind&&dist_esm.bGJ.debugElbowArrows.get()&&(0,jsx_runtime.jsx)(ElbowArrowDebug,{arrow:shape})]}),showArrowLabel&&(0,jsx_runtime.jsx)(PlainTextLabel,{shapeId:shape.id,classNamePrefix:"tl-arrow",type:"arrow",font:shape.props.font,fontSize:getArrowLabelFontSize(shape),lineHeight:TEXT_PROPS.lineHeight,align:"middle",verticalAlign:"middle",text:shape.props.text,labelColor:theme[shape.props.labelColor].solid,textWidth:labelPosition.box.w-8.5*shape.props.scale,isSelected,padding:0,style:{transform:`translate(${labelPosition.box.center.x}px, ${labelPosition.box.center.y}px)`}})]})}indicator(shape){const isEditing=(0,dist_esm._As)(shape.id),clipPathId=(0,dist_esm.Xhk)(shape.id+"_clip"),info=shared_getArrowInfo(this.editor,shape);if(!info)return null;const{start,end}=getArrowTerminalsInArrowSpace(this.editor,shape,info?.bindings),geometry=this.editor.getShapeGeometry(shape),bounds=geometry.bounds,labelGeometry=isEditing||shape.props.text.trim()?geometry.children[1]:null;if(dist_esm.l2P.Equals(start,end))return null;const strokeWidth=default_shape_constants_STROKE_SIZES[shape.props.size]*shape.props.scale,as=info.start.arrowhead&&getArrowheadPathForType(info,"start",strokeWidth),ae=info.end.arrowhead&&getArrowheadPathForType(info,"end",strokeWidth),includeClipPath=as&&"arrow"!==info.start.arrowhead||ae&&"arrow"!==info.end.arrowhead||!!labelGeometry;if(isEditing&&labelGeometry)return(0,jsx_runtime.jsx)("rect",{x:(0,dist_esm.WMC)(labelGeometry.x),y:(0,dist_esm.WMC)(labelGeometry.y),width:labelGeometry.w,height:labelGeometry.h,rx:3.5*shape.props.scale,ry:3.5*shape.props.scale});const clipStartArrowhead=!("none"===info.start.arrowhead||"arrow"===info.start.arrowhead),clipEndArrowhead=!("none"===info.end.arrowhead||"arrow"===info.end.arrowhead);return(0,jsx_runtime.jsxs)("g",{children:[includeClipPath&&(0,jsx_runtime.jsx)("defs",{children:(0,jsx_runtime.jsx)(ArrowClipPath,{radius:3.5*shape.props.scale,hasText:shape.props.text.trim().length>0,bounds,labelBounds:labelGeometry?labelGeometry.getBounds():new dist_esm.azJ(0,0,0,0),as:clipStartArrowhead&&as?as:"",ae:clipEndArrowhead&&ae?ae:""})}),(0,jsx_runtime.jsxs)("g",{style:{clipPath:includeClipPath?`url(#${clipPathId})`:void 0,WebkitClipPath:includeClipPath?`url(#${clipPathId})`:void 0},children:[includeClipPath&&(0,jsx_runtime.jsx)("rect",{x:bounds.minX-100,y:bounds.minY-100,width:bounds.width+200,height:bounds.height+200,opacity:0}),getArrowBodyPath(0,info,"draw"===shape.props.dash?{style:"draw",randomSeed:shape.id,strokeWidth:1,passes:1,offset:0,roundness:2*strokeWidth,props:{strokeWidth:void 0}}:{style:"solid",strokeWidth:1,props:{strokeWidth:void 0}})]}),as&&(0,jsx_runtime.jsx)("path",{d:as}),ae&&(0,jsx_runtime.jsx)("path",{d:ae}),labelGeometry&&(0,jsx_runtime.jsx)("rect",{x:(0,dist_esm.WMC)(labelGeometry.x),y:(0,dist_esm.WMC)(labelGeometry.y),width:labelGeometry.w,height:labelGeometry.h,rx:3.5,ry:3.5})]})}onEditStart(shape){if(""===shape.props.text.trim()){const labelPosition=getArrowLabelDefaultPosition(this.editor,shape);this.editor.updateShape({id:shape.id,type:shape.type,props:{labelPosition}})}}onEditEnd(shape){const{id,type,props:{text}}=shape;text.trimEnd()!==shape.props.text&&this.editor.updateShapes([{id,type,props:{text:text.trimEnd()}}])}toSvg(shape,ctx){ctx.addExportDef(getFillDefForExport(shape.props.fill));const theme=(0,dist_esm.AnR)(ctx),scaleFactor=1/shape.props.scale;return(0,jsx_runtime.jsxs)("g",{transform:`scale(${scaleFactor})`,children:[(0,jsx_runtime.jsx)(ArrowSvg,{shape,shouldDisplayHandles:!1}),(0,jsx_runtime.jsx)(SvgTextLabel,{fontSize:getArrowLabelFontSize(shape),font:shape.props.font,align:"middle",verticalAlign:"middle",text:shape.props.text,labelColor:theme[shape.props.labelColor].solid,bounds:getArrowLabelPosition(this.editor,shape).box.clone().expandBy(-4.25*shape.props.scale),padding:0})]})}getCanvasSvgDefs(){return[getFillDefForCanvas(),{key:"arrow:dot",component:ArrowheadDotDef},{key:"arrow:cross",component:ArrowheadCrossDef}]}getInterpolatedProps(startShape,endShape,progress){return{...progress>.5?endShape.props:startShape.props,scale:(0,dist_esm.CcK)(startShape.props.scale,endShape.props.scale,progress),start:{x:(0,dist_esm.CcK)(startShape.props.start.x,endShape.props.start.x,progress),y:(0,dist_esm.CcK)(startShape.props.start.y,endShape.props.start.y,progress)},end:{x:(0,dist_esm.CcK)(startShape.props.end.x,endShape.props.end.x,progress),y:(0,dist_esm.CcK)(startShape.props.end.y,endShape.props.end.y,progress)},bend:(0,dist_esm.CcK)(startShape.props.bend,endShape.props.bend,progress),labelPosition:(0,dist_esm.CcK)(startShape.props.labelPosition,endShape.props.labelPosition,progress)}}}const ArrowSvg=(0,dist_esm.u4I)((function ArrowSvg2({shape,shouldDisplayHandles}){const editor=(0,dist_esm.hGv)(),theme=useDefaultColorTheme(),info=shared_getArrowInfo(editor,shape),isForceSolid=(0,dist_esm.hau)("force solid",(()=>editor.getZoomLevel()<.2),[editor]),clipPathId=(0,dist_esm.Xhk)(shape.id+"_clip"),arrowheadDotId=(0,dist_esm.Xhk)("arrowhead-dot"),arrowheadCrossId=(0,dist_esm.Xhk)("arrowhead-cross"),isEditing=(0,dist_esm._As)(shape.id),geometry=editor.getShapeGeometry(shape);if(!geometry)return null;const bounds=dist_esm.azJ.ZeroFix(geometry.bounds),bindings=shared_getArrowBindings(editor,shape);if(!info?.isValid)return null;const strokeWidth=default_shape_constants_STROKE_SIZES[shape.props.size]*shape.props.scale,as=info.start.arrowhead&&getArrowheadPathForType(info,"start",strokeWidth),ae=info.end.arrowhead&&getArrowheadPathForType(info,"end",strokeWidth);let handlePath=null;shouldDisplayHandles&&(bindings.start||bindings.end)&&(handlePath=getArrowHandlePath(info,{style:"dashed",start:"skip",end:"skip",lengthRatio:2.5,strokeWidth:2/editor.getZoomLevel(),props:{className:"tl-arrow-hint",markerStart:bindings.start?bindings.start.props.isExact?"":bindings.start.props.isPrecise?`url(#${arrowheadCrossId})`:`url(#${arrowheadDotId})`:"",markerEnd:bindings.end?bindings.end.props.isExact?"":bindings.end.props.isPrecise?`url(#${arrowheadCrossId})`:`url(#${arrowheadDotId})`:"",opacity:.16}}));const labelPosition=getArrowLabelPosition(editor,shape),clipStartArrowhead=!("none"===info.start.arrowhead||"arrow"===info.start.arrowhead),clipEndArrowhead=!("none"===info.end.arrowhead||"arrow"===info.end.arrowhead);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("defs",{children:(0,jsx_runtime.jsx)("clipPath",{id:clipPathId,children:(0,jsx_runtime.jsx)(ArrowClipPath,{radius:3.5*shape.props.scale,hasText:isEditing||shape.props.text.trim().length>0,bounds,labelBounds:labelPosition.box,as:clipStartArrowhead&&as?as:"",ae:clipEndArrowhead&&ae?ae:""})})}),(0,jsx_runtime.jsxs)("g",{fill:"none",stroke:theme[shape.props.color].solid,strokeWidth,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[handlePath,(0,jsx_runtime.jsxs)("g",{style:{clipPath:`url(#${clipPathId})`,WebkitClipPath:`url(#${clipPathId})`},children:[(0,jsx_runtime.jsx)("rect",{x:(0,dist_esm.WMC)(bounds.minX-100),y:(0,dist_esm.WMC)(bounds.minY-100),width:(0,dist_esm.WMC)(bounds.width+200),height:(0,dist_esm.WMC)(bounds.height+200),opacity:0}),getArrowBodyPath(0,info,{style:shape.props.dash,strokeWidth,forceSolid:isForceSolid,randomSeed:shape.id})]}),as&&clipStartArrowhead&&"none"!==shape.props.fill&&(0,jsx_runtime.jsx)(ShapeFill,{theme,d:as,color:shape.props.color,fill:shape.props.fill,scale:shape.props.scale}),ae&&clipEndArrowhead&&"none"!==shape.props.fill&&(0,jsx_runtime.jsx)(ShapeFill,{theme,d:ae,color:shape.props.color,fill:shape.props.fill,scale:shape.props.scale}),as&&(0,jsx_runtime.jsx)("path",{d:as}),ae&&(0,jsx_runtime.jsx)("path",{d:ae})]})]})}));function ArrowClipPath({radius,hasText,bounds,labelBounds,as,ae}){const path=(0,react.useMemo)((()=>{const path2=new PathBuilder;return path2.moveTo(bounds.left-100,bounds.top-100).lineTo(bounds.right+100,bounds.top-100).lineTo(bounds.right+100,bounds.bottom+100).lineTo(bounds.left-100,bounds.bottom+100).close(),hasText&&path2.moveTo(labelBounds.left,labelBounds.top+radius).lineTo(labelBounds.left,labelBounds.bottom-radius).arcTo(radius,!1,!1,labelBounds.left+radius,labelBounds.bottom).lineTo(labelBounds.right-radius,labelBounds.bottom).arcTo(radius,!1,!1,labelBounds.right,labelBounds.bottom-radius).lineTo(labelBounds.right,labelBounds.top+radius).arcTo(radius,!1,!1,labelBounds.right-radius,labelBounds.top).lineTo(labelBounds.left+radius,labelBounds.top).arcTo(radius,!1,!1,labelBounds.left,labelBounds.top+radius).close(),path2.toD()}),[radius,hasText,bounds.bottom,bounds.left,bounds.right,bounds.top,labelBounds.bottom,labelBounds.left,labelBounds.right,labelBounds.top]);return(0,jsx_runtime.jsx)("path",{d:`${path}${as}${ae}`})}const shapeAtTranslationStart=new WeakMap;function ArrowheadDotDef(){const id=(0,dist_esm.Xhk)("arrowhead-dot");return(0,jsx_runtime.jsx)("marker",{id,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:(0,jsx_runtime.jsx)("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function ArrowheadCrossDef(){const id=(0,dist_esm.Xhk)("arrowhead-cross");return(0,jsx_runtime.jsxs)("marker",{id,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[(0,jsx_runtime.jsx)("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),(0,jsx_runtime.jsx)("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}function anglesAreApproximatelyParallel(a,b,tolerance=1e-4){const diff=Math.abs(a-b),isParallel=diff<tolerance,isFlippedParallel=Math.abs(diff-Math.PI)<tolerance,is360Parallel=Math.abs(diff-dist_esm.uAR)<tolerance;return{isParallel:isParallel||is360Parallel,isFlippedParallel}}const LINK_ICON="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function HyperlinkButton({url}){const editor=(0,dist_esm.hGv)(),hideButton=(0,dist_esm.hau)("zoomLevel",(()=>editor.getZoomLevel()<.32),[editor]);return(0,jsx_runtime.jsx)("a",{className:classnames_default()("tl-hyperlink-button",{"tl-hyperlink-button__hidden":hideButton}),href:url,target:"_blank",rel:"noopener noreferrer",onPointerDown:dist_esm.$6n,onPointerUp:dist_esm.$6n,title:url,draggable:!1,children:(0,jsx_runtime.jsx)("div",{className:"tl-hyperlink__icon",style:{mask:`url("${LINK_ICON}") center 100% / 100% no-repeat`,WebkitMask:`url("${LINK_ICON}") center 100% / 100% no-repeat`}})})}const icons_editor_LINK_ICON="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",ROTATING_BOX_SHADOWS=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function getRotatedBoxShadow(rotation){return ROTATING_BOX_SHADOWS.map((shadow=>{const{offsetX,offsetY,blur,spread,color}=shadow,vec=new dist_esm.l2P(offsetX,offsetY),{x,y}=vec.rot(-rotation);return`${x}px ${y}px ${blur}px ${spread}px ${color}`})).join(", ")}class BookmarkShapeUtil extends dist_esm.A8{static type="bookmark";static props=dist_esm.aWX;static migrations=dist_esm.hNn;canResize(){return!1}hideSelectionBoundsFg(){return!0}getText(shape){return shape.props.url}getAriaDescriptor(shape){const asset=shape.props.assetId?this.editor.getAsset(shape.props.assetId):null;if(asset?.props.title)return convertCommonTitleHTMLEntities(asset.props.title)+(asset.props.description?", "+asset.props.description:"")}getDefaultProps(){return{url:"",w:300,h:320,assetId:null}}component(shape){return(0,jsx_runtime.jsx)(BookmarkShapeComponent,{shape,util:this})}indicator(shape){return(0,jsx_runtime.jsx)("rect",{width:(0,dist_esm.WMC)(shape.props.w),height:(0,dist_esm.WMC)(shape.props.h),rx:"6",ry:"6"})}onBeforeCreate(next){return getBookmarkSize(this.editor,next)}onBeforeUpdate(prev,shape){if(prev.props.url!==shape.props.url){if(!dist_esm.T.linkUrl.isValid(shape.props.url))return{...shape,props:{...shape.props,url:prev.props.url}};!function updateBookmarkAssetOnUrlChange(editor,shape){const{url}=shape.props,assetId=dist_esm.Kx3.createId((0,dist_esm.xpx)(url));editor.getAsset(assetId)?shape.props.assetId!==assetId&&editor.updateShapes([{id:shape.id,type:shape.type,props:{assetId}}]):(editor.updateShapes([{id:shape.id,type:shape.type,props:{assetId:null}}]),createBookmarkAssetOnUrlChange(editor,shape))}(this.editor,shape)}if(prev.props.assetId!==shape.props.assetId)return getBookmarkSize(this.editor,shape)}getInterpolatedProps(startShape,endShape,t){return{...t>.5?endShape.props:startShape.props,w:(0,dist_esm.CcK)(startShape.props.w,endShape.props.w,t),h:(0,dist_esm.CcK)(startShape.props.h,endShape.props.h,t)}}}function BookmarkShapeComponent({shape,util}){const asset=shape.props.assetId?util.editor.getAsset(shape.props.assetId):null,isSafariExport=!!(0,dist_esm.Jf5)()&&dist_esm.YZA.isSafari,pageRotation=util.editor.getShapePageTransform(shape).rotation(),address=getHumanReadableAddress(shape),[isFaviconValid,setIsFaviconValid]=(0,react.useState)(!0);return(0,jsx_runtime.jsx)(dist_esm.hDc,{children:(0,jsx_runtime.jsxs)("div",{className:classnames_default()("tl-bookmark__container",isSafariExport&&"tl-bookmark__container--safariExport"),style:{boxShadow:isSafariExport?void 0:getRotatedBoxShadow(pageRotation),maxHeight:shape.props.h},children:[(!asset||asset.props.image)&&(0,jsx_runtime.jsxs)("div",{className:"tl-bookmark__image_container",children:[asset?(0,jsx_runtime.jsx)("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:asset?.props.image,alt:asset?.props.title||""}):(0,jsx_runtime.jsx)("div",{className:"tl-bookmark__placeholder"}),asset?.props.image&&(0,jsx_runtime.jsx)(HyperlinkButton,{url:shape.props.url})]}),(0,jsx_runtime.jsxs)("div",{className:"tl-bookmark__copy_container",children:[asset?.props.title?(0,jsx_runtime.jsx)("h2",{className:"tl-bookmark__heading",children:convertCommonTitleHTMLEntities(asset.props.title)}):null,asset?.props.description&&asset?.props.image?(0,jsx_runtime.jsx)("p",{className:"tl-bookmark__description",children:asset.props.description}):null,(0,jsx_runtime.jsxs)("a",{className:"tl-bookmark__link",href:shape.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:dist_esm.$6n,onPointerUp:dist_esm.$6n,onClick:dist_esm.$6n,children:[isFaviconValid&&asset?.props.favicon?(0,jsx_runtime.jsx)("img",{className:"tl-bookmark__favicon",src:asset?.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",onError:()=>setIsFaviconValid(!1),alt:`favicon of ${address}`}):(0,jsx_runtime.jsx)("div",{className:"tl-hyperlink__icon",style:{mask:`url("${icons_editor_LINK_ICON}") center 100% / 100% no-repeat`,WebkitMask:`url("${icons_editor_LINK_ICON}") center 100% / 100% no-repeat`}}),(0,jsx_runtime.jsx)("span",{children:address})]})]})]})})}function getBookmarkSize(editor,shape){const asset=shape.props.assetId?editor.getAsset(shape.props.assetId):null;let h=320;return asset&&(asset.props.image||(h=asset.props.title?101:46)),{...shape,props:{...shape.props,h}}}const getHumanReadableAddress=shape=>{try{return new URL(shape.props.url).hostname.replace(/^www\./,"")}catch{return shape.props.url}};const createBookmarkAssetOnUrlChange=(0,dist_esm.sg1)((async(editor,shape)=>{if(editor.isDisposed)return;const{url}=shape.props,asset=await editor.getAssetForExternalContent({type:"url",url});asset&&editor.run((()=>{editor.createAssets([asset]),editor.updateShapes([{id:shape.id,type:shape.type,props:{assetId:asset.id}}])}))}),500);function getSvgPathFromStrokePoints(points,closed=!1){const len=points.length;if(len<2)return"";let a=points[0].point,b=points[1].point;if(2===len)return`M${(0,dist_esm.ulI)(a)}L${(0,dist_esm.ulI)(b)}`;let result="";for(let i=2,max=len-1;i<max;i++)a=points[i].point,b=points[i+1].point,result+=(0,dist_esm.G86)(a,b);return closed?`M${(0,dist_esm.G86)(points[0].point,points[1].point)}Q${(0,dist_esm.ulI)(points[1].point)}${(0,dist_esm.G86)(points[1].point,points[2].point)}T${result}${(0,dist_esm.G86)(points[len-1].point,points[0].point)}${(0,dist_esm.G86)(points[0].point,points[1].point)}Z`:`M${(0,dist_esm.ulI)(points[0].point)}Q${(0,dist_esm.ulI)(points[1].point)}${(0,dist_esm.G86)(points[1].point,points[2].point)}${points.length>3?"T":""}${result}L${(0,dist_esm.ulI)(points[len-1].point)}`}function svgInk(rawInputPoints,options={}){const{start={},end={}}=options,{cap:capStart=!0}=start,{cap:capEnd=!0}=end;(0,dist_esm.vAR)(!start.taper&&!end.taper,"cap taper not supported here"),(0,dist_esm.vAR)(!start.easing&&!end.easing,"cap easing not supported here"),(0,dist_esm.vAR)(capStart&&capEnd,"cap must be true");const points=getStrokePoints(rawInputPoints,options);setStrokePointRadii(points,options);const partitions=function partitionAtElbows(points){if(points.length<=2)return[points];const result=[];let nextV,dpr,prevPoint,thisPoint,nextPoint,currentPartition=[points[0]],prevV=dist_esm.l2P.Sub(points[1].point,points[0].point).uni();for(let i=1,n=points.length;i<n-1;i++)if(prevPoint=points[i-1],thisPoint=points[i],nextPoint=points[i+1],nextV=dist_esm.l2P.Sub(nextPoint.point,thisPoint.point).uni(),dpr=dist_esm.l2P.Dpr(prevV,nextV),prevV=nextV,dpr<-.8){const elbowPoint={...thisPoint,point:thisPoint.input};currentPartition.push(elbowPoint),result.push(cleanUpPartition(currentPartition)),currentPartition=[elbowPoint]}else currentPartition.push(thisPoint),dpr>.7||(dist_esm.l2P.Dist2(prevPoint.point,thisPoint.point)+dist_esm.l2P.Dist2(thisPoint.point,nextPoint.point))/((prevPoint.radius+thisPoint.radius+nextPoint.radius)/3)**2<1.5&&(currentPartition.push(thisPoint),result.push(cleanUpPartition(currentPartition)),currentPartition=[thisPoint]);return currentPartition.push(points[points.length-1]),result.push(cleanUpPartition(currentPartition)),result}(points);let svg="";for(const partition of partitions)svg+=renderPartition(partition,options);return svg}function cleanUpPartition(partition){const startPoint=partition[0];let nextPoint;for(;partition.length>2&&(nextPoint=partition[1],dist_esm.l2P.Dist2(startPoint.point,nextPoint.point)<((startPoint.radius+nextPoint.radius)/2*.5)**2);)partition.splice(1,1);const endPoint=partition[partition.length-1];let prevPoint;for(;partition.length>2&&(prevPoint=partition[partition.length-2],dist_esm.l2P.Dist2(endPoint.point,prevPoint.point)<((endPoint.radius+prevPoint.radius)/2*.5)**2);)partition.splice(partition.length-2,1);return partition.length>1&&(partition[0]={...partition[0],vector:dist_esm.l2P.Sub(partition[0].point,partition[1].point).uni()},partition[partition.length-1]={...partition[partition.length-1],vector:dist_esm.l2P.Sub(partition[partition.length-2].point,partition[partition.length-1].point).uni()}),partition}function renderPartition(strokePoints,options={}){if(0===strokePoints.length)return"";if(1===strokePoints.length)return function circlePath(cx,cy,r){return"M "+cx+" "+cy+" m -"+r+", 0 a "+r+","+r+" 0 1,1 "+2*r+",0 a "+r+","+r+" 0 1,1 -"+2*r+",0"}(strokePoints[0].point.x,strokePoints[0].point.y,strokePoints[0].radius);const{left,right}=getStrokeOutlineTracks(strokePoints,options);right.reverse();let svg=`M${(0,dist_esm.ulI)(left[0])}T`;for(let i=1;i<left.length;i++)svg+=(0,dist_esm.G86)(left[i-1],left[i]);{const point=strokePoints[strokePoints.length-1],radius=point.radius,direction=point.vector.clone().per().neg(),arcStart=dist_esm.l2P.Add(point.point,dist_esm.l2P.Mul(direction,radius)),arcEnd=dist_esm.l2P.Add(point.point,dist_esm.l2P.Mul(direction,-radius));svg+=`${(0,dist_esm.ulI)(arcStart)}A${(0,dist_esm.WMC)(radius)},${(0,dist_esm.WMC)(radius)} 0 0 1 ${(0,dist_esm.ulI)(arcEnd)}T`}for(let i=1;i<right.length;i++)svg+=(0,dist_esm.G86)(right[i-1],right[i]);{const point=strokePoints[0],radius=point.radius,direction=point.vector.clone().per(),arcStart=dist_esm.l2P.Add(point.point,dist_esm.l2P.Mul(direction,radius)),arcEnd=dist_esm.l2P.Add(point.point,dist_esm.l2P.Mul(direction,-radius));svg+=`${(0,dist_esm.ulI)(arcStart)}A${(0,dist_esm.WMC)(radius)},${(0,dist_esm.WMC)(radius)} 0 0 1 ${(0,dist_esm.ulI)(arcEnd)}Z`}return svg}const interpolateSegments=(startSegments,endSegments,progress)=>{const startPoints=[],endPoints=[];startSegments.forEach((segment=>startPoints.push(...segment.points))),endSegments.forEach((segment=>endPoints.push(...segment.points)));const maxLength=Math.max(startPoints.length,endPoints.length),pointsToUseStart=[],pointsToUseEnd=[];for(let i=0;i<maxLength;i++)pointsToUseStart.push(startPoints[i]||startPoints[startPoints.length-1]),pointsToUseEnd.push(endPoints[i]||endPoints[endPoints.length-1]);return[{type:"free",points:pointsToUseStart.map(((point,k)=>{let z=.5;return void 0!==pointsToUseEnd[k].z&&void 0!==point.z&&(z=(0,dist_esm.CcK)(point.z,pointsToUseEnd[k].z,progress)),{x:(0,dist_esm.CcK)(point.x,pointsToUseEnd[k].x,progress),y:(0,dist_esm.CcK)(point.y,pointsToUseEnd[k].y,progress),z}}))}]},PEN_EASING=t=>.65*t+.35*(0,dist_esm.dwc)(t*dist_esm.PI/2),simulatePressureSettings=strokeWidth=>({size:strokeWidth,thinning:.5,streamline:(0,dist_esm.wwY)(strokeWidth,[9,16],[.64,.74],!0),smoothing:.62,easing:dist_esm.Z4H.easeOutSine,simulatePressure:!0}),realPressureSettings=strokeWidth=>({size:1+1.2*strokeWidth,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:PEN_EASING}),solidSettings=strokeWidth=>({size:strokeWidth,thinning:0,streamline:(0,dist_esm.wwY)(strokeWidth,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:dist_esm.Z4H.linear}),solidRealPressureSettings=strokeWidth=>({size:strokeWidth,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:dist_esm.Z4H.linear});function getHighlightFreehandSettings({strokeWidth,showAsComplete}){return{size:1+strokeWidth,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:dist_esm.Z4H.easeOutSine,last:showAsComplete}}function getFreehandOptions(shapeProps,strokeWidth,forceComplete,forceSolid){const last=shapeProps.isComplete||forceComplete;return forceSolid?shapeProps.isPen?{...solidRealPressureSettings(strokeWidth),last}:{...solidSettings(strokeWidth),last}:"draw"===shapeProps.dash?shapeProps.isPen?{...realPressureSettings(strokeWidth),last}:{...simulatePressureSettings(strokeWidth),last}:{...solidSettings(strokeWidth),last}}function getPointsFromSegments(segments){const points=[];for(const segment of segments)if("free"===segment.type||segment.points.length<2)points.push(...segment.points.map(dist_esm.l2P.Cast));else{const pointsToInterpolate=Math.max(4,Math.floor(dist_esm.l2P.Dist(segment.points[0],segment.points[1])/16));points.push(...dist_esm.l2P.PointsBetween(segment.points[0],segment.points[1],pointsToInterpolate))}return points}function getDrawShapeStrokeDashArray(shape,strokeWidth,dotAdjustment){return{draw:"none",solid:"none",dotted:`${dotAdjustment} ${2*strokeWidth}`,dashed:`${2*strokeWidth} ${2*strokeWidth}`}[shape.props.dash]}class DrawShapeUtil extends dist_esm.inY{static type="draw";static props=dist_esm.KBL;static migrations=dist_esm.deR;options={maxPointsPerShape:600};canTabTo(){return!1}hideResizeHandles(shape){return getIsDot(shape)}hideRotateHandle(shape){return getIsDot(shape)}hideSelectionBoundsFg(shape){return getIsDot(shape)}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(shape){const points=getPointsFromSegments(shape.props.segments),sw=(default_shape_constants_STROKE_SIZES[shape.props.size]+1)*shape.props.scale;if(1===shape.props.segments.length){const box=dist_esm.azJ.FromPoints(points);if(box.width<2*sw&&box.height<2*sw)return new dist_esm.PUi({x:-sw,y:-sw,radius:sw,isFilled:!0})}const strokePoints=getStrokePoints(points,getFreehandOptions(shape.props,sw,shape.props.isPen,!0)).map((p=>p.point));return shape.props.isClosed?new dist_esm.dxv({points:strokePoints,isFilled:"none"!==shape.props.fill}):new dist_esm.Hes({points:strokePoints})}component(shape){return(0,jsx_runtime.jsx)(dist_esm.ULM,{children:(0,jsx_runtime.jsx)(DrawShapeSvg,{shape})})}indicator(shape){const allPointsFromSegments=getPointsFromSegments(shape.props.segments);let sw=(default_shape_constants_STROKE_SIZES[shape.props.size]+1)*shape.props.scale;(0,dist_esm.hau)("force solid",(()=>{const zoomLevel=this.editor.getZoomLevel();return zoomLevel<.5&&zoomLevel<1.5/sw}),[this.editor,sw])||shape.props.isPen||"draw"!==shape.props.dash||1!==allPointsFromSegments.length||(sw+=(0,dist_esm.She)(shape.id)()*(sw/6));const showAsComplete=shape.props.isComplete||"straight"===(0,dist_esm.HVh)(shape.props.segments)?.type,strokePoints=getStrokePoints(allPointsFromSegments,getFreehandOptions(shape.props,sw,showAsComplete,!0)),solidStrokePath=strokePoints.length>1?getSvgPathFromStrokePoints(strokePoints,shape.props.isClosed):getDot(allPointsFromSegments[0],sw);return(0,jsx_runtime.jsx)("path",{d:solidStrokePath})}toSvg(shape,ctx){ctx.addExportDef(getFillDefForExport(shape.props.fill));const scaleFactor=1/shape.props.scale;return(0,jsx_runtime.jsx)("g",{transform:`scale(${scaleFactor})`,children:(0,jsx_runtime.jsx)(DrawShapeSvg,{shape,zoomOverride:1})})}getCanvasSvgDefs(){return[getFillDefForCanvas()]}onResize(shape,info){const{scaleX,scaleY}=info,newSegments=[];for(const segment of shape.props.segments)newSegments.push({...segment,points:segment.points.map((({x,y,z})=>({x:(0,dist_esm.Mg8)(scaleX*x),y:(0,dist_esm.Mg8)(scaleY*y),z})))});return{props:{segments:newSegments}}}expandSelectionOutlinePx(shape){const multiplier="draw"===shape.props.dash?1.6:1;return default_shape_constants_STROKE_SIZES[shape.props.size]*multiplier/2*shape.props.scale}getInterpolatedProps(startShape,endShape,t){return{...t>.5?endShape.props:startShape.props,segments:interpolateSegments(startShape.props.segments,endShape.props.segments,t),scale:(0,dist_esm.CcK)(startShape.props.scale,endShape.props.scale,t)}}}function getDot(point,sw){const r=.5*(sw+1);return`M ${point.x} ${point.y} m -${r}, 0 a ${r},${r} 0 1,0 ${2*r},0 a ${r},${r} 0 1,0 -${2*r},0`}function getIsDot(shape){return 1===shape.props.segments.length&&shape.props.segments[0].points.length<2}function DrawShapeSvg({shape,zoomOverride}){const theme=useDefaultColorTheme(),editor=(0,dist_esm.hGv)(),allPointsFromSegments=getPointsFromSegments(shape.props.segments),showAsComplete=shape.props.isComplete||"straight"===(0,dist_esm.HVh)(shape.props.segments)?.type;let sw=(default_shape_constants_STROKE_SIZES[shape.props.size]+1)*shape.props.scale;const forceSolid=(0,dist_esm.hau)("force solid",(()=>{const zoomLevel=zoomOverride??editor.getZoomLevel();return zoomLevel<.5&&zoomLevel<1.5/sw}),[editor,sw,zoomOverride]),dotAdjustment=(0,dist_esm.hau)("dot adjustment",(()=>(zoomOverride??editor.getZoomLevel())<.2?0:.1),[editor,zoomOverride]);forceSolid||shape.props.isPen||"draw"!==shape.props.dash||1!==allPointsFromSegments.length||(sw+=(0,dist_esm.She)(shape.id)()*(sw/6));const options=getFreehandOptions(shape.props,sw,showAsComplete,forceSolid);if(!forceSolid&&"draw"===shape.props.dash)return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[shape.props.isClosed&&shape.props.fill&&allPointsFromSegments.length>1?(0,jsx_runtime.jsx)(ShapeFill,{d:getSvgPathFromStrokePoints(getStrokePoints(allPointsFromSegments,options),shape.props.isClosed),theme,color:shape.props.color,fill:shape.props.isClosed?shape.props.fill:"none",scale:shape.props.scale}):null,(0,jsx_runtime.jsx)("path",{d:svgInk(allPointsFromSegments,options),strokeLinecap:"round",fill:theme[shape.props.color].solid})]});const strokePoints=getStrokePoints(allPointsFromSegments,options),isDot=strokePoints.length<2,solidStrokePath=isDot?getDot(allPointsFromSegments[0],0):getSvgPathFromStrokePoints(strokePoints,shape.props.isClosed);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ShapeFill,{d:solidStrokePath,theme,color:shape.props.color,fill:isDot||shape.props.isClosed?shape.props.fill:"none",scale:shape.props.scale}),(0,jsx_runtime.jsx)("path",{d:solidStrokePath,strokeLinecap:"round",fill:isDot?theme[shape.props.color].solid:"none",stroke:theme[shape.props.color].solid,strokeWidth:sw,strokeDasharray:isDot?"none":getDrawShapeStrokeDashArray(shape,sw,dotAdjustment),strokeDashoffset:"0"})]})}const globlikeRegExp=input=>input.split("*").map((str=>function escapeStringRegexp(string){if("string"!=typeof string)throw new TypeError("Expected a string");return string.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}(str))).join(".+"),checkHostnames=(hostnames,targetHostname)=>!!hostnames.find((hostname=>{const re=new RegExp(globlikeRegExp(hostname));return targetHostname.match(re)}));function getEmbedInfo(definitions,inputUrl){try{return function matchUrl(definitions,url){const parsed=(0,dist_esm.yCG)(url);if(!parsed)return;const host=parsed.host.replace("www.","");for(const localEmbedDef of definitions)if(checkHostnames(localEmbedDef.hostnames,host)){const embedUrl=localEmbedDef.toEmbedUrl(url);if(embedUrl)return{definition:localEmbedDef,embedUrl,url}}}(definitions,inputUrl)??function matchEmbedUrl(definitions,url){const parsed=(0,dist_esm.yCG)(url);if(!parsed)return;const host=parsed.host.replace("www.","");for(const localEmbedDef of definitions)if(checkHostnames(localEmbedDef.hostnames,host)){const originalUrl=localEmbedDef.fromEmbedUrl(url);if(originalUrl)return{definition:localEmbedDef,url:originalUrl,embedUrl:url}}}(definitions,inputUrl)}catch{return}}class EmbedShapeUtil extends dist_esm.A8{static type="embed";static props=dist_esm.Pwo;static migrations=dist_esm.upp;static embedDefinitions=DEFAULT_EMBED_DEFINITIONS;static setEmbedDefinitions(embedDefinitions){EmbedShapeUtil.embedDefinitions=embedDefinitions}getEmbedDefinitions(){return EmbedShapeUtil.embedDefinitions}getEmbedDefinition(url){return getEmbedInfo(EmbedShapeUtil.embedDefinitions,url)}getText(shape){return shape.props.url}getAriaDescriptor(shape){const embedInfo=this.getEmbedDefinition(shape.props.url);return embedInfo?.definition.title}hideSelectionBoundsFg(shape){return!this.canResize(shape)}canEdit(){return!0}canResize(shape){return!!this.getEmbedDefinition(shape.props.url)?.definition?.doesResize}canEditInReadonly(){return!0}getDefaultProps(){return{w:300,h:300,url:""}}isAspectRatioLocked(shape){const embedInfo=this.getEmbedDefinition(shape.props.url);return embedInfo?.definition.isAspectRatioLocked??!1}onResize(shape,info){const isAspectRatioLocked=this.isAspectRatioLocked(shape),embedInfo=this.getEmbedDefinition(shape.props.url);let minWidth=embedInfo?.definition.minWidth??200,minHeight=embedInfo?.definition.minHeight??200;if(isAspectRatioLocked){const aspectRatio=shape.props.w/shape.props.h;aspectRatio>1?minWidth*=aspectRatio:minHeight/=aspectRatio}return(0,dist_esm.mfH)(shape,info,{minWidth,minHeight})}component(shape){const svgExport=(0,dist_esm.Jf5)(),{w,h,url}=shape.props,isEditing=(0,dist_esm._As)(shape.id),embedInfo=this.getEmbedDefinition(url),isHoveringWhileEditingSameShape=(0,dist_esm.hau)("is hovering",(()=>{const{editingShapeId,hoveredShapeId}=this.editor.getCurrentPageState();if(editingShapeId&&hoveredShapeId!==editingShapeId){const editingShape=this.editor.getShape(editingShapeId);if(editingShape&&this.editor.isShapeOfType(editingShape,"embed"))return!0}return!1}),[]),pageRotation=this.editor.getShapePageTransform(shape).rotation();if(svgExport)return(0,jsx_runtime.jsx)(dist_esm.hDc,{className:"tl-embed-container",id:shape.id,children:(0,jsx_runtime.jsx)("div",{className:"tl-embed",style:{border:0,boxShadow:getRotatedBoxShadow(pageRotation),borderRadius:embedInfo?.definition.overrideOutlineRadius??8,background:embedInfo?.definition.backgroundColor??"var(--color-background)",width:w,height:h}})});const isInteractive=isEditing||isHoveringWhileEditingSameShape;if("undefined"!=typeof window&&(window!==window.top||window.self!==window.parent)&&"tldraw"===embedInfo?.definition.type)return null;if("github_gist"===embedInfo?.definition.type){const idFromGistUrl=embedInfo.url.split("/").pop();if(!idFromGistUrl)throw Error("No gist id!");return(0,jsx_runtime.jsx)(dist_esm.hDc,{className:"tl-embed-container",id:shape.id,children:(0,jsx_runtime.jsx)(Gist,{id:idFromGistUrl,width:(0,dist_esm.WMC)(w),height:(0,dist_esm.WMC)(h),isInteractive,pageRotation})})}const sandbox=(permissions={...embedShapePermissionDefaults,...embedInfo?.definition.overridePermissions??{}},Object.entries(permissions).filter((([_perm,isEnabled])=>isEnabled)).map((([perm])=>perm)).join(" "));var permissions;return(0,jsx_runtime.jsx)(dist_esm.hDc,{className:"tl-embed-container",id:shape.id,children:embedInfo?.definition?(0,jsx_runtime.jsx)("iframe",{className:"tl-embed",sandbox,src:embedInfo.embedUrl,width:(0,dist_esm.WMC)(w),height:(0,dist_esm.WMC)(h),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",tabIndex:isEditing?0:-1,style:{border:0,pointerEvents:isInteractive?"auto":"none",zIndex:isInteractive?"":"-1",boxShadow:getRotatedBoxShadow(pageRotation),borderRadius:embedInfo?.definition.overrideOutlineRadius??8,background:embedInfo?.definition.backgroundColor}}):null})}indicator(shape){const embedInfo=this.getEmbedDefinition(shape.props.url);return(0,jsx_runtime.jsx)("rect",{width:(0,dist_esm.WMC)(shape.props.w),height:(0,dist_esm.WMC)(shape.props.h),rx:embedInfo?.definition.overrideOutlineRadius??8,ry:embedInfo?.definition.overrideOutlineRadius??8})}getInterpolatedProps(startShape,endShape,t){return{...t>.5?endShape.props:startShape.props,w:(0,dist_esm.CcK)(startShape.props.w,endShape.props.w,t),h:(0,dist_esm.CcK)(startShape.props.h,endShape.props.h,t)}}}function Gist({id,isInteractive,width,height,style,pageRotation}){if(!id.match(/^[0-9a-f]+$/))throw Error("No gist id!");return(0,jsx_runtime.jsx)("iframe",{className:"tl-embed",draggable:!1,width:(0,dist_esm.WMC)(width),height:(0,dist_esm.WMC)(height),frameBorder:"0",scrolling:"no",referrerPolicy:"no-referrer-when-downgrade",tabIndex:isInteractive?0:-1,style:{...style,pointerEvents:isInteractive?"all":"none",zIndex:isInteractive?"":"-1",boxShadow:getRotatedBoxShadow(pageRotation)},srcDoc:`\n\t\t\t<html>\n\t\t\t\t<head>\n\t\t\t\t\t<base target="_blank">\n\t\t\t\t</head>\n\t\t\t\t<body>\n\t\t\t\t\t<script src=https://gist.github.com/${id}.js><\/script>\n\t\t\t\t\t<style type="text/css">\n\t\t\t\t\t\t* { margin: 0px; }\n\t\t\t\t\t\ttable { height: 100%; background-color: red; }\n\t\t\t\t\t\t.gist { background-color: none; height: 100%;  }\n\t\t\t\t\t\t.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }\n\t\t\t\t\t</style>\n\t\t\t\t</body>\n\t\t\t</html>`})}function getFrameHeadingSide(editor,shape){const scaledRotation=(((0,dist_esm.rgm)(editor.getShapePageTransform(shape.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4;return Math.floor(scaledRotation)}const measurementWeakmap=new WeakMap;function getFrameHeadingSize(editor,shape,opts){let width=measurementWeakmap.get(shape.props);if(!width){const frameTitle=defaultEmptyAs(shape.props.name,"Frame")+String.fromCharCode(8203),spans=editor.textMeasure.measureTextSpans(frameTitle,opts),firstSpan=spans[0],lastSpan=(0,dist_esm.HVh)(spans);width=lastSpan.box.w+lastSpan.box.x-firstSpan.box.x,measurementWeakmap.set(shape.props,width)}return new dist_esm.azJ(0,-opts.height,width,opts.height)}function getFrameHeadingOpts(width,isSvg){return{fontSize:12,fontFamily:isSvg?"Arial":"Inter, sans-serif",textAlign:"start",width,height:24,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle",offsetY:-34,offsetX:0}}function getFrameHeadingTranslation(shape,side,isSvg){const u=isSvg?"":"px",r=isSvg?"":"deg";let labelTranslate;switch(side){case 0:labelTranslate="";break;case 3:labelTranslate=`translate(${(0,dist_esm.WMC)(shape.props.w)}${u}, 0${u}) rotate(90${r})`;break;case 2:labelTranslate=`translate(${(0,dist_esm.WMC)(shape.props.w)}${u}, ${(0,dist_esm.WMC)(shape.props.h)}${u}) rotate(180${r})`;break;case 1:labelTranslate=`translate(0${u}, ${(0,dist_esm.WMC)(shape.props.h)}${u}) rotate(270${r})`;break;default:throw Error("labelSide out of bounds")}return labelTranslate}const FrameLabelInput=(0,react.forwardRef)((({id,name,isEditing},ref)=>{const editor=(0,dist_esm.hGv)(),handleKeyDown=(0,react.useCallback)((e=>{"Enter"!==e.key||e.nativeEvent.isComposing||((0,dist_esm.$6n)(e),e.currentTarget.blur(),editor.setEditingShape(null))}),[editor]),handleBlur=(0,react.useCallback)((e=>{const shape=editor.getShape(id);if(!shape)return;const name2=shape.props.name,value=e.currentTarget.value.trim();name2!==value&&editor.updateShapes([{id,type:"frame",props:{name:value}}])}),[id,editor]),handleChange=(0,react.useCallback)((e=>{const shape=editor.getShape(id);if(!shape)return;const name2=shape.props.name,value=e.currentTarget.value;name2!==value&&editor.updateShapes([{id,type:"frame",props:{name:value}}])}),[id,editor]);return(0,jsx_runtime.jsxs)("div",{className:"tl-frame-label "+(isEditing?"tl-frame-label__editing":""),children:[(0,jsx_runtime.jsx)("input",{className:"tl-frame-name-input",ref,disabled:!isEditing,readOnly:!isEditing,style:{display:isEditing?void 0:"none"},value:name,autoFocus:!0,onKeyDown:handleKeyDown,onBlur:handleBlur,onChange:handleChange,onPointerDown:isEditing?dist_esm.$6n:void 0,draggable:!1}),defaultEmptyAs(name,"Frame")+String.fromCharCode(8203)]})})),FrameHeading=(0,react.memo)((function FrameHeading2({id,name,width,height,fill,stroke,color,offsetX,showColors}){const editor=(0,dist_esm.hGv)(),{side,translation}=(0,dist_esm.hau)("shape rotation",(()=>{const shape=editor.getShape(id);if(!shape)return{side:0,translation:"translate(0, 0)"};const labelSide=getFrameHeadingSide(editor,shape);return{side:labelSide,translation:getFrameHeadingTranslation(shape,labelSide,!1)}}),[editor,offsetX,id]),rInput=(0,react.useRef)(null),isEditing=(0,dist_esm._As)(id);return(0,react.useEffect)((()=>{const el=rInput.current;el&&isEditing&&(el.focus(),el.select())}),[rInput,isEditing]),(0,jsx_runtime.jsx)("div",{className:"tl-frame-heading",style:{overflow:isEditing?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${0===side||2===side?Math.ceil(width):Math.ceil(height)}px + ${showColors?"0px":"var(--frame-offset-width)"})`,bottom:"100%",transform:`${translation} scale(var(--tl-scale)) translateX(${offsetX}px)`},children:(0,jsx_runtime.jsx)("div",{className:"tl-frame-heading-hit-area",style:{color,backgroundColor:fill,boxShadow:`inset 0px 0px 0px 1px ${stroke}`},children:(0,jsx_runtime.jsx)(FrameLabelInput,{ref:rInput,id,name,isEditing})})})}));function defaultEmptyAs(str,dflt){return str.match(/^\s*$/)?dflt:str}class FrameShapeUtil extends dist_esm.A8{static type="frame";static props=dist_esm.X24;static migrations=dist_esm.SpZ;options={showColors:!1};static configure(options){const withOptions=super.configure.call(this,options);return options.showColors&&(withOptions.props={...withOptions.props,color:dist_esm.ive}),withOptions}canEdit(){return!0}getDefaultProps(){return{w:320,h:180,name:"",color:"black"}}getAriaDescriptor(shape){return shape.props.name}getGeometry(shape){const{editor}=this,z=editor.getZoomLevel(),labelSide=getFrameHeadingSide(editor,shape),isVertical=labelSide%2==1,rotatedTopEdgeWidth=isVertical?shape.props.h:shape.props.w,headingSize=getFrameHeadingSize(editor,shape,getFrameHeadingOpts(rotatedTopEdgeWidth,!1)),isShowingFrameColors=this.options.showColors,extraWidth=12/z,minWidth=32/z,maxWidth=rotatedTopEdgeWidth+(isShowingFrameColors?1:extraWidth),labelWidth=headingSize.w/z,labelHeight=headingSize.h/z,clampedLabelWidth=(0,dist_esm.qE8)(labelWidth+extraWidth,minWidth,maxWidth),offsetX=(isShowingFrameColors?-1:-7)/z,offsetY=4/z,width=isVertical?labelHeight:clampedLabelWidth,height=isVertical?clampedLabelWidth:labelHeight;let x,y;switch(labelSide){case 0:x=offsetX,y=-(labelHeight+offsetY);break;case 1:x=-(labelHeight+offsetY),y=shape.props.h-(offsetX+clampedLabelWidth);break;case 2:x=shape.props.w-(offsetX+clampedLabelWidth),y=shape.props.h+offsetY;break;case 3:x=shape.props.w+offsetY,y=offsetX}return new dist_esm.IQE({children:[new dist_esm.krb({width:shape.props.w,height:shape.props.h,isFilled:!1}),new dist_esm.krb({x,y,width,height,isFilled:!0,isLabel:!0})]})}getText(shape){return shape.props.name}component(shape){const theme=useDefaultColorTheme(),isCreating=(0,dist_esm.hau)("is creating this shape",(()=>{const resizingState=this.editor.getStateDescendant("select.resizing");if(!resizingState)return!1;if(!resizingState.getIsActive())return!1;const info=resizingState?.info;return!!info&&(info.isCreating&&this.editor.getOnlySelectedShapeId()===shape.id)}),[shape.id]),zoomLevel=(0,dist_esm.hau)("zoom level",(()=>this.editor.getZoomLevel()),[this.editor]),showFrameColors=this.options.showColors,color=theme[shape.props.color],frameFill=showFrameColors?color.frame.fill:theme.black.frame.fill,frameStroke=showFrameColors?color.frame.stroke:theme.black.frame.stroke,frameHeadingStroke=showFrameColors?color.frame.headingStroke:theme.background,frameHeadingFill=showFrameColors?color.frame.headingFill:theme.background,frameHeadingText=showFrameColors?color.frame.text:theme.text;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(dist_esm.ULM,{children:(0,jsx_runtime.jsx)("rect",{className:classnames_default()("tl-frame__body",{"tl-frame__creating":isCreating}),width:shape.props.w+1/zoomLevel,height:shape.props.h+1/zoomLevel,fill:frameFill,stroke:frameStroke,y:-.5/zoomLevel,x:-.5/zoomLevel})}),isCreating?null:(0,jsx_runtime.jsx)(FrameHeading,{id:shape.id,name:shape.props.name,fill:frameHeadingFill,stroke:frameHeadingStroke,color:frameHeadingText,width:shape.props.w,height:shape.props.h,offsetX:showFrameColors?-1:-7,showColors:this.options.showColors})]})}toSvg(shape,ctx){const theme=(0,dist_esm.AnR)({isDarkMode:ctx.isDarkMode}),labelSide=getFrameHeadingSide(this.editor,shape),rotatedTopEdgeWidth=labelSide%2==1?shape.props.h:shape.props.w,labelTranslate=getFrameHeadingTranslation(shape,labelSide,!0),opts=getFrameHeadingOpts(rotatedTopEdgeWidth-12,!0),frameTitle=defaultEmptyAs(shape.props.name,"Frame")+String.fromCharCode(8203),labelBounds=getFrameHeadingSize(this.editor,shape,opts),spans=this.editor.textMeasure.measureTextSpans(frameTitle,opts),text=createTextJsxFromSpans(this.editor,spans,opts),showFrameColors=this.options.showColors,color=theme[shape.props.color],frameFill=showFrameColors?color.frame.fill:theme.black.frame.fill,frameStroke=showFrameColors?color.frame.stroke:theme.black.frame.stroke,frameHeadingStroke=showFrameColors?color.frame.headingStroke:theme.background,frameHeadingFill=showFrameColors?color.frame.headingFill:theme.background,frameHeadingText=showFrameColors?color.frame.text:theme.text;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("rect",{width:shape.props.w,height:shape.props.h,fill:frameFill,stroke:frameStroke,strokeWidth:1,x:0,rx:0,ry:0}),(0,jsx_runtime.jsxs)("g",{fill:frameHeadingText,transform:labelTranslate,children:[(0,jsx_runtime.jsx)("rect",{x:labelBounds.x-(showFrameColors?0:6),y:labelBounds.y-6,width:Math.min(rotatedTopEdgeWidth,labelBounds.width+12),height:labelBounds.height,fill:frameHeadingFill,stroke:frameHeadingStroke,rx:4,ry:4}),(0,jsx_runtime.jsx)("g",{transform:`translate(${showFrameColors?8:0}, 4)`,children:text})]})]})}indicator(shape){return(0,jsx_runtime.jsx)("rect",{width:(0,dist_esm.WMC)(shape.props.w),height:(0,dist_esm.WMC)(shape.props.h),className:"tl-frame-indicator"})}canReceiveNewChildrenOfType(shape,_type){return!shape.isLocked}providesBackgroundForChildren(){return!0}canDropShapes(shape,_shapes){return!shape.isLocked}onDragShapesOver(frame,shapes){shapes.every((child=>child.parentId===frame.id))||this.editor.reparentShapes(shapes,frame.id)}onDragShapesOut(_shape,shapes){const parent=this.editor.getShape(_shape.parentId);parent&&this.editor.isShapeOfType(parent,"group")?this.editor.reparentShapes(shapes,parent.id):this.editor.reparentShapes(shapes,this.editor.getCurrentPageId())}onResize(shape,info){return(0,dist_esm.mfH)(shape,info)}getInterpolatedProps(startShape,endShape,t){return{...t>.5?endShape.props:startShape.props,w:(0,dist_esm.CcK)(startShape.props.w,endShape.props.w,t),h:(0,dist_esm.CcK)(startShape.props.h,endShape.props.h,t)}}onDoubleClickEdge(shape,info){if("selection"!==info.target)return;const{handle}=info;if(!handle)return;const isHorizontalEdge="left"===handle||"right"===handle,isVerticalEdge="top"===handle||"bottom"===handle,childIds=this.editor.getSortedChildIdsForParent(shape.id),children=(0,dist_esm.oE7)(childIds.map((id=>this.editor.getShape(id))));if(!children.length)return;const{dx,dy,w,h}=getFrameChildrenBounds(children,this.editor,{padding:10});return this.editor.run((()=>{const changes=childIds.map((childId=>{const childShape=this.editor.getShape(childId);return{id:childShape.id,type:childShape.type,x:isHorizontalEdge?childShape.x+dx:childShape.x,y:isVerticalEdge?childShape.y+dy:childShape.y}}));this.editor.updateShapes(changes)})),{id:shape.id,type:shape.type,props:{w:isHorizontalEdge?w:shape.props.w,h:isVerticalEdge?h:shape.props.h}}}onDoubleClickCorner(shape){return fitFrameToContent(this.editor,shape.id,{padding:10}),{id:shape.id,type:shape.type}}}var lodash_isequal=__webpack_require__("./node_modules/lodash.isequal/index.js"),lodash_isequal_default=__webpack_require__.n(lodash_isequal);const RichTextArea=react.forwardRef((function RichTextArea2({shapeId,isEditing,richText,handleFocus,handleChange,handleBlur,handleKeyDown,handleDoubleClick,hasCustomTabBehavior},ref){const editor=(0,dist_esm.hGv)(),tipTapId=(0,dist_esm.LsA)("tip-tap-editor"),tipTapConfig=editor.getTextOptions().tipTapConfig,rInitialRichText=(0,react.useRef)(richText),rTextEditor=(0,react.useRef)(null),rTextEditorEl=(0,react.useRef)(null);(0,react.useLayoutEffect)((()=>{rTextEditor.current?rInitialRichText.current!==richText&&rTextEditor.current.commands.setContent(richText):rInitialRichText.current=richText}),[richText]);const rCreateInfo=(0,react.useRef)({selectAll:!1,caretPosition:null});(0,react.useLayoutEffect)((()=>{function selectAllIfEditing(event){event.shapeId===editor.getEditingShapeId()&&(rCreateInfo.current.selectAll=!0)}function placeCaret(event){event.shapeId===editor.getEditingShapeId()&&(rCreateInfo.current.caretPosition=event.point)}return editor.on("select-all-text",selectAllIfEditing),editor.on("place-caret",placeCaret),()=>{editor.off("select-all-text",selectAllIfEditing),editor.off("place-caret",placeCaret)}}),[editor,isEditing]);const onChange=(0,dist_esm._q_)(handleChange),onKeyDown=(0,dist_esm._q_)(handleKeyDown),onFocus=(0,dist_esm._q_)(handleFocus),onBlur=(0,dist_esm._q_)(handleBlur),onDoubleClick=(0,dist_esm._q_)(handleDoubleClick);return(0,react.useLayoutEffect)((()=>{if(!isEditing||!tipTapConfig||!rTextEditorEl.current)return;const{editorProps,...restOfTipTapConfig}=tipTapConfig,textEditorInstance=new core_dist.KE({element:rTextEditorEl.current,autofocus:!0,editable:isEditing,onUpdate:props=>{const content=props.editor.state.doc.toJSON();rInitialRichText.current=content,onChange({richText:content})},onFocus,onBlur,onCreate:props=>{if(editor.getEditingShapeId()!==shapeId)return;const textEditor=props.editor;editor.setRichTextEditor(textEditor);const{selectAll,caretPosition}=rCreateInfo.current;if(selectAll)textEditor.chain().focus().selectAll().run();else if(caretPosition){const pos=textEditor.view.posAtCoords({left:caretPosition.x,top:caretPosition.y})?.pos;pos?textEditor.chain().focus().setTextSelection(pos).run():textEditor.chain().focus().selectAll().run()}},editorProps:{handleKeyDown:(view,event)=>{hasCustomTabBehavior||"Tab"!==event.key||function handleTab(editor,view,event){event.preventDefault();const textEditor=editor.getRichTextEditor();if(textEditor?.isActive("bulletList")||textEditor?.isActive("orderedList"))return;const{state,dispatch}=view,{$from,$to}=state.selection,isShift=event.shiftKey;let tr=state.tr,pos=$to.end();for(;pos>=$from.start();){const line=state.doc.resolve(pos).blockRange();if(!line)break;const lineStart=line.start,lineEnd=line.end,lineText=state.doc.textBetween(lineStart,lineEnd,"\n");let isInList=!1;state.doc.nodesBetween(lineStart,lineEnd,(node=>{if("bulletList"===node.type.name||"orderedList"===node.type.name)return isInList=!0,!1})),isInList||(isShift?lineText.startsWith("\t")&&(tr=tr.delete(lineStart+1,lineStart+2)):tr=tr.insertText("\t",lineStart+1)),pos=lineStart-1}const mappedSelection=state.selection.map(tr.doc,tr.mapping);tr.setSelection(mappedSelection),tr.docChanged&&dispatch(tr)}(editor,view,event),onKeyDown(event)},handleDoubleClick:(view,pos,event)=>onDoubleClick(event),...editorProps},coreExtensionOptions:{clipboardTextSerializer:{blockSeparator:"\n"}},...restOfTipTapConfig,content:rInitialRichText.current}),timeout=editor.timers.setTimeout((()=>{rCreateInfo.current.caretPosition||rCreateInfo.current.selectAll?textEditorInstance.commands.focus():textEditorInstance.commands.focus("end"),rCreateInfo.current.selectAll=!1,rCreateInfo.current.caretPosition=null}),100);return rTextEditor.current=textEditorInstance,()=>{rTextEditor.current=null,clearTimeout(timeout),textEditorInstance.destroy()}}),[isEditing,tipTapConfig,onFocus,onBlur,onDoubleClick,onChange,onKeyDown,editor,shapeId,hasCustomTabBehavior]),isEditing&&tipTapConfig?(0,jsx_runtime.jsx)("div",{id:tipTapId,ref,tabIndex:-1,"data-testid":"rich-text-area",className:"tl-rich-text tl-text tl-text-input",onContextMenu:isEditing?dist_esm.$6n:void 0,onPointerDownCapture:dist_esm.$6n,onTouchEnd:dist_esm.$6n,onDragStart:dist_esm.woC,children:(0,jsx_runtime.jsx)("div",{className:"tl-rich-text",ref:rTextEditorEl})}):null}));const RichTextLabel=react.memo((function RichTextLabel2({shapeId,type,richText,labelColor,font,fontSize,lineHeight,align,verticalAlign,wrap,isSelected,padding=0,onKeyDown:handleKeyDownCustom,classNamePrefix,style,textWidth,textHeight,hasCustomTabBehavior}){const editor=(0,dist_esm.hGv)(),isDragging=react.useRef(!1),{rInput,isEmpty,isEditing,isReadyForEditing,...editableTextRest}=function useEditableRichText(shapeId,type,richText){const commonUseEditableTextHandlers=useEditableTextCommon(shapeId),isEditing=commonUseEditableTextHandlers.isEditing,editor=(0,dist_esm.hGv)(),rInput=(0,react.useRef)(null),isEmpty=richText&&isEmptyRichText(richText);(0,react.useEffect)((()=>{if(!isEditing)return;const contentEditable=rInput.current?.querySelector("[contenteditable]");contentEditable&&document.activeElement!==rInput.current&&contentEditable.focus()}),[editor,isEditing]);const handleKeyDown=(0,react.useCallback)((e=>{editor.getEditingShapeId()===shapeId&&"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&editor.complete()}),[editor,shapeId]),handleChange=(0,react.useCallback)((({richText:richText2})=>{editor.getEditingShapeId()===shapeId&&editor.updateShape({id:shapeId,type,props:{richText:richText2}})}),[editor,shapeId,type]);return{rInput,handleKeyDown,handleChange,isEmpty,...commonUseEditableTextHandlers}}(shapeId,type,richText),html=(0,react.useMemo)((()=>{if(richText)return renderHtmlFromRichText(editor,richText)}),[editor,richText]),selectToolActive=(0,dist_esm.hau)("isSelectToolActive",(()=>"select"===editor.getCurrentToolId()),[editor]);(0,dist_esm.a1r)("isDragging",(()=>{editor.getInstanceState(),isDragging.current=editor.inputs.isDragging}),[editor]);const legacyAlign=isLegacyAlign(align);if(!isEditing&&isEmpty)return null;const cssPrefix=classNamePrefix||"tl-text";return(0,jsx_runtime.jsx)("div",{className:`${cssPrefix}-label tl-text-wrapper tl-rich-text-wrapper`,"data-font":font,"data-align":align,"data-hastext":!isEmpty,"data-isediting":isEditing,"data-textwrap":!!wrap,"data-isselected":isSelected,style:{justifyContent:"middle"===align||legacyAlign?"center":align,alignItems:"middle"===verticalAlign?"center":verticalAlign,padding,...style},children:(0,jsx_runtime.jsxs)("div",{className:`${cssPrefix}-label__inner tl-text-content__wrapper`,style:{fontSize,lineHeight:Math.floor(fontSize*lineHeight)+"px",minHeight:Math.floor(fontSize*lineHeight)+"px",minWidth:Math.ceil(textWidth||0),color:labelColor,width:textWidth?Math.ceil(textWidth):void 0,height:textHeight?Math.ceil(textHeight):void 0},children:[(0,jsx_runtime.jsx)("div",{className:`${cssPrefix} tl-text tl-text-content`,dir:"auto",children:richText&&(0,jsx_runtime.jsx)("div",{className:"tl-rich-text","data-is-select-tool-active":selectToolActive,dangerouslySetInnerHTML:{__html:html||""},onPointerDown:e=>{if(e.target instanceof HTMLElement&&("A"===e.target.tagName||e.target.closest("a"))){if((0,dist_esm.woC)(e),!selectToolActive)return;const link=e.target.closest("a")?.getAttribute("href")??"",handlePointerUp=e2=>{"pointer_up"===e2.name&&(isDragging.current||window.open(link,"_blank","noopener, noreferrer"),editor.off("event",handlePointerUp))};editor.on("event",handlePointerUp)}},"data-is-ready-for-editing":isReadyForEditing})}),(isReadyForEditing||isSelected)&&(0,jsx_runtime.jsx)(RichTextArea,{ref:rInput,richText,isEditing,shapeId,...editableTextRest,hasCustomTabBehavior,handleKeyDown:handleKeyDownCustom??editableTextRest.handleKeyDown})]})})}));function RichTextSVG({bounds,richText,fontSize,font,align,verticalAlign,wrap,labelColor,padding}){const html=renderHtmlFromRichText((0,dist_esm.hGv)(),richText),textAlign="middle"===align?"center":"start"===align?"start":"end",justifyContent="middle"===align?"center":"start"===align?"flex-start":"flex-end",alignItems="middle"===verticalAlign?"center":"start"===verticalAlign?"flex-start":"flex-end",wrapperStyle={display:"flex",fontFamily:dist_esm.xXD[font],height:"100%",justifyContent,alignItems,padding:`${padding}px`},style={fontSize:`${fontSize}px`,wrap:wrap?"wrap":"nowrap",color:labelColor,lineHeight:TEXT_PROPS.lineHeight,textAlign,width:"100%",wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"pre-wrap"};return(0,jsx_runtime.jsx)("foreignObject",{x:bounds.minX,y:bounds.minY,width:bounds.w,height:bounds.h,className:"tl-export-embed-styles tl-rich-text tl-rich-text-svg",children:(0,jsx_runtime.jsx)("div",{style:wrapperStyle,children:(0,jsx_runtime.jsx)("div",{dangerouslySetInnerHTML:{__html:html},style})})})}function getOvalPerimeter(h,w){return h>w?2*(dist_esm.PI*(w/2)+(h-w)):2*(dist_esm.PI*(h/2)+(w-h))}function getHeartPath(w,h){return getHeartParts(w,h).map(((c,i)=>c.getSvgPathData(0===i))).join(" ")+" Z"}function getHeartParts(w,h){const o=w/4,k=h/4;return[new dist_esm.iON({start:new dist_esm.l2P(w/2,h),cp1:new dist_esm.l2P(1.5*o,3*k),cp2:new dist_esm.l2P(0,2.5*k),end:new dist_esm.l2P(0,1.2*k)}),new dist_esm.iON({start:new dist_esm.l2P(0,1.2*k),cp1:new dist_esm.l2P(0,.32*-k),cp2:new dist_esm.l2P(1.85*o,.32*-k),end:new dist_esm.l2P(w/2,.9*k)}),new dist_esm.iON({start:new dist_esm.l2P(w/2,.9*k),cp1:new dist_esm.l2P(2.15*o,.32*-k),cp2:new dist_esm.l2P(w,.32*-k),end:new dist_esm.l2P(w,1.2*k)}),new dist_esm.iON({start:new dist_esm.l2P(w,1.2*k),cp1:new dist_esm.l2P(w,2.5*k),cp2:new dist_esm.l2P(2.5*o,3*k),end:new dist_esm.l2P(w/2,h)})]}function getEllipseDrawIndicatorPath(id,width,height,strokeWidth){return getSvgPathFromStrokePoints(function getEllipseStrokePoints(id,width,height,strokeWidth){const getRandom=(0,dist_esm.She)(id),rx=width/2,ry=height/2,perimeter=(0,dist_esm.VMe)(rx,ry),points=[],start=dist_esm.uAR*getRandom(),length=dist_esm.uAR+dist_esm.sKG/2+Math.abs(getRandom())*dist_esm.sKG,count=Math.max(16,perimeter/10);for(let i=0;i<count;i++){const t=i/(count-1),r=start+t*length,c=Math.cos(r),s=Math.sin(r);points.push(new dist_esm.l2P(rx*c+.5*width+.05*getRandom(),ry*s+height/2+.05*getRandom(),Math.min(1,.5+Math.abs(.5-(getRandom()>0?dist_esm.Z4H.easeInOutSine(t):dist_esm.Z4H.easeInExpo(t)))/2)))}return getStrokePoints(points,function getEllipseStrokeOptions(strokeWidth){return{size:1+strokeWidth,thinning:.25,end:{taper:strokeWidth},start:{taper:strokeWidth},streamline:0,smoothing:1,simulatePressure:!1}}(strokeWidth))}(id,width,height,strokeWidth))}function getRoundedInkyPolygonPath(points){let polylineA="M";let p0,p1,p2;for(let i=0,n=points.length;i<n;i+=3)p0=points[i],p1=points[i+1],p2=points[i+2],polylineA+=`${(0,dist_esm.ulI)(p0)}L${(0,dist_esm.ulI)(p1)}Q${(0,dist_esm.ulI)(p2)}`;return polylineA+=`${(0,dist_esm.ulI)(points[0])}`,polylineA}function getRoundedPolygonPoints(id,outline,offset,roundness,passes){const results=[],random=(0,dist_esm.She)(id);let p1,p0=outline[0];const len=outline.length;for(let i=0,n=len*passes;i<n;i++){p1=dist_esm.l2P.AddXY(outline[(i+1)%len],random()*offset,random()*offset);const delta=dist_esm.l2P.Sub(p1,p0),distance=dist_esm.l2P.Len(delta),vector=dist_esm.l2P.Div(delta,distance).mul(Math.min(distance/4,roundness));results.push(dist_esm.l2P.Add(p0,vector),dist_esm.l2P.Add(p1,vector.neg()),p1),p0=p1}return results}const SIZES={s:50,m:70,l:100,xl:130},BUMP_PROTRUSION=.2;function getCloudArcs(width,height,seed,size,scale){const getRandom=(0,dist_esm.She)(seed),pillCircumference=getOvalPerimeter(width,height),numBumps=Math.max(Math.ceil(pillCircumference/SIZES[size]),6,Math.ceil(pillCircumference/Math.min(width,height))),targetBumpProtrusion=pillCircumference/numBumps*BUMP_PROTRUSION,innerWidth=Math.max(width-2*targetBumpProtrusion,1),innerHeight=Math.max(height-2*targetBumpProtrusion,1),distanceBetweenPointsOnPerimeter=getOvalPerimeter(innerWidth,innerHeight)/numBumps,paddingX=(width-innerWidth)/2,paddingY=(height-innerHeight)/2,bumpPoints=function getPillPoints(width,height,numPoints){const radius=Math.min(width,height)/2,longSide=Math.max(width,height)-2*radius,spacing=(Math.PI*(2*radius)+2*longSide)/numPoints,sections=width>height?[{type:"straight",start:new dist_esm.l2P(radius,0),delta:new dist_esm.l2P(1,0)},{type:"arc",center:new dist_esm.l2P(width-radius,radius),startAngle:-dist_esm.PI/2},{type:"straight",start:new dist_esm.l2P(width-radius,height),delta:new dist_esm.l2P(-1,0)},{type:"arc",center:new dist_esm.l2P(radius,radius),startAngle:dist_esm.PI/2}]:[{type:"straight",start:new dist_esm.l2P(width,radius),delta:new dist_esm.l2P(0,1)},{type:"arc",center:new dist_esm.l2P(radius,height-radius),startAngle:0},{type:"straight",start:new dist_esm.l2P(0,height-radius),delta:new dist_esm.l2P(0,-1)},{type:"arc",center:new dist_esm.l2P(radius,radius),startAngle:dist_esm.PI}];let sectionOffset=0;const points=[];for(let i=0;i<numPoints;i++){const section=sections[0];"straight"===section.type?points.push(dist_esm.l2P.Add(section.start,dist_esm.l2P.Mul(section.delta,sectionOffset))):points.push((0,dist_esm.AQe)(section.center,radius,section.startAngle+sectionOffset/radius)),sectionOffset+=spacing;let sectionLength="straight"===section.type?longSide:dist_esm.PI*radius;for(;sectionOffset>sectionLength;)sectionOffset-=sectionLength,sections.push(sections.shift()),sectionLength="straight"===sections[0].type?longSide:dist_esm.PI*radius}return points}(innerWidth,innerHeight,numBumps).map((p=>p.addXY(paddingX,paddingY))),maxWiggleX=width<20?0:.3*targetBumpProtrusion,maxWiggleY=height<20?0:.3*targetBumpProtrusion,wiggledPoints=bumpPoints.slice(0);for(let i=0;i<Math.floor(numBumps/2);i++)wiggledPoints[i]=dist_esm.l2P.AddXY(wiggledPoints[i],getRandom()*maxWiggleX*scale,getRandom()*maxWiggleY*scale),wiggledPoints[numBumps-i-1]=dist_esm.l2P.AddXY(wiggledPoints[numBumps-i-1],getRandom()*maxWiggleX*scale,getRandom()*maxWiggleY*scale);const arcs=[];for(let i=0;i<wiggledPoints.length;i++){const j=i===wiggledPoints.length-1?0:i+1,leftWigglePoint=wiggledPoints[i],rightWigglePoint=wiggledPoints[j],leftPoint=bumpPoints[i],rightPoint=bumpPoints[j],distanceBetweenOriginalPoints=dist_esm.l2P.Dist(leftPoint,rightPoint),curvatureOffset=distanceBetweenPointsOnPerimeter-distanceBetweenOriginalPoints,relativeSize=dist_esm.l2P.Dist(leftWigglePoint,rightWigglePoint)/distanceBetweenOriginalPoints,finalDistance=(Math.max(paddingX,paddingY)+curvatureOffset)*relativeSize,arcPoint=dist_esm.l2P.Lrp(leftPoint,rightPoint,.5).add(dist_esm.l2P.Sub(rightPoint,leftPoint).uni().per().mul(finalDistance));arcPoint.x<0?arcPoint.x=0:arcPoint.x>width&&(arcPoint.x=width),arcPoint.y<0?arcPoint.y=0:arcPoint.y>height&&(arcPoint.y=height);const center=(0,dist_esm.oj6)(leftWigglePoint,rightWigglePoint,arcPoint),radius=dist_esm.l2P.Dist(center||dist_esm.l2P.Average([leftWigglePoint,rightWigglePoint]),leftWigglePoint);arcs.push({leftPoint:leftWigglePoint,rightPoint:rightWigglePoint,arcPoint,center,radius})}return arcs}function cloudOutline(width,height,seed,size,scale){const path=[],arcs=getCloudArcs(width,height,seed,size,scale);for(const{center,radius,leftPoint,rightPoint}of arcs)path.push(...(0,dist_esm.Dso)(leftPoint,rightPoint,center,radius,10));return path}function getCloudPath(width,height,seed,size,scale){const arcs=getCloudArcs(width,height,seed,size,scale);let path=`M${arcs[0].leftPoint.toFixed()}`;for(const{leftPoint,rightPoint,radius,center}of arcs){if(null===center){path+=` L${rightPoint.toFixed()}`;continue}const arc=dist_esm.l2P.Clockwise(leftPoint,rightPoint,center)?"0":"1";path+=` A${(0,dist_esm.WMC)(radius)},${(0,dist_esm.WMC)(radius)} 0 ${arc},1 ${rightPoint.toFixed()}`}return path+=" Z",path}const DRAW_OFFSETS={s:.5,m:.7,l:.9,xl:1.6};function getLines(props,sw){switch(props.geo){case"x-box":return function getXBoxLines(w,h,sw,dash){const inset="draw"===dash?.62:0;if("dashed"===dash)return[[new dist_esm.l2P(0,0),new dist_esm.l2P(w/2,h/2)],[new dist_esm.l2P(w,h),new dist_esm.l2P(w/2,h/2)],[new dist_esm.l2P(0,h),new dist_esm.l2P(w/2,h/2)],[new dist_esm.l2P(w,0),new dist_esm.l2P(w/2,h/2)]];const clampX=x=>Math.max(0,Math.min(w,x)),clampY=y=>Math.max(0,Math.min(h,y));return[[new dist_esm.l2P(clampX(sw*inset),clampY(sw*inset)),new dist_esm.l2P(clampX(w-sw*inset),clampY(h-sw*inset))],[new dist_esm.l2P(clampX(sw*inset),clampY(h-sw*inset)),new dist_esm.l2P(clampX(w-sw*inset),clampY(sw*inset))]]}(props.w,props.h,sw,props.dash);case"check-box":return function getCheckBoxLines(w,h){const size=.82*Math.min(w,h),ox=(w-size)/2,oy=(h-size)/2,clampX=x=>Math.max(0,Math.min(w,x)),clampY=y=>Math.max(0,Math.min(h,y));return[[new dist_esm.l2P(clampX(ox+.25*size),clampY(oy+.52*size)),new dist_esm.l2P(clampX(ox+.45*size),clampY(oy+.82*size))],[new dist_esm.l2P(clampX(ox+.45*size),clampY(oy+.82*size)),new dist_esm.l2P(clampX(ox+.82*size),clampY(oy+.22*size))]]}(props.w,props.h);default:return}}function GeoShapeBody({shape,shouldScale,forceSolid}){const scaleToUse=shouldScale?shape.props.scale:1,editor=(0,dist_esm.hGv)(),theme=useDefaultColorTheme(),{id,props}=shape,{w,color,fill,dash,growY,size,scale}=props,strokeWidth=default_shape_constants_STROKE_SIZES[size]*scaleToUse,h=props.h+growY;switch(props.geo){case"cloud":if("solid"===dash){const d=getCloudPath(w,h,id,size,scale);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ShapeFill,{theme,d,color,fill,scale:scaleToUse}),(0,jsx_runtime.jsx)("path",{d,stroke:theme[color].solid,strokeWidth,fill:"none"})]})}if("draw"===dash){const d=function inkyCloudSvgPath(width,height,seed,size,scale){const getRandom=(0,dist_esm.She)(seed),mutMultiplier=DRAW_OFFSETS[size]*scale,arcs=getCloudArcs(width,height,seed,size,scale),mutPoint=arcs.reduce(((sum,arc)=>sum+dist_esm.l2P.Dist2(arc.leftPoint,arc.rightPoint)),0)/arcs.length>(15*mutMultiplier)**2?p=>dist_esm.l2P.AddXY(p,getRandom()*mutMultiplier*2,getRandom()*mutMultiplier*2):p=>p;let pathA=`M${arcs[0].leftPoint.toFixed()}`,leftMutPoint=mutPoint(arcs[0].leftPoint),pathB=`M${leftMutPoint.toFixed()}`;for(const{leftPoint,center,rightPoint,radius,arcPoint}of arcs){if(null===center){pathA+=` L${rightPoint.toFixed()}`;const rightMutPoint2=mutPoint(rightPoint);pathB+=` L${rightMutPoint2.toFixed()}`,leftMutPoint=rightMutPoint2;continue}const arc=dist_esm.l2P.Clockwise(leftPoint,rightPoint,center)?"0":"1";pathA+=` A${(0,dist_esm.WMC)(radius)},${(0,dist_esm.WMC)(radius)} 0 ${arc},1 ${rightPoint.toFixed()}`;const rightMutPoint=mutPoint(rightPoint),mutArcPoint=mutPoint(arcPoint),mutCenter=(0,dist_esm.oj6)(leftMutPoint,rightMutPoint,mutArcPoint);if(!mutCenter){pathB+=` L${rightMutPoint.toFixed()}`,leftMutPoint=rightMutPoint;continue}const mutRadius=Math.abs(dist_esm.l2P.Dist(mutCenter,leftMutPoint));pathB+=` A${(0,dist_esm.WMC)(mutRadius)},${(0,dist_esm.WMC)(mutRadius)} 0 ${arc},1 ${rightMutPoint.toFixed()}`,leftMutPoint=rightMutPoint}return pathA+pathB+" Z"}(w,h,id,size,scale);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ShapeFill,{theme,d,color,fill,scale:scaleToUse}),(0,jsx_runtime.jsx)("path",{d,stroke:theme[color].solid,strokeWidth,fill:"none"})]})}{const d=getCloudPath(w,h,id,size,scale),arcs=getCloudArcs(w,h,id,size,scale);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ShapeFill,{theme,d,color,fill,scale:scaleToUse}),(0,jsx_runtime.jsx)("g",{strokeWidth,stroke:theme[color].solid,fill:"none",pointerEvents:"all",children:arcs.map((({leftPoint,rightPoint,center,radius},i)=>{const arcLength=center?radius*(0,dist_esm.rgm)((0,dist_esm.rgm)(dist_esm.l2P.Angle(center,rightPoint))-(0,dist_esm.rgm)(dist_esm.l2P.Angle(center,leftPoint))):dist_esm.l2P.Dist(leftPoint,rightPoint),{strokeDasharray,strokeDashoffset}=(0,dist_esm.EK8)(arcLength,strokeWidth,{style:dash,start:"outset",end:"outset",forceSolid});return(0,jsx_runtime.jsx)("path",{d:center?`M${leftPoint.x},${leftPoint.y}A${radius},${radius},0,0,1,${rightPoint.x},${rightPoint.y}`:`M${leftPoint.x},${leftPoint.y}L${rightPoint.x},${rightPoint.y}`,strokeDasharray,strokeDashoffset},i)}))})]})}case"ellipse":{const geometry=shouldScale?editor.getShapeGeometry(shape):editor.getShapeUtil(shape).getGeometry(shape),d=geometry.getSvgPathData(!0);if("dashed"===dash||"dotted"===dash){const perimeter=geometry.length,{strokeDasharray,strokeDashoffset}=(0,dist_esm.EK8)(perimeter<64?2*perimeter:perimeter,strokeWidth,{style:dash,snap:4,closed:!0,forceSolid});return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ShapeFill,{theme,d,color,fill,scale:scaleToUse}),(0,jsx_runtime.jsx)("path",{d,strokeWidth,fill:"none",stroke:theme[color].solid,strokeDasharray,strokeDashoffset})]})}{const d2=(shouldScale?editor.getShapeGeometry(shape):editor.getShapeUtil(shape).getGeometry(shape)).getSvgPathData(!0);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ShapeFill,{theme,d:d2,color,fill,scale:scaleToUse}),(0,jsx_runtime.jsx)("path",{d:d2,stroke:theme[color].solid,strokeWidth,fill:"none"})]})}}case"oval":{const geometry=shouldScale?editor.getShapeGeometry(shape):editor.getShapeUtil(shape).getGeometry(shape),d=geometry.getSvgPathData(!0);if("dashed"===dash||"dotted"===dash){const perimeter=geometry.getLength(),{strokeDasharray,strokeDashoffset}=(0,dist_esm.EK8)(perimeter<64?2*perimeter:perimeter,strokeWidth,{style:dash,snap:4,start:"outset",end:"outset",closed:!0,forceSolid});return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ShapeFill,{theme,d,color,fill,scale:scaleToUse}),(0,jsx_runtime.jsx)("path",{d,strokeWidth,fill:"none",stroke:theme[color].solid,strokeDasharray,strokeDashoffset})]})}return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ShapeFill,{theme,d,color,fill,scale:scaleToUse}),(0,jsx_runtime.jsx)("path",{d,stroke:theme[color].solid,strokeWidth,fill:"none"})]})}case"heart":if("dashed"===dash||"dotted"===dash||"solid"===dash){const d=getHeartPath(w,h),curves=getHeartParts(w,h);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ShapeFill,{theme,d,color,fill,scale:scaleToUse}),curves.map(((c,i)=>{const{strokeDasharray,strokeDashoffset}=(0,dist_esm.EK8)(c.length,strokeWidth,{style:dash,snap:1,start:"outset",end:"outset",closed:!0,forceSolid});return(0,jsx_runtime.jsx)("path",{d:c.getSvgPathData(),strokeWidth,fill:"none",stroke:theme[color].solid,strokeDasharray,strokeDashoffset,pointerEvents:"all"},`curve_${i}`)}))]})}{const d=function getDrawHeartPath(w,h,sw,id){const o=w/4,k=h/4,random=(0,dist_esm.She)(id),mutDistance=.75*sw,mut=v=>v.addXY(random()*mutDistance,random()*mutDistance),A=new dist_esm.l2P(w/2,h),B=new dist_esm.l2P(0,1.2*k),C=new dist_esm.l2P(w/2,.9*k),D=new dist_esm.l2P(w,1.2*k),Am=mut(new dist_esm.l2P(w/2,h)),Bm=mut(new dist_esm.l2P(0,1.2*k)),Cm=mut(new dist_esm.l2P(w/2,.9*k)),Dm=mut(new dist_esm.l2P(w,1.2*k));return[new dist_esm.iON({start:A,cp1:new dist_esm.l2P(1.5*o,3*k),cp2:new dist_esm.l2P(0,2.5*k),end:B}),new dist_esm.iON({start:B,cp1:new dist_esm.l2P(0,.32*-k),cp2:new dist_esm.l2P(1.85*o,.32*-k),end:C}),new dist_esm.iON({start:C,cp1:new dist_esm.l2P(2.15*o,.32*-k),cp2:new dist_esm.l2P(w,.32*-k),end:D}),new dist_esm.iON({start:D,cp1:new dist_esm.l2P(w,2.5*k),cp2:new dist_esm.l2P(2.5*o,3*k),end:Am}),new dist_esm.iON({start:Am,cp1:new dist_esm.l2P(1.5*o,3*k),cp2:new dist_esm.l2P(0,2.5*k),end:Bm}),new dist_esm.iON({start:Bm,cp1:new dist_esm.l2P(0,.32*-k),cp2:new dist_esm.l2P(1.85*o,.32*-k),end:Cm}),new dist_esm.iON({start:Cm,cp1:new dist_esm.l2P(2.15*o,.32*-k),cp2:new dist_esm.l2P(w,.32*-k),end:Dm}),new dist_esm.iON({start:Dm,cp1:new dist_esm.l2P(w,2.5*k),cp2:new dist_esm.l2P(2.5*o,3*k),end:A})].map(((c,i)=>c.getSvgPathData(0===i))).join(" ")+" Z"}(w,h,strokeWidth,shape.id);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ShapeFill,{theme,d,color,fill,scale:scaleToUse}),(0,jsx_runtime.jsx)("path",{d,stroke:theme[color].solid,strokeWidth,fill:"none"})]})}default:{const geometry=shouldScale?editor.getShapeGeometry(shape):editor.getShapeUtil(shape).getGeometry(shape),outline=geometry instanceof dist_esm.IQE?geometry.children[0].vertices:geometry.vertices,lines=getLines(shape.props,strokeWidth);if("solid"===dash){let d="M"+outline[0]+"L"+outline.slice(1)+"Z";if(lines)for(const[A,B]of lines)d+=`M${A.x},${A.y}L${B.x},${B.y}`;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ShapeFill,{theme,d,color,fill,scale:scaleToUse}),(0,jsx_runtime.jsx)("path",{d,stroke:theme[color].solid,strokeWidth,fill:"none"})]})}if("dashed"===dash||"dotted"===dash){const d="M"+outline[0]+"L"+outline.slice(1)+"Z";return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ShapeFill,{theme,d,color,fill,scale:scaleToUse}),(0,jsx_runtime.jsxs)("g",{strokeWidth,stroke:theme[color].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(outline.length)).map(((_,i)=>{const A=dist_esm.l2P.ToFixed(outline[i]),B=dist_esm.l2P.ToFixed(outline[(i+1)%outline.length]),dist=dist_esm.l2P.Dist(A,B),{strokeDasharray,strokeDashoffset}=(0,dist_esm.EK8)(dist,strokeWidth,{style:dash,start:"outset",end:"outset",forceSolid});return(0,jsx_runtime.jsx)("line",{x1:A.x,y1:A.y,x2:B.x,y2:B.y,strokeDasharray,strokeDashoffset},i)})),lines&&lines.map((([A,B],i)=>{const dist=dist_esm.l2P.Dist(A,B),{strokeDasharray,strokeDashoffset}=(0,dist_esm.EK8)(dist,strokeWidth,{style:dash,start:"skip",end:"skip",snap:"dotted"===dash?4:void 0,forceSolid});return(0,jsx_runtime.jsx)("path",{d:`M${A.x},${A.y}L${B.x},${B.y}`,stroke:theme[color].solid,strokeWidth,fill:"none",strokeDasharray,strokeDashoffset},`line_fg_${i}`)}))]})]})}if("draw"===dash){let d=getRoundedInkyPolygonPath(getRoundedPolygonPoints(id,outline,strokeWidth/3,2*strokeWidth,2));if(lines)for(const[A,B]of lines)d+=`M${A.toFixed()}L${B.toFixed()}`;const innerPathData=getRoundedInkyPolygonPath(getRoundedPolygonPoints(id,outline,0,2*strokeWidth,1));return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ShapeFill,{theme,d:innerPathData,color,fill,scale:scaleToUse}),(0,jsx_runtime.jsx)("path",{d,stroke:theme[color].solid,strokeWidth,fill:"none"})]})}}}}class GeoShapeUtil extends dist_esm.A8{static type="geo";static props=dist_esm.X8F;static migrations=dist_esm.s4L;canEdit(){return!0}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",align:"middle",verticalAlign:"middle",growY:0,url:"",scale:1,richText:(0,dist_esm.TP3)("")}}getGeometry(shape){const w=Math.max(1,shape.props.w),h=Math.max(1,shape.props.h+shape.props.growY),cx=w/2,cy=h/2,isFilled="none"!==shape.props.fill;let body;switch(shape.props.geo){case"cloud":body=new dist_esm.dxv({points:cloudOutline(w,h,shape.id,shape.props.size,shape.props.scale),isFilled});break;case"triangle":body=new dist_esm.dxv({points:[new dist_esm.l2P(cx,0),new dist_esm.l2P(w,h),new dist_esm.l2P(0,h)],isFilled});break;case"diamond":body=new dist_esm.dxv({points:[new dist_esm.l2P(cx,0),new dist_esm.l2P(w,cy),new dist_esm.l2P(cx,h),new dist_esm.l2P(0,cy)],isFilled});break;case"pentagon":body=new dist_esm.dxv({points:(0,dist_esm.yeN)(w,h,5),isFilled});break;case"hexagon":body=new dist_esm.dxv({points:(0,dist_esm.yeN)(w,h,6),isFilled});break;case"octagon":body=new dist_esm.dxv({points:(0,dist_esm.yeN)(w,h,8),isFilled});break;case"ellipse":body=new dist_esm.pPP({width:w,height:h,isFilled});break;case"oval":body=new dist_esm.SPX({width:w,height:h,isFilled});break;case"star":{const sides=5,step=dist_esm.uAR/sides/2,rightMostIndex=2*Math.floor(sides/4),leftMostIndex=2*sides-rightMostIndex,topMostIndex=0,bottomMostIndex=2*Math.floor(sides/2),maxX=Math.cos(-dist_esm.sKG+rightMostIndex*step)*w/2,minX=Math.cos(-dist_esm.sKG+leftMostIndex*step)*w/2,minY=Math.sin(-dist_esm.sKG+topMostIndex*step)*h/2,maxY=Math.sin(-dist_esm.sKG+bottomMostIndex*step)*h/2,diffX=w-Math.abs(maxX-minX),diffY=h-Math.abs(maxY-minY),ratio=1,cx2=(w-(w/2+minX-(w/2-maxX)))/2,cy2=(h-(h/2+minY-(h/2-maxY)))/2,ox=(w+diffX)/2,oy=(h+diffY)/2,ix=ox*ratio/2,iy=oy*ratio/2;body=new dist_esm.dxv({points:Array.from(Array(2*sides)).map(((_,i)=>{const theta=-dist_esm.sKG+i*step;return new dist_esm.l2P(cx2+(i%2?ix:ox)*Math.cos(theta),cy2+(i%2?iy:oy)*Math.sin(theta))})),isFilled});break}case"rhombus":{const offset=Math.min(.38*w,.38*h);body=new dist_esm.dxv({points:[new dist_esm.l2P(offset,0),new dist_esm.l2P(w,0),new dist_esm.l2P(w-offset,h),new dist_esm.l2P(0,h)],isFilled});break}case"rhombus-2":{const offset=Math.min(.38*w,.38*h);body=new dist_esm.dxv({points:[new dist_esm.l2P(0,0),new dist_esm.l2P(w-offset,0),new dist_esm.l2P(w,h),new dist_esm.l2P(offset,h)],isFilled});break}case"trapezoid":{const offset=Math.min(.38*w,.38*h);body=new dist_esm.dxv({points:[new dist_esm.l2P(offset,0),new dist_esm.l2P(w-offset,0),new dist_esm.l2P(w,h),new dist_esm.l2P(0,h)],isFilled});break}case"arrow-right":{const ox=.38*Math.min(w,h),oy=.16*h;body=new dist_esm.dxv({points:[new dist_esm.l2P(0,oy),new dist_esm.l2P(w-ox,oy),new dist_esm.l2P(w-ox,0),new dist_esm.l2P(w,h/2),new dist_esm.l2P(w-ox,h),new dist_esm.l2P(w-ox,h-oy),new dist_esm.l2P(0,h-oy)],isFilled});break}case"arrow-left":{const ox=.38*Math.min(w,h),oy=.16*h;body=new dist_esm.dxv({points:[new dist_esm.l2P(ox,0),new dist_esm.l2P(ox,oy),new dist_esm.l2P(w,oy),new dist_esm.l2P(w,h-oy),new dist_esm.l2P(ox,h-oy),new dist_esm.l2P(ox,h),new dist_esm.l2P(0,h/2)],isFilled});break}case"arrow-up":{const ox=.16*w,oy=.38*Math.min(w,h);body=new dist_esm.dxv({points:[new dist_esm.l2P(w/2,0),new dist_esm.l2P(w,oy),new dist_esm.l2P(w-ox,oy),new dist_esm.l2P(w-ox,h),new dist_esm.l2P(ox,h),new dist_esm.l2P(ox,oy),new dist_esm.l2P(0,oy)],isFilled});break}case"arrow-down":{const ox=.16*w,oy=.38*Math.min(w,h);body=new dist_esm.dxv({points:[new dist_esm.l2P(ox,0),new dist_esm.l2P(w-ox,0),new dist_esm.l2P(w-ox,h-oy),new dist_esm.l2P(w,h-oy),new dist_esm.l2P(w/2,h),new dist_esm.l2P(0,h-oy),new dist_esm.l2P(ox,h-oy)],isFilled});break}case"check-box":case"x-box":case"rectangle":body=new dist_esm.krb({width:w,height:h,isFilled});break;case"heart":{const points=getHeartParts(w,h).reduce(((acc,part)=>(acc.push(...part.vertices),acc)),[]);body=new dist_esm.dxv({points,isFilled});break}default:(0,dist_esm.h6G)(shape.props.geo)}const unscaledlabelSize=getUnscaledLabelSize(this.editor,shape),unscaledW=w/shape.props.scale,unscaledH=h/shape.props.scale,unscaledminWidth=Math.min(100,unscaledW/2),unscaledMinHeight=Math.min(LABEL_FONT_SIZES[shape.props.size]*TEXT_PROPS.lineHeight+2*LABEL_PADDING,unscaledH/2),unscaledLabelWidth=Math.min(unscaledW,Math.max(unscaledlabelSize.w,Math.min(unscaledminWidth,Math.max(1,unscaledW-8)))),unscaledLabelHeight=Math.min(unscaledH,Math.max(unscaledlabelSize.h,Math.min(unscaledMinHeight,Math.max(1,unscaledH-8)))),lines=getLines(shape.props,default_shape_constants_STROKE_SIZES[shape.props.size]*shape.props.scale),edges=lines?lines.map((line=>new dist_esm.Hes({points:line,isInternal:!0}))):[];return new dist_esm.IQE({children:[body,new dist_esm.krb({x:"start"===shape.props.align?0:"end"===shape.props.align?(unscaledW-unscaledLabelWidth)*shape.props.scale:(unscaledW-unscaledLabelWidth)/2*shape.props.scale,y:"start"===shape.props.verticalAlign?0:"end"===shape.props.verticalAlign?(unscaledH-unscaledLabelHeight)*shape.props.scale:(unscaledH-unscaledLabelHeight)/2*shape.props.scale,width:unscaledLabelWidth*shape.props.scale,height:unscaledLabelHeight*shape.props.scale,isFilled:!0,isLabel:!0}),...edges]})}getHandleSnapGeometry(shape){const geometry=this.getGeometry(shape),outline=geometry.children[0];switch(shape.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline,points:[...outline.vertices,geometry.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline,points:[geometry.bounds.center]};default:(0,dist_esm.h6G)(shape.props.geo)}}getText(shape){return renderPlaintextFromRichText(this.editor,shape.props.richText)}getFontFaces(shape){return(0,dist_esm.EYW)(this.editor,shape.props.richText,{family:`tldraw_${shape.props.font}`,weight:"normal",style:"normal"})}component(shape){const{id,type,props}=shape,{fill,font,align,verticalAlign,size,richText}=props,theme=useDefaultColorTheme(),{editor}=this,isOnlySelected=(0,dist_esm.hau)("isGeoOnlySelected",(()=>shape.id===editor.getOnlySelectedShapeId()),[editor]),isReadyForEditing=useIsReadyForEditing(editor,shape.id),isEmpty=isEmptyRichText(shape.props.richText),showHtmlContainer=isReadyForEditing||!isEmpty,isForceSolid=(0,dist_esm.hau)("force solid",(()=>editor.getZoomLevel()<.2),[editor]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(dist_esm.ULM,{children:(0,jsx_runtime.jsx)(GeoShapeBody,{shape,shouldScale:!0,forceSolid:isForceSolid})}),showHtmlContainer&&(0,jsx_runtime.jsx)(dist_esm.hDc,{style:{overflow:"hidden",width:shape.props.w,height:shape.props.h+props.growY},children:(0,jsx_runtime.jsx)(RichTextLabel,{shapeId:id,type,font,fontSize:LABEL_FONT_SIZES[size]*shape.props.scale,lineHeight:TEXT_PROPS.lineHeight,padding:LABEL_PADDING*shape.props.scale,fill,align,verticalAlign,richText,isSelected:isOnlySelected,labelColor:theme[props.labelColor].solid,wrap:!0})}),shape.props.url&&(0,jsx_runtime.jsx)(HyperlinkButton,{url:shape.props.url})]})}indicator(shape){const path=function getIndicatorPath(shape,geometry,isZoomedOut){const{id}=shape,{w,size,geo,dash,scale,growY}=shape.props,strokeWidth=default_shape_constants_STROKE_SIZES[size],h=shape.props.h+growY;switch(geo){case"ellipse":return"draw"===dash?getEllipseDrawIndicatorPath(id,w,h,strokeWidth):geometry.getSvgPathData(!0);case"heart":return getHeartPath(w,h);case"oval":return geometry.getSvgPathData(!0);case"cloud":return getCloudPath(w,h,id,size,shape.props.scale);default:{const outline=geometry instanceof dist_esm.IQE?geometry.children[0].vertices:geometry.vertices;let path;if("draw"!==dash||isZoomedOut)path="M"+outline[0]+"L"+outline.slice(1)+"Z";else{path=getRoundedInkyPolygonPath(getRoundedPolygonPoints(id,outline,0,2*strokeWidth*scale,1))}const lines=getLines(shape.props,strokeWidth);if(lines)for(const[A,B]of lines)path+=`M${A.x},${A.y}L${B.x},${B.y}`;return path}}}(shape,this.editor.getShapeGeometry(shape),(0,dist_esm.hau)("isZoomedOut",(()=>this.editor.getZoomLevel()<.25),[this.editor]));return(0,jsx_runtime.jsx)("path",{d:path})}toSvg(shape,ctx){const newShape={...shape,props:{...shape.props,w:shape.props.w/shape.props.scale,h:shape.props.h/shape.props.scale}},props=newShape.props;let textEl;if(ctx.addExportDef(getFillDefForExport(props.fill)),!isEmptyRichText(props.richText)){const theme=(0,dist_esm.AnR)(ctx),bounds=new dist_esm.azJ(0,0,props.w,props.h+props.growY);textEl=(0,jsx_runtime.jsx)(RichTextSVG,{fontSize:LABEL_FONT_SIZES[props.size],font:props.font,align:props.align,verticalAlign:props.verticalAlign,richText:props.richText,labelColor:theme[props.labelColor].solid,bounds,padding:LABEL_PADDING*shape.props.scale})}return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(GeoShapeBody,{shouldScale:!1,shape:newShape,forceSolid:!1}),textEl]})}getCanvasSvgDefs(){return[getFillDefForCanvas()]}onResize(shape,{handle,newPoint,scaleX,scaleY,initialShape}){let unscaledW=initialShape.props.w/initialShape.props.scale*scaleX,unscaledH=(initialShape.props.h/initialShape.props.scale+initialShape.props.growY/initialShape.props.scale)*scaleY,overShrinkX=0,overShrinkY=0;if(!isEmptyRichText(shape.props.richText)){let newW=Math.max(Math.abs(unscaledW),51),newH=Math.max(Math.abs(unscaledH),51);newW<51&&51===newH&&(newW=51),51===newW&&newH<51&&(newH=51);const unscaledLabelSize=getUnscaledLabelSize(this.editor,{...shape,props:{...shape.props,w:newW*shape.props.scale,h:newH*shape.props.scale}}),nextW=Math.max(Math.abs(unscaledW),unscaledLabelSize.w)*Math.sign(unscaledW),nextH=Math.max(Math.abs(unscaledH),unscaledLabelSize.h)*Math.sign(unscaledH);overShrinkX=Math.abs(nextW)-Math.abs(unscaledW),overShrinkY=Math.abs(nextH)-Math.abs(unscaledH),unscaledW=nextW,unscaledH=nextH}const scaledW=unscaledW*shape.props.scale,scaledH=unscaledH*shape.props.scale,offset=new dist_esm.l2P(0,0);scaleX<0&&(offset.x+=scaledW),"left"!==handle&&"top_left"!==handle&&"bottom_left"!==handle||(offset.x+=scaleX<0?overShrinkX:-overShrinkX),scaleY<0&&(offset.y+=scaledH),"top"!==handle&&"top_left"!==handle&&"top_right"!==handle||(offset.y+=scaleY<0?overShrinkY:-overShrinkY);const{x,y}=offset.rot(shape.rotation).add(newPoint);return{x,y,props:{w:Math.max(Math.abs(scaledW),1),h:Math.max(Math.abs(scaledH),1),growY:0}}}onBeforeCreate(shape){if(isEmptyRichText(shape.props.richText))return shape.props.growY?{...shape,props:{...shape.props,growY:0}}:void 0;const unscaledPrevHeight=shape.props.h/shape.props.scale,unscaledNextHeight=getUnscaledLabelSize(this.editor,shape).h;let growY=null;return unscaledNextHeight>unscaledPrevHeight?growY=unscaledNextHeight-unscaledPrevHeight:shape.props.growY&&(growY=0),null!==growY?{...shape,props:{...shape.props,growY:growY*shape.props.scale}}:void 0}onBeforeUpdate(prev,next){if(lodash_isequal_default()(prev.props.richText,next.props.richText)&&prev.props.font===next.props.font&&prev.props.size===next.props.size)return;const wasEmpty=isEmptyRichText(prev.props.richText),isEmpty=isEmptyRichText(next.props.richText);if(!wasEmpty&&isEmpty)return{...next,props:{...next.props,growY:0}};const unscaledPrevWidth=prev.props.w/prev.props.scale,unscaledPrevHeight=prev.props.h/prev.props.scale,unscaledPrevGrowY=prev.props.growY/prev.props.scale,unscaledNextLabelSize=getUnscaledLabelSize(this.editor,next);if(wasEmpty&&!isEmpty&&renderPlaintextFromRichText(this.editor,next.props.richText)){let unscaledW=Math.max(unscaledPrevWidth,unscaledNextLabelSize.w),unscaledH=Math.max(unscaledPrevHeight,unscaledNextLabelSize.h);const min=51;return unscaledPrevWidth<min&&unscaledPrevHeight<min&&(unscaledW=Math.max(unscaledW,min),unscaledH=Math.max(unscaledH,min),unscaledW=Math.max(unscaledW,unscaledH),unscaledH=Math.max(unscaledW,unscaledH)),{...next,props:{...next.props,w:unscaledW*next.props.scale,h:unscaledH*next.props.scale,growY:0}}}let growY=null;if(unscaledNextLabelSize.h>unscaledPrevHeight?growY=unscaledNextLabelSize.h-unscaledPrevHeight:unscaledPrevGrowY&&(growY=0),null!==growY){const unscaledNextWidth=next.props.w/next.props.scale;return{...next,props:{...next.props,growY:growY*next.props.scale,w:Math.max(unscaledNextWidth,unscaledNextLabelSize.w)*next.props.scale}}}return unscaledNextLabelSize.w>unscaledPrevWidth?{...next,props:{...next.props,w:unscaledNextLabelSize.w*next.props.scale}}:void 0}onDoubleClick(shape){if(this.editor.inputs.altKey)switch(shape.props.geo){case"rectangle":return{...shape,props:{geo:"check-box"}};case"check-box":return{...shape,props:{geo:"rectangle"}}}}getInterpolatedProps(startShape,endShape,t){return{...t>.5?endShape.props:startShape.props,w:(0,dist_esm.CcK)(startShape.props.w,endShape.props.w,t),h:(0,dist_esm.CcK)(startShape.props.h,endShape.props.h,t),scale:(0,dist_esm.CcK)(startShape.props.scale,endShape.props.scale,t)}}}function getUnscaledLabelSize(editor,shape){const{richText,font,size,w}=shape.props;if(!richText||isEmptyRichText(richText))return{w:0,h:0};const minSize=editor.textMeasure.measureText("w",{...TEXT_PROPS,fontFamily:FONT_FAMILIES[font],fontSize:LABEL_FONT_SIZES[size],maxWidth:100}),html=renderHtmlFromRichTextForMeasurement(editor,richText),textSize=editor.textMeasure.measureHtml(html,{...TEXT_PROPS,fontFamily:FONT_FAMILIES[font],fontSize:LABEL_FONT_SIZES[size],minWidth:minSize.w,maxWidth:Math.max(0,Math.ceil(minSize.w+{s:2,m:3.5,l:5,xl:10}[size]),Math.ceil(w/shape.props.scale-2*LABEL_PADDING))});return{w:textSize.w+2*LABEL_PADDING,h:textSize.h+2*LABEL_PADDING}}class HighlightShapeUtil extends dist_esm.inY{static type="highlight";static props=dist_esm.M60;static migrations=dist_esm.REO;options={maxPointsPerShape:600,underlayOpacity:.82,overlayOpacity:.35};canTabTo(){return!1}hideResizeHandles(shape){return HighlightShapeUtil_getIsDot(shape)}hideRotateHandle(shape){return HighlightShapeUtil_getIsDot(shape)}hideSelectionBoundsFg(shape){return HighlightShapeUtil_getIsDot(shape)}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(shape){const strokeWidth=getStrokeWidth(shape);if(HighlightShapeUtil_getIsDot(shape))return new dist_esm.PUi({x:-strokeWidth/2,y:-strokeWidth/2,radius:strokeWidth/2,isFilled:!0});const{strokePoints,sw}=getHighlightStrokePoints(shape,strokeWidth,!0),opts=getHighlightFreehandSettings({strokeWidth:sw,showAsComplete:!0});return setStrokePointRadii(strokePoints,opts),new dist_esm.dxv({points:getStrokeOutlinePoints(strokePoints,opts),isFilled:!0})}component(shape){const forceSolid=useHighlightForceSolid(this.editor,shape),strokeWidth=getStrokeWidth(shape);return(0,jsx_runtime.jsx)(dist_esm.ULM,{children:(0,jsx_runtime.jsx)(HighlightRenderer,{shape,forceSolid,strokeWidth,opacity:this.options.overlayOpacity})})}backgroundComponent(shape){const forceSolid=useHighlightForceSolid(this.editor,shape),strokeWidth=getStrokeWidth(shape);return(0,jsx_runtime.jsx)(dist_esm.ULM,{children:(0,jsx_runtime.jsx)(HighlightRenderer,{shape,forceSolid,strokeWidth,opacity:this.options.underlayOpacity})})}indicator(shape){const forceSolid=useHighlightForceSolid(this.editor,shape),strokeWidth=getStrokeWidth(shape),{strokePoints,sw}=getHighlightStrokePoints(shape,strokeWidth,forceSolid),allPointsFromSegments=getPointsFromSegments(shape.props.segments);let strokePath;return strokePath=strokePoints.length<2?function getIndicatorDot(point,sw){const r=sw/2;return`M ${point.x} ${point.y} m -${r}, 0 a ${r},${r} 0 1,0 ${2*r},0 a ${r},${r} 0 1,0 -${2*r},0`}(allPointsFromSegments[0],sw):getSvgPathFromStrokePoints(strokePoints,!1),(0,jsx_runtime.jsx)("path",{d:strokePath})}toSvg(shape){const strokeWidth=getStrokeWidth(shape),forceSolid=strokeWidth<1.5,scaleFactor=1/shape.props.scale;return(0,jsx_runtime.jsx)("g",{transform:`scale(${scaleFactor})`,children:(0,jsx_runtime.jsx)(HighlightRenderer,{forceSolid,strokeWidth,shape,opacity:this.options.overlayOpacity})})}toBackgroundSvg(shape){const strokeWidth=getStrokeWidth(shape),forceSolid=strokeWidth<1.5,scaleFactor=1/shape.props.scale;return(0,jsx_runtime.jsx)("g",{transform:`scale(${scaleFactor})`,children:(0,jsx_runtime.jsx)(HighlightRenderer,{forceSolid,strokeWidth,shape,opacity:this.options.underlayOpacity})})}onResize(shape,info){const{scaleX,scaleY}=info,newSegments=[];for(const segment of shape.props.segments)newSegments.push({...segment,points:segment.points.map((({x,y,z})=>({x:scaleX*x,y:scaleY*y,z})))});return{props:{segments:newSegments}}}getInterpolatedProps(startShape,endShape,t){return{...t>.5?endShape.props:startShape.props,...endShape.props,segments:interpolateSegments(startShape.props.segments,endShape.props.segments,t),scale:(0,dist_esm.CcK)(startShape.props.scale,endShape.props.scale,t)}}}function getHighlightStrokePoints(shape,strokeWidth,forceSolid){const allPointsFromSegments=getPointsFromSegments(shape.props.segments),showAsComplete=shape.props.isComplete||"straight"===(0,dist_esm.HVh)(shape.props.segments)?.type;let sw=strokeWidth;forceSolid||shape.props.isPen||1!==allPointsFromSegments.length||(sw+=(0,dist_esm.She)(shape.id)()*(strokeWidth/6));return{strokePoints:getStrokePoints(allPointsFromSegments,getHighlightFreehandSettings({strokeWidth:sw,showAsComplete})),sw}}function getStrokeWidth(shape){return 1.12*FONT_SIZES[shape.props.size]*shape.props.scale}function HighlightShapeUtil_getIsDot(shape){return 1===shape.props.segments.length&&shape.props.segments[0].points.length<2}function HighlightRenderer({strokeWidth,forceSolid,shape,opacity}){const theme=useDefaultColorTheme(),allPointsFromSegments=getPointsFromSegments(shape.props.segments);let sw=strokeWidth;forceSolid||shape.props.isPen||1!==allPointsFromSegments.length||(sw+=(0,dist_esm.She)(shape.id)()*(sw/6));const strokePoints=getStrokePoints(allPointsFromSegments,getHighlightFreehandSettings({strokeWidth:sw,showAsComplete:shape.props.isComplete||"straight"===(0,dist_esm.HVh)(shape.props.segments)?.type})),solidStrokePath=strokePoints.length>1?getSvgPathFromStrokePoints(strokePoints,!1):function getShapeDot(point){return`M ${point.x} ${point.y} m -0.1, 0 a 0.1,0.1 0 1,0 0.2,0 a 0.1,0.1 0 1,0 -0.2,0`}(shape.props.segments[0].points[0]),colorSpace=function useColorSpace(){const[supportsP3,setSupportsP3]=(0,react.useState)(!1);return(0,react.useEffect)((()=>{const supportsSyntax=CSS.supports("color","color(display-p3 1 1 1)"),query=matchMedia("(color-gamut: p3)");setSupportsP3(supportsSyntax&&query.matches);const onChange=()=>setSupportsP3(supportsSyntax&&query.matches);return query.addEventListener("change",onChange),()=>query.removeEventListener("change",onChange)}),[]),(0,dist_esm.hau)(dist_esm.bGJ.forceSrgb)||!supportsP3?"srgb":"p3"}(),color=theme[shape.props.color].highlight[colorSpace];return(0,jsx_runtime.jsx)("path",{d:solidStrokePath,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:color,strokeWidth:sw,opacity})}function useHighlightForceSolid(editor,shape){return(0,dist_esm.hau)("forceSolid",(()=>getStrokeWidth(shape)/editor.getZoomLevel()<1.5),[editor])}function BrokenAssetIcon(){return(0,jsx_runtime.jsxs)("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,jsx_runtime.jsx)("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),(0,jsx_runtime.jsx)("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),(0,jsx_runtime.jsx)("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}const MIN_CROP_SIZE=8;function getUncroppedSize(shapeSize,crop){if(!crop)return{w:shapeSize.w,h:shapeSize.h};return{w:shapeSize.w/(crop.bottomRight.x-crop.topLeft.x),h:shapeSize.h/(crop.bottomRight.y-crop.topLeft.y)}}function getCropBox(shape,info,opts={}){const{handle,change,crop}=info,{w,h}=info.uncroppedSize,{minWidth=MIN_CROP_SIZE,minHeight=MIN_CROP_SIZE}=opts,newCrop=(0,dist_esm.pN9)(crop),newPoint=new dist_esm.l2P(shape.x,shape.y),pointDelta=new dist_esm.l2P(0,0);let hasCropChanged=!1;switch(handle){case"top":case"top_left":case"top_right":if(h<minHeight)break;hasCropChanged=!0,newCrop.topLeft.y=newCrop.topLeft.y+change.y/h;h*(newCrop.bottomRight.y-newCrop.topLeft.y)<minHeight?(newCrop.topLeft.y=newCrop.bottomRight.y-minHeight/h,pointDelta.y=(newCrop.topLeft.y-crop.topLeft.y)*h):newCrop.topLeft.y<=0?(newCrop.topLeft.y=0,pointDelta.y=(newCrop.topLeft.y-crop.topLeft.y)*h):pointDelta.y=change.y;break;case"bottom":case"bottom_left":case"bottom_right":if(h<minHeight)break;hasCropChanged=!0,newCrop.bottomRight.y=Math.min(1,newCrop.bottomRight.y+change.y/h);h*(newCrop.bottomRight.y-newCrop.topLeft.y)<minHeight&&(newCrop.bottomRight.y=newCrop.topLeft.y+minHeight/h);break}switch(handle){case"left":case"top_left":case"bottom_left":if(w<minWidth)break;hasCropChanged=!0,newCrop.topLeft.x=newCrop.topLeft.x+change.x/w;w*(newCrop.bottomRight.x-newCrop.topLeft.x)<minWidth?(newCrop.topLeft.x=newCrop.bottomRight.x-minWidth/w,pointDelta.x=(newCrop.topLeft.x-crop.topLeft.x)*w):newCrop.topLeft.x<=0?(newCrop.topLeft.x=0,pointDelta.x=(newCrop.topLeft.x-crop.topLeft.x)*w):pointDelta.x=change.x;break;case"right":case"top_right":case"bottom_right":if(w<minWidth)break;hasCropChanged=!0,newCrop.bottomRight.x=Math.min(1,newCrop.bottomRight.x+change.x/w);w*(newCrop.bottomRight.x-newCrop.topLeft.x)<minWidth&&(newCrop.bottomRight.x=newCrop.topLeft.x+minWidth/w);break}if(hasCropChanged)return newPoint.add(pointDelta.rot(shape.rotation)),{id:shape.id,type:shape.type,x:newPoint.x,y:newPoint.y,props:{w:(newCrop.bottomRight.x-newCrop.topLeft.x)*w,h:(newCrop.bottomRight.y-newCrop.topLeft.y)*h,crop:newCrop}}}function useImageOrVideoAsset({shapeId,assetId,width}){const editor=(0,dist_esm.hGv)(),exportInfo=(0,dist_esm.Jf5)(),exportIsReady=(0,dist_esm.lsV)(),[result,setResult]=(0,react.useState)((()=>({asset:assetId?editor.getAsset(assetId)??null:null,url:null}))),didAlreadyResolve=(0,react.useRef)(!1),previousUrl=(0,react.useRef)(null);return(0,react.useEffect)((()=>{if(!assetId)return;let cancelDebounceFn,isCancelled=!1;const cleanupEffectScheduler=(0,dist_esm.wvh)("update state",(()=>{if(!exportInfo&&shapeId&&editor.getCulledShapes().has(shapeId))return;const asset=editor.getAsset(assetId);if(!asset)return void setResult((prev=>({...prev,asset:null,url:null})));if(!asset.props.src){const preview=editor.getTemporaryAssetPreview(asset.id);if(preview)return void(previousUrl.current!==preview&&(previousUrl.current=preview,setResult((prev=>({...prev,isPlaceholder:!0,url:preview}))),exportIsReady()))}const screenScale=exportInfo?exportInfo.scale*(width/asset.props.w):editor.getZoomLevel()*(width/asset.props.w);function resolve(asset2,url){isCancelled||previousUrl.current!==url&&(didAlreadyResolve.current=!0,previousUrl.current=url,setResult({asset:asset2,url}),exportIsReady())}if(didAlreadyResolve.current){let tick=0;const resolveAssetAfterAWhile=()=>{tick++,tick>31.25&&(resolveAssetUrl(editor,assetId,screenScale,exportInfo,(url=>resolve(asset,url))),cancelDebounceFn?.())};cancelDebounceFn?.(),editor.on("tick",resolveAssetAfterAWhile),cancelDebounceFn=()=>editor.off("tick",resolveAssetAfterAWhile)}else resolveAssetUrl(editor,assetId,screenScale,exportInfo,(url=>resolve(asset,url)))}));return()=>{cleanupEffectScheduler(),cancelDebounceFn?.(),isCancelled=!0}}),[editor,assetId,exportInfo,exportIsReady,shapeId,width]),result}function resolveAssetUrl(editor,assetId,screenScale,exportInfo,callback){editor.resolveAssetUrl(assetId,{screenScale,shouldResolveToOriginal:!!exportInfo&&null===exportInfo.pixelRatio,dpr:exportInfo?.pixelRatio??void 0}).then((url=>{callback(url)}))}const imageSvgExportCache=new dist_esm.laH;class ImageShapeUtil extends dist_esm.A8{static type="image";static props=dist_esm.lXb;static migrations=dist_esm.UcL;isAspectRatioLocked(){return!0}canCrop(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1,altText:""}}getAriaDescriptor(shape){return shape.props.altText}onResize(shape,info){let resized=(0,dist_esm.mfH)(shape,info);const{flipX,flipY}=info.initialShape.props,{scaleX,scaleY,mode}=info;if(resized={...resized,props:{...resized.props,flipX:scaleX<0!==flipX,flipY:scaleY<0!==flipY}},!shape.props.crop)return resized;const flipCropHorizontally="scale_shape"===mode&&-1===scaleX||"resize_bounds"===mode&&flipX!==resized.props.flipX,flipCropVertically="scale_shape"===mode&&-1===scaleY||"resize_bounds"===mode&&flipY!==resized.props.flipY,{topLeft,bottomRight}=shape.props.crop;return resized.props.crop={topLeft:{x:flipCropHorizontally?1-bottomRight.x:topLeft.x,y:flipCropVertically?1-bottomRight.y:topLeft.y},bottomRight:{x:flipCropHorizontally?1-topLeft.x:bottomRight.x,y:flipCropVertically?1-topLeft.y:bottomRight.y}},resized}component(shape){return(0,jsx_runtime.jsx)(ImageShape,{shape})}indicator(shape){return this.editor.getCroppingShapeId()===shape.id?null:(0,jsx_runtime.jsx)("rect",{width:(0,dist_esm.WMC)(shape.props.w),height:(0,dist_esm.WMC)(shape.props.h)})}async toSvg(shape,ctx){if(!shape.props.assetId)return null;const asset=this.editor.getAsset(shape.props.assetId);if(!asset)return null;const{w}=getUncroppedSize(shape.props,shape.props.crop),src=await imageSvgExportCache.get(asset,(async()=>{let src2=await ctx.resolveAssetUrl(asset.id,w);if(!src2)return null;if((src2.startsWith("blob:")||src2.startsWith("http")||src2.startsWith("/")||src2.startsWith("./"))&&(src2=await async function getDataURIFromURL(url){const response=await(0,dist_esm.hdJ)(url),blob=await response.blob();return dist_esm.SmQ.blobToDataUrl(blob)}(src2)||""),getIsAnimated(this.editor,asset.id)){const{promise}=getFirstFrameOfAnimatedImage(src2);src2=await promise}return src2}));return src?(0,jsx_runtime.jsx)(SvgImage,{shape,src}):null}onDoubleClickEdge(shape){const props=shape.props;if(!props)return;if(this.editor.getCroppingShapeId()!==shape.id)return;const crop=(0,dist_esm.pN9)(props.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},{w,h}=getUncroppedSize(shape.props,crop),pointDelta=new dist_esm.l2P(crop.topLeft.x*w,crop.topLeft.y*h).rot(shape.rotation),partial={id:shape.id,type:shape.type,x:shape.x-pointDelta.x,y:shape.y-pointDelta.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w,h}};this.editor.updateShapes([partial])}getInterpolatedProps(startShape,endShape,t){return{...t>.5?endShape.props:startShape.props,w:(0,dist_esm.CcK)(startShape.props.w,endShape.props.w,t),h:(0,dist_esm.CcK)(startShape.props.h,endShape.props.h,t),crop:function interpolateCrop(startShape2,endShape2){if(null===startShape2.props.crop&&null===endShape2.props.crop)return null;const startTL=startShape2.props.crop?.topLeft||{x:0,y:0},startBR=startShape2.props.crop?.bottomRight||{x:1,y:1},endTL=endShape2.props.crop?.topLeft||{x:0,y:0},endBR=endShape2.props.crop?.bottomRight||{x:1,y:1};return{topLeft:{x:(0,dist_esm.CcK)(startTL.x,endTL.x,t),y:(0,dist_esm.CcK)(startTL.y,endTL.y,t)},bottomRight:{x:(0,dist_esm.CcK)(startBR.x,endBR.x,t),y:(0,dist_esm.CcK)(startBR.y,endBR.y,t)}}}(startShape,endShape)}}}const ImageShape=(0,react.memo)((function ImageShape2({shape}){const editor=(0,dist_esm.hGv)(),{w}=getUncroppedSize(shape.props,shape.props.crop),{asset,url}=useImageOrVideoAsset({shapeId:shape.id,assetId:shape.props.assetId,width:w}),prefersReducedMotion=usePrefersReducedMotion(),[staticFrameSrc,setStaticFrameSrc]=(0,react.useState)(""),[loadedUrl,setLoadedUrl]=(0,react.useState)(null),isAnimated=asset&&getIsAnimated(editor,asset.id);(0,react.useEffect)((()=>{if(url&&isAnimated){const{promise,cancel}=getFirstFrameOfAnimatedImage(url);return promise.then((dataUrl=>{setStaticFrameSrc(dataUrl),setLoadedUrl(url)})),()=>{cancel()}}}),[editor,isAnimated,prefersReducedMotion,url]);const showCropPreview=(0,dist_esm.hau)("show crop preview",(()=>shape.id===editor.getOnlySelectedShapeId()&&editor.getCroppingShapeId()===shape.id&&editor.isIn("select.crop")),[editor,shape.id]),reduceMotion=prefersReducedMotion&&(asset?.props.mimeType?.includes("video")||isAnimated),containerStyle=getCroppedContainerStyle(shape),nextSrc=url===loadedUrl?null:url,loadedSrc=reduceMotion?staticFrameSrc:loadedUrl;if(!url&&!asset?.props.src)return(0,jsx_runtime.jsxs)(dist_esm.hDc,{id:shape.id,style:{overflow:"hidden",width:shape.props.w,height:shape.props.h,color:"var(--color-text-3)",backgroundColor:"var(--color-low)",border:"1px solid var(--color-low-border)"},children:[(0,jsx_runtime.jsx)("div",{className:classnames_default()("tl-image-container",asset&&"tl-image-container-loading"),style:containerStyle,children:asset?null:(0,jsx_runtime.jsx)(BrokenAssetIcon,{})}),"url"in shape.props&&shape.props.url&&(0,jsx_runtime.jsx)(HyperlinkButton,{url:shape.props.url})]});const crossOrigin=isAnimated?"anonymous":void 0;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[showCropPreview&&loadedSrc&&(0,jsx_runtime.jsx)("div",{style:containerStyle,children:(0,jsx_runtime.jsx)("img",{className:"tl-image",style:{...getFlipStyle(shape),opacity:.1},crossOrigin,src:loadedSrc,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1})}),(0,jsx_runtime.jsxs)(dist_esm.hDc,{id:shape.id,style:{overflow:"hidden",width:shape.props.w,height:shape.props.h},children:[(0,jsx_runtime.jsxs)("div",{className:classnames_default()("tl-image-container"),style:containerStyle,children:[loadedSrc&&(0,jsx_runtime.jsx)("img",{className:"tl-image",style:getFlipStyle(shape),crossOrigin,src:loadedSrc,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1},loadedSrc),nextSrc&&(0,jsx_runtime.jsx)("img",{className:"tl-image",style:getFlipStyle(shape),crossOrigin,src:nextSrc,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,onLoad:()=>setLoadedUrl(nextSrc)},nextSrc)]}),shape.props.url&&(0,jsx_runtime.jsx)(HyperlinkButton,{url:shape.props.url})]})]})}));function getIsAnimated(editor,assetId){const asset=assetId?editor.getAsset(assetId):void 0;return!!asset&&("mimeType"in asset.props&&dist_esm.K4L.isAnimatedImageType(asset?.props.mimeType)||"isAnimated"in asset.props&&asset.props.isAnimated)}function getCroppedContainerStyle(shape){const crop=shape.props.crop,topLeft=crop?.topLeft;if(!topLeft)return{width:shape.props.w,height:shape.props.h};const{w,h}=getUncroppedSize(shape.props,crop);return{transform:`translate(${-topLeft.x*w}px, ${-topLeft.y*h}px)`,width:w,height:h}}function getFlipStyle(shape,size){const{flipX,flipY}=shape.props;if(!flipX&&!flipY)return;const scale=`scale(${flipX?-1:1}, ${flipY?-1:1})`;return{transform:`${size?`translate(${flipX?size.width:0}px, ${flipY?size.height:0}px)`:""} ${scale}`,transformOrigin:size?"0 0":"center center"}}function SvgImage({shape,src}){const cropClipId=(0,dist_esm.LsA)(),containerStyle=getCroppedContainerStyle(shape),crop=shape.props.crop;if(containerStyle.transform&&crop){const{transform:cropTransform,width,height}=containerStyle,croppedWidth=(crop.bottomRight.x-crop.topLeft.x)*width,croppedHeight=(crop.bottomRight.y-crop.topLeft.y)*height,points=[new dist_esm.l2P(0,0),new dist_esm.l2P(croppedWidth,0),new dist_esm.l2P(croppedWidth,croppedHeight),new dist_esm.l2P(0,croppedHeight)],flip=getFlipStyle(shape,{width,height});return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("defs",{children:(0,jsx_runtime.jsx)("clipPath",{id:cropClipId,children:(0,jsx_runtime.jsx)("polygon",{points:points.map((p=>`${p.x},${p.y}`)).join(" ")})})}),(0,jsx_runtime.jsx)("g",{clipPath:`url(#${cropClipId})`,children:(0,jsx_runtime.jsx)("image",{href:src,width,height,style:flip?{...flip,transform:`${cropTransform} ${flip.transform}`}:{transform:cropTransform}})})]})}return(0,jsx_runtime.jsx)("image",{href:src,width:shape.props.w,height:shape.props.h,style:getFlipStyle(shape,{width:shape.props.w,height:shape.props.h})})}function getFirstFrameOfAnimatedImage(url){let cancelled=!1;return{promise:new Promise((resolve=>{const image=(0,dist_esm._V3)();image.onload=()=>{if(cancelled)return;const canvas=document.createElement("canvas");canvas.width=image.width,canvas.height=image.height;const ctx=canvas.getContext("2d");ctx&&(ctx.drawImage(image,0,0),resolve(canvas.toDataURL()))},image.crossOrigin="anonymous",image.src=url})),cancel:()=>cancelled=!0}}function getLineDrawFreehandOptions(strokeWidth){return{size:strokeWidth,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function getLineStrokePoints(shape,spline,strokeWidth){return getStrokePoints(spline.vertices,getLineDrawFreehandOptions(strokeWidth))}function getLineDrawPath(shape,spline,strokeWidth){const stroke=function getLineDrawStrokeOutlinePoints(shape,spline,strokeWidth){const options=getLineDrawFreehandOptions(strokeWidth);return getStrokeOutlinePoints(setStrokePointRadii(getLineStrokePoints(0,spline,strokeWidth),options),options)}(0,spline,strokeWidth);return(0,dist_esm.JDT)(stroke)}function getDrawLinePathData(id,outline,strokeWidth){let innerPathData=`M ${(0,dist_esm.ulI)(outline[0])}L`,outerPathData2=`M ${(0,dist_esm.ulI)(outline[0])}L`;const offset=strokeWidth/3,roundness=2*strokeWidth,random=(0,dist_esm.She)(id);let p1,s1,p0=outline[0],s0=outline[0];for(let i=0,n=outline.length-1;i<n;i++){p1=outline[i+1],s1=dist_esm.l2P.AddXY(outline[i+1],random()*offset,random()*offset);const delta=dist_esm.l2P.Sub(p1,p0),distance=dist_esm.l2P.Len(delta),vector=dist_esm.l2P.Div(delta,distance).mul(Math.min(distance/4,roundness)),q0=dist_esm.l2P.Add(p0,vector),q1=dist_esm.l2P.Add(p1,vector.neg()),sDelta=dist_esm.l2P.Sub(s1,s0),sDistance=dist_esm.l2P.Len(sDelta),sVector=dist_esm.l2P.Div(sDelta,sDistance).mul(Math.min(sDistance/4,roundness)),sq0=dist_esm.l2P.Add(s0,sVector),sq1=dist_esm.l2P.Add(s1,sVector.neg());i===n-1?(innerPathData+=`${(0,dist_esm.ulI)(q0)}L ${(0,dist_esm.ulI)(p1)}`,outerPathData2+=`${(0,dist_esm.ulI)(sq0)}L ${(0,dist_esm.ulI)(s1)}`):(innerPathData+=`${(0,dist_esm.ulI)(q0)}L ${(0,dist_esm.ulI)(q1)}Q ${(0,dist_esm.ulI)(p1)}`,outerPathData2+=`${(0,dist_esm.ulI)(sq0)}L ${(0,dist_esm.ulI)(sq1)}Q ${(0,dist_esm.ulI)(s1)}`,p0=p1,s0=s1)}return[innerPathData,innerPathData+outerPathData2]}const handlesCache=new dist_esm.laH;class LineShapeUtil extends dist_esm.inY{static type="line";static props=dist_esm.e9l;static migrations=dist_esm.bT0;canTabTo(){return!1}hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsFg(){return!0}hideSelectionBoundsBg(){return!0}getDefaultProps(){const[start,end]=(0,dist_esm.uud)(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[start]:{id:start,index:start,x:0,y:0},[end]:{id:end,index:end,x:.1,y:.1}},scale:1}}getGeometry(shape){return getGeometryForLineShape(shape)}getHandles(shape){return handlesCache.get(shape.props,(()=>{const spline=getGeometryForLineShape(shape),points=linePointsToArray(shape),results=points.map((point=>({...point,id:point.index,type:"vertex",canSnap:!0})));for(let i=0;i<points.length-1;i++){const index=(0,dist_esm.HEt)(points[i].index,points[i+1].index),point=spline.segments[i].midPoint();results.push({id:index,type:"create",index,x:point.x,y:point.y,canSnap:!0})}return results.sort(dist_esm.Ky)}))}onResize(shape,info){const{scaleX,scaleY}=info;return{props:{points:(0,dist_esm._Hz)(shape.props.points,((_,{id,index,x,y})=>({id,index,x:x*scaleX,y:y*scaleY})))}}}onBeforeCreate(next){const{props:{points}}=next,pointKeys=Object.keys(points);if(pointKeys.length<2)return;const firstPoint=points[pointKeys[0]];if(pointKeys.every((key=>{const point=points[key];return point.x===firstPoint.x&&point.y===firstPoint.y}))){const lastKey=pointKeys[pointKeys.length-1];return points[lastKey]={...points[lastKey],x:points[lastKey].x+.1,y:points[lastKey].y+.1},next}}onHandleDrag(shape,{handle}){if("vertex"!==handle.type)return;const newPoint=(0,dist_esm.Y8F)(new dist_esm.l2P(handle.x,handle.y),this.editor);return{...shape,props:{...shape.props,points:{...shape.props.points,[handle.id]:{id:handle.id,index:handle.index,x:newPoint.x,y:newPoint.y}}}}}component(shape){return(0,jsx_runtime.jsx)(dist_esm.ULM,{style:{minWidth:50,minHeight:50},children:(0,jsx_runtime.jsx)(LineShapeSvg,{shape})})}indicator(shape){const strokeWidth=STROKE_SIZES[shape.props.size]*shape.props.scale,spline=getGeometryForLineShape(shape),{dash}=shape.props;let path;if("line"===shape.props.spline){const outline=spline.points;if("solid"===dash||"dotted"===dash||"dashed"===dash)path="M"+outline[0]+"L"+outline.slice(1);else{const[innerPathData]=getDrawLinePathData(shape.id,outline,strokeWidth);path=innerPathData}}else path=function getLineIndicatorPath(shape,spline,strokeWidth){if("draw"===shape.props.dash)return getSvgPathFromStrokePoints(getLineStrokePoints(0,spline,strokeWidth));return spline.getSvgPathData()}(shape,spline,strokeWidth);return(0,jsx_runtime.jsx)("path",{d:path})}toSvg(shape){return(0,jsx_runtime.jsx)(LineShapeSvg,{shouldScale:!0,shape})}getHandleSnapGeometry(shape){const points=linePointsToArray(shape);return{points,getSelfSnapPoints:handle=>{const index=this.getHandles(shape).filter((h=>"vertex"===h.type)).findIndex((h=>h.id===handle.id));return points.filter(((_,i)=>Math.abs(i-index)>1)).map(dist_esm.l2P.From)},getSelfSnapOutline:handle=>{const index=this.getHandles(shape).filter((h=>"vertex"===h.type)).findIndex((h=>h.id===handle.id)),segments=getGeometryForLineShape(shape).segments.filter(((_,i)=>i!==index-1&&i!==index));return segments.length?new dist_esm.IQE({children:segments}):null}}}getInterpolatedProps(startShape,endShape,t){const startPoints=linePointsToArray(startShape),endPoints=linePointsToArray(endShape),pointsToUseStart=[],pointsToUseEnd=[];let index=dist_esm.as9;if(startPoints.length>endPoints.length)for(let i=0;i<startPoints.length;i++)pointsToUseStart[i]={...startPoints[i]},void 0===endPoints[i]?pointsToUseEnd[i]={...endPoints[endPoints.length-1],id:index}:pointsToUseEnd[i]={...endPoints[i],id:index},index=(0,dist_esm.AQy)(index);else if(endPoints.length>startPoints.length)for(let i=0;i<endPoints.length;i++)pointsToUseEnd[i]={...endPoints[i]},void 0===startPoints[i]?pointsToUseStart[i]={...startPoints[startPoints.length-1],id:index}:pointsToUseStart[i]={...startPoints[i],id:index},index=(0,dist_esm.AQy)(index);else for(let i=0;i<endPoints.length;i++)pointsToUseStart[i]=startPoints[i],pointsToUseEnd[i]=endPoints[i];return{...t>.5?endShape.props:startShape.props,points:Object.fromEntries(pointsToUseStart.map(((point,i)=>{const endPoint=pointsToUseEnd[i];return[point.id,{...point,x:(0,dist_esm.CcK)(point.x,endPoint.x,t),y:(0,dist_esm.CcK)(point.y,endPoint.y,t)}]}))),scale:(0,dist_esm.CcK)(startShape.props.scale,endShape.props.scale,t)}}}function linePointsToArray(shape){return Object.values(shape.props.points).sort(dist_esm.Ky)}function getGeometryForLineShape(shape){const points=linePointsToArray(shape).map(dist_esm.l2P.From);switch(shape.props.spline){case"cubic":return new dist_esm.M8g({points});case"line":return new dist_esm.Hes({points})}}function LineShapeSvg({shape,shouldScale=!1,forceSolid=!1}){const theme=useDefaultColorTheme(),spline=getGeometryForLineShape(shape),{dash,color,size}=shape.props,scaleFactor=1/shape.props.scale,scale=shouldScale?scaleFactor:1,strokeWidth=STROKE_SIZES[size]*shape.props.scale;if("line"===shape.props.spline){if("solid"===dash){const outline=spline.points,pathData="M"+outline[0]+"L"+outline.slice(1);return(0,jsx_runtime.jsx)("path",{d:pathData,stroke:theme[color].solid,strokeWidth,fill:"none",transform:`scale(${scale})`})}if("dashed"===dash||"dotted"===dash)return(0,jsx_runtime.jsx)("g",{stroke:theme[color].solid,strokeWidth,transform:`scale(${scale})`,children:spline.segments.map(((segment,i)=>{const{strokeDasharray,strokeDashoffset}=forceSolid?{strokeDasharray:"none",strokeDashoffset:"none"}:(0,dist_esm.EK8)(segment.length,strokeWidth,{style:dash,start:i>0?"outset":"none",end:i<spline.segments.length-1?"outset":"none"});return(0,jsx_runtime.jsx)("path",{strokeDasharray,strokeDashoffset,d:segment.getSvgPathData(!0),fill:"none"},i)}))});if("draw"===dash){const outline=spline.points,[_,outerPathData]=getDrawLinePathData(shape.id,outline,strokeWidth);return(0,jsx_runtime.jsx)("path",{d:outerPathData,stroke:theme[color].solid,strokeWidth,fill:"none",transform:`scale(${scale})`})}}if("cubic"===shape.props.spline){const splinePath=spline.getSvgPathData();if("solid"===dash)return(0,jsx_runtime.jsx)("path",{strokeWidth,stroke:theme[color].solid,fill:"none",d:splinePath,transform:`scale(${scale})`});if("dashed"===dash||"dotted"===dash)return(0,jsx_runtime.jsx)("g",{stroke:theme[color].solid,strokeWidth,transform:`scale(${scale})`,children:spline.segments.map(((segment,i)=>{const{strokeDasharray,strokeDashoffset}=(0,dist_esm.EK8)(segment.length,strokeWidth,{style:dash,start:i>0?"outset":"none",end:i<spline.segments.length-1?"outset":"none",forceSolid});return(0,jsx_runtime.jsx)("path",{strokeDasharray,strokeDashoffset,d:segment.getSvgPathData(),fill:"none"},i)}))});if("draw"===dash)return(0,jsx_runtime.jsx)("path",{d:getLineDrawPath(0,spline,strokeWidth),strokeWidth:1,stroke:theme[color].solid,fill:theme[color].solid,transform:`scale(${scale})`})}}class NoteShapeUtil extends dist_esm.inY{static type="note";static props=dist_esm.SWg;static migrations=dist_esm.fq3;options={resizeMode:"none"};canEdit(){return!0}hideResizeHandles(){const{resizeMode}=this.options;switch(resizeMode){case"none":return!0;case"scale":return!1;default:throw(0,dist_esm.h6G)(resizeMode)}}isAspectRatioLocked(){return"scale"===this.options.resizeMode}hideSelectionBoundsFg(){return!1}getDefaultProps(){return{color:"black",richText:(0,dist_esm.TP3)(""),size:"m",font:"draw",align:"middle",verticalAlign:"middle",labelColor:"black",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(shape){const{labelHeight,labelWidth}=getLabelSize(this.editor,shape),{scale}=shape.props,lh=labelHeight*scale,lw=labelWidth*scale,nw=NOTE_SIZE*scale,nh=getNoteHeight(shape);return new dist_esm.IQE({children:[new dist_esm.krb({width:nw,height:nh,isFilled:!0}),new dist_esm.krb({x:"start"===shape.props.align?0:"end"===shape.props.align?nw-lw:(nw-lw)/2,y:"start"===shape.props.verticalAlign?0:"end"===shape.props.verticalAlign?nh-lh:(nh-lh)/2,width:lw,height:lh,isFilled:!0,isLabel:!0})]})}getHandles(shape){const{scale}=shape.props;if(this.editor.getInstanceState().isCoarsePointer)return[];const zoom=this.editor.getZoomLevel();if(zoom*scale<.25)return[];const nh=getNoteHeight(shape),nw=NOTE_SIZE*scale,offset=0/zoom*scale;return zoom*scale<.5?[{id:"bottom",index:"a3",type:"clone",x:nw/2,y:nh+offset}]:[{id:"top",index:"a1",type:"clone",x:nw/2,y:-offset},{id:"right",index:"a2",type:"clone",x:nw+offset,y:nh/2},{id:"bottom",index:"a3",type:"clone",x:nw/2,y:nh+offset},{id:"left",index:"a4",type:"clone",x:-offset,y:nh/2}]}onResize(shape,info){const{resizeMode}=this.options;switch(resizeMode){case"none":return;case"scale":return(0,dist_esm.d5$)(shape,info);default:throw(0,dist_esm.h6G)(resizeMode)}}getText(shape){return renderPlaintextFromRichText(this.editor,shape.props.richText)}getFontFaces(shape){return(0,dist_esm.EYW)(this.editor,shape.props.richText,{family:`tldraw_${shape.props.font}`,weight:"normal",style:"normal"})}component(shape){const{id,type,props:{labelColor,scale,color,font,size,align,richText,verticalAlign,fontSizeAdjustment}}=shape,handleKeyDown=function useNoteKeydownHandler(id){const editor=(0,dist_esm.hGv)(),translation=useCurrentTranslation();return(0,react.useCallback)((e=>{const shape=editor.getShape(id);if(!shape)return;const isTab="Tab"===e.key,isCmdEnter=(e.metaKey||e.ctrlKey)&&"Enter"===e.key;if(isTab||isCmdEnter){e.preventDefault();const pageTransform=editor.getShapePageTransform(id),pageRotation=pageTransform.rotation(),isRTL=!("rtl"!==translation.dir&&!isRightToLeftLanguage(renderPlaintextFromRichText(editor,shape.props.richText))),offsetLength=(NOTE_SIZE+editor.options.adjacentShapeMargin+(isCmdEnter&&!e.shiftKey?shape.props.growY:0))*shape.props.scale,adjacentCenter=new dist_esm.l2P(isTab?e.shiftKey!=isRTL?-1:1:0,isCmdEnter?e.shiftKey?-1:1:0).mul(offsetLength).add(NOTE_CENTER_OFFSET.clone().mul(shape.props.scale)).rot(pageRotation).add(pageTransform.point()),newNote=getNoteShapeForAdjacentPosition(editor,shape,adjacentCenter,pageRotation);newNote&&(editor.markHistoryStoppingPoint("editing adjacent shape"),startEditingShapeWithLabel(editor,newNote,!0))}}),[id,editor,translation.dir])}(id),theme=useDefaultColorTheme(),nw=NOTE_SIZE*scale,nh=getNoteHeight(shape),rotation=(0,dist_esm.hau)("shape rotation",(()=>this.editor.getShapePageTransform(id)?.rotation()??0),[this.editor]),hideShadows=(0,dist_esm.hau)("zoom",(()=>this.editor.getZoomLevel()<.35/scale),[scale,this.editor]),isDarkMode=(0,dist_esm.hau)("dark mode",(()=>this.editor.user.getIsDarkMode()),[this.editor]),isSelected=shape.id===this.editor.getOnlySelectedShapeId(),isReadyForEditing=useIsReadyForEditing(this.editor,shape.id),isEmpty=isEmptyRichText(richText);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{id,className:"tl-note__container",style:{width:nw,height:nh,backgroundColor:theme[color].note.fill,borderBottom:hideShadows?isDarkMode?2*scale+"px solid rgb(20, 20, 20)":2*scale+"px solid rgb(144, 144, 144)":"none",boxShadow:hideShadows?"none":getNoteShadow(shape.id,rotation,scale)},children:(isSelected||isReadyForEditing||!isEmpty)&&(0,jsx_runtime.jsx)(RichTextLabel,{shapeId:id,type,font,fontSize:(fontSizeAdjustment||LABEL_FONT_SIZES[size])*scale,lineHeight:TEXT_PROPS.lineHeight,align,verticalAlign,richText,isSelected,labelColor:"black"===labelColor?theme[color].note.text:theme[labelColor].fill,wrap:!0,padding:LABEL_PADDING*scale,hasCustomTabBehavior:!0,onKeyDown:handleKeyDown})}),"url"in shape.props&&shape.props.url&&(0,jsx_runtime.jsx)(HyperlinkButton,{url:shape.props.url})]})}indicator(shape){const{scale}=shape.props;return(0,jsx_runtime.jsx)("rect",{rx:scale,width:(0,dist_esm.WMC)(NOTE_SIZE*scale),height:(0,dist_esm.WMC)(getNoteHeight(shape))})}toSvg(shape,ctx){const theme=(0,dist_esm.AnR)({isDarkMode:ctx.isDarkMode}),bounds=function getBoundsForSVG(shape){return new dist_esm.azJ(0,0,NOTE_SIZE,NOTE_SIZE+shape.props.growY)}(shape),textLabel=(0,jsx_runtime.jsx)(RichTextSVG,{fontSize:shape.props.fontSizeAdjustment||LABEL_FONT_SIZES[shape.props.size],font:shape.props.font,align:shape.props.align,verticalAlign:shape.props.verticalAlign,richText:shape.props.richText,labelColor:theme[shape.props.color].note.text,bounds,padding:LABEL_PADDING*shape.props.scale});return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("rect",{x:5,y:5,rx:1,width:NOTE_SIZE-10,height:bounds.h,fill:"rgba(0,0,0,.1)"}),(0,jsx_runtime.jsx)("rect",{rx:1,width:NOTE_SIZE,height:bounds.h,fill:theme[shape.props.color].note.fill}),textLabel]})}onBeforeCreate(next){return getNoteSizeAdjustments(this.editor,next)}onBeforeUpdate(prev,next){if(!lodash_isequal_default()(prev.props.richText,next.props.richText)||prev.props.font!==next.props.font||prev.props.size!==next.props.size)return getNoteSizeAdjustments(this.editor,next)}getInterpolatedProps(startShape,endShape,t){return{...t>.5?endShape.props:startShape.props,scale:(0,dist_esm.CcK)(startShape.props.scale,endShape.props.scale,t)}}}function getNoteSizeAdjustments(editor,shape){const{labelHeight,fontSizeAdjustment}=getLabelSize(editor,shape),growY=Math.max(0,labelHeight-NOTE_SIZE);if(growY!==shape.props.growY||fontSizeAdjustment!==shape.props.fontSizeAdjustment)return{...shape,props:{...shape.props,growY,fontSizeAdjustment}}}const labelSizesForNote=new dist_esm.laH;function getLabelSize(editor,shape){return labelSizesForNote.get(shape,(()=>function getNoteLabelSize(editor,shape){const{richText}=shape.props;if(isEmptyRichText(richText))return{labelHeight:LABEL_FONT_SIZES[shape.props.size]*TEXT_PROPS.lineHeight+2*LABEL_PADDING,labelWidth:100,fontSizeAdjustment:0};const unadjustedFontSize=LABEL_FONT_SIZES[shape.props.size];let fontSizeAdjustment=0,iterations=0,labelHeight=NOTE_SIZE,labelWidth=NOTE_SIZE;do{fontSizeAdjustment=Math.min(unadjustedFontSize,unadjustedFontSize-iterations);const html=renderHtmlFromRichTextForMeasurement(editor,richText),nextTextSize=editor.textMeasure.measureHtml(html,{...TEXT_PROPS,fontFamily:FONT_FAMILIES[shape.props.font],fontSize:fontSizeAdjustment,maxWidth:NOTE_SIZE-2*LABEL_PADDING-1,disableOverflowWrapBreaking:!0});if(labelHeight=nextTextSize.h+2*LABEL_PADDING,labelWidth=nextTextSize.w+2*LABEL_PADDING,fontSizeAdjustment<=14){const html2=renderHtmlFromRichTextForMeasurement(editor,richText),nextTextSizeWithOverflowBreak=editor.textMeasure.measureHtml(html2,{...TEXT_PROPS,fontFamily:FONT_FAMILIES[shape.props.font],fontSize:fontSizeAdjustment,maxWidth:NOTE_SIZE-2*LABEL_PADDING-1});labelHeight=nextTextSizeWithOverflowBreak.h+2*LABEL_PADDING,labelWidth=nextTextSizeWithOverflowBreak.w+2*LABEL_PADDING;break}if(nextTextSize.scrollWidth.toFixed(0)===nextTextSize.w.toFixed(0))break}while(iterations++<50);return{labelHeight,labelWidth,fontSizeAdjustment}}(editor,shape)))}function getNoteHeight(shape){return(NOTE_SIZE+shape.props.growY)*shape.props.scale}function getNoteShadow(id,rotation,scale){const random=(0,dist_esm.She)(id),lift=Math.abs(random())+.5,oy=Math.cos(rotation),a=5*scale,b=4*scale,c=6*scale,d=7*scale;return`0px ${a-lift}px ${a}px -${a}px rgba(15, 23, 31, .6),\n\t0px ${(b+lift*d)*Math.max(0,oy)}px ${c+lift*d}px -${b+lift*c}px rgba(15, 23, 31, ${(.3+.1*lift).toFixed(2)}), \n\t0px ${48*scale}px ${10*scale}px -${10*scale}px inset rgba(15, 23, 44, ${((.022+.005*random())*((1+oy)/2)).toFixed(2)})`}const sizeCache=(0,dist_esm.uYT)("text size",((editor,shape)=>(editor.fonts.trackFontsForShape(shape),getTextSize(editor,shape.props))),{areRecordsEqual:(a,b)=>a.props===b.props});class TextShapeUtil extends dist_esm.inY{static type="text";static props=dist_esm.xjg;static migrations=dist_esm.E4k;options={extraArrowHorizontalPadding:10};getDefaultProps(){return{color:"black",size:"m",w:8,font:"draw",textAlign:"start",autoSize:!0,scale:1,richText:(0,dist_esm.TP3)("")}}getMinDimensions(shape){return sizeCache.get(this.editor,shape.id)}getGeometry(shape,opts){const{scale}=shape.props,{width,height}=this.getMinDimensions(shape),context=opts?.context??"none";return new dist_esm.krb({x:("@tldraw/arrow-without-arrowhead"===context?-this.options.extraArrowHorizontalPadding:0)*scale,width:(width+("@tldraw/arrow-without-arrowhead"===context?2*this.options.extraArrowHorizontalPadding:0))*scale,height:height*scale,isFilled:!0,isLabel:!0})}getFontFaces(shape){return(0,dist_esm.EYW)(this.editor,shape.props.richText,{family:`tldraw_${shape.props.font}`,weight:"normal",style:"normal"})}getText(shape){return renderPlaintextFromRichText(this.editor,shape.props.richText)}canEdit(){return!0}isAspectRatioLocked(){return!0}component(shape){const{id,props:{font,size,richText,color,scale,textAlign}}=shape,{width,height}=this.getMinDimensions(shape),isSelected=shape.id===this.editor.getOnlySelectedShapeId(),theme=useDefaultColorTheme(),handleKeyDown=function useTextShapeKeydownHandler(id){const editor=(0,dist_esm.hGv)();return(0,react.useCallback)((e=>{if(editor.getEditingShapeId()===id&&"Enter"===e.key)(e.ctrlKey||e.metaKey)&&editor.complete()}),[editor,id])}(id);return(0,jsx_runtime.jsx)(RichTextLabel,{shapeId:id,classNamePrefix:"tl-text-shape",type:"text",font,fontSize:FONT_SIZES[size],lineHeight:TEXT_PROPS.lineHeight,align:textAlign,verticalAlign:"middle",richText,labelColor:theme[color].solid,isSelected,textWidth:width,textHeight:height,style:{transform:`scale(${scale})`,transformOrigin:"top left"},wrap:!0,onKeyDown:handleKeyDown})}indicator(shape){const bounds=this.editor.getShapeGeometry(shape).bounds,editor=(0,dist_esm.hGv)();return shape.props.autoSize&&editor.getEditingShapeId()===shape.id?null:(0,jsx_runtime.jsx)("rect",{width:(0,dist_esm.WMC)(bounds.width),height:(0,dist_esm.WMC)(bounds.height)})}toSvg(shape,ctx){const bounds=this.editor.getShapeGeometry(shape).bounds,width=bounds.width/(shape.props.scale??1),height=bounds.height/(shape.props.scale??1),theme=(0,dist_esm.AnR)(ctx),exportBounds=new dist_esm.azJ(0,0,width,height);return(0,jsx_runtime.jsx)(RichTextSVG,{fontSize:FONT_SIZES[shape.props.size],font:shape.props.font,align:shape.props.textAlign,verticalAlign:"middle",richText:shape.props.richText,labelColor:theme[shape.props.color].solid,bounds:exportBounds,padding:0})}onResize(shape,info){const{newPoint,initialBounds,initialShape,scaleX,handle}=info;if("scale_shape"===info.mode||"right"!==handle&&"left"!==handle)return{id:shape.id,type:shape.type,...(0,dist_esm.d5$)(shape,info)};{const nextWidth=Math.max(1,Math.abs(initialBounds.width*scaleX)),{x,y}=scaleX<0?dist_esm.l2P.Sub(newPoint,dist_esm.l2P.FromAngle(shape.rotation).mul(nextWidth)):newPoint;return{id:shape.id,type:shape.type,x,y,props:{w:nextWidth/initialShape.props.scale,autoSize:!1}}}}onEditEnd(shape){0===renderPlaintextFromRichText(this.editor,shape.props.richText).trimEnd().length&&this.editor.deleteShapes([shape.id])}onBeforeUpdate(prev,next){if(!next.props.autoSize)return;const styleDidChange=prev.props.size!==next.props.size||prev.props.textAlign!==next.props.textAlign||prev.props.font!==next.props.font||1!==prev.props.scale&&1===next.props.scale,textDidChange=!lodash_isequal_default()(prev.props.richText,next.props.richText);if(!styleDidChange&&!textDidChange)return;const boundsA=this.getMinDimensions(prev),boundsB=getTextSize(this.editor,next.props),wA=boundsA.width*prev.props.scale,hA=boundsA.height*prev.props.scale,wB=boundsB.width*next.props.scale,hB=boundsB.height*next.props.scale;let delta;switch(next.props.textAlign){case"middle":delta=new dist_esm.l2P((wB-wA)/2,textDidChange?0:(hB-hA)/2);break;case"end":delta=new dist_esm.l2P(wB-wA,textDidChange?0:(hB-hA)/2);break;default:if(textDidChange)break;delta=new dist_esm.l2P(0,(hB-hA)/2)}if(delta){delta.rot(next.rotation);const{x,y}=next;return{...next,x:x-delta.x,y:y-delta.y,props:{...next.props,w:wB}}}return{...next,props:{...next.props,w:wB}}}}function getTextSize(editor,props){const{font,richText,autoSize,size,w}=props,minWidth=autoSize?16:Math.max(16,w),fontSize=FONT_SIZES[size],cw=autoSize?null:Math.floor(Math.max(minWidth,w)),html=renderHtmlFromRichTextForMeasurement(editor,richText),result=editor.textMeasure.measureHtml(html,{...TEXT_PROPS,fontFamily:FONT_FAMILIES[font],fontSize,maxWidth:cw});return autoSize&&(result.w+=1),{width:Math.max(minWidth,result.w),height:Math.max(fontSize,result.h)}}const videoSvgExportCache=new dist_esm.laH;class VideoShapeUtil extends dist_esm.A8{static type="video";static props=dist_esm.ZMy;static migrations=dist_esm.w9f;canEdit(){return!0}isAspectRatioLocked(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:"",altText:""}}getAriaDescriptor(shape){return shape.props.altText}component(shape){return(0,jsx_runtime.jsx)(VideoShape,{shape})}indicator(shape){return(0,jsx_runtime.jsx)("rect",{width:(0,dist_esm.WMC)(shape.props.w),height:(0,dist_esm.WMC)(shape.props.h)})}async toSvg(shape,ctx){if(!shape.props.assetId)return null;const asset=this.editor.getAsset(shape.props.assetId);if(!asset)return null;const src=await videoSvgExportCache.get(asset,(async()=>{const assetUrl=await ctx.resolveAssetUrl(asset.id,shape.props.w);if(!assetUrl)return null;const video=await dist_esm.K4L.loadVideo(assetUrl);return await dist_esm.K4L.getVideoFrameAsDataUrl(video,0)}));return src?(0,jsx_runtime.jsx)("image",{href:src,width:shape.props.w,height:shape.props.h}):null}}const VideoShape=(0,react.memo)((function VideoShape2({shape}){const editor=(0,dist_esm.hGv)(),showControls=editor.getShapeGeometry(shape).bounds.w*editor.getZoomLevel()>=110,isEditing=(0,dist_esm._As)(shape.id),prefersReducedMotion=usePrefersReducedMotion(),{Spinner}=(0,dist_esm.BSi)(),{asset,url}=useImageOrVideoAsset({shapeId:shape.id,assetId:shape.props.assetId,width:shape.props.w}),rVideo=(0,react.useRef)(null),[isLoaded,setIsLoaded]=(0,react.useState)(!1),[isFullscreen,setIsFullscreen]=(0,react.useState)(!1);(0,react.useEffect)((()=>{const fullscreenChange=()=>setIsFullscreen(document.fullscreenElement===rVideo.current);return document.addEventListener("fullscreenchange",fullscreenChange),()=>document.removeEventListener("fullscreenchange",fullscreenChange)}));const handleLoadedData=(0,react.useCallback)((e=>{e.currentTarget&&setIsLoaded(!0)}),[]);return(0,react.useEffect)((()=>{const video=rVideo.current;video&&isEditing&&document.activeElement!==video&&video.focus()}),[isEditing,isLoaded]),(0,react.useEffect)((()=>{if(prefersReducedMotion){const video=rVideo.current;if(!video)return;video.pause(),video.currentTime=0}}),[rVideo,prefersReducedMotion]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(dist_esm.hDc,{id:shape.id,style:{color:"var(--color-text-3)",backgroundColor:asset?"transparent":"var(--color-low)",border:asset?"none":"1px solid var(--color-low-border)"},children:(0,jsx_runtime.jsx)("div",{className:"tl-counter-scaled",children:(0,jsx_runtime.jsx)("div",{className:"tl-video-container",children:asset?Spinner&&!asset.props.src?(0,jsx_runtime.jsx)(Spinner,{}):url?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("video",{ref:rVideo,style:isEditing?{pointerEvents:"all"}:isLoaded?void 0:{display:"none"},className:classnames_default()("tl-video",`tl-video-shape-${shape.id.split(":")[1]}`,{"tl-video-is-fullscreen":isFullscreen}),width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:isEditing&&showControls,onLoadedData:handleLoadedData,hidden:!isLoaded,children:(0,jsx_runtime.jsx)("source",{src:url})}),!isLoaded&&Spinner&&(0,jsx_runtime.jsx)(Spinner,{})]}):null:(0,jsx_runtime.jsx)(BrokenAssetIcon,{})})})}),"url"in shape.props&&shape.props.url&&(0,jsx_runtime.jsx)(HyperlinkButton,{url:shape.props.url})]})})),defaultShapeUtils=[TextShapeUtil,BookmarkShapeUtil,DrawShapeUtil,GeoShapeUtil,NoteShapeUtil,LineShapeUtil,FrameShapeUtil,ArrowShapeUtil,HighlightShapeUtil,EmbedShapeUtil,ImageShapeUtil,VideoShapeUtil];class Erasing extends dist_esm.YM5{static id="erasing";info={};scribbleId="id";markId="";excludedShapeIds=new Set;onEnter(info){this.markId=this.editor.markHistoryStoppingPoint("erase scribble begin"),this.info=info;const{originPagePoint}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter((shape=>{if(this.editor.isShapeOrAncestorLocked(shape))return!0;if(this.editor.isShapeOfType(shape,"group")||this.editor.isShapeOfType(shape,"frame")){const pointInShapeShape=this.editor.getPointInShapeSpace(shape,originPagePoint);return this.editor.getShapeGeometry(shape).bounds.containsPoint(pointInShapeShape)}return!1})).map((shape=>shape.id)));const scribble=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=scribble.id,this.update()}pushPointToScribble(){const{x,y}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,x,y)}onExit(){this.editor.setErasingShapes([]),this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}update(){const{editor,excludedShapeIds}=this,erasingShapeIds=editor.getErasingShapeIds(),zoomLevel=editor.getZoomLevel(),currentPageShapes=editor.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint,previousPagePoint}}=editor;this.pushPointToScribble();const erasing=new Set(erasingShapeIds),minDist=this.editor.options.hitTestMargin/zoomLevel;for(const shape of currentPageShapes){if(editor.isShapeOfType(shape,"group"))continue;const pageMask=editor.getShapeMask(shape.id);if(pageMask&&!(0,dist_esm.s3y)(currentPagePoint,pageMask))continue;const geometry=editor.getShapeGeometry(shape),pageTransform=editor.getShapePageTransform(shape);if(!geometry||!pageTransform)continue;const pt=pageTransform.clone().invert(),A=pt.applyToPoint(previousPagePoint),B=pt.applyToPoint(currentPagePoint),{bounds}=geometry;bounds.minX-minDist>Math.max(A.x,B.x)||bounds.minY-minDist>Math.max(A.y,B.y)||bounds.maxX+minDist<Math.min(A.x,B.x)||bounds.maxY+minDist<Math.min(A.y,B.y)||geometry.hitTestLineSegment(A,B,minDist)&&erasing.add(editor.getOutermostSelectableShape(shape).id)}this.editor.setErasingShapes([...erasing].filter((id=>!excludedShapeIds.has(id))))}complete(){const{editor}=this;editor.deleteShapes(editor.getCurrentPageState().erasingShapeIds),this.parent.transition("idle")}cancel(){const{editor}=this;editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}}class childStates_Idle_Idle extends dist_esm.YM5{static id="idle";onPointerDown(info){this.parent.transition("pointing",info)}onCancel(){this.editor.setCurrentTool("select")}}class childStates_Pointing_Pointing extends dist_esm.YM5{static id="pointing";onEnter(){const zoomLevel=this.editor.getZoomLevel(),currentPageShapesSorted=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint}}=this.editor,erasing=new Set,initialSize=erasing.size;for(let i=currentPageShapesSorted.length-1;i>=0;i--){const shape=currentPageShapesSorted[i];if(!this.editor.isShapeOrAncestorLocked(shape)&&!this.editor.isShapeOfType(shape,"group")&&this.editor.isPointInShape(shape,currentPagePoint,{hitInside:!1,margin:this.editor.options.hitTestMargin/zoomLevel})){const hitShape=this.editor.getOutermostSelectableShape(shape);if(this.editor.isShapeOfType(hitShape,"frame")&&erasing.size>initialSize)break;erasing.add(hitShape.id)}}this.editor.setErasingShapes([...erasing])}onLongPress(info){this.startErasing(info)}onExit(_info,to){"erasing"!==to&&this.editor.setErasingShapes([])}onPointerMove(info){this.editor.inputs.isDragging&&this.startErasing(info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}startErasing(info){this.parent.transition("erasing",info)}complete(){const erasingShapeIds=this.editor.getErasingShapeIds();erasingShapeIds.length&&(this.editor.markHistoryStoppingPoint("erase end"),this.editor.deleteShapes(erasingShapeIds)),this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}class EraserTool extends dist_esm.YM5{static id="eraser";static initial="idle";static isLockable=!1;static children(){return[childStates_Idle_Idle,childStates_Pointing_Pointing,Erasing]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}class Dragging extends dist_esm.YM5{static id="dragging";initialCamera=new dist_esm.l2P;onEnter(){this.initialCamera=dist_esm.l2P.From(this.editor.getCamera()),this.update()}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.parent.transition("idle")}onComplete(){this.complete()}update(){const{initialCamera,editor}=this,{currentScreenPoint,originScreenPoint}=editor.inputs,delta=dist_esm.l2P.Sub(currentScreenPoint,originScreenPoint).div(editor.getZoomLevel());0!==delta.len2()&&editor.setCamera(initialCamera.clone().add(delta))}complete(){const{editor}=this,{pointerVelocity}=editor.inputs,velocityAtPointerUp=Math.min(pointerVelocity.len(),2);velocityAtPointerUp>.1&&this.editor.slideCamera({speed:velocityAtPointerUp,direction:pointerVelocity}),this.parent.transition("idle")}}class HandTool_childStates_Idle_Idle extends dist_esm.YM5{static id="idle";onEnter(){this.editor.setCursor({type:"grab",rotation:0})}onPointerDown(info){this.parent.transition("pointing",info)}onCancel(){this.editor.setCurrentTool("select")}}class HandTool_childStates_Pointing_Pointing extends dist_esm.YM5{static id="pointing";onEnter(){this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})}onLongPress(){this.startDragging()}onPointerMove(){this.editor.inputs.isDragging&&this.startDragging()}startDragging(){this.parent.transition("dragging")}onPointerUp(){this.complete()}onCancel(){this.complete()}onComplete(){this.complete()}onInterrupt(){this.complete()}complete(){this.parent.transition("idle")}}class HandTool extends dist_esm.YM5{static id="hand";static initial="idle";static isLockable=!1;static children(){return[HandTool_childStates_Idle_Idle,HandTool_childStates_Pointing_Pointing,Dragging]}onDoubleClick(info){if("settle"===info.phase){const{currentScreenPoint}=this.editor.inputs;this.editor.zoomIn(currentScreenPoint,{animation:{duration:220,easing:dist_esm.Z4H.easeOutQuint}})}}onTripleClick(info){if("settle"===info.phase){const{currentScreenPoint}=this.editor.inputs;this.editor.zoomOut(currentScreenPoint,{animation:{duration:320,easing:dist_esm.Z4H.easeOutQuint}})}}onQuadrupleClick(info){if("settle"===info.phase){const zoomLevel=this.editor.getZoomLevel(),{inputs:{currentScreenPoint}}=this.editor;1===zoomLevel?this.editor.zoomToFit({animation:{duration:400,easing:dist_esm.Z4H.easeOutQuint}}):this.editor.resetZoom(currentScreenPoint,{animation:{duration:320,easing:dist_esm.Z4H.easeOutQuint}})}}}class LaserTool_childStates_Idle_Idle extends dist_esm.YM5{static id="idle";onCancel(){this.editor.setCurrentTool("select")}onPointerDown(info){this.parent.transition("lasering",info)}}class Lasering extends dist_esm.YM5{static id="lasering";scribbleId="id";onEnter(){const scribble=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:this.editor.options.laserDelayMs,shrink:.05,taper:!0});this.scribbleId=scribble.id,this.pushPointToScribble()}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.pushPointToScribble()}onPointerUp(){this.complete()}pushPointToScribble(){const{x,y}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,x,y)}onCancel(){this.cancel()}onComplete(){this.complete()}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}class LaserTool extends dist_esm.YM5{static id="laser";static initial="idle";static children(){return[LaserTool_childStates_Idle_Idle,Lasering]}static isLockable=!1;onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}class Brushing extends dist_esm.YM5{static id="brushing";info={};initialSelectedShapeIds=[];excludedShapeIds=new Set;isWrapMode=!1;viewportDidChange=!1;cleanupViewportChangeReactor(){}initialStartShape=null;onEnter(info){const{editor}=this,{altKey,currentPagePoint}=editor.inputs;this.isWrapMode=editor.user.getIsWrapMode(),this.viewportDidChange=!1;let isInitialCheck=!0;this.cleanupViewportChangeReactor=(0,dist_esm.wvh)("viewport change while brushing",(()=>{editor.getViewportPageBounds(),isInitialCheck||this.viewportDidChange||(this.viewportDidChange=!0)})),altKey?this.parent.transition("scribble_brushing",info):(this.excludedShapeIds=new Set(editor.getCurrentPageShapes().filter((shape=>editor.isShapeOfType(shape,"group")||editor.isShapeOrAncestorLocked(shape))).map((shape=>shape.id))),this.info=info,this.initialSelectedShapeIds=editor.getSelectedShapeIds().slice(),this.initialStartShape=editor.getShapesAtPoint(currentPagePoint)[0],this.hitTestShapes(),isInitialCheck=!1)}onExit(){this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null}),this.cleanupViewportChangeReactor()}onTick({elapsed}){const{editor}=this;editor.edgeScrollManager.updateEdgeScrolling(elapsed)}onPointerMove(){this.hitTestShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(info){this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",info)}onKeyDown(info){this.editor.inputs.altKey?this.parent.transition("scribble_brushing",info):this.hitTestShapes()}onKeyUp(){this.hitTestShapes()}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){const{editor,excludedShapeIds,isWrapMode}=this,{inputs:{originPagePoint,currentPagePoint,shiftKey,ctrlKey}}=editor,results=new Set(shiftKey?this.initialSelectedShapeIds:[]),isWrapping=isWrapMode?!ctrlKey:ctrlKey,brush=dist_esm.azJ.FromPoints([originPagePoint,currentPagePoint]),{corners}=brush;let A,B,shape,pageBounds,pageTransform,localCorners;const shapesToHitTest=editor.getViewportPageBounds().contains(brush)&&!this.viewportDidChange?editor.getCurrentPageRenderingShapesSorted():editor.getCurrentPageShapesSorted(),currentPageId=editor.getCurrentPageId();testAllShapes:for(let i=0,n=shapesToHitTest.length;i<n;i++)if(shape=shapesToHitTest[i],!excludedShapeIds.has(shape.id)&&!results.has(shape.id)&&(pageBounds=editor.getShapePageBounds(shape),pageBounds))if(brush.contains(pageBounds))this.handleHit(shape,currentPagePoint,currentPageId,results,corners);else if(!isWrapping&&!editor.isShapeOfType(shape,"frame")&&brush.collides(pageBounds)){if(pageTransform=editor.getShapePageTransform(shape),!pageTransform)continue testAllShapes;localCorners=pageTransform.clone().invert().applyToPoints(corners);const geometry=editor.getShapeGeometry(shape);hitTestBrushEdges:for(let i2=0;i2<4;i2++)if(A=localCorners[i2],B=localCorners[(i2+1)%4],geometry.hitTestLineSegment(A,B,0)){this.handleHit(shape,currentPagePoint,currentPageId,results,corners);break hitTestBrushEdges}}const currentBrush=editor.getInstanceState().brush;currentBrush&&brush.equals(currentBrush)||editor.updateInstanceState({brush:{...brush.toJson()}});const current=editor.getSelectedShapeIds();(current.length!==results.size||current.some((id=>!results.has(id))))&&editor.setSelectedShapes(Array.from(results))}onInterrupt(){this.editor.updateInstanceState({brush:null})}handleHit(shape,currentPagePoint,currentPageId,results,corners){if(shape.parentId===currentPageId)return void results.add(shape.id);const selectedShape=this.editor.getOutermostSelectableShape(shape),pageMask=this.editor.getShapeMask(selectedShape.id);(!pageMask||(0,dist_esm.Rx2)(pageMask,corners)||(0,dist_esm.s3y)(currentPagePoint,pageMask))&&results.add(selectedShape.id)}}const CursorTypeMap={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class PointingResizeHandle extends dist_esm.YM5{static id="pointing_resize_handle";info={};updateCursor(){const selected=this.editor.getSelectedShapes(),cursorType=CursorTypeMap[this.info.handle];this.editor.setCursor({type:cursorType,rotation:1===selected.length?this.editor.getSelectionRotation():0})}onEnter(info){this.info=info,this.updateCursor()}onPointerMove(){this.editor.inputs.isDragging&&this.startResizing()}onLongPress(){this.startResizing()}startResizing(){this.editor.getIsReadonly()||this.parent.transition("resizing",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}class Cropping extends dist_esm.YM5{static id="cropping";info={};markId="";snapshot={};onEnter(info){this.info=info,this.markId=this.editor.markHistoryStoppingPoint("cropping"),this.snapshot=this.createSnapshot(),this.updateShapes()}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}updateCursor(){if(!this.editor.getSelectedShapes()[0])return;const cursorType=CursorTypeMap[this.info.handle];this.editor.setCursor({type:cursorType,rotation:this.editor.getSelectionRotation()})}updateShapes(){const{shape,cursorHandleOffset}=this.snapshot;if(!shape)return;const util=this.editor.getShapeUtil(shape.type);if(!util)return;const currentPagePoint=this.editor.inputs.currentPagePoint.clone().sub(cursorHandleOffset),originPagePoint=this.editor.inputs.originPagePoint.clone().sub(cursorHandleOffset),change=currentPagePoint.clone().sub(originPagePoint).rot(-shape.rotation),crop=shape.props.crop??{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},uncroppedSize={w:1/(crop.bottomRight.x-crop.topLeft.x)*shape.props.w,h:1/(crop.bottomRight.y-crop.topLeft.y)*shape.props.h},partial=(util.onCrop?.bind(util)??getCropBox)(shape,{handle:this.info.handle,change,crop,uncroppedSize,initialShape:this.snapshot.shape});partial&&(this.editor.updateShapes([{id:shape.id,type:shape.type,...partial}]),this.updateCursor())}complete(){this.updateShapes(),kickoutOccludedShapes(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){const selectionRotation=this.editor.getSelectionRotation(),{inputs:{originPagePoint}}=this.editor,shape=this.editor.getOnlySelectedShape(),selectionBounds=this.editor.getSelectionRotatedPageBounds(),dragHandlePoint=dist_esm.l2P.RotWith(selectionBounds.getHandlePoint(this.info.handle),selectionBounds.point,selectionRotation);return{shape,cursorHandleOffset:dist_esm.l2P.Sub(originPagePoint,dragHandlePoint)}}}function getHitShapeOnCanvasPointerDown(editor,hitLabels=!1){const zoomLevel=editor.getZoomLevel(),{inputs:{currentPagePoint}}=editor;return editor.getShapeAtPoint(currentPagePoint,{hitInside:!1,hitLabels,margin:editor.options.hitTestMargin/zoomLevel,renderingOnly:!0})??editor.getSelectedShapeAtPoint(currentPagePoint)}function getTranslateCroppedImageChange(editor,shape,delta){if(!shape)throw Error("Needs to translate a cropped shape!");const{crop:oldCrop}=shape.props;if(!oldCrop)return;const flatten=editor.inputs.shiftKey?Math.abs(delta.x)<Math.abs(delta.y)?"x":"y":null;"x"===flatten?delta.x=0:"y"===flatten&&(delta.y=0),delta.rot(-shape.rotation);const{w,h}=getUncroppedSize(shape.props,oldCrop),yCrop=oldCrop.bottomRight.y-oldCrop.topLeft.y,xCrop=oldCrop.bottomRight.x-oldCrop.topLeft.x,newCrop=(0,dist_esm.pN9)(oldCrop);newCrop.topLeft.x=Math.min(1-xCrop,Math.max(0,newCrop.topLeft.x-delta.x/w)),newCrop.topLeft.y=Math.min(1-yCrop,Math.max(0,newCrop.topLeft.y-delta.y/h)),newCrop.bottomRight.x=newCrop.topLeft.x+xCrop,newCrop.bottomRight.y=newCrop.topLeft.y+yCrop;return{id:shape.id,type:shape.type,props:{crop:newCrop}}}class children_Idle_Idle extends dist_esm.YM5{static id="idle";onEnter(){this.editor.setCursor({type:"default",rotation:0});const onlySelectedShape=this.editor.getOnlySelectedShape();onlySelectedShape&&this.editor.setCroppingShape(onlySelectedShape.id)}onExit(){this.editor.setCursor({type:"default",rotation:0})}onCancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}onPointerDown(info){if(info.accelKey)return this.cancel(),void this.editor.root.handleEvent(info);switch(info.target){case"canvas":{const hitShape=getHitShapeOnCanvasPointerDown(this.editor);if(hitShape&&!this.editor.isShapeOfType(hitShape,"group"))return void this.onPointerDown({...info,shape:hitShape,target:"shape"});this.cancel(),this.editor.root.handleEvent(info);break}case"shape":if(info.shape.id===this.editor.getCroppingShapeId())return void this.editor.setCurrentTool("select.crop.pointing_crop",info);this.editor.getShapeUtil(info.shape)?.canCrop(info.shape)?(this.editor.setCroppingShape(info.shape.id),this.editor.setSelectedShapes([info.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",info)):(this.cancel(),this.editor.root.handleEvent(info));break;case"selection":switch(info.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":this.editor.setCurrentTool("select.pointing_rotate_handle",{...info,onInteractionEnd:"select.crop.idle"});break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...info,onInteractionEnd:"select.crop.idle"});break;default:this.cancel()}}}onDoubleClick(info){if(this.editor.inputs.shiftKey||"up"!==info.phase)return;const croppingShapeId=this.editor.getCroppingShapeId();if(!croppingShapeId)return;const shape=this.editor.getShape(croppingShapeId);if(!shape)return;const util=this.editor.getShapeUtil(shape);util&&("selection"!==info.target?(this.cancel(),this.editor.root.handleEvent(info)):util.onDoubleClickEdge?.(shape,info))}onKeyDown(){this.nudgeCroppingImage(!1)}onKeyRepeat(){this.nudgeCroppingImage(!0)}onKeyUp(info){if("Enter"===info.code)this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(ephemeral=!1){const{editor:{inputs:{keys}}}=this,shiftKey=keys.has("ShiftLeft"),delta=new dist_esm.l2P(0,0);if(keys.has("ArrowLeft")&&(delta.x+=1),keys.has("ArrowRight")&&(delta.x-=1),keys.has("ArrowUp")&&(delta.y+=1),keys.has("ArrowDown")&&(delta.y-=1),delta.equals(new dist_esm.l2P(0,0)))return;shiftKey&&delta.mul(10);const shape=this.editor.getShape(this.editor.getCroppingShapeId());if(!shape)return;const partial=getTranslateCroppedImageChange(this.editor,shape,delta);partial&&(ephemeral||this.editor.markHistoryStoppingPoint("translate crop"),this.editor.updateShapes([partial]))}}class PointingCrop extends dist_esm.YM5{static id="pointing_crop";onCancel(){this.editor.setCurrentTool("select.crop.idle",{})}onPointerMove(info){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",info)}onPointerUp(info){this.editor.setCurrentTool("select.crop.idle",info)}}class PointingCropHandle extends dist_esm.YM5{static id="pointing_crop_handle";info={};onEnter(info){this.info=info,this.parent.setCurrentToolIdMask(info.onInteractionEnd);const selectedShape=this.editor.getSelectedShapes()[0];if(!selectedShape)return;const cursorType=CursorTypeMap[this.info.handle];this.editor.setCursor({type:cursorType,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(selectedShape.id)}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)}onPointerMove(){this.editor.inputs.isDragging&&this.startCropping()}onLongPress(){this.startCropping()}startCropping(){this.editor.getIsReadonly()||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}onPointerUp(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}class TranslatingCrop extends dist_esm.YM5{static id="translating_crop";info={};markId="";snapshot={};onEnter(info){this.info=info,this.snapshot=this.createSnapshot(),this.markId=this.editor.markHistoryStoppingPoint("translating_crop"),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()}onExit(){this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}onKeyDown(info){switch(info.key){case"Alt":case"Shift":return void this.updateShapes()}}onKeyUp(info){switch(info.key){case"Enter":return void this.complete();case"Alt":case"Shift":this.updateShapes()}}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const shape=this.snapshot.shape;if(!shape)return;const{originPagePoint,currentPagePoint}=this.editor.inputs,delta=currentPagePoint.clone().sub(originPagePoint),partial=getTranslateCroppedImageChange(this.editor,shape,delta);partial&&this.editor.updateShapes([partial])}}class Crop extends dist_esm.YM5{static id="crop";static initial="idle";static children(){return[children_Idle_Idle,TranslatingCrop,PointingCrop,PointingCropHandle,Cropping]}markId="";onEnter(){this.didExit=!1,this.markId=this.editor.markHistoryStoppingPoint("crop")}didExit=!1;onExit(){this.didExit||(this.didExit=!0,this.editor.squashToMark(this.markId))}onCancel(){this.didExit||(this.didExit=!0,this.editor.bailToMark(this.markId))}}class DraggingHandle extends dist_esm.YM5{static id="dragging_handle";shapeId="";initialHandle={};initialAdjacentHandle=null;initialPagePoint={};markId="";initialPageTransform;initialPageRotation;info={};isPrecise=!1;isPreciseId=null;pointingId=null;onEnter(info){const{shape,isCreating,creatingMarkId,handle}=info;if(this.info=info,this.parent.setCurrentToolIdMask(info.onInteractionEnd),this.shapeId=shape.id,this.markId="",isCreating)if(creatingMarkId)this.markId=creatingMarkId;else{const markId=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);markId&&(this.markId=markId)}else this.markId=this.editor.markHistoryStoppingPoint("dragging handle");if(this.initialHandle=(0,dist_esm.pN9)(handle),this.editor.isShapeOfType(shape,"line")&&"create"===this.initialHandle.type){this.editor.updateShape({...shape,props:{points:{...shape.props.points,[handle.index]:{id:handle.index,index:handle.index,x:handle.x,y:handle.y}}}});const handleAfter=this.editor.getShapeHandles(shape).find((h=>h.index===handle.index));this.initialHandle=(0,dist_esm.pN9)(handleAfter)}this.initialPageTransform=this.editor.getShapePageTransform(shape),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:isCreating?"cross":"grabbing",rotation:0});const handles=this.editor.getShapeHandles(shape).sort(dist_esm.Ky),index=handles.findIndex((h=>h.id===info.handle.id));this.initialAdjacentHandle=null;for(let i=index+1;i<handles.length;i++){const handle2=handles[i];if("vertex"===handle2.type&&"middle"!==handle2.id&&handle2.id!==info.handle.id){this.initialAdjacentHandle=handle2;break}}if(!this.initialAdjacentHandle)for(let i=handles.length-1;i>=0;i--){const handle2=handles[i];if("vertex"===handle2.type&&"middle"!==handle2.id&&handle2.id!==info.handle.id){this.initialAdjacentHandle=handle2;break}}if(this.editor.isShapeOfType(shape,"arrow")){const initialBinding=shared_getArrowBindings(this.editor,shape)[info.handle.id];this.isPrecise=!1,initialBinding&&(this.isPrecise=initialBinding.props.isPrecise,this.isPrecise?this.isPreciseId=initialBinding.toId:this.resetExactTimeout())}this.update(),this.editor.select(this.shapeId)}exactTimeout=-1;resetExactTimeout(){-1!==this.exactTimeout&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout((()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1}),750)}clearExactTimeout(){-1!==this.exactTimeout&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.update(),this.complete()}onCancel(){this.cancel()}onExit(){this.parent.setCurrentToolIdMask(void 0),clearArrowTargetState(this.editor),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})}complete(){this.editor.snaps.clearIndicators(),kickoutOccludedShapes(this.editor,[this.shapeId]);const{onInteractionEnd}=this.info;this.editor.getInstanceState().isToolLocked&&onInteractionEnd?this.editor.setCurrentTool(onInteractionEnd,{shapeId:this.shapeId}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();const{onInteractionEnd}=this.info;onInteractionEnd?this.editor.setCurrentTool(onInteractionEnd,{shapeId:this.shapeId}):this.parent.transition("idle")}update(){const{editor,shapeId,initialPagePoint}=this,{initialHandle,initialPageRotation,initialAdjacentHandle}=this,isSnapMode=this.editor.user.getIsSnapMode(),{snaps,inputs:{currentPagePoint,shiftKey,ctrlKey,altKey,pointerVelocity}}=editor,initial=this.info.shape,shape=editor.getShape(shapeId);if(!shape)return;const util=editor.getShapeUtil(shape),initialBinding=editor.isShapeOfType(shape,"arrow")?shared_getArrowBindings(editor,shape)[initialHandle.id]:void 0;let point=currentPagePoint.clone().sub(initialPagePoint).rot(-initialPageRotation).add(initialHandle);if(shiftKey&&initialAdjacentHandle&&"middle"!==initialHandle.id){const angle=dist_esm.l2P.Angle(initialAdjacentHandle,point),angleDifference=(0,dist_esm.cL9)(angle,24)-angle;point=dist_esm.l2P.RotWith(point,initialAdjacentHandle,angleDifference)}editor.snaps.clearIndicators();let nextHandle={...initialHandle,x:point.x,y:point.y};if(initialHandle.canSnap&&(isSnapMode?!ctrlKey:ctrlKey)){if(!editor.getShapePageTransform(shape.id))throw Error("Expected a page transform");const snap=snaps.handles.snapHandle({currentShapeId:shapeId,handle:nextHandle});snap&&(snap.nudge.rot(-editor.getShapeParentTransform(shape).rotation()),point.add(snap.nudge),nextHandle={...initialHandle,x:point.x,y:point.y})}const changes=util.onHandleDrag?.(shape,{handle:nextHandle,isPrecise:this.isPrecise||altKey,initial}),next={id:shape.id,type:shape.type,...changes};if("vertex"===initialHandle.type&&this.editor.isShapeOfType(shape,"arrow")){const bindingAfter=shared_getArrowBindings(editor,shape)[initialHandle.id];bindingAfter?initialBinding?.toId!==bindingAfter.toId&&(this.pointingId=bindingAfter.toId,this.isPrecise=pointerVelocity.len()<.5||altKey,this.isPreciseId=this.isPrecise?bindingAfter.toId:null,this.resetExactTimeout()):initialBinding&&(this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}changes&&editor.updateShapes([next])}}function getTextLabels(geometry){return geometry.isLabel?[geometry]:geometry instanceof dist_esm.IQE?geometry.children.filter((child=>child.isLabel)):[]}class EditingShape extends dist_esm.YM5{static id="editing_shape";hitShapeForPointerUp=null;info={};onEnter(info){const editingShape=this.editor.getEditingShape();if(!editingShape)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,this.info=info,info.isCreatingTextWhileToolLocked&&this.parent.setCurrentToolIdMask("text"),updateHoveredShapeId(this.editor),this.editor.select(editingShape)}onExit(){const{editingShapeId}=this.editor.getCurrentPageState();editingShapeId&&(this.editor.setEditingShape(null),updateHoveredShapeId.cancel(),this.info.isCreatingTextWhileToolLocked&&(this.parent.setCurrentToolIdMask(void 0),this.editor.setCurrentTool("text",{})))}onPointerMove(info){if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getIsReadonly())return;if(this.hitShapeForPointerUp.isLocked)return;return this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",info),void(this.hitShapeForPointerUp=null)}switch(info.target){case"shape":case"canvas":return void updateHoveredShapeId(this.editor)}}onPointerDown(info){switch(this.hitShapeForPointerUp=null,info.target){case"canvas":{const hitShape=getHitShapeOnCanvasPointerDown(this.editor,!0);if(hitShape)return void this.onPointerDown({...info,shape:hitShape,target:"shape"});break}case"shape":{const{shape:selectingShape}=info,editingShape=this.editor.getEditingShape();if(!editingShape)throw Error("Expected an editing shape!");const textLabels=getTextLabels(this.editor.getShapeUtil(selectingShape).getGeometry(selectingShape)),textLabel=1===textLabels.length?textLabels[0]:void 0,isEmptyTextShape=this.editor.isShapeOfType(editingShape,"text")&&""===renderPlaintextFromRichText(this.editor,editingShape.props.richText).trim();if(!textLabel||isEmptyTextShape)return selectingShape.id!==editingShape.id?void this.parent.transition("pointing_shape",info):void(this.editor.isShapeOfType(selectingShape,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",info)));{const pointInShapeSpace=this.editor.getPointInShapeSpace(selectingShape,this.editor.inputs.currentPagePoint);if(textLabel.bounds.containsPoint(pointInShapeSpace,0)&&textLabel.hitTestPoint(pointInShapeSpace))return selectingShape.id===editingShape.id?void 0:(this.hitShapeForPointerUp=selectingShape,this.editor.markHistoryStoppingPoint("editing on pointer up"),void this.editor.select(selectingShape.id))}break}}this.parent.transition("idle",info),this.editor.root.handleEvent(info)}onPointerUp(info){const hitShape=this.hitShapeForPointerUp;if(!hitShape)return;this.hitShapeForPointerUp=null;const util=this.editor.getShapeUtil(hitShape);if(hitShape.isLocked)return;if(this.editor.getIsReadonly()&&!util.canEditInReadonly(hitShape))return void this.parent.transition("pointing_shape",info);this.editor.select(hitShape.id);const currentEditingShape=this.editor.getEditingShape(),isEditToEditAction=currentEditingShape&&currentEditingShape.id!==hitShape.id;this.editor.setEditingShape(hitShape.id);const isMobile=dist_esm.YZA.isIos||dist_esm.YZA.isAndroid;isMobile&&isEditToEditAction?isMobile&&isEditToEditAction&&this.editor.emit("select-all-text",{shapeId:hitShape.id}):this.editor.emit("place-caret",{shapeId:hitShape.id,point:info.point}),updateHoveredShapeId(this.editor)}onComplete(info){this.parent.transition("idle",info)}onCancel(info){this.parent.transition("idle",info)}}function getShouldEnterCropMode(editor){const onlySelectedShape=editor.getOnlySelectedShape();return!(!onlySelectedShape||editor.isShapeOrAncestorLocked(onlySelectedShape)||!editor.getShapeUtil(onlySelectedShape).canCrop(onlySelectedShape))}function selectOnCanvasPointerUp(editor,info){const selectedShapeIds=editor.getSelectedShapeIds(),{currentPagePoint}=editor.inputs,{shiftKey,altKey,accelKey}=info,additiveSelectionKey=shiftKey||accelKey,hitShape=editor.getShapeAtPoint(currentPagePoint,{hitInside:!1,margin:editor.options.hitTestMargin/editor.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:shape=>!shape.isLocked});if(hitShape){const outermostSelectableShape=editor.getOutermostSelectableShape(hitShape);if(additiveSelectionKey&&!altKey)editor.cancelDoubleClick(),selectedShapeIds.includes(outermostSelectableShape.id)?(editor.markHistoryStoppingPoint("deselecting shape"),editor.deselect(outermostSelectableShape)):(editor.markHistoryStoppingPoint("shift selecting shape"),editor.setSelectedShapes([...selectedShapeIds,outermostSelectableShape.id]));else{let shapeToSelect;shapeToSelect=outermostSelectableShape===hitShape||outermostSelectableShape.id===editor.getFocusedGroupId()||selectedShapeIds.includes(outermostSelectableShape.id)?hitShape:outermostSelectableShape,shapeToSelect&&!selectedShapeIds.includes(shapeToSelect.id)&&(editor.markHistoryStoppingPoint("selecting shape"),editor.select(shapeToSelect.id))}}else{if(additiveSelectionKey)return;{selectedShapeIds.length>0&&(editor.markHistoryStoppingPoint("selecting none"),editor.selectNone());const focusedGroupId=editor.getFocusedGroupId();if((0,dist_esm.vc4)(focusedGroupId)){const groupShape=editor.getShape(focusedGroupId);editor.isPointInShape(groupShape,currentPagePoint,{margin:0,hitInside:!0})||editor.setFocusedGroup(null)}}}}const SKIPPED_KEYS_FOR_AUTO_EDITING=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];class SelectTool_childStates_Idle_Idle extends dist_esm.YM5{static id="idle";selectedShapesOnKeyDown=[];onEnter(){this.parent.setCurrentToolIdMask(void 0),updateHoveredShapeId(this.editor),this.selectedShapesOnKeyDown=[],this.editor.setCursor({type:"default",rotation:0})}onExit(){updateHoveredShapeId.cancel()}onPointerMove(){updateHoveredShapeId(this.editor)}onPointerDown(info){const shouldEnterCropMode=info.ctrlKey&&getShouldEnterCropMode(this.editor);switch(info.target){case"canvas":{const hitShape=getHitShapeOnCanvasPointerDown(this.editor);if(hitShape&&!hitShape.isLocked)return void this.onPointerDown({...info,shape:hitShape,target:"shape"});const selectedShapeIds=this.editor.getSelectedShapeIds(),onlySelectedShape=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint}}=this.editor;if((selectedShapeIds.length>1||onlySelectedShape&&!this.editor.getShapeUtil(onlySelectedShape).hideSelectionBoundsBg(onlySelectedShape))&&isPointInRotatedSelectionBounds(this.editor,currentPagePoint))return void this.onPointerDown({...info,target:"selection"});this.parent.transition("pointing_canvas",info);break}case"shape":{const{shape}=info;if(this.isOverArrowLabelTest(shape)){this.parent.transition("pointing_arrow_label",info);break}if(this.editor.isShapeOrAncestorLocked(shape)){this.parent.transition("pointing_canvas",info);break}this.parent.transition("pointing_shape",info);break}case"handle":if(this.editor.getIsReadonly())break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",info):this.parent.transition("pointing_handle",info);break;case"selection":switch(info.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":if(info.accelKey){this.parent.transition("brushing",info);break}this.parent.transition("pointing_rotate_handle",info);break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":if(shouldEnterCropMode)this.parent.transition("crop.pointing_crop_handle",info);else{if(info.accelKey){this.parent.transition("brushing",info);break}this.parent.transition("pointing_resize_handle",info)}break;default:{const hoveredShape=this.editor.getHoveredShape();if(hoveredShape&&!this.editor.getSelectedShapeIds().includes(hoveredShape.id)&&!hoveredShape.isLocked)return void this.onPointerDown({...info,shape:hoveredShape,target:"shape"});this.parent.transition("pointing_selection",info)}}}}onDoubleClick(info){if(!this.editor.inputs.shiftKey&&"up"===info.phase&&!info.ctrlKey&&!info.shiftKey)switch(info.target){case"canvas":{const hoveredShape=this.editor.getHoveredShape(),hitShape=hoveredShape&&!this.editor.isShapeOfType(hoveredShape,"group")?hoveredShape:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),focusedGroupId=this.editor.getFocusedGroupId();if(hitShape){if(this.editor.isShapeOfType(hitShape,"group"))return void selectOnCanvasPointerUp(this.editor,info);{const parent=this.editor.getShape(hitShape.parentId);if(parent&&this.editor.isShapeOfType(parent,"group")&&(!focusedGroupId||parent.id!==focusedGroupId))return void selectOnCanvasPointerUp(this.editor,info)}return void this.onDoubleClick({...info,shape:hitShape,target:"shape"})}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(info);break}case"selection":{if(this.editor.getIsReadonly())break;const onlySelectedShape=this.editor.getOnlySelectedShape();if(onlySelectedShape){const util=this.editor.getShapeUtil(onlySelectedShape);if(!this.canInteractWithShapeInReadOnly(onlySelectedShape))return;if("right"===info.handle||"left"===info.handle||"top"===info.handle||"bottom"===info.handle){const change=util.onDoubleClickEdge?.(onlySelectedShape,info);if(change)return this.editor.markHistoryStoppingPoint("double click edge"),this.editor.updateShapes([change]),void kickoutOccludedShapes(this.editor,[onlySelectedShape.id])}if("top_left"===info.handle||"top_right"===info.handle||"bottom_right"===info.handle||"bottom_left"===info.handle){const change=util.onDoubleClickCorner?.(onlySelectedShape,info);if(change)return this.editor.markHistoryStoppingPoint("double click corner"),this.editor.updateShapes([change]),void kickoutOccludedShapes(this.editor,[onlySelectedShape.id])}if(util.canCrop(onlySelectedShape)&&!this.editor.isShapeOrAncestorLocked(onlySelectedShape))return void this.parent.transition("crop",info);this.shouldStartEditingShape(onlySelectedShape)&&this.startEditingShape(onlySelectedShape,info,!0)}break}case"shape":{const{shape}=info,util=this.editor.getShapeUtil(shape);if("video"!==shape.type&&"embed"!==shape.type&&this.editor.getIsReadonly())break;if(util.onDoubleClick){const change=util.onDoubleClick?.(shape);if(change)return void this.editor.updateShapes([change])}if(util.canCrop(shape)&&!this.editor.isShapeOrAncestorLocked(shape))return this.editor.markHistoryStoppingPoint("select and crop"),this.editor.select(info.shape?.id),void this.parent.transition("crop",info);this.shouldStartEditingShape(shape)?this.startEditingShape(shape,info,!0):this.handleDoubleClickOnCanvas(info);break}case"handle":{if(this.editor.getIsReadonly())break;const{shape,handle}=info,util=this.editor.getShapeUtil(shape),changes=util.onDoubleClickHandle?.(shape,handle);changes?this.editor.updateShapes([changes]):this.shouldStartEditingShape(shape)&&this.startEditingShape(shape,info,!0)}}}onRightClick(info){switch(info.target){case"canvas":{const hoveredShape=this.editor.getHoveredShape(),hitShape=hoveredShape&&!this.editor.isShapeOfType(hoveredShape,"group")?hoveredShape:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!0,renderingOnly:!0});if(hitShape)return void this.onRightClick({...info,shape:hitShape,target:"shape"});const selectedShapeIds=this.editor.getSelectedShapeIds(),onlySelectedShape=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint}}=this.editor;if((selectedShapeIds.length>1||onlySelectedShape&&!this.editor.getShapeUtil(onlySelectedShape).hideSelectionBoundsBg(onlySelectedShape))&&isPointInRotatedSelectionBounds(this.editor,currentPagePoint))return void this.onRightClick({...info,target:"selection"});this.editor.selectNone();break}case"shape":{const{selectedShapeIds}=this.editor.getCurrentPageState(),{shape}=info,targetShape=this.editor.getOutermostSelectableShape(shape,(parent=>!selectedShapeIds.includes(parent.id)));selectedShapeIds.includes(targetShape.id)||this.editor.findShapeAncestor(targetShape,(shape2=>selectedShapeIds.includes(shape2.id)))||(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([targetShape.id]));break}}}onCancel(){this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.markHistoryStoppingPoint("clearing selection"),this.editor.selectNone())}onKeyDown(info){switch(this.selectedShapesOnKeyDown=this.editor.getSelectedShapes(),info.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":return info.accelKey?void(info.shiftKey?"ArrowDown"===info.code?this.editor.selectFirstChildShape():"ArrowUp"===info.code&&this.editor.selectParentShape():this.editor.selectAdjacentShape(info.code.replace("Arrow","").toLowerCase())):void this.nudgeSelectedShapes(!1)}if(dist_esm.bGJ.editOnType.get()&&!SKIPPED_KEYS_FOR_AUTO_EDITING.includes(info.key)&&!info.altKey&&!info.ctrlKey){const onlySelectedShape=this.editor.getOnlySelectedShape();if(onlySelectedShape&&this.editor.isShapeOfType(onlySelectedShape,"note")&&this.shouldStartEditingShape(onlySelectedShape))return void this.startEditingShape(onlySelectedShape,{...info,target:"shape",shape:onlySelectedShape},!0)}}onKeyRepeat(info){switch(info.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":if(info.accelKey)return void this.editor.selectAdjacentShape(info.code.replace("Arrow","").toLowerCase());this.nudgeSelectedShapes(!0);break;case"Tab":this.editor.getSelectedShapes().length&&this.editor.selectAdjacentShape(info.shiftKey?"prev":"next");break}}onKeyUp(info){switch(info.code){case"Enter":{if(!this.selectedShapesOnKeyDown.length)return;const selectedShapes=this.editor.getSelectedShapes();if(selectedShapes.every((shape=>this.editor.isShapeOfType(shape,"group"))))return void this.editor.setSelectedShapes(selectedShapes.flatMap((shape=>this.editor.getSortedChildIdsForParent(shape.id))));const onlySelectedShape=this.editor.getOnlySelectedShape();if(onlySelectedShape&&this.shouldStartEditingShape(onlySelectedShape))return void this.startEditingShape(onlySelectedShape,{...info,target:"shape",shape:onlySelectedShape},!0);getShouldEnterCropMode(this.editor)&&this.parent.transition("crop",info);break}case"Tab":this.editor.getSelectedShapes().length&&this.editor.selectAdjacentShape(info.shiftKey?"prev":"next");break}}shouldStartEditingShape(shape=this.editor.getOnlySelectedShape()){return!!shape&&((!this.editor.isShapeOrAncestorLocked(shape)||"embed"===shape.type)&&(!!this.canInteractWithShapeInReadOnly(shape)&&this.editor.getShapeUtil(shape).canEdit(shape)))}startEditingShape(shape,info,shouldSelectAll){this.editor.isShapeOrAncestorLocked(shape)&&"embed"!==shape.type||(this.editor.markHistoryStoppingPoint("editing shape"),startEditingShapeWithLabel(this.editor,shape,shouldSelectAll),this.parent.transition("editing_shape",info))}isOverArrowLabelTest(shape){if(!shape)return!1;const pointInShapeSpace=this.editor.getPointInShapeSpace(shape,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(shape,"arrow")){const labelGeometry=this.editor.getShapeGeometry(shape).children[1];if(labelGeometry&&(0,dist_esm.s3y)(pointInShapeSpace,labelGeometry.vertices))return!0}return!1}handleDoubleClickOnCanvas(info){if(this.editor.getIsReadonly())return;if(!this.editor.options.createTextOnCanvasDoubleClick)return;this.editor.markHistoryStoppingPoint("creating text shape");const id=(0,dist_esm.n6Y)(),{x,y}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id,type:"text",x,y,props:{richText:(0,dist_esm.TP3)(""),autoSize:!0}}]);const shape=this.editor.getShape(id);if(!shape)return;const util=this.editor.getShapeUtil(shape);this.editor.getIsReadonly()&&!util.canEditInReadonly(shape)||(this.editor.setEditingShape(id),this.editor.select(id),this.parent.transition("editing_shape",info))}nudgeSelectedShapes(ephemeral=!1){const{editor:{inputs:{keys}}}=this,shiftKey=keys.has("ShiftLeft"),delta=new dist_esm.l2P(0,0);if(keys.has("ArrowLeft")&&(delta.x-=1),keys.has("ArrowRight")&&(delta.x+=1),keys.has("ArrowUp")&&(delta.y-=1),keys.has("ArrowDown")&&(delta.y+=1),delta.equals(new dist_esm.l2P(0,0)))return;ephemeral||this.editor.markHistoryStoppingPoint("nudge shapes");const{gridSize}=this.editor.getDocumentSettings(),step=this.editor.getInstanceState().isGridMode?shiftKey?gridSize*GRID_INCREMENT:gridSize:shiftKey?MAJOR_NUDGE_FACTOR:MINOR_NUDGE_FACTOR,selectedShapeIds=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(selectedShapeIds,delta.mul(step)),kickoutOccludedShapes(this.editor,selectedShapeIds)}canInteractWithShapeInReadOnly(shape){if(!this.editor.getIsReadonly())return!0;return!!this.editor.getShapeUtil(shape).canEditInReadonly(shape)}}const MAJOR_NUDGE_FACTOR=10,MINOR_NUDGE_FACTOR=1,GRID_INCREMENT=5;function isPointInRotatedSelectionBounds(editor,point){const selectionBounds=editor.getSelectionRotatedPageBounds();if(!selectionBounds)return!1;const selectionRotation=editor.getSelectionRotation();return selectionRotation?(0,dist_esm.s3y)(point,selectionBounds.corners.map((c=>dist_esm.l2P.RotWith(c,selectionBounds.point,selectionRotation)))):selectionBounds.containsPoint(point)}class PointingArrowLabel extends dist_esm.YM5{static id="pointing_arrow_label";shapeId="";markId="";wasAlreadySelected=!1;didDrag=!1;didCtrlOnEnter=!1;info={};updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}onEnter(info){const{shape}=info;this.parent.setCurrentToolIdMask(info.onInteractionEnd),this.info=info,this.shapeId=shape.id,this.didDrag=!1,this.didCtrlOnEnter=info.accelKey,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===shape.id,this.updateCursor();const labelGeometry=this.editor.getShapeGeometry(shape).children[1];if(!labelGeometry)throw Error(`Expected to find an arrow label geometry for shape: ${shape.id}`);const{currentPagePoint}=this.editor.inputs,pointInShapeSpace=this.editor.getPointInShapeSpace(shape,currentPagePoint);this._labelDragOffset=dist_esm.l2P.Sub(labelGeometry.center,pointInShapeSpace),this.markId=this.editor.markHistoryStoppingPoint("label-drag start");if(info.shiftKey||info.accelKey){const selectedShapeIds=this.editor.getSelectedShapeIds();this.editor.setSelectedShapes([...selectedShapeIds,this.shapeId])}else this.editor.setSelectedShapes([this.shapeId])}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}_labelDragOffset=new dist_esm.l2P(0,0);onPointerMove(){const{isDragging}=this.editor.inputs;if(!isDragging)return;if(this.didCtrlOnEnter)return void this.parent.transition("brushing",this.info);const shape=this.editor.getShape(this.shapeId);if(!shape)return;const options=this.editor.getShapeUtil("arrow").options,geometry=arrowBodyGeometryCache.get(this.editor,shape.id),transform=this.editor.getShapePageTransform(shape.id),pointInShapeSpace=this.editor.getPointInShapeSpace(shape,this.editor.inputs.currentPagePoint).add(this._labelDragOffset),defaultLabelPosition=getArrowLabelDefaultPosition(this.editor,shape);let nextLabelPosition=arrowBodyGeometryCache.get(this.editor,shape.id).uninterpolateAlongEdge(pointInShapeSpace);isNaN(nextLabelPosition)&&(nextLabelPosition=defaultLabelPosition);const nextLabelPoint=transform.applyToPoint(geometry.interpolateAlongEdge(nextLabelPosition)),labelDefaultPoint=transform.applyToPoint(geometry.interpolateAlongEdge(defaultLabelPosition));dist_esm.l2P.DistMin(nextLabelPoint,labelDefaultPoint,options.labelCenterSnapDistance/this.editor.getZoomLevel())&&(nextLabelPosition=defaultLabelPosition),this.didDrag=!0,this.editor.updateShape({id:shape.id,type:shape.type,props:{labelPosition:nextLabelPosition}})}onPointerUp(){const shape=this.editor.getShape(this.shapeId);shape&&(this.didDrag||!this.wasAlreadySelected?this.complete():this.editor.getIsReadonly()||(this.editor.setEditingShape(shape.id),this.editor.setCurrentTool("select.editing_shape")))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}class PointingCanvas extends dist_esm.YM5{static id="pointing_canvas";onEnter(info){info.shiftKey||info.accelKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.markHistoryStoppingPoint("selecting none"),this.editor.selectNone())}onPointerMove(info){this.editor.inputs.isDragging&&this.parent.transition("brushing",info)}onPointerUp(info){selectOnCanvasPointerUp(this.editor,info),this.complete()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle")}complete(){this.parent.transition("idle")}}class PointingHandle extends dist_esm.YM5{static id="pointing_handle";didCtrlOnEnter=!1;info={};onEnter(info){this.info=info,this.didCtrlOnEnter=info.accelKey;const{shape}=info;if(this.editor.isShapeOfType(shape,"arrow")){const initialBindings=shared_getArrowBindings(this.editor,shape),currentBinding=initialBindings[info.handle.id],oppositeBinding=initialBindings["start"===info.handle.id?"end":"start"],arrowTransform=this.editor.getShapePageTransform(shape.id);currentBinding&&updateArrowTargetState({editor:this.editor,pointInPageSpace:arrowTransform.applyToPoint(info.handle),arrow:shape,isPrecise:currentBinding.props.isPrecise,isExact:info.altKey,currentBinding,oppositeBinding})}this.editor.setCursor({type:"grabbing",rotation:0})}onExit(){this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})}onPointerUp(){const{shape,handle}=this.info;if(this.editor.isShapeOfType(shape,"note")){const{editor}=this,nextNote=getNoteForAdjacentPosition(editor,shape,handle,!1);if(nextNote)return void startEditingShapeWithLabel(editor,nextNote,!0)}this.parent.transition("idle",this.info)}onPointerMove(info){const{editor}=this;editor.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",info):this.startDraggingHandle())}onLongPress(){this.startDraggingHandle()}startDraggingHandle(){const{editor}=this;if(editor.getIsReadonly())return;const{shape,handle}=this.info;if(editor.isShapeOfType(shape,"note")){const nextNote=getNoteForAdjacentPosition(editor,shape,handle,!0);if(nextNote){const centeredOnPointer=editor.getPointInParentSpace(nextNote,editor.inputs.originPagePoint).sub(dist_esm.l2P.Rot(NOTE_CENTER_OFFSET.clone().mul(shape.props.scale),nextNote.rotation));return editor.updateShape({...nextNote,x:centeredOnPointer.x,y:centeredOnPointer.y}),void editor.setHoveredShape(nextNote.id).select(nextNote.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:editor.getShape(nextNote),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{startEditingShapeWithLabel(editor,nextNote,!0)}})}}this.parent.transition("dragging_handle",this.info)}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}function getNoteForAdjacentPosition(editor,shape,handle,forceNew){const pageTransform=editor.getShapePageTransform(shape.id),pagePoint=pageTransform.point(),pageRotation=pageTransform.rotation(),position=getNoteAdjacentPositions(editor,pagePoint,pageRotation,shape.props.growY*shape.props.scale,0,shape.props.scale)[handle.index];if(position)return getNoteShapeForAdjacentPosition(editor,shape,position,pageRotation,forceNew)}class PointingRotateHandle extends dist_esm.YM5{static id="pointing_rotate_handle";info={};updateCursor(){this.editor.setCursor({type:CursorTypeMap[this.info.handle],rotation:this.editor.getSelectionRotation()})}onEnter(info){this.parent.setCurrentToolIdMask(info.onInteractionEnd),this.info=info,this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.editor.inputs.isDragging&&this.startRotating()}onLongPress(){this.startRotating()}startRotating(){this.editor.getIsReadonly()||this.parent.transition("rotating",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}class PointingSelection extends dist_esm.YM5{static id="pointing_selection";info={};onEnter(info){this.info=info}onPointerUp(info){selectOnCanvasPointerUp(this.editor,info),this.parent.transition("idle",info)}onPointerMove(info){this.editor.inputs.isDragging&&this.startTranslating(info)}onLongPress(info){this.startTranslating(info)}startTranslating(info){this.editor.getIsReadonly()||this.parent.transition("translating",info)}onDoubleClick(info){const hoveredShape=this.editor.getHoveredShape(),hitShape=hoveredShape&&!this.editor.isShapeOfType(hoveredShape,"group")?hoveredShape:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(hitShape)return this.parent.transition("idle"),void this.parent.onDoubleClick?.({...info,target:"shape",shape:this.editor.getShape(hitShape)})}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}class PointingShape extends dist_esm.YM5{static id="pointing_shape";hitShape={};hitShapeForPointerUp={};isDoubleClick=!1;didCtrlOnEnter=!1;didSelectOnEnter=!1;onEnter(info){const selectedShapeIds=this.editor.getSelectedShapeIds(),selectionBounds=this.editor.getSelectionRotatedPageBounds(),focusedGroupId=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint}}=this.editor,{shiftKey,altKey,accelKey}=info;this.hitShape=info.shape,this.isDoubleClick=!1,this.didCtrlOnEnter=accelKey;const outermostSelectingShape=this.editor.getOutermostSelectableShape(info.shape),selectedAncestor=this.editor.findShapeAncestor(outermostSelectingShape,(parent=>selectedShapeIds.includes(parent.id)));if(this.didCtrlOnEnter||this.editor.getShapeUtil(info.shape).onClick||outermostSelectingShape.id===focusedGroupId||selectedShapeIds.includes(outermostSelectingShape.id)||selectedAncestor||selectedShapeIds.length>1&&selectionBounds?.containsPoint(currentPagePoint))return this.didSelectOnEnter=!1,void(this.hitShapeForPointerUp=outermostSelectingShape);this.didSelectOnEnter=!0,shiftKey&&!altKey?(this.editor.cancelDoubleClick(),selectedShapeIds.includes(outermostSelectingShape.id)||(this.editor.markHistoryStoppingPoint("shift selecting shape"),this.editor.setSelectedShapes([...selectedShapeIds,outermostSelectingShape.id]))):(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([outermostSelectingShape.id]))}onPointerUp(info){const selectedShapeIds=this.editor.getSelectedShapeIds(),focusedGroupId=this.editor.getFocusedGroupId(),zoomLevel=this.editor.getZoomLevel(),{inputs:{currentPagePoint}}=this.editor,additiveSelectionKey=info.shiftKey||info.accelKey,hitShape=this.editor.getShapeAtPoint(currentPagePoint,{margin:this.editor.options.hitTestMargin/zoomLevel,hitInside:!0,renderingOnly:!0})??this.hitShape,selectingShape=hitShape?this.editor.getOutermostSelectableShape(hitShape):this.hitShapeForPointerUp;if(selectingShape){const util=this.editor.getShapeUtil(selectingShape);if(util.onClick){const change=util.onClick?.(selectingShape);if(change)return this.editor.markHistoryStoppingPoint("shape on click"),this.editor.updateShapes([change]),void this.parent.transition("idle",info)}if(selectingShape.id===focusedGroupId)return selectedShapeIds.length>0?(this.editor.markHistoryStoppingPoint("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),void this.parent.transition("idle",info)}if(!this.didSelectOnEnter){const outermostSelectableShape=this.editor.getOutermostSelectableShape(hitShape,(parent=>!selectedShapeIds.includes(parent.id)));if(selectedShapeIds.includes(outermostSelectableShape.id))if(additiveSelectionKey)this.editor.markHistoryStoppingPoint("deselecting on pointer up"),this.editor.deselect(selectingShape);else if(selectedShapeIds.includes(selectingShape.id)){if(1===selectedShapeIds.length){const textLabels=getTextLabels(this.editor.getShapeUtil(selectingShape).getGeometry(selectingShape)),textLabel=1===textLabels.length?textLabels[0]:void 0;if(textLabel){const pointInShapeSpace=this.editor.getPointInShapeSpace(selectingShape,currentPagePoint);if(textLabel.bounds.containsPoint(pointInShapeSpace,0)&&textLabel.hitTestPoint(pointInShapeSpace))return void this.editor.run((()=>{this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(selectingShape.id);const util=this.editor.getShapeUtil(selectingShape);this.editor.getIsReadonly()&&!util.canEditInReadonly(selectingShape)||(this.editor.setEditingShape(selectingShape.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick?this.editor.emit("select-all-text",{shapeId:selectingShape.id}):this.editor.emit("place-caret",{shapeId:selectingShape.id,point:info.point}))}))}}this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(selectingShape.id)}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(selectingShape);else if(additiveSelectionKey){const ancestors=this.editor.getShapeAncestors(outermostSelectableShape);this.editor.markHistoryStoppingPoint("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter((id=>!ancestors.find((a=>a.id===id)))),outermostSelectableShape.id])}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.setSelectedShapes([outermostSelectableShape.id])}this.parent.transition("idle",info)}onDoubleClick(){this.isDoubleClick=!0}onPointerMove(info){this.editor.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",info):this.startTranslating(info))}onLongPress(info){this.startTranslating(info)}startTranslating(info){this.editor.getIsReadonly()||(this.editor.focus(),this.parent.transition("translating",info))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}class Resizing extends dist_esm.YM5{static id="resizing";info={};markId="";didHoldCommand=!1;creationCursorOffset={x:0,y:0};snapshot={};onEnter(info){const{isCreating=!1,creatingMarkId,creationCursorOffset={x:0,y:0}}=info;this.info=info,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(info.onInteractionEnd),this.creationCursorOffset=creationCursorOffset;try{this.snapshot=this._createSnapshot()}catch(e){return console.error(e),void this.cancel()}if(this.markId="",isCreating)if(creatingMarkId)this.markId=creatingMarkId;else{const markId=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);markId&&(this.markId=markId)}else this.markId=this.editor.markHistoryStoppingPoint("starting resizing");isCreating&&this.editor.setCursor({type:"cross",rotation:0}),this.handleResizeStart(),this.updateShapes()}onTick({elapsed}){const{editor}=this;editor.edgeScrollManager.updateEdgeScrolling(elapsed)}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){kickoutOccludedShapes(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate?this.info.onCreate?.(this.editor.getOnlySelectedShape()):this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots}=this.snapshot,changes=[];shapeSnapshots.forEach((({shape})=>{const util=this.editor.getShapeUtil(shape),change=util.onResizeStart?.(shape);change&&changes.push(change)})),changes.length>0&&this.editor.updateShapes(changes)}handleResizeEnd(){const{shapeSnapshots}=this.snapshot,changes=[];shapeSnapshots.forEach((({shape})=>{const current=this.editor.getShape(shape.id),util=this.editor.getShapeUtil(shape),change=util.onResizeEnd?.(shape,current);change&&changes.push(change)})),changes.length>0&&this.editor.updateShapes(changes)}updateShapes(){const{altKey,shiftKey}=this.editor.inputs,{frames,shapeSnapshots,selectionBounds,cursorHandleOffset,selectedShapeIds,selectionRotation,canShapesDeform}=this.snapshot;let isAspectRatioLocked=shiftKey||!canShapesDeform;if(1===shapeSnapshots.size){const onlySnapshot=[...shapeSnapshots.values()][0];this.editor.isShapeOfType(onlySnapshot.shape,"text")&&(isAspectRatioLocked=!("left"===this.info.handle||"right"===this.info.handle))}const{ctrlKey}=this.editor.inputs,currentPagePoint=this.editor.inputs.currentPagePoint.clone().sub(cursorHandleOffset).sub(this.creationCursorOffset),originPagePoint=this.editor.inputs.originPagePoint.clone().sub(cursorHandleOffset);if(this.editor.getInstanceState().isGridMode&&!ctrlKey){const{gridSize}=this.editor.getDocumentSettings();currentPagePoint.snapToGrid(gridSize)}const dragHandle=this.info.handle,scaleOriginHandle=rotateSelectionHandle(dragHandle,Math.PI);this.editor.snaps.clearIndicators();if((this.editor.user.getIsSnapMode()?!ctrlKey:ctrlKey)&&selectionRotation%dist_esm.sKG==0){const{nudge}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:dist_esm.l2P.Sub(currentPagePoint,originPagePoint),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:rotateSelectionHandle(dragHandle,selectionRotation),isAspectRatioLocked,isResizingFromCenter:altKey});currentPagePoint.add(nudge)}const scaleOriginPage=dist_esm.l2P.RotWith(altKey?selectionBounds.center:selectionBounds.getHandlePoint(scaleOriginHandle),selectionBounds.point,selectionRotation),distanceFromScaleOriginNow=dist_esm.l2P.Sub(currentPagePoint,scaleOriginPage).rot(-selectionRotation),distanceFromScaleOriginAtStart=dist_esm.l2P.Sub(originPagePoint,scaleOriginPage).rot(-selectionRotation),scale=dist_esm.l2P.DivV(distanceFromScaleOriginNow,distanceFromScaleOriginAtStart);Number.isFinite(scale.x)||(scale.x=1),Number.isFinite(scale.y)||(scale.y=1);const isXLocked="top"===dragHandle||"bottom"===dragHandle,isYLocked="left"===dragHandle||"right"===dragHandle;isAspectRatioLocked?isYLocked?scale.y=Math.abs(scale.x):isXLocked?scale.x=Math.abs(scale.y):Math.abs(scale.x)>Math.abs(scale.y)?scale.y=Math.abs(scale.x)*(scale.y<0?-1:1):scale.x=Math.abs(scale.y)*(scale.x<0?-1:1):(isXLocked&&(scale.x=1),isYLocked&&(scale.y=1)),this.info.isCreating||this.updateCursor({dragHandle,isFlippedX:scale.x<0,isFlippedY:scale.y<0,rotation:selectionRotation});for(const id of shapeSnapshots.keys()){const snapshot=shapeSnapshots.get(id);this.editor.resizeShape(id,scale,{initialShape:snapshot.shape,initialBounds:snapshot.bounds,initialPageTransform:snapshot.pageTransform,dragHandle,mode:1===selectedShapeIds.length&&id===selectedShapeIds[0]?"resize_bounds":"scale_shape",scaleOrigin:scaleOriginPage,isAspectRatioLocked,scaleAxisRotation:selectionRotation,skipStartAndEndCallbacks:!0})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id,children}of frames){if(!children.length)continue;const initial=shapeSnapshots.get(id).shape,current=this.editor.getShape(id);if(!initial||!current)continue;const dx=current.x-initial.x,dy=current.y-initial.y,delta=new dist_esm.l2P(dx,dy).rot(-initial.rotation);if(0!==delta.x||0!==delta.y)for(const child of children)this.editor.updateShape({id:child.id,type:child.type,x:child.x-delta.x,y:child.y-delta.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children}of frames)if(children.length)for(const child of children)this.editor.updateShape({id:child.id,type:child.type,x:child.x,y:child.y})}}updateCursor({dragHandle,isFlippedX,isFlippedY,rotation}){const nextCursor={...this.editor.getInstanceState().cursor};switch(dragHandle){case"top_left":case"bottom_right":nextCursor.type="nwse-resize",isFlippedX!==isFlippedY&&(nextCursor.type="nesw-resize");break;case"top_right":case"bottom_left":nextCursor.type="nesw-resize",isFlippedX!==isFlippedY&&(nextCursor.type="nwse-resize")}nextCursor.rotation=rotation,this.editor.setCursor(nextCursor)}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()}_createSnapshot(){const selectedShapeIds=this.editor.getSelectedShapeIds(),selectionRotation=this.editor.getSelectionRotation(),{inputs:{originPagePoint}}=this.editor,selectionBounds=this.editor.getSelectionRotatedPageBounds();if(!selectionBounds)throw Error("Resizing but nothing is selected");const dragHandlePoint=dist_esm.l2P.RotWith(selectionBounds.getHandlePoint(this.info.handle),selectionBounds.point,selectionRotation),cursorHandleOffset=dist_esm.l2P.Sub(originPagePoint,dragHandlePoint),shapeSnapshots=new Map,frames=[];selectedShapeIds.forEach((id=>{const shape=this.editor.getShape(id);if(shape){if("frame"===shape.type&&frames.push({id,children:(0,dist_esm.oE7)(this.editor.getSortedChildIdsForParent(shape).map((id2=>this.editor.getShape(id2))))}),shapeSnapshots.set(shape.id,this._createShapeSnapshot(shape)),this.editor.isShapeOfType(shape,"frame")&&1===selectedShapeIds.length)return;this.editor.visitDescendants(shape.id,(descendantId=>{const descendent=this.editor.getShape(descendantId);if(descendent&&(shapeSnapshots.set(descendent.id,this._createShapeSnapshot(descendent)),this.editor.isShapeOfType(descendent,"frame")))return!1}))}}));const canShapesDeform=![...shapeSnapshots.values()].some((shape=>!(0,dist_esm.jwY)(shape.pageRotation,selectionRotation)||shape.isAspectRatioLocked));return{shapeSnapshots,selectionBounds,cursorHandleOffset,selectionRotation,selectedShapeIds,canShapesDeform,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames}}_createShapeSnapshot(shape){const pageTransform=this.editor.getShapePageTransform(shape),util=this.editor.getShapeUtil(shape);return{shape,bounds:this.editor.getShapeGeometry(shape).bounds,pageTransform,pageRotation:dist_esm.V8r.Decompose(pageTransform).rotation,isAspectRatioLocked:util.isAspectRatioLocked(shape)}}}const ORDERED_SELECTION_HANDLES=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function rotateSelectionHandle(handle,rotation){rotation%=dist_esm.uAR;const numSteps=Math.round(rotation/(dist_esm.PI/4)),currentIndex=ORDERED_SELECTION_HANDLES.indexOf(handle);return ORDERED_SELECTION_HANDLES[(currentIndex+numSteps)%ORDERED_SELECTION_HANDLES.length]}const ONE_DEGREE=Math.PI/180;class Rotating extends dist_esm.YM5{static id="rotating";snapshot={};info={};markId="";onEnter(info){this.info=info,this.parent.setCurrentToolIdMask(info.onInteractionEnd),this.markId=this.editor.markHistoryStoppingPoint("rotate start");const snapshot=(0,dist_esm.fHb)({editor:this.editor,ids:this.editor.getSelectedShapeIds()});if(!snapshot)return this.parent.transition("idle",this.info);this.snapshot=snapshot;const newSelectionRotation=this._getRotationFromPointerPosition({snapToNearestDegree:!1});(0,dist_esm._Bx)({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:CursorTypeMap[this.info.handle],rotation:newSelectionRotation+this.snapshot.initialShapesRotation})}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}update(){const newSelectionRotation=this._getRotationFromPointerPosition({snapToNearestDegree:!1});(0,dist_esm._Bx)({editor:this.editor,delta:newSelectionRotation,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:CursorTypeMap[this.info.handle],rotation:newSelectionRotation+this.snapshot.initialShapesRotation})}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}complete(){(0,dist_esm._Bx)({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),kickoutOccludedShapes(this.editor,this.snapshot.shapeSnapshots.map((s=>s.shape.id))),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}_getRotationFromPointerPosition({snapToNearestDegree}){const{inputs:{shiftKey,currentPagePoint}}=this.editor,{initialCursorAngle,initialShapesRotation,initialPageCenter}=this.snapshot;let newSelectionRotation=initialShapesRotation+(initialPageCenter.angle(currentPagePoint)-initialCursorAngle);if(shiftKey)newSelectionRotation=(0,dist_esm.cL9)(newSelectionRotation,24);else if(snapToNearestDegree&&(newSelectionRotation=Math.round(newSelectionRotation/ONE_DEGREE)*ONE_DEGREE,this.editor.getInstanceState().isCoarsePointer)){const snappedToRightAngle=(0,dist_esm.cL9)(newSelectionRotation,4),angleToRightAngle=(0,dist_esm.qer)(newSelectionRotation,snappedToRightAngle);Math.abs(angleToRightAngle)<(0,dist_esm.tRv)(5)&&(newSelectionRotation=snappedToRightAngle)}return newSelectionRotation-initialShapesRotation}}class ScribbleBrushing extends dist_esm.YM5{static id="scribble_brushing";hits=new Set;size=0;scribbleId="id";initialSelectedShapeIds=new Set;newlySelectedShapeIds=new Set;onEnter(){this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const scribbleItem=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=scribbleItem.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.updateScribbleSelection(!0)}onPointerUp(){this.complete()}onKeyDown(){this.updateScribbleSelection(!1)}onKeyUp(){this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")}onCancel(){this.cancel()}onComplete(){this.complete()}pushPointToScribble(){const{x,y}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,x,y)}updateScribbleSelection(addPoint){const{editor}=this,currentPageShapes=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{shiftKey,originPagePoint,previousPagePoint,currentPagePoint}}=this.editor,{newlySelectedShapeIds,initialSelectedShapeIds}=this;addPoint&&this.pushPointToScribble();const shapes=currentPageShapes;let shape,geometry,A,B;for(let i=0,n=shapes.length;i<n;i++){if(shape=shapes[i],editor.isShapeOfType(shape,"group")||newlySelectedShapeIds.has(shape.id)||editor.isShapeOrAncestorLocked(shape))continue;if(geometry=editor.getShapeGeometry(shape),editor.isShapeOfType(shape,"frame")&&geometry.bounds.containsPoint(editor.getPointInShapeSpace(shape,originPagePoint)))continue;const pageTransform=editor.getShapePageTransform(shape);if(!geometry||!pageTransform)continue;const pt=pageTransform.clone().invert();A=pt.applyToPoint(previousPagePoint),B=pt.applyToPoint(currentPagePoint);const{bounds}=geometry;if(!(bounds.minX-0>Math.max(A.x,B.x)||bounds.minY-0>Math.max(A.y,B.y)||bounds.maxX+0<Math.min(A.x,B.x)||bounds.maxY+0<Math.min(A.y,B.y))&&geometry.hitTestLineSegment(A,B,0)){const outermostShape=this.editor.getOutermostSelectableShape(shape),pageMask=this.editor.getShapeMask(outermostShape.id);if(pageMask){if(null!==(0,dist_esm.lqI)(previousPagePoint,currentPagePoint,pageMask)){if(!(0,dist_esm.s3y)(currentPagePoint,pageMask))continue}}newlySelectedShapeIds.add(outermostShape.id)}}const current=editor.getSelectedShapeIds(),next=new Set(shiftKey?[...newlySelectedShapeIds,...initialSelectedShapeIds]:[...newlySelectedShapeIds]);(current.length!==next.size||current.some((id=>!next.has(id))))&&this.editor.setSelectedShapes(Array.from(next))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}var _dispose_dec,_init,__create=Object.create,__defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__knownSymbol=(name,symbol)=>(symbol=Symbol[name])?symbol:Symbol.for("Symbol."+name),__typeError=msg=>{throw TypeError(msg)},__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__name=(target,value)=>__defProp(target,"name",{value,configurable:!0}),__decoratorStrings=["class","method","getter","setter","accessor","field","value","get","set"],__expectFn=fn=>void 0!==fn&&"function"!=typeof fn?__typeError("Function expected"):fn,__decoratorContext=(kind,name,done,metadata,fns)=>({kind:__decoratorStrings[kind],name,metadata,addInitializer:fn=>done._?__typeError("Already initialized"):fns.push(__expectFn(fn||null))}),__decoratorMetadata=(array,target)=>__defNormalProp(target,__knownSymbol("metadata"),array[3]),__publicField=(obj,key,value)=>__defNormalProp(obj,"symbol"!=typeof key?key+"":key,value),__accessCheck=(obj,member,msg)=>member.has(obj)||__typeError("Cannot "+msg),__privateIn=(member,obj)=>Object(obj)!==obj?__typeError('Cannot use the "in" operator on this value'):member.has(obj),__privateGet=(obj,member,getter)=>(__accessCheck(obj,member,"read from private field"),getter?getter.call(obj):member.get(obj)),__privateSet=(obj,member,value,setter)=>(__accessCheck(obj,member,"write to private field"),setter?setter.call(obj,value):member.set(obj,value),value),__privateMethod=(obj,member,method)=>(__accessCheck(obj,member,"access private method"),method);_dispose_dec=[dist_esm.oIE];class DragAndDropManager{constructor(editor){this.editor=editor,((array,flags,self,value)=>{for(var i=0,fns=array[flags>>1],n=fns&&fns.length;i<n;i++)1&flags?fns[i].call(self):value=fns[i].call(self,value)})(_init,5,this),__publicField(this,"prevDroppingShapeId",null),__publicField(this,"droppingNodeTimer",null),__publicField(this,"first",!0),editor.disposables.add(this.dispose)}updateDroppingNode(movingShapes,cb){this.first&&(this.editor.setHintingShapes(movingShapes.map((s=>this.editor.findShapeAncestor(s,(v=>"group"!==v.type)))).filter((s=>s))),this.prevDroppingShapeId=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,movingShapes)?.id??null,this.first=!1),null===this.droppingNodeTimer?this.setDragTimer(movingShapes,20,cb):this.editor.inputs.pointerVelocity.len()>.5&&(clearTimeout(this.droppingNodeTimer),this.setDragTimer(movingShapes,100,cb))}setDragTimer(movingShapes,duration,cb){this.droppingNodeTimer=this.editor.timers.setTimeout((()=>{this.editor.run((()=>{this.handleDrag(this.editor.inputs.currentPagePoint,movingShapes,cb)})),this.droppingNodeTimer=null}),duration)}handleDrag(point,movingShapes,cb){movingShapes=(0,dist_esm.oE7)(movingShapes.map((shape=>this.editor.getShape(shape.id))));const nextDroppingShapeId=this.editor.getDroppingOverShape(point,movingShapes)?.id??null;if(nextDroppingShapeId===this.prevDroppingShapeId)return void this.hintParents(movingShapes);const{prevDroppingShapeId}=this,prevDroppingShape=prevDroppingShapeId&&this.editor.getShape(prevDroppingShapeId),nextDroppingShape=nextDroppingShapeId&&this.editor.getShape(nextDroppingShapeId);prevDroppingShape&&this.editor.getShapeUtil(prevDroppingShape).onDragShapesOut?.(prevDroppingShape,movingShapes),nextDroppingShape&&this.editor.getShapeUtil(nextDroppingShape).onDragShapesOver?.(nextDroppingShape,movingShapes),this.hintParents(movingShapes),cb?.(),this.prevDroppingShapeId=nextDroppingShapeId}hintParents(movingShapes){const shapesGroupedByAncestor=new Map;for(const shape of movingShapes){const ancestor=this.editor.findShapeAncestor(shape,(v=>"group"!==v.type));ancestor&&(shapesGroupedByAncestor.has(ancestor.id)||shapesGroupedByAncestor.set(ancestor.id,[]),shapesGroupedByAncestor.get(ancestor.id).push(shape.id))}const hintingShapes=[];for(const[ancestorId,shapeIds]of shapesGroupedByAncestor){const ancestor=this.editor.getShape(ancestorId);ancestor&&(getOccludedChildren(this.editor,ancestor).length<shapeIds.length&&hintingShapes.push(ancestor.id))}this.editor.setHintingShapes(hintingShapes)}dropShapes(shapes){const{prevDroppingShapeId}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,shapes),prevDroppingShapeId){const shape=this.editor.getShape(prevDroppingShapeId);if(!shape)return;this.editor.getShapeUtil(shape).onDropShapesOver?.(shape,shapes)}}clear(){this.prevDroppingShapeId=null,null!==this.droppingNodeTimer&&clearTimeout(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}dispose(){this.clear()}}var base;base=null,((array,flags,name,decorators,target,extra)=>{var fn,it,done,ctx,access,k=7&flags,s=!!(8&flags),p=!!(16&flags),j=k>3?array.length+1:k?s?1:2:0,key=__decoratorStrings[k+5],initializers=k>3&&(array[j-1]=[]),extraInitializers=array[j]||(array[j]=[]),desc=k&&(!p&&!s&&(target=target.prototype),k<5&&(k>3||!p)&&__getOwnPropDesc(k<4?target:{get[name](){return __privateGet(this,extra)},set[name](x){return __privateSet(this,extra,x)}},name));k?p&&k<4&&__name(extra,(k>2?"set ":k>1?"get ":"")+name):__name(target,name);for(var i=decorators.length-1;i>=0;i--)ctx=__decoratorContext(k,name,done={},array[3],extraInitializers),k&&(ctx.static=s,ctx.private=p,access=ctx.access={has:p?x=>__privateIn(target,x):x=>name in x},3^k&&(access.get=p?x=>(1^k?__privateGet:__privateMethod)(x,target,4^k?extra:desc.get):x=>x[name]),k>2&&(access.set=p?(x,y)=>__privateSet(x,target,y,4^k?extra:desc.set):(x,y)=>x[name]=y)),it=(0,decorators[i])(k?k<4?p?extra:desc[key]:k>4?void 0:{get:desc.get,set:desc.set}:target,ctx),done._=1,4^k||void 0===it?__expectFn(it)&&(k>4?initializers.unshift(it):k?p?extra=it:desc[key]=it:target=it):"object"!=typeof it||null===it?__typeError("Object expected"):(__expectFn(fn=it.get)&&(desc.get=fn),__expectFn(fn=it.set)&&(desc.set=fn),__expectFn(fn=it.init)&&initializers.unshift(fn));k||__decoratorMetadata(array,target),desc&&__defProp(target,name,desc)})(_init=[,,,__create(base?.[__knownSymbol("metadata")]??null)],1,"dispose",_dispose_dec,DragAndDropManager),__decoratorMetadata(_init,DragAndDropManager);var _updateParentTransforms_dec,_a,Translating_init,Translating_create=Object.create,Translating_defProp=Object.defineProperty,Translating_getOwnPropDesc=Object.getOwnPropertyDescriptor,Translating_knownSymbol=(name,symbol)=>(symbol=Symbol[name])?symbol:Symbol.for("Symbol."+name),Translating_typeError=msg=>{throw TypeError(msg)},Translating_defNormalProp=(obj,key,value)=>key in obj?Translating_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,Translating_name=(target,value)=>Translating_defProp(target,"name",{value,configurable:!0}),Translating_decoratorStrings=["class","method","getter","setter","accessor","field","value","get","set"],Translating_expectFn=fn=>void 0!==fn&&"function"!=typeof fn?Translating_typeError("Function expected"):fn,Translating_decoratorContext=(kind,name,done,metadata,fns)=>({kind:Translating_decoratorStrings[kind],name,metadata,addInitializer:fn=>done._?Translating_typeError("Already initialized"):fns.push(Translating_expectFn(fn||null))}),Translating_decoratorMetadata=(array,target)=>Translating_defNormalProp(target,Translating_knownSymbol("metadata"),array[3]),Translating_publicField=(obj,key,value)=>Translating_defNormalProp(obj,"symbol"!=typeof key?key+"":key,value),Translating_accessCheck=(obj,member,msg)=>member.has(obj)||Translating_typeError("Cannot "+msg),Translating_privateIn=(member,obj)=>Object(obj)!==obj?Translating_typeError('Cannot use the "in" operator on this value'):member.has(obj),Translating_privateGet=(obj,member,getter)=>(Translating_accessCheck(obj,member,"read from private field"),getter?getter.call(obj):member.get(obj)),Translating_privateSet=(obj,member,value,setter)=>(Translating_accessCheck(obj,member,"write to private field"),setter?setter.call(obj,value):member.set(obj,value),value),Translating_privateMethod=(obj,member,method)=>(Translating_accessCheck(obj,member,"access private method"),method);class Translating extends(_a=dist_esm.YM5,_updateParentTransforms_dec=[dist_esm.oIE],_a){constructor(){super(...arguments),((array,flags,self,value)=>{for(var i=0,fns=array[flags>>1],n=fns&&fns.length;i<n;i++)1&flags?fns[i].call(self):value=fns[i].call(self,value)})(Translating_init,5,this),Translating_publicField(this,"info",{}),Translating_publicField(this,"selectionSnapshot",{}),Translating_publicField(this,"snapshot",{}),Translating_publicField(this,"markId",""),Translating_publicField(this,"isCloning",!1),Translating_publicField(this,"isCreating",!1),Translating_publicField(this,"dragAndDropManager",new DragAndDropManager(this.editor))}onCreate(_shape){}onEnter(info){const{isCreating=!1,creatingMarkId,onCreate=()=>{}}=info;if(this.editor.getSelectedShapeIds()?.length){if(this.info=info,this.parent.setCurrentToolIdMask(info.onInteractionEnd),this.isCreating=isCreating,this.markId="",isCreating)if(creatingMarkId)this.markId=creatingMarkId;else{const markId=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);markId&&(this.markId=markId)}else this.markId=this.editor.markHistoryStoppingPoint("translating");this.onCreate=onCreate,this.isCloning=!1,this.info=info,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=getTranslatingSnapshot(this.editor),this.isCreating||!this.editor.inputs.altKey?(this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()):this.startCloning()}else this.parent.transition("idle")}onExit(){this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()}onTick({elapsed}){const{editor}=this;this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),editor.edgeScrollManager.updateEdgeScrolling(elapsed)}onPointerMove(){this.updateShapes()}onKeyDown(){!this.editor.inputs.altKey||this.isCloning?this.updateShapes():this.startCloning()}onKeyUp(){this.editor.inputs.altKey||!this.isCloning?this.updateShapes():this.stopCloning()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate cloning"),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=getTranslatingSnapshot(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate"),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),kickoutOccludedShapes(this.editor,this.snapshot.movingShapes.map((s=>s.id))),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?this.onCreate?.(this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes}=this.snapshot,changes=[];movingShapes.forEach((shape=>{const util=this.editor.getShapeUtil(shape),change=util.onTranslateStart?.(shape);change&&changes.push(change)})),changes.length>0&&this.editor.updateShapes(changes),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes}=this.snapshot;if(this.isCloning&&movingShapes.length>0){const currentAveragePagePoint=dist_esm.l2P.Average(movingShapes.map((s=>this.editor.getShapePageTransform(s.id).point()))),offset=dist_esm.l2P.Sub(currentAveragePagePoint,this.selectionSnapshot.averagePagePoint);dist_esm.l2P.IsNaN(offset)||this.editor.updateInstanceState({duplicateProps:{shapeIds:movingShapes.map((s=>s.id)),offset:{x:offset.x,y:offset.y}}})}const changes=[];movingShapes.forEach((shape=>{const current=this.editor.getShape(shape.id),util=this.editor.getShapeUtil(shape),change=util.onTranslateEnd?.(shape,current);change&&changes.push(change)})),changes.length>0&&this.editor.updateShapes(changes)}updateShapes(){const{snapshot}=this;this.dragAndDropManager.updateDroppingNode(snapshot.movingShapes,this.updateParentTransforms),function moveShapesToPoint({editor,snapshot}){const{inputs}=editor,{noteSnapshot,noteAdjacentPositions,initialPageBounds,initialSnapPoints,shapeSnapshots,averagePagePoint}=snapshot,isGridMode=editor.getInstanceState().isGridMode,gridSize=editor.getDocumentSettings().gridSize,delta=dist_esm.l2P.Sub(inputs.currentPagePoint,inputs.originPagePoint),flatten=editor.inputs.shiftKey?Math.abs(delta.x)<Math.abs(delta.y)?"x":"y":null;"x"===flatten?delta.x=0:"y"===flatten&&(delta.y=0);editor.snaps.clearIndicators();const isSnapping=editor.user.getIsSnapMode()?!inputs.ctrlKey:inputs.ctrlKey;let snappedToPit=!1;if(isSnapping&&editor.inputs.pointerVelocity.len()<.5){const{nudge}=editor.snaps.shapeBounds.snapTranslateShapes({dragDelta:delta,initialSelectionPageBounds:initialPageBounds,lockedAxis:flatten,initialSelectionSnapPoints:initialSnapPoints});delta.add(nudge)}else if(noteSnapshot&&noteAdjacentPositions){const{scale}=noteSnapshot.shape.props,pageCenter=noteSnapshot.pagePoint.clone().add(delta).add(NOTE_CENTER_OFFSET.clone().mul(scale).rot(noteSnapshot.pageRotation));let min=10/editor.getZoomLevel(),offset=new dist_esm.l2P(0,0);for(const pit of noteAdjacentPositions){const deltaToPit=dist_esm.l2P.Sub(pageCenter,pit),dist=deltaToPit.len();dist<min&&(snappedToPit=!0,min=dist,offset=deltaToPit)}delta.sub(offset)}const averageSnappedPoint=dist_esm.l2P.Add(averagePagePoint,delta),snapIndicators=editor.snaps.getIndicators();!isGridMode||inputs.ctrlKey||snappedToPit||0!==snapIndicators.length||averageSnappedPoint.snapToGrid(gridSize);const averageSnap=dist_esm.l2P.Sub(averageSnappedPoint,averagePagePoint);editor.updateShapes((0,dist_esm.oE7)(shapeSnapshots.map((({shape,pagePoint,parentTransform})=>{const newPagePoint=dist_esm.l2P.Add(pagePoint,averageSnap),newLocalPoint=parentTransform?dist_esm.V8r.applyToPoint(parentTransform,newPagePoint):newPagePoint;return{id:shape.id,type:shape.type,x:newLocalPoint.x,y:newLocalPoint.y}}))))}({editor:this.editor,snapshot});const{movingShapes}=snapshot,changes=[];movingShapes.forEach((shape=>{const current=this.editor.getShape(shape.id),util=this.editor.getShapeUtil(shape),change=util.onTranslate?.(shape,current);change&&changes.push(change)})),changes.length>0&&this.editor.updateShapes(changes)}updateParentTransforms(){const{editor,snapshot:{shapeSnapshots}}=this,movingShapes=[];shapeSnapshots.forEach((shapeSnapshot=>{const shape=editor.getShape(shapeSnapshot.shape.id);if(!shape)return null;movingShapes.push(shape);const parentTransform=(0,dist_esm.xhT)(shape.parentId)?null:dist_esm.V8r.Inverse(editor.getShapePageTransform(shape.parentId));shapeSnapshot.parentTransform=parentTransform}))}}function getTranslatingSnapshot(editor){const movingShapes=[],pagePoints=[],selectedShapeIds=editor.getSelectedShapeIds(),shapeSnapshots=(0,dist_esm.oE7)(selectedShapeIds.map((id=>{const shape=editor.getShape(id);if(!shape)return null;movingShapes.push(shape);const pageTransform=editor.getShapePageTransform(id),pagePoint=pageTransform.point(),pageRotation=pageTransform.rotation();pagePoints.push(pagePoint);return{shape,pagePoint,pageRotation,parentTransform:dist_esm.tvM.isId(shape.parentId)?null:dist_esm.V8r.Inverse(editor.getShapePageTransform(shape.parentId))}}))),onlySelectedShape=editor.getOnlySelectedShape();let noteAdjacentPositions,noteSnapshot,initialSnapPoints=[];if(onlySelectedShape)initialSnapPoints=editor.snaps.shapeBounds.getSnapPoints(onlySelectedShape.id);else{const selectionPageBounds=editor.getSelectionPageBounds();selectionPageBounds&&(initialSnapPoints=selectionPageBounds.cornersAndCenter.map(((p,i)=>({id:"selection:"+i,x:p.x,y:p.y}))))}const{originPagePoint}=editor.inputs,allHoveredNotes=shapeSnapshots.filter((s=>editor.isShapeOfType(s.shape,"note")&&editor.isPointInShape(s.shape,originPagePoint)));if(0===allHoveredNotes.length);else if(1===allHoveredNotes.length)noteSnapshot=allHoveredNotes[0];else{const allShapesSorted=editor.getCurrentPageShapesSorted();noteSnapshot=allHoveredNotes.map((s=>({snapshot:s,index:allShapesSorted.findIndex((shape=>shape.id===s.shape.id))}))).sort(((a,b)=>b.index-a.index))[0]?.snapshot}return noteSnapshot&&(noteAdjacentPositions=getAvailableNoteAdjacentPositions(editor,noteSnapshot.pageRotation,noteSnapshot.shape.props.scale,noteSnapshot.shape.props.growY??0)),{averagePagePoint:dist_esm.l2P.Average(pagePoints),movingShapes,shapeSnapshots,initialPageBounds:editor.getSelectionPageBounds(),initialSnapPoints,noteAdjacentPositions,noteSnapshot}}Translating_init=(base=>[,,,Translating_create(base?.[Translating_knownSymbol("metadata")]??null)])(_a),((array,flags,name,decorators,target,extra)=>{var fn,it,done,ctx,access,k=7&flags,s=!!(8&flags),p=!!(16&flags),j=k>3?array.length+1:k?s?1:2:0,key=Translating_decoratorStrings[k+5],initializers=k>3&&(array[j-1]=[]),extraInitializers=array[j]||(array[j]=[]),desc=k&&(!p&&!s&&(target=target.prototype),k<5&&(k>3||!p)&&Translating_getOwnPropDesc(k<4?target:{get[name](){return Translating_privateGet(this,extra)},set[name](x){return Translating_privateSet(this,extra,x)}},name));k?p&&k<4&&Translating_name(extra,(k>2?"set ":k>1?"get ":"")+name):Translating_name(target,name);for(var i=decorators.length-1;i>=0;i--)ctx=Translating_decoratorContext(k,name,done={},array[3],extraInitializers),k&&(ctx.static=s,ctx.private=p,access=ctx.access={has:p?x=>Translating_privateIn(target,x):x=>name in x},3^k&&(access.get=p?x=>(1^k?Translating_privateGet:Translating_privateMethod)(x,target,4^k?extra:desc.get):x=>x[name]),k>2&&(access.set=p?(x,y)=>Translating_privateSet(x,target,y,4^k?extra:desc.set):(x,y)=>x[name]=y)),it=(0,decorators[i])(k?k<4?p?extra:desc[key]:k>4?void 0:{get:desc.get,set:desc.set}:target,ctx),done._=1,4^k||void 0===it?Translating_expectFn(it)&&(k>4?initializers.unshift(it):k?p?extra=it:desc[key]=it:target=it):"object"!=typeof it||null===it?Translating_typeError("Object expected"):(Translating_expectFn(fn=it.get)&&(desc.get=fn),Translating_expectFn(fn=it.set)&&(desc.set=fn),Translating_expectFn(fn=it.init)&&initializers.unshift(fn));k||Translating_decoratorMetadata(array,target),desc&&Translating_defProp(target,name,desc)})(Translating_init,1,"updateParentTransforms",_updateParentTransforms_dec,Translating),Translating_decoratorMetadata(Translating_init,Translating),Translating_publicField(Translating,"id","translating");__webpack_require__("./node_modules/process/browser.js");class SelectTool extends dist_esm.YM5{static id="select";static initial="idle";static isLockable=!1;reactor=void 0;static children(){return[Crop,Cropping,SelectTool_childStates_Idle_Idle,PointingCanvas,PointingShape,Translating,Brushing,ScribbleBrushing,PointingCropHandle,PointingSelection,PointingResizeHandle,EditingShape,Resizing,Rotating,PointingRotateHandle,PointingArrowLabel,PointingHandle,DraggingHandle]}cleanUpDuplicateProps(){const selectedShapeIds=this.editor.getSelectedShapeIds(),instance=this.editor.getInstanceState();if(!instance.duplicateProps)return;const duplicatedShapes=new Set(instance.duplicateProps.shapeIds);selectedShapeIds.length===duplicatedShapes.size&&selectedShapeIds.every((shapeId=>duplicatedShapes.has(shapeId)))||this.editor.updateInstanceState({duplicateProps:null})}onEnter(){this.reactor=(0,dist_esm.wvh)("clean duplicate props",(()=>{try{this.cleanUpDuplicateProps()}catch(e){console.error(e)}}))}onExit(){this.reactor?.(),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}}class ZoomTool_childStates_Idle_Idle extends dist_esm.YM5{static id="idle";info={};onEnter(info){this.info=info}onPointerDown(){this.parent.transition("pointing",this.info)}}class ZoomTool_childStates_Pointing_Pointing extends dist_esm.YM5{static id="pointing";info={};onEnter(info){this.info=info}onPointerUp(){this.complete()}onPointerMove(){this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)}onCancel(){this.cancel()}complete(){const{currentScreenPoint}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(currentScreenPoint,{animation:{duration:220}}):this.editor.zoomIn(currentScreenPoint,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}class ZoomBrushing extends dist_esm.YM5{static id="zoom_brushing";info={};zoomBrush=new dist_esm.azJ;onEnter(info){this.info=info,this.update()}onExit(){this.editor.updateInstanceState({zoomBrush:null})}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}update(){const{inputs:{originPagePoint,currentPagePoint}}=this.editor;this.zoomBrush.setTo(dist_esm.azJ.FromPoints([originPagePoint,currentPagePoint])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush}=this,threshold=8/this.editor.getZoomLevel();if(zoomBrush.width<threshold&&zoomBrush.height<threshold){const point=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(point,{animation:{duration:220}}):this.editor.zoomIn(point,{animation:{duration:220}})}else{const targetZoom=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(zoomBrush,{targetZoom,animation:{duration:220}})}this.parent.transition("idle",this.info)}}class ZoomTool extends dist_esm.YM5{static id="zoom";static initial="idle";static children(){return[ZoomTool_childStates_Idle_Idle,ZoomBrushing,ZoomTool_childStates_Pointing_Pointing]}static isLockable=!1;info={};onEnter(info){this.info=info,this.parent.setCurrentToolIdMask(info.onInteractionEnd),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)}onKeyDown(){this.updateCursor()}onKeyUp(info){this.updateCursor(),"KeyZ"===info.code&&this.complete()}onInterrupt(){this.complete()}complete(){this.info.onInteractionEnd&&"select"!==this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}}const defaultTools=[EraserTool,HandTool,LaserTool,ZoomTool,SelectTool];function FollowingIndicator(){const editor=(0,dist_esm.hGv)(),followingUserId=(0,dist_esm.hau)("follow",(()=>editor.getInstanceState().followingUserId),[editor]);return followingUserId?(0,jsx_runtime.jsx)(FollowingIndicatorInner,{userId:followingUserId}):null}function FollowingIndicatorInner({userId}){const presence=(0,dist_esm.xQ_)(userId);return presence?(0,jsx_runtime.jsx)("div",{className:"tlui-following-indicator",style:{borderColor:presence.color}}):null}let defaultEditorAssetUrls={fonts:{tldraw_mono:`${(0,dist_esm.H__)()}/fonts/IBMPlexMono-Medium.woff2`,tldraw_mono_italic:`${(0,dist_esm.H__)()}/fonts/IBMPlexMono-MediumItalic.woff2`,tldraw_mono_bold:`${(0,dist_esm.H__)()}/fonts/IBMPlexMono-Bold.woff2`,tldraw_mono_italic_bold:`${(0,dist_esm.H__)()}/fonts/IBMPlexMono-BoldItalic.woff2`,tldraw_serif:`${(0,dist_esm.H__)()}/fonts/IBMPlexSerif-Medium.woff2`,tldraw_serif_italic:`${(0,dist_esm.H__)()}/fonts/IBMPlexSerif-MediumItalic.woff2`,tldraw_serif_bold:`${(0,dist_esm.H__)()}/fonts/IBMPlexSerif-Bold.woff2`,tldraw_serif_italic_bold:`${(0,dist_esm.H__)()}/fonts/IBMPlexSerif-BoldItalic.woff2`,tldraw_sans:`${(0,dist_esm.H__)()}/fonts/IBMPlexSans-Medium.woff2`,tldraw_sans_italic:`${(0,dist_esm.H__)()}/fonts/IBMPlexSans-MediumItalic.woff2`,tldraw_sans_bold:`${(0,dist_esm.H__)()}/fonts/IBMPlexSans-Bold.woff2`,tldraw_sans_italic_bold:`${(0,dist_esm.H__)()}/fonts/IBMPlexSans-BoldItalic.woff2`,tldraw_draw:`${(0,dist_esm.H__)()}/fonts/Shantell_Sans-Informal_Regular.woff2`,tldraw_draw_italic:`${(0,dist_esm.H__)()}/fonts/Shantell_Sans-Informal_Regular_Italic.woff2`,tldraw_draw_bold:`${(0,dist_esm.H__)()}/fonts/Shantell_Sans-Informal_Bold.woff2`,tldraw_draw_italic_bold:`${(0,dist_esm.H__)()}/fonts/Shantell_Sans-Informal_Bold_Italic.woff2`}};let defaultUiAssetUrls={...defaultEditorAssetUrls,icons:Object.fromEntries(["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","arrow-arc","arrow-elbow","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bold","bookmark","bring-forward","bring-to-front","broken","bulletList","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","code","color","comment","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","heading","help-circle","highlight","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","italic","leading","link","list","lock","manual","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","strike","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","underline","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"].map((name=>[name,`${(0,dist_esm.H__)()}/icons/icon/0_merged.svg#${name}`]))),translations:Object.fromEntries(dist_esm.Yjb.map((lang=>[lang.locale,`${(0,dist_esm.H__)()}/translations/${lang.locale}.json`]))),embedIcons:Object.fromEntries(DEFAULT_EMBED_DEFINITIONS.map((def=>[def.type,`${(0,dist_esm.H__)()}/embed-icons/${def.type}.png`])))};function useDefaultUiAssetUrlsWithOverrides(overrides){return overrides?{fonts:Object.assign({...defaultUiAssetUrls.fonts},{...overrides?.fonts}),icons:Object.assign({...defaultUiAssetUrls.icons},{...overrides?.icons}),embedIcons:Object.assign({...defaultUiAssetUrls.embedIcons},{...overrides?.embedIcons}),translations:Object.assign({...defaultUiAssetUrls.translations},{...overrides?.translations})}:defaultUiAssetUrls}var react_popover_dist=__webpack_require__("./node_modules/@radix-ui/react-popover/dist/index.mjs");function TldrawUiPopover({id,children,onOpenChange,open}){const[isOpen,handleOpenChange]=useMenuIsOpen(id,onOpenChange);return(0,jsx_runtime.jsx)(react_popover_dist.bL,{onOpenChange:handleOpenChange,open:open||isOpen,children:(0,jsx_runtime.jsx)("div",{className:"tlui-popover",children})})}function TldrawUiPopoverTrigger({children}){return(0,jsx_runtime.jsx)(react_popover_dist.l9,{asChild:!0,dir:"ltr",children})}function TldrawUiPopoverContent({side,children,align="center",sideOffset=8,alignOffset=0,disableEscapeKeyDown=!1,autoFocusFirstButton=!0}){const container=(0,dist_esm.NFA)(),ref=react.useRef(null),handleOpenAutoFocus=react.useCallback((()=>{if(!autoFocusFirstButton)return;const firstButton=[...ref.current?.querySelectorAll("button:not([disabled])")??[]].filter((button=>button.offsetWidth||button.offsetHeight))[0];firstButton&&firstButton.focus()}),[autoFocusFirstButton]);return(0,jsx_runtime.jsx)(react_popover_dist.ZL,{container,children:(0,jsx_runtime.jsx)(react_popover_dist.UC,{className:"tlui-popover__content",side,sideOffset,align,alignOffset,dir:"ltr",ref,onOpenAutoFocus:handleOpenAutoFocus,onEscapeKeyDown:e=>disableEscapeKeyDown&&e.preventDefault(),children})})}const useThreeStackableItems=()=>{const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("threeStackableItems",(()=>function shapesWithUnboundArrows(editor){return editor.getSelectedShapeIds().map((id=>editor.getShape(id))).filter((shape=>{if(!shape)return!1;if(editor.isShapeOfType(shape,"arrow")){const bindings=shared_getArrowBindings(editor,shape);if(bindings.start||bindings.end)return!1}return!0}))}(editor).length>2),[editor])},useIsInSelectState=()=>{const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("isInSelectState",(()=>editor.isIn("select")),[editor])},useAllowGroup=()=>{const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("allow group",(()=>{const selectedShapes=editor.getSelectedShapes();if(selectedShapes.length<2)return!1;for(const shape of selectedShapes)if(editor.isShapeOfType(shape,"arrow")){const bindings=shared_getArrowBindings(editor,shape);if(bindings.start&&!selectedShapes.some((s=>s.id===bindings.start.toId)))return!1;if(bindings.end&&!selectedShapes.some((s=>s.id===bindings.end.toId)))return!1}return!0}),[editor])},useAllowUngroup=()=>{const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("allowUngroup",(()=>editor.getSelectedShapeIds().some((id=>"group"===editor.getShape(id)?.type))),[editor])},showMenuPaste="undefined"!=typeof window&&"navigator"in window&&Boolean(navigator.clipboard)&&Boolean(navigator.clipboard.read);function useAnySelectedShapesCount(min,max){const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("selectedShapes",(()=>{const len=editor.getSelectedShapes().length;return void 0===min?void 0===max?len:len<=max:void 0===max?len>=min:len>=min&&len<=max}),[editor,min,max])}function useUnlockedSelectedShapesCount(min,max){const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("selectedShapes",(()=>{const len=editor.getSelectedShapes().filter((s=>!editor.isShapeOrAncestorLocked(s))).length;return void 0===min?void 0===max?len:len<=max:void 0===max?len>=min:len>=min&&len<=max}),[editor])}function useHasLinkShapeSelected(){const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("hasLinkShapeSelected",(()=>{const onlySelectedShape=editor.getOnlySelectedShape();return!(!onlySelectedShape||"embed"===onlySelectedShape.type||!("url"in onlySelectedShape.props)||onlySelectedShape.isLocked)}),[editor])}function useCanRedo(){const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("useCanRedo",(()=>editor.getCanRedo()),[editor])}function useCanUndo(){const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("useCanUndo",(()=>editor.getCanUndo()),[editor])}function DefaultActionsMenuContent(){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(AlignMenuItems,{}),(0,jsx_runtime.jsx)(DistributeMenuItems,{}),(0,jsx_runtime.jsx)(StackMenuItems,{}),(0,jsx_runtime.jsx)(ReorderMenuItems,{}),(0,jsx_runtime.jsx)(ZoomOrRotateMenuItem,{}),(0,jsx_runtime.jsx)(RotateCWMenuItem,{}),(0,jsx_runtime.jsx)(EditLinkMenuItem,{}),(0,jsx_runtime.jsx)(GroupOrUngroupMenuItem,{})]})}function AlignMenuItems(){const twoSelected=useUnlockedSelectedShapesCount(2),isInSelectState=useIsInSelectState(),enabled=twoSelected&&isInSelectState;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"align-left",disabled:!enabled}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"align-center-horizontal",disabled:!enabled}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"align-right",disabled:!enabled}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"stretch-horizontal",disabled:!enabled}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"align-top",disabled:!enabled}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"align-center-vertical",disabled:!enabled}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"align-bottom",disabled:!enabled}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"stretch-vertical",disabled:!enabled})]})}function DistributeMenuItems(){const threeSelected=useUnlockedSelectedShapesCount(3),isInSelectState=useIsInSelectState(),enabled=threeSelected&&isInSelectState;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"distribute-horizontal",disabled:!enabled}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"distribute-vertical",disabled:!enabled})]})}function StackMenuItems(){const threeStackableItems=useThreeStackableItems(),isInSelectState=useIsInSelectState(),enabled=threeStackableItems&&isInSelectState;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"stack-horizontal",disabled:!enabled}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"stack-vertical",disabled:!enabled})]})}function ReorderMenuItems(){const oneSelected=useUnlockedSelectedShapesCount(1),isInSelectState=useIsInSelectState(),enabled=oneSelected&&isInSelectState;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"send-to-back",disabled:!enabled}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"send-backward",disabled:!enabled}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"bring-forward",disabled:!enabled}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"bring-to-front",disabled:!enabled})]})}function ZoomOrRotateMenuItem(){return useBreakpoint()<PORTRAIT_BREAKPOINT.TABLET_SM?(0,jsx_runtime.jsx)(ZoomTo100MenuItem,{}):(0,jsx_runtime.jsx)(RotateCCWMenuItem,{})}function ZoomTo100MenuItem(){const editor=(0,dist_esm.hGv)(),isZoomedTo100=(0,dist_esm.hau)("zoom is 1",(()=>1===editor.getZoomLevel()),[editor]);return(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"zoom-to-100",disabled:isZoomedTo100})}function RotateCCWMenuItem(){const oneSelected=useUnlockedSelectedShapesCount(1),isInSelectState=useIsInSelectState(),enabled=oneSelected&&isInSelectState;return(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"rotate-ccw",disabled:!enabled})}function RotateCWMenuItem(){const oneSelected=useUnlockedSelectedShapesCount(1),isInSelectState=useIsInSelectState(),enabled=oneSelected&&isInSelectState;return(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"rotate-cw",disabled:!enabled})}function EditLinkMenuItem(){const showEditLink=useHasLinkShapeSelected(),isInSelectState=useIsInSelectState(),enabled=showEditLink&&isInSelectState;return(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"edit-link",disabled:!enabled})}function GroupOrUngroupMenuItem(){const allowGroup=useAllowGroup(),allowUngroup=useAllowUngroup();return allowGroup?(0,jsx_runtime.jsx)(GroupMenuItem,{}):allowUngroup?(0,jsx_runtime.jsx)(UngroupMenuItem,{}):(0,jsx_runtime.jsx)(GroupMenuItem,{})}function GroupMenuItem(){const twoSelected=useUnlockedSelectedShapesCount(2),isInSelectState=useIsInSelectState(),enabled=twoSelected&&isInSelectState;return(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"group",disabled:!enabled})}function UngroupMenuItem(){return(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"ungroup"})}const DefaultActionsMenu=(0,react.memo)((function DefaultActionsMenu2({children}){const msg=useTranslation_useTranslation(),breakpoint=useBreakpoint(),isReadonlyMode=useReadonly(),ref=(0,react.useRef)(null);(0,dist_esm.I9L)(ref);const editor=(0,dist_esm.hGv)(),isInAcceptableReadonlyState=(0,dist_esm.hau)("should display quick actions when in readonly",(()=>editor.isInAny("hand","zoom")),[editor]),content=children??(0,jsx_runtime.jsx)(DefaultActionsMenuContent,{});if(!isReadonlyMode||isInAcceptableReadonlyState)return(0,jsx_runtime.jsxs)(TldrawUiPopover,{id:"actions-menu",children:[(0,jsx_runtime.jsx)(TldrawUiPopoverTrigger,{children:(0,jsx_runtime.jsx)(TldrawUiToolbarButton,{type:"icon","data-testid":"actions-menu.button",title:msg("actions-menu.title"),children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:"dots-vertical",small:!0})})}),(0,jsx_runtime.jsx)(TldrawUiPopoverContent,{side:breakpoint>=PORTRAIT_BREAKPOINT.TABLET?"bottom":"top",sideOffset:6,children:(0,jsx_runtime.jsx)(TldrawUiToolbar,{ref,label:msg("actions-menu.title"),className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:(0,jsx_runtime.jsx)(TldrawUiMenuContextProvider,{type:"icons",sourceId:"actions-menu",children:content})})})]})}));function ToggleAutoSizeMenuItem(){return function useShowAutoSizeToggle(){const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("showAutoSizeToggle",(()=>{const selectedShapes=editor.getSelectedShapes();return 1===selectedShapes.length&&editor.isShapeOfType(selectedShapes[0],"text")&&!1===selectedShapes[0].props.autoSize}),[editor])}()?(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"toggle-auto-size"}):null}function menu_items_EditLinkMenuItem(){return useHasLinkShapeSelected()?(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"edit-link"}):null}function DuplicateMenuItem(){return useUnlockedSelectedShapesCount(1)?(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"duplicate"}):null}function FlattenMenuItem(){const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("should display flatten option",(()=>{if(0===editor.getSelectedShapeIds().length)return!1;const onlySelectedShape=editor.getOnlySelectedShape();return!onlySelectedShape||!editor.isShapeOfType(onlySelectedShape,"image")}),[editor])?(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"flatten-to-image"}):null}function menu_items_GroupMenuItem(){return useAllowGroup()?(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"group"}):null}function menu_items_UngroupMenuItem(){return useAllowUngroup()?(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"ungroup"}):null}function RemoveFrameMenuItem(){const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("allow unframe",(()=>{const selectedShapes=editor.getSelectedShapes();return 0!==selectedShapes.length&&selectedShapes.every((shape=>editor.isShapeOfType(shape,"frame")))}),[editor])?(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"remove-frame"}):null}function FitFrameToContentMenuItem(){const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("allow fit frame to content",(()=>{const onlySelectedShape=editor.getOnlySelectedShape();return!!onlySelectedShape&&(editor.isShapeOfType(onlySelectedShape,"frame")&&editor.getSortedChildIdsForParent(onlySelectedShape).length>0)}),[editor])?(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"fit-frame-to-content"}):null}function ToggleLockMenuItem(){const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("selected shapes",(()=>editor.getSelectedShapes().length>0),[editor])?(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"toggle-lock"}):null}function ToggleTransparentBgMenuItem(){const editor=(0,dist_esm.hGv)(),isTransparentBg=(0,dist_esm.hau)("isTransparentBg",(()=>!editor.getInstanceState().exportBackground),[editor]);return(0,jsx_runtime.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-transparent",checked:isTransparentBg,toggle:!0})}function UnlockAllMenuItem(){const editor=(0,dist_esm.hGv)(),shouldDisplay=(0,dist_esm.hau)("any shapes",(()=>editor.getCurrentPageShapeIds().size>0),[editor]);return(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"unlock-all",disabled:!shouldDisplay})}function menu_items_ZoomTo100MenuItem(){const editor=(0,dist_esm.hGv)(),isZoomedTo100=(0,dist_esm.hau)("zoomed to 100",(()=>1===editor.getZoomLevel()),[editor]);return(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"zoom-to-100",noClose:!0,disabled:isZoomedTo100})}function ZoomToFitMenuItem(){const editor=(0,dist_esm.hGv)(),hasShapes=(0,dist_esm.hau)("has shapes",(()=>editor.getCurrentPageShapeIds().size>0),[editor]);return(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"zoom-to-fit",disabled:!hasShapes,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function ZoomToSelectionMenuItem(){const editor=(0,dist_esm.hGv)(),hasSelected=(0,dist_esm.hau)("has shapes",(()=>editor.getSelectedShapeIds().length>0),[editor]);return(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"zoom-to-selection",disabled:!hasSelected,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function ClipboardMenuGroup(){return(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"clipboard",children:[(0,jsx_runtime.jsx)(CutMenuItem,{}),(0,jsx_runtime.jsx)(CopyMenuItem,{}),(0,jsx_runtime.jsx)(PasteMenuItem,{}),(0,jsx_runtime.jsx)(DuplicateMenuItem,{}),(0,jsx_runtime.jsx)(DeleteMenuItem,{})]})}function CopyAsMenuGroup(){const editor=(0,dist_esm.hGv)(),atLeastOneShapeOnPage=(0,dist_esm.hau)("atLeastOneShapeOnPage",(()=>editor.getCurrentPageShapeIds().size>0),[editor]);return(0,jsx_runtime.jsxs)(TldrawUiMenuSubmenu,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!atLeastOneShapeOnPage,children:[(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"copy-as-group",children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"copy-as-svg"}),Boolean(window.navigator.clipboard?.write)&&(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"copy-as-png"})]}),(0,jsx_runtime.jsx)(TldrawUiMenuGroup,{id:"copy-as-bg",children:(0,jsx_runtime.jsx)(ToggleTransparentBgMenuItem,{})})]})}function CutMenuItem(){const shouldDisplay=useUnlockedSelectedShapesCount(1);return(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"cut",disabled:!shouldDisplay})}function CopyMenuItem(){const shouldDisplay=useAnySelectedShapesCount(1);return(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"copy",disabled:!shouldDisplay})}function PasteMenuItem(){const shouldDisplay=showMenuPaste;return(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"paste",disabled:!shouldDisplay})}function ConversionsMenuGroup(){const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("atLeastOneShapeOnPage",(()=>editor.getCurrentPageShapeIds().size>0),[editor])?(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"conversions",children:[(0,jsx_runtime.jsx)(CopyAsMenuGroup,{}),(0,jsx_runtime.jsxs)(TldrawUiMenuSubmenu,{id:"export-as",label:"context-menu.export-as",size:"small",children:[(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"export-as-group",children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"export-as-svg"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"export-as-png"})]}),(0,jsx_runtime.jsx)(TldrawUiMenuGroup,{id:"export-as-bg",children:(0,jsx_runtime.jsx)(ToggleTransparentBgMenuItem,{})})]})]}):null}function SelectAllMenuItem(){const editor=(0,dist_esm.hGv)(),atLeastOneShapeOnPage=(0,dist_esm.hau)("atLeastOneShapeOnPage",(()=>editor.getCurrentPageShapeIds().size>0),[editor]);return(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"select-all",disabled:!atLeastOneShapeOnPage})}function DeleteMenuItem(){const oneSelected=useUnlockedSelectedShapesCount(1);return(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"delete",disabled:!oneSelected})}function EditMenuSubmenu(){const isReadonlyMode=useReadonly();return useAnySelectedShapesCount(1)?isReadonlyMode?null:(0,jsx_runtime.jsxs)(TldrawUiMenuSubmenu,{id:"edit",label:"context-menu.edit",size:"small",children:[(0,jsx_runtime.jsx)(menu_items_GroupMenuItem,{}),(0,jsx_runtime.jsx)(menu_items_UngroupMenuItem,{}),(0,jsx_runtime.jsx)(FlattenMenuItem,{}),(0,jsx_runtime.jsx)(menu_items_EditLinkMenuItem,{}),(0,jsx_runtime.jsx)(FitFrameToContentMenuItem,{}),(0,jsx_runtime.jsx)(RemoveFrameMenuItem,{}),(0,jsx_runtime.jsx)(ConvertToEmbedMenuItem,{}),(0,jsx_runtime.jsx)(ConvertToBookmarkMenuItem,{}),(0,jsx_runtime.jsx)(ToggleAutoSizeMenuItem,{}),(0,jsx_runtime.jsx)(ToggleLockMenuItem,{})]}):null}function ArrangeMenuSubmenu(){const twoSelected=useUnlockedSelectedShapesCount(2),onlyFlippableShapeSelected=function useOnlyFlippableShape(){const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("onlyFlippableShape",(()=>{const shape=editor.getOnlySelectedShape();return shape&&(editor.isShapeOfType(shape,"group")||editor.isShapeOfType(shape,"image")||editor.isShapeOfType(shape,"arrow")||editor.isShapeOfType(shape,"line")||editor.isShapeOfType(shape,"draw"))}),[editor])}();return useReadonly()?null:twoSelected||onlyFlippableShapeSelected?(0,jsx_runtime.jsxs)(TldrawUiMenuSubmenu,{id:"arrange",label:"context-menu.arrange",size:"small",children:[twoSelected&&(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"align",children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"align-left"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"align-center-horizontal"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"align-right"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"align-top"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"align-center-vertical"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"align-bottom"})]}),(0,jsx_runtime.jsx)(DistributeMenuGroup,{}),twoSelected&&(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"stretch",children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"stretch-horizontal"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"stretch-vertical"})]}),(twoSelected||onlyFlippableShapeSelected)&&(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"flip",children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"flip-horizontal"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"flip-vertical"})]}),(0,jsx_runtime.jsx)(OrderMenuGroup,{})]}):null}function DistributeMenuGroup(){return useUnlockedSelectedShapesCount(3)?(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"distribute",children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"distribute-horizontal"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"distribute-vertical"})]}):null}function OrderMenuGroup(){const twoSelected=useUnlockedSelectedShapesCount(2),threeStackableItems=useThreeStackableItems();return twoSelected?(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"order",children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"pack"}),threeStackableItems&&(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"stack-horizontal"}),threeStackableItems&&(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"stack-vertical"})]}):null}function ReorderMenuSubmenu(){const isReadonlyMode=useReadonly(),oneSelected=useUnlockedSelectedShapesCount(1);return isReadonlyMode?null:oneSelected?(0,jsx_runtime.jsx)(TldrawUiMenuSubmenu,{id:"reorder",label:"context-menu.reorder",size:"small",children:(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"reorder",children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"bring-to-front"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"bring-forward"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"send-backward"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"send-to-back"})]})}):null}function MoveToPageMenu(){const editor=(0,dist_esm.hGv)(),pages=(0,dist_esm.hau)("pages",(()=>editor.getPages()),[editor]),currentPageId=(0,dist_esm.hau)("current page id",(()=>editor.getCurrentPageId()),[editor]),{addToast}=useToasts(),trackEvent=useUiEvents(),isReadonlyMode=useReadonly();return useUnlockedSelectedShapesCount(1)?isReadonlyMode?null:(0,jsx_runtime.jsxs)(TldrawUiMenuSubmenu,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[(0,jsx_runtime.jsx)(TldrawUiMenuGroup,{id:"pages",children:pages.map((page=>(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:page.id,disabled:currentPageId===page.id,label:page.name.length>30?`${page.name.slice(0,30)}â¦`:page.name,onSelect:()=>{editor.markHistoryStoppingPoint("move_shapes_to_page"),editor.moveShapesToPage(editor.getSelectedShapeIds(),page.id);const toPage=editor.getPage(page.id);toPage&&addToast({title:"Changed Page",description:`Moved to ${toPage.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{editor.markHistoryStoppingPoint("change-page"),editor.setCurrentPage(currentPageId)}}]}),trackEvent("move-to-page",{source:"context-menu"})}},page.id)))}),(0,jsx_runtime.jsx)(TldrawUiMenuGroup,{id:"new-page",children:(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"move-to-new-page"})})]}):null}function ConvertToBookmarkMenuItem(){const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("oneEmbedSelected",(()=>{const onlySelectedShape=editor.getOnlySelectedShape();return!!onlySelectedShape&&!(!editor.isShapeOfType(onlySelectedShape,"embed")||!onlySelectedShape.props.url||editor.isShapeOrAncestorLocked(onlySelectedShape))}),[editor])?(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"convert-to-bookmark"}):null}function ConvertToEmbedMenuItem(){const editor=(0,dist_esm.hGv)(),getEmbedDefinition=useGetEmbedDefinition();return(0,dist_esm.hau)("oneEmbeddableBookmarkSelected",(()=>{const onlySelectedShape=editor.getOnlySelectedShape();return!!onlySelectedShape&&!(!(editor.isShapeOfType(onlySelectedShape,"bookmark")&&onlySelectedShape.props.url&&getEmbedDefinition(onlySelectedShape.props.url))||editor.isShapeOrAncestorLocked(onlySelectedShape))}),[editor])?(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"convert-to-embed"}):null}function ToggleSnapModeItem(){const editor=(0,dist_esm.hGv)(),isSnapMode=(0,dist_esm.hau)("isSnapMode",(()=>editor.user.getIsSnapMode()),[editor]);return(0,jsx_runtime.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-snap-mode",checked:isSnapMode})}function ToggleToolLockItem(){const editor=(0,dist_esm.hGv)(),isToolLock=(0,dist_esm.hau)("isToolLock",(()=>editor.getInstanceState().isToolLocked),[editor]);return(0,jsx_runtime.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-tool-lock",checked:isToolLock})}function ToggleGridItem(){const editor=(0,dist_esm.hGv)(),isGridMode=(0,dist_esm.hau)("isGridMode",(()=>editor.getInstanceState().isGridMode),[editor]);return(0,jsx_runtime.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-grid",checked:isGridMode})}function ToggleWrapModeItem(){const editor=(0,dist_esm.hGv)(),isWrapMode=(0,dist_esm.hau)("isWrapMode",(()=>editor.user.getIsWrapMode()),[editor]);return(0,jsx_runtime.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-wrap-mode",checked:isWrapMode})}function ToggleFocusModeItem(){const editor=(0,dist_esm.hGv)(),isFocusMode=(0,dist_esm.hau)("isFocusMode",(()=>editor.getInstanceState().isFocusMode),[editor]);return(0,jsx_runtime.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-focus-mode",checked:isFocusMode})}function ToggleEdgeScrollingItem(){const editor=(0,dist_esm.hGv)(),edgeScrollSpeed=(0,dist_esm.hau)("edgeScrollSpeed",(()=>editor.user.getEdgeScrollSpeed()),[editor]);return(0,jsx_runtime.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-edge-scrolling",checked:1===edgeScrollSpeed})}function ToggleReduceMotionItem(){const editor=(0,dist_esm.hGv)(),animationSpeed=(0,dist_esm.hau)("animationSpeed",(()=>editor.user.getAnimationSpeed()),[editor]);return(0,jsx_runtime.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-reduce-motion",checked:0===animationSpeed})}function ToggleDebugModeItem(){const editor=(0,dist_esm.hGv)(),isDebugMode=(0,dist_esm.hau)("isDebugMode",(()=>editor.getInstanceState().isDebugMode),[editor]);return(0,jsx_runtime.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-debug-mode",checked:isDebugMode})}function ToggleDynamicSizeModeItem(){const editor=(0,dist_esm.hGv)(),isDynamicResizeMode=(0,dist_esm.hau)("dynamic resize",(()=>editor.user.getIsDynamicResizeMode()),[editor]);return(0,jsx_runtime.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-dynamic-size-mode",checked:isDynamicResizeMode})}function TogglePasteAtCursorItem(){const editor=(0,dist_esm.hGv)(),pasteAtCursor=(0,dist_esm.hau)("paste at cursor",(()=>editor.user.getIsPasteAtCursorMode()),[editor]);return(0,jsx_runtime.jsx)(TldrawUiMenuActionCheckboxItem_TldrawUiMenuActionCheckboxItem,{actionId:"toggle-paste-at-cursor",checked:pasteAtCursor})}function CursorChatItem(){const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("show cursor chat",(()=>"select"===editor.getCurrentToolId()&&!editor.getInstanceState().isCoarsePointer),[editor])?(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"open-cursor-chat"}):null}function DefaultContextMenuContent(){const editor=(0,dist_esm.hGv)(),showCollaborationUi=useShowCollaborationUi(),selectToolActive=(0,dist_esm.hau)("isSelectToolActive",(()=>"select"===editor.getCurrentToolId()),[editor]),isSinglePageMode=(0,dist_esm.hau)("isSinglePageMode",(()=>editor.options.maxPages<=1),[editor]);return selectToolActive?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[showCollaborationUi&&(0,jsx_runtime.jsx)(CursorChatItem,{}),(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"modify",children:[(0,jsx_runtime.jsx)(EditMenuSubmenu,{}),(0,jsx_runtime.jsx)(ArrangeMenuSubmenu,{}),(0,jsx_runtime.jsx)(ReorderMenuSubmenu,{}),!isSinglePageMode&&(0,jsx_runtime.jsx)(MoveToPageMenu,{})]}),(0,jsx_runtime.jsx)(ClipboardMenuGroup,{}),(0,jsx_runtime.jsx)(ConversionsMenuGroup,{}),(0,jsx_runtime.jsx)(TldrawUiMenuGroup,{id:"select-all",children:(0,jsx_runtime.jsx)(SelectAllMenuItem,{})})]}):null}const DefaultContextMenu=(0,react.memo)((function DefaultContextMenu2({children,disabled=!1}){const editor=(0,dist_esm.hGv)(),msg=useTranslation_useTranslation(),{Canvas}=(0,dist_esm.BSi)(),cb=(0,react.useCallback)((isOpen2=>{if(isOpen2){if(editor.getInstanceState().isCoarsePointer){const selectedShapes=editor.getSelectedShapes(),{inputs:{currentPagePoint}}=editor,shapesAtPoint=editor.getShapesAtPoint(currentPagePoint);if(!editor.getSelectedShapes().length||!shapesAtPoint.some((s=>selectedShapes.includes(s)))){const lockedShapes=shapesAtPoint.filter((s=>editor.isShapeOrAncestorLocked(s)));lockedShapes.length&&editor.select(...lockedShapes.map((s=>s.id)))}}}else{const onlySelectedShape=editor.getOnlySelectedShape();onlySelectedShape&&editor.isShapeOrAncestorLocked(onlySelectedShape)&&editor.setSelectedShapes([])}}),[editor]),container=(0,dist_esm.NFA)(),[isOpen,handleOpenChange]=useMenuIsOpen("context menu",cb),content=children??(0,jsx_runtime.jsx)(DefaultContextMenuContent,{});return(0,jsx_runtime.jsxs)(dist_Root2,{dir:"ltr",onOpenChange:handleOpenChange,modal:!1,children:[(0,jsx_runtime.jsx)(dist_Trigger,{onContextMenu:void 0,dir:"ltr",disabled,children:Canvas?(0,jsx_runtime.jsx)(Canvas,{}):null}),isOpen&&(0,jsx_runtime.jsx)(dist_Portal2,{container,children:(0,jsx_runtime.jsx)(react_context_menu_dist_Content2,{className:"tlui-menu scrollable","data-testid":"context-menu","aria-label":msg("context-menu.title"),alignOffset:-4,collisionPadding:4,onContextMenu:dist_esm.woC,children:(0,jsx_runtime.jsx)(TldrawUiMenuContextProvider,{type:"context-menu",sourceId:"context-menu",children:content})})})]})})),CursorChatBubble=(0,dist_esm.u4I)((function CursorChatBubble2(){const editor=(0,dist_esm.hGv)(),{isChatting,chatMessage}=editor.getInstanceState(),rTimeout=(0,react.useRef)(-1),[value,setValue]=(0,react.useState)("");return(0,react.useEffect)((()=>{if(!isChatting&&chatMessage||isChatting){const duration=isChatting?5e3:2e3;rTimeout.current=editor.timers.setTimeout((()=>{editor.updateInstanceState({chatMessage:"",isChatting:!1}),setValue(""),editor.focus()}),duration)}return()=>{clearTimeout(rTimeout.current)}}),[editor,chatMessage,isChatting]),isChatting?(0,jsx_runtime.jsx)(CursorChatInput,{value,setValue,chatMessage}):chatMessage.trim()?(0,jsx_runtime.jsx)(NotEditingChatMessage,{chatMessage}):null}));function usePositionBubble(ref){const editor=(0,dist_esm.hGv)();(0,react.useLayoutEffect)((()=>{if(!ref.current)return;const{x,y}=editor.inputs.currentScreenPoint;function positionChatBubble(e){const{minX,minY}=editor.getViewportScreenBounds();ref.current?.style.setProperty("transform",`translate(${e.clientX-minX}px, ${e.clientY-minY}px)`)}return ref.current?.style.setProperty("transform",`translate(${x}px, ${y}px)`),window.addEventListener("pointermove",positionChatBubble),()=>{window.removeEventListener("pointermove",positionChatBubble)}}),[ref,editor])}const NotEditingChatMessage=({chatMessage})=>{const editor=(0,dist_esm.hGv)(),ref=(0,react.useRef)(null);return usePositionBubble(ref),(0,jsx_runtime.jsx)("div",{ref,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:editor.user.getColor()},children:chatMessage})},CursorChatInput=(0,dist_esm.u4I)((function CursorChatInput2({chatMessage,value,setValue}){const editor=(0,dist_esm.hGv)(),msg=useTranslation_useTranslation(),ref=(0,react.useRef)(null),placeholder=chatMessage||msg("cursor-chat.type-to-chat");usePositionBubble(ref),(0,react.useLayoutEffect)((()=>{const elm=ref.current;if(!elm)return;const textMeasurement=editor.textMeasure.measureText(value||placeholder,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});elm.style.setProperty("width",textMeasurement.w+"px")}),[editor,value,placeholder]),(0,react.useLayoutEffect)((()=>{const raf=editor.timers.requestAnimationFrame((()=>{ref.current?.focus()}));return()=>{cancelAnimationFrame(raf)}}),[editor]);const stopChatting=(0,react.useCallback)((()=>{editor.updateInstanceState({isChatting:!1}),editor.focus()}),[editor]),handleChange=(0,react.useCallback)((e=>{const{value:value2}=e.target;setValue(value2.slice(0,64)),editor.updateInstanceState({chatMessage:value2})}),[editor,setValue]),handleKeyDown=(0,react.useCallback)((e=>{const elm=ref.current;if(!elm)return;const{value:currentValue}=elm;switch(e.key){case"Enter":if((0,dist_esm.woC)(e),e.stopPropagation(),!currentValue)return void stopChatting();setValue("");break;case"Escape":(0,dist_esm.woC)(e),e.stopPropagation(),stopChatting()}}),[stopChatting,setValue]),handlePaste=(0,react.useCallback)((e=>{e.stopPropagation()}),[]);return(0,jsx_runtime.jsx)("input",{ref,className:"tl-cursor-chat",style:{backgroundColor:editor.user.getColor()},onBlur:stopChatting,onChange:handleChange,onKeyDown:handleKeyDown,onPaste:handlePaste,value,placeholder,spellCheck:!1})}));function TldrawUiButtonCheck({checked}){const msg=useTranslation_useTranslation();return(0,jsx_runtime.jsx)(TldrawUiIcon_TldrawUiIcon,{label:msg(checked?"ui.checked":"ui.unchecked"),icon:checked?"check":"none",className:"tlui-button__icon",small:!0})}function DefaultDebugMenuContent(){const editor=(0,dist_esm.hGv)(),{addToast}=useToasts(),{addDialog}=useDialogs(),[error,setError]=react.useState(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"items",children:[(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"hard-reset",onSelect:dist_esm.W$r,label:"Hard reset"}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"add-toast",onSelect:()=>{addToast({id:(0,dist_esm.NF7)(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),addToast({id:(0,dist_esm.NF7)(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),addToast({id:(0,dist_esm.NF7)(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),addToast({id:(0,dist_esm.NF7)(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"show-dialog",label:"Show dialog",onSelect:()=>{addDialog({component:({onClose})=>(0,jsx_runtime.jsx)(ExampleDialog,{displayDontShowAgain:!0,onCancel:()=>onClose(),onContinue:()=>onClose()}),onClose:()=>{}})}}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>function createNShapes(editor,n){const gap=editor.options.adjacentShapeMargin,shapesToCreate=Array(n),cols=Math.floor(Math.sqrt(n));for(let i=0;i<n;i++)t++,shapesToCreate[i]={id:(0,dist_esm.n6Y)("box"+t),type:"geo",x:i%cols*(100+gap),y:Math.floor(i/cols)*(100+gap)};editor.run((()=>{editor.createShapes(shapesToCreate).setSelectedShapes(shapesToCreate.map((s=>s.id)))}))}(editor,100)}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{const selectedShapes=editor.getSelectedShapes(),shapes=0===selectedShapes.length?editor.getRenderingShapes():selectedShapes;window.alert(`Shapes ${shapes.length}, DOM nodes:${document.querySelector(".tl-shapes").querySelectorAll("*")?.length}`)}}),(()=>{if(error)throw Error("oh no!");return null})(),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"throw-error",onSelect:()=>setError(!0),label:"Throw error"})]}),(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"flags",children:[(0,jsx_runtime.jsx)(DebugFlags,{}),(0,jsx_runtime.jsx)(FeatureFlags,{})]})]})}function DebugFlags(){const items=Object.values(dist_esm.bGJ);return items.length?(0,jsx_runtime.jsx)(TldrawUiMenuSubmenu,{id:"debug flags",label:"Debug Flags",children:(0,jsx_runtime.jsx)(TldrawUiMenuGroup,{id:"debug flags",children:items.map((flag=>(0,jsx_runtime.jsx)(DebugFlagToggle,{flag},flag.name)))})}):null}function FeatureFlags(){const items=Object.values(dist_esm.ofH);return items.length?(0,jsx_runtime.jsx)(TldrawUiMenuSubmenu,{id:"feature flags",label:"Feature Flags",children:(0,jsx_runtime.jsx)(TldrawUiMenuGroup,{id:"feature flags",children:items.map((flag=>(0,jsx_runtime.jsx)(DebugFlagToggle,{flag},flag.name)))})}):null}function ExampleDialog({title="title",body="hello hello hello",cancel="Cancel",confirm="Continue",displayDontShowAgain=!1,maxWidth="350",onCancel,onContinue}){const[dontShowAgain,setDontShowAgain]=react.useState(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(TldrawUiDialogHeader,{children:[(0,jsx_runtime.jsx)(TldrawUiDialogTitle,{children:title}),(0,jsx_runtime.jsx)(TldrawUiDialogCloseButton,{})]}),(0,jsx_runtime.jsx)(TldrawUiDialogBody,{style:{maxWidth},children:body}),(0,jsx_runtime.jsxs)(TldrawUiDialogFooter,{className:"tlui-dialog__footer__actions",children:[displayDontShowAgain&&(0,jsx_runtime.jsxs)(TldrawUiButton,{type:"normal",onClick:()=>setDontShowAgain(!dontShowAgain),style:{marginRight:"auto"},children:[(0,jsx_runtime.jsx)(TldrawUiButtonCheck,{checked:dontShowAgain}),(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:"Donât show again"})]}),(0,jsx_runtime.jsx)(TldrawUiButton,{type:"normal",onClick:onCancel,children:(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:cancel})}),(0,jsx_runtime.jsx)(TldrawUiButton,{type:"primary",onClick:async()=>onContinue(),children:(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:confirm})})]})]})}const DebugFlagToggle=(0,dist_esm.u4I)((function DebugFlagToggle2({flag,onChange}){const value=flag.get();return(0,jsx_runtime.jsx)(TldrawUiMenuCheckboxItem,{id:flag.name,title:flag.name,label:flag.name.replace(/([a-z0-9])([A-Z])/g,(m=>`${m[0]} ${m[1].toLowerCase()}`)).replace(/^[a-z]/,(m=>m.toUpperCase())),checked:value,onSelect:()=>{flag.set(!value),onChange?.(!value)}})}));let t=0;function DefaultDebugMenu({children}){const content=children??(0,jsx_runtime.jsx)(DefaultDebugMenuContent,{});return(0,jsx_runtime.jsxs)(TldrawUiDropdownMenuRoot,{id:"debug",children:[(0,jsx_runtime.jsx)(TldrawUiDropdownMenuTrigger,{children:(0,jsx_runtime.jsx)(TldrawUiButton,{type:"icon",title:"Debug menu",children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:"dots-horizontal"})})}),(0,jsx_runtime.jsx)(TldrawUiDropdownMenuContent,{side:"top",align:"end",alignOffset:0,children:(0,jsx_runtime.jsx)(TldrawUiMenuContextProvider,{type:"menu",sourceId:"debug-panel",children:content})})]})}const DefaultDebugPanel=(0,react.memo)((function DefaultDebugPanel2(){const{DebugMenu}=useTldrawUiComponents(),ref=(0,react.useRef)(null);return(0,dist_esm.I9L)(ref),(0,jsx_runtime.jsxs)("footer",{ref,className:"tlui-debug-panel",children:[(0,jsx_runtime.jsx)(CurrentState,{}),(0,jsx_runtime.jsx)(FPS,{}),DebugMenu&&(0,jsx_runtime.jsx)(DebugMenu,{})]})}));const CurrentState=(0,dist_esm.u4I)((function CurrentState2(){!function useTick(isEnabled=!0){const[_,setTick]=(0,react.useState)(0),editor=(0,dist_esm.hGv)();(0,react.useEffect)((()=>{if(!isEnabled)return;const update=()=>setTick((tick=>tick+1));return editor.on("tick",update),()=>{editor.off("tick",update)}}),[editor,isEnabled])}();const editor=(0,dist_esm.hGv)(),path=editor.getPath(),hoverShape=editor.getHoveredShape(),selectedShape=editor.getOnlySelectedShape(),shape="select.idle"!==path&&path.includes("select.")?selectedShape:hoverShape,shapeInfo=shape&&path.includes("select.")?` / ${shape.type||""}${"geo"in shape.props?" / "+shape.props.geo:""} / [${dist_esm.l2P.ToInt(editor.getPointInShapeSpace(shape,editor.inputs.currentPagePoint))}]`:"",ruler=path.startsWith("select.")&&!path.includes(".idle")?` / [${dist_esm.l2P.ToInt(editor.inputs.originPagePoint)}] â [${dist_esm.l2P.ToInt(editor.inputs.currentPagePoint)}] = ${dist_esm.l2P.Dist(editor.inputs.originPagePoint,editor.inputs.currentPagePoint).toFixed(0)}`:"";return(0,jsx_runtime.jsx)("div",{className:"tlui-debug-panel__current-state",children:`${path}${shapeInfo}${ruler}`})}));function FPS(){const editor=(0,dist_esm.hGv)(),showFps=(0,dist_esm.hau)("show_fps",(()=>dist_esm.bGJ.showFps.get()),[dist_esm.bGJ]),fpsRef=(0,react.useRef)(null);return(0,react.useEffect)((()=>{if(!showFps)return;let maxKnownFps=0,raf=-1,start=performance.now(),currentTickLength=0,framesInCurrentTick=0,isSlow=!1;return function loop(){if(framesInCurrentTick++,currentTickLength=performance.now()-start,currentTickLength>250){const fps=Math.round(framesInCurrentTick*(250/currentTickLength)*4);fps>maxKnownFps&&(maxKnownFps=fps);const slowFps=.75*maxKnownFps;(fps<slowFps&&!isSlow||fps>=slowFps&&isSlow)&&(isSlow=!isSlow),fpsRef.current.innerHTML=`FPS ${fps.toString()}`,fpsRef.current.className="tlui-debug-panel__fps"+(isSlow?" tlui-debug-panel__fps__slow":""),currentTickLength-=250,framesInCurrentTick=0,start=performance.now()}raf=editor.timers.requestAnimationFrame(loop)}(),()=>{cancelAnimationFrame(raf)}}),[showFps,editor]),showFps?(0,jsx_runtime.jsx)("div",{ref:fpsRef}):null}const DefaultMenuPanel=(0,react.memo)((function MenuPanel(){const breakpoint=useBreakpoint(),msg=useTranslation_useTranslation(),ref=(0,react.useRef)(null);(0,dist_esm.I9L)(ref);const{MainMenu,QuickActions,ActionsMenu,PageMenu}=useTldrawUiComponents(),editor=(0,dist_esm.hGv)(),isSinglePageMode=(0,dist_esm.hau)("isSinglePageMode",(()=>editor.options.maxPages<=1),[editor]),showQuickActions="menu"===editor.options.actionShortcutsLocation||"toolbar"!==editor.options.actionShortcutsLocation&&breakpoint>=PORTRAIT_BREAKPOINT.TABLET;return MainMenu||PageMenu||showQuickActions?(0,jsx_runtime.jsx)("nav",{ref,className:"tlui-menu-zone",children:(0,jsx_runtime.jsxs)("div",{className:"tlui-buttons__horizontal",children:[MainMenu&&(0,jsx_runtime.jsx)(MainMenu,{}),PageMenu&&!isSinglePageMode&&(0,jsx_runtime.jsx)(PageMenu,{}),showQuickActions?(0,jsx_runtime.jsxs)(TldrawUiToolbar,{className:"tlui-buttons__horizontal",label:msg("actions-menu.title"),children:[QuickActions&&(0,jsx_runtime.jsx)(QuickActions,{}),ActionsMenu&&(0,jsx_runtime.jsx)(ActionsMenu,{})]}):null]})}):null}));function BackToContent(){const editor=(0,dist_esm.hGv)(),actions=useActions(),[showBackToContent,setShowBackToContent]=(0,react.useState)(!1),rIsShowing=(0,react.useRef)(!1);return(0,dist_esm.lXS)("toggle showback to content",(()=>{const showBackToContentPrev=rIsShowing.current,shapeIds=editor.getCurrentPageShapeIds();let showBackToContentNow=!1;shapeIds.size&&(showBackToContentNow=shapeIds.size===editor.getCulledShapes().size),showBackToContentPrev!==showBackToContentNow&&(setShowBackToContent(showBackToContentNow),rIsShowing.current=showBackToContentNow)}),[editor]),showBackToContent?(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"back-to-content",onSelect:()=>{actions["back-to-content"].onSelect("helper-buttons"),setShowBackToContent(!1)}}):null}function ExitPenMode(){const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("is pen mode",(()=>editor.getInstanceState().isPenMode),[editor])?(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"exit-pen-mode"}):null}function StopFollowing(){const editor=(0,dist_esm.hGv)(),actions=useActions();return(0,dist_esm.hau)("is following user",(()=>!!editor.getInstanceState().followingUserId),[editor])?(0,jsx_runtime.jsx)(TldrawUiMenuItem,{...actions["stop-following"]}):null}function DefaultHelperButtonsContent(){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ExitPenMode,{}),(0,jsx_runtime.jsx)(BackToContent,{}),(0,jsx_runtime.jsx)(StopFollowing,{})]})}function DefaultHelperButtons({children}){const content=children??(0,jsx_runtime.jsx)(DefaultHelperButtonsContent,{});return(0,jsx_runtime.jsx)("div",{className:"tlui-helper-buttons",children:(0,jsx_runtime.jsx)(TldrawUiMenuContextProvider,{type:"helper-buttons",sourceId:"helper-buttons",children:content})})}function DefaultKeyboardShortcutsDialogContent(){const showCollaborationUi=useShowCollaborationUi();return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.tools",id:"tools",children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"toggle-tool-lock"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"insert-media"}),(0,jsx_runtime.jsx)(TldrawUiMenuToolItem,{toolId:"select"}),(0,jsx_runtime.jsx)(TldrawUiMenuToolItem,{toolId:"draw"}),(0,jsx_runtime.jsx)(TldrawUiMenuToolItem,{toolId:"eraser"}),(0,jsx_runtime.jsx)(TldrawUiMenuToolItem,{toolId:"hand"}),(0,jsx_runtime.jsx)(TldrawUiMenuToolItem,{toolId:"rectangle"}),(0,jsx_runtime.jsx)(TldrawUiMenuToolItem,{toolId:"ellipse"}),(0,jsx_runtime.jsx)(TldrawUiMenuToolItem,{toolId:"arrow"}),(0,jsx_runtime.jsx)(TldrawUiMenuToolItem,{toolId:"line"}),(0,jsx_runtime.jsx)(TldrawUiMenuToolItem,{toolId:"text"}),(0,jsx_runtime.jsx)(TldrawUiMenuToolItem,{toolId:"frame"}),(0,jsx_runtime.jsx)(TldrawUiMenuToolItem,{toolId:"note"}),(0,jsx_runtime.jsx)(TldrawUiMenuToolItem,{toolId:"laser"}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"pointer-down",label:"tool.pointer-down",kbd:",",onSelect:()=>{}})]}),(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.preferences",id:"preferences",children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"toggle-dark-mode"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"toggle-focus-mode"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"toggle-grid"})]}),(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.edit",id:"edit",children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"undo"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"redo"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"cut"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"copy"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"paste"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"select-all"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"delete"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"duplicate"})]}),(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.view",id:"view",children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"zoom-in"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"zoom-out"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"zoom-to-100"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"zoom-to-fit"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"zoom-to-selection"})]}),(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.transform",id:"transform",children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"bring-to-front"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"bring-forward"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"send-backward"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"send-to-back"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"group"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"ungroup"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"flip-horizontal"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"flip-vertical"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"align-top"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"align-center-vertical"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"align-bottom"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"align-left"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"align-center-horizontal"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"align-right"})]}),(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.text-formatting",id:"text",children:[(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"text-bold",label:"tool.rich-text-bold",kbd:"cmd+b",onSelect:()=>{}}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"text-italic",label:"tool.rich-text-italic",kbd:"cmd+i",onSelect:()=>{}}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"text-code",label:"tool.rich-text-code",kbd:"cmd+e",onSelect:()=>{}}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"text-highlight",label:"tool.rich-text-highlight",kbd:"cmd+shift+h",onSelect:()=>{}}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"text-strikethrough",label:"tool.rich-text-strikethrough",kbd:"cmd+shift+s",onSelect:()=>{}}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"text-link",label:"tool.rich-text-link",kbd:"cmd+shift+k",onSelect:()=>{}}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"text-header",label:"tool.rich-text-header",kbd:"cmd+shift+[[1-6]]",onSelect:()=>{}}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"text-orderedList",label:"tool.rich-text-orderedList",kbd:"cmd+shift+7",onSelect:()=>{}}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"text-bulletedlist",label:"tool.rich-text-bulletList",kbd:"cmd+shift+8",onSelect:()=>{}})]}),(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.a11y",id:"a11y",children:[(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"a11y-select-next-shape",label:"a11y.select-shape",kbd:"[[Tab]]",onSelect:()=>{}}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"a11y-select-next-shape-direction",label:"a11y.select-shape-direction",kbd:"cmd+ââââ",onSelect:()=>{}}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"a11y-select-next-shape-container",label:"a11y.enter-leave-container",kbd:"cmd+shift+ââ",onSelect:()=>{}}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"a11y-pan-camera",label:"a11y.pan-camera",kbd:"[[Space]]+ââââ",onSelect:()=>{}}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"adjust-shape-styles",label:"a11y.adjust-shape-styles",kbd:"$+[[Enter]]",onSelect:()=>{}}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"a11y-move-shape",label:"a11y.move-shape",kbd:"ââââ",onSelect:()=>{}}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"a11y-move-shape-faster",label:"a11y.move-shape-faster",kbd:"shift+ââââ",onSelect:()=>{}}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"enlarge-shapes"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"shrink-shapes"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"a11y-repeat-shape-announce"})]}),showCollaborationUi&&(0,jsx_runtime.jsx)(TldrawUiMenuGroup,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"open-cursor-chat"})})]})}const DefaultKeyboardShortcutsDialog=(0,react.memo)((function DefaultKeyboardShortcutsDialog2({children}){const msg=useTranslation_useTranslation(),breakpoint=useBreakpoint(),content=children??(0,jsx_runtime.jsx)(DefaultKeyboardShortcutsDialogContent,{});return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(TldrawUiDialogHeader,{className:"tlui-shortcuts-dialog__header",children:[(0,jsx_runtime.jsx)(TldrawUiDialogTitle,{children:msg("shortcuts-dialog.title")}),(0,jsx_runtime.jsx)(TldrawUiDialogCloseButton,{})]}),(0,jsx_runtime.jsx)(TldrawUiDialogBody,{className:classnames_default()("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":breakpoint<=PORTRAIT_BREAKPOINT.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":breakpoint<=PORTRAIT_BREAKPOINT.TABLET}),children:(0,jsx_runtime.jsx)(TldrawUiMenuContextProvider,{type:"keyboard-shortcuts",sourceId:"kbd",children:content})}),(0,jsx_runtime.jsx)("div",{className:"tlui-dialog__scrim"})]})}));function LanguageMenu(){const editor=(0,dist_esm.frr)(),trackEvent=useUiEvents(),currentLanguage=(0,dist_esm.hau)("locale",(()=>editor?.user.getLocale()),[editor]);return editor?(0,jsx_runtime.jsx)(TldrawUiMenuSubmenu,{id:"help menu language",label:"menu.language",children:(0,jsx_runtime.jsx)(TldrawUiMenuGroup,{id:"languages",className:"tlui-language-menu",children:dist_esm.Yjb.map((({locale,label})=>(0,jsx_runtime.jsx)(TldrawUiMenuCheckboxItem,{id:`language-${locale}`,title:locale,label,checked:locale===currentLanguage,readonlyOk:!0,onSelect:()=>{editor.user.updateUserPreferences({locale}),trackEvent("change-language",{source:"menu",locale})}},locale)))})}):null}function DefaultHelpMenuContent(){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LanguageMenu,{}),(0,jsx_runtime.jsx)(KeyboardShortcutsMenuItem,{})]})}function KeyboardShortcutsMenuItem(){const{KeyboardShortcutsDialog}=useTldrawUiComponents(),{addDialog}=useDialogs(),handleSelect=(0,react.useCallback)((()=>{KeyboardShortcutsDialog&&addDialog({component:KeyboardShortcutsDialog})}),[addDialog,KeyboardShortcutsDialog]);return KeyboardShortcutsDialog?(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:handleSelect}):null}function DefaultMainMenuContent(){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"basic",children:[(0,jsx_runtime.jsx)(EditSubmenu,{}),(0,jsx_runtime.jsx)(ViewSubmenu,{}),(0,jsx_runtime.jsx)(ExportFileContentSubMenu,{}),(0,jsx_runtime.jsx)(ExtrasGroup,{})]}),(0,jsx_runtime.jsx)(PreferencesGroup,{})]})}function ExportFileContentSubMenu(){return(0,jsx_runtime.jsxs)(TldrawUiMenuSubmenu,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"export-all-as-group",children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"export-all-as-svg"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"export-all-as-png"})]}),(0,jsx_runtime.jsx)(TldrawUiMenuGroup,{id:"export-all-as-bg",children:(0,jsx_runtime.jsx)(ToggleTransparentBgMenuItem,{})})]})}function EditSubmenu(){return(0,jsx_runtime.jsxs)(TldrawUiMenuSubmenu,{id:"edit",label:"menu.edit",children:[(0,jsx_runtime.jsx)(UndoRedoGroup,{}),(0,jsx_runtime.jsx)(ClipboardMenuGroup,{}),(0,jsx_runtime.jsx)(ConversionsMenuGroup,{}),(0,jsx_runtime.jsx)(MiscMenuGroup,{}),(0,jsx_runtime.jsx)(LockGroup,{}),(0,jsx_runtime.jsx)(TldrawUiMenuGroup,{id:"select-all",children:(0,jsx_runtime.jsx)(SelectAllMenuItem,{})})]})}function MiscMenuGroup(){return(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"misc",children:[(0,jsx_runtime.jsx)(menu_items_GroupMenuItem,{}),(0,jsx_runtime.jsx)(menu_items_UngroupMenuItem,{}),(0,jsx_runtime.jsx)(menu_items_EditLinkMenuItem,{}),(0,jsx_runtime.jsx)(ToggleAutoSizeMenuItem,{}),(0,jsx_runtime.jsx)(RemoveFrameMenuItem,{}),(0,jsx_runtime.jsx)(FitFrameToContentMenuItem,{}),(0,jsx_runtime.jsx)(ConvertToEmbedMenuItem,{}),(0,jsx_runtime.jsx)(ConvertToBookmarkMenuItem,{}),(0,jsx_runtime.jsx)(FlattenMenuItem,{})]})}function LockGroup(){return(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"lock",children:[(0,jsx_runtime.jsx)(ToggleLockMenuItem,{}),(0,jsx_runtime.jsx)(UnlockAllMenuItem,{})]})}function UndoRedoGroup(){const canUndo=useCanUndo(),canRedo=useCanRedo();return(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"undo-redo",children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"undo",disabled:!canUndo}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"redo",disabled:!canRedo})]})}function ViewSubmenu(){return(0,jsx_runtime.jsx)(TldrawUiMenuSubmenu,{id:"view",label:"menu.view",children:(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"view-actions",children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"zoom-in"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"zoom-out"}),(0,jsx_runtime.jsx)(menu_items_ZoomTo100MenuItem,{}),(0,jsx_runtime.jsx)(ZoomToFitMenuItem,{}),(0,jsx_runtime.jsx)(ZoomToSelectionMenuItem,{})]})})}function ExtrasGroup(){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"insert-embed"}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"insert-media"})]})}function PreferencesGroup(){return(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"preferences",children:[(0,jsx_runtime.jsxs)(TldrawUiMenuSubmenu,{id:"preferences",label:"menu.preferences",children:[(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"preferences-actions",children:[(0,jsx_runtime.jsx)(ToggleSnapModeItem,{}),(0,jsx_runtime.jsx)(ToggleToolLockItem,{}),(0,jsx_runtime.jsx)(ToggleGridItem,{}),(0,jsx_runtime.jsx)(ToggleWrapModeItem,{}),(0,jsx_runtime.jsx)(ToggleFocusModeItem,{}),(0,jsx_runtime.jsx)(ToggleEdgeScrollingItem,{}),(0,jsx_runtime.jsx)(ToggleReduceMotionItem,{}),(0,jsx_runtime.jsx)(ToggleDynamicSizeModeItem,{}),(0,jsx_runtime.jsx)(TogglePasteAtCursorItem,{}),(0,jsx_runtime.jsx)(ToggleDebugModeItem,{})]}),(0,jsx_runtime.jsx)(TldrawUiMenuGroup,{id:"color-scheme",children:(0,jsx_runtime.jsx)(ColorSchemeMenu,{})})]}),(0,jsx_runtime.jsx)(LanguageMenu,{}),(0,jsx_runtime.jsx)(KeyboardShortcutsMenuItem,{})]})}const DefaultMainMenu=(0,react.memo)((function DefaultMainMenu2({children}){const container=(0,dist_esm.NFA)(),[isOpen,onOpenChange]=useMenuIsOpen("main menu"),msg=useTranslation_useTranslation(),content=children??(0,jsx_runtime.jsx)(DefaultMainMenuContent,{});return(0,jsx_runtime.jsxs)(Root2,{dir:"ltr",open:isOpen,onOpenChange,modal:!1,children:[(0,jsx_runtime.jsx)(Trigger,{asChild:!0,dir:"ltr",children:(0,jsx_runtime.jsx)(TldrawUiButton,{type:"icon","data-testid":"main-menu.button",title:msg("menu.title"),children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:"menu",small:!0})})}),(0,jsx_runtime.jsx)(Portal2,{container,children:(0,jsx_runtime.jsx)(dist_Content2,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:(0,jsx_runtime.jsx)(TldrawUiMenuContextProvider,{type:"menu",sourceId:"main-menu",children:content})})})]})})),memo={};function getRgba(colorString){if(memo[colorString])return memo[colorString];const context=document.createElement("canvas").getContext("2d");context.fillStyle=colorString,context.fillRect(0,0,1,1);const[r,g,b,a]=context.getImageData(0,0,1,1).data,result=new Float32Array([r/255,g/255,b/255,a/255]);return memo[colorString]=result,result}function pie(array,{center,radius,numArcSegments=20,startAngle=0,endAngle=dist_esm.uAR,offset=0}){const angle=(endAngle-startAngle)/numArcSegments;let i=offset;for(let a=startAngle;a<endAngle;a+=angle)array[i++]=center.x,array[i++]=center.y,array[i++]=center.x+Math.cos(a)*radius,array[i++]=center.y+Math.sin(a)*radius,array[i++]=center.x+Math.cos(a+angle)*radius,array[i++]=center.y+Math.sin(a+angle)*radius;return array}function rectangle(array,offset,x,y,w,h){array[offset++]=x,array[offset++]=y,array[offset++]=x,array[offset++]=y+h,array[offset++]=x+w,array[offset++]=y,array[offset++]=x+w,array[offset++]=y,array[offset++]=x,array[offset++]=y+h,array[offset++]=x+w,array[offset++]=y+h}function allocateBuffer(context,size){const buffer=context.createBuffer();if(!buffer)throw new Error("Failed to create buffer");return{buffer,vertices:new Float32Array(size)}}function appendVertices(bufferStuff,offset,data){let len=bufferStuff.vertices.length;for(;len<offset+data.length;)len*=2;if(len!=bufferStuff.vertices.length){const newVertices=new Float32Array(len);newVertices.set(bufferStuff.vertices),bufferStuff.vertices=newVertices}bufferStuff.vertices.set(data,offset)}var _render_dec,_getCanvasPageBoundsArray_dec,_getZoom_dec,_getCanvasPageBounds_dec,_getCanvasClientPosition_dec,_getCanvasSize_dec,_getContentScreenBounds_dec,_getContentPageBounds_dec,_getDpr_dec,_close_dec,MinimapManager_init,MinimapManager_create=Object.create,MinimapManager_defProp=Object.defineProperty,MinimapManager_getOwnPropDesc=Object.getOwnPropertyDescriptor,MinimapManager_knownSymbol=(name,symbol)=>(symbol=Symbol[name])?symbol:Symbol.for("Symbol."+name),MinimapManager_typeError=msg=>{throw TypeError(msg)},MinimapManager_defNormalProp=(obj,key,value)=>key in obj?MinimapManager_defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,MinimapManager_name=(target,value)=>MinimapManager_defProp(target,"name",{value,configurable:!0}),MinimapManager_decoratorStrings=["class","method","getter","setter","accessor","field","value","get","set"],MinimapManager_expectFn=fn=>void 0!==fn&&"function"!=typeof fn?MinimapManager_typeError("Function expected"):fn,MinimapManager_decoratorContext=(kind,name,done,metadata,fns)=>({kind:MinimapManager_decoratorStrings[kind],name,metadata,addInitializer:fn=>done._?MinimapManager_typeError("Already initialized"):fns.push(MinimapManager_expectFn(fn||null))}),MinimapManager_decoratorMetadata=(array,target)=>MinimapManager_defNormalProp(target,MinimapManager_knownSymbol("metadata"),array[3]),MinimapManager_decorateElement=(array,flags,name,decorators,target,extra)=>{var fn,it,done,ctx,access,k=7&flags,s=!!(8&flags),p=!!(16&flags),j=k>3?array.length+1:k?s?1:2:0,key=MinimapManager_decoratorStrings[k+5],initializers=k>3&&(array[j-1]=[]),extraInitializers=array[j]||(array[j]=[]),desc=k&&(!p&&!s&&(target=target.prototype),k<5&&(k>3||!p)&&MinimapManager_getOwnPropDesc(k<4?target:{get[name](){return MinimapManager_privateGet(this,extra)},set[name](x){return MinimapManager_privateSet(this,extra,x)}},name));k?p&&k<4&&MinimapManager_name(extra,(k>2?"set ":k>1?"get ":"")+name):MinimapManager_name(target,name);for(var i=decorators.length-1;i>=0;i--)ctx=MinimapManager_decoratorContext(k,name,done={},array[3],extraInitializers),k&&(ctx.static=s,ctx.private=p,access=ctx.access={has:p?x=>MinimapManager_privateIn(target,x):x=>name in x},3^k&&(access.get=p?x=>(1^k?MinimapManager_privateGet:MinimapManager_privateMethod)(x,target,4^k?extra:desc.get):x=>x[name]),k>2&&(access.set=p?(x,y)=>MinimapManager_privateSet(x,target,y,4^k?extra:desc.set):(x,y)=>x[name]=y)),it=(0,decorators[i])(k?k<4?p?extra:desc[key]:k>4?void 0:{get:desc.get,set:desc.set}:target,ctx),done._=1,4^k||void 0===it?MinimapManager_expectFn(it)&&(k>4?initializers.unshift(it):k?p?extra=it:desc[key]=it:target=it):"object"!=typeof it||null===it?MinimapManager_typeError("Object expected"):(MinimapManager_expectFn(fn=it.get)&&(desc.get=fn),MinimapManager_expectFn(fn=it.set)&&(desc.set=fn),MinimapManager_expectFn(fn=it.init)&&initializers.unshift(fn));return k||MinimapManager_decoratorMetadata(array,target),desc&&MinimapManager_defProp(target,name,desc),p?4^k?extra:desc:target},MinimapManager_publicField=(obj,key,value)=>MinimapManager_defNormalProp(obj,"symbol"!=typeof key?key+"":key,value),MinimapManager_accessCheck=(obj,member,msg)=>member.has(obj)||MinimapManager_typeError("Cannot "+msg),MinimapManager_privateIn=(member,obj)=>Object(obj)!==obj?MinimapManager_typeError('Cannot use the "in" operator on this value'):member.has(obj),MinimapManager_privateGet=(obj,member,getter)=>(MinimapManager_accessCheck(obj,member,"read from private field"),getter?getter.call(obj):member.get(obj)),MinimapManager_privateSet=(obj,member,value,setter)=>(MinimapManager_accessCheck(obj,member,"write to private field"),setter?setter.call(obj,value):member.set(obj,value),value),MinimapManager_privateMethod=(obj,member,method)=>(MinimapManager_accessCheck(obj,member,"access private method"),method);_close_dec=[dist_esm.oIE],_getDpr_dec=[dist_esm.EWP],_getContentPageBounds_dec=[dist_esm.EWP],_getContentScreenBounds_dec=[dist_esm.EWP],_getCanvasSize_dec=[dist_esm.EWP],_getCanvasClientPosition_dec=[dist_esm.EWP],_getCanvasPageBounds_dec=[dist_esm.EWP],_getZoom_dec=[dist_esm.EWP],_getCanvasPageBoundsArray_dec=[dist_esm.EWP],_render_dec=[dist_esm.oIE];class MinimapManager{constructor(editor,elem,container){this.editor=editor,this.elem=elem,this.container=container,((array,flags,self,value)=>{for(var i=0,fns=array[flags>>1],n=fns&&fns.length;i<n;i++)1&flags?fns[i].call(self):value=fns[i].call(self,value)})(MinimapManager_init,5,this),MinimapManager_publicField(this,"disposables",[]),MinimapManager_publicField(this,"gl"),MinimapManager_publicField(this,"shapeGeometryCache"),MinimapManager_publicField(this,"colors"),MinimapManager_publicField(this,"id",(0,dist_esm.NF7)()),MinimapManager_publicField(this,"canvasBoundingClientRect",(0,dist_esm.eUv)("canvasBoundingClientRect",new dist_esm.azJ)),MinimapManager_publicField(this,"originPagePoint",new dist_esm.l2P),MinimapManager_publicField(this,"originPageCenter",new dist_esm.l2P),MinimapManager_publicField(this,"isInViewport",!1),this.gl=function setupWebGl(canvas){if(!canvas)throw new Error("Canvas element not found");const context=canvas.getContext("webgl2",{premultipliedAlpha:!1});if(!context)throw new Error("Failed to get webgl2 context");const vertexShader=context.createShader(context.VERTEX_SHADER);if(!vertexShader)throw new Error("Failed to create vertex shader");if(context.shaderSource(vertexShader,"#version 300 es\n  precision mediump float;\n  \n  in vec2 shapeVertexPosition;\n\n\tuniform vec4 canvasPageBounds;\n\n\t// taken (with thanks) from\n\t// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html\n  void main() {\n\t\t// convert the position from pixels to 0.0 to 1.0\n\t\tvec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;\n\t\n\t\t// convert from 0->1 to 0->2\n\t\tvec2 zeroToTwo = zeroToOne * 2.0;\n\t\n\t\t// convert from 0->2 to -1->+1 (clipspace)\n\t\tvec2 clipSpace = zeroToTwo - 1.0;\n\t\n\t\tgl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n  }"),context.compileShader(vertexShader),!context.getShaderParameter(vertexShader,context.COMPILE_STATUS))throw new Error("Failed to compile vertex shader");const fragmentShader=context.createShader(context.FRAGMENT_SHADER);if(!fragmentShader)throw new Error("Failed to create fragment shader");if(context.shaderSource(fragmentShader,"#version 300 es\n  precision mediump float;\n  \n\tuniform vec4 fillColor;\n  out vec4 outputColor;\n\n  void main() {\n\toutputColor = fillColor;\n  }"),context.compileShader(fragmentShader),!context.getShaderParameter(fragmentShader,context.COMPILE_STATUS))throw new Error("Failed to compile fragment shader");const program=context.createProgram();if(!program)throw new Error("Failed to create program");if(context.attachShader(program,vertexShader),context.attachShader(program,fragmentShader),context.linkProgram(program),!context.getProgramParameter(program,context.LINK_STATUS))throw new Error("Failed to link program");context.useProgram(program);const shapeVertexPositionAttributeLocation=context.getAttribLocation(program,"shapeVertexPosition");if(shapeVertexPositionAttributeLocation<0)throw new Error("Failed to get shapeVertexPosition attribute location");context.enableVertexAttribArray(shapeVertexPositionAttributeLocation);const canvasPageBoundsLocation=context.getUniformLocation(program,"canvasPageBounds"),fillColorLocation=context.getUniformLocation(program,"fillColor");if(!context.createBuffer())throw new Error("Failed to create buffer");if(!context.createBuffer())throw new Error("Failed to create buffer");return{context,selectedShapes:allocateBuffer(context,1024),unselectedShapes:allocateBuffer(context,4096),viewport:allocateBuffer(context,300),collaborators:allocateBuffer(context,1024),prepareTriangles(stuff,len){context.bindBuffer(context.ARRAY_BUFFER,stuff.buffer),context.bufferData(context.ARRAY_BUFFER,stuff.vertices,context.STATIC_DRAW,0,len),context.enableVertexAttribArray(shapeVertexPositionAttributeLocation),context.vertexAttribPointer(shapeVertexPositionAttributeLocation,2,context.FLOAT,!1,0,0)},drawTrianglesTransparently(len){context.enable(context.BLEND),context.blendFunc(context.SRC_ALPHA,context.ONE_MINUS_SRC_ALPHA),context.drawArrays(context.TRIANGLES,0,len/2),context.disable(context.BLEND)},drawTriangles(len){context.drawArrays(context.TRIANGLES,0,len/2)},setFillColor(color){context.uniform4fv(fillColorLocation,color)},setCanvasPageBounds(bounds){context.uniform4fv(canvasPageBoundsLocation,bounds)}}}(elem),this.shapeGeometryCache=editor.store.createComputedCache("webgl-geometry",(r=>{const bounds=editor.getShapeMaskedPageBounds(r.id);if(!bounds)return null;const arr=new Float32Array(12);return rectangle(arr,0,bounds.x,bounds.y,bounds.w,bounds.h),arr})),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),(0,dist_esm.wvh)("minimap render",this.render))}close(){return this.disposables.forEach((d=>d()))}_getColors(){const style=getComputedStyle(this.editor.getContainer());return{shapeFill:getRgba(style.getPropertyValue("--color-text-3").trim()),selectFill:getRgba(style.getPropertyValue("--color-selected").trim()),viewportFill:getRgba(style.getPropertyValue("--color-muted-1").trim()),background:getRgba(style.getPropertyValue("--color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){const viewportPageBounds=this.editor.getViewportPageBounds(),commonShapeBounds=this.editor.getCurrentPageBounds();return commonShapeBounds?dist_esm.azJ.Expand(commonShapeBounds,viewportPageBounds):viewportPageBounds}getContentScreenBounds(){const contentPageBounds=this.getContentPageBounds(),topLeft=this.editor.pageToScreen(contentPageBounds.point),bottomRight=this.editor.pageToScreen(new dist_esm.l2P(contentPageBounds.maxX,contentPageBounds.maxY));return new dist_esm.azJ(topLeft.x,topLeft.y,bottomRight.x-topLeft.x,bottomRight.y-topLeft.y)}_getCanvasBoundingRect(){const{x,y,width,height}=this.elem.getBoundingClientRect();return new dist_esm.azJ(x,y,width,height)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){const observer=new ResizeObserver((()=>{const rect=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(rect)}));return observer.observe(this.elem),observer.observe(this.container),()=>observer.disconnect()}getCanvasSize(){const rect=this.canvasBoundingClientRect.get(),dpr=this.getDpr();return new dist_esm.l2P(rect.width*dpr,rect.height*dpr)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){const canvasScreenBounds=this.getCanvasScreenBounds(),contentPageBounds=this.getContentPageBounds(),aspectRatio=canvasScreenBounds.width/canvasScreenBounds.height;let targetWidth=contentPageBounds.width,targetHeight=targetWidth/aspectRatio;targetHeight<contentPageBounds.height&&(targetHeight=contentPageBounds.height,targetWidth=targetHeight*aspectRatio);const box=new dist_esm.azJ(0,0,targetWidth,targetHeight);return box.center=contentPageBounds.center,box}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){const{x,y,w,h}=this.getCanvasPageBounds();return new Float32Array([x,y,w,h])}getMinimapPagePoint(clientX,clientY){const canvasPageBounds=this.getCanvasPageBounds(),canvasScreenBounds=this.getCanvasScreenBounds();let x=clientX-canvasScreenBounds.x,y=clientY-canvasScreenBounds.y;return x*=canvasPageBounds.width/canvasScreenBounds.width,y*=canvasPageBounds.height/canvasScreenBounds.height,x+=canvasPageBounds.minX,y+=canvasPageBounds.minY,new dist_esm.l2P(x,y,1)}minimapScreenPointToPagePoint(x,y,shiftKey=!1,clampToBounds=!1){const{editor}=this,vpPageBounds=editor.getViewportPageBounds();let{x:px,y:py}=this.getMinimapPagePoint(x,y);if(clampToBounds){const shapesPageBounds=this.editor.getCurrentPageBounds()??new dist_esm.azJ,minX=shapesPageBounds.minX-vpPageBounds.width/2,maxX=shapesPageBounds.maxX+vpPageBounds.width/2,minY=shapesPageBounds.minY-vpPageBounds.height/2,maxY=shapesPageBounds.maxY+vpPageBounds.height/2;px+=(Math.max(0,minX+vpPageBounds.width-px)-Math.max(0,-(maxX-vpPageBounds.width-px)))/2,py+=(Math.max(0,minY+vpPageBounds.height-py)-Math.max(0,-(maxY-vpPageBounds.height-py)))/2,px=(0,dist_esm.qE8)(px,minX,maxX),py=(0,dist_esm.qE8)(py,minY,maxY)}if(shiftKey){const{originPagePoint}=this;Math.abs(px-originPagePoint.x)>Math.abs(py-originPagePoint.y)?py=originPagePoint.y:px=originPagePoint.x}return new dist_esm.l2P(px,py)}render(){const context=this.gl.context,canvasSize=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=canvasSize.x,this.elem.height=canvasSize.y,context.viewport(0,0,canvasSize.x,canvasSize.y),context.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),context.clear(context.COLOR_BUFFER_BIT);const selectedShapes=new Set(this.editor.getSelectedShapeIds()),colors=this.colors;let selectedShapeOffset=0,unselectedShapeOffset=0;const ids=this.editor.getCurrentPageShapeIdsSorted();for(let i=0,len=ids.length;i<len;i++){const shapeId=ids[i],geometry=this.shapeGeometryCache.get(shapeId);if(!geometry)continue;const len2=geometry.length;selectedShapes.has(shapeId)?(appendVertices(this.gl.selectedShapes,selectedShapeOffset,geometry),selectedShapeOffset+=len2):(appendVertices(this.gl.unselectedShapes,unselectedShapeOffset,geometry),unselectedShapeOffset+=len2)}this.drawShapes(this.gl.unselectedShapes,unselectedShapeOffset,colors.shapeFill),this.drawShapes(this.gl.selectedShapes,selectedShapeOffset,colors.selectFill),this.drawViewport(),this.drawCollaborators()}drawShapes(stuff,len,color){this.gl.prepareTriangles(stuff,len),this.gl.setFillColor(color),this.gl.drawTriangles(len)}drawViewport(){const viewport=this.editor.getViewportPageBounds(),len=function roundedRectangle(data,box,radius){radius=Math.min(radius,Math.min(box.w,box.h)/2);const innerBox=dist_esm.azJ.ExpandBy(box,-radius);if(innerBox.w<=0||innerBox.h<=0)return pie(data,{center:box.center,radius,numArcSegments:40}),240;let offset=0;return rectangle(data,offset,innerBox.minX,innerBox.minY,innerBox.w,innerBox.h),offset+=12,rectangle(data,offset,innerBox.minX,box.minY,innerBox.w,radius),offset+=12,rectangle(data,offset,innerBox.maxX,innerBox.minY,radius,innerBox.h),offset+=12,rectangle(data,offset,innerBox.minX,innerBox.maxY,innerBox.w,radius),offset+=12,rectangle(data,offset,box.minX,innerBox.minY,radius,innerBox.h),offset+=12,pie(data,{numArcSegments:10,offset,center:innerBox.point,radius,startAngle:dist_esm.PI,endAngle:1.5*dist_esm.PI}),offset+=60,pie(data,{numArcSegments:10,offset,center:dist_esm.l2P.Add(innerBox.point,new dist_esm.l2P(innerBox.w,0)),radius,startAngle:1.5*dist_esm.PI,endAngle:dist_esm.uAR}),offset+=60,pie(data,{numArcSegments:10,offset,center:dist_esm.l2P.Add(innerBox.point,innerBox.size),radius,startAngle:0,endAngle:dist_esm.sKG}),offset+=60,pie(data,{numArcSegments:10,offset,center:dist_esm.l2P.Add(innerBox.point,new dist_esm.l2P(0,innerBox.h)),radius,startAngle:dist_esm.sKG,endAngle:dist_esm.PI}),300}(this.gl.viewport.vertices,viewport,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,len),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(len),dist_esm.YZA.isSafari&&(this.gl.drawTrianglesTransparently(len),this.gl.drawTrianglesTransparently(len),this.gl.drawTrianglesTransparently(len))}drawCollaborators(){const collaborators=this.editor.getCollaboratorsOnCurrentPage();if(!collaborators.length)return;const totalSize=120*collaborators.length;this.gl.collaborators.vertices.length<totalSize&&(this.gl.collaborators.vertices=new Float32Array(totalSize));const vertices=this.gl.collaborators.vertices;let offset=0;const zoom=this.getZoom();for(const{cursor}of collaborators)cursor&&(pie(vertices,{center:dist_esm.l2P.From(cursor),radius:3*zoom,offset,numArcSegments:20}),offset+=120);this.gl.prepareTriangles(this.gl.collaborators,totalSize),offset=0;for(const{color}of collaborators)this.gl.setFillColor(getRgba(color)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,offset/2,60),offset+=120}}function DefaultMinimap(){const editor=(0,dist_esm.hGv)(),container=(0,dist_esm.NFA)(),msg=useTranslation_useTranslation(),rCanvas=react.useRef(null),rPointing=react.useRef(!1),minimapRef=react.useRef();react.useEffect((()=>{try{const minimap=new MinimapManager(editor,rCanvas.current,container);return minimapRef.current=minimap,minimapRef.current.close}catch(e){editor.annotateError(e,{origin:"minimap",willCrashApp:!1}),editor.timers.setTimeout((()=>{throw e}))}}),[editor,container]);const onDoubleClick=react.useCallback((e=>{if(!editor.getCurrentPageShapeIds().size)return;if(!minimapRef.current)return;const point=minimapRef.current.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!1),clampedPoint=minimapRef.current.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!0);minimapRef.current.originPagePoint.setTo(clampedPoint),minimapRef.current.originPageCenter.setTo(editor.getViewportPageBounds().center),editor.centerOnPoint(point,{animation:{duration:editor.options.animationMediumMs}})}),[editor]),onPointerDown=react.useCallback((e=>{if(!minimapRef.current)return;const elm=e.currentTarget;if((0,dist_esm.YYG)(elm,e),!editor.getCurrentPageShapeIds().size)return;rPointing.current=!0,minimapRef.current.isInViewport=!1;const point=minimapRef.current.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!1),_vpPageBounds=editor.getViewportPageBounds(),commonBounds=minimapRef.current.getContentPageBounds();if(new dist_esm.azJ(commonBounds.x-_vpPageBounds.width/2,commonBounds.y-_vpPageBounds.height/2,commonBounds.width+_vpPageBounds.width,commonBounds.height+_vpPageBounds.height).containsPoint(point)&&!_vpPageBounds.containsPoint(point)){minimapRef.current.isInViewport=_vpPageBounds.containsPoint(point);const delta=dist_esm.l2P.Sub(_vpPageBounds.center,_vpPageBounds.point),pagePoint=dist_esm.l2P.Add(point,delta);minimapRef.current.originPagePoint.setTo(pagePoint),minimapRef.current.originPageCenter.setTo(point),editor.centerOnPoint(point,{animation:{duration:editor.options.animationMediumMs}})}else{const clampedPoint=minimapRef.current.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!0);minimapRef.current.isInViewport=_vpPageBounds.containsPoint(clampedPoint),minimapRef.current.originPagePoint.setTo(clampedPoint),minimapRef.current.originPageCenter.setTo(_vpPageBounds.center)}document.body.addEventListener("pointerup",(function release(e2){elm&&(0,dist_esm.hPm)(elm,e2),rPointing.current=!1,document.body.removeEventListener("pointerup",release)}))}),[editor]),onPointerMove=react.useCallback((e=>{if(!minimapRef.current)return;const point=minimapRef.current.minimapScreenPointToPagePoint(e.clientX,e.clientY,e.shiftKey,!0);if(rPointing.current){if(minimapRef.current.isInViewport){const delta=minimapRef.current.originPagePoint.clone().sub(minimapRef.current.originPageCenter);return void editor.centerOnPoint(dist_esm.l2P.Sub(point,delta))}editor.centerOnPoint(point)}const pagePoint=minimapRef.current.getMinimapPagePoint(e.clientX,e.clientY),screenPoint=editor.pageToScreen(pagePoint),info={type:"pointer",target:"canvas",name:"pointer_move",...(0,dist_esm.yGT)(e),point:screenPoint,isPen:editor.getInstanceState().isPenMode};editor.dispatch(info)}),[editor]),onWheel=react.useCallback((e=>{const offset=(0,dist_esm.jaC)(e);editor.dispatch({type:"wheel",name:"wheel",delta:offset,point:new dist_esm.l2P(e.clientX,e.clientY),shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,metaKey:e.metaKey,accelKey:(0,dist_esm.gu7)(e)})}),[editor]),isDarkMode=(0,dist_esm.hJo)();return react.useEffect((()=>{editor.timers.setTimeout((()=>{minimapRef.current?.updateColors(),minimapRef.current?.render()}))}),[isDarkMode,editor]),(0,jsx_runtime.jsx)("div",{className:"tlui-minimap",children:(0,jsx_runtime.jsx)("canvas",{role:"img","aria-label":msg("navigation-zone.minimap"),ref:rCanvas,className:"tlui-minimap__canvas",onDoubleClick,onPointerMove,onPointerDown,onWheelCapture:onWheel})})}MinimapManager_init=(base=>[,,,MinimapManager_create(base?.[MinimapManager_knownSymbol("metadata")]??null)])(null),MinimapManager_decorateElement(MinimapManager_init,1,"close",_close_dec,MinimapManager),MinimapManager_decorateElement(MinimapManager_init,1,"getDpr",_getDpr_dec,MinimapManager),MinimapManager_decorateElement(MinimapManager_init,1,"getContentPageBounds",_getContentPageBounds_dec,MinimapManager),MinimapManager_decorateElement(MinimapManager_init,1,"getContentScreenBounds",_getContentScreenBounds_dec,MinimapManager),MinimapManager_decorateElement(MinimapManager_init,1,"getCanvasSize",_getCanvasSize_dec,MinimapManager),MinimapManager_decorateElement(MinimapManager_init,1,"getCanvasClientPosition",_getCanvasClientPosition_dec,MinimapManager),MinimapManager_decorateElement(MinimapManager_init,1,"getCanvasPageBounds",_getCanvasPageBounds_dec,MinimapManager),MinimapManager_decorateElement(MinimapManager_init,1,"getZoom",_getZoom_dec,MinimapManager),MinimapManager_decorateElement(MinimapManager_init,1,"getCanvasPageBoundsArray",_getCanvasPageBoundsArray_dec,MinimapManager),MinimapManager_decorateElement(MinimapManager_init,1,"render",_render_dec,MinimapManager),MinimapManager_decoratorMetadata(MinimapManager_init,MinimapManager);const DefaultNavigationPanel=(0,react.memo)((function DefaultNavigationPanel2(){const actions=useActions(),msg=useTranslation_useTranslation(),breakpoint=useBreakpoint(),ref=(0,react.useRef)(null);(0,dist_esm.I9L)(ref);const[collapsed,setCollapsed]=function useLocalStorageState(key,defaultValue){const[state,setState]=react.useState(defaultValue);return react.useLayoutEffect((()=>{const value=(0,dist_esm.zMQ)(key);if(value)try{setState(JSON.parse(value))}catch{console.error(`Could not restore value ${key} from local storage.`)}}),[key]),[state,react.useCallback((setter=>{setState((s=>{const value="function"==typeof setter?setter(s):setter;return(0,dist_esm.Yz5)(key,JSON.stringify(value)),value}))}),[key])]}("minimap",!0),toggleMinimap=(0,react.useCallback)((()=>{setCollapsed((s=>!s))}),[setCollapsed]),{ZoomMenu,Minimap}=useTldrawUiComponents();return breakpoint<PORTRAIT_BREAKPOINT.MOBILE?null:(0,jsx_runtime.jsxs)("div",{ref,className:"tlui-navigation-panel",children:[(0,jsx_runtime.jsx)(TldrawUiToolbar,{className:"tlui-buttons__horizontal",label:msg("navigation-zone.title"),children:ZoomMenu&&breakpoint<PORTRAIT_BREAKPOINT.TABLET?(0,jsx_runtime.jsx)(ZoomMenu,{}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!collapsed&&(0,jsx_runtime.jsx)(TldrawUiToolbarButton,{type:"icon","data-testid":"minimap.zoom-out",title:`${msg(unwrapLabel(actions["zoom-out"].label))} ${kbdStr(actions["zoom-out"].kbd)}`,onClick:()=>actions["zoom-out"].onSelect("navigation-zone"),children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:"minus"})}),ZoomMenu&&(0,jsx_runtime.jsx)(ZoomMenu,{},"zoom-menu"),!collapsed&&(0,jsx_runtime.jsx)(TldrawUiToolbarButton,{type:"icon","data-testid":"minimap.zoom-in",title:`${msg(unwrapLabel(actions["zoom-in"].label))} ${kbdStr(actions["zoom-in"].kbd)}`,onClick:()=>actions["zoom-in"].onSelect("navigation-zone"),children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:"plus"})}),Minimap&&(0,jsx_runtime.jsx)(TldrawUiToolbarButton,{type:"icon","data-testid":"minimap.toggle-button",title:msg("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:toggleMinimap,children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:collapsed?"chevrons-ne":"chevrons-sw"})})]})}),Minimap&&breakpoint>=PORTRAIT_BREAKPOINT.TABLET&&!collapsed&&(0,jsx_runtime.jsx)(Minimap,{})]})})),PageItemInput=function PageItemInput2({name,id,isCurrentPage,onCancel,onComplete}){const editor=(0,dist_esm.hGv)(),trackEvent=useUiEvents(),rInput=(0,react.useRef)(null),rMark=(0,react.useRef)(null),handleFocus=(0,react.useCallback)((()=>{rMark.current=editor.markHistoryStoppingPoint("rename page")}),[editor]),handleChange=(0,react.useCallback)((value=>{editor.renamePage(id,value||"New Page"),trackEvent("rename-page",{source:"page-menu"})}),[editor,id,trackEvent]),handleCancel=(0,react.useCallback)((()=>{rMark.current&&editor.bailToMark(rMark.current),onCancel()}),[editor,onCancel]);return(0,jsx_runtime.jsx)(TldrawUiInput,{className:"tlui-page-menu__item__input",ref:el=>rInput.current=el,defaultValue:name,onValueChange:handleChange,onComplete,onCancel:handleCancel,onFocus:handleFocus,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:isCurrentPage,autoSelect:!0})},onMovePage=(editor,id,from,to,trackEvent)=>{let index;const pages=editor.getPages(),below=from>to?pages[to-1]:pages[to],above=from>to?pages[to]:pages[to+1];index=below&&!above?(0,dist_esm.AQy)(below.index):!below&&above?(0,dist_esm.SBu)(pages[0].index):(0,dist_esm.HEt)(below.index,above.index),index!==pages[from].index&&(editor.markHistoryStoppingPoint("moving page"),editor.updatePage({id,index}),trackEvent("move-page",{source:"page-menu"}))},PageItemSubmenu=(0,dist_esm.u4I)((function PageItemSubmenu2({index,listSize,item,onRename}){const editor=(0,dist_esm.hGv)(),msg=useTranslation_useTranslation(),pages=editor.getPages(),trackEvent=useUiEvents(),onDuplicate=(0,react.useCallback)((()=>{editor.markHistoryStoppingPoint("creating page");const newId=dist_esm.tvM.createId();editor.duplicatePage(item.id,newId),trackEvent("duplicate-page",{source:"page-menu"})}),[editor,item,trackEvent]),onMoveUp=(0,react.useCallback)((()=>{onMovePage(editor,item.id,index,index-1,trackEvent)}),[editor,item,index,trackEvent]),onMoveDown=(0,react.useCallback)((()=>{onMovePage(editor,item.id,index,index+1,trackEvent)}),[editor,item,index,trackEvent]),onDelete=(0,react.useCallback)((()=>{editor.markHistoryStoppingPoint("deleting page"),editor.deletePage(item.id),trackEvent("delete-page",{source:"page-menu"})}),[editor,item,trackEvent]);return(0,jsx_runtime.jsxs)(TldrawUiDropdownMenuRoot,{id:`page item submenu ${index}`,children:[(0,jsx_runtime.jsx)(TldrawUiDropdownMenuTrigger,{children:(0,jsx_runtime.jsx)(TldrawUiButton,{type:"icon",title:msg("page-menu.submenu.title"),children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:"dots-vertical",small:!0})})}),(0,jsx_runtime.jsx)(TldrawUiDropdownMenuContent,{alignOffset:0,side:"right",sideOffset:-4,children:(0,jsx_runtime.jsxs)(TldrawUiMenuContextProvider,{type:"menu",sourceId:"page-menu",children:[(0,jsx_runtime.jsxs)(TldrawUiMenuGroup,{id:"modify",children:[onRename&&(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"rename",label:"page-menu.submenu.rename",onSelect:onRename}),(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:onDuplicate,disabled:pages.length>=editor.options.maxPages}),index>0&&(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"move-up",onSelect:onMoveUp,label:"page-menu.submenu.move-up"}),index<listSize-1&&(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:onMoveDown})]}),listSize>1&&(0,jsx_runtime.jsx)(TldrawUiMenuGroup,{id:"delete",children:(0,jsx_runtime.jsx)(TldrawUiMenuItem,{id:"delete",onSelect:onDelete,label:"page-menu.submenu.delete"})})]})})]})})),DefaultPageMenu=(0,react.memo)((function DefaultPageMenu2(){const editor=(0,dist_esm.hGv)(),trackEvent=useUiEvents(),msg=useTranslation_useTranslation(),breakpoint=useBreakpoint(),handleOpenChange=(0,react.useCallback)((()=>setIsEditing(!1)),[]),[isOpen,onOpenChange]=useMenuIsOpen("page-menu",handleOpenChange),rSortableContainer=(0,react.useRef)(null),pages=(0,dist_esm.hau)("pages",(()=>editor.getPages()),[editor]),currentPage=(0,dist_esm.hau)("currentPage",(()=>editor.getCurrentPage()),[editor]),currentPageId=(0,dist_esm.hau)("currentPageId",(()=>editor.getCurrentPageId()),[editor]),isReadonlyMode=useReadonly(),maxPageCountReached=(0,dist_esm.hau)("maxPageCountReached",(()=>editor.getPages().length>=editor.options.maxPages),[editor]),isCoarsePointer=(0,dist_esm.hau)("isCoarsePointer",(()=>editor.getInstanceState().isCoarsePointer),[editor]),[isEditing,setIsEditing]=(0,react.useState)(!1),toggleEditing=(0,react.useCallback)((()=>{isReadonlyMode||setIsEditing((s=>!s))}),[isReadonlyMode]),rMutables=(0,react.useRef)({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[sortablePositionItems,setSortablePositionItems]=(0,react.useState)(Object.fromEntries(pages.map(((page,i)=>[page.id,{y:36*i,offsetY:0,isSelected:!1}]))));(0,react.useLayoutEffect)((()=>{setSortablePositionItems(Object.fromEntries(pages.map(((page,i)=>[page.id,{y:36*i,offsetY:0,isSelected:!1}]))))}),[36,pages]),(0,react.useEffect)((()=>{isOpen&&editor.timers.requestAnimationFrame((()=>{const elm=document.querySelector(`[data-testid="page-menu-item-${currentPageId}"]`);if(elm){const container=rSortableContainer.current;if(!container)return;const elmTopPosition=elm.offsetTop;elmTopPosition<container.scrollTop&&container.scrollTo({top:elmTopPosition});const elmBottomPosition=elmTopPosition+36;elmBottomPosition>container.scrollTop+container.offsetHeight&&container.scrollTo({top:elmBottomPosition-container.offsetHeight})}}))}),[36,currentPageId,isOpen,editor]);const handlePointerDown=(0,react.useCallback)((e=>{const{clientY,currentTarget}=e,{dataset:{id,index}}=currentTarget;if(!id||!index)return;const mut=rMutables.current;(0,dist_esm.YYG)(e.currentTarget,e),mut.status="pointing",mut.pointing={id,index:+index};const dragY=sortablePositionItems[id].y;mut.startY=clientY,mut.startIndex=Math.max(0,Math.min(Math.round(dragY/36),pages.length-1))}),[36,pages.length,sortablePositionItems]),handlePointerMove=(0,react.useCallback)((e=>{const mut=rMutables.current;if("pointing"===mut.status){const{clientY}=e,offset=clientY-mut.startY;Math.abs(offset)>5&&(mut.status="dragging")}if("dragging"===mut.status){const{clientY}=e,offsetY=clientY-mut.startY,current=sortablePositionItems[mut.pointing.id],{startIndex,pointing}=mut,dragY=current.y+offsetY,dragIndex=Math.max(0,Math.min(Math.round(dragY/36),pages.length-1)),next={...sortablePositionItems};if(next[pointing.id]={y:current.y,offsetY,isSelected:!0},dragIndex!==mut.dragIndex){mut.dragIndex=dragIndex;for(let i=0;i<pages.length;i++){const item=pages[i];if(item.id===mut.pointing.id)continue;let{y}=next[item.id];dragIndex===startIndex?y=36*i:dragIndex<startIndex?y=dragIndex<=i&&i<startIndex?36*(i+1):36*i:dragIndex>startIndex&&(y=dragIndex>=i&&i>startIndex?36*(i-1):36*i),y!==next[item.id].y&&(next[item.id]={y,offsetY:0,isSelected:!0})}}setSortablePositionItems(next)}}),[36,pages,sortablePositionItems]),handlePointerUp=(0,react.useCallback)((e=>{const mut=rMutables.current;if("dragging"===mut.status){const{id,index}=mut.pointing;onMovePage(editor,id,index,mut.dragIndex,trackEvent)}(0,dist_esm.hPm)(e.currentTarget,e),mut.status="idle"}),[editor,trackEvent]),handleKeyDown=(0,react.useCallback)((e=>{const mut=rMutables.current;"Escape"===e.key&&("dragging"===mut.status&&setSortablePositionItems(Object.fromEntries(pages.map(((page,i)=>[page.id,{y:36*i,offsetY:0,isSelected:!1}])))),mut.status="idle")}),[36,pages]),handleCreatePageClick=(0,react.useCallback)((()=>{isReadonlyMode||(editor.run((()=>{editor.markHistoryStoppingPoint("creating page");const newPageId=dist_esm.tvM.createId();editor.createPage({name:msg("page-menu.new-page-initial-name"),id:newPageId}),editor.setCurrentPage(newPageId),setIsEditing(!0)})),trackEvent("new-page",{source:"page-menu"}))}),[editor,msg,isReadonlyMode,trackEvent]),changePage=(0,react.useCallback)((id=>{editor.setCurrentPage(id),trackEvent("change-page",{source:"page-menu"})}),[editor,trackEvent]),renamePage=(0,react.useCallback)(((id,name)=>{editor.renamePage(id,name),trackEvent("rename-page",{source:"page-menu"})}),[editor,trackEvent]);return(0,jsx_runtime.jsxs)(TldrawUiPopover,{id:"pages",onOpenChange,open:isOpen,children:[(0,jsx_runtime.jsx)(TldrawUiPopoverTrigger,{"data-testid":"main.page-menu",children:(0,jsx_runtime.jsxs)(TldrawUiButton,{type:"menu",title:currentPage.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[(0,jsx_runtime.jsx)("div",{className:"tlui-page-menu__name",children:currentPage.name}),(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:"chevron-down",small:!0})]})}),(0,jsx_runtime.jsx)(TldrawUiPopoverContent,{side:"bottom",align:"start",sideOffset:6,disableEscapeKeyDown:isEditing,children:(0,jsx_runtime.jsxs)("div",{className:"tlui-page-menu__wrapper",children:[(0,jsx_runtime.jsxs)("div",{className:"tlui-page-menu__header",children:[(0,jsx_runtime.jsx)("div",{className:"tlui-page-menu__header__title",children:msg("page-menu.title")}),!isReadonlyMode&&(0,jsx_runtime.jsxs)("div",{className:"tlui-buttons__horizontal",children:[(0,jsx_runtime.jsx)(TldrawUiButton,{type:"icon","data-testid":"page-menu.edit",title:msg(isEditing?"page-menu.edit-done":"page-menu.edit-start"),onClick:toggleEditing,children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:isEditing?"check":"edit"})}),(0,jsx_runtime.jsx)(TldrawUiButton,{type:"icon","data-testid":"page-menu.create",title:msg(maxPageCountReached?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:maxPageCountReached,onClick:handleCreatePageClick,children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:"plus"})})]})]}),(0,jsx_runtime.jsx)("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:36*pages.length+4},ref:rSortableContainer,children:pages.map(((page,index)=>{const position=sortablePositionItems[page.id]??{position:40*index,offsetY:0};return isEditing?(0,jsx_runtime.jsxs)("div",{"data-testid":"page-menu.item",className:"tlui-page_menu__item__sortable",style:{zIndex:page.id===currentPage.id?888:index,transform:`translate(0px, ${position.y+position.offsetY}px)`},children:[(0,jsx_runtime.jsx)(TldrawUiButton,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:handlePointerDown,onPointerUp:handlePointerUp,onPointerMove:handlePointerMove,onKeyDown:handleKeyDown,"data-id":page.id,"data-index":index,children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:"drag-handle-dots"})}),breakpoint<PORTRAIT_BREAKPOINT.TABLET_SM&&isCoarsePointer?(0,jsx_runtime.jsxs)(TldrawUiButton,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const name=window.prompt("Rename page",page.name);name&&name!==page.name&&renamePage(page.id,name)},onDoubleClick:toggleEditing,children:[(0,jsx_runtime.jsx)(TldrawUiButtonCheck,{checked:page.id===currentPage.id}),(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:page.name})]}):(0,jsx_runtime.jsx)("div",{className:"tlui-page_menu__item__sortable__title",style:{height:36},children:(0,jsx_runtime.jsx)(PageItemInput,{id:page.id,name:page.name,isCurrentPage:page.id===currentPage.id,onComplete:()=>{setIsEditing(!1),editor.menus.clearOpenMenus()},onCancel:()=>{setIsEditing(!1),editor.menus.clearOpenMenus()}})}),!isReadonlyMode&&(0,jsx_runtime.jsx)("div",{className:"tlui-page_menu__item__submenu","data-isediting":isEditing,children:(0,jsx_runtime.jsx)(PageItemSubmenu,{index,item:page,listSize:pages.length})})]},page.id+"_editing"):(0,jsx_runtime.jsxs)("div",{"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[(0,jsx_runtime.jsxs)(TldrawUiButton,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>changePage(page.id),onDoubleClick:toggleEditing,title:msg("page-menu.go-to-page"),children:[(0,jsx_runtime.jsx)(TldrawUiButtonCheck,{checked:page.id===currentPage.id}),(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:page.name})]}),!isReadonlyMode&&(0,jsx_runtime.jsx)("div",{className:"tlui-page_menu__item__submenu",children:(0,jsx_runtime.jsx)(PageItemSubmenu,{index,item:page,listSize:pages.length,onRename:()=>{if(dist_esm.YZA.isIos){const name=window.prompt("Rename page",page.name);name&&name!==page.name&&renamePage(page.id,name)}else setIsEditing(!0),currentPageId!==page.id&&changePage(page.id)}})})]},page.id)}))})]})})]})}));function DefaultQuickActionsContent(){const editor=(0,dist_esm.hGv)(),isReadonlyMode=useReadonly(),isInAcceptableReadonlyState=(0,dist_esm.hau)("should display quick actions",(()=>editor.isInAny("select","hand","zoom")),[editor]);if(!isReadonlyMode||isInAcceptableReadonlyState)return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(DefaultQuickActionsContent_UndoRedoGroup,{}),(0,jsx_runtime.jsx)(DeleteDuplicateGroup,{})]})}function DeleteDuplicateGroup(){const oneSelected=useUnlockedSelectedShapesCount(1),isInSelectState=useIsInSelectState(),selectDependentActionsEnabled=oneSelected&&isInSelectState;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"delete",disabled:!selectDependentActionsEnabled}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"duplicate",disabled:!selectDependentActionsEnabled})]})}function DefaultQuickActionsContent_UndoRedoGroup(){const canUndo=useCanUndo(),canRedo=useCanRedo();return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"undo",disabled:!canUndo}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"redo",disabled:!canRedo})]})}const DefaultQuickActions=(0,react.memo)((function DefaultQuickActions2({children}){const content=children??(0,jsx_runtime.jsx)(DefaultQuickActionsContent,{});return(0,jsx_runtime.jsx)(TldrawUiMenuContextProvider,{type:"small-icons",sourceId:"quick-actions",children:content})}));function PeopleMenuAvatar({userId}){const presence=(0,dist_esm.xQ_)(userId);return presence?(0,jsx_runtime.jsx)("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:presence.color},children:presence.userName?.[0]??""},userId):null}const PeopleMenuItem=(0,dist_esm.u4I)((function PeopleMenuItem2({userId}){const editor=(0,dist_esm.hGv)(),msg=useTranslation_useTranslation(),trackEvent=useUiEvents(),presence=(0,dist_esm.xQ_)(userId),handleFollowClick=(0,react.useCallback)((()=>{editor.getInstanceState().followingUserId===userId?(editor.stopFollowingUser(),trackEvent("stop-following",{source:"people-menu"})):(editor.startFollowingUser(userId),trackEvent("start-following",{source:"people-menu"}))}),[editor,userId,trackEvent]),theyAreFollowingYou=presence?.followingUserId===editor.user.getId(),youAreFollowingThem=editor.getInstanceState().followingUserId===userId;return presence?(0,jsx_runtime.jsxs)("div",{className:"tlui-people-menu__item tlui-buttons__horizontal","data-follow":youAreFollowingThem||theyAreFollowingYou,children:[(0,jsx_runtime.jsxs)(TldrawUiButton,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>editor.zoomToUser(userId),onDoubleClick:handleFollowClick,children:[(0,jsx_runtime.jsx)(TldrawUiIcon_TldrawUiIcon,{label:msg("people-menu.avatar-color"),icon:"color",color:presence.color}),(0,jsx_runtime.jsx)("div",{className:"tlui-people-menu__name",children:presence.userName?.trim()||msg("people-menu.anonymous-user")})]}),(0,jsx_runtime.jsx)(TldrawUiButton,{type:"icon",className:"tlui-people-menu__item__follow",title:msg(theyAreFollowingYou?"people-menu.leading":youAreFollowingThem?"people-menu.following":"people-menu.follow"),onClick:handleFollowClick,disabled:theyAreFollowingYou,children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:theyAreFollowingYou?"leading":youAreFollowingThem?"following":"follow"})})]}):null}));function PeopleMenuMore({count}){return(0,jsx_runtime.jsx)("div",{className:"tlui-people-menu__more",children:"+"+Math.abs(count)})}const UserPresenceColorPicker=(0,dist_esm.u4I)((function UserPresenceColorPicker2(){const editor=(0,dist_esm.hGv)(),container=(0,dist_esm.NFA)(),msg=useTranslation_useTranslation(),trackEvent=useUiEvents(),rPointing=(0,react.useRef)(!1),[isOpen,setIsOpen]=(0,react.useState)(!1),handleOpenChange=(0,react.useCallback)((isOpen2=>{setIsOpen(isOpen2)}),[]),value=editor.user.getColor(),onValueChange=(0,react.useCallback)((item=>{editor.user.updateUserPreferences({color:item}),trackEvent("set-color",{source:"people-menu"})}),[editor,trackEvent]),{handleButtonClick,handleButtonPointerDown,handleButtonPointerEnter,handleButtonPointerUp}=react.useMemo((()=>{const handlePointerUp=()=>{rPointing.current=!1,window.removeEventListener("pointerup",handlePointerUp)};return{handleButtonClick:e=>{const{id}=e.currentTarget.dataset;id&&value!==id&&onValueChange(id)},handleButtonPointerDown:e=>{const{id}=e.currentTarget.dataset;id&&(onValueChange(id),rPointing.current=!0,window.addEventListener("pointerup",handlePointerUp))},handleButtonPointerEnter:e=>{if(!rPointing.current)return;const{id}=e.currentTarget.dataset;id&&onValueChange(id)},handleButtonPointerUp:e=>{const{id}=e.currentTarget.dataset;id&&onValueChange(id)}}}),[value,onValueChange]);return(0,jsx_runtime.jsxs)(react_popover_dist.bL,{onOpenChange:handleOpenChange,open:isOpen,children:[(0,jsx_runtime.jsx)(react_popover_dist.l9,{dir:"ltr",asChild:!0,children:(0,jsx_runtime.jsx)(TldrawUiButton,{type:"icon",className:"tlui-people-menu__user__color",style:{color:editor.user.getColor()},title:msg("people-menu.change-color"),children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:"color"})})}),(0,jsx_runtime.jsx)(react_popover_dist.ZL,{container,children:(0,jsx_runtime.jsx)(react_popover_dist.UC,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:(0,jsx_runtime.jsx)("div",{className:"tlui-buttons__grid",children:dist_esm.xXO.map((item=>(0,jsx_runtime.jsx)(TldrawUiButton,{type:"icon","data-id":item,"data-testid":item,"aria-label":item,isActive:value===item,title:item,className:"tlui-button-grid__button",style:{color:item},onPointerEnter:handleButtonPointerEnter,onPointerDown:handleButtonPointerDown,onPointerUp:handleButtonPointerUp,onClick:handleButtonClick,children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:"color"})},item)))})})})]})}));function UserPresenceEditor(){const editor=(0,dist_esm.hGv)(),trackEvent=useUiEvents(),userName=(0,dist_esm.hau)("userName",(()=>editor.user.getName()),[]),msg=useTranslation_useTranslation(),rOriginalName=(0,react.useRef)(userName),rCurrentName=(0,react.useRef)(userName),[isEditingName,setIsEditingName]=(0,react.useState)(!1),toggleEditingName=(0,react.useCallback)((()=>{setIsEditingName((s=>!s))}),[]),handleValueChange=(0,react.useCallback)((value=>{rCurrentName.current=value,editor.user.updateUserPreferences({name:value})}),[editor]),handleBlur=(0,react.useCallback)((()=>{rOriginalName.current!==rCurrentName.current&&(trackEvent("change-user-name",{source:"people-menu"}),rOriginalName.current=rCurrentName.current)}),[trackEvent]),handleCancel=(0,react.useCallback)((()=>{setIsEditingName(!1),editor.user.updateUserPreferences({name:rOriginalName.current}),editor.menus.clearOpenMenus()}),[editor]);return(0,jsx_runtime.jsxs)("div",{className:"tlui-people-menu__user",children:[(0,jsx_runtime.jsx)(UserPresenceColorPicker,{}),isEditingName?(0,jsx_runtime.jsx)(TldrawUiInput,{className:"tlui-people-menu__user__input",defaultValue:userName,onValueChange:handleValueChange,onComplete:toggleEditingName,onCancel:handleCancel,onBlur:handleBlur,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{isEditingName||setIsEditingName(!0)},children:userName||msg("people-menu.anonymous-user")}),userName?null:(0,jsx_runtime.jsx)("div",{className:"tlui-people-menu__user__label",children:msg("people-menu.user")})]}),(0,jsx_runtime.jsx)(TldrawUiButton,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:msg("people-menu.change-name"),onClick:toggleEditingName,children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:isEditingName?"check":"edit"})})]})}function PeopleMenu({children}){const msg=useTranslation_useTranslation(),container=(0,dist_esm.NFA)(),editor=(0,dist_esm.hGv)(),userIds=(0,dist_esm.oKA)(),userColor=(0,dist_esm.hau)("user",(()=>editor.user.getColor()),[editor]),userName=(0,dist_esm.hau)("user",(()=>editor.user.getName()),[editor]),[isOpen,onOpenChange]=useMenuIsOpen("people menu");return userIds.length?(0,jsx_runtime.jsxs)(react_popover_dist.bL,{onOpenChange,open:isOpen,children:[(0,jsx_runtime.jsx)(react_popover_dist.l9,{dir:"ltr",asChild:!0,children:(0,jsx_runtime.jsxs)("button",{className:"tlui-people-menu__avatars-button",title:msg("people-menu.title"),children:[userIds.length>5&&(0,jsx_runtime.jsx)(PeopleMenuMore,{count:userIds.length-5}),(0,jsx_runtime.jsxs)("div",{className:"tlui-people-menu__avatars",children:[userIds.slice(-5).map((userId=>(0,jsx_runtime.jsx)(PeopleMenuAvatar,{userId},userId))),userIds.length>0&&(0,jsx_runtime.jsx)("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:userColor},children:userName?.[0]??""})]})]})}),(0,jsx_runtime.jsx)(react_popover_dist.ZL,{container,children:(0,jsx_runtime.jsx)(react_popover_dist.UC,{dir:"ltr",className:"tlui-menu",side:"bottom",sideOffset:2,collisionPadding:4,children:(0,jsx_runtime.jsxs)("div",{className:"tlui-people-menu__wrapper",children:[(0,jsx_runtime.jsx)("div",{className:"tlui-people-menu__section",children:(0,jsx_runtime.jsx)(UserPresenceEditor,{})}),userIds.length>0&&(0,jsx_runtime.jsx)("div",{className:"tlui-people-menu__section",children:userIds.map((userId=>(0,jsx_runtime.jsx)(PeopleMenuItem,{userId},userId+"_presence")))}),children]})})})]}):null}function DefaultSharePanel(){return(0,jsx_runtime.jsx)("div",{className:"tlui-share-zone",draggable:!1,children:(0,jsx_runtime.jsx)(PeopleMenu,{})})}const selectToolStyles=Object.freeze([dist_esm.ive,dist_esm.Pe6,dist_esm.u8f,dist_esm.Sg3]);function useRelevantStyles(stylesToCheck=selectToolStyles){const editor=(0,dist_esm.hGv)();return(0,dist_esm.hau)("getRelevantStyles",(()=>{const styles=new dist_esm.bDP(editor.getSharedStyles()),isInShapeSpecificTool=!!editor.root.getCurrent()?.shapeType,hasShapesSelected=editor.isIn("select")&&editor.getSelectedShapeIds().length>0;if(0===styles.size&&editor.isIn("select")&&0===editor.getSelectedShapeIds().length)for(const style of stylesToCheck)styles.applyValue(style,editor.getStyleForNextShape(style));return isInShapeSpecificTool||hasShapesSelected||styles.size>0?styles:null}),[editor])}const STYLES={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowKind:[{value:"arc",icon:"arrow-arc"},{value:"elbow",icon:"arrow-elbow"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},TldrawUiButtonPicker=(0,react.memo)((function TldrawUiButtonPicker2(props){const{uiType,items,title,style,value,onValueChange,onHistoryMark,theme}=props,editor=(0,dist_esm.hGv)(),msg=useTranslation_useTranslation(),breakpoint=useBreakpoint(),rPointing=(0,react.useRef)(!1),rPointingOriginalActiveElement=(0,react.useRef)(null),{handleButtonClick,handleButtonPointerDown,handleButtonPointerEnter,handleButtonPointerUp}=(0,react.useMemo)((()=>{const handlePointerUp=()=>{rPointing.current=!1,window.removeEventListener("pointerup",handlePointerUp);const origActiveEl=rPointingOriginalActiveElement.current;origActiveEl&&(["TEXTAREA","INPUT"].includes(origActiveEl.nodeName)||origActiveEl.isContentEditable)?origActiveEl.focus():breakpoint>=PORTRAIT_BREAKPOINT.TABLET_SM&&editor.getContainer().focus(),rPointingOriginalActiveElement.current=null};return{handleButtonClick:e=>{const{id}=e.currentTarget.dataset;"shared"===value.type&&value.value===id||(onHistoryMark?.("point picker item"),onValueChange(style,id))},handleButtonPointerDown:e=>{const{id}=e.currentTarget.dataset;onHistoryMark?.("point picker item"),onValueChange(style,id),rPointing.current=!0,rPointingOriginalActiveElement.current=document.activeElement,window.addEventListener("pointerup",handlePointerUp)},handleButtonPointerEnter:e=>{if(!rPointing.current)return;const{id}=e.currentTarget.dataset;onValueChange(style,id)},handleButtonPointerUp:e=>{const{id}=e.currentTarget.dataset;"shared"===value.type&&value.value===id||onValueChange(style,id)}}}),[editor,breakpoint,value,onHistoryMark,onValueChange,style]);return(0,jsx_runtime.jsx)(TldrawUiToolbarToggleGroup,{"data-testid":`style.${uiType}`,type:"single",className:classnames_default()("tlui-buttons__grid"),children:items.map((item=>{const label=title+" â "+msg(`${uiType}-style.${item.value}`);return(0,jsx_runtime.jsx)(TldrawUiToolbarToggleItem,{type:"icon","data-id":item.value,"data-testid":`style.${uiType}.${item.value}`,"aria-label":label,value:item.value,"data-isactive":"shared"===value.type&&value.value===item.value,title:label,className:classnames_default()("tlui-button-grid__button"),style:style===dist_esm.ive?{color:theme[item.value].solid}:void 0,onPointerEnter:handleButtonPointerEnter,onPointerDown:handleButtonPointerDown,onPointerUp:handleButtonPointerUp,onClick:handleButtonClick,children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:item.icon})},item.value)}))})}));var number_dist=__webpack_require__("./node_modules/@radix-ui/number/dist/index.mjs"),react_use_previous_dist=__webpack_require__("./node_modules/@radix-ui/react-use-previous/dist/index.mjs"),react_use_size_dist=__webpack_require__("./node_modules/@radix-ui/react-use-size/dist/index.mjs"),PAGE_KEYS=["PageUp","PageDown"],ARROW_KEYS=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],BACK_KEYS={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},[react_slider_dist_Collection,react_slider_dist_useCollection,react_slider_dist_createCollectionScope]=(0,react_collection_dist.N)("Slider"),[createSliderContext,createSliderScope]=(0,react_context_dist.A)("Slider",[react_slider_dist_createCollectionScope]),[SliderProvider,useSliderContext]=createSliderContext("Slider"),Slider=react.forwardRef(((props,forwardedRef)=>{const{name,min=0,max=100,step=1,orientation="horizontal",disabled=!1,minStepsBetweenThumbs=0,defaultValue=[min],value,onValueChange=()=>{},onValueCommit=()=>{},inverted=!1,form,...sliderProps}=props,thumbRefs=react.useRef(new Set),valueIndexToChangeRef=react.useRef(0),SliderOrientation="horizontal"===orientation?SliderHorizontal:SliderVertical,[values=[],setValues]=(0,react_use_controllable_state_dist.i)({prop:value,defaultProp:defaultValue,onChange:value2=>{const thumbs=[...thumbRefs.current];thumbs[valueIndexToChangeRef.current]?.focus(),onValueChange(value2)}}),valuesBeforeSlideStartRef=react.useRef(values);function updateValues(value2,atIndex,{commit}={commit:!1}){const decimalCount=function getDecimalCount(value){return(String(value).split(".")[1]||"").length}(step),snapToStep=function roundValue(value,decimalCount){const rounder=Math.pow(10,decimalCount);return Math.round(value*rounder)/rounder}(Math.round((value2-min)/step)*step+min,decimalCount),nextValue=(0,number_dist.q)(snapToStep,[min,max]);setValues(((prevValues=[])=>{const nextValues=function getNextSortedValues(prevValues=[],nextValue,atIndex){const nextValues=[...prevValues];return nextValues[atIndex]=nextValue,nextValues.sort(((a,b)=>a-b))}(prevValues,nextValue,atIndex);if(function hasMinStepsBetweenValues(values,minStepsBetweenValues){if(minStepsBetweenValues>0){const stepsBetweenValues=function getStepsBetweenValues(values){return values.slice(0,-1).map(((value,index)=>values[index+1]-value))}(values);return Math.min(...stepsBetweenValues)>=minStepsBetweenValues}return!0}(nextValues,minStepsBetweenThumbs*step)){valueIndexToChangeRef.current=nextValues.indexOf(nextValue);const hasChanged=String(nextValues)!==String(prevValues);return hasChanged&&commit&&onValueCommit(nextValues),hasChanged?nextValues:prevValues}return prevValues}))}return(0,jsx_runtime.jsx)(SliderProvider,{scope:props.__scopeSlider,name,disabled,min,max,valueIndexToChangeRef,thumbs:thumbRefs.current,values,orientation,form,children:(0,jsx_runtime.jsx)(react_slider_dist_Collection.Provider,{scope:props.__scopeSlider,children:(0,jsx_runtime.jsx)(react_slider_dist_Collection.Slot,{scope:props.__scopeSlider,children:(0,jsx_runtime.jsx)(SliderOrientation,{"aria-disabled":disabled,"data-disabled":disabled?"":void 0,...sliderProps,ref:forwardedRef,onPointerDown:(0,dist.m)(sliderProps.onPointerDown,(()=>{disabled||(valuesBeforeSlideStartRef.current=values)})),min,max,inverted,onSlideStart:disabled?void 0:function handleSlideStart(value2){const closestIndex=function getClosestValueIndex(values,nextValue){if(1===values.length)return 0;const distances=values.map((value=>Math.abs(value-nextValue))),closestDistance=Math.min(...distances);return distances.indexOf(closestDistance)}(values,value2);updateValues(value2,closestIndex)},onSlideMove:disabled?void 0:function handleSlideMove(value2){updateValues(value2,valueIndexToChangeRef.current)},onSlideEnd:disabled?void 0:function handleSlideEnd(){const prevValue=valuesBeforeSlideStartRef.current[valueIndexToChangeRef.current];values[valueIndexToChangeRef.current]!==prevValue&&onValueCommit(values)},onHomeKeyDown:()=>!disabled&&updateValues(min,0,{commit:!0}),onEndKeyDown:()=>!disabled&&updateValues(max,values.length-1,{commit:!0}),onStepKeyDown:({event,direction:stepDirection})=>{if(!disabled){const multiplier=PAGE_KEYS.includes(event.key)||event.shiftKey&&ARROW_KEYS.includes(event.key)?10:1,atIndex=valueIndexToChangeRef.current;updateValues(values[atIndex]+step*multiplier*stepDirection,atIndex,{commit:!0})}}})})})})}));Slider.displayName="Slider";var[SliderOrientationProvider,useSliderOrientationContext]=createSliderContext("Slider",{startEdge:"left",endEdge:"right",size:"width",direction:1}),SliderHorizontal=react.forwardRef(((props,forwardedRef)=>{const{min,max,dir,inverted,onSlideStart,onSlideMove,onSlideEnd,onStepKeyDown,...sliderProps}=props,[slider,setSlider]=react.useState(null),composedRefs=(0,react_compose_refs_dist.s)(forwardedRef,(node=>setSlider(node))),rectRef=react.useRef(void 0),direction=(0,react_direction_dist.jH)(dir),isDirectionLTR="ltr"===direction,isSlidingFromLeft=isDirectionLTR&&!inverted||!isDirectionLTR&&inverted;function getValueFromPointer(pointerPosition){const rect=rectRef.current||slider.getBoundingClientRect(),value=linearScale([0,rect.width],isSlidingFromLeft?[min,max]:[max,min]);return rectRef.current=rect,value(pointerPosition-rect.left)}return(0,jsx_runtime.jsx)(SliderOrientationProvider,{scope:props.__scopeSlider,startEdge:isSlidingFromLeft?"left":"right",endEdge:isSlidingFromLeft?"right":"left",direction:isSlidingFromLeft?1:-1,size:"width",children:(0,jsx_runtime.jsx)(SliderImpl,{dir:direction,"data-orientation":"horizontal",...sliderProps,ref:composedRefs,style:{...sliderProps.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:event=>{const value=getValueFromPointer(event.clientX);onSlideStart?.(value)},onSlideMove:event=>{const value=getValueFromPointer(event.clientX);onSlideMove?.(value)},onSlideEnd:()=>{rectRef.current=void 0,onSlideEnd?.()},onStepKeyDown:event=>{const isBackKey=BACK_KEYS[isSlidingFromLeft?"from-left":"from-right"].includes(event.key);onStepKeyDown?.({event,direction:isBackKey?-1:1})}})})})),SliderVertical=react.forwardRef(((props,forwardedRef)=>{const{min,max,inverted,onSlideStart,onSlideMove,onSlideEnd,onStepKeyDown,...sliderProps}=props,sliderRef=react.useRef(null),ref=(0,react_compose_refs_dist.s)(forwardedRef,sliderRef),rectRef=react.useRef(void 0),isSlidingFromBottom=!inverted;function getValueFromPointer(pointerPosition){const rect=rectRef.current||sliderRef.current.getBoundingClientRect(),value=linearScale([0,rect.height],isSlidingFromBottom?[max,min]:[min,max]);return rectRef.current=rect,value(pointerPosition-rect.top)}return(0,jsx_runtime.jsx)(SliderOrientationProvider,{scope:props.__scopeSlider,startEdge:isSlidingFromBottom?"bottom":"top",endEdge:isSlidingFromBottom?"top":"bottom",size:"height",direction:isSlidingFromBottom?1:-1,children:(0,jsx_runtime.jsx)(SliderImpl,{"data-orientation":"vertical",...sliderProps,ref,style:{...sliderProps.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:event=>{const value=getValueFromPointer(event.clientY);onSlideStart?.(value)},onSlideMove:event=>{const value=getValueFromPointer(event.clientY);onSlideMove?.(value)},onSlideEnd:()=>{rectRef.current=void 0,onSlideEnd?.()},onStepKeyDown:event=>{const isBackKey=BACK_KEYS[isSlidingFromBottom?"from-bottom":"from-top"].includes(event.key);onStepKeyDown?.({event,direction:isBackKey?-1:1})}})})})),SliderImpl=react.forwardRef(((props,forwardedRef)=>{const{__scopeSlider,onSlideStart,onSlideMove,onSlideEnd,onHomeKeyDown,onEndKeyDown,onStepKeyDown,...sliderProps}=props,context=useSliderContext("Slider",__scopeSlider);return(0,jsx_runtime.jsx)(react_primitive_dist.sG.span,{...sliderProps,ref:forwardedRef,onKeyDown:(0,dist.m)(props.onKeyDown,(event=>{"Home"===event.key?(onHomeKeyDown(event),event.preventDefault()):"End"===event.key?(onEndKeyDown(event),event.preventDefault()):PAGE_KEYS.concat(ARROW_KEYS).includes(event.key)&&(onStepKeyDown(event),event.preventDefault())})),onPointerDown:(0,dist.m)(props.onPointerDown,(event=>{const target=event.target;target.setPointerCapture(event.pointerId),event.preventDefault(),context.thumbs.has(target)?target.focus():onSlideStart(event)})),onPointerMove:(0,dist.m)(props.onPointerMove,(event=>{event.target.hasPointerCapture(event.pointerId)&&onSlideMove(event)})),onPointerUp:(0,dist.m)(props.onPointerUp,(event=>{const target=event.target;target.hasPointerCapture(event.pointerId)&&(target.releasePointerCapture(event.pointerId),onSlideEnd(event))}))})})),SliderTrack=react.forwardRef(((props,forwardedRef)=>{const{__scopeSlider,...trackProps}=props,context=useSliderContext("SliderTrack",__scopeSlider);return(0,jsx_runtime.jsx)(react_primitive_dist.sG.span,{"data-disabled":context.disabled?"":void 0,"data-orientation":context.orientation,...trackProps,ref:forwardedRef})}));SliderTrack.displayName="SliderTrack";var SliderRange=react.forwardRef(((props,forwardedRef)=>{const{__scopeSlider,...rangeProps}=props,context=useSliderContext("SliderRange",__scopeSlider),orientation=useSliderOrientationContext("SliderRange",__scopeSlider),ref=react.useRef(null),composedRefs=(0,react_compose_refs_dist.s)(forwardedRef,ref),valuesCount=context.values.length,percentages=context.values.map((value=>convertValueToPercentage(value,context.min,context.max))),offsetStart=valuesCount>1?Math.min(...percentages):0,offsetEnd=100-Math.max(...percentages);return(0,jsx_runtime.jsx)(react_primitive_dist.sG.span,{"data-orientation":context.orientation,"data-disabled":context.disabled?"":void 0,...rangeProps,ref:composedRefs,style:{...props.style,[orientation.startEdge]:offsetStart+"%",[orientation.endEdge]:offsetEnd+"%"}})}));SliderRange.displayName="SliderRange";var SliderThumb=react.forwardRef(((props,forwardedRef)=>{const getItems=react_slider_dist_useCollection(props.__scopeSlider),[thumb,setThumb]=react.useState(null),composedRefs=(0,react_compose_refs_dist.s)(forwardedRef,(node=>setThumb(node))),index=react.useMemo((()=>thumb?getItems().findIndex((item=>item.ref.current===thumb)):-1),[getItems,thumb]);return(0,jsx_runtime.jsx)(SliderThumbImpl,{...props,ref:composedRefs,index})})),SliderThumbImpl=react.forwardRef(((props,forwardedRef)=>{const{__scopeSlider,index,name,...thumbProps}=props,context=useSliderContext("SliderThumb",__scopeSlider),orientation=useSliderOrientationContext("SliderThumb",__scopeSlider),[thumb,setThumb]=react.useState(null),composedRefs=(0,react_compose_refs_dist.s)(forwardedRef,(node=>setThumb(node))),isFormControl=!thumb||(context.form||!!thumb.closest("form")),size=(0,react_use_size_dist.X)(thumb),value=context.values[index],percent=void 0===value?0:convertValueToPercentage(value,context.min,context.max),label=function getLabel(index,totalValues){return totalValues>2?`Value ${index+1} of ${totalValues}`:2===totalValues?["Minimum","Maximum"][index]:void 0}(index,context.values.length),orientationSize=size?.[orientation.size],thumbInBoundsOffset=orientationSize?function getThumbInBoundsOffset(width,left,direction){const halfWidth=width/2,offset=linearScale([0,50],[0,halfWidth]);return(halfWidth-offset(left)*direction)*direction}(orientationSize,percent,orientation.direction):0;return react.useEffect((()=>{if(thumb)return context.thumbs.add(thumb),()=>{context.thumbs.delete(thumb)}}),[thumb,context.thumbs]),(0,jsx_runtime.jsxs)("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[orientation.startEdge]:`calc(${percent}% + ${thumbInBoundsOffset}px)`},children:[(0,jsx_runtime.jsx)(react_slider_dist_Collection.ItemSlot,{scope:props.__scopeSlider,children:(0,jsx_runtime.jsx)(react_primitive_dist.sG.span,{role:"slider","aria-label":props["aria-label"]||label,"aria-valuemin":context.min,"aria-valuenow":value,"aria-valuemax":context.max,"aria-orientation":context.orientation,"data-orientation":context.orientation,"data-disabled":context.disabled?"":void 0,tabIndex:context.disabled?void 0:0,...thumbProps,ref:composedRefs,style:void 0===value?{display:"none"}:props.style,onFocus:(0,dist.m)(props.onFocus,(()=>{context.valueIndexToChangeRef.current=index}))})}),isFormControl&&(0,jsx_runtime.jsx)(SliderBubbleInput,{name:name??(context.name?context.name+(context.values.length>1?"[]":""):void 0),form:context.form,value},index)]})}));SliderThumb.displayName="SliderThumb";var SliderBubbleInput=react.forwardRef((({__scopeSlider,value,...props},forwardedRef)=>{const ref=react.useRef(null),composedRefs=(0,react_compose_refs_dist.s)(ref,forwardedRef),prevValue=(0,react_use_previous_dist.Z)(value);return react.useEffect((()=>{const input=ref.current;if(!input)return;const inputProto=window.HTMLInputElement.prototype,setValue=Object.getOwnPropertyDescriptor(inputProto,"value").set;if(prevValue!==value&&setValue){const event=new Event("input",{bubbles:!0});setValue.call(input,value),input.dispatchEvent(event)}}),[prevValue,value]),(0,jsx_runtime.jsx)(react_primitive_dist.sG.input,{style:{display:"none"},...props,ref:composedRefs,defaultValue:value})}));function convertValueToPercentage(value,min,max){const percentage=100/(max-min)*(value-min);return(0,number_dist.q)(percentage,[0,100])}function linearScale(input,output){return value=>{if(input[0]===input[1]||output[0]===output[1])return output[0];const ratio=(output[1]-output[0])/(input[1]-input[0]);return output[0]+ratio*(value-input[0])}}SliderBubbleInput.displayName="RadioBubbleInput";var dist_Root=Slider,Track=SliderTrack,Range=SliderRange,Thumb=SliderThumb;const TldrawUiSlider=(0,react.memo)((function Slider({onHistoryMark,title,steps,value,label,onValueChange,"data-testid":testId}){const msg=useTranslation_useTranslation(),[tabIndex,setTabIndex]=(0,react.useState)(-1);(0,react.useEffect)((()=>{setTabIndex(0)}),[]);const handleValueChange=(0,react.useCallback)((value2=>{onValueChange(value2[0])}),[onValueChange]),handlePointerDown=(0,react.useCallback)((()=>{onHistoryMark("click slider")}),[onHistoryMark]),handlePointerUp=(0,react.useCallback)((()=>{value&&onValueChange(value)}),[value,onValueChange]),handleKeyEvent=(0,react.useCallback)((event=>{"Tab"===event.key&&event.stopPropagation()}),[]);return(0,jsx_runtime.jsx)("div",{className:"tlui-slider__container",children:(0,jsx_runtime.jsxs)(dist_Root,{"data-testid":testId,className:"tlui-slider",dir:"ltr",min:0,max:steps,step:1,value:value?[value]:void 0,onPointerDown:handlePointerDown,onValueChange:handleValueChange,onPointerUp:handlePointerUp,onKeyDownCapture:handleKeyEvent,onKeyUpCapture:handleKeyEvent,title:title+" â "+msg(label),children:[(0,jsx_runtime.jsx)(Track,{className:"tlui-slider__track",dir:"ltr",children:null!==value&&(0,jsx_runtime.jsx)(Range,{className:"tlui-slider__range",dir:"ltr"})}),null!==value&&(0,jsx_runtime.jsx)(Thumb,{"aria-label":msg("style-panel.opacity"),className:"tlui-slider__thumb",dir:"ltr",tabIndex})]})})}));const DoubleDropdownPicker=react.memo((function DoubleDropdownPickerInner({label,uiTypeA,uiTypeB,labelA,labelB,itemsA,itemsB,styleA,styleB,valueA,valueB,onValueChange}){const editor=(0,dist_esm.hGv)(),msg=useTranslation_useTranslation(),[isOpenA,setIsOpenA]=react.useState(!1),[isOpenB,setIsOpenB]=react.useState(!1),iconA=react.useMemo((()=>itemsA.find((item=>"shared"===valueA.type&&valueA.value===item.value))?.icon??"mixed"),[itemsA,valueA]),iconB=react.useMemo((()=>itemsB.find((item=>"shared"===valueB.type&&valueB.value===item.value))?.icon??"mixed"),[itemsB,valueB]);if(void 0===valueA&&void 0===valueB)return null;const idA=`style panel ${uiTypeA} A`,idB=`style panel ${uiTypeB} B`;return(0,jsx_runtime.jsxs)("div",{className:"tlui-style-panel__double-select-picker",children:[(0,jsx_runtime.jsx)("div",{title:msg(label),className:"tlui-style-panel__double-select-picker-label",children:msg(label)}),(0,jsx_runtime.jsxs)(TldrawUiToolbar,{label:msg(label),className:"tlui-buttons__horizontal",children:[(0,jsx_runtime.jsxs)(TldrawUiPopover,{id:idA,open:isOpenA,onOpenChange:setIsOpenA,children:[(0,jsx_runtime.jsx)(TldrawUiPopoverTrigger,{children:(0,jsx_runtime.jsx)(TldrawUiToolbarButton,{type:"icon","data-testid":`style.${uiTypeA}`,title:msg(labelA)+" â "+(null===valueA||"mixed"===valueA.type?msg("style-panel.mixed"):msg(`${uiTypeA}-style.${valueA.value}`)),children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:iconA,small:!0,invertIcon:!0})})}),(0,jsx_runtime.jsx)(TldrawUiPopoverContent,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:(0,jsx_runtime.jsx)(TldrawUiToolbar,{label:msg(labelA),className:"tlui-buttons__grid",children:(0,jsx_runtime.jsx)(TldrawUiMenuContextProvider,{type:"icons",sourceId:"style-panel",children:itemsA.map((item=>(0,jsx_runtime.jsx)(TldrawUiToolbarButton,{"data-testid":`style.${uiTypeA}.${item.value}`,type:"icon",onClick:()=>{onValueChange(styleA,item.value),dist_esm.NlK.deleteOpenMenu(idA,editor.contextId),setIsOpenA(!1)},title:`${msg(labelA)} â ${msg(`${uiTypeA}-style.${item.value}`)}`,children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:item.icon,invertIcon:!0})},item.value)))})})})]}),(0,jsx_runtime.jsxs)(TldrawUiPopover,{id:idB,open:isOpenB,onOpenChange:setIsOpenB,children:[(0,jsx_runtime.jsx)(TldrawUiPopoverTrigger,{children:(0,jsx_runtime.jsx)(TldrawUiToolbarButton,{type:"icon","data-testid":`style.${uiTypeB}`,title:msg(labelB)+" â "+(null===valueB||"mixed"===valueB.type?msg("style-panel.mixed"):msg(`${uiTypeB}-style.${valueB.value}`)),children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:iconB,small:!0})})}),(0,jsx_runtime.jsx)(TldrawUiPopoverContent,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:(0,jsx_runtime.jsx)(TldrawUiToolbar,{label:msg(labelB),className:"tlui-buttons__grid",children:(0,jsx_runtime.jsx)(TldrawUiMenuContextProvider,{type:"icons",sourceId:"style-panel",children:itemsB.map((item=>(0,jsx_runtime.jsx)(TldrawUiToolbarButton,{type:"icon",title:`${msg(labelB)} â ${msg(`${uiTypeB}-style.${item.value}`)}`,"data-testid":`style.${uiTypeB}.${item.value}`,onClick:()=>{onValueChange(styleB,item.value),dist_esm.NlK.deleteOpenMenu(idB,editor.contextId),setIsOpenB(!1)},children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:item.icon})},item.value)))})})})]})]})]})}));const DropdownPicker=react.memo((function DropdownPickerInner({id,label,uiType,stylePanelType,style,items,type,value,onValueChange}){const msg=useTranslation_useTranslation(),editor=(0,dist_esm.hGv)(),[isOpen,setIsOpen]=react.useState(!1),icon=react.useMemo((()=>items.find((item=>"shared"===value.type&&item.value===value.value))?.icon),[items,value]),stylePanelName=msg(`style-panel.${stylePanelType}`),titleStr="mixed"===value.type?msg("style-panel.mixed"):stylePanelName+" â "+msg(`${uiType}-style.${value.value}`),labelStr=label?msg(label):"",popoverId=`style panel ${id}`;return(0,jsx_runtime.jsxs)(TldrawUiPopover,{id:popoverId,open:isOpen,onOpenChange:setIsOpen,children:[(0,jsx_runtime.jsx)(TldrawUiPopoverTrigger,{children:(0,jsx_runtime.jsxs)(TldrawUiToolbarButton,{type,"data-testid":`style.${uiType}`,"data-direction":"left",title:titleStr,children:[labelStr&&(0,jsx_runtime.jsx)(TldrawUiButtonLabel,{children:labelStr}),(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:icon??"mixed"})]})}),(0,jsx_runtime.jsx)(TldrawUiPopoverContent,{side:"left",align:"center",children:(0,jsx_runtime.jsx)(TldrawUiToolbar,{label:labelStr,className:classnames_default()("tlui-buttons__grid",`tlui-buttons__${stylePanelType}`),children:(0,jsx_runtime.jsx)(TldrawUiMenuContextProvider,{type:"icons",sourceId:"style-panel",children:items.map((item=>(0,jsx_runtime.jsx)(TldrawUiToolbarButton,{type:"icon","data-testid":`style.${uiType}.${item.value}`,title:stylePanelName+" â "+msg(`${uiType}-style.${item.value}`),isActive:icon===item.icon,onClick:()=>{editor.markHistoryStoppingPoint("select style dropdown item"),onValueChange(style,item.value),dist_esm.NlK.deleteOpenMenu(popoverId,editor.contextId),setIsOpen(!1)},children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:item.icon})},item.value)))})})})]})}));function DefaultStylePanelContent({styles}){const isDarkMode=(0,dist_esm.hJo)();if(!styles)return null;const geo=styles.get(dist_esm.tg8),arrowheadEnd=styles.get(dist_esm.srS),arrowheadStart=styles.get(dist_esm.roz),arrowKind=styles.get(dist_esm.qfG),hideGeo=void 0===geo,hideArrowHeads=void 0===arrowheadEnd&&void 0===arrowheadStart,hideSpline=void 0===styles.get(dist_esm.eBK),hideArrowKind=void 0===arrowKind,hideText=void 0===styles.get(dist_esm.yes),theme=(0,dist_esm.AnR)({isDarkMode});return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CommonStylePickerSet,{theme,styles}),!hideText&&(0,jsx_runtime.jsx)(TextStylePickerSet,{theme,styles}),!(hideGeo&&hideArrowHeads&&hideSpline&&hideArrowKind)&&(0,jsx_runtime.jsxs)("div",{className:"tlui-style-panel__section",children:[(0,jsx_runtime.jsx)(GeoStylePickerSet,{styles}),(0,jsx_runtime.jsx)(ArrowStylePickerSet,{styles}),(0,jsx_runtime.jsx)(ArrowheadStylePickerSet,{styles}),(0,jsx_runtime.jsx)(SplineStylePickerSet,{styles})]})]})}function useStyleChangeCallback(){const editor=(0,dist_esm.hGv)(),trackEvent=useUiEvents();return react.useMemo((()=>function handleStyleChange(style,value){editor.run((()=>{editor.isIn("select")&&editor.setStyleForSelectedShapes(style,value),editor.setStyleForNextShapes(style,value),editor.updateInstanceState({isChangingStyle:!0})})),trackEvent("set-style",{source:"style-panel",id:style.id,value})}),[editor,trackEvent])}function CommonStylePickerSet({styles,theme}){const msg=useTranslation_useTranslation(),editor=(0,dist_esm.hGv)(),onHistoryMark=(0,react.useCallback)((id=>editor.markHistoryStoppingPoint(id)),[editor]),handleValueChange=useStyleChangeCallback(),color=styles.get(dist_esm.ive),fill=styles.get(dist_esm.u8f),dash=styles.get(dist_esm.Pe6),size=styles.get(dist_esm.Sg3),showPickers=void 0!==fill||void 0!==dash||void 0!==size;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"tlui-style-panel__section__common","data-testid":"style.panel",children:[void 0===color?null:(0,jsx_runtime.jsx)(TldrawUiToolbar,{label:msg("style-panel.color"),children:(0,jsx_runtime.jsx)(TldrawUiButtonPicker,{title:msg("style-panel.color"),uiType:"color",style:dist_esm.ive,items:STYLES.color,value:color,onValueChange:handleValueChange,theme,onHistoryMark})}),(0,jsx_runtime.jsx)(OpacitySlider,{})]}),showPickers&&(0,jsx_runtime.jsxs)("div",{className:"tlui-style-panel__section",children:[void 0===fill?null:(0,jsx_runtime.jsx)(TldrawUiToolbar,{label:msg("style-panel.fill"),children:(0,jsx_runtime.jsx)(TldrawUiButtonPicker,{title:msg("style-panel.fill"),uiType:"fill",style:dist_esm.u8f,items:STYLES.fill,value:fill,onValueChange:handleValueChange,theme,onHistoryMark})}),void 0===dash?null:(0,jsx_runtime.jsx)(TldrawUiToolbar,{label:msg("style-panel.dash"),children:(0,jsx_runtime.jsx)(TldrawUiButtonPicker,{title:msg("style-panel.dash"),uiType:"dash",style:dist_esm.Pe6,items:STYLES.dash,value:dash,onValueChange:handleValueChange,theme,onHistoryMark})}),void 0===size?null:(0,jsx_runtime.jsx)(TldrawUiToolbar,{label:msg("style-panel.size"),children:(0,jsx_runtime.jsx)(TldrawUiButtonPicker,{title:msg("style-panel.size"),uiType:"size",style:dist_esm.Sg3,items:STYLES.size,value:size,onValueChange:(style,value)=>{handleValueChange(style,value);const selectedShapeIds=editor.getSelectedShapeIds();selectedShapeIds.length>0&&kickoutOccludedShapes(editor,selectedShapeIds)},theme,onHistoryMark})})]})]})}function TextStylePickerSet({theme,styles}){const msg=useTranslation_useTranslation(),handleValueChange=useStyleChangeCallback(),editor=(0,dist_esm.hGv)(),onHistoryMark=(0,react.useCallback)((id=>editor.markHistoryStoppingPoint(id)),[editor]),font=styles.get(dist_esm.yes),textAlign=styles.get(dist_esm.nM1),labelAlign=styles.get(dist_esm.yMj),verticalLabelAlign=styles.get(dist_esm.YUb);return void 0===font&&void 0===labelAlign?null:(0,jsx_runtime.jsxs)("div",{className:"tlui-style-panel__section",children:[void 0===font?null:(0,jsx_runtime.jsx)(TldrawUiToolbar,{label:msg("style-panel.font"),children:(0,jsx_runtime.jsx)(TldrawUiButtonPicker,{title:msg("style-panel.font"),uiType:"font",style:dist_esm.yes,items:STYLES.font,value:font,onValueChange:handleValueChange,theme,onHistoryMark})}),void 0===textAlign?null:(0,jsx_runtime.jsxs)(TldrawUiToolbar,{label:msg("style-panel.align"),className:"tlui-style-panel__row",children:[(0,jsx_runtime.jsx)(TldrawUiButtonPicker,{title:msg("style-panel.align"),uiType:"align",style:dist_esm.nM1,items:STYLES.textAlign,value:textAlign,onValueChange:handleValueChange,theme,onHistoryMark}),(0,jsx_runtime.jsx)("div",{className:"tlui-style-panel__row__extra-button",children:(0,jsx_runtime.jsx)(TldrawUiToolbarButton,{type:"icon",title:msg("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:"vertical-align-middle"})})})]}),void 0===labelAlign?null:(0,jsx_runtime.jsxs)(TldrawUiToolbar,{label:msg("style-panel.label-align"),className:"tlui-style-panel__row",children:[(0,jsx_runtime.jsx)(TldrawUiButtonPicker,{title:msg("style-panel.label-align"),uiType:"align",style:dist_esm.yMj,items:STYLES.horizontalAlign,value:labelAlign,onValueChange:handleValueChange,theme,onHistoryMark}),(0,jsx_runtime.jsx)("div",{className:"tlui-style-panel__row__extra-button",children:void 0===verticalLabelAlign?(0,jsx_runtime.jsx)(TldrawUiToolbarButton,{type:"icon",title:msg("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:"vertical-align-middle"})}):(0,jsx_runtime.jsx)(DropdownPicker,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",stylePanelType:"vertical-align",style:dist_esm.YUb,items:STYLES.verticalAlign,value:verticalLabelAlign,onValueChange:handleValueChange})})]})]})}function GeoStylePickerSet({styles}){const msg=useTranslation_useTranslation(),handleValueChange=useStyleChangeCallback(),geo=styles.get(dist_esm.tg8);return void 0===geo?null:(0,jsx_runtime.jsx)(TldrawUiToolbar,{label:msg("style-panel.geo"),children:(0,jsx_runtime.jsx)(DropdownPicker,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",stylePanelType:"geo",style:dist_esm.tg8,items:STYLES.geo,value:geo,onValueChange:handleValueChange})})}function SplineStylePickerSet({styles}){const msg=useTranslation_useTranslation(),handleValueChange=useStyleChangeCallback(),spline=styles.get(dist_esm.eBK);return void 0===spline?null:(0,jsx_runtime.jsx)(TldrawUiToolbar,{label:msg("style-panel.spline"),children:(0,jsx_runtime.jsx)(DropdownPicker,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",stylePanelType:"spline",style:dist_esm.eBK,items:STYLES.spline,value:spline,onValueChange:handleValueChange})})}function ArrowStylePickerSet({styles}){const msg=useTranslation_useTranslation(),handleValueChange=useStyleChangeCallback(),arrowKind=styles.get(dist_esm.qfG);return void 0===arrowKind?null:(0,jsx_runtime.jsx)(TldrawUiToolbar,{label:msg("style-panel.arrow-kind"),children:(0,jsx_runtime.jsx)(DropdownPicker,{id:"arrow-kind",type:"menu",label:"style-panel.arrow-kind",uiType:"arrow-kind",stylePanelType:"arrow-kind",style:dist_esm.qfG,items:STYLES.arrowKind,value:arrowKind,onValueChange:handleValueChange})})}function ArrowheadStylePickerSet({styles}){const handleValueChange=useStyleChangeCallback(),arrowheadEnd=styles.get(dist_esm.srS),arrowheadStart=styles.get(dist_esm.roz);return arrowheadEnd&&arrowheadStart?(0,jsx_runtime.jsx)(DoubleDropdownPicker,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:dist_esm.roz,itemsA:STYLES.arrowheadStart,valueA:arrowheadStart,uiTypeB:"arrowheadEnd",styleB:dist_esm.srS,itemsB:STYLES.arrowheadEnd,valueB:arrowheadEnd,onValueChange:handleValueChange,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"}):null}const tldrawSupportedOpacities=[.1,.25,.5,.75,1];function OpacitySlider(){const editor=(0,dist_esm.hGv)(),onHistoryMark=(0,react.useCallback)((id=>editor.markHistoryStoppingPoint(id)),[editor]),opacity=(0,dist_esm.hau)("opacity",(()=>editor.getSharedOpacity()),[editor]),trackEvent=useUiEvents(),msg=useTranslation_useTranslation(),handleOpacityValueChange=react.useCallback((value=>{const item=tldrawSupportedOpacities[value];editor.run((()=>{editor.isIn("select")&&editor.setOpacityForSelectedShapes(item),editor.setOpacityForNextShapes(item),editor.updateInstanceState({isChangingStyle:!0})})),trackEvent("set-style",{source:"style-panel",id:"opacity",value})}),[editor,trackEvent]);if(void 0===opacity)return null;const opacityIndex="mixed"===opacity.type?-1:tldrawSupportedOpacities.indexOf((0,dist_esm.wql)(tldrawSupportedOpacities,(supportedOpacity=>Math.abs(supportedOpacity-opacity.value))));return(0,jsx_runtime.jsx)(TldrawUiSlider,{"data-testid":"style.opacity",value:opacityIndex>=0?opacityIndex:tldrawSupportedOpacities.length-1,label:"mixed"===opacity.type?"style-panel.mixed":`opacity-style.${opacity.value}`,onValueChange:handleOpacityValueChange,steps:tldrawSupportedOpacities.length-1,title:msg("style-panel.opacity"),onHistoryMark})}const DefaultStylePanel=(0,react.memo)((function DefaultStylePanel2({isMobile,children}){const editor=(0,dist_esm.hGv)(),ref=(0,react.useRef)(null);(0,dist_esm.I9L)(ref);const styles=useRelevantStyles(),handlePointerOut=(0,react.useCallback)((()=>{isMobile||editor.updateInstanceState({isChangingStyle:!1})}),[editor,isMobile]),content=children??(0,jsx_runtime.jsx)(DefaultStylePanelContent,{styles});return(0,jsx_runtime.jsx)("div",{ref,className:classnames_default()("tlui-style-panel",{"tlui-style-panel__wrapper":!isMobile}),"data-ismobile":isMobile,onPointerLeave:handlePointerOut,children:content})})),TldrawUiContextualToolbar=react.forwardRef((function TldrawUiContextualToolbar2({children,className,label},toolbarRef){return(0,dist_esm.I9L)(toolbarRef),(0,dist_esm._vE)(toolbarRef),(0,jsx_runtime.jsx)("div",{ref:toolbarRef,"data-testid":"contextual-toolbar",className:classnames_default()("tlui-contextual-toolbar",className),onPointerDown:dist_esm.$6n,children:(0,jsx_runtime.jsx)(TldrawUiToolbar,{className:"tlui-menu tlui-buttons__horizontal",label,children})})}));function DefaultRichTextToolbarContent({textEditor,onEditLinkStart}){const trackEvent=useUiEvents(),msg=useTranslation_useTranslation(),[_,set]=(0,react.useState)(0);(0,react.useEffect)((function forceUpdateWhenContentChanges(){function forceUpdate(){set((t=>t+1))}textEditor.on("update",forceUpdate),textEditor.on("selectionUpdate",forceUpdate)}),[textEditor]),(0,react.useEffect)((()=>{function handleKeyDown(event){onEditLinkStart&&(0,dist_esm.gu7)(event)&&event.shiftKey&&"k"===event.key&&(event.preventDefault(),onEditLinkStart())}return document.addEventListener("keydown",handleKeyDown),()=>{document.removeEventListener("keydown",handleKeyDown)}}),[onEditLinkStart]);return(0,react.useMemo)((()=>{function handleOp(name,op){trackEvent("rich-text",{operation:name,source:"rich-text-menu"}),textEditor.chain().focus()[op]().run()}return[{name:"bold",onSelect(){handleOp("bold","toggleBold")}},{name:"italic",onSelect(){handleOp("bold","toggleItalic")}},{name:"code",onSelect(){handleOp("bold","toggleCode")}},onEditLinkStart?{name:"link",onSelect(){onEditLinkStart()}}:void 0,{name:"bulletList",onSelect(){handleOp("bulletList","toggleBulletList")}},{name:"highlight",onSelect(){handleOp("bulletList","toggleHighlight")}}].filter(Boolean)}),[textEditor,trackEvent,onEditLinkStart]).map((({name,attrs,onSelect})=>{const isActive=textEditor.isActive(name,attrs);return(0,jsx_runtime.jsx)(TldrawUiToolbarButton,{title:msg(`tool.rich-text-${name}`),"data-testid":`rich-text.${name}`,type:"icon",isActive,onPointerDown:dist_esm.woC,onClick:onSelect,role:"option","aria-pressed":isActive,children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{small:!0,icon:name})},name)}))}function LinkEditor({textEditor,value:initialValue,onComplete}){const editor=(0,dist_esm.hGv)(),[value,setValue]=(0,react.useState)(initialValue),msg=useTranslation_useTranslation(),ref=(0,react.useRef)(null),trackEvent=useUiEvents(),source="rich-text-menu",linkifiedValue=value.startsWith("http")?value:`https://${value}`;return(0,react.useEffect)((()=>{value||ref.current?.focus()}),[value]),(0,react.useEffect)((()=>{setValue(initialValue)}),[initialValue]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(TldrawUiInput,{ref,"data-testid":"rich-text.link-input",className:"tlui-rich-text__toolbar-link-input",value,onValueChange:value2=>setValue(value2),onComplete:link=>{trackEvent("rich-text",{operation:"link-edit",source}),link.startsWith("http://")||link.startsWith("https://")||(link=`https://${link}`),textEditor.commands.setLink({href:link}),editor.getInstanceState().isCoarsePointer?textEditor.commands.blur():textEditor.commands.focus(),onComplete()},onCancel:()=>onComplete(),placeholder:"example.com"}),(0,jsx_runtime.jsx)(TldrawUiButton,{className:"tlui-rich-text__toolbar-link-visit",title:msg("tool.rich-text-link-visit"),type:"icon",onPointerDown:dist_esm.woC,onClick:()=>{trackEvent("rich-text",{operation:"link-visit",source}),window.open(linkifiedValue,"_blank","noopener, noreferrer"),onComplete()},disabled:!value,children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{small:!0,icon:"external-link"})}),(0,jsx_runtime.jsx)(TldrawUiButton,{className:"tlui-rich-text__toolbar-link-remove",title:msg("tool.rich-text-link-remove"),"data-testid":"rich-text.link-remove",type:"icon",onPointerDown:dist_esm.woC,onClick:()=>{trackEvent("rich-text",{operation:"link-remove",source}),textEditor.chain().unsetLink().focus().run(),onComplete()},children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{small:!0,icon:"trash"})})]})}const MOVE_TIMEOUT=150,HIDE_VISIBILITY_TIMEOUT=16,SHOW_VISIBILITY_TIMEOUT=16,TOOLBAR_GAP=8,SCREEN_MARGIN=16,MIN_DISTANCE_TO_REPOSITION_SQUARED=256,CHANGE_ONLY_WHEN_Y_CHANGES=!0,LEFT_ALIGN_TOOLBAR=!1,DefaultRichTextToolbar=(0,dist_esm.u4I)((function DefaultRichTextToolbar2({children}){const editor=(0,dist_esm.hGv)(),textEditor=(0,dist_esm.hau)("textEditor",(()=>editor.getRichTextEditor()),[editor]);return editor.getInstanceState().isCoarsePointer||!textEditor?null:(0,jsx_runtime.jsx)(ContextualToolbarInner,{textEditor,children})}));function ContextualToolbarInner({textEditor,children}){const editor=(0,dist_esm.hGv)(),msg=useTranslation_useTranslation(),rToolbar=(0,react.useRef)(null),{isVisible,isInteractive,hide,show,position,move}=function useToolbarVisibilityStateMachine(){const editor=(0,dist_esm.hGv)(),rState=(0,react.useRef)({name:"hidden"}),[isInteractive,setIsInteractive]=(0,react.useState)(!1),[isVisible,setIsVisible]=(0,react.useState)(!1),[position,setPosition]=(0,react.useState)({x:-1e3,y:-1e3}),rCurrPosition=(0,react.useRef)(new dist_esm.l2P(-1e3,-1e3)),rNextPosition=(0,react.useRef)(new dist_esm.l2P(-1e3,-1e3)),rStableVisibilityTimeout=(0,react.useRef)(-1),rStablePositionTimeout=(0,react.useRef)(-1),move=(0,react.useCallback)(((x,y)=>{rNextPosition.current.x=x,rNextPosition.current.y=y,"hidden"!==rState.current.name&&"showing"!==rState.current.name&&(clearTimeout(rStablePositionTimeout.current),rStablePositionTimeout.current=editor.timers.setTimeout((()=>{if("shown"===rState.current.name&&function sufficientlyDistant(curr,next){if(CHANGE_ONLY_WHEN_Y_CHANGES)return dist_esm.l2P.Sub(next,curr).y**2>=MIN_DISTANCE_TO_REPOSITION_SQUARED;return dist_esm.l2P.Len2(dist_esm.l2P.Sub(next,curr))>=MIN_DISTANCE_TO_REPOSITION_SQUARED}(rNextPosition.current,rCurrPosition.current)){const{x:x2,y:y2}=rNextPosition.current;rCurrPosition.current=new dist_esm.l2P(x2,y2),setPosition({x:x2,y:y2})}}),MOVE_TIMEOUT))}),[editor]),hide=(0,react.useCallback)(((immediate=!1)=>{switch(rState.current.name){case"showing":clearTimeout(rStableVisibilityTimeout.current),rState.current={name:"hidden"};break;case"shown":rState.current={name:"hiding"},setIsInteractive(!1),immediate?(rState.current={name:"hidden"},setIsVisible(!1)):rStableVisibilityTimeout.current=editor.timers.setTimeout((()=>{rState.current={name:"hidden"},setIsVisible(!1)}),HIDE_VISIBILITY_TIMEOUT)}}),[editor]),show=(0,react.useCallback)((()=>{switch(rState.current.name){case"hidden":rState.current={name:"showing"},rStableVisibilityTimeout.current=editor.timers.setTimeout((()=>{const{x,y}=rNextPosition.current;rCurrPosition.current=new dist_esm.l2P(x,y),setPosition({x,y}),rState.current={name:"shown"},setIsVisible(!0),setIsInteractive(!0)}),SHOW_VISIBILITY_TIMEOUT);break;case"hiding":clearTimeout(rStableVisibilityTimeout.current),rState.current={name:"shown"},setIsInteractive(!0),move(rNextPosition.current.x,rNextPosition.current.y)}}),[editor,move]);return{isVisible,isInteractive,show,hide,move,position}}(),{isEditingLink,onEditLinkStart,onEditLinkComplete}=function useEditingLinkBehavior(textEditor){const[isEditingLink,setIsEditingLink]=(0,react.useState)(!1);(0,react.useEffect)((()=>{if(!textEditor)return void setIsEditingLink(!1);const handleClick=()=>{const isLinkActive=textEditor.isActive("link");setIsEditingLink(isLinkActive)};return textEditor.view.dom.addEventListener("click",handleClick),()=>{textEditor.view.dom.removeEventListener("click",handleClick)}}),[textEditor,isEditingLink]),(0,react.useEffect)((()=>{if(textEditor&&textEditor.isActive("link"))try{const{from,to}=(0,core_dist.ve)(textEditor.state.doc.resolve(textEditor.state.selection.from),textEditor.schema.marks.link);textEditor.state.selection.empty&&textEditor.commands.setTextSelection({from,to})}catch{}}),[textEditor,isEditingLink]);const onEditLinkStart=(0,react.useCallback)((()=>{setIsEditingLink(!0)}),[]),onEditLinkCancel=(0,react.useCallback)((()=>{setIsEditingLink(!1)}),[]),onEditLinkComplete=(0,react.useCallback)((()=>{if(setIsEditingLink(!1),!textEditor)return;const from=textEditor.state.selection.from;textEditor.commands.setTextSelection({from,to:from})}),[textEditor]);return{isEditingLink,onEditLinkStart,onEditLinkComplete,onEditLinkCancel}}(textEditor),forcePositionUpdateAtom=(0,dist_esm.fpl)("force toolbar position update",0);(0,react.useEffect)((function forceUpdateWhenSelectionUpdates(){function handleSelectionUpdate(){forcePositionUpdateAtom.update((t=>t+1))}return dist_esm.slq.requestAnimationFrame("first forced update",handleSelectionUpdate),textEditor.on("selectionUpdate",handleSelectionUpdate),()=>{textEditor.off("selectionUpdate",handleSelectionUpdate)}}),[textEditor,forcePositionUpdateAtom]),(0,dist_esm.a1r)("shape change",(function forceUpdateOnNextFrameWhenShapeChanges(){editor.getEditingShape(),forcePositionUpdateAtom.update((t=>t+1))}),[editor]);const rCouldShowToolbar=(0,react.useRef)(!1),[hasValidToolbarPosition,setHasValidToolbarPosition]=(0,react.useState)(!1);(0,dist_esm.lXS)("toolbar position",(function updateToolbarPositionAndDisplay(){const toolbarElm=rToolbar.current;if(!toolbarElm)return;editor.getCamera(),forcePositionUpdateAtom.get();const position2=function getToolbarScreenPosition(editor,toolbarElm){const selection=window.getSelection();if(!selection||0===selection.rangeCount||selection.isCollapsed)return;const rangeBoxes=[];for(let i=0;i<selection.rangeCount;i++){const range=selection.getRangeAt(i);rangeBoxes.push(rectToBox(range.getBoundingClientRect()))}const selectionBounds=dist_esm.azJ.Common(rangeBoxes),vsb=editor.getViewportScreenBounds();if(selectionBounds.x-=vsb.x,selectionBounds.y-=vsb.y,selectionBounds.midY<SCREEN_MARGIN||selectionBounds.midY>vsb.h-SCREEN_MARGIN||selectionBounds.midX<SCREEN_MARGIN||selectionBounds.midX>vsb.w-SCREEN_MARGIN)return;const toolbarBounds=rectToBox(toolbarElm.getBoundingClientRect());if(!toolbarBounds.width||!toolbarBounds.height)return;const{scrollLeft,scrollTop}=editor.getContainer();let x=LEFT_ALIGN_TOOLBAR?selectionBounds.x:selectionBounds.midX-toolbarBounds.w/2,y=selectionBounds.y-toolbarBounds.h-TOOLBAR_GAP;return x=(0,dist_esm.qE8)(x,SCREEN_MARGIN,vsb.w-toolbarBounds.w-SCREEN_MARGIN),y=(0,dist_esm.qE8)(y,SCREEN_MARGIN,vsb.h-toolbarBounds.h-SCREEN_MARGIN),x+=scrollLeft,y+=scrollTop,x=Math.round(x),y=Math.round(y),{x,y}}(editor,toolbarElm);if(!position2)return void(rCouldShowToolbar.current&&(rCouldShowToolbar.current=!1,setHasValidToolbarPosition(!1)));if("moving"===editor.getCameraState()){rToolbar.current.style.setProperty("transform",`translate(${position2.x}px, ${position2.y}px)`)}else move(position2.x,position2.y);rCouldShowToolbar.current||(rCouldShowToolbar.current=!0,setHasValidToolbarPosition(!0))}),[editor,textEditor,forcePositionUpdateAtom]);const cameraState=(0,dist_esm.hau)("camera state",(()=>editor.getCameraState()),[editor]),isMousingDown=function useIsMousingDownOnTextEditor(textEditor){const[isMousingDown,setIsMousingDown]=(0,react.useState)(!1);return(0,react.useEffect)((()=>{if(!textEditor)return;const handlePointingStateChange=(0,dist_esm.sg1)((({isPointing})=>{setIsMousingDown(isPointing)}),16),handlePointingDown=()=>handlePointingStateChange({isPointing:!0}),handlePointingUp=()=>handlePointingStateChange({isPointing:!1}),touchDownEvents=["touchstart","pointerdown","mousedown"],touchUpEvents=["touchend","pointerup","mouseup"];return touchDownEvents.forEach((eventName=>{textEditor.view.dom.addEventListener(eventName,handlePointingDown)})),touchUpEvents.forEach((eventName=>{document.body.addEventListener(eventName,handlePointingUp)})),()=>{touchDownEvents.forEach((eventName=>{textEditor.view.dom.removeEventListener(eventName,handlePointingDown)})),touchUpEvents.forEach((eventName=>{document.body.removeEventListener(eventName,handlePointingUp)}))}}),[textEditor]),isMousingDown}(textEditor);return(0,react.useEffect)((()=>{"moving"!==cameraState?!isMousingDown&&hasValidToolbarPosition?show():hide():hide(!0)}),[hasValidToolbarPosition,cameraState,isMousingDown,show,hide]),(0,react.useLayoutEffect)((()=>{const elm=rToolbar.current;elm&&(elm.dataset.visible=`${isVisible}`)}),[isVisible,position]),(0,react.useLayoutEffect)((()=>{const elm=rToolbar.current;elm&&elm.style.setProperty("transform",`translate(${position.x}px, ${position.y}px)`)}),[position]),(0,react.useLayoutEffect)((()=>{const elm=rToolbar.current;elm&&(elm.dataset.interactive=`${isInteractive}`)}),[isInteractive]),(0,jsx_runtime.jsx)(TldrawUiContextualToolbar,{ref:rToolbar,className:"tlui-rich-text__toolbar","data-interactive":!1,"data-visible":!1,label:msg("tool.rich-text-toolbar-title"),children:children||(isEditingLink?(0,jsx_runtime.jsx)(LinkEditor,{textEditor,value:textEditor.isActive("link")?textEditor.getAttributes("link").href:"",onComplete:onEditLinkComplete}):(0,jsx_runtime.jsx)(DefaultRichTextToolbarContent,{textEditor,onEditLinkStart}))})}function rectToBox(rect){return new dist_esm.azJ(rect.x,rect.y,rect.width,rect.height)}function MobileStylePanel(){const editor=(0,dist_esm.hGv)(),msg=useTranslation_useTranslation(),relevantStyles=useRelevantStyles(),color=relevantStyles?.get(dist_esm.ive),theme=(0,dist_esm.AnR)({isDarkMode:editor.user.getIsDarkMode()}),currentColor=("shared"===color?.type?theme[color.value]:theme.black).solid,disableStylePanel=(0,dist_esm.hau)("disable style panel",(()=>editor.isInAny("hand","zoom","eraser","laser")),[editor]),handleStylesOpenChange=(0,react.useCallback)((isOpen=>{isOpen||editor.updateInstanceState({isChangingStyle:!1})}),[editor]),{StylePanel}=useTldrawUiComponents();return StylePanel?(0,jsx_runtime.jsxs)(TldrawUiPopover,{id:"mobile style menu",onOpenChange:handleStylesOpenChange,children:[(0,jsx_runtime.jsx)(TldrawUiPopoverTrigger,{children:(0,jsx_runtime.jsx)(TldrawUiButton,{type:"tool","data-testid":"mobile-styles.button",style:{color:disableStylePanel?"var(--color-muted-1)":currentColor},title:msg("style-panel.title"),disabled:disableStylePanel,children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:disableStylePanel?"blob":"mixed"===color?.type?"mixed":"blob"})})}),(0,jsx_runtime.jsx)(TldrawUiPopoverContent,{side:"top",align:"end",children:StylePanel&&(0,jsx_runtime.jsx)(StylePanel,{isMobile:!0})})]}):null}function DefaultToolbarContent(){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(SelectToolbarItem,{}),(0,jsx_runtime.jsx)(HandToolbarItem,{}),(0,jsx_runtime.jsx)(DrawToolbarItem,{}),(0,jsx_runtime.jsx)(EraserToolbarItem,{}),(0,jsx_runtime.jsx)(ArrowToolbarItem,{}),(0,jsx_runtime.jsx)(TextToolbarItem,{}),(0,jsx_runtime.jsx)(NoteToolbarItem,{}),(0,jsx_runtime.jsx)(AssetToolbarItem,{}),(0,jsx_runtime.jsx)(RectangleToolbarItem,{}),(0,jsx_runtime.jsx)(EllipseToolbarItem,{}),(0,jsx_runtime.jsx)(TriangleToolbarItem,{}),(0,jsx_runtime.jsx)(DiamondToolbarItem,{}),(0,jsx_runtime.jsx)(HexagonToolbarItem,{}),(0,jsx_runtime.jsx)(OvalToolbarItem,{}),(0,jsx_runtime.jsx)(RhombusToolbarItem,{}),(0,jsx_runtime.jsx)(StarToolbarItem,{}),(0,jsx_runtime.jsx)(CloudToolbarItem,{}),(0,jsx_runtime.jsx)(HeartToolbarItem,{}),(0,jsx_runtime.jsx)(XBoxToolbarItem,{}),(0,jsx_runtime.jsx)(CheckBoxToolbarItem,{}),(0,jsx_runtime.jsx)(ArrowLeftToolbarItem,{}),(0,jsx_runtime.jsx)(ArrowUpToolbarItem,{}),(0,jsx_runtime.jsx)(ArrowDownToolbarItem,{}),(0,jsx_runtime.jsx)(ArrowRightToolbarItem,{}),(0,jsx_runtime.jsx)(LineToolbarItem,{}),(0,jsx_runtime.jsx)(HighlightToolbarItem,{}),(0,jsx_runtime.jsx)(LaserToolbarItem,{}),(0,jsx_runtime.jsx)(FrameToolbarItem,{})]})}function useIsToolSelected(tool){const editor=(0,dist_esm.hGv)(),geo=tool?.meta?.geo;return(0,dist_esm.hau)("is tool selected",(()=>{if(!tool)return!1;const activeToolId=editor.getCurrentToolId();return"geo"===activeToolId?geo===editor.getSharedStyles().getAsKnownValue(dist_esm.tg8):activeToolId===tool.id}),[editor,tool?.id,geo])}function ToolbarItem({tool}){const isSelected=useIsToolSelected(useTools()[tool]);return(0,jsx_runtime.jsx)(TldrawUiMenuToolItem,{toolId:tool,isSelected})}function SelectToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"select"})}function HandToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"hand"})}function DrawToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"draw"})}function EraserToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"eraser"})}function ArrowToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"arrow"})}function TextToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"text"})}function NoteToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"note"})}function AssetToolbarItem(){return(0,jsx_runtime.jsx)(TldrawUiMenuToolItem,{toolId:"asset"})}function RectangleToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"rectangle"})}function EllipseToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"ellipse"})}function DiamondToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"diamond"})}function TriangleToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"triangle"})}function RhombusToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"rhombus"})}function HeartToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"heart"})}function HexagonToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"hexagon"})}function CloudToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"cloud"})}function StarToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"star"})}function OvalToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"oval"})}function XBoxToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"x-box"})}function CheckBoxToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"check-box"})}function ArrowLeftToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"arrow-left"})}function ArrowUpToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"arrow-up"})}function ArrowDownToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"arrow-down"})}function ArrowRightToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"arrow-right"})}function LineToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"line"})}function HighlightToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"highlight"})}function FrameToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"frame"})}function LaserToolbarItem(){return(0,jsx_runtime.jsx)(ToolbarItem,{tool:"laser"})}const isff="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function addEvent(object,event,method,useCapture){object.addEventListener?object.addEventListener(event,method,useCapture):object.attachEvent&&object.attachEvent("on".concat(event),method)}function removeEvent(object,event,method,useCapture){object.removeEventListener?object.removeEventListener(event,method,useCapture):object.detachEvent&&object.detachEvent("on".concat(event),method)}function getMods(modifier,key){const mods=key.slice(0,key.length-1);for(let i=0;i<mods.length;i++)mods[i]=modifier[mods[i].toLowerCase()];return mods}function getKeys(key){"string"!=typeof key&&(key="");const keys=(key=key.replace(/\s/g,"")).split(",");let index=keys.lastIndexOf("");for(;index>=0;)keys[index-1]+=",",keys.splice(index,1),index=keys.lastIndexOf("");return keys}const _keyMap={backspace:8,"â«":8,tab:9,clear:12,enter:13,"â©":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"âª":20,",":188,".":190,"/":191,"`":192,"-":isff?173:189,"=":isff?61:187,";":isff?59:186,"'":222,"[":219,"]":221,"\\":220},_modifier={"â§":16,shift:16,"â¥":18,alt:18,option:18,"â":17,ctrl:17,control:17,"â":91,cmd:91,command:91},modifierMap={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},_mods={16:!1,18:!1,17:!1,91:!1},_handlers={};for(let k=1;k<20;k++)_keyMap["f".concat(k)]=111+k;let _downKeys=[],winListendFocus=null,_scope="all";const elementEventMap=new Map,code=x=>_keyMap[x.toLowerCase()]||_modifier[x.toLowerCase()]||x.toUpperCase().charCodeAt(0);function setScope(scope){_scope=scope||"all"}function getScope(){return _scope||"all"}function unbind(keysInfo){if(void 0===keysInfo)Object.keys(_handlers).forEach((key=>{Array.isArray(_handlers[key])&&_handlers[key].forEach((info=>eachUnbind(info))),delete _handlers[key]})),removeKeyEvent(null);else if(Array.isArray(keysInfo))keysInfo.forEach((info=>{info.key&&eachUnbind(info)}));else if("object"==typeof keysInfo)keysInfo.key&&eachUnbind(keysInfo);else if("string"==typeof keysInfo){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];let[scope,method]=args;"function"==typeof scope&&(method=scope,scope=""),eachUnbind({key:keysInfo,scope,method,splitKey:"+"})}}const eachUnbind=_ref3=>{let{key,scope,method,splitKey="+"}=_ref3;getKeys(key).forEach((originKey=>{const unbindKeys=originKey.split(splitKey),len=unbindKeys.length,lastKey=unbindKeys[len-1],keyCode="*"===lastKey?"*":code(lastKey);if(!_handlers[keyCode])return;scope||(scope=getScope());const mods=len>1?getMods(_modifier,unbindKeys):[],unbindElements=[];_handlers[keyCode]=_handlers[keyCode].filter((record=>{const isUnbind=(!method||record.method===method)&&record.scope===scope&&function compareArray(a1,a2){const arr1=a1.length>=a2.length?a1:a2,arr2=a1.length>=a2.length?a2:a1;let isIndex=!0;for(let i=0;i<arr1.length;i++)-1===arr2.indexOf(arr1[i])&&(isIndex=!1);return isIndex}(record.mods,mods);return isUnbind&&unbindElements.push(record.element),!isUnbind})),unbindElements.forEach((element=>removeKeyEvent(element)))}))};function eventHandler(event,handler,scope,element){if(handler.element!==element)return;let modifiersMatch;if(handler.scope===scope||"all"===handler.scope){modifiersMatch=handler.mods.length>0;for(const y in _mods)Object.prototype.hasOwnProperty.call(_mods,y)&&(!_mods[y]&&handler.mods.indexOf(+y)>-1||_mods[y]&&-1===handler.mods.indexOf(+y))&&(modifiersMatch=!1);(0!==handler.mods.length||_mods[16]||_mods[18]||_mods[17]||_mods[91])&&!modifiersMatch&&"*"!==handler.shortcut||(handler.keys=[],handler.keys=handler.keys.concat(_downKeys),!1===handler.method(event,handler)&&(event.preventDefault?event.preventDefault():event.returnValue=!1,event.stopPropagation&&event.stopPropagation(),event.cancelBubble&&(event.cancelBubble=!0)))}}function dispatch(event,element){const asterisk=_handlers["*"];let key=event.keyCode||event.which||event.charCode;if(!hotkeys.filter.call(this,event))return;if(93!==key&&224!==key||(key=91),-1===_downKeys.indexOf(key)&&229!==key&&_downKeys.push(key),["metaKey","ctrlKey","altKey","shiftKey"].forEach((keyName=>{const keyNum=modifierMap[keyName];event[keyName]&&-1===_downKeys.indexOf(keyNum)?_downKeys.push(keyNum):!event[keyName]&&_downKeys.indexOf(keyNum)>-1?_downKeys.splice(_downKeys.indexOf(keyNum),1):"metaKey"===keyName&&event[keyName]&&(_downKeys=_downKeys.filter((k=>k in modifierMap||k===key)))})),key in _mods){_mods[key]=!0;for(const k in _modifier)if(Object.prototype.hasOwnProperty.call(_modifier,k)){const eventKey=modifierMap[_modifier[k]];hotkeys[k]=event[eventKey]}if(!asterisk)return}for(const e in _mods)Object.prototype.hasOwnProperty.call(_mods,e)&&(_mods[e]=event[modifierMap[e]]);event.getModifierState&&(!event.altKey||event.ctrlKey)&&event.getModifierState("AltGraph")&&(-1===_downKeys.indexOf(17)&&_downKeys.push(17),-1===_downKeys.indexOf(18)&&_downKeys.push(18),_mods[17]=!0,_mods[18]=!0);const scope=getScope();if(asterisk)for(let i=0;i<asterisk.length;i++)asterisk[i].scope===scope&&("keydown"===event.type&&asterisk[i].keydown||"keyup"===event.type&&asterisk[i].keyup)&&eventHandler(event,asterisk[i],scope,element);if(!(key in _handlers))return;const handlerKey=_handlers[key],keyLen=handlerKey.length;for(let i=0;i<keyLen;i++)if(("keydown"===event.type&&handlerKey[i].keydown||"keyup"===event.type&&handlerKey[i].keyup)&&handlerKey[i].key){const record=handlerKey[i],{splitKey}=record,keyShortcut=record.key.split(splitKey),_downKeysCurrent=[];for(let a=0;a<keyShortcut.length;a++)_downKeysCurrent.push(code(keyShortcut[a]));_downKeysCurrent.sort().join("")===_downKeys.sort().join("")&&eventHandler(event,record,scope,element)}}function hotkeys(key,option,method){_downKeys=[];const keys=getKeys(key);let mods=[],scope="all",element=document,i=0,keyup=!1,keydown=!0,splitKey="+",capture=!1,single=!1;for(void 0===method&&"function"==typeof option&&(method=option),"[object Object]"===Object.prototype.toString.call(option)&&(option.scope&&(scope=option.scope),option.element&&(element=option.element),option.keyup&&(keyup=option.keyup),void 0!==option.keydown&&(keydown=option.keydown),void 0!==option.capture&&(capture=option.capture),"string"==typeof option.splitKey&&(splitKey=option.splitKey),!0===option.single&&(single=!0)),"string"==typeof option&&(scope=option),single&&unbind(key,scope);i<keys.length;i++)mods=[],(key=keys[i].split(splitKey)).length>1&&(mods=getMods(_modifier,key)),(key="*"===(key=key[key.length-1])?"*":code(key))in _handlers||(_handlers[key]=[]),_handlers[key].push({keyup,keydown,scope,mods,shortcut:keys[i],method,key:keys[i],splitKey,element});if(void 0!==element&&window){if(!elementEventMap.has(element)){const keydownListener=function(){return dispatch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event,element)},keyupListenr=function(){let event=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;dispatch(event,element),function clearModifier(event){let key=event.keyCode||event.which||event.charCode;const i=_downKeys.indexOf(key);if(i>=0&&_downKeys.splice(i,1),event.key&&"meta"===event.key.toLowerCase()&&_downKeys.splice(0,_downKeys.length),93!==key&&224!==key||(key=91),key in _mods){_mods[key]=!1;for(const k in _modifier)_modifier[k]===key&&(hotkeys[k]=!1)}}(event)};elementEventMap.set(element,{keydownListener,keyupListenr,capture}),addEvent(element,"keydown",keydownListener,capture),addEvent(element,"keyup",keyupListenr,capture)}if(!winListendFocus){const listener=()=>{_downKeys=[]};winListendFocus={listener,capture},addEvent(window,"focus",listener,capture)}}}function removeKeyEvent(element){const values=Object.values(_handlers).flat();if(values.findIndex((_ref4=>{let{element:el}=_ref4;return el===element}))<0){const{keydownListener,keyupListenr,capture}=elementEventMap.get(element)||{};keydownListener&&keyupListenr&&(removeEvent(element,"keyup",keyupListenr,capture),removeEvent(element,"keydown",keydownListener,capture),elementEventMap.delete(element))}if(values.length<=0||elementEventMap.size<=0){if(Object.keys(elementEventMap).forEach((el=>{const{keydownListener,keyupListenr,capture}=elementEventMap.get(el)||{};keydownListener&&keyupListenr&&(removeEvent(el,"keyup",keyupListenr,capture),removeEvent(el,"keydown",keydownListener,capture),elementEventMap.delete(el))})),elementEventMap.clear(),Object.keys(_handlers).forEach((key=>delete _handlers[key])),winListendFocus){const{listener,capture}=winListendFocus;removeEvent(window,"focus",listener,capture),winListendFocus=null}}}const _api={getPressedKeyString:function getPressedKeyString(){return _downKeys.map((c=>{return x=c,Object.keys(_keyMap).find((k=>_keyMap[k]===x))||(x=>Object.keys(_modifier).find((k=>_modifier[k]===x)))(c)||String.fromCharCode(c);var x}))},setScope,getScope,deleteScope:function deleteScope(scope,newScope){let handlers,i;scope||(scope=getScope());for(const key in _handlers)if(Object.prototype.hasOwnProperty.call(_handlers,key))for(handlers=_handlers[key],i=0;i<handlers.length;)if(handlers[i].scope===scope){handlers.splice(i,1).forEach((_ref2=>{let{element}=_ref2;return removeKeyEvent(element)}))}else i++;getScope()===scope&&setScope(newScope||"all")},getPressedKeyCodes:function getPressedKeyCodes(){return _downKeys.slice(0)},getAllKeyCodes:function getAllKeyCodes(){const result=[];return Object.keys(_handlers).forEach((k=>{_handlers[k].forEach((_ref=>{let{key,scope,mods,shortcut}=_ref;result.push({scope,shortcut,mods,keys:key.split("+").map((v=>code(v)))})}))})),result},isPressed:function isPressed(keyCode){return"string"==typeof keyCode&&(keyCode=code(keyCode)),-1!==_downKeys.indexOf(keyCode)},filter:function filter(event){const target=event.target||event.srcElement,{tagName}=target;let flag=!0;const isInput="INPUT"===tagName&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(target.type);return(target.isContentEditable||(isInput||"TEXTAREA"===tagName||"SELECT"===tagName)&&!target.readOnly)&&(flag=!1),flag},trigger:function trigger(shortcut){let scope=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";Object.keys(_handlers).forEach((key=>{_handlers[key].filter((item=>item.scope===scope&&item.shortcut===shortcut)).forEach((data=>{data&&data.method&&data.method()}))}))},unbind,keyMap:_keyMap,modifier:_modifier,modifierMap};for(const a in _api)Object.prototype.hasOwnProperty.call(_api,a)&&(hotkeys[a]=_api[a]);if("undefined"!=typeof window){const _hotkeys=window.hotkeys;hotkeys.noConflict=deep=>(deep&&window.hotkeys===hotkeys&&(window.hotkeys=_hotkeys),hotkeys),window.hotkeys=hotkeys}const SKIP_KBDS=["copy","cut","paste","asset"];function useKeyboardShortcuts_areShortcutsDisabled(editor){return editor.menus.hasAnyOpenMenus()||null!==editor.getEditingShapeId()||editor.getCrashingError()}function getHotkeysStringFromKbd(kbd){return function useKeyboardShortcuts_getKeys(key){"string"!=typeof key&&(key="");const keys=(key=key.replace(/\s/g,"")).split(",");let index=keys.lastIndexOf("");for(;index>=0;)keys[index-1]+=",",keys.splice(index,1),index=keys.lastIndexOf("");return keys}(kbd).map((kbd2=>{let str="";const shift=kbd2.includes("!"),alt=kbd2.includes("?"),cmd=kbd2.includes("$"),k=kbd2.replace(/[!?$]/g,"");return str=shift&&alt&&cmd?`cmd+shift+alt+${k},ctrl+shift+alt+${k}`:shift&&cmd?`cmd+shift+${k},ctrl+shift+${k}`:alt&&cmd?`cmd+alt+${k},ctrl+alt+${k}`:alt&&shift?`shift+alt+${k}`:shift?`shift+${k}`:alt?`alt+${k}`:cmd?`cmd+${k},ctrl+${k}`:k,str})).join(",")}const IsInOverflowContext=(0,react.createContext)(!1),NUMBERED_SHORTCUT_KEYS={1:0,2:1,3:2,4:3,5:4,6:5,7:6,8:7,9:8,0:9};function OverflowingToolbar({children}){const editor=(0,dist_esm.hGv)(),id=(0,dist_esm.LsA)(),breakpoint=useBreakpoint(),msg=useTranslation_useTranslation(),rButtons=(0,react.useRef)([]),[isOpen,setIsOpen]=(0,react.useState)(!1),overflowIndex=Math.min(8,5+breakpoint),[totalItems,setTotalItems]=(0,react.useState)(0),mainToolsRef=(0,react.useRef)(null),[lastActiveOverflowItem,setLastActiveOverflowItem]=(0,react.useState)(null),css=(0,react.useMemo)((()=>`\n\t\t\t#${id}_main > *:nth-child(n + ${overflowIndex+(lastActiveOverflowItem?1:2)})${lastActiveOverflowItem?`:not([data-value="${lastActiveOverflowItem}"])`:""} {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\t\t\t#${id}_more > *:nth-child(-n + ${overflowIndex}) {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\t\t\t#${id}_more > *:nth-child(-n + ${overflowIndex+4}) {\n\t\t\t\tmargin-top: 0;\n\t\t\t}\n        `),[lastActiveOverflowItem,id,overflowIndex]),onDomUpdate=(0,dist_esm._q_)((()=>{if(!mainToolsRef.current)return;const children2=Array.from(mainToolsRef.current.children);setTotalItems(children2.length);children2.findIndex((el=>el.getAttribute("data-value")===lastActiveOverflowItem))<=overflowIndex&&setLastActiveOverflowItem(null);const activeElementIdx=Array.from(mainToolsRef.current.children).findIndex((el=>"true"===el.getAttribute("aria-pressed")));-1!==activeElementIdx&&(activeElementIdx>=overflowIndex&&setLastActiveOverflowItem(children2[activeElementIdx].getAttribute("data-value")),rButtons.current=Array.from(mainToolsRef.current?.children??[]).filter((el=>el instanceof HTMLElement&&("button"===el.tagName.toLowerCase()&&!(!el.offsetWidth&&!el.offsetHeight)))))}));(0,react.useLayoutEffect)((()=>{onDomUpdate()})),(0,react.useLayoutEffect)((()=>{if(!mainToolsRef.current)return;const mutationObserver=new MutationObserver(onDomUpdate);return mutationObserver.observe(mainToolsRef.current,{childList:!0,subtree:!0,attributeFilter:["data-value","aria-pressed"]}),()=>{mutationObserver.disconnect()}}),[onDomUpdate]),(0,react.useEffect)((()=>{if(editor.options.enableToolbarKeyboardShortcuts)return document.addEventListener("keydown",handleKeyDown),()=>{document.removeEventListener("keydown",handleKeyDown)};function handleKeyDown(event){if(useKeyboardShortcuts_areShortcutsDisabled(editor)||(0,dist_esm.ghB)(!0))return;if(event.ctrlKey||event.metaKey||event.altKey||event.shiftKey)return;const index=NUMBERED_SHORTCUT_KEYS[event.key];"number"==typeof index&&((0,dist_esm.woC)(event),rButtons.current[index]?.click())}}),[editor]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("style",{nonce:editor.options.nonce,children:css}),(0,jsx_runtime.jsxs)(TldrawUiToolbar,{className:classnames_default()("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":breakpoint<PORTRAIT_BREAKPOINT.TABLET_SM}),label:msg("tool-panel.title"),children:[(0,jsx_runtime.jsx)("div",{id:`${id}_main`,ref:mainToolsRef,className:"tlui-toolbar__tools__list",children:(0,jsx_runtime.jsx)(TldrawUiMenuContextProvider,{type:"toolbar",sourceId:"toolbar",children})}),totalItems>overflowIndex+1&&(0,jsx_runtime.jsx)(IsInOverflowContext.Provider,{value:!0,children:(0,jsx_runtime.jsxs)(TldrawUiPopover,{id:"toolbar overflow",open:isOpen,onOpenChange:setIsOpen,children:[(0,jsx_runtime.jsx)(TldrawUiPopoverTrigger,{children:(0,jsx_runtime.jsx)(TldrawUiToolbarButton,{title:msg("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:"chevron-up"})})}),(0,jsx_runtime.jsx)(TldrawUiPopoverContent,{side:"top",align:"center",children:(0,jsx_runtime.jsx)(TldrawUiToolbar,{className:"tlui-buttons__grid","data-testid":"tools.more-content",label:msg("tool-panel.more"),id:`${id}_more`,onClick:()=>{dist_esm.NlK.deleteOpenMenu("toolbar overflow",editor.contextId),setIsOpen(!1)},children:(0,jsx_runtime.jsx)(TldrawUiMenuContextProvider,{type:"toolbar-overflow",sourceId:"toolbar",children})})})]})})]})]})}function ToggleToolLockedButton({activeToolId}){const editor=(0,dist_esm.hGv)(),breakpoint=useBreakpoint(),msg=useTranslation_useTranslation(),isToolLocked=(0,dist_esm.hau)("is tool locked",(()=>editor.getInstanceState().isToolLocked),[editor]),tool=(0,dist_esm.hau)("current tool",(()=>editor.getCurrentTool()),[editor]);return activeToolId&&tool.isLockable?(0,jsx_runtime.jsx)(TldrawUiButton,{type:"normal",title:msg("action.toggle-tool-lock"),"data-testid":"tool-lock",className:classnames_default()("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":breakpoint<PORTRAIT_BREAKPOINT.TABLET_SM}),onClick:()=>editor.updateInstanceState({isToolLocked:!isToolLocked}),children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:isToolLocked?"lock":"unlock",small:!0})}):null}const DefaultToolbar=(0,react.memo)((function DefaultToolbar2({children}){const editor=(0,dist_esm.hGv)(),msg=useTranslation_useTranslation(),breakpoint=useBreakpoint(),isReadonlyMode=useReadonly(),activeToolId=(0,dist_esm.hau)("current tool id",(()=>editor.getCurrentToolId()),[editor]),ref=(0,react.useRef)(null);(0,dist_esm.I9L)(ref);const{ActionsMenu,QuickActions}=useTldrawUiComponents(),showQuickActions="menu"!==editor.options.actionShortcutsLocation&&("toolbar"===editor.options.actionShortcutsLocation||breakpoint<PORTRAIT_BREAKPOINT.TABLET);return(0,jsx_runtime.jsx)("div",{ref,className:"tlui-toolbar",children:(0,jsx_runtime.jsxs)("div",{className:"tlui-toolbar__inner",children:[(0,jsx_runtime.jsxs)("div",{className:"tlui-toolbar__left",children:[!isReadonlyMode&&(0,jsx_runtime.jsxs)("div",{className:"tlui-toolbar__extras",children:[showQuickActions&&(0,jsx_runtime.jsxs)(TldrawUiToolbar,{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",label:msg("actions-menu.title"),children:[QuickActions&&(0,jsx_runtime.jsx)(QuickActions,{}),ActionsMenu&&(0,jsx_runtime.jsx)(ActionsMenu,{})]}),(0,jsx_runtime.jsx)(ToggleToolLockedButton,{activeToolId})]}),(0,jsx_runtime.jsx)(OverflowingToolbar,{children:children??(0,jsx_runtime.jsx)(DefaultToolbarContent,{})})]}),breakpoint<PORTRAIT_BREAKPOINT.TABLET_SM&&!isReadonlyMode&&(0,jsx_runtime.jsx)("div",{className:"tlui-toolbar__tools",children:(0,jsx_runtime.jsx)(MobileStylePanel,{})})]})})}));function OfflineIndicator(){const msg=useTranslation_useTranslation();return(0,jsx_runtime.jsxs)("div",{className:classnames_default()("tlui-offline-indicator"),children:[msg("status.offline"),(0,jsx_runtime.jsx)(TldrawUiIcon_TldrawUiIcon,{label:msg("status.offline"),icon:"status-offline",small:!0})]})}function CenteredTopPanelContainer({maxWidth=420,ignoreRightWidth=0,stylePanelWidth=148,marginBetweenZones=12,squeezeAmount=52,children}){const ref=(0,react.useRef)(null),breakpoint=useBreakpoint(),updateLayout=(0,react.useCallback)((()=>{const element=ref.current;if(!element)return;const layoutTop=element.parentElement.parentElement,leftPanel=layoutTop.querySelector(".tlui-layout__top__left"),rightPanel=layoutTop.querySelector(".tlui-layout__top__right"),totalWidth=layoutTop.offsetWidth,leftWidth=leftPanel.offsetWidth,rightWidth=rightPanel.offsetWidth;let xCoordIfCentered=(totalWidth-(element.offsetWidth-ignoreRightWidth))/2;totalWidth%2!=0&&(xCoordIfCentered-=.5);const xCoordIfLeftAligned=leftWidth+marginBetweenZones,left=element.offsetLeft,maxWidthProperty=Math.min(totalWidth-rightWidth-leftWidth-2*marginBetweenZones,maxWidth),xCoord=Math.max(xCoordIfCentered,xCoordIfLeftAligned)-left;rightPanel.offsetWidth>stylePanelWidth&&breakpoint<=6?element.style.setProperty("max-width",maxWidthProperty-squeezeAmount+"px"):element.style.setProperty("max-width",maxWidthProperty+"px"),element.style.setProperty("transform",`translate(${xCoord}px, 0px)`)}),[breakpoint,ignoreRightWidth,marginBetweenZones,maxWidth,squeezeAmount,stylePanelWidth]);return(0,react.useLayoutEffect)((()=>{const element=ref.current;if(!element)return;const layoutTop=element.parentElement.parentElement,leftPanel=layoutTop.querySelector(".tlui-layout__top__left"),rightPanel=layoutTop.querySelector(".tlui-layout__top__right"),observer=new ResizeObserver(updateLayout);return observer.observe(leftPanel),observer.observe(rightPanel),observer.observe(layoutTop),observer.observe(element),updateLayout(),()=>{observer.disconnect()}}),[updateLayout]),(0,react.useLayoutEffect)((()=>{updateLayout()})),(0,jsx_runtime.jsx)("div",{ref,className:"tlui-top-panel__container",children})}function DefaultTopPanel(){const isOffline="offline"===function useCollaborationStatus(){const editor=(0,dist_esm.frr)();return(0,dist_esm.hau)("sync status",(()=>editor?.store.props.collaboration?.status?editor.store.props.collaboration.status.get():null),[editor])}();return(0,jsx_runtime.jsx)(CenteredTopPanelContainer,{children:isOffline&&(0,jsx_runtime.jsx)(OfflineIndicator,{})})}function DefaultZoomMenuContent(){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"zoom-in",noClose:!0}),(0,jsx_runtime.jsx)(TldrawUiMenuActionItem_TldrawUiMenuActionItem,{actionId:"zoom-out",noClose:!0}),(0,jsx_runtime.jsx)(menu_items_ZoomTo100MenuItem,{}),(0,jsx_runtime.jsx)(ZoomToFitMenuItem,{}),(0,jsx_runtime.jsx)(ZoomToSelectionMenuItem,{})]})}const DefaultZoomMenu=(0,react.memo)((function DefaultZoomMenu2({children}){const container=(0,dist_esm.NFA)(),[isOpen,onOpenChange]=useMenuIsOpen("zoom menu"),content=children??(0,jsx_runtime.jsx)(DefaultZoomMenuContent,{});return(0,jsx_runtime.jsxs)(Root2,{dir:"ltr",open:isOpen,onOpenChange,modal:!1,children:[(0,jsx_runtime.jsx)(ZoomTriggerButton,{}),(0,jsx_runtime.jsx)(Portal2,{container,children:(0,jsx_runtime.jsx)(dist_Content2,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:(0,jsx_runtime.jsx)(TldrawUiMenuContextProvider,{type:"menu",sourceId:"zoom-menu",children:content})})})]})})),ZoomTriggerButton=()=>{const editor=(0,dist_esm.hGv)(),breakpoint=useBreakpoint(),zoom=(0,dist_esm.hau)("zoom",(()=>editor.getZoomLevel()),[editor]),msg=useTranslation_useTranslation(),handleDoubleClick=(0,react.useCallback)((()=>{editor.resetZoom(editor.getViewportScreenCenter(),{animation:{duration:editor.options.animationMediumMs}})}),[editor]),value=`${Math.floor(100*zoom)}%`;return(0,jsx_runtime.jsx)(TldrawUiToolbarButton,{asChild:!0,type:"icon","aria-label":`${msg("navigation-zone.zoom")} â ${value}`,title:`${msg("navigation-zone.zoom")} â ${value}`,"data-testid":"minimap.zoom-menu-button",className:"tlui-zoom-menu__button",onDoubleClick:handleDoubleClick,children:(0,jsx_runtime.jsx)(Trigger,{dir:"ltr",children:breakpoint<PORTRAIT_BREAKPOINT.MOBILE?null:(0,jsx_runtime.jsx)("span",{style:{flexGrow:0,textAlign:"center"},children:value})})})},TldrawUiComponentsContext=(0,react.createContext)(null);function TldrawUiComponentsProvider({overrides={},children}){const _overrides=(0,dist_esm.dSk)(overrides),showCollaborationUi=useShowCollaborationUi();return(0,jsx_runtime.jsx)(TldrawUiComponentsContext.Provider,{value:(0,react.useMemo)((()=>({ContextMenu:DefaultContextMenu,ActionsMenu:DefaultActionsMenu,HelpMenu:null,ZoomMenu:DefaultZoomMenu,MainMenu:DefaultMainMenu,Minimap:DefaultMinimap,StylePanel:DefaultStylePanel,PageMenu:DefaultPageMenu,NavigationPanel:DefaultNavigationPanel,Toolbar:DefaultToolbar,RichTextToolbar:DefaultRichTextToolbar,KeyboardShortcutsDialog:DefaultKeyboardShortcutsDialog,QuickActions:DefaultQuickActions,HelperButtons:DefaultHelperButtons,DebugPanel:DefaultDebugPanel,DebugMenu:DefaultDebugMenu,MenuPanel:DefaultMenuPanel,SharePanel:showCollaborationUi?DefaultSharePanel:null,CursorChatBubble:showCollaborationUi?CursorChatBubble:null,TopPanel:showCollaborationUi?DefaultTopPanel:null,Dialogs:DefaultDialogs,Toasts:DefaultToasts,A11y:DefaultA11yAnnouncer,..._overrides})),[_overrides,showCollaborationUi]),children})}function useTldrawUiComponents(){const components=(0,react.useContext)(TldrawUiComponentsContext);if(!components)throw new Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return components}const TldrawUiContextProvider=(0,dist_esm.u4I)((function TldrawUiContextProvider2({overrides,components,assetUrls,onUiEvent,forceMobile,mediaMimeTypes,children}){const editor=(0,dist_esm.frr)();return(0,jsx_runtime.jsx)(MimeTypeContext.Provider,{value:mediaMimeTypes,children:(0,jsx_runtime.jsx)(AssetUrlsProvider,{assetUrls:useDefaultUiAssetUrlsWithOverrides(assetUrls),children:(0,jsx_runtime.jsx)(TldrawUiTranslationProvider,{overrides:useMergedTranslationOverrides(overrides),locale:editor?.user.getLocale()??dist_esm.TjI.locale,children:(0,jsx_runtime.jsx)(TldrawUiEventsProvider,{onEvent:onUiEvent,children:(0,jsx_runtime.jsx)(TldrawUiToastsProvider,{children:(0,jsx_runtime.jsx)(TldrawUiDialogsProvider,{context:"tla",children:(0,jsx_runtime.jsx)(TldrawUiA11yProvider,{children:(0,jsx_runtime.jsx)(BreakPointProvider,{forceMobile,children:(0,jsx_runtime.jsx)(TldrawUiComponentsProvider,{overrides:components,children:(0,jsx_runtime.jsx)(InternalProviders,{overrides,children})})})})})})})})})})}));function InternalProviders({overrides,children}){const mergedOverrides=useMergedOverrides(overrides);return(0,jsx_runtime.jsx)(ActionsProvider,{overrides:mergedOverrides.actions,children:(0,jsx_runtime.jsx)(ToolsProvider,{overrides:mergedOverrides.tools,children})})}const TldrawUi=react.memo((function TldrawUi2({renderDebugMenuItems,children,hideUi,components,...rest}){return(0,jsx_runtime.jsx)(TldrawUiContextProvider,{...rest,components,children:(0,jsx_runtime.jsx)(TldrawUiInner,{hideUi,renderDebugMenuItems,children})})})),TldrawUiInner=react.memo((function TldrawUiInner2({children,hideUi,...rest}){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[children,hideUi?null:(0,jsx_runtime.jsx)(TldrawUiContent,{...rest})]})})),TldrawUiContent=react.memo((function TldrawUI(){const editor=(0,dist_esm.hGv)(),msg=useTranslation_useTranslation(),breakpoint=useBreakpoint(),isReadonlyMode=useReadonly(),isFocusMode=(0,dist_esm.hau)("focus",(()=>editor.getInstanceState().isFocusMode),[editor]),isDebugMode=(0,dist_esm.hau)("debug",(()=>editor.getInstanceState().isDebugMode),[editor]),{SharePanel,TopPanel,MenuPanel,StylePanel,Toolbar,HelpMenu,NavigationPanel,HelperButtons,DebugPanel,CursorChatBubble,RichTextToolbar,Toasts,Dialogs,A11y}=useTldrawUiComponents();!function useKeyboardShortcuts(){const editor=(0,dist_esm.hGv)(),isReadonlyMode=useReadonly(),actions=useActions(),tools=useTools(),isFocused=(0,dist_esm.hau)("is focused",(()=>editor.getInstanceState().isFocused),[editor]);(0,react.useEffect)((()=>{if(!isFocused)return;const disposables=new Array,hot=(keys,callback)=>{hotkeys(keys,{element:document.body},callback),disposables.push((()=>{hotkeys.unbind(keys,callback)}))};for(const action of Object.values(actions))action.kbd&&(isReadonlyMode&&!action.readonlyOk||SKIP_KBDS.includes(action.id)||hot(getHotkeysStringFromKbd(action.kbd),(event=>{useKeyboardShortcuts_areShortcutsDisabled(editor)||((0,dist_esm.woC)(event),action.onSelect("kbd"))})));for(const tool of Object.values(tools))!tool.kbd||!tool.readonlyOk&&editor.getIsReadonly()||SKIP_KBDS.includes(tool.id)||hot(getHotkeysStringFromKbd(tool.kbd),(event=>{useKeyboardShortcuts_areShortcutsDisabled(editor)||((0,dist_esm.woC)(event),tool.onSelect("kbd"))}));var keys,callback;return hot(",",(e=>{if(useKeyboardShortcuts_areShortcutsDisabled(editor))return;if(editor.inputs.keys.has("Comma"))return;(0,dist_esm.woC)(e),editor.focus(),editor.inputs.keys.add("Comma");const{x,y,z}=editor.inputs.currentPagePoint,screenpoints=editor.pageToScreen({x,y}),info={type:"pointer",name:"pointer_down",point:{x:screenpoints.x,y:screenpoints.y,z},shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,metaKey:e.metaKey,accelKey:(0,dist_esm.gu7)(e),pointerId:0,button:0,isPen:editor.getInstanceState().isPenMode,target:"canvas"};editor.dispatch(info)})),callback=e=>{if(useKeyboardShortcuts_areShortcutsDisabled(editor))return;if(!editor.inputs.keys.has("Comma"))return;editor.inputs.keys.delete("Comma");const{x,y,z}=editor.inputs.currentScreenPoint,info={type:"pointer",name:"pointer_up",point:{x,y,z},shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,metaKey:e.metaKey,accelKey:(0,dist_esm.gu7)(e),pointerId:0,button:0,isPen:editor.getInstanceState().isPenMode,target:"canvas"};editor.dispatch(info)},hotkeys(keys=",",{element:document.body,keyup:!0,keydown:!1},callback),disposables.push((()=>{hotkeys.unbind(keys,callback)})),()=>{disposables.forEach((d=>d()))}}),[actions,tools,isReadonlyMode,editor,isFocused])}(),useNativeClipboardEvents(),function useEditorEvents(){const editor=(0,dist_esm.hGv)(),{addToast}=useToasts();(0,react.useEffect)((()=>{function handleMaxShapes({name,count}){addToast({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${name} (${count}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return editor.addListener("max-shapes",handleMaxShapes),()=>{editor.removeListener("max-shapes",handleMaxShapes)}}),[editor,addToast])}();const rIsEditingAnything=(0,react.useRef)(!1),rHidingTimeout=(0,react.useRef)(-1),[hideToolbarWhileEditing,setHideToolbarWhileEditing]=(0,react.useState)(!1);(0,dist_esm.a1r)("update hide toolbar while delayed",(()=>{if(!(dist_esm.YZA.isIos||dist_esm.YZA.isAndroid))return;null!==editor.getEditingShapeId()?rIsEditingAnything.current||(rIsEditingAnything.current=!0,clearTimeout(rHidingTimeout.current),setHideToolbarWhileEditing(!0)):rIsEditingAnything.current&&(rIsEditingAnything.current=!1,clearTimeout(rHidingTimeout.current),dist_esm.YZA.isAndroid?rHidingTimeout.current=editor.timers.setTimeout((()=>{setHideToolbarWhileEditing(!1)}),150):setHideToolbarWhileEditing(!1))}),[]);const{"toggle-focus-mode":toggleFocus}=useActions();return(0,jsx_runtime.jsxs)("div",{className:classnames_default()("tlui-layout",{"tlui-layout__mobile":breakpoint<PORTRAIT_BREAKPOINT.TABLET_SM}),"data-iseditinganything":hideToolbarWhileEditing,"data-breakpoint":breakpoint,children:[(0,jsx_runtime.jsx)(SkipToMainContent,{}),isFocusMode?(0,jsx_runtime.jsx)("div",{className:"tlui-layout__top",children:(0,jsx_runtime.jsx)(TldrawUiButton,{type:"icon",className:"tlui-focus-button",title:msg("focus-mode.toggle-focus-mode"),onClick:()=>toggleFocus.onSelect("menu"),children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:"dot"})})}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"tlui-layout__top",children:[(0,jsx_runtime.jsxs)("div",{className:"tlui-layout__top__left",children:[MenuPanel&&(0,jsx_runtime.jsx)(MenuPanel,{}),HelperButtons&&(0,jsx_runtime.jsx)(HelperButtons,{})]}),(0,jsx_runtime.jsx)("div",{className:"tlui-layout__top__center",children:TopPanel&&(0,jsx_runtime.jsx)(TopPanel,{})}),(0,jsx_runtime.jsxs)("div",{className:"tlui-layout__top__right",children:[SharePanel&&(0,jsx_runtime.jsx)(SharePanel,{}),StylePanel&&breakpoint>=PORTRAIT_BREAKPOINT.TABLET_SM&&!isReadonlyMode&&(0,jsx_runtime.jsx)(StylePanel,{})]})]}),(0,jsx_runtime.jsxs)("div",{className:"tlui-layout__bottom",children:[(0,jsx_runtime.jsxs)("div",{className:"tlui-layout__bottom__main",children:[NavigationPanel&&(0,jsx_runtime.jsx)(NavigationPanel,{}),Toolbar&&(0,jsx_runtime.jsx)(Toolbar,{}),HelpMenu&&(0,jsx_runtime.jsx)(HelpMenu,{})]}),isDebugMode&&DebugPanel&&(0,jsx_runtime.jsx)(DebugPanel,{}),A11y&&(0,jsx_runtime.jsx)(A11y,{})]})]}),RichTextToolbar&&(0,jsx_runtime.jsx)(RichTextToolbar,{}),Toasts&&(0,jsx_runtime.jsx)(Toasts,{}),Dialogs&&(0,jsx_runtime.jsx)(Dialogs,{}),(0,jsx_runtime.jsx)(FollowingIndicator,{}),CursorChatBubble&&(0,jsx_runtime.jsx)(CursorChatBubble,{})]})})),LoadingScreen=()=>{const{Spinner}=(0,dist_esm.BSi)();return(0,jsx_runtime.jsx)(TldrawUiContextProvider,{children:(0,jsx_runtime.jsx)(dist_esm.xxw,{children:Spinner?(0,jsx_runtime.jsx)(Spinner,{}):null})})},allDefaultTools=[...defaultTools,...defaultShapeTools];function Tldraw(props){const{children,maxImageDimension,maxAssetSize,acceptedImageMimeTypes,acceptedVideoMimeTypes,onMount,components={},shapeUtils=[],bindingUtils=[],tools=[],embeds,textOptions,...rest}=props,_components=(0,dist_esm.dSk)(components),componentsWithDefault=(0,react.useMemo)((()=>({Scribble:TldrawScribble,ShapeIndicators:TldrawShapeIndicators,CollaboratorScribble:TldrawScribble,SelectionForeground:TldrawSelectionForeground,Handles:TldrawHandles,Overlays:TldrawOverlays,Spinner,LoadingScreen,..._components})),[_components]),_shapeUtils=(0,dist_esm.H80)(shapeUtils),shapeUtilsWithDefaults=(0,react.useMemo)((()=>(0,dist_esm.OgJ)("type",_shapeUtils,defaultShapeUtils)),[_shapeUtils]),_bindingUtils=(0,dist_esm.H80)(bindingUtils),bindingUtilsWithDefaults=(0,react.useMemo)((()=>(0,dist_esm.OgJ)("type",_bindingUtils,defaultBindingUtils)),[_bindingUtils]),_tools=(0,dist_esm.H80)(tools),toolsWithDefaults=(0,react.useMemo)((()=>(0,dist_esm.OgJ)("id",allDefaultTools,_tools)),[_tools]),_imageMimeTypes=(0,dist_esm.H80)(acceptedImageMimeTypes??dist_esm.RBp),_videoMimeTypes=(0,dist_esm.H80)(acceptedVideoMimeTypes??dist_esm.qSO),textOptionsWithDefaults=(0,react.useMemo)((()=>({addFontsFromNode:defaultAddFontsFromNode,...textOptions,tipTapConfig:{extensions:tipTapDefaultExtensions,...textOptions?.tipTapConfig}})),[textOptions]),mediaMimeTypes=(0,react.useMemo)((()=>[..._imageMimeTypes,..._videoMimeTypes]),[_imageMimeTypes,_videoMimeTypes]),assets=function useDefaultEditorAssetsWithOverrides(overrides){return(0,react.useMemo)((()=>overrides?{fonts:{...defaultEditorAssetUrls.fonts,...overrides?.fonts}}:defaultEditorAssetUrls),[overrides])}(rest.assetUrls);return shapeUtilsWithDefaults.find((util=>"embed"===util.type))&&embeds&&EmbedShapeUtil.setEmbedDefinitions(embeds),(0,jsx_runtime.jsx)(dist_esm.O75,{initialState:"select",...rest,components:componentsWithDefault,shapeUtils:shapeUtilsWithDefaults,bindingUtils:bindingUtilsWithDefaults,tools:toolsWithDefaults,textOptions:textOptionsWithDefaults,assetUrls:assets,children:(0,jsx_runtime.jsxs)(TldrawUi,{...rest,components:componentsWithDefault,mediaMimeTypes,children:[(0,jsx_runtime.jsx)(InsideOfEditorAndUiContext,{maxImageDimension,maxAssetSize,acceptedImageMimeTypes:_imageMimeTypes,acceptedVideoMimeTypes:_videoMimeTypes,onMount}),children]})})}function InsideOfEditorAndUiContext({maxImageDimension,maxAssetSize,acceptedImageMimeTypes,acceptedVideoMimeTypes,onMount}){const editor=(0,dist_esm.hGv)(),toasts=useToasts(),msg=useTranslation_useTranslation();(0,dist_esm.yfR)((()=>{const unsubs=[];return unsubs.push(function registerDefaultSideEffects(editor){return editor.sideEffects.register({instance_page_state:{afterChange:(prev,next)=>{if(prev.croppingShapeId!==next.croppingShapeId){const isInCroppingState=editor.isIn("select.crop");!prev.croppingShapeId&&next.croppingShapeId?isInCroppingState||editor.setCurrentTool("select.crop.idle"):prev.croppingShapeId&&!next.croppingShapeId&&isInCroppingState&&editor.setCurrentTool("select.idle")}if(prev.editingShapeId!==next.editingShapeId)if(!prev.editingShapeId&&next.editingShapeId){if(!editor.isIn("select.editing_shape")){const shape=editor.getEditingShape();shape&&"text"===shape.type&&editor.isInAny("text.pointing","select.resizing")&&editor.getInstanceState().isToolLocked?editor.setCurrentTool("select.editing_shape",{isCreatingTextWhileToolLocked:!0}):editor.setCurrentTool("select.editing_shape")}}else prev.editingShapeId&&!next.editingShapeId&&editor.isIn("select.editing_shape")&&editor.setCurrentTool("select.idle")}}})}(editor)),editor.fonts.requestFonts(allDefaultFontFaces),registerDefaultExternalContentHandlers(editor,{maxImageDimension,maxAssetSize,acceptedImageMimeTypes,acceptedVideoMimeTypes,toasts,msg}),unsubs.push(editor.store.props.onMount(editor)),unsubs.push(onMount?.(editor)),()=>{unsubs.forEach((fn=>fn?.()))}}));const{Canvas}=(0,dist_esm.BSi)(),{ContextMenu}=useTldrawUiComponents();return ContextMenu?(0,jsx_runtime.jsx)(ContextMenu,{}):Canvas?(0,jsx_runtime.jsx)(Canvas,{}):null}const defaultTextOptions={tipTapConfig:{extensions:tipTapDefaultExtensions},addFontsFromNode:defaultAddFontsFromNode};(0,react.memo)((function TldrawImage2(props){const[url,setUrl]=(0,react.useState)(null),[container,setContainer]=(0,react.useState)(null),_shapeUtils=(0,dist_esm.H80)(props.shapeUtils??[]),shapeUtilsWithDefaults=(0,react.useMemo)((()=>(0,dist_esm.OgJ)("type",_shapeUtils,defaultShapeUtils)),[_shapeUtils]),_bindingUtils=(0,dist_esm.H80)(props.bindingUtils??[]),bindingUtilsWithDefaults=(0,react.useMemo)((()=>(0,dist_esm.OgJ)("type",_bindingUtils,defaultBindingUtils)),[_bindingUtils]),store=(0,dist_esm.jXu)({snapshot:props.snapshot,shapeUtils:shapeUtilsWithDefaults}),{pageId,bounds,scale,pixelRatio,background,padding,darkMode,preserveAspectRatio,format="svg",licenseKey,assetUrls,textOptions=defaultTextOptions}=props;return(0,react.useLayoutEffect)((()=>{if(!container)return;if(!store)return;let isCancelled=!1;const tempElm=document.createElement("div");container.appendChild(tempElm),container.classList.add("tl-container","tl-theme__light");const editor=new dist_esm.KE6({store,shapeUtils:shapeUtilsWithDefaults,bindingUtils:bindingUtilsWithDefaults,tools:[],getContainer:()=>tempElm,licenseKey,fontAssetUrls:assetUrls?.fonts,textOptions});pageId&&editor.setCurrentPage(pageId);const shapeIds=editor.getCurrentPageShapeIds();return async function setSvg(){const imageResult=await editor.toImage([...shapeIds],{bounds,scale,background,padding,darkMode,preserveAspectRatio,format});if(!imageResult||isCancelled)return;const url2=URL.createObjectURL(imageResult.blob);setUrl(url2),editor.dispose()}(),()=>{isCancelled=!0}}),[format,container,store,shapeUtilsWithDefaults,bindingUtilsWithDefaults,pageId,bounds,scale,background,padding,darkMode,preserveAspectRatio,licenseKey,pixelRatio,assetUrls,textOptions]),(0,react.useEffect)((()=>()=>{url&&URL.revokeObjectURL(url)}),[url]),(0,jsx_runtime.jsx)("div",{ref:setContainer,style:{position:"relative",width:"100%",height:"100%"},children:url&&(0,jsx_runtime.jsx)("img",{src:url,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})})})),(0,react.memo)((function DefaultHelpMenu2({children}){const msg=useTranslation_useTranslation(),breakpoint=useBreakpoint(),ref=(0,react.useRef)(null);(0,dist_esm.I9L)(ref);const content=children??(0,jsx_runtime.jsx)(DefaultHelpMenuContent,{});return breakpoint<PORTRAIT_BREAKPOINT.MOBILE?null:(0,jsx_runtime.jsx)("div",{ref,className:"tlui-help-menu",children:(0,jsx_runtime.jsxs)(TldrawUiDropdownMenuRoot,{id:"help menu",children:[(0,jsx_runtime.jsx)(TldrawUiDropdownMenuTrigger,{children:(0,jsx_runtime.jsx)(TldrawUiButton,{type:"help",title:msg("help-menu.title"),"data-testid":"help-menu.button",children:(0,jsx_runtime.jsx)(TldrawUiButtonIcon,{icon:"question-mark",small:!0})})}),(0,jsx_runtime.jsx)(TldrawUiDropdownMenuContent,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:(0,jsx_runtime.jsx)(TldrawUiMenuContextProvider,{type:"menu",sourceId:"help-menu",children:content})})]})})}));const schemaV1=dist_esm.T.object({schemaVersion:dist_esm.T.literal(1),storeVersion:dist_esm.T.positiveInteger,recordVersions:dist_esm.T.dict(dist_esm.T.string,dist_esm.T.object({version:dist_esm.T.positiveInteger,subTypeVersions:dist_esm.T.dict(dist_esm.T.string,dist_esm.T.positiveInteger).optional(),subTypeKey:dist_esm.T.string.optional()}))}),schemaV2=dist_esm.T.object({schemaVersion:dist_esm.T.literal(2),sequences:dist_esm.T.dict(dist_esm.T.string,dist_esm.T.positiveInteger)});dist_esm.T.object({tldrawFileFormatVersion:dist_esm.T.nonZeroInteger,schema:dist_esm.T.numberUnion("schemaVersion",{1:schemaV1,2:schemaV2}),records:dist_esm.T.arrayOf(dist_esm.T.object({id:dist_esm.T.string,typeName:dist_esm.T.string}).allowUnknownProperties())});(0,dist_esm.lFJ)("tldraw","3.13.1","esm"),(0,dist_esm.lFJ)("@tldraw/tldraw","3.13.1","esm")},"./node_modules/@tldraw/utils/dist-esm/index.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{RB:()=>DEFAULT_SUPPORTED_IMAGE_TYPES,MM:()=>DEFAULT_SUPPORTED_MEDIA_TYPE_LIST,qS:()=>DEFAULT_SUPPORT_VIDEO_TYPES,Sm:()=>FileHelpers,_V:()=>Image,K4:()=>MediaHelpers,f6:()=>PerformanceTracker,ZA:()=>PngHelpers,Q7:()=>Result,DM:()=>STRUCTURED_CLONE_OBJECT_PROTOTYPE,xl:()=>Timers,l:()=>WeakCache,as:()=>ZERO_INDEX_KEY,TF:()=>annotateError,vq:()=>areArraysShallowEqual,zK:()=>areObjectsShallowEqual,vA:()=>assert,Z1:()=>assertExists,oI:()=>bind,sw:()=>clearLocalStorage,D6:()=>clearSessionStorage,oE:()=>compact,sg:()=>debounce,Qq:()=>dedupe,ZJ:()=>deleteFromSessionStorage,h6:()=>exhaustiveSwitchError,hd:()=>fetch,J2:()=>filterEntries,zM:()=>getFromLocalStorage,_9:()=>getFromSessionStorage,Gw:()=>getHashForBuffer,xp:()=>getHashForString,AQ:()=>getIndexAbove,SB:()=>getIndexBelow,HE:()=>getIndexBetween,uu:()=>getIndices,Zo:()=>getIndicesAbove,MT:()=>getIndicesBetween,g5:()=>getOwnProperty,mQ:()=>object_hasOwnProperty,Fg:()=>invLerp,O9:()=>isDefined,HV:()=>last,Cc:()=>lerp,_H:()=>mapObjectMapValues,Sk:()=>maxBy,Og:()=>mergeArraysAndReplaceDefaults,wq:()=>minBy,ww:()=>modulate,lQ:()=>noop,iA:()=>objectMapEntries,_e:()=>objectMapFromEntries,w$:()=>objectMapKeys,Ic:()=>objectMapValues,il:()=>promiseWithResolve,lF:()=>registerTldrawLibraryVersion,Sh:()=>rng,yC:()=>safeParseUrl,Yz:()=>setInLocalStorage,dQ:()=>setInSessionStorage,yy:()=>control_sleep,rb:()=>sortById,Ky:()=>sortByIndex,pN:()=>structuredClone,nF:()=>lodash_throttle_default(),Uo:()=>throttleToNextFrame,sb:()=>lodash_uniq_default(),NF:()=>uniqueId,fb:()=>validateIndexKey});const TLDRAW_LIBRARY_VERSION_KEY="__TLDRAW_LIBRARY_VERSIONS__";function getLibraryVersions(){if(globalThis[TLDRAW_LIBRARY_VERSION_KEY])return globalThis[TLDRAW_LIBRARY_VERSION_KEY];const info={versions:[],didWarn:!1,scheduledNotice:null};return Object.defineProperty(globalThis,TLDRAW_LIBRARY_VERSION_KEY,{value:info,writable:!1,configurable:!1,enumerable:!1}),info}function registerTldrawLibraryVersion(name,version,modules){if(!name||!version||!modules)throw new Error("Missing name/version/module system in built version of tldraw library");const info=getLibraryVersions();if(info.versions.push({name,version,modules}),!info.scheduledNotice)try{info.scheduledNotice=setTimeout((()=>{info.scheduledNotice=null,checkLibraryVersions(info)}),100)}catch{checkLibraryVersions(info)}}function checkLibraryVersions(info){if(!info.versions.length)return;if(info.didWarn)return;const sorted=info.versions.sort(((a,b)=>compareVersions(a.version,b.version))),latestVersion=sorted[sorted.length-1].version,matchingVersions=new Set,nonMatchingVersions=new Map;for(const lib of sorted)nonMatchingVersions.has(lib.name)?(matchingVersions.delete(lib.name),entry(nonMatchingVersions,lib.name,new Set).add(lib.version)):lib.version===latestVersion?matchingVersions.add(lib.name):(matchingVersions.delete(lib.name),entry(nonMatchingVersions,lib.name,new Set).add(lib.version));if(nonMatchingVersions.size>0){const message=[`${format("[tldraw]",["bold","bgRed","textWhite"])} ${format("You have multiple versions of tldraw libraries installed. This can lead to bugs and unexpected behavior.",["textRed","bold"])}`,"",`The latest version you have installed is ${format(`v${latestVersion}`,["bold","textBlue"])}. The following libraries are on the latest version:`,...Array.from(matchingVersions,(name=>`  â¢ â ${format(name,["bold"])}`)),"","The following libraries are not on the latest version, or have multiple versions installed:",...Array.from(nonMatchingVersions,(([name,versions])=>{const sortedVersions=Array.from(versions).sort(compareVersions).map((v=>format(`v${v}`,v===latestVersion?["textGreen"]:["textRed"])));return`  â¢ â ${format(name,["bold"])} (${sortedVersions.join(", ")})`}))];return console.log(message.join("\n")),void(info.didWarn=!0)}const potentialDuplicates=new Map;for(const lib of sorted)entry(potentialDuplicates,lib.name,{version:lib.version,modules:[]}).modules.push(lib.modules);const duplicates=new Map;for(const[name,lib]of potentialDuplicates)lib.modules.length>1&&duplicates.set(name,lib);if(duplicates.size>0){const message=[`${format("[tldraw]",["bold","bgRed","textWhite"])} ${format("You have multiple instances of some tldraw libraries active. This can lead to bugs and unexpected behavior. ",["textRed","bold"])}`,"","This usually means that your bundler is misconfigured, and is importing the same library multiple times - usually once as an ES Module, and once as a CommonJS module.","","The following libraries have been imported multiple times:",...Array.from(duplicates,(([name,lib])=>{const modules=lib.modules.map(((m,i)=>"esm"===m?`      ${i+1}. ES Modules`:`      ${i+1}. CommonJS`)).join("\n");return`  â¢ â ${format(name,["bold"])} v${lib.version}: \n${modules}`})),"","You should configure your bundler to only import one version of each library."];return console.log(message.join("\n")),void(info.didWarn=!0)}}function compareVersions(a,b){const aMatch=a.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/),bMatch=b.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/);return aMatch&&bMatch?aMatch[1]!==bMatch[1]?Number(aMatch[1])-Number(bMatch[1]):aMatch[2]!==bMatch[2]?Number(aMatch[2])-Number(bMatch[2]):aMatch[3]!==bMatch[3]?Number(aMatch[3])-Number(bMatch[3]):aMatch[4]&&bMatch[4]?aMatch[4].localeCompare(bMatch[4]):aMatch[4]?1:bMatch[4]?-1:0:a.localeCompare(b)}const formats={bold:"1",textBlue:"94",textRed:"31",textGreen:"32",bgRed:"41",textWhite:"97"};function format(value,formatters=[]){return`[${formatters.map((f=>formats[f])).join(";")}m${value}[m`}function entry(map,key,defaultValue){return map.has(key)?map.get(key):(map.set(key,defaultValue),defaultValue)}var lodash_throttle=__webpack_require__("./node_modules/lodash.throttle/index.js"),lodash_throttle_default=__webpack_require__.n(lodash_throttle),lodash_uniq=__webpack_require__("./node_modules/lodash.uniq/index.js"),lodash_uniq_default=__webpack_require__.n(lodash_uniq);function omitFromStackTrace(fn){const wrappedFn=(...args)=>{try{return fn(...args)}catch(error){throw error instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(error,wrappedFn),error}};return wrappedFn}const noop=()=>{},Result={ok:value=>({ok:!0,value}),err:error=>({ok:!1,error})};function exhaustiveSwitchError(value,property){const debugValue=property&&value&&"object"==typeof value&&property in value?value[property]:value;throw new Error(`Unknown switch case ${debugValue}`)}const assert=omitFromStackTrace(((value,message)=>{if(!value)throw new Error(message||"Assertion Error")})),assertExists=omitFromStackTrace(((value,message)=>{if(null==value)throw new Error(message??"value must be defined");return value}));function promiseWithResolve(){let resolve,reject;const promise=new Promise(((res,rej)=>{resolve=res,reject=rej}));return Object.assign(promise,{resolve,reject})}function control_sleep(ms){return new Promise((resolve=>setTimeout(resolve,ms)))}const PERFORMANCE_COLORS_Good="#40C057",PERFORMANCE_COLORS_Mid="#FFC078",PERFORMANCE_COLORS_Poor="#E03131",PERFORMANCE_PREFIX_COLOR=PERFORMANCE_COLORS_Good;class PerformanceTracker{startTime=0;name="";frames=0;started=!1;frame=null;recordFrame=()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))};start(name){this.name=name,this.frames=0,this.started=!0,null!==this.frame&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,null!==this.frame&&cancelAnimationFrame(this.frame);const duration=(performance.now()-this.startTime)/1e3,fps=0===duration?0:Math.floor(this.frames/duration),background=fps>55?PERFORMANCE_COLORS_Good:fps>30?PERFORMANCE_COLORS_Mid:PERFORMANCE_COLORS_Poor,color=background===PERFORMANCE_COLORS_Mid?"black":"white",capitalized=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${capitalized} %c${fps}%c fps`,`color: white; background: ${PERFORMANCE_PREFIX_COLOR};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${background};color: ${color};`,"font-weight: normal")}isStarted(){return this.started}}function dedupe(input,equals){const result=[];mainLoop:for(const item of input){for(const existing of result)if(equals?equals(item,existing):item===existing)continue mainLoop;result.push(item)}return result}function compact(arr){return arr.filter((i=>null!=i))}function last(arr){return arr[arr.length-1]}function minBy(arr,fn){let min,minVal=1/0;for(const item of arr){const val=fn(item);val<minVal&&(min=item,minVal=val)}return min}function maxBy(arr,fn){let max,maxVal=-1/0;for(const item of arr){const val=fn(item);val>maxVal&&(max=item,maxVal=val)}return max}function areArraysShallowEqual(arr1,arr2){if(arr1===arr2)return!0;if(arr1.length!==arr2.length)return!1;for(let i=0;i<arr1.length;i++)if(!Object.is(arr1[i],arr2[i]))return!1;return!0}function mergeArraysAndReplaceDefaults(key,customEntries,defaults){const overrideTypes=new Set(customEntries.map((entry=>entry[key]))),result=[];for(const defaultEntry of defaults)overrideTypes.has(defaultEntry[key])||result.push(defaultEntry);for(const customEntry of customEntries)result.push(customEntry);return result}function bind(...args){if(2!==args.length){const[_target,propertyKey,descriptor]=args;if(!descriptor||"function"!=typeof descriptor.value)throw new TypeError(`Only methods can be decorated with @bind. <${propertyKey}> is not a method!`);return{configurable:!0,get(){const bound=descriptor.value.bind(this);return Object.defineProperty(this,propertyKey,{value:bound,configurable:!0,writable:!0}),bound}}}{const[originalMethod,context]=args;context.addInitializer((function initializeMethod(){assert(Reflect.isExtensible(this),"Cannot bind to a non-extensible class.");const value=originalMethod.bind(this),ok=Reflect.defineProperty(this,context.name,{value,writable:!0,configurable:!0});assert(ok,"Cannot bind a non-configurable class method.")}))}}class WeakCache{items=new WeakMap;get(item,cb){return this.items.has(item)||this.items.set(item,cb(item)),this.items.get(item)}}function debounce(callback,wait){let state;const fn=(...args)=>(state||(state={},state.promise=new Promise(((resolve,reject)=>{state.resolve=resolve,state.reject=reject}))),clearTimeout(state.timeout),state.latestArgs=args,state.timeout=setTimeout((()=>{const s=state;state=void 0;try{s.resolve(callback(...s.latestArgs))}catch(e){s.reject(e)}}),wait),state.promise);return fn.cancel=()=>{state&&clearTimeout(state.timeout)},fn}const annotationsByError=new WeakMap;function annotateError(error,annotations){if("object"!=typeof error||null===error)return;let currentAnnotations=annotationsByError.get(error);currentAnnotations||(currentAnnotations={tags:{},extras:{}},annotationsByError.set(error,currentAnnotations)),annotations.tags&&(currentAnnotations.tags={...currentAnnotations.tags,...annotations.tags}),annotations.extras&&(currentAnnotations.extras={...currentAnnotations.extras,...annotations.extras})}async function fetch(input,init){return window.fetch(input,{referrerPolicy:"strict-origin-when-cross-origin",...init})}const Image=(width,height)=>{const img=new window.Image(width,height);return img.referrerPolicy="strict-origin-when-cross-origin",img};class FileHelpers{static async dataUrlToArrayBuffer(dataURL){return fetch(dataURL).then((function(result){return result.arrayBuffer()}))}static async urlToArrayBuffer(url){const response=await fetch(url);return await response.arrayBuffer()}static async urlToBlob(url){const response=await fetch(url);return await response.blob()}static async urlToDataUrl(url){if(url.startsWith("data:"))return url;const blob=await FileHelpers.urlToBlob(url);return await FileHelpers.blobToDataUrl(blob)}static async blobToDataUrl(file){return await new Promise(((resolve,reject)=>{if(file){const reader=new FileReader;reader.onload=()=>resolve(reader.result),reader.onerror=error=>reject(error),reader.onabort=error=>reject(error),reader.readAsDataURL(file)}}))}static async blobToText(file){return await new Promise(((resolve,reject)=>{if(file){const reader=new FileReader;reader.onload=()=>resolve(reader.result),reader.onerror=error=>reject(error),reader.onabort=error=>reject(error),reader.readAsText(file)}}))}static rewriteMimeType(blob,newMimeType){return blob.type===newMimeType?blob:blob instanceof File?new File([blob],blob.name,{type:newMimeType}):new Blob([blob],{type:newMimeType})}}function getHashForString(string){let hash=0;for(let i=0;i<string.length;i++)hash=(hash<<5)-hash+string.charCodeAt(i),hash|=0;return hash+""}function getHashForBuffer(buffer){const view=new DataView(buffer);let hash=0;for(let i=0;i<view.byteLength;i++)hash=(hash<<5)-hash+view.getUint8(i),hash|=0;return hash+""}const id_crypto=globalThis.crypto,urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",POOL_SIZE_MULTIPLIER=128;let pool,poolOffset;function nanoid(size=21){!function fillPool(bytes){!pool||pool.length<bytes?(pool=new Uint8Array(bytes*POOL_SIZE_MULTIPLIER),id_crypto.getRandomValues(pool),poolOffset=0):poolOffset+bytes>pool.length&&(id_crypto.getRandomValues(pool),poolOffset=0),poolOffset+=bytes}(size-=0);let id="";for(let i=poolOffset-size;i<poolOffset;i++)id+=urlAlphabet[63&pool[i]];return id}let impl=nanoid;function uniqueId(size){return impl(size)}function getDataBlocksLength(buffer,offset){let length=0;for(;buffer[offset+length];)length+=buffer[offset+length]+1;return length+1}function isGifAnimated(buffer){const view=new Uint8Array(buffer);let hasColorTable,colorTableSize,offset=0,imagesCount=0;if(!function isGIF(buffer){return"GIF"===new TextDecoder("ascii").decode(buffer.slice(0,3))}(buffer))return!1;for(hasColorTable=128&view[10],colorTableSize=7&view[10],offset+=6,offset+=7,offset+=hasColorTable?3*Math.pow(2,colorTableSize+1):0;imagesCount<2&&offset<view.length;)switch(view[offset]){case 44:imagesCount+=1,hasColorTable=128&view[offset+9],colorTableSize=7&view[offset+9],offset+=10,offset+=hasColorTable?3*Math.pow(2,colorTableSize+1):0,offset+=getDataBlocksLength(view,offset+1)+1;break;case 33:offset+=2,offset+=getDataBlocksLength(view,offset);break;default:offset=view.length}return imagesCount>1}let TABLE=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];"undefined"!=typeof Int32Array&&(TABLE=new Int32Array(TABLE));class PngHelpers{static isPng(view,offset){return 137===view.getUint8(offset+0)&&80===view.getUint8(offset+1)&&78===view.getUint8(offset+2)&&71===view.getUint8(offset+3)&&13===view.getUint8(offset+4)&&10===view.getUint8(offset+5)&&26===view.getUint8(offset+6)&&10===view.getUint8(offset+7)}static getChunkType(view,offset){return[String.fromCharCode(view.getUint8(offset)),String.fromCharCode(view.getUint8(offset+1)),String.fromCharCode(view.getUint8(offset+2)),String.fromCharCode(view.getUint8(offset+3))].join("")}static readChunks(view,offset=0){const chunks={};if(!PngHelpers.isPng(view,offset))throw new Error("Not a PNG");for(offset+=8;offset<=view.buffer.byteLength;){const start=offset,len=view.getInt32(offset);offset+=4;const chunkType=PngHelpers.getChunkType(view,offset);if("IDAT"===chunkType&&chunks[chunkType])offset+=len+4+4;else{if("IEND"===chunkType)break;chunks[chunkType]={start,dataOffset:offset+4,size:len},offset+=len+4+4}}return chunks}static parsePhys(view,offset){return{ppux:view.getUint32(offset),ppuy:view.getUint32(offset+4),unit:view.getUint8(offset+4)}}static findChunk(view,type){return PngHelpers.readChunks(view)[type]}static setPhysChunk(view,dpr=1,options){let offset=46,size=0;const res1=PngHelpers.findChunk(view,"pHYs");res1&&(offset=res1.start,size=res1.size);const res2=PngHelpers.findChunk(view,"IDAT");res2&&(offset=res2.start,size=0);const pHYsData=new ArrayBuffer(21),pHYsDataView=new DataView(pHYsData);pHYsDataView.setUint32(0,9),pHYsDataView.setUint8(4,"p".charCodeAt(0)),pHYsDataView.setUint8(5,"H".charCodeAt(0)),pHYsDataView.setUint8(6,"Y".charCodeAt(0)),pHYsDataView.setUint8(7,"s".charCodeAt(0));pHYsDataView.setInt32(8,2835.5*dpr),pHYsDataView.setInt32(12,2835.5*dpr),pHYsDataView.setInt8(16,1);const crcBit=new Uint8Array(pHYsData.slice(4,17));pHYsDataView.setInt32(17,((current,previous)=>{let crc2=0===previous?0:~previous;for(let index=0;index<current.length;index++)crc2=TABLE[255&(crc2^current[index])]^crc2>>>8;return~crc2})(crcBit));const startBuf=view.buffer.slice(0,offset),endBuf=view.buffer.slice(offset+size);return new Blob([startBuf,pHYsData,endBuf],options)}}const DEFAULT_SUPPORTED_VECTOR_IMAGE_TYPES=Object.freeze(["image/svg+xml"]),DEFAULT_SUPPORTED_STATIC_IMAGE_TYPES=Object.freeze(["image/jpeg","image/png","image/webp"]),DEFAULT_SUPPORTED_ANIMATED_IMAGE_TYPES=Object.freeze(["image/gif","image/apng","image/avif"]),DEFAULT_SUPPORTED_IMAGE_TYPES=Object.freeze([...DEFAULT_SUPPORTED_STATIC_IMAGE_TYPES,...DEFAULT_SUPPORTED_VECTOR_IMAGE_TYPES,...DEFAULT_SUPPORTED_ANIMATED_IMAGE_TYPES]),DEFAULT_SUPPORT_VIDEO_TYPES=Object.freeze(["video/mp4","video/webm","video/quicktime"]),DEFAULT_SUPPORTED_MEDIA_TYPE_LIST=Object.freeze([...DEFAULT_SUPPORTED_IMAGE_TYPES,...DEFAULT_SUPPORT_VIDEO_TYPES]).join(",");class MediaHelpers{static loadVideo(src){return new Promise(((resolve,reject)=>{const video=document.createElement("video");video.onloadeddata=()=>resolve(video),video.onerror=e=>{console.error(e),reject(new Error("Could not load video"))},video.crossOrigin="anonymous",video.src=src}))}static async getVideoFrameAsDataUrl(video,time=0){const promise=promiseWithResolve();let didSetTime=!1;const onReadyStateChanged=()=>{if(!didSetTime){if(!(video.readyState>=video.HAVE_METADATA))return;didSetTime=!0,video.currentTime=time}if(video.readyState>=video.HAVE_CURRENT_DATA){const canvas=document.createElement("canvas");canvas.width=video.videoWidth,canvas.height=video.videoHeight;const ctx=canvas.getContext("2d");if(!ctx)throw new Error("Could not get 2d context");ctx.drawImage(video,0,0),promise.resolve(canvas.toDataURL())}},onError=e=>{console.error(e),promise.reject(new Error("Could not get video frame"))};video.addEventListener("loadedmetadata",onReadyStateChanged),video.addEventListener("loadeddata",onReadyStateChanged),video.addEventListener("canplay",onReadyStateChanged),video.addEventListener("seeked",onReadyStateChanged),video.addEventListener("error",onError),video.addEventListener("stalled",onError),onReadyStateChanged();try{return await promise}finally{video.removeEventListener("loadedmetadata",onReadyStateChanged),video.removeEventListener("loadeddata",onReadyStateChanged),video.removeEventListener("canplay",onReadyStateChanged),video.removeEventListener("seeked",onReadyStateChanged),video.removeEventListener("error",onError),video.removeEventListener("stalled",onError)}}static getImageAndDimensions(src){return new Promise(((resolve,reject)=>{const img=Image();img.onload=()=>{let dimensions;img.naturalWidth?dimensions={w:img.naturalWidth,h:img.naturalHeight}:(document.body.appendChild(img),dimensions={w:img.clientWidth,h:img.clientHeight},document.body.removeChild(img)),resolve({...dimensions,image:img})},img.onerror=e=>{console.error(e),reject(new Error("Could not load image"))},img.crossOrigin="anonymous",img.referrerPolicy="strict-origin-when-cross-origin",img.style.visibility="hidden",img.style.position="absolute",img.style.opacity="0",img.style.zIndex="-9999",img.src=src}))}static async getVideoSize(blob){return MediaHelpers.usingObjectURL(blob,(async url=>{const video=await MediaHelpers.loadVideo(url);return{w:video.videoWidth,h:video.videoHeight}}))}static async getImageSize(blob){const{w,h}=await MediaHelpers.usingObjectURL(blob,MediaHelpers.getImageAndDimensions);try{if("image/png"===blob.type){const view=new DataView(await blob.arrayBuffer());if(PngHelpers.isPng(view,0)){const physChunk=PngHelpers.findChunk(view,"pHYs");if(physChunk){const physData=PngHelpers.parsePhys(view,physChunk.dataOffset);if(0===physData.unit&&physData.ppux===physData.ppuy){const pixelsPerMeter=72/.0254,pixelRatio=Math.max(physData.ppux/pixelsPerMeter,1);return{w:Math.round(w/pixelRatio),h:Math.round(h/pixelRatio)}}}}}}catch(err){return console.error(err),{w,h}}return{w,h}}static async isAnimated(file){return"image/gif"===file.type?isGifAnimated(await file.arrayBuffer()):"image/avif"===file.type?(buffer=await file.arrayBuffer(),44===new Uint8Array(buffer)[3]):"image/webp"===file.type?function isWebpAnimated(buffer){const view=new Uint8Array(buffer);return!(!function isWebp(view){return!(!view||view.length<12)&&87===view[8]&&69===view[9]&&66===view[10]&&80===view[11]}(view)||!view||view.length<21||1&~(view[20]>>1))}(await file.arrayBuffer()):"image/apng"===file.type&&function isApngAnimated(buffer){const view=new Uint8Array(buffer);if(!view||!("undefined"!=typeof Buffer&&Buffer.isBuffer(view)||view instanceof Uint8Array)||view.length<16)return!1;if(137!==view[0]||80!==view[1]||78!==view[2]||71!==view[3]||13!==view[4]||10!==view[5]||26!==view[6]||10!==view[7])return!1;function indexOfSubstring(haystack,needle,fromIndex,upToIndex,chunksize=1024){if(!needle)return-1;const needle_length=(needle=new RegExp(needle,"g")).source.length,decoder=new TextDecoder,full_haystack_length=haystack.length;if(void 0===upToIndex&&(upToIndex=full_haystack_length),fromIndex>=full_haystack_length||upToIndex<=0||fromIndex>=upToIndex)return-1;haystack=haystack.subarray(fromIndex,upToIndex);let position=-1,current_index=0,full_length=0,needle_buffer="";outer:for(;current_index<haystack.length;){const next_index=current_index+chunksize,chunk=haystack.subarray(current_index,next_index),decoded=decoder.decode(chunk,{stream:!0}),text=needle_buffer+decoded;let match,last_index=-1;for(;null!==(match=needle.exec(text));){last_index=match.index-needle_buffer.length,position=full_length+last_index;break outer}current_index=next_index,full_length+=decoded.length;const needle_index=last_index>-1?last_index+needle_length:decoded.length-needle_length;needle_buffer=decoded.slice(needle_index)}return position>=0&&(position+=fromIndex>=0?fromIndex:full_haystack_length+fromIndex),position}const idatIdx=indexOfSubstring(view,"IDAT",12);if(idatIdx>=12)return indexOfSubstring(view,"acTL",8,idatIdx)>=8;return!1}(await file.arrayBuffer());var buffer}static isAnimatedImageType(mimeType){return DEFAULT_SUPPORTED_ANIMATED_IMAGE_TYPES.includes(mimeType||"")}static isStaticImageType(mimeType){return DEFAULT_SUPPORTED_STATIC_IMAGE_TYPES.includes(mimeType||"")}static isVectorImageType(mimeType){return DEFAULT_SUPPORTED_VECTOR_IMAGE_TYPES.includes(mimeType||"")}static isImageType(mimeType){return DEFAULT_SUPPORTED_IMAGE_TYPES.includes(mimeType||"")}static async usingObjectURL(blob,fn){const url=URL.createObjectURL(blob);try{return await fn(url)}finally{URL.revokeObjectURL(url)}}}function lerp(a,b,t){return a+(b-a)*t}function invLerp(a,b,t){return(t-a)/(b-a)}function rng(seed=""){let x=0,y=0,z=0,w=0;function next(){const t=x^x<<11;return x=y,y=z,z=w,w^=(w>>>19^t^t>>>8)>>>0,w/4294967296*2}for(let k=0;k<seed.length+64;k++)x^=0|seed.charCodeAt(k),next();return next}function modulate(value,rangeA,rangeB,clamp=!1){const[fromLow,fromHigh]=rangeA,[v0,v1]=rangeB,result=v0+(value-fromLow)/(fromHigh-fromLow)*(v1-v0);return clamp?v0<v1?Math.max(Math.min(result,v1),v0):Math.max(Math.min(result,v0),v1):result}function object_hasOwnProperty(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)}function getOwnProperty(obj,key){if(object_hasOwnProperty(obj,key))return obj[key]}function objectMapKeys(object){return Object.keys(object)}function objectMapValues(object){return Object.values(object)}function objectMapEntries(object){return Object.entries(object)}function objectMapFromEntries(entries){return Object.fromEntries(entries)}function filterEntries(object,predicate){const result={};let didChange=!1;for(const[key,value]of objectMapEntries(object))predicate(key,value)?result[key]=value:didChange=!0;return didChange?result:object}function mapObjectMapValues(object,mapper){const result={};for(const[key,value]of objectMapEntries(object)){const newValue=mapper(key,value);result[key]=newValue}return result}function areObjectsShallowEqual(obj1,obj2){if(obj1===obj2)return!0;const keys1=new Set(Object.keys(obj1)),keys2=new Set(Object.keys(obj2));if(keys1.size!==keys2.size)return!1;for(const key of keys1){if(!keys2.has(key))return!1;if(!Object.is(obj1[key],obj2[key]))return!1}return!0}function indexCharacterSet(options){const dicts=function createCharSetDicts(charSet){const byCode={},byChar={},length=charSet.length;for(let i=0;i<length;i++){const char=charSet[i];byCode[i]=char,byChar[char]=i}return{byCode,byChar,length}}(options.chars),limits=function integerLimits(dicts,firstPositive,mostPositive,mostNegative){const firstPositiveIndex=firstPositive?dicts.byChar[firstPositive]:Math.ceil(dicts.length/2),mostPositiveIndex=mostPositive?dicts.byChar[mostPositive]:dicts.length-1,mostNegativeIndex=mostNegative?dicts.byChar[mostNegative]:0;if(void 0===firstPositiveIndex||void 0===mostPositiveIndex||void 0===mostNegativeIndex)throw new Error("invalid charSet");if(mostPositiveIndex-firstPositiveIndex<3)throw new Error("mostPositive must be at least 3 characters away from neutral");if(firstPositiveIndex-mostNegativeIndex<3)throw new Error("mostNegative must be at least 3 characters away from neutral");return{firstPositive:dicts.byCode[firstPositiveIndex],mostPositive:dicts.byCode[mostPositiveIndex],firstNegative:dicts.byCode[firstPositiveIndex-1],mostNegative:dicts.byCode[mostNegativeIndex]}}(dicts,options.firstPositive,options.mostPositive,options.mostNegative),jitterRange=options.jitterRange??Math.floor(Math.pow(dicts.length,3)/5),paddingRange=function paddingDict(jitterRange,charSetLength){const paddingDict2={};for(let i=0;i<100&&(paddingDict2[i]=Math.pow(charSetLength,i),!(paddingDict2[i]>jitterRange));i++);return paddingDict2}(jitterRange,dicts.length);return{chars:options.chars,byChar:dicts.byChar,byCode:dicts.byCode,length:dicts.length,first:dicts.byCode[0],last:dicts.byCode[dicts.length-1],firstPositive:limits.firstPositive,mostPositive:limits.mostPositive,firstNegative:limits.firstNegative,mostNegative:limits.mostNegative,jitterRange,paddingDict:paddingRange}}var _base62CharSet=null;function base62CharSet(){return _base62CharSet||(_base62CharSet=indexCharacterSet({chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",firstPositive:"a",mostPositive:"z",mostNegative:"A"}))}function distanceBetween(a,b,charSet){const indexA=charSet.byChar[a],indexB=charSet.byChar[b];return Math.abs(indexA-indexB)}function integerLength(head,charSet){const firstChar=head[0];if(firstChar>charSet.mostPositive||firstChar<charSet.mostNegative)throw new Error("invalid firstChar on key");if(firstChar===charSet.mostPositive){return distanceBetween(firstChar,charSet.firstPositive,charSet)+1+integerLengthFromSecondLevel(head.slice(1),"positive",charSet)}if(firstChar===charSet.mostNegative){return distanceBetween(firstChar,charSet.firstNegative,charSet)+1+integerLengthFromSecondLevel(head.slice(1),"negative",charSet)}return firstChar>=charSet.firstPositive?distanceBetween(firstChar,charSet.firstPositive,charSet)+2:distanceBetween(firstChar,charSet.firstNegative,charSet)+2}function integerLengthFromSecondLevel(key,direction,charSet){const firstChar=key[0];if(firstChar>charSet.mostPositive||firstChar<charSet.mostNegative)throw new Error("invalid firstChar on key");if(firstChar===charSet.mostPositive&&"positive"===direction){return distanceBetween(firstChar,charSet.mostNegative,charSet)+1+integerLengthFromSecondLevel(key.slice(1),direction,charSet)}if(firstChar===charSet.mostNegative&&"negative"===direction){return distanceBetween(firstChar,charSet.mostPositive,charSet)+1+integerLengthFromSecondLevel(key.slice(1),direction,charSet)}return"positive"===direction?distanceBetween(firstChar,charSet.mostNegative,charSet)+2:distanceBetween(firstChar,charSet.mostPositive,charSet)+2}function makeSameLength(a,b,pad,fillChar,forceLength){const max=forceLength??Math.max(a.length,b.length);return"start"===pad?[a.padStart(max,fillChar),b.padStart(max,fillChar)]:[a.padEnd(max,fillChar),b.padEnd(max,fillChar)]}function lexicalDistance(a,b,charSet){const[lower,upper]=makeSameLength(a,b,"end",charSet.first).sort();return function decodeCharSetToNumber(key,charSet){let res=0;const length=key.length,max=charSet.length;for(let i=0;i<length;i++)res+=charSet.byChar[key[i]]*Math.pow(max,length-i-1);return res}(subtractCharSetKeys(upper,lower,charSet),charSet)}function addCharSetKeys(a,b,charSet){const base=charSet.length,[paddedA,paddedB]=makeSameLength(a,b,"start",charSet.first),result=[];let carry=0;for(let i=paddedA.length-1;i>=0;i--){const sum=charSet.byChar[paddedA[i]]+charSet.byChar[paddedB[i]]+carry;carry=Math.floor(sum/base);const remainder=sum%base;result.unshift(charSet.byCode[remainder])}return carry>0&&result.unshift(charSet.byCode[carry]),result.join("")}function subtractCharSetKeys(a,b,charSet){const base=charSet.length,[paddedA,paddedB]=makeSameLength(a,b,"start",charSet.first),result=[];let borrow=0;for(let i=paddedA.length-1;i>=0;i--){let digitA=charSet.byChar[paddedA[i]];const digitB=charSet.byChar[paddedB[i]]+borrow;digitA<digitB?(borrow=1,digitA+=base):borrow=0;const difference=digitA-digitB;result.unshift(charSet.byCode[difference])}if(borrow>0)throw new Error("Subtraction result is negative. Ensure a is greater than or equal to b.");for(;result.length>1&&result[0]===charSet.byCode[0];)result.shift();return result.join("")}function incrementKey(key,charSet){return addCharSetKeys(key,charSet.byCode[1],charSet)}function decrementKey(key,charSet){return subtractCharSetKeys(key,charSet.byCode[1],charSet)}function encodeToCharSet(int,charSet){if(0===int)return charSet.byCode[0];let res="";const max=charSet.length;for(;int>0;)res=charSet.byCode[int%max]+res,int=Math.floor(int/max);return res}function validateOrderKey(orderKey,charSet){getIntegerPart(orderKey,charSet)}function getIntegerPart(orderKey,charSet){const integerPartLength=integerLength(integerHead(orderKey,charSet),charSet);if(integerPartLength>orderKey.length)throw new Error("invalid order key length: "+orderKey);return orderKey.slice(0,integerPartLength)}function validateInteger(integer,charSet){if(!function validInteger(integer,charSet){return integerLength(integer,charSet)===integer.length}(integer,charSet))throw new Error("invalid integer length: "+integer)}function incrementInteger(integer,charSet){validateInteger(integer,charSet);const[head,digs]=splitInteger(integer,charSet);if(digs.split("").some((d=>d!==charSet.byCode[charSet.length-1]))){return head+incrementKey(digs,charSet)}const nextHead=function incrementIntegerHead(head,charSet){const inPositiveRange=head>=charSet.firstPositive,nextHead=incrementKey(head,charSet),headIsLimitMax=head[head.length-1]===charSet.mostPositive,nextHeadIsLimitMax=nextHead[nextHead.length-1]===charSet.mostPositive;if(inPositiveRange&&nextHeadIsLimitMax)return nextHead+charSet.mostNegative;if(!inPositiveRange&&headIsLimitMax)return head.slice(0,head.length-1);return nextHead}(head,charSet);return startOnNewHead(nextHead,"lower",charSet)}function decrementInteger(integer,charSet){validateInteger(integer,charSet);const[head,digs]=splitInteger(integer,charSet);if(digs.split("").some((d=>d!==charSet.byCode[0]))){return head+decrementKey(digs,charSet)}const nextHead=function decrementIntegerHead(head,charSet){const inPositiveRange=head>=charSet.firstPositive,headIsLimitMin=head[head.length-1]===charSet.mostNegative;if(inPositiveRange&&headIsLimitMin){return decrementKey(head.slice(0,head.length-1),charSet)}if(!inPositiveRange&&headIsLimitMin)return head+charSet.mostPositive;return decrementKey(head,charSet)}(head,charSet);return startOnNewHead(nextHead,"upper",charSet)}function integerHead(integer,charSet){let i=0;if(integer[0]===charSet.mostPositive)for(;integer[i]===charSet.mostPositive;)i+=1;if(integer[0]===charSet.mostNegative)for(;integer[i]===charSet.mostNegative;)i+=1;return integer.slice(0,i+1)}function splitInteger(integer,charSet){const head=integerHead(integer,charSet);return[head,integer.slice(head.length)]}function startOnNewHead(head,limit,charSet){const newLength=integerLength(head,charSet);return head+("upper"===limit?charSet.byCode[charSet.length-1]:charSet.byCode[0]).repeat(newLength-head.length)}function jitterString(orderKey,charSet){return addCharSetKeys(orderKey,encodeToCharSet(Math.floor(Math.random()*charSet.jitterRange),charSet),charSet)}function paddingNeededForDistance(distance,charSet){const gap=charSet.jitterRange-distance,firstBigger=Object.entries(charSet.paddingDict).find((([_key,value])=>value>gap));return firstBigger?parseInt(firstBigger[0]):0}function generateKeyBetween(lower,upper,charSet=base62CharSet()){if(null!==lower&&validateOrderKey(lower,charSet),null!==upper&&validateOrderKey(upper,charSet),null===lower&&null===upper)return function startKey(charSet){return charSet.firstPositive+charSet.byCode[0]}(charSet);if(null===lower){return decrementInteger(getIntegerPart(upper,charSet),charSet)}if(null===upper){return incrementInteger(getIntegerPart(lower,charSet),charSet)}if(lower>=upper)throw new Error(lower+" >= "+upper);return function midPoint(lower,upper,charSet){let[paddedLower,paddedUpper]=makeSameLength(lower,upper,"end",charSet.first),distance=lexicalDistance(paddedLower,paddedUpper,charSet);return 1===distance&&(paddedLower=paddedLower.padEnd(paddedLower.length+1,charSet.first),distance=charSet.length),addCharSetKeys(paddedLower,encodeToCharSet(Math.floor(distance/2),charSet),charSet)}(lower,upper,charSet)}function generateJitteredKeyBetween(lower,upper,charSet=base62CharSet()){const key=generateKeyBetween(lower,upper,charSet),paddingNeeded=function paddingNeededForJitter(orderKey,b,charSet){const nextInteger=incrementInteger(getIntegerPart(orderKey,charSet),charSet);let needed=0;if(null!==b){const distanceToB=lexicalDistance(orderKey,b,charSet);distanceToB<charSet.jitterRange+1&&(needed=Math.max(needed,paddingNeededForDistance(distanceToB,charSet)))}const distanceToNextInteger=lexicalDistance(orderKey,nextInteger,charSet);return distanceToNextInteger<charSet.jitterRange+1&&(needed=Math.max(needed,paddingNeededForDistance(distanceToNextInteger,charSet))),needed}(key,upper,charSet);return paddingNeeded?function padAndJitterString(orderKey,numberOfChars,charSet){return jitterString(orderKey.padEnd(orderKey.length+numberOfChars,charSet.first),charSet)}(key,paddingNeeded,charSet):jitterString(key,charSet)}function generateNJitteredKeysBetween(lower,upper,n,charSet=base62CharSet()){return spreadGeneratorResults(lower,upper,n,charSet,generateJitteredKeyBetween,generateNJitteredKeysBetween)}function spreadGeneratorResults(lower,upper,n,charSet,generateKey,generateNKeys){if(0===n)return[];if(1===n)return[generateKey(lower,upper,charSet)];if(null==upper){let newUpper=generateKey(lower,upper,charSet);const result=[newUpper];for(let i=0;i<n-1;i++)newUpper=generateKey(newUpper,upper,charSet),result.push(newUpper);return result}if(null==lower){let newLower=generateKey(lower,upper,charSet);const result=[newLower];for(let i=0;i<n-1;i++)newLower=generateKey(lower,newLower,charSet),result.push(newLower);return result.reverse(),result}const mid=Math.floor(n/2),midOrderKey=generateKey(lower,upper,charSet);return[...generateNKeys(lower,midOrderKey,mid,charSet),midOrderKey,...generateNKeys(midOrderKey,upper,n-mid-1,charSet)]}const generateKeysFn=generateNJitteredKeysBetween,ZERO_INDEX_KEY="a0";function validateIndexKey(index){try{generateJitteredKeyBetween(index,null)}catch{throw new Error("invalid index: "+index)}}function getIndicesBetween(below,above,n){return generateKeysFn(below??null,above??null,n)}function getIndicesAbove(below,n){return generateKeysFn(below??null,null,n)}function getIndexBetween(below,above){return generateKeysFn(below??null,above??null,1)[0]}function getIndexAbove(below=null){return generateKeysFn(below,null,1)[0]}function getIndexBelow(above=null){return generateKeysFn(null,above,1)[0]}function getIndices(n,start="a1"){return[start,...generateKeysFn(start,null,n)]}function sortByIndex(a,b){return a.index<b.index?-1:a.index>b.index?1:0}function sortById(a,b){return a.id>b.id?1:-1}function getFromLocalStorage(key){try{return localStorage.getItem(key)}catch{return null}}function setInLocalStorage(key,value){try{localStorage.setItem(key,value)}catch{}}function clearLocalStorage(){try{localStorage.clear()}catch{}}function getFromSessionStorage(key){try{return sessionStorage.getItem(key)}catch{return null}}function setInSessionStorage(key,value){try{sessionStorage.setItem(key,value)}catch{}}function deleteFromSessionStorage(key){try{sessionStorage.removeItem(key)}catch{}}function clearSessionStorage(){try{sessionStorage.clear()}catch{}}var process=__webpack_require__("./node_modules/process/browser.js");const isTest=()=>void 0!==process&&!1,fpsQueue=[],targetTimePerFrame=Math.ceil(1e3/60);let throttle_frame,time=0,throttle_last=0;const flush=()=>{const queue=fpsQueue.splice(0,fpsQueue.length);for(const fn of queue)fn()};function tick(){if(throttle_frame)return;const now=Date.now(),elapsed=now-throttle_last;throttle_frame=time+elapsed<targetTimePerFrame?requestAnimationFrame((()=>{throttle_frame=void 0,tick()})):requestAnimationFrame((()=>{throttle_frame=void 0,throttle_last=now,time=Math.min(time+elapsed-targetTimePerFrame,10*targetTimePerFrame),flush()}))}let started=!1;function throttleToNextFrame(fn){return isTest()?(fn(),()=>{}):(fpsQueue.includes(fn)||(fpsQueue.push(fn),started||(started=!0,throttle_last=Date.now()-targetTimePerFrame-1),tick()),()=>{const index=fpsQueue.indexOf(fn);index>-1&&fpsQueue.splice(index,1)})}class Timers{timeouts=new Map;intervals=new Map;rafs=new Map;constructor(){this.setTimeout=this.setTimeout.bind(this),this.setInterval=this.setInterval.bind(this),this.requestAnimationFrame=this.requestAnimationFrame.bind(this),this.dispose=this.dispose.bind(this)}setTimeout(contextId,handler,timeout,...args){const id=window.setTimeout(handler,timeout,args),current=this.timeouts.get(contextId)??[];return this.timeouts.set(contextId,[...current,id]),id}setInterval(contextId,handler,timeout,...args){const id=window.setInterval(handler,timeout,args),current=this.intervals.get(contextId)??[];return this.intervals.set(contextId,[...current,id]),id}requestAnimationFrame(contextId,callback){const id=window.requestAnimationFrame(callback),current=this.rafs.get(contextId)??[];return this.rafs.set(contextId,[...current,id]),id}dispose(contextId){this.timeouts.get(contextId)?.forEach((id=>clearTimeout(id))),this.intervals.get(contextId)?.forEach((id=>clearInterval(id))),this.rafs.get(contextId)?.forEach((id=>cancelAnimationFrame(id))),this.timeouts.delete(contextId),this.intervals.delete(contextId),this.rafs.delete(contextId)}disposeAll(){for(const contextId of this.timeouts.keys())this.dispose(contextId)}forContext(contextId){return{setTimeout:(handler,timeout,...args)=>this.setTimeout(contextId,handler,timeout,args),setInterval:(handler,timeout,...args)=>this.setInterval(contextId,handler,timeout,args),requestAnimationFrame:callback=>this.requestAnimationFrame(contextId,callback),dispose:()=>this.dispose(contextId)}}}const safeParseUrl=(url,baseUrl)=>{try{return new URL(url,baseUrl)}catch{return}};function isDefined(value){return void 0!==value}const _structuredClone=function getStructuredClone(){return"undefined"!=typeof globalThis&&globalThis.structuredClone?[globalThis.structuredClone,!0]:void 0!==__webpack_require__.g&&__webpack_require__.g.structuredClone?[__webpack_require__.g.structuredClone,!0]:"undefined"!=typeof window&&window.structuredClone?[window.structuredClone,!0]:[i=>i?JSON.parse(JSON.stringify(i)):i,!1]}(),structuredClone=_structuredClone[0],STRUCTURED_CLONE_OBJECT_PROTOTYPE=(_structuredClone[1],Object.getPrototypeOf(structuredClone({})));registerTldrawLibraryVersion("@tldraw/utils","3.13.1","esm")},"./node_modules/core-js/es/array/at.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";__webpack_require__("./node_modules/core-js/modules/es.array.at.js");var entryUnbind=__webpack_require__("./node_modules/core-js/internals/entry-unbind.js");module.exports=entryUnbind("Array","at")},"./node_modules/core-js/es/array/flat-map.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";__webpack_require__("./node_modules/core-js/modules/es.array.flat-map.js"),__webpack_require__("./node_modules/core-js/modules/es.array.unscopables.flat-map.js");var entryUnbind=__webpack_require__("./node_modules/core-js/internals/entry-unbind.js");module.exports=entryUnbind("Array","flatMap")},"./node_modules/core-js/es/array/flat.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";__webpack_require__("./node_modules/core-js/modules/es.array.flat.js"),__webpack_require__("./node_modules/core-js/modules/es.array.unscopables.flat.js");var entryUnbind=__webpack_require__("./node_modules/core-js/internals/entry-unbind.js");module.exports=entryUnbind("Array","flat")},"./node_modules/core-js/es/string/at.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";__webpack_require__("./node_modules/core-js/modules/es.string.at-alternative.js");var entryUnbind=__webpack_require__("./node_modules/core-js/internals/entry-unbind.js");module.exports=entryUnbind("String","at")},"./node_modules/core-js/es/string/replace-all.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";__webpack_require__("./node_modules/core-js/modules/es.regexp.exec.js"),__webpack_require__("./node_modules/core-js/modules/es.string.replace.js"),__webpack_require__("./node_modules/core-js/modules/es.string.replace-all.js");var entryUnbind=__webpack_require__("./node_modules/core-js/internals/entry-unbind.js");module.exports=entryUnbind("String","replaceAll")},"./node_modules/core-js/internals/a-callable.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var isCallable=__webpack_require__("./node_modules/core-js/internals/is-callable.js"),tryToString=__webpack_require__("./node_modules/core-js/internals/try-to-string.js"),$TypeError=TypeError;module.exports=function(argument){if(isCallable(argument))return argument;throw new $TypeError(tryToString(argument)+" is not a function")}},"./node_modules/core-js/internals/add-to-unscopables.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var wellKnownSymbol=__webpack_require__("./node_modules/core-js/internals/well-known-symbol.js"),create=__webpack_require__("./node_modules/core-js/internals/object-create.js"),defineProperty=__webpack_require__("./node_modules/core-js/internals/object-define-property.js").f,UNSCOPABLES=wellKnownSymbol("unscopables"),ArrayPrototype=Array.prototype;void 0===ArrayPrototype[UNSCOPABLES]&&defineProperty(ArrayPrototype,UNSCOPABLES,{configurable:!0,value:create(null)}),module.exports=function(key){ArrayPrototype[UNSCOPABLES][key]=!0}},"./node_modules/core-js/internals/advance-string-index.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var charAt=__webpack_require__("./node_modules/core-js/internals/string-multibyte.js").charAt;module.exports=function(S,index,unicode){return index+(unicode?charAt(S,index).length:1)}},"./node_modules/core-js/internals/an-object.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var isObject=__webpack_require__("./node_modules/core-js/internals/is-object.js"),$String=String,$TypeError=TypeError;module.exports=function(argument){if(isObject(argument))return argument;throw new $TypeError($String(argument)+" is not an object")}},"./node_modules/core-js/internals/array-includes.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var toIndexedObject=__webpack_require__("./node_modules/core-js/internals/to-indexed-object.js"),toAbsoluteIndex=__webpack_require__("./node_modules/core-js/internals/to-absolute-index.js"),lengthOfArrayLike=__webpack_require__("./node_modules/core-js/internals/length-of-array-like.js"),createMethod=function(IS_INCLUDES){return function($this,el,fromIndex){var O=toIndexedObject($this),length=lengthOfArrayLike(O);if(0===length)return!IS_INCLUDES&&-1;var value,index=toAbsoluteIndex(fromIndex,length);if(IS_INCLUDES&&el!=el){for(;length>index;)if((value=O[index++])!=value)return!0}else for(;length>index;index++)if((IS_INCLUDES||index in O)&&O[index]===el)return IS_INCLUDES||index||0;return!IS_INCLUDES&&-1}};module.exports={includes:createMethod(!0),indexOf:createMethod(!1)}},"./node_modules/core-js/internals/array-species-constructor.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var isArray=__webpack_require__("./node_modules/core-js/internals/is-array.js"),isConstructor=__webpack_require__("./node_modules/core-js/internals/is-constructor.js"),isObject=__webpack_require__("./node_modules/core-js/internals/is-object.js"),SPECIES=__webpack_require__("./node_modules/core-js/internals/well-known-symbol.js")("species"),$Array=Array;module.exports=function(originalArray){var C;return isArray(originalArray)&&(C=originalArray.constructor,(isConstructor(C)&&(C===$Array||isArray(C.prototype))||isObject(C)&&null===(C=C[SPECIES]))&&(C=void 0)),void 0===C?$Array:C}},"./node_modules/core-js/internals/array-species-create.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var arraySpeciesConstructor=__webpack_require__("./node_modules/core-js/internals/array-species-constructor.js");module.exports=function(originalArray,length){return new(arraySpeciesConstructor(originalArray))(0===length?0:length)}},"./node_modules/core-js/internals/classof-raw.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var uncurryThis=__webpack_require__("./node_modules/core-js/internals/function-uncurry-this.js"),toString=uncurryThis({}.toString),stringSlice=uncurryThis("".slice);module.exports=function(it){return stringSlice(toString(it),8,-1)}},"./node_modules/core-js/internals/classof.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var TO_STRING_TAG_SUPPORT=__webpack_require__("./node_modules/core-js/internals/to-string-tag-support.js"),isCallable=__webpack_require__("./node_modules/core-js/internals/is-callable.js"),classofRaw=__webpack_require__("./node_modules/core-js/internals/classof-raw.js"),TO_STRING_TAG=__webpack_require__("./node_modules/core-js/internals/well-known-symbol.js")("toStringTag"),$Object=Object,CORRECT_ARGUMENTS="Arguments"===classofRaw(function(){return arguments}());module.exports=TO_STRING_TAG_SUPPORT?classofRaw:function(it){var O,tag,result;return void 0===it?"Undefined":null===it?"Null":"string"==typeof(tag=function(it,key){try{return it[key]}catch(error){}}(O=$Object(it),TO_STRING_TAG))?tag:CORRECT_ARGUMENTS?classofRaw(O):"Object"===(result=classofRaw(O))&&isCallable(O.callee)?"Arguments":result}},"./node_modules/core-js/internals/copy-constructor-properties.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var hasOwn=__webpack_require__("./node_modules/core-js/internals/has-own-property.js"),ownKeys=__webpack_require__("./node_modules/core-js/internals/own-keys.js"),getOwnPropertyDescriptorModule=__webpack_require__("./node_modules/core-js/internals/object-get-own-property-descriptor.js"),definePropertyModule=__webpack_require__("./node_modules/core-js/internals/object-define-property.js");module.exports=function(target,source,exceptions){for(var keys=ownKeys(source),defineProperty=definePropertyModule.f,getOwnPropertyDescriptor=getOwnPropertyDescriptorModule.f,i=0;i<keys.length;i++){var key=keys[i];hasOwn(target,key)||exceptions&&hasOwn(exceptions,key)||defineProperty(target,key,getOwnPropertyDescriptor(source,key))}}},"./node_modules/core-js/internals/create-non-enumerable-property.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var DESCRIPTORS=__webpack_require__("./node_modules/core-js/internals/descriptors.js"),definePropertyModule=__webpack_require__("./node_modules/core-js/internals/object-define-property.js"),createPropertyDescriptor=__webpack_require__("./node_modules/core-js/internals/create-property-descriptor.js");module.exports=DESCRIPTORS?function(object,key,value){return definePropertyModule.f(object,key,createPropertyDescriptor(1,value))}:function(object,key,value){return object[key]=value,object}},"./node_modules/core-js/internals/create-property-descriptor.js":module=>{"use strict";module.exports=function(bitmap,value){return{enumerable:!(1&bitmap),configurable:!(2&bitmap),writable:!(4&bitmap),value}}},"./node_modules/core-js/internals/define-built-in.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var isCallable=__webpack_require__("./node_modules/core-js/internals/is-callable.js"),definePropertyModule=__webpack_require__("./node_modules/core-js/internals/object-define-property.js"),makeBuiltIn=__webpack_require__("./node_modules/core-js/internals/make-built-in.js"),defineGlobalProperty=__webpack_require__("./node_modules/core-js/internals/define-global-property.js");module.exports=function(O,key,value,options){options||(options={});var simple=options.enumerable,name=void 0!==options.name?options.name:key;if(isCallable(value)&&makeBuiltIn(value,name,options),options.global)simple?O[key]=value:defineGlobalProperty(key,value);else{try{options.unsafe?O[key]&&(simple=!0):delete O[key]}catch(error){}simple?O[key]=value:definePropertyModule.f(O,key,{value,enumerable:!1,configurable:!options.nonConfigurable,writable:!options.nonWritable})}return O}},"./node_modules/core-js/internals/define-global-property.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var globalThis=__webpack_require__("./node_modules/core-js/internals/global-this.js"),defineProperty=Object.defineProperty;module.exports=function(key,value){try{defineProperty(globalThis,key,{value,configurable:!0,writable:!0})}catch(error){globalThis[key]=value}return value}},"./node_modules/core-js/internals/descriptors.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var fails=__webpack_require__("./node_modules/core-js/internals/fails.js");module.exports=!fails((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},"./node_modules/core-js/internals/document-create-element.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var globalThis=__webpack_require__("./node_modules/core-js/internals/global-this.js"),isObject=__webpack_require__("./node_modules/core-js/internals/is-object.js"),document=globalThis.document,EXISTS=isObject(document)&&isObject(document.createElement);module.exports=function(it){return EXISTS?document.createElement(it):{}}},"./node_modules/core-js/internals/does-not-exceed-safe-integer.js":module=>{"use strict";var $TypeError=TypeError;module.exports=function(it){if(it>9007199254740991)throw $TypeError("Maximum allowed index exceeded");return it}},"./node_modules/core-js/internals/entry-unbind.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var globalThis=__webpack_require__("./node_modules/core-js/internals/global-this.js"),uncurryThis=__webpack_require__("./node_modules/core-js/internals/function-uncurry-this.js");module.exports=function(CONSTRUCTOR,METHOD){return uncurryThis(globalThis[CONSTRUCTOR].prototype[METHOD])}},"./node_modules/core-js/internals/enum-bug-keys.js":module=>{"use strict";module.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},"./node_modules/core-js/internals/environment-user-agent.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var navigator=__webpack_require__("./node_modules/core-js/internals/global-this.js").navigator,userAgent=navigator&&navigator.userAgent;module.exports=userAgent?String(userAgent):""},"./node_modules/core-js/internals/environment-v8-version.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var match,version,globalThis=__webpack_require__("./node_modules/core-js/internals/global-this.js"),userAgent=__webpack_require__("./node_modules/core-js/internals/environment-user-agent.js"),process=globalThis.process,Deno=globalThis.Deno,versions=process&&process.versions||Deno&&Deno.version,v8=versions&&versions.v8;v8&&(version=(match=v8.split("."))[0]>0&&match[0]<4?1:+(match[0]+match[1])),!version&&userAgent&&(!(match=userAgent.match(/Edge\/(\d+)/))||match[1]>=74)&&(match=userAgent.match(/Chrome\/(\d+)/))&&(version=+match[1]),module.exports=version},"./node_modules/core-js/internals/export.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var globalThis=__webpack_require__("./node_modules/core-js/internals/global-this.js"),getOwnPropertyDescriptor=__webpack_require__("./node_modules/core-js/internals/object-get-own-property-descriptor.js").f,createNonEnumerableProperty=__webpack_require__("./node_modules/core-js/internals/create-non-enumerable-property.js"),defineBuiltIn=__webpack_require__("./node_modules/core-js/internals/define-built-in.js"),defineGlobalProperty=__webpack_require__("./node_modules/core-js/internals/define-global-property.js"),copyConstructorProperties=__webpack_require__("./node_modules/core-js/internals/copy-constructor-properties.js"),isForced=__webpack_require__("./node_modules/core-js/internals/is-forced.js");module.exports=function(options,source){var target,key,targetProperty,sourceProperty,descriptor,TARGET=options.target,GLOBAL=options.global,STATIC=options.stat;if(target=GLOBAL?globalThis:STATIC?globalThis[TARGET]||defineGlobalProperty(TARGET,{}):globalThis[TARGET]&&globalThis[TARGET].prototype)for(key in source){if(sourceProperty=source[key],targetProperty=options.dontCallGetSet?(descriptor=getOwnPropertyDescriptor(target,key))&&descriptor.value:target[key],!isForced(GLOBAL?key:TARGET+(STATIC?".":"#")+key,options.forced)&&void 0!==targetProperty){if(typeof sourceProperty==typeof targetProperty)continue;copyConstructorProperties(sourceProperty,targetProperty)}(options.sham||targetProperty&&targetProperty.sham)&&createNonEnumerableProperty(sourceProperty,"sham",!0),defineBuiltIn(target,key,sourceProperty,options)}}},"./node_modules/core-js/internals/fails.js":module=>{"use strict";module.exports=function(exec){try{return!!exec()}catch(error){return!0}}},"./node_modules/core-js/internals/fix-regexp-well-known-symbol-logic.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";__webpack_require__("./node_modules/core-js/modules/es.regexp.exec.js");var call=__webpack_require__("./node_modules/core-js/internals/function-call.js"),defineBuiltIn=__webpack_require__("./node_modules/core-js/internals/define-built-in.js"),regexpExec=__webpack_require__("./node_modules/core-js/internals/regexp-exec.js"),fails=__webpack_require__("./node_modules/core-js/internals/fails.js"),wellKnownSymbol=__webpack_require__("./node_modules/core-js/internals/well-known-symbol.js"),createNonEnumerableProperty=__webpack_require__("./node_modules/core-js/internals/create-non-enumerable-property.js"),SPECIES=wellKnownSymbol("species"),RegExpPrototype=RegExp.prototype;module.exports=function(KEY,exec,FORCED,SHAM){var SYMBOL=wellKnownSymbol(KEY),DELEGATES_TO_SYMBOL=!fails((function(){var O={};return O[SYMBOL]=function(){return 7},7!==""[KEY](O)})),DELEGATES_TO_EXEC=DELEGATES_TO_SYMBOL&&!fails((function(){var execCalled=!1,re=/a/;return"split"===KEY&&((re={}).constructor={},re.constructor[SPECIES]=function(){return re},re.flags="",re[SYMBOL]=/./[SYMBOL]),re.exec=function(){return execCalled=!0,null},re[SYMBOL](""),!execCalled}));if(!DELEGATES_TO_SYMBOL||!DELEGATES_TO_EXEC||FORCED){var nativeRegExpMethod=/./[SYMBOL],methods=exec(SYMBOL,""[KEY],(function(nativeMethod,regexp,str,arg2,forceStringMethod){var $exec=regexp.exec;return $exec===regexpExec||$exec===RegExpPrototype.exec?DELEGATES_TO_SYMBOL&&!forceStringMethod?{done:!0,value:call(nativeRegExpMethod,regexp,str,arg2)}:{done:!0,value:call(nativeMethod,str,regexp,arg2)}:{done:!1}}));defineBuiltIn(String.prototype,KEY,methods[0]),defineBuiltIn(RegExpPrototype,SYMBOL,methods[1])}SHAM&&createNonEnumerableProperty(RegExpPrototype[SYMBOL],"sham",!0)}},"./node_modules/core-js/internals/flatten-into-array.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var isArray=__webpack_require__("./node_modules/core-js/internals/is-array.js"),lengthOfArrayLike=__webpack_require__("./node_modules/core-js/internals/length-of-array-like.js"),doesNotExceedSafeInteger=__webpack_require__("./node_modules/core-js/internals/does-not-exceed-safe-integer.js"),bind=__webpack_require__("./node_modules/core-js/internals/function-bind-context.js"),flattenIntoArray=function(target,original,source,sourceLen,start,depth,mapper,thisArg){for(var element,elementLen,targetIndex=start,sourceIndex=0,mapFn=!!mapper&&bind(mapper,thisArg);sourceIndex<sourceLen;)sourceIndex in source&&(element=mapFn?mapFn(source[sourceIndex],sourceIndex,original):source[sourceIndex],depth>0&&isArray(element)?(elementLen=lengthOfArrayLike(element),targetIndex=flattenIntoArray(target,original,element,elementLen,targetIndex,depth-1)-1):(doesNotExceedSafeInteger(targetIndex+1),target[targetIndex]=element),targetIndex++),sourceIndex++;return targetIndex};module.exports=flattenIntoArray},"./node_modules/core-js/internals/function-apply.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var NATIVE_BIND=__webpack_require__("./node_modules/core-js/internals/function-bind-native.js"),FunctionPrototype=Function.prototype,apply=FunctionPrototype.apply,call=FunctionPrototype.call;module.exports="object"==typeof Reflect&&Reflect.apply||(NATIVE_BIND?call.bind(apply):function(){return call.apply(apply,arguments)})},"./node_modules/core-js/internals/function-bind-context.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var uncurryThis=__webpack_require__("./node_modules/core-js/internals/function-uncurry-this-clause.js"),aCallable=__webpack_require__("./node_modules/core-js/internals/a-callable.js"),NATIVE_BIND=__webpack_require__("./node_modules/core-js/internals/function-bind-native.js"),bind=uncurryThis(uncurryThis.bind);module.exports=function(fn,that){return aCallable(fn),void 0===that?fn:NATIVE_BIND?bind(fn,that):function(){return fn.apply(that,arguments)}}},"./node_modules/core-js/internals/function-bind-native.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var fails=__webpack_require__("./node_modules/core-js/internals/fails.js");module.exports=!fails((function(){var test=function(){}.bind();return"function"!=typeof test||test.hasOwnProperty("prototype")}))},"./node_modules/core-js/internals/function-call.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var NATIVE_BIND=__webpack_require__("./node_modules/core-js/internals/function-bind-native.js"),call=Function.prototype.call;module.exports=NATIVE_BIND?call.bind(call):function(){return call.apply(call,arguments)}},"./node_modules/core-js/internals/function-name.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var DESCRIPTORS=__webpack_require__("./node_modules/core-js/internals/descriptors.js"),hasOwn=__webpack_require__("./node_modules/core-js/internals/has-own-property.js"),FunctionPrototype=Function.prototype,getDescriptor=DESCRIPTORS&&Object.getOwnPropertyDescriptor,EXISTS=hasOwn(FunctionPrototype,"name"),PROPER=EXISTS&&"something"===function something(){}.name,CONFIGURABLE=EXISTS&&(!DESCRIPTORS||DESCRIPTORS&&getDescriptor(FunctionPrototype,"name").configurable);module.exports={EXISTS,PROPER,CONFIGURABLE}},"./node_modules/core-js/internals/function-uncurry-this-clause.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var classofRaw=__webpack_require__("./node_modules/core-js/internals/classof-raw.js"),uncurryThis=__webpack_require__("./node_modules/core-js/internals/function-uncurry-this.js");module.exports=function(fn){if("Function"===classofRaw(fn))return uncurryThis(fn)}},"./node_modules/core-js/internals/function-uncurry-this.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var NATIVE_BIND=__webpack_require__("./node_modules/core-js/internals/function-bind-native.js"),FunctionPrototype=Function.prototype,call=FunctionPrototype.call,uncurryThisWithBind=NATIVE_BIND&&FunctionPrototype.bind.bind(call,call);module.exports=NATIVE_BIND?uncurryThisWithBind:function(fn){return function(){return call.apply(fn,arguments)}}},"./node_modules/core-js/internals/get-built-in.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var globalThis=__webpack_require__("./node_modules/core-js/internals/global-this.js"),isCallable=__webpack_require__("./node_modules/core-js/internals/is-callable.js");module.exports=function(namespace,method){return arguments.length<2?(argument=globalThis[namespace],isCallable(argument)?argument:void 0):globalThis[namespace]&&globalThis[namespace][method];var argument}},"./node_modules/core-js/internals/get-method.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var aCallable=__webpack_require__("./node_modules/core-js/internals/a-callable.js"),isNullOrUndefined=__webpack_require__("./node_modules/core-js/internals/is-null-or-undefined.js");module.exports=function(V,P){var func=V[P];return isNullOrUndefined(func)?void 0:aCallable(func)}},"./node_modules/core-js/internals/get-substitution.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var uncurryThis=__webpack_require__("./node_modules/core-js/internals/function-uncurry-this.js"),toObject=__webpack_require__("./node_modules/core-js/internals/to-object.js"),floor=Math.floor,charAt=uncurryThis("".charAt),replace=uncurryThis("".replace),stringSlice=uncurryThis("".slice),SUBSTITUTION_SYMBOLS=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,SUBSTITUTION_SYMBOLS_NO_NAMED=/\$([$&'`]|\d{1,2})/g;module.exports=function(matched,str,position,captures,namedCaptures,replacement){var tailPos=position+matched.length,m=captures.length,symbols=SUBSTITUTION_SYMBOLS_NO_NAMED;return void 0!==namedCaptures&&(namedCaptures=toObject(namedCaptures),symbols=SUBSTITUTION_SYMBOLS),replace(replacement,symbols,(function(match,ch){var capture;switch(charAt(ch,0)){case"$":return"$";case"&":return matched;case"`":return stringSlice(str,0,position);case"'":return stringSlice(str,tailPos);case"<":capture=namedCaptures[stringSlice(ch,1,-1)];break;default:var n=+ch;if(0===n)return match;if(n>m){var f=floor(n/10);return 0===f?match:f<=m?void 0===captures[f-1]?charAt(ch,1):captures[f-1]+charAt(ch,1):match}capture=captures[n-1]}return void 0===capture?"":capture}))}},"./node_modules/core-js/internals/global-this.js":function(module,__unused_webpack_exports,__webpack_require__){"use strict";var check=function(it){return it&&it.Math===Math&&it};module.exports=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof __webpack_require__.g&&__webpack_require__.g)||check("object"==typeof this&&this)||function(){return this}()||Function("return this")()},"./node_modules/core-js/internals/has-own-property.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var uncurryThis=__webpack_require__("./node_modules/core-js/internals/function-uncurry-this.js"),toObject=__webpack_require__("./node_modules/core-js/internals/to-object.js"),hasOwnProperty=uncurryThis({}.hasOwnProperty);module.exports=Object.hasOwn||function hasOwn(it,key){return hasOwnProperty(toObject(it),key)}},"./node_modules/core-js/internals/hidden-keys.js":module=>{"use strict";module.exports={}},"./node_modules/core-js/internals/html.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var getBuiltIn=__webpack_require__("./node_modules/core-js/internals/get-built-in.js");module.exports=getBuiltIn("document","documentElement")},"./node_modules/core-js/internals/ie8-dom-define.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var DESCRIPTORS=__webpack_require__("./node_modules/core-js/internals/descriptors.js"),fails=__webpack_require__("./node_modules/core-js/internals/fails.js"),createElement=__webpack_require__("./node_modules/core-js/internals/document-create-element.js");module.exports=!DESCRIPTORS&&!fails((function(){return 7!==Object.defineProperty(createElement("div"),"a",{get:function(){return 7}}).a}))},"./node_modules/core-js/internals/indexed-object.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var uncurryThis=__webpack_require__("./node_modules/core-js/internals/function-uncurry-this.js"),fails=__webpack_require__("./node_modules/core-js/internals/fails.js"),classof=__webpack_require__("./node_modules/core-js/internals/classof-raw.js"),$Object=Object,split=uncurryThis("".split);module.exports=fails((function(){return!$Object("z").propertyIsEnumerable(0)}))?function(it){return"String"===classof(it)?split(it,""):$Object(it)}:$Object},"./node_modules/core-js/internals/inspect-source.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var uncurryThis=__webpack_require__("./node_modules/core-js/internals/function-uncurry-this.js"),isCallable=__webpack_require__("./node_modules/core-js/internals/is-callable.js"),store=__webpack_require__("./node_modules/core-js/internals/shared-store.js"),functionToString=uncurryThis(Function.toString);isCallable(store.inspectSource)||(store.inspectSource=function(it){return functionToString(it)}),module.exports=store.inspectSource},"./node_modules/core-js/internals/internal-state.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var set,get,has,NATIVE_WEAK_MAP=__webpack_require__("./node_modules/core-js/internals/weak-map-basic-detection.js"),globalThis=__webpack_require__("./node_modules/core-js/internals/global-this.js"),isObject=__webpack_require__("./node_modules/core-js/internals/is-object.js"),createNonEnumerableProperty=__webpack_require__("./node_modules/core-js/internals/create-non-enumerable-property.js"),hasOwn=__webpack_require__("./node_modules/core-js/internals/has-own-property.js"),shared=__webpack_require__("./node_modules/core-js/internals/shared-store.js"),sharedKey=__webpack_require__("./node_modules/core-js/internals/shared-key.js"),hiddenKeys=__webpack_require__("./node_modules/core-js/internals/hidden-keys.js"),TypeError=globalThis.TypeError,WeakMap=globalThis.WeakMap;if(NATIVE_WEAK_MAP||shared.state){var store=shared.state||(shared.state=new WeakMap);store.get=store.get,store.has=store.has,store.set=store.set,set=function(it,metadata){if(store.has(it))throw new TypeError("Object already initialized");return metadata.facade=it,store.set(it,metadata),metadata},get=function(it){return store.get(it)||{}},has=function(it){return store.has(it)}}else{var STATE=sharedKey("state");hiddenKeys[STATE]=!0,set=function(it,metadata){if(hasOwn(it,STATE))throw new TypeError("Object already initialized");return metadata.facade=it,createNonEnumerableProperty(it,STATE,metadata),metadata},get=function(it){return hasOwn(it,STATE)?it[STATE]:{}},has=function(it){return hasOwn(it,STATE)}}module.exports={set,get,has,enforce:function(it){return has(it)?get(it):set(it,{})},getterFor:function(TYPE){return function(it){var state;if(!isObject(it)||(state=get(it)).type!==TYPE)throw new TypeError("Incompatible receiver, "+TYPE+" required");return state}}}},"./node_modules/core-js/internals/is-array.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var classof=__webpack_require__("./node_modules/core-js/internals/classof-raw.js");module.exports=Array.isArray||function isArray(argument){return"Array"===classof(argument)}},"./node_modules/core-js/internals/is-callable.js":module=>{"use strict";var documentAll="object"==typeof document&&document.all;module.exports=void 0===documentAll&&void 0!==documentAll?function(argument){return"function"==typeof argument||argument===documentAll}:function(argument){return"function"==typeof argument}},"./node_modules/core-js/internals/is-constructor.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var uncurryThis=__webpack_require__("./node_modules/core-js/internals/function-uncurry-this.js"),fails=__webpack_require__("./node_modules/core-js/internals/fails.js"),isCallable=__webpack_require__("./node_modules/core-js/internals/is-callable.js"),classof=__webpack_require__("./node_modules/core-js/internals/classof.js"),getBuiltIn=__webpack_require__("./node_modules/core-js/internals/get-built-in.js"),inspectSource=__webpack_require__("./node_modules/core-js/internals/inspect-source.js"),noop=function(){},construct=getBuiltIn("Reflect","construct"),constructorRegExp=/^\s*(?:class|function)\b/,exec=uncurryThis(constructorRegExp.exec),INCORRECT_TO_STRING=!constructorRegExp.test(noop),isConstructorModern=function isConstructor(argument){if(!isCallable(argument))return!1;try{return construct(noop,[],argument),!0}catch(error){return!1}},isConstructorLegacy=function isConstructor(argument){if(!isCallable(argument))return!1;switch(classof(argument)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return INCORRECT_TO_STRING||!!exec(constructorRegExp,inspectSource(argument))}catch(error){return!0}};isConstructorLegacy.sham=!0,module.exports=!construct||fails((function(){var called;return isConstructorModern(isConstructorModern.call)||!isConstructorModern(Object)||!isConstructorModern((function(){called=!0}))||called}))?isConstructorLegacy:isConstructorModern},"./node_modules/core-js/internals/is-forced.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var fails=__webpack_require__("./node_modules/core-js/internals/fails.js"),isCallable=__webpack_require__("./node_modules/core-js/internals/is-callable.js"),replacement=/#|\.prototype\./,isForced=function(feature,detection){var value=data[normalize(feature)];return value===POLYFILL||value!==NATIVE&&(isCallable(detection)?fails(detection):!!detection)},normalize=isForced.normalize=function(string){return String(string).replace(replacement,".").toLowerCase()},data=isForced.data={},NATIVE=isForced.NATIVE="N",POLYFILL=isForced.POLYFILL="P";module.exports=isForced},"./node_modules/core-js/internals/is-null-or-undefined.js":module=>{"use strict";module.exports=function(it){return null==it}},"./node_modules/core-js/internals/is-object.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var isCallable=__webpack_require__("./node_modules/core-js/internals/is-callable.js");module.exports=function(it){return"object"==typeof it?null!==it:isCallable(it)}},"./node_modules/core-js/internals/is-pure.js":module=>{"use strict";module.exports=!1},"./node_modules/core-js/internals/is-regexp.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var isObject=__webpack_require__("./node_modules/core-js/internals/is-object.js"),classof=__webpack_require__("./node_modules/core-js/internals/classof-raw.js"),MATCH=__webpack_require__("./node_modules/core-js/internals/well-known-symbol.js")("match");module.exports=function(it){var isRegExp;return isObject(it)&&(void 0!==(isRegExp=it[MATCH])?!!isRegExp:"RegExp"===classof(it))}},"./node_modules/core-js/internals/is-symbol.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var getBuiltIn=__webpack_require__("./node_modules/core-js/internals/get-built-in.js"),isCallable=__webpack_require__("./node_modules/core-js/internals/is-callable.js"),isPrototypeOf=__webpack_require__("./node_modules/core-js/internals/object-is-prototype-of.js"),USE_SYMBOL_AS_UID=__webpack_require__("./node_modules/core-js/internals/use-symbol-as-uid.js"),$Object=Object;module.exports=USE_SYMBOL_AS_UID?function(it){return"symbol"==typeof it}:function(it){var $Symbol=getBuiltIn("Symbol");return isCallable($Symbol)&&isPrototypeOf($Symbol.prototype,$Object(it))}},"./node_modules/core-js/internals/length-of-array-like.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var toLength=__webpack_require__("./node_modules/core-js/internals/to-length.js");module.exports=function(obj){return toLength(obj.length)}},"./node_modules/core-js/internals/make-built-in.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var uncurryThis=__webpack_require__("./node_modules/core-js/internals/function-uncurry-this.js"),fails=__webpack_require__("./node_modules/core-js/internals/fails.js"),isCallable=__webpack_require__("./node_modules/core-js/internals/is-callable.js"),hasOwn=__webpack_require__("./node_modules/core-js/internals/has-own-property.js"),DESCRIPTORS=__webpack_require__("./node_modules/core-js/internals/descriptors.js"),CONFIGURABLE_FUNCTION_NAME=__webpack_require__("./node_modules/core-js/internals/function-name.js").CONFIGURABLE,inspectSource=__webpack_require__("./node_modules/core-js/internals/inspect-source.js"),InternalStateModule=__webpack_require__("./node_modules/core-js/internals/internal-state.js"),enforceInternalState=InternalStateModule.enforce,getInternalState=InternalStateModule.get,$String=String,defineProperty=Object.defineProperty,stringSlice=uncurryThis("".slice),replace=uncurryThis("".replace),join=uncurryThis([].join),CONFIGURABLE_LENGTH=DESCRIPTORS&&!fails((function(){return 8!==defineProperty((function(){}),"length",{value:8}).length})),TEMPLATE=String(String).split("String"),makeBuiltIn=module.exports=function(value,name,options){"Symbol("===stringSlice($String(name),0,7)&&(name="["+replace($String(name),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),options&&options.getter&&(name="get "+name),options&&options.setter&&(name="set "+name),(!hasOwn(value,"name")||CONFIGURABLE_FUNCTION_NAME&&value.name!==name)&&(DESCRIPTORS?defineProperty(value,"name",{value:name,configurable:!0}):value.name=name),CONFIGURABLE_LENGTH&&options&&hasOwn(options,"arity")&&value.length!==options.arity&&defineProperty(value,"length",{value:options.arity});try{options&&hasOwn(options,"constructor")&&options.constructor?DESCRIPTORS&&defineProperty(value,"prototype",{writable:!1}):value.prototype&&(value.prototype=void 0)}catch(error){}var state=enforceInternalState(value);return hasOwn(state,"source")||(state.source=join(TEMPLATE,"string"==typeof name?name:"")),value};Function.prototype.toString=makeBuiltIn((function toString(){return isCallable(this)&&getInternalState(this).source||inspectSource(this)}),"toString")},"./node_modules/core-js/internals/math-trunc.js":module=>{"use strict";var ceil=Math.ceil,floor=Math.floor;module.exports=Math.trunc||function trunc(x){var n=+x;return(n>0?floor:ceil)(n)}},"./node_modules/core-js/internals/object-create.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var activeXDocument,anObject=__webpack_require__("./node_modules/core-js/internals/an-object.js"),definePropertiesModule=__webpack_require__("./node_modules/core-js/internals/object-define-properties.js"),enumBugKeys=__webpack_require__("./node_modules/core-js/internals/enum-bug-keys.js"),hiddenKeys=__webpack_require__("./node_modules/core-js/internals/hidden-keys.js"),html=__webpack_require__("./node_modules/core-js/internals/html.js"),documentCreateElement=__webpack_require__("./node_modules/core-js/internals/document-create-element.js"),sharedKey=__webpack_require__("./node_modules/core-js/internals/shared-key.js"),IE_PROTO=sharedKey("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(content){return"<script>"+content+"<\/script>"},NullProtoObjectViaActiveX=function(activeXDocument){activeXDocument.write(scriptTag("")),activeXDocument.close();var temp=activeXDocument.parentWindow.Object;return activeXDocument=null,temp},NullProtoObject=function(){try{activeXDocument=new ActiveXObject("htmlfile")}catch(error){}var iframeDocument,iframe;NullProtoObject="undefined"!=typeof document?document.domain&&activeXDocument?NullProtoObjectViaActiveX(activeXDocument):((iframe=documentCreateElement("iframe")).style.display="none",html.appendChild(iframe),iframe.src=String("javascript:"),(iframeDocument=iframe.contentWindow.document).open(),iframeDocument.write(scriptTag("document.F=Object")),iframeDocument.close(),iframeDocument.F):NullProtoObjectViaActiveX(activeXDocument);for(var length=enumBugKeys.length;length--;)delete NullProtoObject.prototype[enumBugKeys[length]];return NullProtoObject()};hiddenKeys[IE_PROTO]=!0,module.exports=Object.create||function create(O,Properties){var result;return null!==O?(EmptyConstructor.prototype=anObject(O),result=new EmptyConstructor,EmptyConstructor.prototype=null,result[IE_PROTO]=O):result=NullProtoObject(),void 0===Properties?result:definePropertiesModule.f(result,Properties)}},"./node_modules/core-js/internals/object-define-properties.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var DESCRIPTORS=__webpack_require__("./node_modules/core-js/internals/descriptors.js"),V8_PROTOTYPE_DEFINE_BUG=__webpack_require__("./node_modules/core-js/internals/v8-prototype-define-bug.js"),definePropertyModule=__webpack_require__("./node_modules/core-js/internals/object-define-property.js"),anObject=__webpack_require__("./node_modules/core-js/internals/an-object.js"),toIndexedObject=__webpack_require__("./node_modules/core-js/internals/to-indexed-object.js"),objectKeys=__webpack_require__("./node_modules/core-js/internals/object-keys.js");exports.f=DESCRIPTORS&&!V8_PROTOTYPE_DEFINE_BUG?Object.defineProperties:function defineProperties(O,Properties){anObject(O);for(var key,props=toIndexedObject(Properties),keys=objectKeys(Properties),length=keys.length,index=0;length>index;)definePropertyModule.f(O,key=keys[index++],props[key]);return O}},"./node_modules/core-js/internals/object-define-property.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var DESCRIPTORS=__webpack_require__("./node_modules/core-js/internals/descriptors.js"),IE8_DOM_DEFINE=__webpack_require__("./node_modules/core-js/internals/ie8-dom-define.js"),V8_PROTOTYPE_DEFINE_BUG=__webpack_require__("./node_modules/core-js/internals/v8-prototype-define-bug.js"),anObject=__webpack_require__("./node_modules/core-js/internals/an-object.js"),toPropertyKey=__webpack_require__("./node_modules/core-js/internals/to-property-key.js"),$TypeError=TypeError,$defineProperty=Object.defineProperty,$getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;exports.f=DESCRIPTORS?V8_PROTOTYPE_DEFINE_BUG?function defineProperty(O,P,Attributes){if(anObject(O),P=toPropertyKey(P),anObject(Attributes),"function"==typeof O&&"prototype"===P&&"value"in Attributes&&"writable"in Attributes&&!Attributes.writable){var current=$getOwnPropertyDescriptor(O,P);current&&current.writable&&(O[P]=Attributes.value,Attributes={configurable:"configurable"in Attributes?Attributes.configurable:current.configurable,enumerable:"enumerable"in Attributes?Attributes.enumerable:current.enumerable,writable:!1})}return $defineProperty(O,P,Attributes)}:$defineProperty:function defineProperty(O,P,Attributes){if(anObject(O),P=toPropertyKey(P),anObject(Attributes),IE8_DOM_DEFINE)try{return $defineProperty(O,P,Attributes)}catch(error){}if("get"in Attributes||"set"in Attributes)throw new $TypeError("Accessors not supported");return"value"in Attributes&&(O[P]=Attributes.value),O}},"./node_modules/core-js/internals/object-get-own-property-descriptor.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var DESCRIPTORS=__webpack_require__("./node_modules/core-js/internals/descriptors.js"),call=__webpack_require__("./node_modules/core-js/internals/function-call.js"),propertyIsEnumerableModule=__webpack_require__("./node_modules/core-js/internals/object-property-is-enumerable.js"),createPropertyDescriptor=__webpack_require__("./node_modules/core-js/internals/create-property-descriptor.js"),toIndexedObject=__webpack_require__("./node_modules/core-js/internals/to-indexed-object.js"),toPropertyKey=__webpack_require__("./node_modules/core-js/internals/to-property-key.js"),hasOwn=__webpack_require__("./node_modules/core-js/internals/has-own-property.js"),IE8_DOM_DEFINE=__webpack_require__("./node_modules/core-js/internals/ie8-dom-define.js"),$getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;exports.f=DESCRIPTORS?$getOwnPropertyDescriptor:function getOwnPropertyDescriptor(O,P){if(O=toIndexedObject(O),P=toPropertyKey(P),IE8_DOM_DEFINE)try{return $getOwnPropertyDescriptor(O,P)}catch(error){}if(hasOwn(O,P))return createPropertyDescriptor(!call(propertyIsEnumerableModule.f,O,P),O[P])}},"./node_modules/core-js/internals/object-get-own-property-names.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var internalObjectKeys=__webpack_require__("./node_modules/core-js/internals/object-keys-internal.js"),hiddenKeys=__webpack_require__("./node_modules/core-js/internals/enum-bug-keys.js").concat("length","prototype");exports.f=Object.getOwnPropertyNames||function getOwnPropertyNames(O){return internalObjectKeys(O,hiddenKeys)}},"./node_modules/core-js/internals/object-get-own-property-symbols.js":(__unused_webpack_module,exports)=>{"use strict";exports.f=Object.getOwnPropertySymbols},"./node_modules/core-js/internals/object-is-prototype-of.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var uncurryThis=__webpack_require__("./node_modules/core-js/internals/function-uncurry-this.js");module.exports=uncurryThis({}.isPrototypeOf)},"./node_modules/core-js/internals/object-keys-internal.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var uncurryThis=__webpack_require__("./node_modules/core-js/internals/function-uncurry-this.js"),hasOwn=__webpack_require__("./node_modules/core-js/internals/has-own-property.js"),toIndexedObject=__webpack_require__("./node_modules/core-js/internals/to-indexed-object.js"),indexOf=__webpack_require__("./node_modules/core-js/internals/array-includes.js").indexOf,hiddenKeys=__webpack_require__("./node_modules/core-js/internals/hidden-keys.js"),push=uncurryThis([].push);module.exports=function(object,names){var key,O=toIndexedObject(object),i=0,result=[];for(key in O)!hasOwn(hiddenKeys,key)&&hasOwn(O,key)&&push(result,key);for(;names.length>i;)hasOwn(O,key=names[i++])&&(~indexOf(result,key)||push(result,key));return result}},"./node_modules/core-js/internals/object-keys.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var internalObjectKeys=__webpack_require__("./node_modules/core-js/internals/object-keys-internal.js"),enumBugKeys=__webpack_require__("./node_modules/core-js/internals/enum-bug-keys.js");module.exports=Object.keys||function keys(O){return internalObjectKeys(O,enumBugKeys)}},"./node_modules/core-js/internals/object-property-is-enumerable.js":(__unused_webpack_module,exports)=>{"use strict";var $propertyIsEnumerable={}.propertyIsEnumerable,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,NASHORN_BUG=getOwnPropertyDescriptor&&!$propertyIsEnumerable.call({1:2},1);exports.f=NASHORN_BUG?function propertyIsEnumerable(V){var descriptor=getOwnPropertyDescriptor(this,V);return!!descriptor&&descriptor.enumerable}:$propertyIsEnumerable},"./node_modules/core-js/internals/ordinary-to-primitive.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var call=__webpack_require__("./node_modules/core-js/internals/function-call.js"),isCallable=__webpack_require__("./node_modules/core-js/internals/is-callable.js"),isObject=__webpack_require__("./node_modules/core-js/internals/is-object.js"),$TypeError=TypeError;module.exports=function(input,pref){var fn,val;if("string"===pref&&isCallable(fn=input.toString)&&!isObject(val=call(fn,input)))return val;if(isCallable(fn=input.valueOf)&&!isObject(val=call(fn,input)))return val;if("string"!==pref&&isCallable(fn=input.toString)&&!isObject(val=call(fn,input)))return val;throw new $TypeError("Can't convert object to primitive value")}},"./node_modules/core-js/internals/own-keys.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var getBuiltIn=__webpack_require__("./node_modules/core-js/internals/get-built-in.js"),uncurryThis=__webpack_require__("./node_modules/core-js/internals/function-uncurry-this.js"),getOwnPropertyNamesModule=__webpack_require__("./node_modules/core-js/internals/object-get-own-property-names.js"),getOwnPropertySymbolsModule=__webpack_require__("./node_modules/core-js/internals/object-get-own-property-symbols.js"),anObject=__webpack_require__("./node_modules/core-js/internals/an-object.js"),concat=uncurryThis([].concat);module.exports=getBuiltIn("Reflect","ownKeys")||function ownKeys(it){var keys=getOwnPropertyNamesModule.f(anObject(it)),getOwnPropertySymbols=getOwnPropertySymbolsModule.f;return getOwnPropertySymbols?concat(keys,getOwnPropertySymbols(it)):keys}},"./node_modules/core-js/internals/regexp-exec-abstract.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var call=__webpack_require__("./node_modules/core-js/internals/function-call.js"),anObject=__webpack_require__("./node_modules/core-js/internals/an-object.js"),isCallable=__webpack_require__("./node_modules/core-js/internals/is-callable.js"),classof=__webpack_require__("./node_modules/core-js/internals/classof-raw.js"),regexpExec=__webpack_require__("./node_modules/core-js/internals/regexp-exec.js"),$TypeError=TypeError;module.exports=function(R,S){var exec=R.exec;if(isCallable(exec)){var result=call(exec,R,S);return null!==result&&anObject(result),result}if("RegExp"===classof(R))return call(regexpExec,R,S);throw new $TypeError("RegExp#exec called on incompatible receiver")}},"./node_modules/core-js/internals/regexp-exec.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var re1,re2,call=__webpack_require__("./node_modules/core-js/internals/function-call.js"),uncurryThis=__webpack_require__("./node_modules/core-js/internals/function-uncurry-this.js"),toString=__webpack_require__("./node_modules/core-js/internals/to-string.js"),regexpFlags=__webpack_require__("./node_modules/core-js/internals/regexp-flags.js"),stickyHelpers=__webpack_require__("./node_modules/core-js/internals/regexp-sticky-helpers.js"),shared=__webpack_require__("./node_modules/core-js/internals/shared.js"),create=__webpack_require__("./node_modules/core-js/internals/object-create.js"),getInternalState=__webpack_require__("./node_modules/core-js/internals/internal-state.js").get,UNSUPPORTED_DOT_ALL=__webpack_require__("./node_modules/core-js/internals/regexp-unsupported-dot-all.js"),UNSUPPORTED_NCG=__webpack_require__("./node_modules/core-js/internals/regexp-unsupported-ncg.js"),nativeReplace=shared("native-string-replace",String.prototype.replace),nativeExec=RegExp.prototype.exec,patchedExec=nativeExec,charAt=uncurryThis("".charAt),indexOf=uncurryThis("".indexOf),replace=uncurryThis("".replace),stringSlice=uncurryThis("".slice),UPDATES_LAST_INDEX_WRONG=(re2=/b*/g,call(nativeExec,re1=/a/,"a"),call(nativeExec,re2,"a"),0!==re1.lastIndex||0!==re2.lastIndex),UNSUPPORTED_Y=stickyHelpers.BROKEN_CARET,NPCG_INCLUDED=void 0!==/()??/.exec("")[1];(UPDATES_LAST_INDEX_WRONG||NPCG_INCLUDED||UNSUPPORTED_Y||UNSUPPORTED_DOT_ALL||UNSUPPORTED_NCG)&&(patchedExec=function exec(string){var result,reCopy,lastIndex,match,i,object,group,re=this,state=getInternalState(re),str=toString(string),raw=state.raw;if(raw)return raw.lastIndex=re.lastIndex,result=call(patchedExec,raw,str),re.lastIndex=raw.lastIndex,result;var groups=state.groups,sticky=UNSUPPORTED_Y&&re.sticky,flags=call(regexpFlags,re),source=re.source,charsAdded=0,strCopy=str;if(sticky&&(flags=replace(flags,"y",""),-1===indexOf(flags,"g")&&(flags+="g"),strCopy=stringSlice(str,re.lastIndex),re.lastIndex>0&&(!re.multiline||re.multiline&&"\n"!==charAt(str,re.lastIndex-1))&&(source="(?: "+source+")",strCopy=" "+strCopy,charsAdded++),reCopy=new RegExp("^(?:"+source+")",flags)),NPCG_INCLUDED&&(reCopy=new RegExp("^"+source+"$(?!\\s)",flags)),UPDATES_LAST_INDEX_WRONG&&(lastIndex=re.lastIndex),match=call(nativeExec,sticky?reCopy:re,strCopy),sticky?match?(match.input=stringSlice(match.input,charsAdded),match[0]=stringSlice(match[0],charsAdded),match.index=re.lastIndex,re.lastIndex+=match[0].length):re.lastIndex=0:UPDATES_LAST_INDEX_WRONG&&match&&(re.lastIndex=re.global?match.index+match[0].length:lastIndex),NPCG_INCLUDED&&match&&match.length>1&&call(nativeReplace,match[0],reCopy,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(match[i]=void 0)})),match&&groups)for(match.groups=object=create(null),i=0;i<groups.length;i++)object[(group=groups[i])[0]]=match[group[1]];return match}),module.exports=patchedExec},"./node_modules/core-js/internals/regexp-flags.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var anObject=__webpack_require__("./node_modules/core-js/internals/an-object.js");module.exports=function(){var that=anObject(this),result="";return that.hasIndices&&(result+="d"),that.global&&(result+="g"),that.ignoreCase&&(result+="i"),that.multiline&&(result+="m"),that.dotAll&&(result+="s"),that.unicode&&(result+="u"),that.unicodeSets&&(result+="v"),that.sticky&&(result+="y"),result}},"./node_modules/core-js/internals/regexp-get-flags.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var call=__webpack_require__("./node_modules/core-js/internals/function-call.js"),hasOwn=__webpack_require__("./node_modules/core-js/internals/has-own-property.js"),isPrototypeOf=__webpack_require__("./node_modules/core-js/internals/object-is-prototype-of.js"),regExpFlags=__webpack_require__("./node_modules/core-js/internals/regexp-flags.js"),RegExpPrototype=RegExp.prototype;module.exports=function(R){var flags=R.flags;return void 0!==flags||"flags"in RegExpPrototype||hasOwn(R,"flags")||!isPrototypeOf(RegExpPrototype,R)?flags:call(regExpFlags,R)}},"./node_modules/core-js/internals/regexp-sticky-helpers.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var fails=__webpack_require__("./node_modules/core-js/internals/fails.js"),$RegExp=__webpack_require__("./node_modules/core-js/internals/global-this.js").RegExp,UNSUPPORTED_Y=fails((function(){var re=$RegExp("a","y");return re.lastIndex=2,null!==re.exec("abcd")})),MISSED_STICKY=UNSUPPORTED_Y||fails((function(){return!$RegExp("a","y").sticky})),BROKEN_CARET=UNSUPPORTED_Y||fails((function(){var re=$RegExp("^r","gy");return re.lastIndex=2,null!==re.exec("str")}));module.exports={BROKEN_CARET,MISSED_STICKY,UNSUPPORTED_Y}},"./node_modules/core-js/internals/regexp-unsupported-dot-all.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var fails=__webpack_require__("./node_modules/core-js/internals/fails.js"),$RegExp=__webpack_require__("./node_modules/core-js/internals/global-this.js").RegExp;module.exports=fails((function(){var re=$RegExp(".","s");return!(re.dotAll&&re.test("\n")&&"s"===re.flags)}))},"./node_modules/core-js/internals/regexp-unsupported-ncg.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var fails=__webpack_require__("./node_modules/core-js/internals/fails.js"),$RegExp=__webpack_require__("./node_modules/core-js/internals/global-this.js").RegExp;module.exports=fails((function(){var re=$RegExp("(?<a>b)","g");return"b"!==re.exec("b").groups.a||"bc"!=="b".replace(re,"$<a>c")}))},"./node_modules/core-js/internals/require-object-coercible.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var isNullOrUndefined=__webpack_require__("./node_modules/core-js/internals/is-null-or-undefined.js"),$TypeError=TypeError;module.exports=function(it){if(isNullOrUndefined(it))throw new $TypeError("Can't call method on "+it);return it}},"./node_modules/core-js/internals/shared-key.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var shared=__webpack_require__("./node_modules/core-js/internals/shared.js"),uid=__webpack_require__("./node_modules/core-js/internals/uid.js"),keys=shared("keys");module.exports=function(key){return keys[key]||(keys[key]=uid(key))}},"./node_modules/core-js/internals/shared-store.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var IS_PURE=__webpack_require__("./node_modules/core-js/internals/is-pure.js"),globalThis=__webpack_require__("./node_modules/core-js/internals/global-this.js"),defineGlobalProperty=__webpack_require__("./node_modules/core-js/internals/define-global-property.js"),store=module.exports=globalThis["__core-js_shared__"]||defineGlobalProperty("__core-js_shared__",{});(store.versions||(store.versions=[])).push({version:"3.42.0",mode:IS_PURE?"pure":"global",copyright:"Â© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"})},"./node_modules/core-js/internals/shared.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var store=__webpack_require__("./node_modules/core-js/internals/shared-store.js");module.exports=function(key,value){return store[key]||(store[key]=value||{})}},"./node_modules/core-js/internals/string-multibyte.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var uncurryThis=__webpack_require__("./node_modules/core-js/internals/function-uncurry-this.js"),toIntegerOrInfinity=__webpack_require__("./node_modules/core-js/internals/to-integer-or-infinity.js"),toString=__webpack_require__("./node_modules/core-js/internals/to-string.js"),requireObjectCoercible=__webpack_require__("./node_modules/core-js/internals/require-object-coercible.js"),charAt=uncurryThis("".charAt),charCodeAt=uncurryThis("".charCodeAt),stringSlice=uncurryThis("".slice),createMethod=function(CONVERT_TO_STRING){return function($this,pos){var first,second,S=toString(requireObjectCoercible($this)),position=toIntegerOrInfinity(pos),size=S.length;return position<0||position>=size?CONVERT_TO_STRING?"":void 0:(first=charCodeAt(S,position))<55296||first>56319||position+1===size||(second=charCodeAt(S,position+1))<56320||second>57343?CONVERT_TO_STRING?charAt(S,position):first:CONVERT_TO_STRING?stringSlice(S,position,position+2):second-56320+(first-55296<<10)+65536}};module.exports={codeAt:createMethod(!1),charAt:createMethod(!0)}},"./node_modules/core-js/internals/symbol-constructor-detection.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var V8_VERSION=__webpack_require__("./node_modules/core-js/internals/environment-v8-version.js"),fails=__webpack_require__("./node_modules/core-js/internals/fails.js"),$String=__webpack_require__("./node_modules/core-js/internals/global-this.js").String;module.exports=!!Object.getOwnPropertySymbols&&!fails((function(){var symbol=Symbol("symbol detection");return!$String(symbol)||!(Object(symbol)instanceof Symbol)||!Symbol.sham&&V8_VERSION&&V8_VERSION<41}))},"./node_modules/core-js/internals/to-absolute-index.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var toIntegerOrInfinity=__webpack_require__("./node_modules/core-js/internals/to-integer-or-infinity.js"),max=Math.max,min=Math.min;module.exports=function(index,length){var integer=toIntegerOrInfinity(index);return integer<0?max(integer+length,0):min(integer,length)}},"./node_modules/core-js/internals/to-indexed-object.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var IndexedObject=__webpack_require__("./node_modules/core-js/internals/indexed-object.js"),requireObjectCoercible=__webpack_require__("./node_modules/core-js/internals/require-object-coercible.js");module.exports=function(it){return IndexedObject(requireObjectCoercible(it))}},"./node_modules/core-js/internals/to-integer-or-infinity.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var trunc=__webpack_require__("./node_modules/core-js/internals/math-trunc.js");module.exports=function(argument){var number=+argument;return number!=number||0===number?0:trunc(number)}},"./node_modules/core-js/internals/to-length.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var toIntegerOrInfinity=__webpack_require__("./node_modules/core-js/internals/to-integer-or-infinity.js"),min=Math.min;module.exports=function(argument){var len=toIntegerOrInfinity(argument);return len>0?min(len,9007199254740991):0}},"./node_modules/core-js/internals/to-object.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var requireObjectCoercible=__webpack_require__("./node_modules/core-js/internals/require-object-coercible.js"),$Object=Object;module.exports=function(argument){return $Object(requireObjectCoercible(argument))}},"./node_modules/core-js/internals/to-primitive.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var call=__webpack_require__("./node_modules/core-js/internals/function-call.js"),isObject=__webpack_require__("./node_modules/core-js/internals/is-object.js"),isSymbol=__webpack_require__("./node_modules/core-js/internals/is-symbol.js"),getMethod=__webpack_require__("./node_modules/core-js/internals/get-method.js"),ordinaryToPrimitive=__webpack_require__("./node_modules/core-js/internals/ordinary-to-primitive.js"),wellKnownSymbol=__webpack_require__("./node_modules/core-js/internals/well-known-symbol.js"),$TypeError=TypeError,TO_PRIMITIVE=wellKnownSymbol("toPrimitive");module.exports=function(input,pref){if(!isObject(input)||isSymbol(input))return input;var result,exoticToPrim=getMethod(input,TO_PRIMITIVE);if(exoticToPrim){if(void 0===pref&&(pref="default"),result=call(exoticToPrim,input,pref),!isObject(result)||isSymbol(result))return result;throw new $TypeError("Can't convert object to primitive value")}return void 0===pref&&(pref="number"),ordinaryToPrimitive(input,pref)}},"./node_modules/core-js/internals/to-property-key.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var toPrimitive=__webpack_require__("./node_modules/core-js/internals/to-primitive.js"),isSymbol=__webpack_require__("./node_modules/core-js/internals/is-symbol.js");module.exports=function(argument){var key=toPrimitive(argument,"string");return isSymbol(key)?key:key+""}},"./node_modules/core-js/internals/to-string-tag-support.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var test={};test[__webpack_require__("./node_modules/core-js/internals/well-known-symbol.js")("toStringTag")]="z",module.exports="[object z]"===String(test)},"./node_modules/core-js/internals/to-string.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var classof=__webpack_require__("./node_modules/core-js/internals/classof.js"),$String=String;module.exports=function(argument){if("Symbol"===classof(argument))throw new TypeError("Cannot convert a Symbol value to a string");return $String(argument)}},"./node_modules/core-js/internals/try-to-string.js":module=>{"use strict";var $String=String;module.exports=function(argument){try{return $String(argument)}catch(error){return"Object"}}},"./node_modules/core-js/internals/uid.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var uncurryThis=__webpack_require__("./node_modules/core-js/internals/function-uncurry-this.js"),id=0,postfix=Math.random(),toString=uncurryThis(1..toString);module.exports=function(key){return"Symbol("+(void 0===key?"":key)+")_"+toString(++id+postfix,36)}},"./node_modules/core-js/internals/use-symbol-as-uid.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var NATIVE_SYMBOL=__webpack_require__("./node_modules/core-js/internals/symbol-constructor-detection.js");module.exports=NATIVE_SYMBOL&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},"./node_modules/core-js/internals/v8-prototype-define-bug.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var DESCRIPTORS=__webpack_require__("./node_modules/core-js/internals/descriptors.js"),fails=__webpack_require__("./node_modules/core-js/internals/fails.js");module.exports=DESCRIPTORS&&fails((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},"./node_modules/core-js/internals/weak-map-basic-detection.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var globalThis=__webpack_require__("./node_modules/core-js/internals/global-this.js"),isCallable=__webpack_require__("./node_modules/core-js/internals/is-callable.js"),WeakMap=globalThis.WeakMap;module.exports=isCallable(WeakMap)&&/native code/.test(String(WeakMap))},"./node_modules/core-js/internals/well-known-symbol.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var globalThis=__webpack_require__("./node_modules/core-js/internals/global-this.js"),shared=__webpack_require__("./node_modules/core-js/internals/shared.js"),hasOwn=__webpack_require__("./node_modules/core-js/internals/has-own-property.js"),uid=__webpack_require__("./node_modules/core-js/internals/uid.js"),NATIVE_SYMBOL=__webpack_require__("./node_modules/core-js/internals/symbol-constructor-detection.js"),USE_SYMBOL_AS_UID=__webpack_require__("./node_modules/core-js/internals/use-symbol-as-uid.js"),Symbol=globalThis.Symbol,WellKnownSymbolsStore=shared("wks"),createWellKnownSymbol=USE_SYMBOL_AS_UID?Symbol.for||Symbol:Symbol&&Symbol.withoutSetter||uid;module.exports=function(name){return hasOwn(WellKnownSymbolsStore,name)||(WellKnownSymbolsStore[name]=NATIVE_SYMBOL&&hasOwn(Symbol,name)?Symbol[name]:createWellKnownSymbol("Symbol."+name)),WellKnownSymbolsStore[name]}},"./node_modules/core-js/modules/es.array.at.js":(__unused_webpack_module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var $=__webpack_require__("./node_modules/core-js/internals/export.js"),toObject=__webpack_require__("./node_modules/core-js/internals/to-object.js"),lengthOfArrayLike=__webpack_require__("./node_modules/core-js/internals/length-of-array-like.js"),toIntegerOrInfinity=__webpack_require__("./node_modules/core-js/internals/to-integer-or-infinity.js"),addToUnscopables=__webpack_require__("./node_modules/core-js/internals/add-to-unscopables.js");$({target:"Array",proto:!0},{at:function at(index){var O=toObject(this),len=lengthOfArrayLike(O),relativeIndex=toIntegerOrInfinity(index),k=relativeIndex>=0?relativeIndex:len+relativeIndex;return k<0||k>=len?void 0:O[k]}}),addToUnscopables("at")},"./node_modules/core-js/modules/es.array.flat-map.js":(__unused_webpack_module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var $=__webpack_require__("./node_modules/core-js/internals/export.js"),flattenIntoArray=__webpack_require__("./node_modules/core-js/internals/flatten-into-array.js"),aCallable=__webpack_require__("./node_modules/core-js/internals/a-callable.js"),toObject=__webpack_require__("./node_modules/core-js/internals/to-object.js"),lengthOfArrayLike=__webpack_require__("./node_modules/core-js/internals/length-of-array-like.js"),arraySpeciesCreate=__webpack_require__("./node_modules/core-js/internals/array-species-create.js");$({target:"Array",proto:!0},{flatMap:function flatMap(callbackfn){var A,O=toObject(this),sourceLen=lengthOfArrayLike(O);return aCallable(callbackfn),(A=arraySpeciesCreate(O,0)).length=flattenIntoArray(A,O,O,sourceLen,0,1,callbackfn,arguments.length>1?arguments[1]:void 0),A}})},"./node_modules/core-js/modules/es.array.flat.js":(__unused_webpack_module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var $=__webpack_require__("./node_modules/core-js/internals/export.js"),flattenIntoArray=__webpack_require__("./node_modules/core-js/internals/flatten-into-array.js"),toObject=__webpack_require__("./node_modules/core-js/internals/to-object.js"),lengthOfArrayLike=__webpack_require__("./node_modules/core-js/internals/length-of-array-like.js"),toIntegerOrInfinity=__webpack_require__("./node_modules/core-js/internals/to-integer-or-infinity.js"),arraySpeciesCreate=__webpack_require__("./node_modules/core-js/internals/array-species-create.js");$({target:"Array",proto:!0},{flat:function flat(){var depthArg=arguments.length?arguments[0]:void 0,O=toObject(this),sourceLen=lengthOfArrayLike(O),A=arraySpeciesCreate(O,0);return A.length=flattenIntoArray(A,O,O,sourceLen,0,void 0===depthArg?1:toIntegerOrInfinity(depthArg)),A}})},"./node_modules/core-js/modules/es.array.unscopables.flat-map.js":(__unused_webpack_module,__unused_webpack_exports,__webpack_require__)=>{"use strict";__webpack_require__("./node_modules/core-js/internals/add-to-unscopables.js")("flatMap")},"./node_modules/core-js/modules/es.array.unscopables.flat.js":(__unused_webpack_module,__unused_webpack_exports,__webpack_require__)=>{"use strict";__webpack_require__("./node_modules/core-js/internals/add-to-unscopables.js")("flat")},"./node_modules/core-js/modules/es.regexp.exec.js":(__unused_webpack_module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var $=__webpack_require__("./node_modules/core-js/internals/export.js"),exec=__webpack_require__("./node_modules/core-js/internals/regexp-exec.js");$({target:"RegExp",proto:!0,forced:/./.exec!==exec},{exec})},"./node_modules/core-js/modules/es.string.at-alternative.js":(__unused_webpack_module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var $=__webpack_require__("./node_modules/core-js/internals/export.js"),uncurryThis=__webpack_require__("./node_modules/core-js/internals/function-uncurry-this.js"),requireObjectCoercible=__webpack_require__("./node_modules/core-js/internals/require-object-coercible.js"),toIntegerOrInfinity=__webpack_require__("./node_modules/core-js/internals/to-integer-or-infinity.js"),toString=__webpack_require__("./node_modules/core-js/internals/to-string.js"),fails=__webpack_require__("./node_modules/core-js/internals/fails.js"),charAt=uncurryThis("".charAt);$({target:"String",proto:!0,forced:fails((function(){return"\ud842"!=="ð ®·".at(-2)}))},{at:function at(index){var S=toString(requireObjectCoercible(this)),len=S.length,relativeIndex=toIntegerOrInfinity(index),k=relativeIndex>=0?relativeIndex:len+relativeIndex;return k<0||k>=len?void 0:charAt(S,k)}})},"./node_modules/core-js/modules/es.string.replace-all.js":(__unused_webpack_module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var $=__webpack_require__("./node_modules/core-js/internals/export.js"),call=__webpack_require__("./node_modules/core-js/internals/function-call.js"),uncurryThis=__webpack_require__("./node_modules/core-js/internals/function-uncurry-this.js"),requireObjectCoercible=__webpack_require__("./node_modules/core-js/internals/require-object-coercible.js"),isCallable=__webpack_require__("./node_modules/core-js/internals/is-callable.js"),isObject=__webpack_require__("./node_modules/core-js/internals/is-object.js"),isRegExp=__webpack_require__("./node_modules/core-js/internals/is-regexp.js"),toString=__webpack_require__("./node_modules/core-js/internals/to-string.js"),getMethod=__webpack_require__("./node_modules/core-js/internals/get-method.js"),getRegExpFlags=__webpack_require__("./node_modules/core-js/internals/regexp-get-flags.js"),getSubstitution=__webpack_require__("./node_modules/core-js/internals/get-substitution.js"),wellKnownSymbol=__webpack_require__("./node_modules/core-js/internals/well-known-symbol.js"),IS_PURE=__webpack_require__("./node_modules/core-js/internals/is-pure.js"),REPLACE=wellKnownSymbol("replace"),$TypeError=TypeError,indexOf=uncurryThis("".indexOf),replace=uncurryThis("".replace),stringSlice=uncurryThis("".slice),max=Math.max;$({target:"String",proto:!0},{replaceAll:function replaceAll(searchValue,replaceValue){var IS_REG_EXP,flags,replacer,string,searchString,functionalReplace,searchLength,advanceBy,position,replacement,O=requireObjectCoercible(this),endOfLastMatch=0,result="";if(isObject(searchValue)){if((IS_REG_EXP=isRegExp(searchValue))&&(flags=toString(requireObjectCoercible(getRegExpFlags(searchValue))),!~indexOf(flags,"g")))throw new $TypeError("`.replaceAll` does not allow non-global regexes");if(replacer=getMethod(searchValue,REPLACE))return call(replacer,searchValue,O,replaceValue);if(IS_PURE&&IS_REG_EXP)return replace(toString(O),searchValue,replaceValue)}for(string=toString(O),searchString=toString(searchValue),(functionalReplace=isCallable(replaceValue))||(replaceValue=toString(replaceValue)),searchLength=searchString.length,advanceBy=max(1,searchLength),position=indexOf(string,searchString);-1!==position;)replacement=functionalReplace?toString(replaceValue(searchString,position,string)):getSubstitution(searchString,string,position,[],void 0,replaceValue),result+=stringSlice(string,endOfLastMatch,position)+replacement,endOfLastMatch=position+searchLength,position=position+advanceBy>string.length?-1:indexOf(string,searchString,position+advanceBy);return endOfLastMatch<string.length&&(result+=stringSlice(string,endOfLastMatch)),result}})},"./node_modules/core-js/modules/es.string.replace.js":(__unused_webpack_module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var apply=__webpack_require__("./node_modules/core-js/internals/function-apply.js"),call=__webpack_require__("./node_modules/core-js/internals/function-call.js"),uncurryThis=__webpack_require__("./node_modules/core-js/internals/function-uncurry-this.js"),fixRegExpWellKnownSymbolLogic=__webpack_require__("./node_modules/core-js/internals/fix-regexp-well-known-symbol-logic.js"),fails=__webpack_require__("./node_modules/core-js/internals/fails.js"),anObject=__webpack_require__("./node_modules/core-js/internals/an-object.js"),isCallable=__webpack_require__("./node_modules/core-js/internals/is-callable.js"),isObject=__webpack_require__("./node_modules/core-js/internals/is-object.js"),toIntegerOrInfinity=__webpack_require__("./node_modules/core-js/internals/to-integer-or-infinity.js"),toLength=__webpack_require__("./node_modules/core-js/internals/to-length.js"),toString=__webpack_require__("./node_modules/core-js/internals/to-string.js"),requireObjectCoercible=__webpack_require__("./node_modules/core-js/internals/require-object-coercible.js"),advanceStringIndex=__webpack_require__("./node_modules/core-js/internals/advance-string-index.js"),getMethod=__webpack_require__("./node_modules/core-js/internals/get-method.js"),getSubstitution=__webpack_require__("./node_modules/core-js/internals/get-substitution.js"),regExpExec=__webpack_require__("./node_modules/core-js/internals/regexp-exec-abstract.js"),REPLACE=__webpack_require__("./node_modules/core-js/internals/well-known-symbol.js")("replace"),max=Math.max,min=Math.min,concat=uncurryThis([].concat),push=uncurryThis([].push),stringIndexOf=uncurryThis("".indexOf),stringSlice=uncurryThis("".slice),REPLACE_KEEPS_$0="$0"==="a".replace(/./,"$0"),REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE=!!/./[REPLACE]&&""===/./[REPLACE]("a","$0");fixRegExpWellKnownSymbolLogic("replace",(function(_,nativeReplace,maybeCallNative){var UNSAFE_SUBSTITUTE=REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE?"$":"$0";return[function replace(searchValue,replaceValue){var O=requireObjectCoercible(this),replacer=isObject(searchValue)?getMethod(searchValue,REPLACE):void 0;return replacer?call(replacer,searchValue,O,replaceValue):call(nativeReplace,toString(O),searchValue,replaceValue)},function(string,replaceValue){var rx=anObject(this),S=toString(string);if("string"==typeof replaceValue&&-1===stringIndexOf(replaceValue,UNSAFE_SUBSTITUTE)&&-1===stringIndexOf(replaceValue,"$<")){var res=maybeCallNative(nativeReplace,rx,S,replaceValue);if(res.done)return res.value}var functionalReplace=isCallable(replaceValue);functionalReplace||(replaceValue=toString(replaceValue));var fullUnicode,global=rx.global;global&&(fullUnicode=rx.unicode,rx.lastIndex=0);for(var result,results=[];null!==(result=regExpExec(rx,S))&&(push(results,result),global);){""===toString(result[0])&&(rx.lastIndex=advanceStringIndex(S,toLength(rx.lastIndex),fullUnicode))}for(var it,accumulatedResult="",nextSourcePosition=0,i=0;i<results.length;i++){for(var replacement,matched=toString((result=results[i])[0]),position=max(min(toIntegerOrInfinity(result.index),S.length),0),captures=[],j=1;j<result.length;j++)push(captures,void 0===(it=result[j])?it:String(it));var namedCaptures=result.groups;if(functionalReplace){var replacerArgs=concat([matched],captures,position,S);void 0!==namedCaptures&&push(replacerArgs,namedCaptures),replacement=toString(apply(replaceValue,void 0,replacerArgs))}else replacement=getSubstitution(matched,S,position,captures,namedCaptures,replaceValue);position>=nextSourcePosition&&(accumulatedResult+=stringSlice(S,nextSourcePosition,position)+replacement,nextSourcePosition=position+matched.length)}return accumulatedResult+stringSlice(S,nextSourcePosition)}]}),!!fails((function(){var re=/./;return re.exec=function(){var result=[];return result.groups={a:"7"},result},"7"!=="".replace(re,"$<a>")}))||!REPLACE_KEEPS_$0||REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE)},"./node_modules/core-js/stable/array/at.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var parent=__webpack_require__("./node_modules/core-js/es/array/at.js");module.exports=parent},"./node_modules/core-js/stable/array/flat-map.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var parent=__webpack_require__("./node_modules/core-js/es/array/flat-map.js");module.exports=parent},"./node_modules/core-js/stable/array/flat.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var parent=__webpack_require__("./node_modules/core-js/es/array/flat.js");module.exports=parent},"./node_modules/core-js/stable/string/at.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var parent=__webpack_require__("./node_modules/core-js/es/string/at.js");module.exports=parent},"./node_modules/core-js/stable/string/replace-all.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";var parent=__webpack_require__("./node_modules/core-js/es/string/replace-all.js");module.exports=parent},"./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[7].use[1]!./node_modules/@storybook/addon-styling/node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[7].use[2]!./node_modules/@tldraw/tldraw/tldraw.css":(module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/css-loader/dist/runtime/sourceMaps.js"),_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__),_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,"/* THIS CSS FILE IS GENERATED! DO NOT EDIT. OR EDIT. I'M A COMMENT NOT A COP */ \n/* This file is created by the copy-css-files.mjs script in packages/tldraw. */\n/* It combines @tldraw/editor's editor.css and tldraw's ui.css */\n\n/* @tldraw/editor */\n\n.tl-container {\n\twidth: 100%;\n\theight: 100%;\n\tfont-size: 12px;\n\t/* Spacing */\n\t--space-1: 2px;\n\t--space-2: 4px;\n\t--space-3: 8px;\n\t--space-4: 12px;\n\t--space-5: 16px;\n\t--space-6: 20px;\n\t--space-7: 28px;\n\t--space-8: 32px;\n\t--space-9: 64px;\n\t--space-10: 72px;\n\t/* Radius */\n\t--radius-0: 2px;\n\t--radius-1: 4px;\n\t--radius-2: 6px;\n\t--radius-3: 9px;\n\t--radius-4: 11px;\n\n\t/* Canvas z-index */\n\t--layer-canvas-hidden: -999999;\n\t--layer-canvas-background: 100;\n\t--layer-canvas-grid: 150;\n\t--layer-watermark: 200;\n\t--layer-canvas-shapes: 300;\n\t--layer-canvas-overlays: 500;\n\t--layer-canvas-blocker: 10000;\n\n\t/* Canvas overlays z-index */\n\t--layer-overlays-collaborator-scribble: 10;\n\t--layer-overlays-collaborator-brush: 20;\n\t--layer-overlays-collaborator-shape-indicator: 30;\n\t--layer-overlays-user-scribble: 40;\n\t--layer-overlays-user-brush: 50;\n\t--layer-overlays-user-indicator-selected: 60;\n\t--layer-overlays-user-indicator-hovered: 70;\n\t--layer-overlays-user-snapline: 90;\n\t--layer-overlays-selection-fg: 100;\n\t/* User handles need to be above selection edges / corners, matters for sticky note clone handles */\n\t--layer-overlays-user-handles: 105;\n\t--layer-overlays-user-indicator-hint: 110;\n\t--layer-overlays-custom: 115;\n\t--layer-overlays-collaborator-cursor-hint: 120;\n\t--layer-overlays-collaborator-cursor: 130;\n\n\t/* Text editor z-index */\n\t--layer-text-container: 1;\n\t--layer-text-content: 3;\n\t--layer-text-editor: 4;\n\n\t/* Error fallback z-index */\n\t--layer-error-overlay: 1;\n\t--layer-error-canvas: 2;\n\t--layer-error-canvas-after: 3;\n\t--layer-error-content: 4;\n\n\t/* Misc */\n\t--tl-zoom: 1;\n\n\t/* Cursor SVGs */\n\t--tl-cursor-none: none;\n\t--tl-cursor-default:\n\t\turl(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path d='m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z' fill='white'/><path d='m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z' fill='white'/><path d='m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z' fill='black'/><path d='m13 10.814v11.188l2.969-2.866.428-.139h4.768z' fill='black'/></g></svg>\")\n\t\t\t12 8,\n\t\tdefault;\n\t--tl-cursor-pointer:\n\t\turl(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path d='m13.3315 21.3799c-.284-.359-.629-1.093-1.243-1.984-.348-.504-1.211-1.453-1.468-1.935-.223-.426-.199-.617-.146-.97.094-.628.738-1.117 1.425-1.051.519.049.959.392 1.355.716.239.195.533.574.71.788.163.196.203.277.377.509.23.307.302.459.214.121-.071-.496-.187-1.343-.355-2.092-.128-.568-.159-.657-.281-1.093-.129-.464-.195-.789-.316-1.281-.084-.348-.235-1.059-.276-1.459-.057-.547-.087-1.439.264-1.849.275-.321.906-.418 1.297-.22.512.259.803 1.003.936 1.3.239.534.387 1.151.516 1.961.164 1.031.466 2.462.476 2.763.024-.369-.068-1.146-.004-1.5.058-.321.328-.694.666-.795.286-.085.621-.116.916-.055.313.064.643.288.766.499.362.624.369 1.899.384 1.831.086-.376.071-1.229.284-1.584.14-.234.497-.445.687-.479.294-.052.655-.068.964-.008.249.049.586.345.677.487.218.344.342 1.317.379 1.658.015.141.074-.392.293-.736.406-.639 1.843-.763 1.898.639.025.654.02.624.02 1.064 0 .517-.012.828-.04 1.202-.031.4-.117 1.304-.242 1.742-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.191 1.813-.118.562-.079.566-.102.965-.023.398.121.922.121.922s-.802.104-1.234.035c-.391-.063-.875-.841-1-1.079-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.031-3.139.02 0 0 .185-1.011-.227-1.358-.305-.259-.83-.784-1.144-1.06z' fill='white'/><g stroke='black' stroke-linecap='round' stroke-width='.75'><path d='m13.3315 21.3799c-.284-.359-.629-1.093-1.243-1.984-.348-.504-1.211-1.453-1.468-1.935-.223-.426-.199-.617-.146-.97.094-.628.738-1.117 1.425-1.051.519.049.959.392 1.355.716.239.195.533.574.71.788.163.196.203.277.377.509.23.307.302.459.214.121-.071-.496-.187-1.343-.355-2.092-.128-.568-.159-.657-.281-1.093-.129-.464-.195-.789-.316-1.281-.084-.348-.235-1.059-.276-1.459-.057-.547-.087-1.439.264-1.849.275-.321.906-.418 1.297-.22.512.259.803 1.003.936 1.3.239.534.387 1.151.516 1.961.164 1.031.466 2.462.476 2.763.024-.369-.068-1.146-.004-1.5.058-.321.328-.694.666-.795.286-.085.621-.116.916-.055.313.064.643.288.766.499.362.624.369 1.899.384 1.831.086-.376.071-1.229.284-1.584.14-.234.497-.445.687-.479.294-.052.655-.068.964-.008.249.049.586.345.677.487.218.344.342 1.317.379 1.658.015.141.074-.392.293-.736.406-.639 1.843-.763 1.898.639.025.654.02.624.02 1.064 0 .517-.012.828-.04 1.202-.031.4-.117 1.304-.242 1.742-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.191 1.813-.118.562-.079.566-.102.965-.023.398.121.922.121.922s-.802.104-1.234.035c-.391-.063-.875-.841-1-1.079-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.031-3.139.02 0 0 .185-1.011-.227-1.358-.305-.259-.83-.784-1.144-1.06z' stroke-linejoin='round'/><path d='m21.5664 21.7344v-3.459'/><path d='m19.5508 21.7461-.016-3.473'/><path d='m17.5547 18.3047.021 3.426'/></g></g></svg>\")\n\t\t\t14 10,\n\t\tpointer;\n\t--tl-cursor-cross:\n\t\turl(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path d='m25 16h-6.01v-6h-2.98v6h-6.01v3h6.01v6h2.98v-6h6.01z' fill='white'/><path d='m23.9902 17.0103h-6v-6.01h-.98v6.01h-6v.98h6v6.01h.98v-6.01h6z' fill='%23231f1f'/></g></svg>\")\n\t\t\t16 16,\n\t\tcrosshair;\n\t--tl-cursor-move:\n\t\turl(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path d='m19 14h1v1h-1zm1 6h-1v-1h1zm-5-5h-1v-1h1zm0 5h-1v-1h1zm2-10.987-7.985 7.988 5.222 5.221 2.763 2.763 7.984-7.985z' fill='white'/><g fill='black'><path d='m23.5664 16.9971-2.557-2.809v1.829h-4.009-4.001v-1.829l-2.571 2.809 2.572 2.808-.001-1.808h4.001 4.009l-.001 1.808z'/><path d='m17.9873 17h.013v-4.001l1.807.001-2.807-2.571-2.809 2.57h1.809v4.001h.008v4.002l-1.828-.001 2.807 2.577 2.805-2.576h-1.805z'/></g></g></svg>\")\n\t\t\t16 16,\n\t\tmove;\n\t--tl-cursor-grab:\n\t\turl(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path d='m13.5557 17.5742c-.098-.375-.196-.847-.406-1.552-.167-.557-.342-.859-.47-1.233-.155-.455-.303-.721-.496-1.181-.139-.329-.364-1.048-.457-1.44-.119-.509.033-.924.244-1.206.253-.339.962-.49 1.357-.351.371.13.744.512.916.788.288.46.357.632.717 1.542.393.992.564 1.918.611 2.231l.085.452c-.001-.04-.043-1.122-.044-1.162-.035-1.029-.06-1.823-.038-2.939.002-.126.064-.587.084-.715.078-.5.305-.8.673-.979.412-.201.926-.215 1.401-.017.423.173.626.55.687 1.022.014.109.094.987.093 1.107-.013 1.025.006 1.641.015 2.174.004.231.003 1.625.017 1.469.061-.656.094-3.189.344-3.942.144-.433.405-.746.794-.929.431-.203 1.113-.07 1.404.243.285.305.446.692.482 1.153.032.405-.019.897-.02 1.245 0 .867-.021 1.324-.037 2.121-.001.038-.015.298.023.182.094-.28.188-.542.266-.745.049-.125.241-.614.359-.859.114-.234.211-.369.415-.688.2-.313.415-.448.668-.561.54-.235 1.109.112 1.301.591.086.215.009.713-.028 1.105-.061.647-.254 1.306-.352 1.648-.128.447-.274 1.235-.34 1.601-.072.394-.234 1.382-.359 1.82-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.192 1.812-.117.563-.078.567-.101.965-.024.399.121.923.121.923s-.802.104-1.234.034c-.391-.062-.875-.841-1-1.078-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.03-3.139.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.284-.36-.629-1.093-1.243-1.985-.348-.504-1.027-1.085-1.284-1.579-.223-.425-.331-.954-.19-1.325.225-.594.675-.897 1.362-.832.519.05.848.206 1.238.537.225.19.573.534.75.748.163.195.203.276.377.509.23.307.302.459.214.121' fill='white'/><g stroke='black' stroke-linecap='round' stroke-width='.75'><path d='m13.5557 17.5742c-.098-.375-.196-.847-.406-1.552-.167-.557-.342-.859-.47-1.233-.155-.455-.303-.721-.496-1.181-.139-.329-.364-1.048-.457-1.44-.119-.509.033-.924.244-1.206.253-.339.962-.49 1.357-.351.371.13.744.512.916.788.288.46.357.632.717 1.542.393.992.564 1.918.611 2.231l.085.452c-.001-.04-.043-1.122-.044-1.162-.035-1.029-.06-1.823-.038-2.939.002-.126.064-.587.084-.715.078-.5.305-.8.673-.979.412-.201.926-.215 1.401-.017.423.173.626.55.687 1.022.014.109.094.987.093 1.107-.013 1.025.006 1.641.015 2.174.004.231.003 1.625.017 1.469.061-.656.094-3.189.344-3.942.144-.433.405-.746.794-.929.431-.203 1.113-.07 1.404.243.285.305.446.692.482 1.153.032.405-.019.897-.02 1.245 0 .867-.021 1.324-.037 2.121-.001.038-.015.298.023.182.094-.28.188-.542.266-.745.049-.125.241-.614.359-.859.114-.234.211-.369.415-.688.2-.313.415-.448.668-.561.54-.235 1.109.112 1.301.591.086.215.009.713-.028 1.105-.061.647-.254 1.306-.352 1.648-.128.447-.274 1.235-.34 1.601-.072.394-.234 1.382-.359 1.82-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.192 1.812-.117.563-.078.567-.101.965-.024.399.121.923.121.923s-.802.104-1.234.034c-.391-.062-.875-.841-1-1.078-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.03-3.139.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.284-.36-.629-1.093-1.243-1.985-.348-.504-1.027-1.085-1.284-1.579-.223-.425-.331-.954-.19-1.325.225-.594.675-.897 1.362-.832.519.05.848.206 1.238.537.225.19.573.534.75.748.163.195.203.276.377.509.23.307.302.459.214.121' stroke-linejoin='round'/><path d='m20.5664 21.7344v-3.459'/><path d='m18.5508 21.7461-.016-3.473'/><path d='m16.5547 18.3047.021 3.426'/></g></g></svg>\")\n\t\t\t16 16,\n\t\tgrab;\n\t--tl-cursor-grabbing:\n\t\turl(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path d='m13.5732 12.0361c.48-.178 1.427-.069 1.677.473.213.462.396 1.241.406 1.075.024-.369-.024-1.167.137-1.584.117-.304.347-.59.686-.691.285-.086.62-.116.916-.055.313.064.642.287.765.499.362.623.368 1.899.385 1.831.064-.272.07-1.229.283-1.584.141-.235.497-.445.687-.479.294-.052.656-.068.964-.008.249.049.586.344.677.487.219.344.342 1.316.379 1.658.016.141.074-.393.293-.736.406-.639 1.844-.763 1.898.639.026.654.02.624.02 1.064 0 .516-.012.828-.04 1.202-.03.399-.116 1.304-.241 1.742-.086.301-.371.978-.653 1.384 0 0-1.074 1.25-1.191 1.812-.117.563-.078.567-.102.965-.023.399.121.923.121.923s-.801.104-1.234.034c-.391-.062-.875-.84-1-1.078-.172-.328-.539-.265-.682-.023-.224.383-.709 1.07-1.05 1.113-.669.084-2.055.03-3.14.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.283-.36-1.002-.929-1.243-1.985-.213-.936-.192-1.395.037-1.77.232-.381.67-.589.854-.625.208-.042.692-.039.875.062.223.123.313.159.488.391.23.307.312.456.213.121-.076-.262-.322-.595-.434-.97-.109-.361-.401-.943-.38-1.526.008-.221.103-.771.832-1.042' fill='white'/><g stroke='black' stroke-width='.75'><path d='m13.5732 12.0361c.48-.178 1.427-.069 1.677.473.213.462.396 1.241.406 1.075.024-.369-.024-1.167.137-1.584.117-.304.347-.59.686-.691.285-.086.62-.116.916-.055.313.064.642.287.765.499.362.623.368 1.899.385 1.831.064-.272.07-1.229.283-1.584.141-.235.497-.445.687-.479.294-.052.656-.068.964-.008.249.049.586.344.677.487.219.344.342 1.316.379 1.658.016.141.074-.393.293-.736.406-.639 1.844-.763 1.898.639.026.654.02.624.02 1.064 0 .516-.012.828-.04 1.202-.03.399-.116 1.304-.241 1.742-.086.301-.371.978-.653 1.384 0 0-1.074 1.25-1.191 1.812-.117.563-.078.567-.102.965-.023.399.121.923.121.923s-.801.104-1.234.034c-.391-.062-.875-.84-1-1.078-.172-.328-.539-.265-.682-.023-.224.383-.709 1.07-1.05 1.113-.669.084-2.055.03-3.14.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.283-.36-1.002-.929-1.243-1.985-.213-.936-.192-1.395.037-1.77.232-.381.67-.589.854-.625.208-.042.692-.039.875.062.223.123.313.159.488.391.23.307.312.456.213.121-.076-.262-.322-.595-.434-.97-.109-.361-.401-.943-.38-1.526.008-.221.103-.771.832-1.042z' stroke-linejoin='round'/><path d='m20.5664 19.7344v-3.459' stroke-linecap='round'/><path d='m18.5508 19.7461-.016-3.473' stroke-linecap='round'/><path d='m16.5547 16.3047.021 3.426' stroke-linecap='round'/></g></g></svg>\")\n\t\t\t16 16,\n\t\tgrabbing;\n\t--tl-cursor-text:\n\t\turl(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path fill='white' d='M7.94 0a5.25 5.25 0 0 0-3.47 1.17A5.27 5.27 0 0 0 1 0H0v3h1c1.41 0 1.85.7 2 1v3.94H2v3h1v3c-.13.3-.57 1-2 1H0v3h1a5.27 5.27 0 0 0 3.47-1.17c.98.8 2.21 1.21 3.47 1.17h1v-3h-1c-1.41 0-1.85-.7-2-1v-3H7v-3H6V4c.13-.3.57-1 2-1h1V0H7.94z'/><path fill='black' d='M7.94 2V1a4 4 0 0 0-3.47 1.64A4 4 0 0 0 1 1v1c1.3-.17 2.56.6 3 1.84v5.1H3v1h1v4.16c-.45 1.24-1.7 2-3 1.84v1a4.05 4.05 0 0 0 3.47-1.63 4.05 4.05 0 0 0 3.47 1.63v-1A2.82 2.82 0 0 1 5 14.1V9.93h1v-1H5V3.85A2.81 2.81 0 0 1 7.94 2z'/></g></svg>\")\n\t\t\t4 10,\n\t\ttext;\n\t--tl-cursor-zoom-in:\n\t\turl(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path d='m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5' fill='white'/><path d='m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z' stroke='black'/><g fill='black'><path d='m18 14h-2v-2h-2v2h-2v1.98h2v2.02h2v-2.02h2z'/><path d='m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z'/></g></g></svg>\")\n\t\t\t16 16,\n\t\tzoom-in;\n\t--tl-cursor-zoom-out:\n\t\turl(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path d='m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5' fill='white'/><path d='m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z' stroke='black'/><g fill='black'><path d='m18 16h-5.98v-1.98h5.98z'/><path d='m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z'/></g></g></svg>\")\n\t\t\t16 16,\n\t\tzoom-out;\n\n\t/* These cursor values get programmatically overridden */\n\t/* They're just here to help your editor autocomplete */\n\t--tl-cursor: var(--tl-cursor-default);\n\t--tl-cursor-resize-edge: ew-resize;\n\t--tl-cursor-resize-corner: nesw-resize;\n\t--tl-cursor-ew-resize: ew-resize;\n\t--tl-cursor-ns-resize: ns-resize;\n\t--tl-cursor-nesw-resize: nesw-resize;\n\t--tl-cursor-nwse-resize: nwse-resize;\n\t--tl-cursor-rotate: pointer;\n\t--tl-cursor-nwse-rotate: pointer;\n\t--tl-cursor-nesw-rotate: pointer;\n\t--tl-cursor-senw-rotate: pointer;\n\t--tl-cursor-swne-rotate: pointer;\n\t--tl-scale: calc(1 / var(--tl-zoom));\n\t/* fonts */\n\t--tl-font-draw: 'tldraw_draw', sans-serif;\n\t--tl-font-sans: 'tldraw_sans', sans-serif;\n\t--tl-font-serif: 'tldraw_serif', serif;\n\t--tl-font-mono: 'tldraw_mono', monospace;\n\t/* text outline */\n\t--a: calc(min(0.5, 1 / var(--tl-zoom)) * 2px);\n\t--b: calc(min(0.5, 1 / var(--tl-zoom)) * -2px);\n\t--tl-text-outline-reference:\n\t\t0 var(--b) 0 var(--color-background), 0 var(--a) 0 var(--color-background),\n\t\tvar(--b) var(--b) 0 var(--color-background), var(--a) var(--b) 0 var(--color-background),\n\t\tvar(--a) var(--a) 0 var(--color-background), var(--b) var(--a) 0 var(--color-background);\n\t--tl-text-outline: var(--tl-text-outline-reference);\n\t/* own properties */\n\tposition: relative;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\toverflow: clip;\n\tcolor: var(--color-text);\n}\n\n.tl-theme__light {\n\t--color-accent: hsl(0, 76%, 60%);\n\t--color-background: hsl(210, 20%, 98%);\n\t--color-brush-fill: hsl(0, 0%, 56%, 10.2%);\n\t--color-brush-stroke: hsl(0, 0%, 56%, 25.1%);\n\t--color-grid: hsl(0, 0%, 43%);\n\t--color-low: hsl(204, 16%, 94%);\n\t--color-low-border: hsl(204, 16%, 92%);\n\t--color-culled: hsl(204, 14%, 93%);\n\t--color-muted-none: hsl(0, 0%, 0%, 0%);\n\t--color-muted-0: hsl(0, 0%, 0%, 2%);\n\t--color-muted-1: hsl(0, 0%, 0%, 10%);\n\t--color-muted-2: hsl(0, 0%, 0%, 4.3%);\n\t--color-hint: hsl(0, 0%, 0%, 5.5%);\n\t--color-overlay: hsl(0, 0%, 0%, 20%);\n\t--color-divider: hsl(0, 0%, 91%);\n\t--color-panel-contrast: hsl(0, 0%, 100%);\n\t--color-panel-overlay: hsl(0, 0%, 100%, 82%);\n\t--color-panel: hsl(0, 0%, 99%);\n\t--color-panel-transparent: hsla(0, 0%, 99%, 0%);\n\t--color-focus: hsl(219, 65%, 50%);\n\t--color-selected: hsl(214, 84%, 56%);\n\t--color-selected-contrast: hsl(0, 0%, 100%);\n\t--color-selection-fill: hsl(210, 100%, 56%, 24%);\n\t--color-selection-stroke: hsl(214, 84%, 56%);\n\t--color-text-0: hsl(0, 0%, 11%);\n\t--color-text-1: hsl(0, 0%, 18%);\n\t--color-text-3: hsl(220, 2%, 65%);\n\t--color-text-shadow: hsl(0, 0%, 100%);\n\t--color-text-highlight: hsl(52, 100%, 50%);\n\t--color-text-highlight-p3: color(display-p3 0.972 0.8205 0.05);\n\t--color-primary: hsl(214, 84%, 56%);\n\t--color-success: hsl(123, 46%, 34%);\n\t--color-info: hsl(201, 98%, 41%);\n\t--color-warning: hsl(27, 98%, 47%);\n\t--color-error: hsl(0, 65%, 51%);\n\t--color-warn: hsl(0, 90%, 43%);\n\t--color-text: hsl(0, 0%, 0%);\n\t--color-laser: hsl(0, 100%, 50%);\n\t/* Shadows */\n\t--shadow-1: 0px 1px 2px hsl(0, 0%, 0%, 25%), 0px 1px 3px hsl(0, 0%, 0%, 9%);\n\t--shadow-2:\n\t\t0px 0px 2px hsl(0, 0%, 0%, 16%), 0px 2px 3px hsl(0, 0%, 0%, 24%),\n\t\t0px 2px 6px hsl(0, 0%, 0%, 0.1), inset 0px 0px 0px 1px var(--color-panel-contrast);\n\t--shadow-3:\n\t\t0px 1px 2px hsl(0, 0%, 0%, 28%), 0px 2px 6px hsl(0, 0%, 0%, 14%),\n\t\tinset 0px 0px 0px 1px var(--color-panel-contrast);\n\t--shadow-4:\n\t\t0px 0px 3px hsl(0, 0%, 0%, 19%), 0px 5px 4px hsl(0, 0%, 0%, 16%),\n\t\t0px 2px 16px hsl(0, 0%, 0%, 6%), inset 0px 0px 0px 1px var(--color-panel-contrast);\n}\n\n.tl-theme__dark {\n\t--color-accent: hsl(0, 76%, 60%);\n\t--color-background: hsl(240, 5%, 6.5%);\n\t--color-brush-fill: hsl(0, 0%, 71%, 5.1%);\n\t--color-brush-stroke: hsl(0, 0%, 71%, 25.1%);\n\t--color-grid: hsl(0, 0%, 40%);\n\t--color-low: hsl(260, 4.5%, 10.5%);\n\t--color-low-border: hsl(207, 10%, 10%);\n\t--color-culled: hsl(210, 11%, 19%);\n\t--color-muted-none: hsl(0, 0%, 100%, 0%);\n\t--color-muted-0: hsl(0, 0%, 100%, 2%);\n\t--color-muted-1: hsl(0, 0%, 100%, 10%);\n\t--color-muted-2: hsl(0, 0%, 100%, 5%);\n\t--color-hint: hsl(0, 0%, 100%, 7%);\n\t--color-overlay: hsl(0, 0%, 0%, 50%);\n\t--color-divider: hsl(240, 9%, 22%);\n\t--color-panel-contrast: hsl(245, 12%, 23%);\n\t--color-panel: hsl(235, 6.8%, 13.5%);\n\t--color-panel-overlay: hsl(210, 10%, 24%, 82%);\n\t--color-panel-transparent: hsla(235, 6.8%, 13.5%, 0%);\n\t--color-focus: hsl(217, 76%, 80%);\n\t--color-selected: hsl(217, 89%, 61%);\n\t--color-selected-contrast: hsl(0, 0%, 100%);\n\t--color-selection-fill: hsl(209, 100%, 57%, 20%);\n\t--color-selection-stroke: hsl(214, 84%, 56%);\n\t--color-text-0: hsl(0, 9%, 94%);\n\t--color-text-1: hsl(0, 0%, 85%);\n\t--color-text-3: hsl(210, 6%, 45%);\n\t--color-text-shadow: hsl(210, 13%, 18%);\n\t--color-text-highlight: hsl(52, 100%, 41%);\n\t--color-text-highlight-p3: color(display-p3 0.8078 0.6225 0.0312);\n\t--color-primary: hsl(214, 84%, 56%);\n\t--color-success: hsl(123, 38%, 57%);\n\t--color-info: hsl(199, 92%, 56%);\n\t--color-warning: hsl(36, 100%, 57%);\n\t--color-error: hsl(4, 90%, 58%);\n\t--color-warn: hsl(0, 81%, 66%);\n\t--color-text: hsl(210, 17%, 98%);\n\t--color-laser: hsl(0, 100%, 50%);\n\t/* Shadows */\n\t--shadow-1:\n\t\t0px 1px 2px hsl(0, 0%, 0%, 16.1%), 0px 1px 3px hsl(0, 0%, 0%, 22%),\n\t\tinset 0px 0px 0px 1px var(--color-panel-contrast);\n\t--shadow-2:\n\t\t0px 1px 3px hsl(0, 0%, 0%, 66.6%), 0px 2px 6px hsl(0, 0%, 0%, 33%),\n\t\tinset 0px 0px 0px 1px var(--color-panel-contrast);\n\t--shadow-3:\n\t\t0px 1px 3px hsl(0, 0%, 0%, 50%), 0px 2px 12px hsl(0, 0%, 0%, 50%),\n\t\tinset 0px 0px 0px 1px var(--color-panel-contrast);\n}\n\n.tl-counter-scaled {\n\ttransform: scale(var(--tl-scale));\n\ttransform-origin: top left;\n\twidth: calc(100% * var(--tl-zoom));\n\theight: calc(100% * var(--tl-zoom));\n}\n\n.tl-container,\n.tl-container * {\n\t-webkit-touch-callout: none;\n\t-webkit-tap-highlight-color: transparent;\n\tscrollbar-highlight-color: transparent;\n\t-webkit-user-select: none;\n\tuser-select: none;\n\tbox-sizing: border-box;\n\toutline: none;\n}\n\n.tl-container a {\n\t-webkit-touch-callout: initial;\n}\n\n.tl-container__focused {\n\toutline: 1px solid var(--color-low);\n}\n\ninput,\n*[contenteditable],\n*[contenteditable] * {\n\tuser-select: text;\n}\n\n/* -------------------------------------------------- */\n/*                       Canvas                       */\n/* -------------------------------------------------- */\n\n.tl-canvas {\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tcolor: var(--color-text);\n\tcursor: var(--tl-cursor);\n\toverflow: clip;\n\tcontent-visibility: auto;\n\ttouch-action: none;\n\tcontain: strict;\n}\n\n.tl-shapes {\n\tposition: relative;\n\tz-index: var(--layer-canvas-shapes);\n}\n\n.tl-overlays {\n\tposition: absolute;\n\ttop: 0px;\n\tleft: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tcontain: strict;\n\tpointer-events: none;\n\tz-index: var(--layer-canvas-overlays);\n}\n\n.tl-overlays__item {\n\tposition: absolute;\n\ttop: 0px;\n\tleft: 0px;\n\toverflow: visible;\n\tpointer-events: none;\n\ttransform-origin: top left;\n}\n\n.tl-svg-context {\n\tposition: absolute;\n\ttop: 0px;\n\tleft: 0px;\n\twidth: 100%;\n\theight: 100%;\n\tpointer-events: none;\n}\n\n/* ------------------- Background ------------------- */\n\n.tl-background__wrapper {\n\tz-index: var(--layer-canvas-background);\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n}\n\n.tl-background {\n\tbackground-color: var(--color-background);\n\twidth: 100%;\n\theight: 100%;\n}\n\n/* --------------------- Grid Layer --------------------- */\n\n.tl-grid {\n\tposition: absolute;\n\tinset: 0px;\n\twidth: 100%;\n\theight: 100%;\n\ttouch-action: none;\n\tpointer-events: none;\n\tz-index: var(--layer-canvas-grid);\n\tcontain: strict;\n}\n\n.tl-grid-dot {\n\tfill: var(--color-grid);\n}\n\n/* --------------------- Layers --------------------- */\n\n.tl-html-layer {\n\tposition: absolute;\n\ttop: 0px;\n\tleft: 0px;\n\twidth: 1px;\n\theight: 1px;\n\tcontain: layout style size;\n}\n\n/* ---------------------- Brush --------------------- */\n\n.tl-brush {\n\tstroke-width: calc(var(--tl-scale) * 1px);\n\tcontain: size layout;\n}\n\n.tl-brush__default {\n\tstroke: var(--color-brush-stroke);\n\tfill: var(--color-brush-fill);\n}\n\n/* -------------------- Scribble -------------------- */\n\n.tl-scribble {\n\tstroke-linejoin: round;\n\tstroke-linecap: round;\n\tpointer-events: none;\n\tcontain: size layout;\n}\n\n/* ---------------------- Shape --------------------- */\n\n.tl-shape {\n\tposition: absolute;\n\tpointer-events: none;\n\toverflow: visible;\n\ttransform-origin: top left;\n\tcontain: size layout;\n}\n\n/* ---------------- Shape Containers ---------------- */\n\n.tl-svg-container {\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tpointer-events: none;\n\tstroke-linecap: round;\n\tstroke-linejoin: round;\n\ttransform-origin: top left;\n\toverflow: visible;\n}\n\n.tl-html-container {\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tpointer-events: none;\n\tstroke-linecap: round;\n\tstroke-linejoin: round;\n\t/* content-visibility: auto; */\n\ttransform-origin: top left;\n\tcolor: inherit;\n}\n\n/* --------------- Overlay Stack --------------- */\n\n/* back of the stack, behind user's stuff */\n.tl-collaborator__scribble {\n\tz-index: var(--layer-overlays-collaborator-scribble);\n}\n\n.tl-collaborator__brush {\n\tz-index: var(--layer-overlays-collaborator-brush);\n}\n\n.tl-collaborator__shape-indicator {\n\tz-index: var(--layer-overlays-collaborator-shape-indicator);\n}\n\n.tl-user-scribble {\n\tz-index: var(--layer-overlays-user-scribble);\n}\n\n.tl-user-brush {\n\tz-index: var(--layer-overlays-user-brush);\n}\n\n.tl-user-indicator__selected {\n\tz-index: var(--layer-overlays-user-indicator-selected);\n}\n\n.tl-user-indicator__hovered {\n\tz-index: var(--layer-overlays-user-indicator-hovered);\n}\n\n.tl-user-handles {\n\tz-index: var(--layer-overlays-user-handles);\n}\n\n.tl-user-snapline {\n\tz-index: var(--layer-overlays-user-snapline);\n}\n\n.tl-selection__fg {\n\tpointer-events: none;\n\tz-index: var(--layer-overlays-selection-fg);\n}\n\n.tl-user-indicator__hint {\n\tz-index: var(--layer-overlays-user-indicator-hint);\n\tstroke-width: calc(2.5px * var(--tl-scale));\n}\n\n.tl-custom-overlays {\n\tz-index: var(--layer-overlays-custom);\n}\n\n/* behind collaborator cursor */\n.tl-collaborator__cursor-hint {\n\tz-index: var(--layer-overlays-collaborator-cursor-hint);\n}\n\n.tl-collaborator__cursor {\n\tz-index: var(--layer-overlays-collaborator-cursor);\n}\n\n.tl-cursor {\n\toverflow: visible;\n}\n\n/* -------------------- Indicator ------------------- */\n\n.tl-shape-indicator {\n\ttransform-origin: top left;\n\tfill: none;\n\tstroke-width: calc(1.5px * var(--tl-scale));\n\tcontain: size layout;\n}\n\n/* ------------------ SelectionBox ------------------ */\n\n.tl-selection__bg {\n\tposition: absolute;\n\ttop: 0px;\n\tleft: 0px;\n\ttransform-origin: top left;\n\tbackground-color: transparent;\n\tpointer-events: all;\n}\n\n.tl-selection__fg__outline {\n\tfill: none;\n\tpointer-events: none;\n\tstroke: var(--color-selection-stroke);\n\tstroke-width: calc(1.5px * var(--tl-scale));\n}\n\n.tl-corner-handle {\n\tpointer-events: none;\n\tstroke: var(--color-selection-stroke);\n\tfill: var(--color-background);\n\tstroke-width: calc(1.5px * var(--tl-scale));\n}\n\n.tl-text-handle {\n\tpointer-events: none;\n\tfill: var(--color-selection-stroke);\n}\n\n.tl-corner-crop-handle {\n\tpointer-events: none;\n\tfill: none;\n\tstroke: var(--color-selection-stroke);\n}\n\n.tl-corner-crop-edge-handle {\n\tpointer-events: none;\n\tfill: none;\n\tstroke: var(--color-selection-stroke);\n}\n\n.tl-mobile-rotate__bg {\n\tpointer-events: all;\n\tcursor: var(--tl-cursor-grab);\n}\n\n.tl-mobile-rotate__fg {\n\tpointer-events: none;\n\tstroke: var(--color-selection-stroke);\n\tfill: var(--color-background);\n\tstroke-width: calc(1.5px * var(--tl-scale));\n}\n\n.tl-transparent {\n\tfill: transparent;\n\tstroke: transparent;\n}\n\n/* --------------------- Handles -------------------- */\n\n.tl-handle {\n\tpointer-events: all;\n}\n\n.tl-handle__bg {\n\tfill: transparent;\n\tstroke: transparent;\n\tpointer-events: all;\n}\n\n.tl-handle__fg {\n\tfill: var(--color-selected-contrast);\n\tstroke: var(--color-selection-stroke);\n\tstroke-width: calc(1.5px * var(--tl-scale));\n\tpointer-events: none;\n}\n\n.tl-handle__create {\n\topacity: 0;\n}\n\n.tl-handle__clone > .tl-handle__fg {\n\tfill: var(--color-selection-stroke);\n\tstroke: none;\n}\n\n.tl-handle__bg:active {\n\tfill: none;\n}\n\n@media (pointer: coarse) {\n\t.tl-handle__bg:active {\n\t\tfill: var(--color-selection-fill);\n\t}\n\n\t.tl-handle__create {\n\t\topacity: 1;\n\t}\n}\n\n.tl-rotate-corner:not(:hover),\n.tl-resize-handle:not(:hover) {\n\tcursor: none;\n}\n\n/* --------------------- Arrow Hints -------------------- */\n\n.tl-arrow-hint-handle {\n\tfill: var(--color-selected-contrast);\n\tstroke: var(--color-selection-stroke);\n\tstroke-width: calc(1.5px * var(--tl-scale));\n\tr: calc(4px * var(--tl-scale));\n}\n\n.tl-arrow-hint-snap {\n\tstroke: transparent;\n\tfill: var(--color-selection-fill);\n\tr: calc(12px * var(--tl-scale));\n}\n\n.tl-arrow-hint-snap__none,\n.tl-arrow-hint-snap__center,\n.tl-arrow-hint-snap__axis {\n\tdisplay: none;\n}\n\n.tl-arrow-hint-snap__edge {\n\tr: calc(8px * var(--tl-scale));\n}\n\n/* ------------------ Bounds Detail ----------------- */\n\n.tl-image,\n.tl-video {\n\tobject-fit: cover;\n\tbackground-size: cover;\n\twidth: 100%;\n\theight: 100%;\n}\n\n.tl-video.tl-video-is-fullscreen {\n\tobject-fit: contain;\n\tbackground-size: contain;\n}\n\n.tl-video-container,\n.tl-image-container,\n.tl-embed-container {\n\twidth: 100%;\n\theight: 100%;\n\tpointer-events: all;\n\t/* background-color: var(--color-background); */\n\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n\n.tl-image-container {\n\tposition: relative;\n\toverflow: hidden;\n}\n.tl-image {\n\tposition: absolute;\n\tinset: 0;\n}\n\n.tl-image__tg {\n\t--scale: calc(min(2, var(--tl-scale)));\n\tposition: absolute;\n\ttop: calc(var(--scale) * 8px);\n\tright: calc(var(--scale) * 8px);\n\tfont-size: 10px;\n\ttransform-origin: top right;\n\tbackground-color: var(--color-background);\n\tpadding: 2px 4px;\n\tborder-radius: var(--radius-1);\n}\n\n/* --------------------- Nametag -------------------- */\n\n.tl-collaborator-cursor {\n\tposition: absolute;\n}\n\n.tl-nametag {\n\tposition: absolute;\n\ttop: 16px;\n\tleft: 13px;\n\twidth: fit-content;\n\theight: fit-content;\n\tmax-width: 120px;\n\tpadding: 3px 6px;\n\twhite-space: nowrap;\n\tposition: absolute;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\tfont-size: 12px;\n\tfont-family: var(--font-body);\n\tborder-radius: var(--radius-2);\n\tcolor: var(--color-selected-contrast);\n}\n\n.tl-nametag-title {\n\tposition: absolute;\n\ttop: -2px;\n\tleft: 13px;\n\twidth: fit-content;\n\theight: fit-content;\n\tpadding: 0px 6px;\n\tmax-width: 120px;\n\twhite-space: nowrap;\n\tposition: absolute;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\tfont-size: 12px;\n\tfont-family: var(--font-body);\n\ttext-shadow: var(--tl-text-outline);\n\tcolor: var(--color-selected-contrast);\n}\n\n.tl-nametag-chat {\n\tposition: absolute;\n\ttop: 16px;\n\tleft: 13px;\n\twidth: fit-content;\n\theight: fit-content;\n\tcolor: var(--color-selected-contrast);\n\twhite-space: nowrap;\n\tposition: absolute;\n\tpadding: 3px 6px;\n\tfont-size: 12px;\n\tfont-family: var(--font-body);\n\topacity: 1;\n\tborder-radius: var(--radius-2);\n}\n\n.tl-cursor-chat {\n\tposition: absolute;\n\tcolor: var(--color-selected-contrast);\n\twhite-space: nowrap;\n\tpadding: 3px 6px;\n\tfont-size: 12px;\n\tfont-family: var(--font-body);\n\tpointer-events: none;\n\tz-index: var(--layer-cursor);\n\tmargin-top: 16px;\n\tmargin-left: 13px;\n\topacity: 1;\n\tborder: none;\n\tuser-select: text;\n\tborder-radius: var(--radius-2);\n}\n\n.tl-cursor-chat .tl-cursor-chat__bubble {\n\tpadding-right: 12px;\n}\n\n.tl-cursor-chat::selection {\n\tbackground: var(--color-selected);\n\tcolor: var(--color-selected-contrast);\n\ttext-shadow: none;\n}\n\n.tl-cursor-chat-fade {\n\t/* Setting to zero causes it to immediately disappear */\n\t/* Setting to near-zero causes it to fade out gradually */\n\topacity: 0.0001;\n\ttransition: opacity 5s ease-in-out;\n}\n\n.tl-cursor-chat::placeholder {\n\tcolor: var(--color-selected-contrast);\n\topacity: 0.7;\n}\n\n/* --------------------- Spinner -------------------- */\n@keyframes spinner {\n\tto {\n\t\ttransform: rotate(360deg);\n\t}\n}\n\n/* ---------------------- Text ---------------------- */\n\n.tl-text-shape-label {\n\tposition: relative;\n\tfont-weight: normal;\n\tmin-width: 1px;\n\tpadding: 0px;\n\tmargin: 0px;\n\tborder: none;\n\twidth: fit-content;\n\theight: fit-content;\n\tfont-variant: normal;\n\tfont-style: normal;\n\tpointer-events: all;\n\twhite-space: pre-wrap;\n\toverflow-wrap: break-word;\n\ttext-shadow: var(--tl-text-outline);\n}\n\n.tl-text-wrapper[data-font='draw'] {\n\tfont-family: var(--tl-font-draw);\n}\n\n.tl-text-wrapper[data-font='sans'] {\n\tfont-family: var(--tl-font-sans);\n}\n\n.tl-text-wrapper[data-font='serif'] {\n\tfont-family: var(--tl-font-serif);\n}\n\n.tl-text-wrapper[data-font='mono'] {\n\tfont-family: var(--tl-font-mono);\n}\n\n.tl-text-wrapper[data-align='start'],\n.tl-text-wrapper[data-align='start-legacy'] {\n\ttext-align: left;\n}\n\n.tl-text-wrapper[data-align='middle'],\n.tl-text-wrapper[data-align='middle-legacy'] {\n\ttext-align: center;\n}\n\n.tl-text-wrapper[data-align='end'],\n.tl-text-wrapper[data-align='end-legacy'] {\n\ttext-align: right;\n}\n\n.tl-plain-text-wrapper[data-isediting='true'] .tl-text-content {\n\topacity: 0;\n}\n\n.tl-rich-text-wrapper[data-isediting='true'] .tl-text-content {\n\tdisplay: none;\n}\n\n.tl-text {\n\t/* remove overflow from textarea on windows */\n\tmargin: 0px;\n\tpadding: 0px;\n\n\tappearance: auto;\n\tbackground: none;\n\tborder-image: none;\n\tborder: 0px;\n\tcaret-color: var(--color-text);\n\tcolor: inherit;\n\tcolumn-count: initial !important;\n\tdisplay: inline-block;\n\tfont-family: inherit;\n\tfont-feature-settings: normal;\n\tfont-kerning: auto;\n\tfont-optical-sizing: auto;\n\tfont-size: inherit;\n\tfont-stretch: 100%;\n\tfont-style: inherit;\n\tfont-variant: inherit;\n\tfont-variation-settings: normal;\n\tfont-weight: inherit;\n\tletter-spacing: inherit;\n\tline-height: inherit;\n\toutline: none;\n\toverflow-wrap: break-word;\n\ttext-align: inherit;\n\ttext-indent: 0px;\n\ttext-rendering: auto;\n\ttext-shadow: inherit;\n\ttext-transform: none;\n\twhite-space: pre-wrap;\n\tline-break: normal;\n\tword-spacing: 0px;\n\tword-wrap: break-word;\n\twriting-mode: horizontal-tb !important;\n}\n\n.tl-text-measure {\n\tposition: absolute;\n\tz-index: var(--layer-canvas-hidden);\n\ttop: 0px;\n\tleft: 0px;\n\topacity: 0;\n\twidth: max-content;\n\tbox-sizing: border-box;\n\tpointer-events: none;\n\twhite-space: pre-wrap;\n\tword-wrap: break-word;\n\toverflow-wrap: break-word;\n\tresize: none;\n\tborder: none;\n\tuser-select: none;\n\tcontain: style paint;\n\t-webkit-user-select: none;\n}\n\n.tl-text-input,\n.tl-text-content {\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tmin-width: 1px;\n\tmin-height: 1px;\n\toutline: none;\n}\n\n.tl-text-content__wrapper {\n\tposition: relative;\n\twidth: fit-content;\n\theight: fit-content;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpointer-events: none;\n\tmin-height: auto;\n}\n\n.tl-text-content {\n\toverflow: visible;\n\tpointer-events: none;\n}\n\n.tl-text-input {\n\tresize: none;\n\tuser-select: all;\n\t-webkit-user-select: text;\n\tcursor: var(--tl-cursor-text);\n}\n\n.tl-text-input:not(.tl-rich-text) {\n\t/*\n\t * Note: this `overflow: hidden` is key for scrollbars to not show up\n\t * plaintext/<textarea> editors.\n\t */\n\toverflow: hidden;\n}\n\n.tl-text-wrapper[data-isediting='false'] .tl-text-input,\n.tl-arrow-label[data-isediting='false'] .tl-text-input {\n\topacity: 0;\n\tcursor: var(--tl-cursor-default);\n}\n\n.tl-rich-text[data-is-ready-for-editing='true'],\n.tl-text-wrapper[data-is-ready-for-editing='true'] .tl-text-input {\n\tcursor: var(--tl-cursor-text);\n}\n\n.tl-text-input::selection {\n\tbackground: var(--color-selected);\n\tcolor: var(--color-selected-contrast);\n\ttext-shadow: none;\n}\n\n.tl-rich-text .ProseMirror {\n\tword-wrap: break-word;\n\toverflow-wrap: break-word;\n\twhite-space: pre-wrap;\n\n\t/**\n\t * Note: ProseMirror disables this in https://github.com/ProseMirror/prosemirror-view/commit/6b3b2205e2f3029cb8e8e86c55a190a22491df31\n\t * However, that was from 8 years ago and the browser caret issue\n\t * it mentions seems to be fixed. So, we're re-enabling it.\n\t * We'll tell ProseMirror maybe to get rid of this on their end.\n\t *\n\t */\n\t-webkit-font-variant-ligatures: inherit;\n\tfont-variant-ligatures: inherit;\n\tfont-feature-settings: inherit;\n\n\t/**\n\t * N.B. This following CSS Rule comes standard with the tiptap editor.\n\t * Combined with the above rule that it supersedes, it allows for\n\t * the auto-linking to work in text. Say, when typing example.com\n\t * this helps it automatically turn that bit of text into a link.\n\t *\n\t * However, specifically, the break-spaces features seems to cause\n\t * rendering differences when going in-and-out of edit mode. For example,\n\t * the statically rendered text 'the rain in spain falls mainly on the plain'\n\t * in a note shape will render differently when going in-and-out of edit mode.\n\t *\n\t * So, this is commented out to help make both the autolinking work (which now\n\t * relies on the white-space: pre-wrap to work and to make the static/edit-mode\n\t * rendering consistent.\n\t * In the future, we might consider just making the static rendering just use\n\t * white-space: break-spaces to make it consistent with the edit mode if need be.\n\t *\n\t * Also, the amount of ink I've spilt in my career writing comments explaining\n\t * white-space in contenteditable is incredible.\n\t *\n\t/* white-space: break-spaces; */\n}\n\n.tl-rich-text p {\n\tmargin: 0;\n\t/* Depending on the extensions, <p> tags can be empty, without a <br />. */\n\tmin-height: 1lh;\n}\n\n.tl-rich-text ul,\n.tl-rich-text ol {\n\ttext-align: left;\n\tmargin: 0;\n\tpadding-left: 3.25ch;\n\t/* Some resets, like Tailwind, nix the list styling. */\n\tlist-style: revert;\n}\n\n.tl-rich-text ol:has(> li:nth-child(10)) {\n\tpadding-left: 4.25ch;\n}\n\n.tl-rich-text ol:has(> li:nth-child(100)) {\n\tpadding-left: 5.25ch;\n}\n\n.tl-rich-text h1,\n.tl-rich-text h2,\n.tl-rich-text h3,\n.tl-rich-text h4,\n.tl-rich-text h5,\n.tl-rich-text h6 {\n\tmargin-top: 5px;\n\tmargin-bottom: 10px;\n}\n\n.tl-rich-text a {\n\tcolor: var(--color-primary);\n\ttext-decoration: underline;\n}\n\n.tl-rich-text[data-is-select-tool-active='false'] a {\n\tcursor: inherit;\n}\n\n.tl-rich-text code {\n\tfont-family: var(--tl-font-mono);\n}\n\n.tl-rich-text mark {\n\tbackground-color: #fddd00;\n\tcolor: currentColor;\n\tborder-radius: 2px;\n}\n\n.tl-theme__light .tl-rich-text mark {\n\ttext-shadow: none;\n}\n\n.tl-theme__dark .tl-rich-text mark {\n\tbackground-color: var(--color-text-highlight);\n\tcolor: currentColor;\n}\n\n@supports (color: color(display-p3 1 1 1)) {\n\t@media (color-gamut: p3) {\n\t\t.tl-container:not(.tl-theme__force-sRGB) .tl-rich-text mark {\n\t\t\tbackground-color: var(--color-text-highlight-p3);\n\t\t}\n\t}\n}\n\n.tl-text-label__inner > .tl-text-input.tl-rich-text {\n\tdisplay: none;\n\tposition: static;\n}\n\n.tl-text-wrapper[data-isediting='true'] .tl-rich-text {\n\tdisplay: block;\n}\n\n/* ------------------- Snap Lines ------------------- */\n\n.tl-snap-indicator {\n\tstroke: var(--color-accent);\n\tstroke-width: calc(1px * var(--tl-scale));\n\tfill: none;\n}\n\n.tl-snap-point {\n\tstroke: var(--color-accent);\n\tstroke-width: calc(1px * var(--tl-scale));\n\tfill: none;\n}\n\n/* -------------------- Groups ------------------ */\n\n.tl-group {\n\tstroke: var(--color-text);\n\tstroke-width: calc(1px * var(--tl-scale));\n\topacity: 0.5;\n}\n\n/* ------------------- Bookmark Shape ------------------- */\n\n.tl-bookmark__container {\n\twidth: 100%;\n\theight: 100%;\n\tposition: relative;\n\tborder: 1px solid var(--color-panel-contrast);\n\tbackground-color: var(--color-panel);\n\tborder-radius: var(--radius-2);\n\tdisplay: flex;\n\tflex-direction: column;\n\toverflow: hidden;\n}\n\n.tl-bookmark__container--safariExport {\n\tborder: 1px solid var(--color-divider);\n}\n\n.tl-bookmark__image_container {\n\tflex: 1 1 100%;\n\toverflow: hidden;\n\tborder-top-left-radius: var(--radius-1);\n\tborder-top-right-radius: var(--radius-1);\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tjustify-content: flex-end;\n\talign-items: flex-start;\n}\n\n.tl-bookmark__image_container > .tl-hyperlink-button::after {\n\tbackground-color: var(--color-panel);\n}\n\n.tl-bookmark__placeholder {\n\twidth: 100%;\n\theight: 100%;\n\tbackground-color: var(--color-muted-2);\n\tborder-bottom: 1px solid var(--color-muted-2);\n}\n\n.tl-bookmark__image {\n\twidth: 100%;\n\theight: 100%;\n\tobject-fit: cover;\n\tobject-position: center;\n\tborder-bottom: 1px solid var(--color-muted-2);\n}\n\n.tl-bookmark__copy_container {\n\tbackground-color: var(--color-muted);\n\tpadding: var(--space-4);\n\tpointer-events: all;\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: space-between;\n\tflex: 1;\n}\n\n.tl-bookmark__heading,\n.tl-bookmark__description,\n.tl-bookmark__link {\n\tmargin: 0px;\n\twidth: 100%;\n\tfont-family: inherit;\n}\n\n.tl-bookmark__heading {\n\tfont-size: 16px;\n\tline-height: 1.5;\n\tfont-weight: bold;\n\tpadding-bottom: var(--space-2);\n\toverflow: hidden;\n\tmax-height: calc((16px * 1.5) * 2);\n\t-webkit-box-orient: vertical;\n\t-webkit-line-clamp: 2;\n\tline-clamp: 2;\n\ttext-overflow: ellipsis;\n\tdisplay: -webkit-box;\n}\n\n.tl-bookmark__description {\n\tfont-size: 12px;\n\tline-height: 1.5;\n\toverflow: hidden;\n\tmax-height: calc((12px * 1.5) * 3);\n\t-webkit-box-orient: vertical;\n\t-webkit-line-clamp: 3;\n\tline-clamp: 3;\n\ttext-overflow: ellipsis;\n\tdisplay: -webkit-box;\n\tcolor: var(--color-text-2);\n\tmargin: var(--space-2) 0px;\n}\n\n.tl-bookmark__heading + .tl-bookmark__link,\n.tl-bookmark__description + .tl-bookmark__link {\n\tmargin-top: var(--space-3);\n}\n.tl-bookmark__link {\n\tfont-size: 12px;\n\tpointer-events: all;\n\tdisplay: flex;\n\tcolor: var(--color-text-2);\n\talign-items: center;\n\tcursor: var(--tl-cursor-pointer);\n\twidth: fit-content;\n\tmax-width: 100%;\n}\n\n.tl-bookmark__link > span {\n\tflex-shrink: 0px;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n}\n\n.tl-bookmark__link > .tl-hyperlink__icon {\n\tmargin-right: 8px;\n\tflex-shrink: 0;\n}\n\n.tl-bookmark__link > .tl-bookmark__favicon {\n\tmargin-right: 8px;\n\twidth: 16px;\n\theight: 16px;\n\tflex-shrink: 0;\n}\n\n/* ---------------- Hyperlink Button ---------------- */\n\n.tl-hyperlink-button {\n\tbackground: none;\n\tmargin: 0px;\n\tposition: absolute;\n\ttop: 0px;\n\tright: 0px;\n\theight: 44px;\n\twidth: 44px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-size: 12px;\n\tfont-weight: 400;\n\tcolor: var(--color-text-1);\n\tpadding: 13px;\n\tcursor: var(--tl-cursor-pointer);\n\tborder: none;\n\toutline: none;\n\tpointer-events: all;\n\tz-index: 1;\n}\n\n.tl-hyperlink-button::after {\n\tcontent: '';\n\tz-index: -1;\n\tposition: absolute;\n\tright: 6px;\n\tbottom: 6px;\n\tdisplay: block;\n\twidth: calc(100% - 12px);\n\theight: calc(100% - 12px);\n\tborder-radius: var(--radius-1);\n\tbackground-color: var(--color-background);\n\tpointer-events: none;\n}\n\n.tl-hyperlink-button:focus-visible {\n\tcolor: var(--color-selected);\n}\n\n.tl-hyperlink__icon {\n\twidth: 16px;\n\theight: 16px;\n\tbackground-color: currentColor;\n\tpointer-events: none;\n}\n\n.tl-hyperlink-button__hidden {\n\tdisplay: none;\n}\n\n/* ---------------- Geo shape ---------------- */\n\n.tl-text-label {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tcolor: var(--color-text);\n\ttext-shadow: var(--tl-text-outline);\n\tline-height: inherit;\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n}\n\n.tl-text-label[data-hastext='false'][data-isediting='false'] > .tl-text-label__inner {\n\twidth: 40px;\n\theight: 40px;\n}\n\n.tl-text-label[data-hastext='true'][data-isediting='false'] .tl-text-content {\n\tpointer-events: all;\n}\n\n.tl-text-wrapper .tl-text-content {\n\tpointer-events: all;\n\tz-index: var(--layer-text-content);\n}\n\n.tl-text-label__inner > .tl-text-content {\n\tposition: relative;\n\ttop: 0px;\n\tleft: 0px;\n\tpadding: inherit;\n\theight: fit-content;\n\twidth: fit-content;\n\tborder-radius: var(--radius-1);\n\tmax-width: 100%;\n}\n\n.tl-text-label__inner > .tl-text-input {\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tpadding: inherit;\n}\n\n.tl-text-wrapper[data-isselected='true'] .tl-text-input {\n\tz-index: var(--layer-text-editor);\n\tpointer-events: all;\n}\n\n/* This part of the rule helps preserve the occlusion rules for the shapes so we\n * don't click on shapes that are behind other shapes.\n * One extra nuance is we don't use this behavior for:\n *  - arrows which have weird geometry and just gets in the way.\n *  - draw/line shapes, because it feels restrictive to have them be 'in the way' of clicking on a textfield\n *  - shapes that are not filled\n */\n.tl-canvas:is([data-iseditinganything='true'], [data-isselectinganything='true'])\n\t.tl-shape:not(\n\t\t[data-shape-type='arrow'],\n\t\t[data-shape-type='draw'],\n\t\t[data-shape-type='line'],\n\t\t[data-shape-type='highlight'],\n\t\t[data-shape-is-filled='false']\n\t) {\n\tpointer-events: all;\n}\n\n.tl-text-label[data-textwrap='true'] > .tl-text-label__inner {\n\tmax-width: 100%;\n}\n\n.tl-text-label[data-isediting='true'] {\n\tbackground-color: transparent;\n\tmin-height: auto;\n}\n\n.tl-arrow-hint {\n\tstroke: var(--color-text-1);\n\tfill: none;\n\tstroke-linecap: round;\n\toverflow: visible;\n}\n\n/* ------------------- Arrow Shape ------------------ */\n\n.tl-arrow-label {\n\tposition: absolute;\n\ttop: -1px;\n\tleft: -1px;\n\twidth: 2px;\n\theight: 2px;\n\tpadding: 0px;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\ttext-align: center;\n\tcolor: var(--color-text);\n\ttext-shadow: var(--tl-text-outline);\n}\n\n.tl-arrow-label[data-isediting='true'] p {\n\topacity: 0;\n}\n\n.tl-arrow-label__inner {\n\tborder-radius: var(--radius-1);\n\tbox-sizing: content-box;\n\tposition: relative;\n\theight: max-content;\n\twidth: max-content;\n\tpointer-events: none;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n\n.tl-arrow-label .tl-arrow {\n\tposition: relative;\n\theight: max-content;\n\tpadding: inherit;\n\toverflow: visible;\n}\n\n.tl-arrow-label textarea {\n\tpadding: inherit;\n\t/* Don't allow textarea to be zero width */\n\tmin-width: 4px;\n}\n\n/* -------------------- NoteShape ------------------- */\n\n.tl-note__container {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n\tpointer-events: all;\n\topacity: 1;\n\tz-index: var(--layer-text-container);\n\tborder-radius: 1px;\n}\n\n.tl-note__container > .tl-text-label {\n\ttext-shadow: none;\n\tcolor: currentColor;\n}\n\n/* --------------------- Loading -------------------- */\n\n.tl-loading {\n\tbackground-color: var(--color-background);\n\tcolor: var(--color-text-1);\n\theight: 100%;\n\twidth: 100%;\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: center;\n\talign-items: center;\n\tgap: var(--space-2);\n\tfont-size: 14px;\n\tfont-weight: 500;\n\topacity: 0;\n\tanimation: fade-in 0.2s ease-in-out forwards;\n\tanimation-delay: 0.2s;\n\tposition: absolute;\n\tinset: 0px;\n\tz-index: var(--layer-canvas-blocker);\n}\n\n@keyframes fade-in {\n\t0% {\n\t\topacity: 0;\n\t}\n\t100% {\n\t\topacity: 1;\n\t}\n}\n\n/* -------------------- FrameShape ------------------- */\n\n.tl-frame__body {\n\tstroke-width: calc(1px * var(--tl-scale));\n}\n\n.tl-frame__creating {\n\tstroke: var(--color-selected);\n\tfill: none;\n}\n\n.tl-frame-heading {\n\t--frame-padding-x: 6px;\n\t--frame-height: 24px;\n\t--frame-minimum-width: 32px;\n\t--frame-offset-width: 16px;\n\tdisplay: flex;\n\talign-items: center;\n\tposition: absolute;\n\ttransform-origin: 0% 100%;\n\toverflow: hidden;\n\tmax-width: 100%;\n\tmin-width: var(--frame-minimum-width);\n\theight: auto;\n\tfont-size: 12px;\n\tpadding-bottom: 4px;\n\tpointer-events: all;\n}\n\n.tl-frame-heading-hit-area {\n\tpointer-events: all;\n\t/* scale from bottom left corner so we can pin it to the top left corner of the frame */\n\ttransform-origin: 0% 100%;\n\tdisplay: flex;\n\theight: var(--frame-height);\n\twidth: 100%;\n\talign-items: center;\n\tborder-radius: var(--radius-1);\n}\n\n.tl-frame-label {\n\tpointer-events: all;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\tpadding: 0px var(--frame-padding-x);\n\tborder-radius: var(--radius-1);\n\tposition: relative;\n\tfont-size: inherit;\n\twhite-space: pre;\n}\n\n.tl-frame-label__editing {\n\tcolor: transparent;\n\twhite-space: pre;\n\twidth: auto;\n\tmin-width: var(--frame-minimum-width);\n\theight: 100%;\n\toverflow: visible;\n\tbackground-color: var(--color-panel);\n\tborder-color: var(--color-selected);\n\tbox-shadow: inset 0px 0px 0px 1.5px var(--color-selected);\n}\n\n.tl-frame-name-input {\n\tposition: absolute;\n\tborder: none;\n\tbackground: none;\n\toutline: none;\n\tpadding: 0px var(--frame-padding-x);\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tfont-size: inherit;\n\tfont-family: inherit;\n\tfont-weight: inherit;\n\twidth: 100%;\n\tcolor: var(--color-text-1);\n\tborder-radius: var(--radius-1);\n\tuser-select: all;\n\t-webkit-user-select: text;\n\twhite-space: pre;\n\tcursor: var(--tl-cursor-text);\n}\n\n/* If mobile use 16px as font size */\n/* On iOS, font size under 16px in an input will make the page zoom into the input ð¤¦ââï¸ */\n/* https://css-tricks.com/16px-or-larger-text-prevents-ios-form-zoom/ */\n@media (max-width: 600px) {\n\t.tl-frame-heading {\n\t\tfont-size: 16px;\n\t}\n}\n\n/* ------------------ iFrames Detail ----------------- */\n\n.tl-embed {\n\tborder: none;\n\tborder-radius: var(--radius-2);\n}\n\n/* -------------- Shape Error Boundary -------------- */\n\n.tl-shape-error-boundary {\n\twidth: 100%;\n\theight: 100%;\n\tbackground-color: var(--color-muted-1);\n\tborder-width: calc(1px * var(--tl-scale));\n\tborder-color: var(--color-muted-1);\n\tborder-style: solid;\n\tborder-radius: calc(var(--radius-1) * var(--tl-scale));\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tjustify-content: center;\n\ttext-align: left;\n\tposition: relative;\n\tpointer-events: all;\n\toverflow: hidden;\n\tpadding: var(--space-2);\n}\n\n.tl-shape-error-boundary::before {\n\ttransform: scale(var(--tl-scale));\n\tcontent: 'Error';\n\tfont-size: 12px;\n\tfont-family: inherit;\n\tcolor: var(--color-text-0);\n}\n\n/* ----------------- Error Boundary ----------------- */\n\n.tl-error-boundary {\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: var(--space-4);\n\tbackground-color: var(--color-background);\n\tcolor: var(--color-text-1);\n\tposition: absolute;\n}\n\n.tl-error-boundary__overlay {\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tz-index: var(--layer-error-overlay);\n\tbackground-color: var(--color-overlay);\n}\n\n.tl-error-boundary__content * {\n\tuser-select: all;\n\t-webkit-user-select: text;\n\tpointer-events: all;\n}\n\n.tl-error-boundary__canvas {\n\tpointer-events: none;\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tz-index: var(--layer-error-canvas);\n}\n\n/* some browsers seem to have some weird interactions between stacking contexts\nand pointer-events. this ::after pseudo element covers the canvas and prevents\nit from receiving any pointer events or affecting the cursor. */\n.tl-error-boundary__canvas::after {\n\tcontent: ' ';\n\tdisplay: block;\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tz-index: var(--layer-error-canvas-after);\n\tpointer-events: all;\n}\n\n.tl-error-boundary__content {\n\twidth: fit-content;\n\theight: fit-content;\n\tmax-width: 100%;\n\twidth: 400px;\n\tmax-height: 100%;\n\tbackground-color: var(--color-panel);\n\tpadding: 16px;\n\tborder-radius: 16px;\n\tbox-shadow: var(--shadow-2);\n\tfont-size: 14px;\n\tfont-weight: 400;\n\tdisplay: flex;\n\tflex-direction: column;\n\toverflow: auto;\n\tz-index: var(--layer-error-content);\n\tgap: 12px;\n}\n\n.tl-error-boundary__content__expanded {\n\twidth: 600px;\n}\n\n.tl-error-boundary__content h2 {\n\tfont-size: 16px;\n\tmargin: 0px;\n\tfont-weight: 500;\n}\n\n.tl-error-boundary__content h4 {\n\tborder: 1px solid var(--color-low-border);\n\tmargin: -6px 0 0 0;\n\tpadding: var(--space-5);\n\tborder-radius: var(--radius-2);\n\tfont-weight: normal;\n}\n\n.tl-error-boundary__content p {\n\tline-height: 1.5;\n\tmargin: 0px;\n}\n\n.tl-error-boundary__content pre {\n\tbackground-color: var(--color-muted-2);\n\tmargin-top: 0;\n\tpadding: var(--space-5);\n\tborder-radius: var(--radius-2);\n\toverflow: auto;\n\tfont-size: 12px;\n\tmax-height: 320px;\n}\n\n.tl-error-boundary__content button {\n\tbackground: none;\n\tborder: none;\n\tfont-family: inherit;\n\tfont-size: 14px;\n\tfont-weight: 500;\n\tpadding: var(--space-4);\n\tborder-radius: var(--radius-3);\n\tcursor: var(--tl-cursor-pointer);\n\tcolor: inherit;\n\tbackground-color: transparent;\n}\n\n.tl-error-boundary__content a {\n\tcolor: var(--color-selected);\n\tfont-weight: 500;\n\ttext-decoration: none;\n}\n\n.tl-error-boundary__content__error {\n\tposition: relative;\n\tmargin: -6px 0 0 0;\n}\n\n.tl-error-boundary__content__error button {\n\tposition: absolute;\n\ttop: var(--space-2);\n\tright: var(--space-2);\n\tfont-size: 12px;\n\tpadding: var(--space-2) var(--space-3);\n\tbackground-color: var(--color-panel);\n\tborder-radius: var(--radius-1);\n}\n\n.tl-error-boundary__content__actions {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\tgap: var(--space-4);\n\tmargin: 0px;\n\tmargin-left: -4px;\n}\n.tl-error-boundary__content__actions__group {\n\tdisplay: flex;\n\tgap: var(--space-4);\n}\n.tl-error-boundary__content .tl-error-boundary__reset {\n\tcolor: var(--color-warn);\n}\n.tl-error-boundary__content .tl-error-boundary__refresh {\n\tbackground-color: var(--color-primary);\n\tcolor: var(--color-selected-contrast);\n}\n.tl-container__focused:not(.tl-container__no-focus-ring)\n\t.tlui-button.tl-error-boundary__refresh:focus-visible {\n\tborder-radius: 8px;\n\toutline-offset: 0;\n}\n\n/* --------------------- Coarse --------------------- */\n\n.tl-hidden {\n\topacity: 0;\n\tpointer-events: none;\n}\n\n.debug__ui-logger {\n\tposition: absolute;\n\ttop: 62px;\n\tleft: 16px;\n\tcolor: #555;\n\tfont-size: 12px;\n\tfont-family: monospace;\n}\n\n/* ---------------- Hit test blocker ---------------- */\n\n.tl-hit-test-blocker {\n\tposition: absolute;\n\tz-index: var(--layer-canvas-blocker);\n\tinset: 0px;\n\twidth: 100%;\n\theight: 100%;\n\tpointer-events: all;\n}\n\n.tl-hit-test-blocker__hidden {\n\tdisplay: none;\n}\n\n@media (hover: hover) {\n\t.tl-handle__create:hover {\n\t\topacity: 1;\n\t}\n\n\t.tl-handle__bg:hover {\n\t\tcursor: var(--tl-cursor-grab);\n\t\tfill: var(--color-selection-fill);\n\t}\n\n\t.tl-bookmark__link:hover {\n\t\tcolor: var(--color-selected);\n\t}\n\n\t.tl-hyperlink-button:hover {\n\t\tcolor: var(--color-selected);\n\t}\n\n\t.tl-error-boundary__content button:hover {\n\t\tbackground-color: var(--color-low);\n\t}\n\t.tl-error-boundary__content a:hover {\n\t\tcolor: var(--color-text-1);\n\t}\n\t.tl-error-boundary__content .tl-error-boundary__refresh:hover {\n\t\tbackground-color: var(--color-primary);\n\t\topacity: 0.9;\n\t}\n\n\t/* These three rules help preserve clicking into specific points in text areas *while*\n * already in edit mode when jumping from shape to shape. */\n\t.tl-canvas[data-iseditinganything='true'] .tl-text-wrapper:hover .tl-text-input {\n\t\tz-index: var(--layer-text-editor);\n\t\tpointer-events: all;\n\t}\n}\n\n/* @tldraw/ui */\n\n.tl-container {\n\t--layer-above: 1;\n\t--layer-focused-input: 10;\n\t--layer-menu-click-capture: 250;\n\t--layer-panels: 300;\n\t--layer-menus: 400;\n\t--layer-toasts: 650;\n\t--layer-cursor: 700;\n\t--layer-header-footer: 999;\n\t--layer-following-indicator: 1000;\n}\n\n/* -------------------------------------------------- */\n/*                     UI Refresh                     */\n/* -------------------------------------------------- */\n\n/* Button */\n\n.tlui-button {\n\tposition: relative;\n\theight: 40px;\n\tmin-width: 40px;\n\tpadding: 0px 12px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tbackground-color: transparent;\n\tborder: transparent;\n\tcolor: currentColor;\n\tcursor: pointer;\n\tpointer-events: all;\n\tfont-weight: inherit;\n\tfont-family: inherit;\n\tline-height: inherit;\n\ttext-rendering: optimizeLegibility;\n\tfont-size: 12px;\n\tgap: 0px;\n\tcolor: var(--color-text-1);\n\tz-index: 0;\n}\n\n.tlui-button:disabled {\n\tcolor: var(--color-text-3);\n\ttext-shadow: none;\n\tcursor: default;\n}\n\n.tlui-button:disabled .tlui-kbd {\n\tcolor: var(--color-text-3);\n}\n\n.tlui-button > * {\n\tposition: relative;\n\tz-index: var(--layer-above);\n}\n\n.tlui-button__label {\n\tfont-size: 12px;\n\tflex-grow: 2;\n\ttext-align: left;\n}\n\n/*\n * We only want to show the focus ring if:\n * - the container is focused\n * - we're not using the mouse to interact (which is the .tl-container__no-focus-ring)\n */\n.tl-container__focused:not(.tl-container__no-focus-ring) .tlui-button:focus-visible {\n\tborder-radius: 10px;\n\toutline: 2px solid var(--color-focus);\n\toutline-offset: -5px;\n}\n.tl-container__focused:not(.tl-container__no-focus-ring) .tlui-button__tool:focus-visible {\n\tborder-radius: 12px;\n}\n.tlui-slider__container:has(.tlui-slider__thumb:focus-visible) {\n\tborder-radius: 10px;\n\toutline: 2px solid var(--color-focus);\n\toutline-offset: -5px;\n}\n\n.tlui-button::after {\n\tdisplay: block;\n\tcontent: '';\n\tposition: absolute;\n\tinset: 4px;\n\tborder-radius: var(--radius-2);\n\tbackground: var(--color-muted-2);\n\topacity: 0;\n}\n\n.tlui-button__menu[data-highlighted]::after {\n\topacity: 1;\n}\n\n.tlui-button[data-isactive='true']::after,\n.tlui-button[data-isactive='true']:not(:disabled, :focus-visible):active:after {\n\tbackground: var(--color-hint);\n\topacity: 1;\n}\n\n.tlui-button[aria-expanded='true'][data-direction='left']:not(:hover)::after {\n\tbackground: linear-gradient(270deg, rgba(144, 144, 144, 0) 0%, var(--color-muted-2) 100%);\n\topacity: 1;\n}\n\n@media (hover: hover) {\n\t.tlui-button:not(:disabled):hover {\n\t\tz-index: 1;\n\t}\n\n\t.tlui-button:not(:disabled):hover::after {\n\t\topacity: 1;\n\t}\n}\n\n.tlui-button__icon + .tlui-button__label {\n\tmargin-left: var(--space-2);\n}\n\n/* Low button  */\n\n.tlui-button__low {\n\tborder-radius: var(--radius-3);\n\tbackground-color: var(--color-low);\n}\n\n.tlui-button__low::after {\n\tbackground-color: var(--color-muted-2);\n\topacity: 0;\n}\n\n@media (hover: hover) {\n\t.tlui-button__low:hover::after {\n\t\topacity: 1;\n\t}\n}\n\n/* Primary / danger buttons */\n\n.tlui-button__primary {\n\tcolor: var(--color-primary);\n}\n\n.tlui-button__danger {\n\tcolor: var(--color-warn);\n\ttext-shadow: none;\n}\n\n@media (hover: hover) {\n\t.tlui-button__primary:not(:disabled, :focus-visible):hover {\n\t\tcolor: var(--color-primary);\n\t}\n\n\t.tlui-button__danger:not(:disabled, :focus-visible):hover {\n\t\tcolor: var(--color-warn);\n\t\ttext-shadow: none;\n\t}\n}\n\n/* Panel button */\n\n.tlui-button__panel {\n\tposition: relative;\n}\n\n/* Menu button */\n\n.tlui-button__menu {\n\theight: 40px;\n\tmin-height: 40px;\n\twidth: 100%;\n\tgap: 8px;\n\tmargin: -4px 0px;\n}\n\n.tlui-button__menu::after {\n\tinset: 4px;\n\tborder-radius: var(--radius-2);\n}\n\n.tlui-button__menu > .tlui-icon + .tlui-button__label {\n\tmargin-left: 0px;\n}\n\n.tlui-button__menu:nth-child(1) {\n\tmargin-top: 0px;\n}\n\n.tlui-button__menu:nth-last-child(1) {\n\tmargin-bottom: 0px;\n}\n\n/* Menu checkbox button */\n\n.tlui-button__checkbox {\n\tpadding-left: 8px;\n}\n\n.tlui-button__checkbox__indicator {\n\twidth: 15px;\n\theight: 15px;\n}\n\n/* Tool lock button */\n\n.tlui-toolbar__lock-button {\n\tposition: absolute;\n\ttop: 4px;\n\tright: 0px;\n\tpointer-events: all;\n\theight: 40px;\n\twidth: 40px;\n\tmin-width: 0px;\n\tborder-radius: var(--radius-2);\n}\n\n.tlui-toolbar__lock-button::after {\n\ttop: 4px;\n\tleft: 8px;\n\tinset: 4px;\n}\n\n/* Tool button  */\n\n.tlui-button__tool {\n\tposition: relative;\n\theight: 48px;\n\twidth: 48px;\n\tmargin-left: -2px;\n\tmargin-right: -2px;\n}\n\n.tlui-button__tool:nth-of-type(1) {\n\tmargin-left: 0px;\n}\n\n.tlui-button__tool:nth-last-of-type(1) {\n\tmargin-right: 0px;\n}\n\n.tlui-button__tool::after {\n\tinset: 4px;\n\tborder-radius: 8px;\n}\n\n.tlui-button__tool[aria-pressed='true'] {\n\tcolor: var(--color-selected-contrast);\n}\n\n.tlui-button__tool[aria-pressed='true']:not(:disabled, :focus-visible):active {\n\tcolor: var(--color-selected-contrast);\n}\n\n.tlui-button__tool[aria-pressed='true']:not(:disabled)::after {\n\tbackground: var(--color-selected);\n\topacity: 1;\n}\n\n.tlui-layout__mobile .tlui-button__tool {\n\theight: 48px;\n\twidth: 43px;\n}\n\n.tlui-layout__mobile .tlui-button__tool > .tlui-icon {\n\theight: 16px;\n\twidth: 16px;\n}\n\n/* Help */\n\n.tlui-button__help {\n\theight: 32px;\n\twidth: 32px;\n\tpadding: 0px;\n\tmin-width: 32px;\n\tborder-radius: 100%;\n\tbackground-color: var(--color-low);\n\tborder: 1px solid var(--color-low-border);\n}\n\n@media (hover: hover) {\n\t.tlui-button__help::after {\n\t\tbackground-color: var(--color-muted-2);\n\t\tborder-radius: 100%;\n\t\tinset: 4px;\n\t}\n}\n\n/* Button Row */\n\n.tlui-buttons__horizontal {\n\tdisplay: flex;\n\tflex-direction: row;\n}\n.tlui-buttons__horizontal > * {\n\tmargin-left: -2px;\n\tmargin-right: -2px;\n}\n.tlui-buttons__horizontal > *:nth-child(1) {\n\tmargin-left: 0px;\n}\n.tlui-buttons__horizontal > *:nth-last-child(1) {\n\tmargin-right: 0px;\n}\n\n/* Button Grid */\n\n.tlui-buttons__grid {\n\tdisplay: grid;\n\tgrid-template-columns: repeat(4, auto);\n\tgrid-auto-flow: row;\n\toverflow: hidden;\n}\n.tlui-buttons__grid > .tlui-button {\n\tmargin: -2px;\n}\n.tlui-buttons__grid > .tlui-button:nth-of-type(4n),\n.tlui-buttons__vertical-align > .tlui-button:nth-of-type(3n) {\n\tmargin-right: 0px;\n}\n.tlui-buttons__grid > .tlui-button:nth-of-type(4n - 3) {\n\tmargin-left: 0px;\n}\n.tlui-buttons__grid > .tlui-button:nth-of-type(-n + 4) {\n\tmargin-top: 0px;\n}\n.tlui-buttons__grid > .tlui-button:nth-last-of-type(-n + 4) {\n\tmargin-bottom: 0px;\n}\n\n/* Zoom button */\n\n.tlui-zoom-menu__button {\n\twidth: 60px;\n\tmin-width: 60px;\n\ttext-align: center;\n}\n\n.tlui-zoom-menu__button__pct {\n\twidth: 60px;\n\tmin-width: 60px;\n\ttext-align: center;\n}\n\n/* --------------------- Layout --------------------- */\n\n.tlui-layout {\n\tposition: relative;\n\tdisplay: grid;\n\tgrid-template-columns: 1fr;\n\tgrid-template-rows: minmax(0px, 1fr) auto;\n\tgrid-auto-rows: auto;\n\theight: 100%;\n\tmax-height: 100%;\n\toverflow: clip;\n\tpointer-events: none;\n\tuser-select: none;\n\tcontain: strict;\n\tz-index: var(--layer-panels);\n\ttransform: translate3d(0, 0, 0);\n\t--sab: env(safe-area-inset-bottom);\n\tfont-weight: 500;\n\tline-height: 1.6;\n\t-webkit-font-smoothing: antialiased;\n\t-moz-osx-font-smoothing: grayscale;\n\tfont-smooth: antialiased;\n\ttext-rendering: optimizeLegibility;\n}\n\n.tlui-layout__top {\n\tgrid-column: 1;\n\tgrid-row: 1;\n\tdisplay: flex;\n\tmin-width: 0px;\n\tjustify-content: space-between;\n}\n\n.tlui-layout__top__left {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: flex-start;\n\tjustify-content: flex-start;\n\twidth: 100%;\n\theight: 100%;\n\tflex: 0 1 0;\n}\n\n.tlui-layout__top__right {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: flex-end;\n\tjustify-content: flex-start;\n\theight: 100%;\n\tflex: 0 0 auto;\n\tmin-width: 0px;\n}\n\n.scrollable,\n.scrollable * {\n\tpointer-events: all;\n\ttouch-action: auto;\n\toverscroll-behavior: none;\n}\n\n/* ----------------- Helper Buttons ---------------- */\n\n.tlui-helper-buttons {\n\tposition: relative;\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: flex-start;\n\talign-items: flex-start;\n\twidth: min-content;\n\tgap: var(--space-3);\n\tmargin: var(--space-2) var(--space-3);\n\twhite-space: nowrap;\n\tpointer-events: none;\n\tz-index: var(--layer-panels);\n}\n\n/* ---------------------- Icon ---------------------- */\n\n.tlui-icon {\n\tflex-shrink: 0;\n\twidth: 18px;\n\theight: 18px;\n\tbackground-color: currentColor;\n}\n\n.tlui-icon__placeholder {\n\tflex-shrink: 0;\n\twidth: 18px;\n\theight: 18px;\n\tbackground-color: transparent;\n}\n\n.tlui-icon__small {\n\twidth: 15px;\n\theight: 15px;\n}\n\n/* --------------------- Slider --------------------- */\n\n.tlui-slider__container {\n\twidth: 100%;\n\tpadding: 0px var(--space-4);\n}\n\n.tlui-slider {\n\tposition: relative;\n\tdisplay: flex;\n\talign-items: center;\n\tuser-select: none;\n\ttouch-action: none;\n\twidth: 100%;\n}\n\n.tlui-slider__track {\n\tposition: relative;\n\tflex-grow: 1;\n\theight: 44px;\n\tcursor: pointer;\n}\n\n.tlui-slider__track::after {\n\tdisplay: block;\n\tposition: absolute;\n\ttop: calc(50% - 2px);\n\tcontent: '';\n\theight: 3px;\n\twidth: 100%;\n\tbackground-color: var(--color-muted-1);\n\tborder-radius: 14px;\n}\n\n.tlui-slider__range {\n\tposition: absolute;\n\ttop: calc(50% - 2px);\n\tleft: 0px;\n\theight: 3px;\n\tbackground-color: var(--color-selected);\n\tborder-radius: 14px;\n}\n\n.tlui-slider__thumb {\n\tall: unset;\n\tcursor: grab;\n\tdisplay: block;\n\twidth: 18px;\n\theight: 18px;\n\tposition: relative;\n\ttop: -1px;\n\tbackground-color: var(--color-panel);\n\tborder-radius: 999px;\n\tbox-shadow: inset 0px 0px 0px 2px var(--color-text-1);\n}\n\n.tlui-slider__thumb:active {\n\tcursor: grabbing;\n\tbox-shadow:\n\t\tinset 0px 0px 0px 2px var(--color-text-1),\n\t\tvar(--shadow-1);\n}\n\n/* ----------------------- Kbd ---------------------- */\n\n.tlui-kbd {\n\tfont-family: inherit;\n\tfont-size: 11px;\n\tline-height: 11px;\n\tdisplay: grid;\n\tjustify-items: center;\n\tgrid-auto-flow: column;\n\tgrid-template-columns: auto;\n\tgrid-auto-columns: minmax(1em, auto);\n\talign-self: bottom;\n\tcolor: currentColor;\n\tmargin-left: var(--space-4);\n}\n\n.tlui-kbd > span {\n\twidth: 100%;\n\ttext-align: center;\n\tdisplay: inline;\n\tmargin: 0px;\n\tpadding: 2px;\n\tborder-radius: 2px;\n}\n\n.tlui-kbd > span:last-child {\n\tpadding-right: 0;\n}\n\n.tlui-kbd:not(:last-child) {\n\tmargin-right: var(--space-2);\n}\n\n/* Focus Mode Button */\n\n.tlui-focus-button {\n\tz-index: var(--layer-panels);\n\tpointer-events: all;\n}\n\n/* --------------------- Popover -------------------- */\n\n.tlui-popover {\n\tposition: relative;\n\tdisplay: flex;\n\talign-content: stretch;\n}\n\n.tlui-popover__content {\n\tposition: relative;\n\tmax-height: calc(var(--radix-popover-content-available-height) - 8px);\n\tmargin: 0px;\n\tborder: none;\n\tborder-radius: var(--radius-3);\n\tbackground-color: var(--color-panel);\n\tbox-shadow: var(--shadow-3);\n\tz-index: var(--layer-menus);\n\toverflow: hidden;\n\toverflow-y: auto;\n\ttouch-action: auto;\n\toverscroll-behavior: none;\n\tscrollbar-width: none;\n\t-ms-overflow-style: none;\n}\n\n/* -------------------------------------------------- */\n/*                        Zones                       */\n/* -------------------------------------------------- */\n\n/* ------------------- Status Bar ------------------- */\n\n.tlui-debug-panel {\n\tbackground-color: var(--color-low);\n\twidth: 100%;\n\tdisplay: grid;\n\talign-items: center;\n\tgrid-template-columns: 1fr auto auto auto;\n\tjustify-content: space-between;\n\tpadding-left: var(--space-4);\n\tborder-top: 1px solid var(--color-background);\n\tfont-size: 12px;\n\tcolor: var(--color-text-1);\n\tz-index: var(--layer-panels);\n\tpointer-events: all;\n}\n\n.tlui-debug-panel__current-state {\n\toverflow: hidden;\n\twhite-space: nowrap;\n\ttext-overflow: ellipsis;\n}\n\n.tlui-debug-panel__fps {\n\tmargin-right: 8px;\n}\n\n.tlui-debug-panel__fps__slow {\n\tfont-weight: bold;\n\tcolor: var(--color-warn);\n}\n\n.tlui-a11y-audit {\n\tborder-collapse: collapse;\n}\n\n.tlui-a11y-audit th,\n.tlui-a11y-audit td {\n\tpadding: 8px;\n\tborder: 1px solid var(--color-low-border);\n}\n\n/* -------------------- Menu Zone ------------------- */\n\n.tlui-menu-zone {\n\tposition: relative;\n\tz-index: var(--layer-panels);\n\twidth: fit-content;\n\tborder-right: 2px solid var(--color-background);\n\tborder-bottom: 2px solid var(--color-background);\n\tborder-bottom-right-radius: var(--radius-4);\n\tbackground-color: var(--color-low);\n}\n\n.tlui-menu-zone *[data-state='open']:not(:hover)::after {\n\tbackground: linear-gradient(180deg, rgba(144, 144, 144, 0) 0%, var(--color-muted-2) 100%);\n\topacity: 1;\n}\n\n/* ------------------- Style Panel ------------------ */\n\n.tlui-style-panel__wrapper {\n\tbox-shadow: var(--shadow-2);\n\tborder-radius: var(--radius-3);\n\tpointer-events: all;\n\tbackground-color: var(--color-panel);\n\theight: fit-content;\n\tmax-height: 100%;\n\tmargin: 8px;\n\tmargin-top: 4px;\n\ttouch-action: auto;\n\toverscroll-behavior: none;\n\toverflow-y: auto;\n\toverflow-x: hidden;\n\tcolor: var(--color-text);\n}\n/* if the style panel is the only child (ie no share menu), increase the margin */\n.tlui-style-panel__wrapper:only-child {\n\tmargin-top: 8px;\n}\n\n.tlui-style-panel {\n\tposition: relative;\n\tz-index: var(--layer-panels);\n\tpointer-events: all;\n\twidth: 148px;\n\tmax-width: 148px;\n}\n\n.tlui-style-panel::-webkit-scrollbar {\n\tdisplay: none;\n}\n\n.tlui-style-panel .tlui-button.select {\n\twidth: 100%;\n}\n\n.tlui-style-panel__section {\n\tdisplay: flex;\n\tposition: relative;\n\tflex-direction: column;\n}\n\n.tlui-style-panel__section:nth-of-type(n + 2):not(:last-child) {\n\tborder-bottom: 1px solid var(--color-divider);\n}\n\n.tlui-style-panel__section:empty {\n\tdisplay: none;\n}\n\n.tlui-style-panel__section__common:not(:only-child) {\n\tmargin-bottom: 7px;\n\tborder-bottom: 1px solid var(--color-divider);\n}\n\n.tlui-style-panel__row {\n\tdisplay: flex;\n}\n/* Only really used for the alignment picker */\n.tlui-style-panel__row__extra-button {\n\tmargin-left: -2px;\n}\n\n.tlui-style-panel__double-select-picker {\n\tdisplay: flex;\n\tgrid-template-columns: 1fr auto;\n\talign-items: center;\n\tpadding-left: var(--space-4);\n\tcolor: var(--color-text-1);\n\tfont-size: 12px;\n}\n\n.tlui-style-panel__double-select-picker-label {\n\ttext-overflow: ellipsis;\n\toverflow: hidden;\n\twhite-space: nowrap;\n\tflex-grow: 2;\n\tmax-width: 100%;\n}\n\n.tlui-style-panel .tlui-button[data-state='open']:not(:hover)::after {\n\topacity: 1;\n\tbackground: linear-gradient(270deg, rgba(144, 144, 144, 0) 0%, var(--color-muted-2) 100%);\n}\n\n/* ---------------------- Input --------------------- */\n\n.tlui-input {\n\tbackground: none;\n\tmargin: 0px;\n\tposition: relative;\n\tz-index: var(--layer-above);\n\theight: 40px;\n\tmax-height: 40px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-family: inherit;\n\tfont-size: 12px;\n\tfont-weight: inherit;\n\tcolor: var(--color-text-1);\n\tpadding: var(--space-4);\n\tpadding-left: 0px;\n\tborder: none;\n\toutline: none;\n\ttext-overflow: ellipsis;\n\twidth: 100%;\n\tuser-select: all;\n\ttext-rendering: optimizeLegibility;\n\t-webkit-user-select: auto !important;\n}\n\n.tlui-input__wrapper {\n\twidth: 100%;\n\theight: 44px;\n\tdisplay: flex;\n\talign-items: center;\n\tgap: var(--space-4);\n\tcolor: var(--color-text);\n}\n\n.tlui-input__wrapper > .tlui-icon {\n\tflex-shrink: 0;\n}\n\n/* If mobile use 16px as font size */\n/* On iOS, font size under 16px in an input will make the page zoom into the input ð¤¦ââï¸ */\n/* https://css-tricks.com/16px-or-larger-text-prevents-ios-form-zoom/ */\n@media (max-width: 600px) {\n\t@supports (-webkit-touch-callout: none) {\n\t\t/* CSS specific to iOS devices */\n\t\t.tlui-input {\n\t\t\tfont-size: 16px;\n\t\t}\n\t}\n}\n\n/* ---------------- Dialog ---------------- */\n\n.tlui-dialog__overlay {\n\tposition: absolute;\n\ttop: 0px;\n\tleft: 0px;\n\twidth: 100%;\n\theight: 100%;\n\tz-index: var(--layer-canvas-overlays);\n\tbackground-color: var(--color-overlay);\n\tpointer-events: all;\n\tanimation: fadeIn 0.12s ease-out;\n\tdisplay: grid;\n\tplace-items: center;\n\toverflow-y: auto;\n\tpadding: 0px var(--space-3);\n}\n\n.tlui-dialog__content {\n\tdisplay: flex;\n\tflex-direction: column;\n\tposition: relative;\n\tcursor: default;\n\tbackground-color: var(--color-panel);\n\tbox-shadow: var(--shadow-3);\n\tborder-radius: var(--radius-3);\n\tfont-size: 12px;\n\toverflow: hidden;\n\tmin-width: 300px;\n\tmax-width: 100%;\n\tmax-height: 80%;\n}\n\n.tlui-dialog__header {\n\tposition: relative;\n\tdisplay: flex;\n\talign-items: center;\n\tflex: 0;\n\tz-index: var(--layer-header-footer);\n\tpadding-left: var(--space-4);\n\tcolor: var(--color-text);\n\theight: 40px;\n}\n\n.tlui-dialog__header__title {\n\tflex: 1;\n\tfont-weight: inherit;\n\tfont-size: 12px;\n\tmargin: 0px;\n\tcolor: var(--color-text-1);\n}\n\n.tlui-dialog__header__close {\n\tjustify-self: flex-end;\n}\n\n.tlui-dialog__body {\n\tpadding: var(--space-4) var(--space-4);\n\tflex: 0 1;\n\toverflow-y: auto;\n\toverflow-x: hidden;\n\tcolor: var(--color-text-1);\n\tuser-select: all;\n\t-webkit-user-select: text;\n}\n.tlui-dialog__body a {\n\tcolor: var(--color-selected);\n}\n\n.tlui-dialog__body ul,\n.tlui-dialog__body ol {\n\tpadding-left: 16px;\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: var(--space-4);\n}\n\n.tlui-dialog__footer {\n\tposition: relative;\n\tmin-height: 12px;\n\tz-index: var(--layer-header-footer);\n}\n\n.tlui-dialog__footer__actions {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: flex-end;\n}\n\n.tlui-dialog__footer__actions > .tlui-button:nth-last-child(n + 2) {\n\tmargin-right: -4px;\n}\n\n/* --------------------- Toolbar -------------------- */\n\n/* Wide container */\n.tlui-toolbar {\n\tgrid-column: 1 / span 3;\n\tgrid-row: 1;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tflex-grow: 2;\n\tpadding-bottom: calc(var(--space-3) + var(--sab));\n}\n\n/* Centered Content */\n.tlui-toolbar__inner {\n\tposition: relative;\n\twidth: fit-content;\n\tdisplay: flex;\n\tgap: var(--space-3);\n\talign-items: flex-end;\n}\n\n.tlui-toolbar__left {\n\twidth: fit-content;\n}\n\n/* Row of controls + lock button */\n.tlui-toolbar__extras {\n\tposition: relative;\n\tz-index: var(--layer-above);\n\twidth: 100%;\n\tpointer-events: none;\n\ttop: 6px;\n\theight: 48px;\n}\n\n.tlui-toolbar__extras:empty {\n\tdisplay: none;\n}\n\n.tlui-toolbar__extras__controls {\n\tdisplay: flex;\n\tposition: relative;\n\tflex-direction: row;\n\tz-index: var(--layer-above);\n\tbackground-color: var(--color-low);\n\tborder-top-left-radius: var(--radius-4);\n\tborder-top-right-radius: var(--radius-4);\n\tborder: 2px solid var(--color-background);\n\tmargin-left: 8px;\n\tmargin-right: 0px;\n\tpointer-events: all;\n\twidth: fit-content;\n}\n\n.tlui-toolbar__tools {\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n\tborder-radius: var(--radius-4);\n\tz-index: var(--layer-panels);\n\tpointer-events: all;\n\tposition: relative;\n\tbackground: var(--color-panel);\n\tbox-shadow: var(--shadow-2);\n}\n.tlui-toolbar__tools__list {\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n}\n\n.tlui-toolbar__overflow {\n\twidth: 40px;\n}\n\n.tlui-layout__mobile .tlui-toolbar__overflow {\n\twidth: 32px;\n\tpadding: 0px;\n}\n\n.tlui-toolbar *[data-state='open']:not(:hover)::after {\n\tbackground: linear-gradient(0deg, rgba(144, 144, 144, 0) 0%, var(--color-muted-2) 100%);\n}\n\n.tlui-layout__mobile .tlui-toolbar {\n\ttransition: transform 0.15s ease-out 0.05s;\n}\n\n/* -------------------- Help Zone ------------------- */\n\n.tlui-help-menu {\n\tpointer-events: all;\n\tposition: absolute;\n\tbottom: var(--space-2);\n\tright: var(--space-2);\n\tz-index: var(--layer-panels);\n\tborder: 2px solid var(--color-background);\n\tborder-radius: 100%;\n}\n\n/* ------------------ Context Menu ------------------ */\n\n.tlui-context-menu__move-to-page__name {\n\tmax-width: calc(min(300px, 35vw));\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n}\n\n.tlui-context-menu__move-to-page__name[data-disabled] {\n\tcolor: var(--color-text-3);\n\tpointer-events: none;\n}\n\n/* ---------------------- Menu ---------------------- */\n\n.tlui-menu:empty {\n\tdisplay: none;\n}\n\n.tlui-menu {\n\tz-index: var(--layer-menus);\n\theight: fit-content;\n\twidth: fit-content;\n\tborder-radius: var(--radius-3);\n\tpointer-events: all;\n\ttouch-action: auto;\n\toverflow-y: auto;\n\toverscroll-behavior: none;\n\tbackground-color: var(--color-panel);\n\tbox-shadow: var(--shadow-3);\n}\n\n.tlui-menu::-webkit-scrollbar {\n\tdisplay: none;\n}\n\n.tlui-menu__arrow {\n\tposition: relative;\n\ttop: -1px;\n\tfill: var(--color-panel);\n\tstroke: var(--color-panel-contrast);\n\tstroke-width: 1px;\n}\n\n.tlui-menu__group {\n\twidth: 100%;\n}\n\n.tlui-menu__group:empty {\n\tdisplay: none;\n}\n\n.tlui-menu__group {\n\tborder-bottom: 1px solid var(--color-divider);\n}\n.tlui-menu__group:nth-last-of-type(1) {\n\tborder-bottom: none;\n}\n\n.tlui-menu__submenu__trigger[data-state='open']:not(:hover)::after {\n\topacity: 1;\n\tbackground: linear-gradient(90deg, rgba(144, 144, 144, 0) 0%, var(--color-muted-2) 100%);\n}\n\n.tlui-menu__submenu__trigger[data-direction='left'][data-state='open']:not(:hover)::after {\n\topacity: 1;\n\tbackground: linear-gradient(270deg, rgba(144, 144, 144, 0) 0%, var(--color-muted-2) 100%);\n}\n\n/* Menu Sizes */\n\n.tlui-menu[data-size='large'] > .tlui-menu__group {\n\tmin-width: initial;\n}\n\n.tlui-menu[data-size='medium'] > .tlui-menu__group {\n\tmin-width: 144px;\n}\n\n.tlui-menu[data-size='small'] > .tlui-menu__group {\n\tmin-width: 96px;\n}\n\n.tlui-menu[data-size='tiny'] > .tlui-menu__group {\n\tmin-width: 0px;\n}\n\n/* ------------------ Language menu ----------------- */\n\n.tlui-language-menu {\n\tmax-height: 500px;\n}\n\n.tlui-language-menu::after {\n\tcontent: '';\n\tdisplay: block;\n\tposition: absolute;\n\tbottom: 0px;\n\tleft: 0px;\n\tright: 0px;\n\theight: 24px;\n\tbackground: linear-gradient(\n\t\tto bottom,\n\t\tvar(--color-panel-transparent) 0%,\n\t\tvar(--color-panel) 90%,\n\t\tvar(--color-panel) 100%\n\t);\n\tborder-bottom-left-radius: var(--radius-3);\n\tborder-bottom-right-radius: var(--radius-3);\n\tpointer-events: none;\n}\n\n/* ------------------ Actions Menu ------------------ */\n\n.tlui-actions-menu {\n\tmax-height: calc(100vh - 150px);\n}\n\n/* --------------------- Toasts --------------------- */\n\n.tlui-toast__viewport {\n\tposition: absolute;\n\tinset: 0px;\n\tmargin: 0px;\n\tdisplay: flex;\n\talign-items: flex-end;\n\tjustify-content: flex-end;\n\tflex-direction: column;\n\tgap: var(--space-3);\n\tpointer-events: none;\n\tpadding: 0px var(--space-3) 64px 0px;\n\tz-index: var(--layer-toasts);\n}\n\n.tlui-toast__viewport > * {\n\tpointer-events: all;\n}\n\n.tlui-toast__icon {\n\tpadding-top: 11px;\n\tpadding-left: var(--space-4);\n\tcolor: var(--color-text-1);\n}\n\n.tlui-toast__container {\n\tmin-width: 200px;\n\tdisplay: flex;\n\tflex-direction: row;\n\tbackground-color: var(--color-panel);\n\tbox-shadow: var(--shadow-2);\n\tborder-radius: var(--radius-3);\n\tfont-size: 12px;\n}\n\n.tlui-toast__container[data-severity='success'] .tlui-icon {\n\tcolor: var(--color-success);\n}\n\n.tlui-toast__container[data-severity='info'] .tlui-icon {\n\tcolor: var(--color-info);\n}\n\n.tlui-toast__container[data-severity='warning'] .tlui-icon {\n\tcolor: var(--color-warning);\n}\n\n.tlui-toast__container[data-severity='error'] .tlui-icon {\n\tcolor: var(--color-error);\n}\n\n.tlui-toast__main {\n\tflex-grow: 2;\n\tmax-width: 280px;\n}\n\n.tlui-toast__content {\n\tpadding: var(--space-4);\n\tdisplay: flex;\n\tline-height: 1.4;\n\tflex-direction: column;\n\tgap: var(--space-3);\n}\n\n.tlui-toast__main[data-actions='true'] .tlui-toast__content {\n\tpadding-bottom: var(--space-2);\n}\n\n.tlui-toast__title {\n\tfont-weight: bold;\n\tcolor: var(--color-text-1);\n\t/* this makes the default toast look better */\n\tline-height: 16px;\n}\n\n.tlui-toast__description {\n\tcolor: var(--color-text-1);\n\tpadding: var(--space-3);\n\tmargin: 0px;\n\tpadding: 0px;\n}\n\n.tlui-toast__icon + .tlui-toast__main > .tlui-toast__actions {\n\tpadding-left: 0px;\n}\n\n.tlui-toast__actions {\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: flex-start;\n\tmargin-left: 0;\n}\n\n.tlui-toast__close {\n\talign-self: flex-end;\n\tflex-shrink: 0;\n}\n\n@media (prefers-reduced-motion: no-preference) {\n\t.tlui-toast__container[data-state='open'] {\n\t\tanimation: slide-in 200ms cubic-bezier(0.785, 0.135, 0.15, 0.86);\n\t}\n\n\t.tlui-toast__container[data-state='closed'] {\n\t\tanimation: hide 100ms ease-in;\n\t}\n\n\t.tlui-toast__container[data-swipe='move'] {\n\t\ttransform: translateX(var(--radix-toast-swipe-move-x));\n\t}\n\n\t.tlui-toast__container[data-swipe='cancel'] {\n\t\ttransform: translateX(0);\n\t\ttransition: transform 200ms ease-out;\n\t}\n\n\t.tlui-toast__container[data-swipe='end'] {\n\t\tanimation: swipe-out 100ms ease-out;\n\t}\n}\n\n/* --------------------- Bottom --------------------- */\n\n.tlui-layout__bottom {\n\tgrid-row: 2;\n}\n\n.tlui-layout__bottom__main {\n\twidth: 100%;\n\tposition: relative;\n\tdisplay: flex;\n\talign-items: flex-end;\n\tjustify-content: center;\n}\n\n/* ------------------- Navigation ------------------- */\n\n.tlui-navigation-panel {\n\tdisplay: flex;\n\twidth: min-content;\n\tflex-direction: column;\n\tz-index: var(--layer-panels);\n\tpointer-events: all;\n\tposition: absolute;\n\tleft: 0px;\n\tbottom: 0px;\n}\n\n.tlui-navigation-panel::before {\n\tcontent: '';\n\tdisplay: block;\n\tposition: absolute;\n\tz-index: -1;\n\tinset: -2px -2px 0px 0px;\n\tborder-radius: 0;\n\tborder-top: 2px solid var(--color-background);\n\tborder-right: 2px solid var(--color-background);\n\tborder-top-right-radius: var(--radius-4);\n\tbackground-color: var(--color-low);\n}\n\n.tlui-navigation-panel__toggle .tlui-icon {\n\topacity: 0.24;\n}\n\n.tlui-navigation-panel__toggle:active .tlui-icon {\n\topacity: 1;\n}\n\n@media (hover: hover) {\n\t.tlui-navigation-panel__toggle:hover .tlui-icon {\n\t\topacity: 1;\n\t}\n}\n\n.tlui-minimap {\n\twidth: 100%;\n\theight: 96px;\n\tmin-height: 96px;\n\toverflow: hidden;\n\tpadding: var(--space-3);\n\tpadding-top: 0px;\n}\n\n.tlui-minimap__canvas {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n}\n\n/* ----------------------- ... ---------------------- */\n\n@keyframes hide {\n\t0% {\n\t\topacity: 1;\n\t}\n\t100% {\n\t\topacity: 0;\n\t}\n}\n\n@keyframes slide-in {\n\tfrom {\n\t\ttransform: translateX(calc(100% + var(--space-3)));\n\t}\n\tto {\n\t\ttransform: translateX(0px);\n\t}\n}\n\n@keyframes swipe-out {\n\tfrom {\n\t\ttransform: translateX(var(--radix-toast-swipe-end-x));\n\t}\n\tto {\n\t\ttransform: translateX(calc(100% + var(--space-3)));\n\t}\n}\n\n/* ------------------- Page Select ------------------ */\n\n.tlui-page-menu__wrapper {\n\tposition: relative;\n\tdisplay: flex;\n\tflex-direction: column;\n\twidth: 260px;\n\theight: fit-content;\n\tmax-height: 50vh;\n}\n\n.tlui-page-menu__trigger {\n\twidth: 128px;\n}\n\n.tlui-page-menu__header {\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n\twidth: 100%;\n\theight: 40px;\n\tpadding-left: var(--space-4);\n\tborder-bottom: 1px solid var(--color-divider);\n}\n\n.tlui-page-menu__header > .tlui-button:nth-of-type(1) {\n\tmargin-right: -4px;\n}\n\n.tlui-page-menu__header__title {\n\tcolor: var(--color-text);\n\tfont-size: 12px;\n\tflex-grow: 2;\n}\n\n.tlui-page-menu__name {\n\tflex-grow: 2;\n\ttext-align: left;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n}\n\n.tlui-page-menu__list {\n\tposition: relative;\n\ttouch-action: auto;\n\tflex-direction: column;\n\tmax-height: 100%;\n\toverflow-x: hidden;\n\toverflow-y: auto;\n\ttouch-action: auto;\n}\n\n.tlui-page-menu__item {\n\tposition: relative;\n}\n\n.tlui-page_menu__item__submenu[data-isediting='true'] > .tlui-button[data-state='open'] {\n\topacity: 1;\n}\n\n@media (hover: hover) {\n\t.tlui-page-menu__item:hover > .tlui-page_menu__item__submenu > .tlui-button {\n\t\topacity: 1;\n\t}\n}\n\n.tlui-page-menu__item:nth-of-type(n + 2) {\n\tmargin-top: -4px;\n}\n\n.tlui-page-menu__item__button {\n\twidth: 100%;\n}\n\n.tlui-page-menu__item__button:not(:only-child) {\n\tflex-grow: 2;\n\tmargin-right: -2px;\n}\n\n.tlui-page-menu__item__button > span {\n\tdisplay: block;\n\tflex-grow: 2;\n\ttext-align: left;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n}\n\n.tlui-page-menu__item__button__checkbox {\n\tpadding-left: 35px;\n}\n\n.tlui-page-menu__item__button__check {\n\tposition: absolute;\n\tleft: 0px;\n\twidth: 24px;\n\tpadding-left: 10px;\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\tcolor: var(--color-text);\n}\n\n.tlui-page_menu__item__sortable {\n\tposition: absolute;\n\ttop: 0px;\n\tleft: 0px;\n\twidth: 100%;\n\theight: fit-content;\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n\toverflow: hidden;\n\tz-index: var(--layer-above);\n}\n\n.tlui-page_menu__item__sortable__title {\n\tflex: 1;\n}\n\n.tlui-page_menu__item__sortable__title > .tlui-input__wrapper {\n\theight: 100%;\n}\n\n.tlui-page_menu__item__sortable:focus-visible {\n\tz-index: var(--layer-focused-input);\n}\n\n.tlui-page_menu__item__sortable__handle {\n\ttouch-action: none;\n\twidth: 32px;\n\tmin-width: 0px;\n\theight: 40px;\n\tcursor: grab;\n\tcolor: var(--color-text-3);\n\tflex-shrink: 0;\n\tmargin-right: -9px;\n}\n\n.tlui-page_menu__item__sortable__handle:active {\n\tcursor: grabbing;\n}\n\n.tlui-page-menu__item__input {\n\tmargin-left: 12px;\n\theight: 100%;\n}\n\n/* The more menu has complex CSS here: */\n/* If the user can hover, then visible but opacity zero until hover */\n/* If the user cannot hover, then not displayed unless editing, and then opacity 1 */\n\n.tlui-page_menu__item__submenu {\n\tpointer-events: all;\n\tposition: absolute;\n\tright: 0px;\n\ttop: 0px;\n\theight: 100%;\n\tcursor: pointer;\n\tmargin: 0px;\n\tmargin-left: -2px;\n\tz-index: 10;\n}\n\n.tlui-page_menu__item__submenu > .tlui-button {\n\topacity: 0;\n}\n\n.tlui-page_menu__item__sortable:focus-visible > .tlui-page_menu__item__submenu > .tlui-button,\n.tlui-page_menu__item__submenu[data-isediting='true'],\n.tlui-page_menu__item__submenu > .tlui-button[data-state='open'],\n.tlui-page_menu__item__submenu > .tlui-button:focus-visible {\n\topacity: 1;\n}\n\n.tlui-page_menu__item__submenu > .tlui-button[data-state='open']:not(:hover)::after {\n\tbackground: linear-gradient(90deg, rgba(144, 144, 144, 0) 0%, var(--color-muted-2) 100%);\n}\n\n@media (any-pointer: coarse) {\n\t.tlui-page_menu__item__submenu > .tlui-button {\n\t\topacity: 1;\n\t}\n}\n\n.tlui-button__icon {\n\tpadding: 0px;\n}\n\n.tlui-page-menu__item__button .tlui-button__icon {\n\tmargin-right: 4px;\n}\n\n@media (hover: hover) {\n\t.tlui-page_menu__item__submenu[data-isediting='true'] > .tlui-button {\n\t\topacity: 0;\n\t}\n\n\t.tlui-page_menu__item__submenu:hover > .tlui-button {\n\t\topacity: 1;\n\t}\n}\n\n/* --------------------- Dialogs -------------------- */\n\n/* Edit Link Dialog */\n\n.tlui-edit-link-dialog {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: var(--space-4);\n\tcolor: var(--color-text);\n}\n\n.tlui-edit-link-dialog__input {\n\tbackground-color: var(--color-muted-2);\n\tflex-grow: 2;\n\tborder-radius: var(--radius-2);\n\tpadding: 0px var(--space-4);\n}\n\n/* Embed Dialog */\n\n.tlui-embed__spacer {\n\tflex-grow: 2;\n\tmin-height: 0px;\n\tmargin-left: calc(-1 * var(--space-4));\n\tmargin-top: calc(-1 * var(--space-4));\n\tpointer-events: none;\n}\n\n.tlui-embed-dialog__list {\n\tdisplay: flex;\n\tflex-direction: column;\n\tpadding-bottom: var(--space-5);\n}\n\n.tlui-embed-dialog__item__image {\n\twidth: 24px;\n\theight: 24px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tbackground-size: contain;\n\tbackground-repeat: no-repeat;\n\tbackground-position: center center;\n}\n\n.tlui-embed-dialog__enter {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: var(--space-4);\n\tcolor: var(--color-text-1);\n}\n\n.tlui-embed-dialog__input {\n\tbackground-color: var(--color-muted-2);\n\tflex-grow: 2;\n\tborder-radius: var(--radius-2);\n\tpadding: 0px var(--space-4);\n}\n\n.tlui-embed-dialog__warning {\n\tcolor: var(--color-warn);\n\ttext-shadow: none;\n}\n\n.tlui-embed-dialog__instruction__link {\n\tdisplay: flex;\n\tgap: var(--space-1);\n\tmargin-top: var(--space-4);\n}\n\n.tlui-embed-dialog__enter a {\n\tcolor: var(--color-text-1);\n}\n\n.tlui-following-indicator {\n\tdisplay: block;\n\tposition: absolute;\n\tinset: 0px;\n\tborder-width: 2px;\n\tborder-style: solid;\n\tz-index: var(--layer-following-indicator);\n\tpointer-events: none;\n}\n\n/* ---------------- Offline Indicator --------------- */\n\n.tlui-offline-indicator {\n\tdisplay: flex;\n\tflex-direction: row;\n\tgap: var(--space-3);\n\tcolor: var(--color-text);\n\tbackground-color: var(--color-low);\n\tborder: 3px solid var(--color-background);\n\tpadding: 0px var(--space-5);\n\theight: 42px;\n\talign-items: center;\n\tjustify-content: center;\n\tborder-radius: 99px;\n\topacity: 0;\n\tanimation: fade-in;\n\tanimation-duration: 0.12s;\n\tanimation-delay: 2s;\n\tanimation-fill-mode: forwards;\n}\n\n/* --------------- Keyboard shortcuts --------------- */\n\n.tlui-shortcuts-dialog__header {\n\tborder-bottom: 1px solid var(--color-divider);\n}\n\n.tlui-shortcuts-dialog__body {\n\tposition: relative;\n\tcolumns: 3;\n\tcolumn-gap: var(--space-9);\n\tpointer-events: all;\n\ttouch-action: auto;\n\n\t/* Terrible fix to allow firefox users to scroll the dialog */\n\toverflow-x: auto;\n}\n\n.tlui-shortcuts-dialog__body__tablet {\n\tcolumns: 2;\n}\n\n.tlui-shortcuts-dialog__body__mobile {\n\tcolumns: 1;\n}\n\n.tlui-shortcuts-dialog__group {\n\tbreak-inside: avoid-column;\n\tpadding-bottom: var(--space-6);\n}\n\n.tlui-shortcuts-dialog__group__title {\n\tfont-size: inherit;\n\tfont-weight: inherit;\n\tmargin: 0px;\n\tcolor: var(--color-text-3);\n\theight: 32px;\n\tdisplay: flex;\n\talign-items: center;\n}\n\n.tlui-shortcuts-dialog__group__content {\n\tdisplay: flex;\n\tflex-direction: column;\n\tcolor: var(--color-text-1);\n}\n\n.tlui-shortcuts-dialog__key-pair {\n\tdisplay: flex;\n\tgap: var(--space-4);\n\talign-items: center;\n\tjustify-content: space-between;\n\theight: 32px;\n}\n\n.tlui-shortcuts-dialog__key-pair__key {\n\tflex: 1;\n\tfont-size: 12px;\n}\n\n/* ------------------- Da share zone ------------------ */\n.tlui-share-zone {\n\tpadding: 0px 0px 0px 0px;\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: flex-end;\n\tz-index: var(--layer-panels);\n\talign-items: center;\n\tpadding-top: 2px;\n\tpadding-right: 4px;\n}\n\n/* ------------------- People Menu ------------------- */\n\n.tlui-people-menu__avatars-button {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: flex-end;\n\tbackground: none;\n\tborder: none;\n\tcursor: pointer;\n\tpointer-events: all;\n\tborder-radius: var(--radius-1);\n\tpadding-right: 1px;\n\theight: 100%;\n}\n\n.tlui-people-menu__avatars {\n\tdisplay: flex;\n\tflex-direction: row;\n}\n\n.tlui-people-menu__avatar {\n\theight: 24px;\n\twidth: 24px;\n\tborder: 2px solid var(--color-background);\n\tbackground-color: var(--color-low);\n\tborder-radius: 100%;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tposition: relative;\n\tfont-size: 10px;\n\tfont-weight: bold;\n\tcolor: var(--color-selected-contrast);\n\tz-index: 2;\n}\n\n.tlui-people-menu__avatar:nth-of-type(n + 2) {\n\tmargin-left: -12px;\n}\n\n.tlui-people-menu__avatars-button[data-state='open'] {\n\topacity: 1;\n}\n\n@media (hover: hover) {\n\t.tlui-people-menu__avatars-button:hover .tlui-people-menu__avatar {\n\t\tborder-color: var(--color-low);\n\t}\n}\n\n.tlui-people-menu__more {\n\tposition: absolute;\n\ttop: 0px;\n\tright: 0px;\n\tmin-width: 0px;\n\tfont-size: 11px;\n\tfont-weight: 600;\n\tcolor: var(--color-text-1);\n\tfont-family: inherit;\n\tpadding: 0px 4px;\n\tletter-spacing: 1.5;\n}\n.tlui-people-menu__more::after {\n\tborder-radius: var(--radius-2);\n\tinset: 0px;\n}\n\n.tlui-people-menu__wrapper {\n\tposition: relative;\n\tdisplay: flex;\n\tflex-direction: column;\n\twidth: 220px;\n\theight: fit-content;\n\tmax-height: 50vh;\n}\n\n.tlui-people-menu__section {\n\tposition: relative;\n\ttouch-action: auto;\n\tflex-direction: column;\n\tmax-height: 100%;\n\toverflow-x: hidden;\n\toverflow-y: auto;\n\ttouch-action: auto;\n}\n\n.tlui-people-menu__section:first-child,\n.tlui-people-menu__section:last-child {\n\tflex-shrink: 0;\n}\n\n.tlui-people-menu__section:not(:last-child) {\n\tborder-bottom: 1px solid var(--color-divider);\n}\n\n.tlui-people-menu__user {\n\tdisplay: flex;\n\tjustify-content: flex-start;\n\talign-items: center;\n}\n\n.tlui-people-menu__user__color {\n\tflex-shrink: 0;\n}\n\n.tlui-people-menu__user__name {\n\ttext-align: left;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n\tfont-size: 12px;\n\tcolor: var(--color-text-1);\n\tmax-width: 100%;\n\tflex-grow: 1;\n\tflex-shrink: 100;\n}\n\n.tlui-people-menu__user__label {\n\ttext-align: left;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n\tfont-size: 12px;\n\tcolor: var(--color-text-3);\n\tflex-grow: 100;\n\tflex-shrink: 0;\n\tmargin-left: 4px;\n}\n\n.tlui-people-menu__user__input {\n\tflex-grow: 2;\n\theight: 100%;\n\tpadding: 0px;\n\tmargin: 0px;\n}\n\n.tlui-people-menu__user > .tlui-input__wrapper {\n\twidth: auto;\n\tdisplay: flex;\n\talign-items: auto;\n\tflex-grow: 2;\n\tgap: 8px;\n\theight: 100%;\n\tpadding: 0px;\n}\n\n.tlui-people-menu__item {\n\tposition: relative;\n}\n\n.tlui-people-menu__item:last-of-type .tlui-button__menu {\n\tmargin-bottom: 0;\n}\n\n.tlui-people-menu__item__button {\n\tpadding: 0 11px;\n\toverflow: hidden;\n}\n\n.tlui-people-menu__item > .tlui-button__menu {\n\twidth: auto;\n\tdisplay: flex;\n\talign-items: auto;\n\tjustify-content: flex-start;\n\tflex-grow: 2;\n\tgap: 11px;\n}\n\n.tlui-people-menu__name {\n\ttext-align: left;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n}\n\n.tlui-people-menu__item__follow {\n\tposition: absolute;\n\ttop: 0px;\n\tright: 0px;\n\tmax-width: 40px;\n\tflex-shrink: 0;\n}\n\n.tlui-people-menu__item[data-follow='true'],\n.tlui-people-menu__item:has(.tlui-button:focus-visible) {\n\tpadding-right: 36px;\n}\n\n.tlui-people-menu__item[data-follow='true'] .tlui-people-menu__item__follow,\n.tlui-people-menu__item:has(.tlui-button:focus-visible) .tlui-people-menu__item__follow {\n\topacity: 1;\n}\n\n@media (hover: hover) {\n\t.tlui-people-menu__item__follow {\n\t\topacity: 0;\n\t}\n\n\t.tlui-people-menu__item:hover {\n\t\tpadding-right: 36px;\n\t}\n\t.tlui-people-menu__item:hover .tlui-people-menu__item__follow {\n\t\topacity: 1;\n\t}\n}\n\n.tlui-menu-click-capture {\n\tposition: fixed;\n\tinset: 0;\n\tz-index: var(--layer-menu-click-capture);\n}\n\n/* --------------- Contextual Toolbar --------------- */\n\n.tlui-contextual-toolbar {\n\tposition: absolute;\n}\n\n/**\n * N.B. We hide the toolbar while mousing down, so no need to turn these off.\n */\n.tlui-contextual-toolbar,\n.tlui-contextual-toolbar * {\n\tpointer-events: all;\n}\n\n.tlui-contextual-toolbar [data-isactive='true']::after {\n\tbackground-color: var(--color-muted-2);\n\topacity: 1;\n}\n\n.tlui-rich-text__toolbar {\n\topacity: 0;\n\ttransition: opacity 0.08s ease-in-out;\n}\n\n.tlui-rich-text__toolbar,\n.tlui-rich-text__toolbar * {\n\tpointer-events: none;\n}\n\n.tlui-rich-text__toolbar[data-visible='true'] {\n\topacity: 1;\n}\n\n.tlui-rich-text__toolbar[data-interactive='true'],\n.tlui-rich-text__toolbar[data-interactive='true'] * {\n\tpointer-events: all;\n}\n\n.tlui-rich-text__toolbar-link-input {\n\tmargin-left: 12px;\n\t/*\n\t * Nice touch tweak: keep the link editor toolbar the same as the default toolbar.\n\t * This is so the toolbar size stays stable going in and out of the link editor.\n\t */\n\twidth: 148px;\n}\n\n.tlui-rich-text__toolbar .tlui-input__wrapper {\n\theight: 40px;\n}\n\n/* ------------------- Accessibilty ------------------- */\n\n.tl-skip-to-main-content {\n\tposition: fixed;\n\ttop: 48px;\n\tleft: -9999px;\n\tpadding: 8px 16px;\n\tz-index: var(--layer-toasts);\n}\n\n.tl-skip-to-main-content:focus {\n\tleft: 8px;\n}\n\n","",{version:3,sources:["webpack://./node_modules/@tldraw/tldraw/tldraw.css"],names:[],mappings:"AAAA,8EAA8E;AAC9E,8EAA8E;AAC9E,gEAAgE;;AAEhE,mBAAmB;;AAEnB;CACC,WAAW;CACX,YAAY;CACZ,eAAe;CACf,YAAY;CACZ,cAAc;CACd,cAAc;CACd,cAAc;CACd,eAAe;CACf,eAAe;CACf,eAAe;CACf,eAAe;CACf,eAAe;CACf,eAAe;CACf,gBAAgB;CAChB,WAAW;CACX,eAAe;CACf,eAAe;CACf,eAAe;CACf,eAAe;CACf,gBAAgB;;CAEhB,mBAAmB;CACnB,8BAA8B;CAC9B,8BAA8B;CAC9B,wBAAwB;CACxB,sBAAsB;CACtB,0BAA0B;CAC1B,4BAA4B;CAC5B,6BAA6B;;CAE7B,4BAA4B;CAC5B,0CAA0C;CAC1C,uCAAuC;CACvC,iDAAiD;CACjD,kCAAkC;CAClC,+BAA+B;CAC/B,4CAA4C;CAC5C,2CAA2C;CAC3C,kCAAkC;CAClC,kCAAkC;CAClC,mGAAmG;CACnG,kCAAkC;CAClC,yCAAyC;CACzC,4BAA4B;CAC5B,8CAA8C;CAC9C,yCAAyC;;CAEzC,wBAAwB;CACxB,yBAAyB;CACzB,uBAAuB;CACvB,sBAAsB;;CAEtB,2BAA2B;CAC3B,wBAAwB;CACxB,uBAAuB;CACvB,6BAA6B;CAC7B,wBAAwB;;CAExB,SAAS;CACT,YAAY;;CAEZ,gBAAgB;CAChB,sBAAsB;CACtB;;;SAGQ;CACR;;;SAGQ;CACR;;;WAGU;CACV;;;MAGK;CACL;;;MAGK;CACL;;;UAGS;CACT;;;MAGK;CACL;;;SAGQ;CACR;;;UAGS;;CAET,wDAAwD;CACxD,uDAAuD;CACvD,qCAAqC;CACrC,kCAAkC;CAClC,sCAAsC;CACtC,gCAAgC;CAChC,gCAAgC;CAChC,oCAAoC;CACpC,oCAAoC;CACpC,2BAA2B;CAC3B,gCAAgC;CAChC,gCAAgC;CAChC,gCAAgC;CAChC,gCAAgC;CAChC,oCAAoC;CACpC,UAAU;CACV,yCAAyC;CACzC,yCAAyC;CACzC,sCAAsC;CACtC,wCAAwC;CACxC,iBAAiB;CACjB,6CAA6C;CAC7C,8CAA8C;CAC9C;;;0FAGyF;CACzF,mDAAmD;CACnD,mBAAmB;CACnB,kBAAkB;CAClB,UAAU;CACV,YAAY;CACZ,WAAW;CACX,cAAc;CACd,wBAAwB;AACzB;;AAEA;CACC,gCAAgC;CAChC,sCAAsC;CACtC,0CAA0C;CAC1C,4CAA4C;CAC5C,6BAA6B;CAC7B,+BAA+B;CAC/B,sCAAsC;CACtC,kCAAkC;CAClC,sCAAsC;CACtC,mCAAmC;CACnC,oCAAoC;CACpC,qCAAqC;CACrC,kCAAkC;CAClC,oCAAoC;CACpC,gCAAgC;CAChC,wCAAwC;CACxC,4CAA4C;CAC5C,8BAA8B;CAC9B,+CAA+C;CAC/C,iCAAiC;CACjC,oCAAoC;CACpC,2CAA2C;CAC3C,gDAAgD;CAChD,4CAA4C;CAC5C,+BAA+B;CAC/B,+BAA+B;CAC/B,iCAAiC;CACjC,qCAAqC;CACrC,0CAA0C;CAC1C,8DAA8D;CAC9D,mCAAmC;CACnC,mCAAmC;CACnC,gCAAgC;CAChC,kCAAkC;CAClC,+BAA+B;CAC/B,8BAA8B;CAC9B,4BAA4B;CAC5B,gCAAgC;CAChC,YAAY;CACZ,2EAA2E;CAC3E;;oFAEmF;CACnF;;mDAEkD;CAClD;;oFAEmF;AACpF;;AAEA;CACC,gCAAgC;CAChC,sCAAsC;CACtC,yCAAyC;CACzC,4CAA4C;CAC5C,6BAA6B;CAC7B,kCAAkC;CAClC,sCAAsC;CACtC,kCAAkC;CAClC,wCAAwC;CACxC,qCAAqC;CACrC,sCAAsC;CACtC,qCAAqC;CACrC,kCAAkC;CAClC,oCAAoC;CACpC,kCAAkC;CAClC,0CAA0C;CAC1C,oCAAoC;CACpC,8CAA8C;CAC9C,qDAAqD;CACrD,iCAAiC;CACjC,oCAAoC;CACpC,2CAA2C;CAC3C,gDAAgD;CAChD,4CAA4C;CAC5C,+BAA+B;CAC/B,+BAA+B;CAC/B,iCAAiC;CACjC,uCAAuC;CACvC,0CAA0C;CAC1C,iEAAiE;CACjE,mCAAmC;CACnC,mCAAmC;CACnC,gCAAgC;CAChC,mCAAmC;CACnC,+BAA+B;CAC/B,8BAA8B;CAC9B,gCAAgC;CAChC,gCAAgC;CAChC,YAAY;CACZ;;mDAEkD;CAClD;;mDAEkD;CAClD;;mDAEkD;AACnD;;AAEA;CACC,iCAAiC;CACjC,0BAA0B;CAC1B,kCAAkC;CAClC,mCAAmC;AACpC;;AAEA;;CAEC,2BAA2B;CAC3B,wCAAwC;CACxC,sCAAsC;CACtC,yBAAyB;CACzB,iBAAiB;CACjB,sBAAsB;CACtB,aAAa;AACd;;AAEA;CACC,8BAA8B;AAC/B;;AAEA;CACC,mCAAmC;AACpC;;AAEA;;;CAGC,iBAAiB;AAClB;;AAEA,uDAAuD;AACvD,uDAAuD;AACvD,uDAAuD;;AAEvD;CACC,kBAAkB;CAClB,UAAU;CACV,YAAY;CACZ,WAAW;CACX,wBAAwB;CACxB,wBAAwB;CACxB,cAAc;CACd,wBAAwB;CACxB,kBAAkB;CAClB,eAAe;AAChB;;AAEA;CACC,kBAAkB;CAClB,mCAAmC;AACpC;;AAEA;CACC,kBAAkB;CAClB,QAAQ;CACR,SAAS;CACT,YAAY;CACZ,WAAW;CACX,eAAe;CACf,oBAAoB;CACpB,qCAAqC;AACtC;;AAEA;CACC,kBAAkB;CAClB,QAAQ;CACR,SAAS;CACT,iBAAiB;CACjB,oBAAoB;CACpB,0BAA0B;AAC3B;;AAEA;CACC,kBAAkB;CAClB,QAAQ;CACR,SAAS;CACT,WAAW;CACX,YAAY;CACZ,oBAAoB;AACrB;;AAEA,uDAAuD;;AAEvD;CACC,uCAAuC;CACvC,kBAAkB;CAClB,UAAU;CACV,YAAY;CACZ,WAAW;AACZ;;AAEA;CACC,yCAAyC;CACzC,WAAW;CACX,YAAY;AACb;;AAEA,2DAA2D;;AAE3D;CACC,kBAAkB;CAClB,UAAU;CACV,WAAW;CACX,YAAY;CACZ,kBAAkB;CAClB,oBAAoB;CACpB,iCAAiC;CACjC,eAAe;AAChB;;AAEA;CACC,uBAAuB;AACxB;;AAEA,uDAAuD;;AAEvD;CACC,kBAAkB;CAClB,QAAQ;CACR,SAAS;CACT,UAAU;CACV,WAAW;CACX,0BAA0B;AAC3B;;AAEA,uDAAuD;;AAEvD;CACC,yCAAyC;CACzC,oBAAoB;AACrB;;AAEA;CACC,iCAAiC;CACjC,6BAA6B;AAC9B;;AAEA,uDAAuD;;AAEvD;CACC,sBAAsB;CACtB,qBAAqB;CACrB,oBAAoB;CACpB,oBAAoB;AACrB;;AAEA,uDAAuD;;AAEvD;CACC,kBAAkB;CAClB,oBAAoB;CACpB,iBAAiB;CACjB,0BAA0B;CAC1B,oBAAoB;AACrB;;AAEA,uDAAuD;;AAEvD;CACC,kBAAkB;CAClB,UAAU;CACV,YAAY;CACZ,WAAW;CACX,oBAAoB;CACpB,qBAAqB;CACrB,sBAAsB;CACtB,0BAA0B;CAC1B,iBAAiB;AAClB;;AAEA;CACC,kBAAkB;CAClB,UAAU;CACV,YAAY;CACZ,WAAW;CACX,oBAAoB;CACpB,qBAAqB;CACrB,sBAAsB;CACtB,8BAA8B;CAC9B,0BAA0B;CAC1B,cAAc;AACf;;AAEA,kDAAkD;;AAElD,2CAA2C;AAC3C;CACC,oDAAoD;AACrD;;AAEA;CACC,iDAAiD;AAClD;;AAEA;CACC,2DAA2D;AAC5D;;AAEA;CACC,4CAA4C;AAC7C;;AAEA;CACC,yCAAyC;AAC1C;;AAEA;CACC,sDAAsD;AACvD;;AAEA;CACC,qDAAqD;AACtD;;AAEA;CACC,2CAA2C;AAC5C;;AAEA;CACC,4CAA4C;AAC7C;;AAEA;CACC,oBAAoB;CACpB,2CAA2C;AAC5C;;AAEA;CACC,kDAAkD;CAClD,2CAA2C;AAC5C;;AAEA;CACC,qCAAqC;AACtC;;AAEA,+BAA+B;AAC/B;CACC,uDAAuD;AACxD;;AAEA;CACC,kDAAkD;AACnD;;AAEA;CACC,iBAAiB;AAClB;;AAEA,uDAAuD;;AAEvD;CACC,0BAA0B;CAC1B,UAAU;CACV,2CAA2C;CAC3C,oBAAoB;AACrB;;AAEA,uDAAuD;;AAEvD;CACC,kBAAkB;CAClB,QAAQ;CACR,SAAS;CACT,0BAA0B;CAC1B,6BAA6B;CAC7B,mBAAmB;AACpB;;AAEA;CACC,UAAU;CACV,oBAAoB;CACpB,qCAAqC;CACrC,2CAA2C;AAC5C;;AAEA;CACC,oBAAoB;CACpB,qCAAqC;CACrC,6BAA6B;CAC7B,2CAA2C;AAC5C;;AAEA;CACC,oBAAoB;CACpB,mCAAmC;AACpC;;AAEA;CACC,oBAAoB;CACpB,UAAU;CACV,qCAAqC;AACtC;;AAEA;CACC,oBAAoB;CACpB,UAAU;CACV,qCAAqC;AACtC;;AAEA;CACC,mBAAmB;CACnB,6BAA6B;AAC9B;;AAEA;CACC,oBAAoB;CACpB,qCAAqC;CACrC,6BAA6B;CAC7B,2CAA2C;AAC5C;;AAEA;CACC,iBAAiB;CACjB,mBAAmB;AACpB;;AAEA,uDAAuD;;AAEvD;CACC,mBAAmB;AACpB;;AAEA;CACC,iBAAiB;CACjB,mBAAmB;CACnB,mBAAmB;AACpB;;AAEA;CACC,oCAAoC;CACpC,qCAAqC;CACrC,2CAA2C;CAC3C,oBAAoB;AACrB;;AAEA;CACC,UAAU;AACX;;AAEA;CACC,mCAAmC;CACnC,YAAY;AACb;;AAEA;CACC,UAAU;AACX;;AAEA;CACC;EACC,iCAAiC;CAClC;;CAEA;EACC,UAAU;CACX;AACD;;AAEA;;CAEC,YAAY;AACb;;AAEA,2DAA2D;;AAE3D;CACC,oCAAoC;CACpC,qCAAqC;CACrC,2CAA2C;CAC3C,8BAA8B;AAC/B;;AAEA;CACC,mBAAmB;CACnB,iCAAiC;CACjC,+BAA+B;AAChC;;AAEA;;;CAGC,aAAa;AACd;;AAEA;CACC,8BAA8B;AAC/B;;AAEA,uDAAuD;;AAEvD;;CAEC,iBAAiB;CACjB,sBAAsB;CACtB,WAAW;CACX,YAAY;AACb;;AAEA;CACC,mBAAmB;CACnB,wBAAwB;AACzB;;AAEA;;;CAGC,WAAW;CACX,YAAY;CACZ,mBAAmB;CACnB,+CAA+C;;CAE/C,aAAa;CACb,uBAAuB;CACvB,mBAAmB;AACpB;;AAEA;CACC,kBAAkB;CAClB,gBAAgB;AACjB;AACA;CACC,kBAAkB;CAClB,QAAQ;AACT;;AAEA;CACC,sCAAsC;CACtC,kBAAkB;CAClB,6BAA6B;CAC7B,+BAA+B;CAC/B,eAAe;CACf,2BAA2B;CAC3B,yCAAyC;CACzC,gBAAgB;CAChB,8BAA8B;AAC/B;;AAEA,uDAAuD;;AAEvD;CACC,kBAAkB;AACnB;;AAEA;CACC,kBAAkB;CAClB,SAAS;CACT,UAAU;CACV,kBAAkB;CAClB,mBAAmB;CACnB,gBAAgB;CAChB,gBAAgB;CAChB,mBAAmB;CACnB,kBAAkB;CAClB,gBAAgB;CAChB,uBAAuB;CACvB,eAAe;CACf,6BAA6B;CAC7B,8BAA8B;CAC9B,qCAAqC;AACtC;;AAEA;CACC,kBAAkB;CAClB,SAAS;CACT,UAAU;CACV,kBAAkB;CAClB,mBAAmB;CACnB,gBAAgB;CAChB,gBAAgB;CAChB,mBAAmB;CACnB,kBAAkB;CAClB,gBAAgB;CAChB,uBAAuB;CACvB,eAAe;CACf,6BAA6B;CAC7B,mCAAmC;CACnC,qCAAqC;AACtC;;AAEA;CACC,kBAAkB;CAClB,SAAS;CACT,UAAU;CACV,kBAAkB;CAClB,mBAAmB;CACnB,qCAAqC;CACrC,mBAAmB;CACnB,kBAAkB;CAClB,gBAAgB;CAChB,eAAe;CACf,6BAA6B;CAC7B,UAAU;CACV,8BAA8B;AAC/B;;AAEA;CACC,kBAAkB;CAClB,qCAAqC;CACrC,mBAAmB;CACnB,gBAAgB;CAChB,eAAe;CACf,6BAA6B;CAC7B,oBAAoB;CACpB,4BAA4B;CAC5B,gBAAgB;CAChB,iBAAiB;CACjB,UAAU;CACV,YAAY;CACZ,iBAAiB;CACjB,8BAA8B;AAC/B;;AAEA;CACC,mBAAmB;AACpB;;AAEA;CACC,iCAAiC;CACjC,qCAAqC;CACrC,iBAAiB;AAClB;;AAEA;CACC,uDAAuD;CACvD,yDAAyD;CACzD,eAAe;CACf,kCAAkC;AACnC;;AAEA;CACC,qCAAqC;CACrC,YAAY;AACb;;AAEA,uDAAuD;AACvD;CACC;EACC,yBAAyB;CAC1B;AACD;;AAEA,uDAAuD;;AAEvD;CACC,kBAAkB;CAClB,mBAAmB;CACnB,cAAc;CACd,YAAY;CACZ,WAAW;CACX,YAAY;CACZ,kBAAkB;CAClB,mBAAmB;CACnB,oBAAoB;CACpB,kBAAkB;CAClB,mBAAmB;CACnB,qBAAqB;CACrB,yBAAyB;CACzB,mCAAmC;AACpC;;AAEA;CACC,gCAAgC;AACjC;;AAEA;CACC,gCAAgC;AACjC;;AAEA;CACC,iCAAiC;AAClC;;AAEA;CACC,gCAAgC;AACjC;;AAEA;;CAEC,gBAAgB;AACjB;;AAEA;;CAEC,kBAAkB;AACnB;;AAEA;;CAEC,iBAAiB;AAClB;;AAEA;CACC,UAAU;AACX;;AAEA;CACC,aAAa;AACd;;AAEA;CACC,6CAA6C;CAC7C,WAAW;CACX,YAAY;;CAEZ,gBAAgB;CAChB,gBAAgB;CAChB,kBAAkB;CAClB,WAAW;CACX,8BAA8B;CAC9B,cAAc;CACd,gCAAgC;CAChC,qBAAqB;CACrB,oBAAoB;CACpB,6BAA6B;CAC7B,kBAAkB;CAClB,yBAAyB;CACzB,kBAAkB;CAClB,kBAAkB;CAClB,mBAAmB;CACnB,qBAAqB;CACrB,+BAA+B;CAC/B,oBAAoB;CACpB,uBAAuB;CACvB,oBAAoB;CACpB,aAAa;CACb,yBAAyB;CACzB,mBAAmB;CACnB,gBAAgB;CAChB,oBAAoB;CACpB,oBAAoB;CACpB,oBAAoB;CACpB,qBAAqB;CACrB,kBAAkB;CAClB,iBAAiB;CACjB,qBAAqB;CACrB,sCAAsC;AACvC;;AAEA;CACC,kBAAkB;CAClB,mCAAmC;CACnC,QAAQ;CACR,SAAS;CACT,UAAU;CACV,kBAAkB;CAClB,sBAAsB;CACtB,oBAAoB;CACpB,qBAAqB;CACrB,qBAAqB;CACrB,yBAAyB;CACzB,YAAY;CACZ,YAAY;CACZ,iBAAiB;CACjB,oBAAoB;CACpB,yBAAyB;AAC1B;;AAEA;;CAEC,kBAAkB;CAClB,UAAU;CACV,YAAY;CACZ,WAAW;CACX,cAAc;CACd,eAAe;CACf,aAAa;AACd;;AAEA;CACC,kBAAkB;CAClB,kBAAkB;CAClB,mBAAmB;CACnB,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,oBAAoB;CACpB,gBAAgB;AACjB;;AAEA;CACC,iBAAiB;CACjB,oBAAoB;AACrB;;AAEA;CACC,YAAY;CACZ,gBAAgB;CAChB,yBAAyB;CACzB,6BAA6B;AAC9B;;AAEA;CACC;;;GAGE;CACF,gBAAgB;AACjB;;AAEA;;CAEC,UAAU;CACV,gCAAgC;AACjC;;AAEA;;CAEC,6BAA6B;AAC9B;;AAEA;CACC,iCAAiC;CACjC,qCAAqC;CACrC,iBAAiB;AAClB;;AAEA;CACC,qBAAqB;CACrB,yBAAyB;CACzB,qBAAqB;;CAErB;;;;;;GAME;CACF,uCAAuC;CACvC,+BAA+B;CAC/B,8BAA8B;;CAE9B;;;;;;;;;;;;;;;;;;;;gCAoB+B;AAChC;;AAEA;CACC,SAAS;CACT,0EAA0E;CAC1E,eAAe;AAChB;;AAEA;;CAEC,gBAAgB;CAChB,SAAS;CACT,oBAAoB;CACpB,sDAAsD;CACtD,kBAAkB;AACnB;;AAEA;CACC,oBAAoB;AACrB;;AAEA;CACC,oBAAoB;AACrB;;AAEA;;;;;;CAMC,eAAe;CACf,mBAAmB;AACpB;;AAEA;CACC,2BAA2B;CAC3B,0BAA0B;AAC3B;;AAEA;CACC,eAAe;AAChB;;AAEA;CACC,gCAAgC;AACjC;;AAEA;CACC,yBAAyB;CACzB,mBAAmB;CACnB,kBAAkB;AACnB;;AAEA;CACC,iBAAiB;AAClB;;AAEA;CACC,6CAA6C;CAC7C,mBAAmB;AACpB;;AAEA;CACC;EACC;GACC,gDAAgD;EACjD;CACD;AACD;;AAEA;CACC,aAAa;CACb,gBAAgB;AACjB;;AAEA;CACC,cAAc;AACf;;AAEA,uDAAuD;;AAEvD;CACC,2BAA2B;CAC3B,yCAAyC;CACzC,UAAU;AACX;;AAEA;CACC,2BAA2B;CAC3B,yCAAyC;CACzC,UAAU;AACX;;AAEA,mDAAmD;;AAEnD;CACC,yBAAyB;CACzB,yCAAyC;CACzC,YAAY;AACb;;AAEA,2DAA2D;;AAE3D;CACC,WAAW;CACX,YAAY;CACZ,kBAAkB;CAClB,6CAA6C;CAC7C,oCAAoC;CACpC,8BAA8B;CAC9B,aAAa;CACb,sBAAsB;CACtB,gBAAgB;AACjB;;AAEA;CACC,sCAAsC;AACvC;;AAEA;CACC,cAAc;CACd,gBAAgB;CAChB,uCAAuC;CACvC,wCAAwC;CACxC,WAAW;CACX,YAAY;CACZ,aAAa;CACb,yBAAyB;CACzB,uBAAuB;AACxB;;AAEA;CACC,oCAAoC;AACrC;;AAEA;CACC,WAAW;CACX,YAAY;CACZ,sCAAsC;CACtC,6CAA6C;AAC9C;;AAEA;CACC,WAAW;CACX,YAAY;CACZ,iBAAiB;CACjB,uBAAuB;CACvB,6CAA6C;AAC9C;;AAEA;CACC,oCAAoC;CACpC,uBAAuB;CACvB,mBAAmB;CACnB,aAAa;CACb,sBAAsB;CACtB,8BAA8B;CAC9B,OAAO;AACR;;AAEA;;;CAGC,WAAW;CACX,WAAW;CACX,oBAAoB;AACrB;;AAEA;CACC,eAAe;CACf,gBAAgB;CAChB,iBAAiB;CACjB,8BAA8B;CAC9B,gBAAgB;CAChB,kCAAkC;CAClC,4BAA4B;CAC5B,qBAAqB;CACrB,aAAa;CACb,uBAAuB;CACvB,oBAAoB;AACrB;;AAEA;CACC,eAAe;CACf,gBAAgB;CAChB,gBAAgB;CAChB,kCAAkC;CAClC,4BAA4B;CAC5B,qBAAqB;CACrB,aAAa;CACb,uBAAuB;CACvB,oBAAoB;CACpB,0BAA0B;CAC1B,0BAA0B;AAC3B;;AAEA;;CAEC,0BAA0B;AAC3B;AACA;CACC,eAAe;CACf,mBAAmB;CACnB,aAAa;CACb,0BAA0B;CAC1B,mBAAmB;CACnB,gCAAgC;CAChC,kBAAkB;CAClB,eAAe;AAChB;;AAEA;CACC,gBAAgB;CAChB,mBAAmB;CACnB,gBAAgB;CAChB,uBAAuB;AACxB;;AAEA;CACC,iBAAiB;CACjB,cAAc;AACf;;AAEA;CACC,iBAAiB;CACjB,WAAW;CACX,YAAY;CACZ,cAAc;AACf;;AAEA,uDAAuD;;AAEvD;CACC,gBAAgB;CAChB,WAAW;CACX,kBAAkB;CAClB,QAAQ;CACR,UAAU;CACV,YAAY;CACZ,WAAW;CACX,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,eAAe;CACf,gBAAgB;CAChB,0BAA0B;CAC1B,aAAa;CACb,gCAAgC;CAChC,YAAY;CACZ,aAAa;CACb,mBAAmB;CACnB,UAAU;AACX;;AAEA;CACC,WAAW;CACX,WAAW;CACX,kBAAkB;CAClB,UAAU;CACV,WAAW;CACX,cAAc;CACd,wBAAwB;CACxB,yBAAyB;CACzB,8BAA8B;CAC9B,yCAAyC;CACzC,oBAAoB;AACrB;;AAEA;CACC,4BAA4B;AAC7B;;AAEA;CACC,WAAW;CACX,YAAY;CACZ,8BAA8B;CAC9B,oBAAoB;AACrB;;AAEA;CACC,aAAa;AACd;;AAEA,gDAAgD;;AAEhD;CACC,aAAa;CACb,uBAAuB;CACvB,mBAAmB;CACnB,wBAAwB;CACxB,mCAAmC;CACnC,oBAAoB;CACpB,kBAAkB;CAClB,UAAU;CACV,YAAY;CACZ,WAAW;AACZ;;AAEA;CACC,WAAW;CACX,YAAY;AACb;;AAEA;CACC,mBAAmB;AACpB;;AAEA;CACC,mBAAmB;CACnB,kCAAkC;AACnC;;AAEA;CACC,kBAAkB;CAClB,QAAQ;CACR,SAAS;CACT,gBAAgB;CAChB,mBAAmB;CACnB,kBAAkB;CAClB,8BAA8B;CAC9B,eAAe;AAChB;;AAEA;CACC,kBAAkB;CAClB,UAAU;CACV,YAAY;CACZ,WAAW;CACX,gBAAgB;AACjB;;AAEA;CACC,iCAAiC;CACjC,mBAAmB;AACpB;;AAEA;;;;;;EAME;AACF;;;;;;;;CAQC,mBAAmB;AACpB;;AAEA;CACC,eAAe;AAChB;;AAEA;CACC,6BAA6B;CAC7B,gBAAgB;AACjB;;AAEA;CACC,2BAA2B;CAC3B,UAAU;CACV,qBAAqB;CACrB,iBAAiB;AAClB;;AAEA,uDAAuD;;AAEvD;CACC,kBAAkB;CAClB,SAAS;CACT,UAAU;CACV,UAAU;CACV,WAAW;CACX,YAAY;CACZ,aAAa;CACb,uBAAuB;CACvB,mBAAmB;CACnB,kBAAkB;CAClB,wBAAwB;CACxB,mCAAmC;AACpC;;AAEA;CACC,UAAU;AACX;;AAEA;CACC,8BAA8B;CAC9B,uBAAuB;CACvB,kBAAkB;CAClB,mBAAmB;CACnB,kBAAkB;CAClB,oBAAoB;CACpB,aAAa;CACb,uBAAuB;CACvB,mBAAmB;AACpB;;AAEA;CACC,kBAAkB;CAClB,mBAAmB;CACnB,gBAAgB;CAChB,iBAAiB;AAClB;;AAEA;CACC,gBAAgB;CAChB,0CAA0C;CAC1C,cAAc;AACf;;AAEA,uDAAuD;;AAEvD;CACC,kBAAkB;CAClB,WAAW;CACX,YAAY;CACZ,mBAAmB;CACnB,UAAU;CACV,oCAAoC;CACpC,kBAAkB;AACnB;;AAEA;CACC,iBAAiB;CACjB,mBAAmB;AACpB;;AAEA,uDAAuD;;AAEvD;CACC,yCAAyC;CACzC,0BAA0B;CAC1B,YAAY;CACZ,WAAW;CACX,aAAa;CACb,sBAAsB;CACtB,uBAAuB;CACvB,mBAAmB;CACnB,mBAAmB;CACnB,eAAe;CACf,gBAAgB;CAChB,UAAU;CACV,4CAA4C;CAC5C,qBAAqB;CACrB,kBAAkB;CAClB,UAAU;CACV,oCAAoC;AACrC;;AAEA;CACC;EACC,UAAU;CACX;CACA;EACC,UAAU;CACX;AACD;;AAEA,wDAAwD;;AAExD;CACC,yCAAyC;AAC1C;;AAEA;CACC,6BAA6B;CAC7B,UAAU;AACX;;AAEA;CACC,sBAAsB;CACtB,oBAAoB;CACpB,2BAA2B;CAC3B,0BAA0B;CAC1B,aAAa;CACb,mBAAmB;CACnB,kBAAkB;CAClB,yBAAyB;CACzB,gBAAgB;CAChB,eAAe;CACf,qCAAqC;CACrC,YAAY;CACZ,eAAe;CACf,mBAAmB;CACnB,mBAAmB;AACpB;;AAEA;CACC,mBAAmB;CACnB,uFAAuF;CACvF,yBAAyB;CACzB,aAAa;CACb,2BAA2B;CAC3B,WAAW;CACX,mBAAmB;CACnB,8BAA8B;AAC/B;;AAEA;CACC,mBAAmB;CACnB,gBAAgB;CAChB,uBAAuB;CACvB,mCAAmC;CACnC,8BAA8B;CAC9B,kBAAkB;CAClB,kBAAkB;CAClB,gBAAgB;AACjB;;AAEA;CACC,kBAAkB;CAClB,gBAAgB;CAChB,WAAW;CACX,qCAAqC;CACrC,YAAY;CACZ,iBAAiB;CACjB,oCAAoC;CACpC,mCAAmC;CACnC,yDAAyD;AAC1D;;AAEA;CACC,kBAAkB;CAClB,YAAY;CACZ,gBAAgB;CAChB,aAAa;CACb,mCAAmC;CACnC,UAAU;CACV,YAAY;CACZ,WAAW;CACX,kBAAkB;CAClB,oBAAoB;CACpB,oBAAoB;CACpB,WAAW;CACX,0BAA0B;CAC1B,8BAA8B;CAC9B,gBAAgB;CAChB,yBAAyB;CACzB,gBAAgB;CAChB,6BAA6B;AAC9B;;AAEA,oCAAoC;AACpC,0FAA0F;AAC1F,uEAAuE;AACvE;CACC;EACC,eAAe;CAChB;AACD;;AAEA,wDAAwD;;AAExD;CACC,YAAY;CACZ,8BAA8B;AAC/B;;AAEA,uDAAuD;;AAEvD;CACC,WAAW;CACX,YAAY;CACZ,sCAAsC;CACtC,yCAAyC;CACzC,kCAAkC;CAClC,mBAAmB;CACnB,sDAAsD;CACtD,aAAa;CACb,sBAAsB;CACtB,mBAAmB;CACnB,uBAAuB;CACvB,gBAAgB;CAChB,kBAAkB;CAClB,mBAAmB;CACnB,gBAAgB;CAChB,uBAAuB;AACxB;;AAEA;CACC,iCAAiC;CACjC,gBAAgB;CAChB,eAAe;CACf,oBAAoB;CACpB,0BAA0B;AAC3B;;AAEA,uDAAuD;;AAEvD;CACC,WAAW;CACX,YAAY;CACZ,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,uBAAuB;CACvB,yCAAyC;CACzC,0BAA0B;CAC1B,kBAAkB;AACnB;;AAEA;CACC,kBAAkB;CAClB,UAAU;CACV,YAAY;CACZ,WAAW;CACX,mCAAmC;CACnC,sCAAsC;AACvC;;AAEA;CACC,gBAAgB;CAChB,yBAAyB;CACzB,mBAAmB;AACpB;;AAEA;CACC,oBAAoB;CACpB,kBAAkB;CAClB,UAAU;CACV,YAAY;CACZ,WAAW;CACX,kCAAkC;AACnC;;AAEA;;+DAE+D;AAC/D;CACC,YAAY;CACZ,cAAc;CACd,kBAAkB;CAClB,UAAU;CACV,YAAY;CACZ,WAAW;CACX,wCAAwC;CACxC,mBAAmB;AACpB;;AAEA;CACC,kBAAkB;CAClB,mBAAmB;CACnB,eAAe;CACf,YAAY;CACZ,gBAAgB;CAChB,oCAAoC;CACpC,aAAa;CACb,mBAAmB;CACnB,2BAA2B;CAC3B,eAAe;CACf,gBAAgB;CAChB,aAAa;CACb,sBAAsB;CACtB,cAAc;CACd,mCAAmC;CACnC,SAAS;AACV;;AAEA;CACC,YAAY;AACb;;AAEA;CACC,eAAe;CACf,WAAW;CACX,gBAAgB;AACjB;;AAEA;CACC,yCAAyC;CACzC,kBAAkB;CAClB,uBAAuB;CACvB,8BAA8B;CAC9B,mBAAmB;AACpB;;AAEA;CACC,gBAAgB;CAChB,WAAW;AACZ;;AAEA;CACC,sCAAsC;CACtC,aAAa;CACb,uBAAuB;CACvB,8BAA8B;CAC9B,cAAc;CACd,eAAe;CACf,iBAAiB;AAClB;;AAEA;CACC,gBAAgB;CAChB,YAAY;CACZ,oBAAoB;CACpB,eAAe;CACf,gBAAgB;CAChB,uBAAuB;CACvB,8BAA8B;CAC9B,gCAAgC;CAChC,cAAc;CACd,6BAA6B;AAC9B;;AAEA;CACC,4BAA4B;CAC5B,gBAAgB;CAChB,qBAAqB;AACtB;;AAEA;CACC,kBAAkB;CAClB,kBAAkB;AACnB;;AAEA;CACC,kBAAkB;CAClB,mBAAmB;CACnB,qBAAqB;CACrB,eAAe;CACf,sCAAsC;CACtC,oCAAoC;CACpC,8BAA8B;AAC/B;;AAEA;CACC,aAAa;CACb,8BAA8B;CAC9B,mBAAmB;CACnB,WAAW;CACX,iBAAiB;AAClB;AACA;CACC,aAAa;CACb,mBAAmB;AACpB;AACA;CACC,wBAAwB;AACzB;AACA;CACC,sCAAsC;CACtC,qCAAqC;AACtC;AACA;;CAEC,kBAAkB;CAClB,iBAAiB;AAClB;;AAEA,uDAAuD;;AAEvD;CACC,UAAU;CACV,oBAAoB;AACrB;;AAEA;CACC,kBAAkB;CAClB,SAAS;CACT,UAAU;CACV,WAAW;CACX,eAAe;CACf,sBAAsB;AACvB;;AAEA,uDAAuD;;AAEvD;CACC,kBAAkB;CAClB,oCAAoC;CACpC,UAAU;CACV,WAAW;CACX,YAAY;CACZ,mBAAmB;AACpB;;AAEA;CACC,aAAa;AACd;;AAEA;CACC;EACC,UAAU;CACX;;CAEA;EACC,6BAA6B;EAC7B,iCAAiC;CAClC;;CAEA;EACC,4BAA4B;CAC7B;;CAEA;EACC,4BAA4B;CAC7B;;CAEA;EACC,kCAAkC;CACnC;CACA;EACC,0BAA0B;CAC3B;CACA;EACC,sCAAsC;EACtC,YAAY;CACb;;CAEA;2DAC0D;CAC1D;EACC,iCAAiC;EACjC,mBAAmB;CACpB;AACD;;AAEA,eAAe;;AAEf;CACC,gBAAgB;CAChB,yBAAyB;CACzB,+BAA+B;CAC/B,mBAAmB;CACnB,kBAAkB;CAClB,mBAAmB;CACnB,mBAAmB;CACnB,0BAA0B;CAC1B,iCAAiC;AAClC;;AAEA,uDAAuD;AACvD,uDAAuD;AACvD,uDAAuD;;AAEvD,WAAW;;AAEX;CACC,kBAAkB;CAClB,YAAY;CACZ,eAAe;CACf,iBAAiB;CACjB,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,6BAA6B;CAC7B,mBAAmB;CACnB,mBAAmB;CACnB,eAAe;CACf,mBAAmB;CACnB,oBAAoB;CACpB,oBAAoB;CACpB,oBAAoB;CACpB,kCAAkC;CAClC,eAAe;CACf,QAAQ;CACR,0BAA0B;CAC1B,UAAU;AACX;;AAEA;CACC,0BAA0B;CAC1B,iBAAiB;CACjB,eAAe;AAChB;;AAEA;CACC,0BAA0B;AAC3B;;AAEA;CACC,kBAAkB;CAClB,2BAA2B;AAC5B;;AAEA;CACC,eAAe;CACf,YAAY;CACZ,gBAAgB;AACjB;;AAEA;;;;EAIE;AACF;CACC,mBAAmB;CACnB,qCAAqC;CACrC,oBAAoB;AACrB;AACA;CACC,mBAAmB;AACpB;AACA;CACC,mBAAmB;CACnB,qCAAqC;CACrC,oBAAoB;AACrB;;AAEA;CACC,cAAc;CACd,WAAW;CACX,kBAAkB;CAClB,UAAU;CACV,8BAA8B;CAC9B,gCAAgC;CAChC,UAAU;AACX;;AAEA;CACC,UAAU;AACX;;AAEA;;CAEC,6BAA6B;CAC7B,UAAU;AACX;;AAEA;CACC,yFAAyF;CACzF,UAAU;AACX;;AAEA;CACC;EACC,UAAU;CACX;;CAEA;EACC,UAAU;CACX;AACD;;AAEA;CACC,2BAA2B;AAC5B;;AAEA,gBAAgB;;AAEhB;CACC,8BAA8B;CAC9B,kCAAkC;AACnC;;AAEA;CACC,sCAAsC;CACtC,UAAU;AACX;;AAEA;CACC;EACC,UAAU;CACX;AACD;;AAEA,6BAA6B;;AAE7B;CACC,2BAA2B;AAC5B;;AAEA;CACC,wBAAwB;CACxB,iBAAiB;AAClB;;AAEA;CACC;EACC,2BAA2B;CAC5B;;CAEA;EACC,wBAAwB;EACxB,iBAAiB;CAClB;AACD;;AAEA,iBAAiB;;AAEjB;CACC,kBAAkB;AACnB;;AAEA,gBAAgB;;AAEhB;CACC,YAAY;CACZ,gBAAgB;CAChB,WAAW;CACX,QAAQ;CACR,gBAAgB;AACjB;;AAEA;CACC,UAAU;CACV,8BAA8B;AAC/B;;AAEA;CACC,gBAAgB;AACjB;;AAEA;CACC,eAAe;AAChB;;AAEA;CACC,kBAAkB;AACnB;;AAEA,yBAAyB;;AAEzB;CACC,iBAAiB;AAClB;;AAEA;CACC,WAAW;CACX,YAAY;AACb;;AAEA,qBAAqB;;AAErB;CACC,kBAAkB;CAClB,QAAQ;CACR,UAAU;CACV,mBAAmB;CACnB,YAAY;CACZ,WAAW;CACX,cAAc;CACd,8BAA8B;AAC/B;;AAEA;CACC,QAAQ;CACR,SAAS;CACT,UAAU;AACX;;AAEA,iBAAiB;;AAEjB;CACC,kBAAkB;CAClB,YAAY;CACZ,WAAW;CACX,iBAAiB;CACjB,kBAAkB;AACnB;;AAEA;CACC,gBAAgB;AACjB;;AAEA;CACC,iBAAiB;AAClB;;AAEA;CACC,UAAU;CACV,kBAAkB;AACnB;;AAEA;CACC,qCAAqC;AACtC;;AAEA;CACC,qCAAqC;AACtC;;AAEA;CACC,iCAAiC;CACjC,UAAU;AACX;;AAEA;CACC,YAAY;CACZ,WAAW;AACZ;;AAEA;CACC,YAAY;CACZ,WAAW;AACZ;;AAEA,SAAS;;AAET;CACC,YAAY;CACZ,WAAW;CACX,YAAY;CACZ,eAAe;CACf,mBAAmB;CACnB,kCAAkC;CAClC,yCAAyC;AAC1C;;AAEA;CACC;EACC,sCAAsC;EACtC,mBAAmB;EACnB,UAAU;CACX;AACD;;AAEA,eAAe;;AAEf;CACC,aAAa;CACb,mBAAmB;AACpB;AACA;CACC,iBAAiB;CACjB,kBAAkB;AACnB;AACA;CACC,gBAAgB;AACjB;AACA;CACC,iBAAiB;AAClB;;AAEA,gBAAgB;;AAEhB;CACC,aAAa;CACb,sCAAsC;CACtC,mBAAmB;CACnB,gBAAgB;AACjB;AACA;CACC,YAAY;AACb;AACA;;CAEC,iBAAiB;AAClB;AACA;CACC,gBAAgB;AACjB;AACA;CACC,eAAe;AAChB;AACA;CACC,kBAAkB;AACnB;;AAEA,gBAAgB;;AAEhB;CACC,WAAW;CACX,eAAe;CACf,kBAAkB;AACnB;;AAEA;CACC,WAAW;CACX,eAAe;CACf,kBAAkB;AACnB;;AAEA,uDAAuD;;AAEvD;CACC,kBAAkB;CAClB,aAAa;CACb,0BAA0B;CAC1B,yCAAyC;CACzC,oBAAoB;CACpB,YAAY;CACZ,gBAAgB;CAChB,cAAc;CACd,oBAAoB;CACpB,iBAAiB;CACjB,eAAe;CACf,4BAA4B;CAC5B,+BAA+B;CAC/B,kCAAkC;CAClC,gBAAgB;CAChB,gBAAgB;CAChB,mCAAmC;CACnC,kCAAkC;CAClC,wBAAwB;CACxB,kCAAkC;AACnC;;AAEA;CACC,cAAc;CACd,WAAW;CACX,aAAa;CACb,cAAc;CACd,8BAA8B;AAC/B;;AAEA;CACC,aAAa;CACb,sBAAsB;CACtB,uBAAuB;CACvB,2BAA2B;CAC3B,WAAW;CACX,YAAY;CACZ,WAAW;AACZ;;AAEA;CACC,aAAa;CACb,sBAAsB;CACtB,qBAAqB;CACrB,2BAA2B;CAC3B,YAAY;CACZ,cAAc;CACd,cAAc;AACf;;AAEA;;CAEC,mBAAmB;CACnB,kBAAkB;CAClB,yBAAyB;AAC1B;;AAEA,sDAAsD;;AAEtD;CACC,kBAAkB;CAClB,aAAa;CACb,sBAAsB;CACtB,2BAA2B;CAC3B,uBAAuB;CACvB,kBAAkB;CAClB,mBAAmB;CACnB,qCAAqC;CACrC,mBAAmB;CACnB,oBAAoB;CACpB,4BAA4B;AAC7B;;AAEA,uDAAuD;;AAEvD;CACC,cAAc;CACd,WAAW;CACX,YAAY;CACZ,8BAA8B;AAC/B;;AAEA;CACC,cAAc;CACd,WAAW;CACX,YAAY;CACZ,6BAA6B;AAC9B;;AAEA;CACC,WAAW;CACX,YAAY;AACb;;AAEA,uDAAuD;;AAEvD;CACC,WAAW;CACX,2BAA2B;AAC5B;;AAEA;CACC,kBAAkB;CAClB,aAAa;CACb,mBAAmB;CACnB,iBAAiB;CACjB,kBAAkB;CAClB,WAAW;AACZ;;AAEA;CACC,kBAAkB;CAClB,YAAY;CACZ,YAAY;CACZ,eAAe;AAChB;;AAEA;CACC,cAAc;CACd,kBAAkB;CAClB,oBAAoB;CACpB,WAAW;CACX,WAAW;CACX,WAAW;CACX,sCAAsC;CACtC,mBAAmB;AACpB;;AAEA;CACC,kBAAkB;CAClB,oBAAoB;CACpB,SAAS;CACT,WAAW;CACX,uCAAuC;CACvC,mBAAmB;AACpB;;AAEA;CACC,UAAU;CACV,YAAY;CACZ,cAAc;CACd,WAAW;CACX,YAAY;CACZ,kBAAkB;CAClB,SAAS;CACT,oCAAoC;CACpC,oBAAoB;CACpB,qDAAqD;AACtD;;AAEA;CACC,gBAAgB;CAChB;;iBAEgB;AACjB;;AAEA,uDAAuD;;AAEvD;CACC,oBAAoB;CACpB,eAAe;CACf,iBAAiB;CACjB,aAAa;CACb,qBAAqB;CACrB,sBAAsB;CACtB,2BAA2B;CAC3B,oCAAoC;CACpC,kBAAkB;CAClB,mBAAmB;CACnB,2BAA2B;AAC5B;;AAEA;CACC,WAAW;CACX,kBAAkB;CAClB,eAAe;CACf,WAAW;CACX,YAAY;CACZ,kBAAkB;AACnB;;AAEA;CACC,gBAAgB;AACjB;;AAEA;CACC,4BAA4B;AAC7B;;AAEA,sBAAsB;;AAEtB;CACC,4BAA4B;CAC5B,mBAAmB;AACpB;;AAEA,uDAAuD;;AAEvD;CACC,kBAAkB;CAClB,aAAa;CACb,sBAAsB;AACvB;;AAEA;CACC,kBAAkB;CAClB,qEAAqE;CACrE,WAAW;CACX,YAAY;CACZ,8BAA8B;CAC9B,oCAAoC;CACpC,2BAA2B;CAC3B,2BAA2B;CAC3B,gBAAgB;CAChB,gBAAgB;CAChB,kBAAkB;CAClB,yBAAyB;CACzB,qBAAqB;CACrB,wBAAwB;AACzB;;AAEA,uDAAuD;AACvD,uDAAuD;AACvD,uDAAuD;;AAEvD,uDAAuD;;AAEvD;CACC,kCAAkC;CAClC,WAAW;CACX,aAAa;CACb,mBAAmB;CACnB,yCAAyC;CACzC,8BAA8B;CAC9B,4BAA4B;CAC5B,6CAA6C;CAC7C,eAAe;CACf,0BAA0B;CAC1B,4BAA4B;CAC5B,mBAAmB;AACpB;;AAEA;CACC,gBAAgB;CAChB,mBAAmB;CACnB,uBAAuB;AACxB;;AAEA;CACC,iBAAiB;AAClB;;AAEA;CACC,iBAAiB;CACjB,wBAAwB;AACzB;;AAEA;CACC,yBAAyB;AAC1B;;AAEA;;CAEC,YAAY;CACZ,yCAAyC;AAC1C;;AAEA,uDAAuD;;AAEvD;CACC,kBAAkB;CAClB,4BAA4B;CAC5B,kBAAkB;CAClB,+CAA+C;CAC/C,gDAAgD;CAChD,2CAA2C;CAC3C,kCAAkC;AACnC;;AAEA;CACC,yFAAyF;CACzF,UAAU;AACX;;AAEA,uDAAuD;;AAEvD;CACC,2BAA2B;CAC3B,8BAA8B;CAC9B,mBAAmB;CACnB,oCAAoC;CACpC,mBAAmB;CACnB,gBAAgB;CAChB,WAAW;CACX,eAAe;CACf,kBAAkB;CAClB,yBAAyB;CACzB,gBAAgB;CAChB,kBAAkB;CAClB,wBAAwB;AACzB;AACA,iFAAiF;AACjF;CACC,eAAe;AAChB;;AAEA;CACC,kBAAkB;CAClB,4BAA4B;CAC5B,mBAAmB;CACnB,YAAY;CACZ,gBAAgB;AACjB;;AAEA;CACC,aAAa;AACd;;AAEA;CACC,WAAW;AACZ;;AAEA;CACC,aAAa;CACb,kBAAkB;CAClB,sBAAsB;AACvB;;AAEA;CACC,6CAA6C;AAC9C;;AAEA;CACC,aAAa;AACd;;AAEA;CACC,kBAAkB;CAClB,6CAA6C;AAC9C;;AAEA;CACC,aAAa;AACd;AACA,8CAA8C;AAC9C;CACC,iBAAiB;AAClB;;AAEA;CACC,aAAa;CACb,+BAA+B;CAC/B,mBAAmB;CACnB,4BAA4B;CAC5B,0BAA0B;CAC1B,eAAe;AAChB;;AAEA;CACC,uBAAuB;CACvB,gBAAgB;CAChB,mBAAmB;CACnB,YAAY;CACZ,eAAe;AAChB;;AAEA;CACC,UAAU;CACV,yFAAyF;AAC1F;;AAEA,uDAAuD;;AAEvD;CACC,gBAAgB;CAChB,WAAW;CACX,kBAAkB;CAClB,2BAA2B;CAC3B,YAAY;CACZ,gBAAgB;CAChB,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,oBAAoB;CACpB,eAAe;CACf,oBAAoB;CACpB,0BAA0B;CAC1B,uBAAuB;CACvB,iBAAiB;CACjB,YAAY;CACZ,aAAa;CACb,uBAAuB;CACvB,WAAW;CACX,gBAAgB;CAChB,kCAAkC;CAClC,oCAAoC;AACrC;;AAEA;CACC,WAAW;CACX,YAAY;CACZ,aAAa;CACb,mBAAmB;CACnB,mBAAmB;CACnB,wBAAwB;AACzB;;AAEA;CACC,cAAc;AACf;;AAEA,oCAAoC;AACpC,0FAA0F;AAC1F,uEAAuE;AACvE;CACC;EACC,gCAAgC;EAChC;GACC,eAAe;EAChB;CACD;AACD;;AAEA,6CAA6C;;AAE7C;CACC,kBAAkB;CAClB,QAAQ;CACR,SAAS;CACT,WAAW;CACX,YAAY;CACZ,qCAAqC;CACrC,sCAAsC;CACtC,mBAAmB;CACnB,gCAAgC;CAChC,aAAa;CACb,mBAAmB;CACnB,gBAAgB;CAChB,2BAA2B;AAC5B;;AAEA;CACC,aAAa;CACb,sBAAsB;CACtB,kBAAkB;CAClB,eAAe;CACf,oCAAoC;CACpC,2BAA2B;CAC3B,8BAA8B;CAC9B,eAAe;CACf,gBAAgB;CAChB,gBAAgB;CAChB,eAAe;CACf,eAAe;AAChB;;AAEA;CACC,kBAAkB;CAClB,aAAa;CACb,mBAAmB;CACnB,OAAO;CACP,mCAAmC;CACnC,4BAA4B;CAC5B,wBAAwB;CACxB,YAAY;AACb;;AAEA;CACC,OAAO;CACP,oBAAoB;CACpB,eAAe;CACf,WAAW;CACX,0BAA0B;AAC3B;;AAEA;CACC,sBAAsB;AACvB;;AAEA;CACC,sCAAsC;CACtC,SAAS;CACT,gBAAgB;CAChB,kBAAkB;CAClB,0BAA0B;CAC1B,gBAAgB;CAChB,yBAAyB;AAC1B;AACA;CACC,4BAA4B;AAC7B;;AAEA;;CAEC,kBAAkB;CAClB,aAAa;CACb,sBAAsB;CACtB,mBAAmB;AACpB;;AAEA;CACC,kBAAkB;CAClB,gBAAgB;CAChB,mCAAmC;AACpC;;AAEA;CACC,aAAa;CACb,mBAAmB;CACnB,yBAAyB;AAC1B;;AAEA;CACC,kBAAkB;AACnB;;AAEA,uDAAuD;;AAEvD,mBAAmB;AACnB;CACC,uBAAuB;CACvB,WAAW;CACX,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,YAAY;CACZ,iDAAiD;AAClD;;AAEA,qBAAqB;AACrB;CACC,kBAAkB;CAClB,kBAAkB;CAClB,aAAa;CACb,mBAAmB;CACnB,qBAAqB;AACtB;;AAEA;CACC,kBAAkB;AACnB;;AAEA,kCAAkC;AAClC;CACC,kBAAkB;CAClB,2BAA2B;CAC3B,WAAW;CACX,oBAAoB;CACpB,QAAQ;CACR,YAAY;AACb;;AAEA;CACC,aAAa;AACd;;AAEA;CACC,aAAa;CACb,kBAAkB;CAClB,mBAAmB;CACnB,2BAA2B;CAC3B,kCAAkC;CAClC,uCAAuC;CACvC,wCAAwC;CACxC,yCAAyC;CACzC,gBAAgB;CAChB,iBAAiB;CACjB,mBAAmB;CACnB,kBAAkB;AACnB;;AAEA;CACC,aAAa;CACb,mBAAmB;CACnB,mBAAmB;CACnB,8BAA8B;CAC9B,4BAA4B;CAC5B,mBAAmB;CACnB,kBAAkB;CAClB,8BAA8B;CAC9B,2BAA2B;AAC5B;AACA;CACC,aAAa;CACb,mBAAmB;CACnB,mBAAmB;AACpB;;AAEA;CACC,WAAW;AACZ;;AAEA;CACC,WAAW;CACX,YAAY;AACb;;AAEA;CACC,uFAAuF;AACxF;;AAEA;CACC,0CAA0C;AAC3C;;AAEA,uDAAuD;;AAEvD;CACC,mBAAmB;CACnB,kBAAkB;CAClB,sBAAsB;CACtB,qBAAqB;CACrB,4BAA4B;CAC5B,yCAAyC;CACzC,mBAAmB;AACpB;;AAEA,uDAAuD;;AAEvD;CACC,iCAAiC;CACjC,gBAAgB;CAChB,uBAAuB;AACxB;;AAEA;CACC,0BAA0B;CAC1B,oBAAoB;AACrB;;AAEA,uDAAuD;;AAEvD;CACC,aAAa;AACd;;AAEA;CACC,2BAA2B;CAC3B,mBAAmB;CACnB,kBAAkB;CAClB,8BAA8B;CAC9B,mBAAmB;CACnB,kBAAkB;CAClB,gBAAgB;CAChB,yBAAyB;CACzB,oCAAoC;CACpC,2BAA2B;AAC5B;;AAEA;CACC,aAAa;AACd;;AAEA;CACC,kBAAkB;CAClB,SAAS;CACT,wBAAwB;CACxB,mCAAmC;CACnC,iBAAiB;AAClB;;AAEA;CACC,WAAW;AACZ;;AAEA;CACC,aAAa;AACd;;AAEA;CACC,6CAA6C;AAC9C;AACA;CACC,mBAAmB;AACpB;;AAEA;CACC,UAAU;CACV,wFAAwF;AACzF;;AAEA;CACC,UAAU;CACV,yFAAyF;AAC1F;;AAEA,eAAe;;AAEf;CACC,kBAAkB;AACnB;;AAEA;CACC,gBAAgB;AACjB;;AAEA;CACC,eAAe;AAChB;;AAEA;CACC,cAAc;AACf;;AAEA,uDAAuD;;AAEvD;CACC,iBAAiB;AAClB;;AAEA;CACC,WAAW;CACX,cAAc;CACd,kBAAkB;CAClB,WAAW;CACX,SAAS;CACT,UAAU;CACV,YAAY;CACZ;;;;;EAKC;CACD,0CAA0C;CAC1C,2CAA2C;CAC3C,oBAAoB;AACrB;;AAEA,uDAAuD;;AAEvD;CACC,+BAA+B;AAChC;;AAEA,uDAAuD;;AAEvD;CACC,kBAAkB;CAClB,UAAU;CACV,WAAW;CACX,aAAa;CACb,qBAAqB;CACrB,yBAAyB;CACzB,sBAAsB;CACtB,mBAAmB;CACnB,oBAAoB;CACpB,oCAAoC;CACpC,4BAA4B;AAC7B;;AAEA;CACC,mBAAmB;AACpB;;AAEA;CACC,iBAAiB;CACjB,4BAA4B;CAC5B,0BAA0B;AAC3B;;AAEA;CACC,gBAAgB;CAChB,aAAa;CACb,mBAAmB;CACnB,oCAAoC;CACpC,2BAA2B;CAC3B,8BAA8B;CAC9B,eAAe;AAChB;;AAEA;CACC,2BAA2B;AAC5B;;AAEA;CACC,wBAAwB;AACzB;;AAEA;CACC,2BAA2B;AAC5B;;AAEA;CACC,yBAAyB;AAC1B;;AAEA;CACC,YAAY;CACZ,gBAAgB;AACjB;;AAEA;CACC,uBAAuB;CACvB,aAAa;CACb,gBAAgB;CAChB,sBAAsB;CACtB,mBAAmB;AACpB;;AAEA;CACC,8BAA8B;AAC/B;;AAEA;CACC,iBAAiB;CACjB,0BAA0B;CAC1B,6CAA6C;CAC7C,iBAAiB;AAClB;;AAEA;CACC,0BAA0B;CAC1B,uBAAuB;CACvB,WAAW;CACX,YAAY;AACb;;AAEA;CACC,iBAAiB;AAClB;;AAEA;CACC,aAAa;CACb,mBAAmB;CACnB,2BAA2B;CAC3B,cAAc;AACf;;AAEA;CACC,oBAAoB;CACpB,cAAc;AACf;;AAEA;CACC;EACC,gEAAgE;CACjE;;CAEA;EACC,6BAA6B;CAC9B;;CAEA;EACC,sDAAsD;CACvD;;CAEA;EACC,wBAAwB;EACxB,oCAAoC;CACrC;;CAEA;EACC,mCAAmC;CACpC;AACD;;AAEA,uDAAuD;;AAEvD;CACC,WAAW;AACZ;;AAEA;CACC,WAAW;CACX,kBAAkB;CAClB,aAAa;CACb,qBAAqB;CACrB,uBAAuB;AACxB;;AAEA,uDAAuD;;AAEvD;CACC,aAAa;CACb,kBAAkB;CAClB,sBAAsB;CACtB,4BAA4B;CAC5B,mBAAmB;CACnB,kBAAkB;CAClB,SAAS;CACT,WAAW;AACZ;;AAEA;CACC,WAAW;CACX,cAAc;CACd,kBAAkB;CAClB,WAAW;CACX,wBAAwB;CACxB,gBAAgB;CAChB,6CAA6C;CAC7C,+CAA+C;CAC/C,wCAAwC;CACxC,kCAAkC;AACnC;;AAEA;CACC,aAAa;AACd;;AAEA;CACC,UAAU;AACX;;AAEA;CACC;EACC,UAAU;CACX;AACD;;AAEA;CACC,WAAW;CACX,YAAY;CACZ,gBAAgB;CAChB,gBAAgB;CAChB,uBAAuB;CACvB,gBAAgB;AACjB;;AAEA;CACC,kBAAkB;CAClB,WAAW;CACX,YAAY;AACb;;AAEA,uDAAuD;;AAEvD;CACC;EACC,UAAU;CACX;CACA;EACC,UAAU;CACX;AACD;;AAEA;CACC;EACC,kDAAkD;CACnD;CACA;EACC,0BAA0B;CAC3B;AACD;;AAEA;CACC;EACC,qDAAqD;CACtD;CACA;EACC,kDAAkD;CACnD;AACD;;AAEA,uDAAuD;;AAEvD;CACC,kBAAkB;CAClB,aAAa;CACb,sBAAsB;CACtB,YAAY;CACZ,mBAAmB;CACnB,gBAAgB;AACjB;;AAEA;CACC,YAAY;AACb;;AAEA;CACC,aAAa;CACb,mBAAmB;CACnB,mBAAmB;CACnB,WAAW;CACX,YAAY;CACZ,4BAA4B;CAC5B,6CAA6C;AAC9C;;AAEA;CACC,kBAAkB;AACnB;;AAEA;CACC,wBAAwB;CACxB,eAAe;CACf,YAAY;AACb;;AAEA;CACC,YAAY;CACZ,gBAAgB;CAChB,gBAAgB;CAChB,uBAAuB;CACvB,mBAAmB;AACpB;;AAEA;CACC,kBAAkB;CAClB,kBAAkB;CAClB,sBAAsB;CACtB,gBAAgB;CAChB,kBAAkB;CAClB,gBAAgB;CAChB,kBAAkB;AACnB;;AAEA;CACC,kBAAkB;AACnB;;AAEA;CACC,UAAU;AACX;;AAEA;CACC;EACC,UAAU;CACX;AACD;;AAEA;CACC,gBAAgB;AACjB;;AAEA;CACC,WAAW;AACZ;;AAEA;CACC,YAAY;CACZ,kBAAkB;AACnB;;AAEA;CACC,cAAc;CACd,YAAY;CACZ,gBAAgB;CAChB,gBAAgB;CAChB,uBAAuB;CACvB,mBAAmB;AACpB;;AAEA;CACC,kBAAkB;AACnB;;AAEA;CACC,kBAAkB;CAClB,SAAS;CACT,WAAW;CACX,kBAAkB;CAClB,oBAAoB;CACpB,mBAAmB;CACnB,uBAAuB;CACvB,wBAAwB;AACzB;;AAEA;CACC,kBAAkB;CAClB,QAAQ;CACR,SAAS;CACT,WAAW;CACX,mBAAmB;CACnB,aAAa;CACb,mBAAmB;CACnB,mBAAmB;CACnB,gBAAgB;CAChB,2BAA2B;AAC5B;;AAEA;CACC,OAAO;AACR;;AAEA;CACC,YAAY;AACb;;AAEA;CACC,mCAAmC;AACpC;;AAEA;CACC,kBAAkB;CAClB,WAAW;CACX,cAAc;CACd,YAAY;CACZ,YAAY;CACZ,0BAA0B;CAC1B,cAAc;CACd,kBAAkB;AACnB;;AAEA;CACC,gBAAgB;AACjB;;AAEA;CACC,iBAAiB;CACjB,YAAY;AACb;;AAEA,wCAAwC;AACxC,qEAAqE;AACrE,oFAAoF;;AAEpF;CACC,mBAAmB;CACnB,kBAAkB;CAClB,UAAU;CACV,QAAQ;CACR,YAAY;CACZ,eAAe;CACf,WAAW;CACX,iBAAiB;CACjB,WAAW;AACZ;;AAEA;CACC,UAAU;AACX;;AAEA;;;;CAIC,UAAU;AACX;;AAEA;CACC,wFAAwF;AACzF;;AAEA;CACC;EACC,UAAU;CACX;AACD;;AAEA;CACC,YAAY;AACb;;AAEA;CACC,iBAAiB;AAClB;;AAEA;CACC;EACC,UAAU;CACX;;CAEA;EACC,UAAU;CACX;AACD;;AAEA,uDAAuD;;AAEvD,qBAAqB;;AAErB;CACC,aAAa;CACb,sBAAsB;CACtB,mBAAmB;CACnB,wBAAwB;AACzB;;AAEA;CACC,sCAAsC;CACtC,YAAY;CACZ,8BAA8B;CAC9B,2BAA2B;AAC5B;;AAEA,iBAAiB;;AAEjB;CACC,YAAY;CACZ,eAAe;CACf,sCAAsC;CACtC,qCAAqC;CACrC,oBAAoB;AACrB;;AAEA;CACC,aAAa;CACb,sBAAsB;CACtB,8BAA8B;AAC/B;;AAEA;CACC,WAAW;CACX,YAAY;CACZ,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,wBAAwB;CACxB,4BAA4B;CAC5B,kCAAkC;AACnC;;AAEA;CACC,aAAa;CACb,sBAAsB;CACtB,mBAAmB;CACnB,0BAA0B;AAC3B;;AAEA;CACC,sCAAsC;CACtC,YAAY;CACZ,8BAA8B;CAC9B,2BAA2B;AAC5B;;AAEA;CACC,wBAAwB;CACxB,iBAAiB;AAClB;;AAEA;CACC,aAAa;CACb,mBAAmB;CACnB,0BAA0B;AAC3B;;AAEA;CACC,0BAA0B;AAC3B;;AAEA;CACC,cAAc;CACd,kBAAkB;CAClB,UAAU;CACV,iBAAiB;CACjB,mBAAmB;CACnB,yCAAyC;CACzC,oBAAoB;AACrB;;AAEA,uDAAuD;;AAEvD;CACC,aAAa;CACb,mBAAmB;CACnB,mBAAmB;CACnB,wBAAwB;CACxB,kCAAkC;CAClC,yCAAyC;CACzC,2BAA2B;CAC3B,YAAY;CACZ,mBAAmB;CACnB,uBAAuB;CACvB,mBAAmB;CACnB,UAAU;CACV,kBAAkB;CAClB,yBAAyB;CACzB,mBAAmB;CACnB,6BAA6B;AAC9B;;AAEA,uDAAuD;;AAEvD;CACC,6CAA6C;AAC9C;;AAEA;CACC,kBAAkB;CAClB,UAAU;CACV,0BAA0B;CAC1B,mBAAmB;CACnB,kBAAkB;;CAElB,6DAA6D;CAC7D,gBAAgB;AACjB;;AAEA;CACC,UAAU;AACX;;AAEA;CACC,UAAU;AACX;;AAEA;CACC,0BAA0B;CAC1B,8BAA8B;AAC/B;;AAEA;CACC,kBAAkB;CAClB,oBAAoB;CACpB,WAAW;CACX,0BAA0B;CAC1B,YAAY;CACZ,aAAa;CACb,mBAAmB;AACpB;;AAEA;CACC,aAAa;CACb,sBAAsB;CACtB,0BAA0B;AAC3B;;AAEA;CACC,aAAa;CACb,mBAAmB;CACnB,mBAAmB;CACnB,8BAA8B;CAC9B,YAAY;AACb;;AAEA;CACC,OAAO;CACP,eAAe;AAChB;;AAEA,yDAAyD;AACzD;CACC,wBAAwB;CACxB,aAAa;CACb,mBAAmB;CACnB,yBAAyB;CACzB,4BAA4B;CAC5B,mBAAmB;CACnB,gBAAgB;CAChB,kBAAkB;AACnB;;AAEA,wDAAwD;;AAExD;CACC,aAAa;CACb,mBAAmB;CACnB,yBAAyB;CACzB,gBAAgB;CAChB,YAAY;CACZ,eAAe;CACf,mBAAmB;CACnB,8BAA8B;CAC9B,kBAAkB;CAClB,YAAY;AACb;;AAEA;CACC,aAAa;CACb,mBAAmB;AACpB;;AAEA;CACC,YAAY;CACZ,WAAW;CACX,yCAAyC;CACzC,kCAAkC;CAClC,mBAAmB;CACnB,aAAa;CACb,mBAAmB;CACnB,uBAAuB;CACvB,kBAAkB;CAClB,eAAe;CACf,iBAAiB;CACjB,qCAAqC;CACrC,UAAU;AACX;;AAEA;CACC,kBAAkB;AACnB;;AAEA;CACC,UAAU;AACX;;AAEA;CACC;EACC,8BAA8B;CAC/B;AACD;;AAEA;CACC,kBAAkB;CAClB,QAAQ;CACR,UAAU;CACV,cAAc;CACd,eAAe;CACf,gBAAgB;CAChB,0BAA0B;CAC1B,oBAAoB;CACpB,gBAAgB;CAChB,mBAAmB;AACpB;AACA;CACC,8BAA8B;CAC9B,UAAU;AACX;;AAEA;CACC,kBAAkB;CAClB,aAAa;CACb,sBAAsB;CACtB,YAAY;CACZ,mBAAmB;CACnB,gBAAgB;AACjB;;AAEA;CACC,kBAAkB;CAClB,kBAAkB;CAClB,sBAAsB;CACtB,gBAAgB;CAChB,kBAAkB;CAClB,gBAAgB;CAChB,kBAAkB;AACnB;;AAEA;;CAEC,cAAc;AACf;;AAEA;CACC,6CAA6C;AAC9C;;AAEA;CACC,aAAa;CACb,2BAA2B;CAC3B,mBAAmB;AACpB;;AAEA;CACC,cAAc;AACf;;AAEA;CACC,gBAAgB;CAChB,gBAAgB;CAChB,uBAAuB;CACvB,mBAAmB;CACnB,eAAe;CACf,0BAA0B;CAC1B,eAAe;CACf,YAAY;CACZ,gBAAgB;AACjB;;AAEA;CACC,gBAAgB;CAChB,gBAAgB;CAChB,uBAAuB;CACvB,mBAAmB;CACnB,eAAe;CACf,0BAA0B;CAC1B,cAAc;CACd,cAAc;CACd,gBAAgB;AACjB;;AAEA;CACC,YAAY;CACZ,YAAY;CACZ,YAAY;CACZ,WAAW;AACZ;;AAEA;CACC,WAAW;CACX,aAAa;CACb,iBAAiB;CACjB,YAAY;CACZ,QAAQ;CACR,YAAY;CACZ,YAAY;AACb;;AAEA;CACC,kBAAkB;AACnB;;AAEA;CACC,gBAAgB;AACjB;;AAEA;CACC,eAAe;CACf,gBAAgB;AACjB;;AAEA;CACC,WAAW;CACX,aAAa;CACb,iBAAiB;CACjB,2BAA2B;CAC3B,YAAY;CACZ,SAAS;AACV;;AAEA;CACC,gBAAgB;CAChB,mBAAmB;CACnB,gBAAgB;CAChB,uBAAuB;AACxB;;AAEA;CACC,kBAAkB;CAClB,QAAQ;CACR,UAAU;CACV,eAAe;CACf,cAAc;AACf;;AAEA;;CAEC,mBAAmB;AACpB;;AAEA;;CAEC,UAAU;AACX;;AAEA;CACC;EACC,UAAU;CACX;;CAEA;EACC,mBAAmB;CACpB;CACA;EACC,UAAU;CACX;AACD;;AAEA;CACC,eAAe;CACf,QAAQ;CACR,wCAAwC;AACzC;;AAEA,uDAAuD;;AAEvD;CACC,kBAAkB;AACnB;;AAEA;;EAEE;AACF;;CAEC,mBAAmB;AACpB;;AAEA;CACC,sCAAsC;CACtC,UAAU;AACX;;AAEA;CACC,UAAU;CACV,qCAAqC;AACtC;;AAEA;;CAEC,oBAAoB;AACrB;;AAEA;CACC,UAAU;AACX;;AAEA;;CAEC,mBAAmB;AACpB;;AAEA;CACC,iBAAiB;CACjB;;;GAGE;CACF,YAAY;AACb;;AAEA;CACC,YAAY;AACb;;AAEA,yDAAyD;;AAEzD;CACC,eAAe;CACf,SAAS;CACT,aAAa;CACb,iBAAiB;CACjB,4BAA4B;AAC7B;;AAEA;CACC,SAAS;AACV",sourcesContent:["/* THIS CSS FILE IS GENERATED! DO NOT EDIT. OR EDIT. I'M A COMMENT NOT A COP */ \n/* This file is created by the copy-css-files.mjs script in packages/tldraw. */\n/* It combines @tldraw/editor's editor.css and tldraw's ui.css */\n\n/* @tldraw/editor */\n\n.tl-container {\n\twidth: 100%;\n\theight: 100%;\n\tfont-size: 12px;\n\t/* Spacing */\n\t--space-1: 2px;\n\t--space-2: 4px;\n\t--space-3: 8px;\n\t--space-4: 12px;\n\t--space-5: 16px;\n\t--space-6: 20px;\n\t--space-7: 28px;\n\t--space-8: 32px;\n\t--space-9: 64px;\n\t--space-10: 72px;\n\t/* Radius */\n\t--radius-0: 2px;\n\t--radius-1: 4px;\n\t--radius-2: 6px;\n\t--radius-3: 9px;\n\t--radius-4: 11px;\n\n\t/* Canvas z-index */\n\t--layer-canvas-hidden: -999999;\n\t--layer-canvas-background: 100;\n\t--layer-canvas-grid: 150;\n\t--layer-watermark: 200;\n\t--layer-canvas-shapes: 300;\n\t--layer-canvas-overlays: 500;\n\t--layer-canvas-blocker: 10000;\n\n\t/* Canvas overlays z-index */\n\t--layer-overlays-collaborator-scribble: 10;\n\t--layer-overlays-collaborator-brush: 20;\n\t--layer-overlays-collaborator-shape-indicator: 30;\n\t--layer-overlays-user-scribble: 40;\n\t--layer-overlays-user-brush: 50;\n\t--layer-overlays-user-indicator-selected: 60;\n\t--layer-overlays-user-indicator-hovered: 70;\n\t--layer-overlays-user-snapline: 90;\n\t--layer-overlays-selection-fg: 100;\n\t/* User handles need to be above selection edges / corners, matters for sticky note clone handles */\n\t--layer-overlays-user-handles: 105;\n\t--layer-overlays-user-indicator-hint: 110;\n\t--layer-overlays-custom: 115;\n\t--layer-overlays-collaborator-cursor-hint: 120;\n\t--layer-overlays-collaborator-cursor: 130;\n\n\t/* Text editor z-index */\n\t--layer-text-container: 1;\n\t--layer-text-content: 3;\n\t--layer-text-editor: 4;\n\n\t/* Error fallback z-index */\n\t--layer-error-overlay: 1;\n\t--layer-error-canvas: 2;\n\t--layer-error-canvas-after: 3;\n\t--layer-error-content: 4;\n\n\t/* Misc */\n\t--tl-zoom: 1;\n\n\t/* Cursor SVGs */\n\t--tl-cursor-none: none;\n\t--tl-cursor-default:\n\t\turl(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path d='m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z' fill='white'/><path d='m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z' fill='white'/><path d='m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z' fill='black'/><path d='m13 10.814v11.188l2.969-2.866.428-.139h4.768z' fill='black'/></g></svg>\")\n\t\t\t12 8,\n\t\tdefault;\n\t--tl-cursor-pointer:\n\t\turl(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path d='m13.3315 21.3799c-.284-.359-.629-1.093-1.243-1.984-.348-.504-1.211-1.453-1.468-1.935-.223-.426-.199-.617-.146-.97.094-.628.738-1.117 1.425-1.051.519.049.959.392 1.355.716.239.195.533.574.71.788.163.196.203.277.377.509.23.307.302.459.214.121-.071-.496-.187-1.343-.355-2.092-.128-.568-.159-.657-.281-1.093-.129-.464-.195-.789-.316-1.281-.084-.348-.235-1.059-.276-1.459-.057-.547-.087-1.439.264-1.849.275-.321.906-.418 1.297-.22.512.259.803 1.003.936 1.3.239.534.387 1.151.516 1.961.164 1.031.466 2.462.476 2.763.024-.369-.068-1.146-.004-1.5.058-.321.328-.694.666-.795.286-.085.621-.116.916-.055.313.064.643.288.766.499.362.624.369 1.899.384 1.831.086-.376.071-1.229.284-1.584.14-.234.497-.445.687-.479.294-.052.655-.068.964-.008.249.049.586.345.677.487.218.344.342 1.317.379 1.658.015.141.074-.392.293-.736.406-.639 1.843-.763 1.898.639.025.654.02.624.02 1.064 0 .517-.012.828-.04 1.202-.031.4-.117 1.304-.242 1.742-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.191 1.813-.118.562-.079.566-.102.965-.023.398.121.922.121.922s-.802.104-1.234.035c-.391-.063-.875-.841-1-1.079-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.031-3.139.02 0 0 .185-1.011-.227-1.358-.305-.259-.83-.784-1.144-1.06z' fill='white'/><g stroke='black' stroke-linecap='round' stroke-width='.75'><path d='m13.3315 21.3799c-.284-.359-.629-1.093-1.243-1.984-.348-.504-1.211-1.453-1.468-1.935-.223-.426-.199-.617-.146-.97.094-.628.738-1.117 1.425-1.051.519.049.959.392 1.355.716.239.195.533.574.71.788.163.196.203.277.377.509.23.307.302.459.214.121-.071-.496-.187-1.343-.355-2.092-.128-.568-.159-.657-.281-1.093-.129-.464-.195-.789-.316-1.281-.084-.348-.235-1.059-.276-1.459-.057-.547-.087-1.439.264-1.849.275-.321.906-.418 1.297-.22.512.259.803 1.003.936 1.3.239.534.387 1.151.516 1.961.164 1.031.466 2.462.476 2.763.024-.369-.068-1.146-.004-1.5.058-.321.328-.694.666-.795.286-.085.621-.116.916-.055.313.064.643.288.766.499.362.624.369 1.899.384 1.831.086-.376.071-1.229.284-1.584.14-.234.497-.445.687-.479.294-.052.655-.068.964-.008.249.049.586.345.677.487.218.344.342 1.317.379 1.658.015.141.074-.392.293-.736.406-.639 1.843-.763 1.898.639.025.654.02.624.02 1.064 0 .517-.012.828-.04 1.202-.031.4-.117 1.304-.242 1.742-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.191 1.813-.118.562-.079.566-.102.965-.023.398.121.922.121.922s-.802.104-1.234.035c-.391-.063-.875-.841-1-1.079-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.031-3.139.02 0 0 .185-1.011-.227-1.358-.305-.259-.83-.784-1.144-1.06z' stroke-linejoin='round'/><path d='m21.5664 21.7344v-3.459'/><path d='m19.5508 21.7461-.016-3.473'/><path d='m17.5547 18.3047.021 3.426'/></g></g></svg>\")\n\t\t\t14 10,\n\t\tpointer;\n\t--tl-cursor-cross:\n\t\turl(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path d='m25 16h-6.01v-6h-2.98v6h-6.01v3h6.01v6h2.98v-6h6.01z' fill='white'/><path d='m23.9902 17.0103h-6v-6.01h-.98v6.01h-6v.98h6v6.01h.98v-6.01h6z' fill='%23231f1f'/></g></svg>\")\n\t\t\t16 16,\n\t\tcrosshair;\n\t--tl-cursor-move:\n\t\turl(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path d='m19 14h1v1h-1zm1 6h-1v-1h1zm-5-5h-1v-1h1zm0 5h-1v-1h1zm2-10.987-7.985 7.988 5.222 5.221 2.763 2.763 7.984-7.985z' fill='white'/><g fill='black'><path d='m23.5664 16.9971-2.557-2.809v1.829h-4.009-4.001v-1.829l-2.571 2.809 2.572 2.808-.001-1.808h4.001 4.009l-.001 1.808z'/><path d='m17.9873 17h.013v-4.001l1.807.001-2.807-2.571-2.809 2.57h1.809v4.001h.008v4.002l-1.828-.001 2.807 2.577 2.805-2.576h-1.805z'/></g></g></svg>\")\n\t\t\t16 16,\n\t\tmove;\n\t--tl-cursor-grab:\n\t\turl(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path d='m13.5557 17.5742c-.098-.375-.196-.847-.406-1.552-.167-.557-.342-.859-.47-1.233-.155-.455-.303-.721-.496-1.181-.139-.329-.364-1.048-.457-1.44-.119-.509.033-.924.244-1.206.253-.339.962-.49 1.357-.351.371.13.744.512.916.788.288.46.357.632.717 1.542.393.992.564 1.918.611 2.231l.085.452c-.001-.04-.043-1.122-.044-1.162-.035-1.029-.06-1.823-.038-2.939.002-.126.064-.587.084-.715.078-.5.305-.8.673-.979.412-.201.926-.215 1.401-.017.423.173.626.55.687 1.022.014.109.094.987.093 1.107-.013 1.025.006 1.641.015 2.174.004.231.003 1.625.017 1.469.061-.656.094-3.189.344-3.942.144-.433.405-.746.794-.929.431-.203 1.113-.07 1.404.243.285.305.446.692.482 1.153.032.405-.019.897-.02 1.245 0 .867-.021 1.324-.037 2.121-.001.038-.015.298.023.182.094-.28.188-.542.266-.745.049-.125.241-.614.359-.859.114-.234.211-.369.415-.688.2-.313.415-.448.668-.561.54-.235 1.109.112 1.301.591.086.215.009.713-.028 1.105-.061.647-.254 1.306-.352 1.648-.128.447-.274 1.235-.34 1.601-.072.394-.234 1.382-.359 1.82-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.192 1.812-.117.563-.078.567-.101.965-.024.399.121.923.121.923s-.802.104-1.234.034c-.391-.062-.875-.841-1-1.078-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.03-3.139.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.284-.36-.629-1.093-1.243-1.985-.348-.504-1.027-1.085-1.284-1.579-.223-.425-.331-.954-.19-1.325.225-.594.675-.897 1.362-.832.519.05.848.206 1.238.537.225.19.573.534.75.748.163.195.203.276.377.509.23.307.302.459.214.121' fill='white'/><g stroke='black' stroke-linecap='round' stroke-width='.75'><path d='m13.5557 17.5742c-.098-.375-.196-.847-.406-1.552-.167-.557-.342-.859-.47-1.233-.155-.455-.303-.721-.496-1.181-.139-.329-.364-1.048-.457-1.44-.119-.509.033-.924.244-1.206.253-.339.962-.49 1.357-.351.371.13.744.512.916.788.288.46.357.632.717 1.542.393.992.564 1.918.611 2.231l.085.452c-.001-.04-.043-1.122-.044-1.162-.035-1.029-.06-1.823-.038-2.939.002-.126.064-.587.084-.715.078-.5.305-.8.673-.979.412-.201.926-.215 1.401-.017.423.173.626.55.687 1.022.014.109.094.987.093 1.107-.013 1.025.006 1.641.015 2.174.004.231.003 1.625.017 1.469.061-.656.094-3.189.344-3.942.144-.433.405-.746.794-.929.431-.203 1.113-.07 1.404.243.285.305.446.692.482 1.153.032.405-.019.897-.02 1.245 0 .867-.021 1.324-.037 2.121-.001.038-.015.298.023.182.094-.28.188-.542.266-.745.049-.125.241-.614.359-.859.114-.234.211-.369.415-.688.2-.313.415-.448.668-.561.54-.235 1.109.112 1.301.591.086.215.009.713-.028 1.105-.061.647-.254 1.306-.352 1.648-.128.447-.274 1.235-.34 1.601-.072.394-.234 1.382-.359 1.82-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.192 1.812-.117.563-.078.567-.101.965-.024.399.121.923.121.923s-.802.104-1.234.034c-.391-.062-.875-.841-1-1.078-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.03-3.139.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.284-.36-.629-1.093-1.243-1.985-.348-.504-1.027-1.085-1.284-1.579-.223-.425-.331-.954-.19-1.325.225-.594.675-.897 1.362-.832.519.05.848.206 1.238.537.225.19.573.534.75.748.163.195.203.276.377.509.23.307.302.459.214.121' stroke-linejoin='round'/><path d='m20.5664 21.7344v-3.459'/><path d='m18.5508 21.7461-.016-3.473'/><path d='m16.5547 18.3047.021 3.426'/></g></g></svg>\")\n\t\t\t16 16,\n\t\tgrab;\n\t--tl-cursor-grabbing:\n\t\turl(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path d='m13.5732 12.0361c.48-.178 1.427-.069 1.677.473.213.462.396 1.241.406 1.075.024-.369-.024-1.167.137-1.584.117-.304.347-.59.686-.691.285-.086.62-.116.916-.055.313.064.642.287.765.499.362.623.368 1.899.385 1.831.064-.272.07-1.229.283-1.584.141-.235.497-.445.687-.479.294-.052.656-.068.964-.008.249.049.586.344.677.487.219.344.342 1.316.379 1.658.016.141.074-.393.293-.736.406-.639 1.844-.763 1.898.639.026.654.02.624.02 1.064 0 .516-.012.828-.04 1.202-.03.399-.116 1.304-.241 1.742-.086.301-.371.978-.653 1.384 0 0-1.074 1.25-1.191 1.812-.117.563-.078.567-.102.965-.023.399.121.923.121.923s-.801.104-1.234.034c-.391-.062-.875-.84-1-1.078-.172-.328-.539-.265-.682-.023-.224.383-.709 1.07-1.05 1.113-.669.084-2.055.03-3.14.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.283-.36-1.002-.929-1.243-1.985-.213-.936-.192-1.395.037-1.77.232-.381.67-.589.854-.625.208-.042.692-.039.875.062.223.123.313.159.488.391.23.307.312.456.213.121-.076-.262-.322-.595-.434-.97-.109-.361-.401-.943-.38-1.526.008-.221.103-.771.832-1.042' fill='white'/><g stroke='black' stroke-width='.75'><path d='m13.5732 12.0361c.48-.178 1.427-.069 1.677.473.213.462.396 1.241.406 1.075.024-.369-.024-1.167.137-1.584.117-.304.347-.59.686-.691.285-.086.62-.116.916-.055.313.064.642.287.765.499.362.623.368 1.899.385 1.831.064-.272.07-1.229.283-1.584.141-.235.497-.445.687-.479.294-.052.656-.068.964-.008.249.049.586.344.677.487.219.344.342 1.316.379 1.658.016.141.074-.393.293-.736.406-.639 1.844-.763 1.898.639.026.654.02.624.02 1.064 0 .516-.012.828-.04 1.202-.03.399-.116 1.304-.241 1.742-.086.301-.371.978-.653 1.384 0 0-1.074 1.25-1.191 1.812-.117.563-.078.567-.102.965-.023.399.121.923.121.923s-.801.104-1.234.034c-.391-.062-.875-.84-1-1.078-.172-.328-.539-.265-.682-.023-.224.383-.709 1.07-1.05 1.113-.669.084-2.055.03-3.14.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.283-.36-1.002-.929-1.243-1.985-.213-.936-.192-1.395.037-1.77.232-.381.67-.589.854-.625.208-.042.692-.039.875.062.223.123.313.159.488.391.23.307.312.456.213.121-.076-.262-.322-.595-.434-.97-.109-.361-.401-.943-.38-1.526.008-.221.103-.771.832-1.042z' stroke-linejoin='round'/><path d='m20.5664 19.7344v-3.459' stroke-linecap='round'/><path d='m18.5508 19.7461-.016-3.473' stroke-linecap='round'/><path d='m16.5547 16.3047.021 3.426' stroke-linecap='round'/></g></g></svg>\")\n\t\t\t16 16,\n\t\tgrabbing;\n\t--tl-cursor-text:\n\t\turl(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path fill='white' d='M7.94 0a5.25 5.25 0 0 0-3.47 1.17A5.27 5.27 0 0 0 1 0H0v3h1c1.41 0 1.85.7 2 1v3.94H2v3h1v3c-.13.3-.57 1-2 1H0v3h1a5.27 5.27 0 0 0 3.47-1.17c.98.8 2.21 1.21 3.47 1.17h1v-3h-1c-1.41 0-1.85-.7-2-1v-3H7v-3H6V4c.13-.3.57-1 2-1h1V0H7.94z'/><path fill='black' d='M7.94 2V1a4 4 0 0 0-3.47 1.64A4 4 0 0 0 1 1v1c1.3-.17 2.56.6 3 1.84v5.1H3v1h1v4.16c-.45 1.24-1.7 2-3 1.84v1a4.05 4.05 0 0 0 3.47-1.63 4.05 4.05 0 0 0 3.47 1.63v-1A2.82 2.82 0 0 1 5 14.1V9.93h1v-1H5V3.85A2.81 2.81 0 0 1 7.94 2z'/></g></svg>\")\n\t\t\t4 10,\n\t\ttext;\n\t--tl-cursor-zoom-in:\n\t\turl(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path d='m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5' fill='white'/><path d='m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z' stroke='black'/><g fill='black'><path d='m18 14h-2v-2h-2v2h-2v1.98h2v2.02h2v-2.02h2z'/><path d='m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z'/></g></g></svg>\")\n\t\t\t16 16,\n\t\tzoom-in;\n\t--tl-cursor-zoom-out:\n\t\turl(\"data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path d='m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5' fill='white'/><path d='m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z' stroke='black'/><g fill='black'><path d='m18 16h-5.98v-1.98h5.98z'/><path d='m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z'/></g></g></svg>\")\n\t\t\t16 16,\n\t\tzoom-out;\n\n\t/* These cursor values get programmatically overridden */\n\t/* They're just here to help your editor autocomplete */\n\t--tl-cursor: var(--tl-cursor-default);\n\t--tl-cursor-resize-edge: ew-resize;\n\t--tl-cursor-resize-corner: nesw-resize;\n\t--tl-cursor-ew-resize: ew-resize;\n\t--tl-cursor-ns-resize: ns-resize;\n\t--tl-cursor-nesw-resize: nesw-resize;\n\t--tl-cursor-nwse-resize: nwse-resize;\n\t--tl-cursor-rotate: pointer;\n\t--tl-cursor-nwse-rotate: pointer;\n\t--tl-cursor-nesw-rotate: pointer;\n\t--tl-cursor-senw-rotate: pointer;\n\t--tl-cursor-swne-rotate: pointer;\n\t--tl-scale: calc(1 / var(--tl-zoom));\n\t/* fonts */\n\t--tl-font-draw: 'tldraw_draw', sans-serif;\n\t--tl-font-sans: 'tldraw_sans', sans-serif;\n\t--tl-font-serif: 'tldraw_serif', serif;\n\t--tl-font-mono: 'tldraw_mono', monospace;\n\t/* text outline */\n\t--a: calc(min(0.5, 1 / var(--tl-zoom)) * 2px);\n\t--b: calc(min(0.5, 1 / var(--tl-zoom)) * -2px);\n\t--tl-text-outline-reference:\n\t\t0 var(--b) 0 var(--color-background), 0 var(--a) 0 var(--color-background),\n\t\tvar(--b) var(--b) 0 var(--color-background), var(--a) var(--b) 0 var(--color-background),\n\t\tvar(--a) var(--a) 0 var(--color-background), var(--b) var(--a) 0 var(--color-background);\n\t--tl-text-outline: var(--tl-text-outline-reference);\n\t/* own properties */\n\tposition: relative;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\toverflow: clip;\n\tcolor: var(--color-text);\n}\n\n.tl-theme__light {\n\t--color-accent: hsl(0, 76%, 60%);\n\t--color-background: hsl(210, 20%, 98%);\n\t--color-brush-fill: hsl(0, 0%, 56%, 10.2%);\n\t--color-brush-stroke: hsl(0, 0%, 56%, 25.1%);\n\t--color-grid: hsl(0, 0%, 43%);\n\t--color-low: hsl(204, 16%, 94%);\n\t--color-low-border: hsl(204, 16%, 92%);\n\t--color-culled: hsl(204, 14%, 93%);\n\t--color-muted-none: hsl(0, 0%, 0%, 0%);\n\t--color-muted-0: hsl(0, 0%, 0%, 2%);\n\t--color-muted-1: hsl(0, 0%, 0%, 10%);\n\t--color-muted-2: hsl(0, 0%, 0%, 4.3%);\n\t--color-hint: hsl(0, 0%, 0%, 5.5%);\n\t--color-overlay: hsl(0, 0%, 0%, 20%);\n\t--color-divider: hsl(0, 0%, 91%);\n\t--color-panel-contrast: hsl(0, 0%, 100%);\n\t--color-panel-overlay: hsl(0, 0%, 100%, 82%);\n\t--color-panel: hsl(0, 0%, 99%);\n\t--color-panel-transparent: hsla(0, 0%, 99%, 0%);\n\t--color-focus: hsl(219, 65%, 50%);\n\t--color-selected: hsl(214, 84%, 56%);\n\t--color-selected-contrast: hsl(0, 0%, 100%);\n\t--color-selection-fill: hsl(210, 100%, 56%, 24%);\n\t--color-selection-stroke: hsl(214, 84%, 56%);\n\t--color-text-0: hsl(0, 0%, 11%);\n\t--color-text-1: hsl(0, 0%, 18%);\n\t--color-text-3: hsl(220, 2%, 65%);\n\t--color-text-shadow: hsl(0, 0%, 100%);\n\t--color-text-highlight: hsl(52, 100%, 50%);\n\t--color-text-highlight-p3: color(display-p3 0.972 0.8205 0.05);\n\t--color-primary: hsl(214, 84%, 56%);\n\t--color-success: hsl(123, 46%, 34%);\n\t--color-info: hsl(201, 98%, 41%);\n\t--color-warning: hsl(27, 98%, 47%);\n\t--color-error: hsl(0, 65%, 51%);\n\t--color-warn: hsl(0, 90%, 43%);\n\t--color-text: hsl(0, 0%, 0%);\n\t--color-laser: hsl(0, 100%, 50%);\n\t/* Shadows */\n\t--shadow-1: 0px 1px 2px hsl(0, 0%, 0%, 25%), 0px 1px 3px hsl(0, 0%, 0%, 9%);\n\t--shadow-2:\n\t\t0px 0px 2px hsl(0, 0%, 0%, 16%), 0px 2px 3px hsl(0, 0%, 0%, 24%),\n\t\t0px 2px 6px hsl(0, 0%, 0%, 0.1), inset 0px 0px 0px 1px var(--color-panel-contrast);\n\t--shadow-3:\n\t\t0px 1px 2px hsl(0, 0%, 0%, 28%), 0px 2px 6px hsl(0, 0%, 0%, 14%),\n\t\tinset 0px 0px 0px 1px var(--color-panel-contrast);\n\t--shadow-4:\n\t\t0px 0px 3px hsl(0, 0%, 0%, 19%), 0px 5px 4px hsl(0, 0%, 0%, 16%),\n\t\t0px 2px 16px hsl(0, 0%, 0%, 6%), inset 0px 0px 0px 1px var(--color-panel-contrast);\n}\n\n.tl-theme__dark {\n\t--color-accent: hsl(0, 76%, 60%);\n\t--color-background: hsl(240, 5%, 6.5%);\n\t--color-brush-fill: hsl(0, 0%, 71%, 5.1%);\n\t--color-brush-stroke: hsl(0, 0%, 71%, 25.1%);\n\t--color-grid: hsl(0, 0%, 40%);\n\t--color-low: hsl(260, 4.5%, 10.5%);\n\t--color-low-border: hsl(207, 10%, 10%);\n\t--color-culled: hsl(210, 11%, 19%);\n\t--color-muted-none: hsl(0, 0%, 100%, 0%);\n\t--color-muted-0: hsl(0, 0%, 100%, 2%);\n\t--color-muted-1: hsl(0, 0%, 100%, 10%);\n\t--color-muted-2: hsl(0, 0%, 100%, 5%);\n\t--color-hint: hsl(0, 0%, 100%, 7%);\n\t--color-overlay: hsl(0, 0%, 0%, 50%);\n\t--color-divider: hsl(240, 9%, 22%);\n\t--color-panel-contrast: hsl(245, 12%, 23%);\n\t--color-panel: hsl(235, 6.8%, 13.5%);\n\t--color-panel-overlay: hsl(210, 10%, 24%, 82%);\n\t--color-panel-transparent: hsla(235, 6.8%, 13.5%, 0%);\n\t--color-focus: hsl(217, 76%, 80%);\n\t--color-selected: hsl(217, 89%, 61%);\n\t--color-selected-contrast: hsl(0, 0%, 100%);\n\t--color-selection-fill: hsl(209, 100%, 57%, 20%);\n\t--color-selection-stroke: hsl(214, 84%, 56%);\n\t--color-text-0: hsl(0, 9%, 94%);\n\t--color-text-1: hsl(0, 0%, 85%);\n\t--color-text-3: hsl(210, 6%, 45%);\n\t--color-text-shadow: hsl(210, 13%, 18%);\n\t--color-text-highlight: hsl(52, 100%, 41%);\n\t--color-text-highlight-p3: color(display-p3 0.8078 0.6225 0.0312);\n\t--color-primary: hsl(214, 84%, 56%);\n\t--color-success: hsl(123, 38%, 57%);\n\t--color-info: hsl(199, 92%, 56%);\n\t--color-warning: hsl(36, 100%, 57%);\n\t--color-error: hsl(4, 90%, 58%);\n\t--color-warn: hsl(0, 81%, 66%);\n\t--color-text: hsl(210, 17%, 98%);\n\t--color-laser: hsl(0, 100%, 50%);\n\t/* Shadows */\n\t--shadow-1:\n\t\t0px 1px 2px hsl(0, 0%, 0%, 16.1%), 0px 1px 3px hsl(0, 0%, 0%, 22%),\n\t\tinset 0px 0px 0px 1px var(--color-panel-contrast);\n\t--shadow-2:\n\t\t0px 1px 3px hsl(0, 0%, 0%, 66.6%), 0px 2px 6px hsl(0, 0%, 0%, 33%),\n\t\tinset 0px 0px 0px 1px var(--color-panel-contrast);\n\t--shadow-3:\n\t\t0px 1px 3px hsl(0, 0%, 0%, 50%), 0px 2px 12px hsl(0, 0%, 0%, 50%),\n\t\tinset 0px 0px 0px 1px var(--color-panel-contrast);\n}\n\n.tl-counter-scaled {\n\ttransform: scale(var(--tl-scale));\n\ttransform-origin: top left;\n\twidth: calc(100% * var(--tl-zoom));\n\theight: calc(100% * var(--tl-zoom));\n}\n\n.tl-container,\n.tl-container * {\n\t-webkit-touch-callout: none;\n\t-webkit-tap-highlight-color: transparent;\n\tscrollbar-highlight-color: transparent;\n\t-webkit-user-select: none;\n\tuser-select: none;\n\tbox-sizing: border-box;\n\toutline: none;\n}\n\n.tl-container a {\n\t-webkit-touch-callout: initial;\n}\n\n.tl-container__focused {\n\toutline: 1px solid var(--color-low);\n}\n\ninput,\n*[contenteditable],\n*[contenteditable] * {\n\tuser-select: text;\n}\n\n/* -------------------------------------------------- */\n/*                       Canvas                       */\n/* -------------------------------------------------- */\n\n.tl-canvas {\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tcolor: var(--color-text);\n\tcursor: var(--tl-cursor);\n\toverflow: clip;\n\tcontent-visibility: auto;\n\ttouch-action: none;\n\tcontain: strict;\n}\n\n.tl-shapes {\n\tposition: relative;\n\tz-index: var(--layer-canvas-shapes);\n}\n\n.tl-overlays {\n\tposition: absolute;\n\ttop: 0px;\n\tleft: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tcontain: strict;\n\tpointer-events: none;\n\tz-index: var(--layer-canvas-overlays);\n}\n\n.tl-overlays__item {\n\tposition: absolute;\n\ttop: 0px;\n\tleft: 0px;\n\toverflow: visible;\n\tpointer-events: none;\n\ttransform-origin: top left;\n}\n\n.tl-svg-context {\n\tposition: absolute;\n\ttop: 0px;\n\tleft: 0px;\n\twidth: 100%;\n\theight: 100%;\n\tpointer-events: none;\n}\n\n/* ------------------- Background ------------------- */\n\n.tl-background__wrapper {\n\tz-index: var(--layer-canvas-background);\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n}\n\n.tl-background {\n\tbackground-color: var(--color-background);\n\twidth: 100%;\n\theight: 100%;\n}\n\n/* --------------------- Grid Layer --------------------- */\n\n.tl-grid {\n\tposition: absolute;\n\tinset: 0px;\n\twidth: 100%;\n\theight: 100%;\n\ttouch-action: none;\n\tpointer-events: none;\n\tz-index: var(--layer-canvas-grid);\n\tcontain: strict;\n}\n\n.tl-grid-dot {\n\tfill: var(--color-grid);\n}\n\n/* --------------------- Layers --------------------- */\n\n.tl-html-layer {\n\tposition: absolute;\n\ttop: 0px;\n\tleft: 0px;\n\twidth: 1px;\n\theight: 1px;\n\tcontain: layout style size;\n}\n\n/* ---------------------- Brush --------------------- */\n\n.tl-brush {\n\tstroke-width: calc(var(--tl-scale) * 1px);\n\tcontain: size layout;\n}\n\n.tl-brush__default {\n\tstroke: var(--color-brush-stroke);\n\tfill: var(--color-brush-fill);\n}\n\n/* -------------------- Scribble -------------------- */\n\n.tl-scribble {\n\tstroke-linejoin: round;\n\tstroke-linecap: round;\n\tpointer-events: none;\n\tcontain: size layout;\n}\n\n/* ---------------------- Shape --------------------- */\n\n.tl-shape {\n\tposition: absolute;\n\tpointer-events: none;\n\toverflow: visible;\n\ttransform-origin: top left;\n\tcontain: size layout;\n}\n\n/* ---------------- Shape Containers ---------------- */\n\n.tl-svg-container {\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tpointer-events: none;\n\tstroke-linecap: round;\n\tstroke-linejoin: round;\n\ttransform-origin: top left;\n\toverflow: visible;\n}\n\n.tl-html-container {\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tpointer-events: none;\n\tstroke-linecap: round;\n\tstroke-linejoin: round;\n\t/* content-visibility: auto; */\n\ttransform-origin: top left;\n\tcolor: inherit;\n}\n\n/* --------------- Overlay Stack --------------- */\n\n/* back of the stack, behind user's stuff */\n.tl-collaborator__scribble {\n\tz-index: var(--layer-overlays-collaborator-scribble);\n}\n\n.tl-collaborator__brush {\n\tz-index: var(--layer-overlays-collaborator-brush);\n}\n\n.tl-collaborator__shape-indicator {\n\tz-index: var(--layer-overlays-collaborator-shape-indicator);\n}\n\n.tl-user-scribble {\n\tz-index: var(--layer-overlays-user-scribble);\n}\n\n.tl-user-brush {\n\tz-index: var(--layer-overlays-user-brush);\n}\n\n.tl-user-indicator__selected {\n\tz-index: var(--layer-overlays-user-indicator-selected);\n}\n\n.tl-user-indicator__hovered {\n\tz-index: var(--layer-overlays-user-indicator-hovered);\n}\n\n.tl-user-handles {\n\tz-index: var(--layer-overlays-user-handles);\n}\n\n.tl-user-snapline {\n\tz-index: var(--layer-overlays-user-snapline);\n}\n\n.tl-selection__fg {\n\tpointer-events: none;\n\tz-index: var(--layer-overlays-selection-fg);\n}\n\n.tl-user-indicator__hint {\n\tz-index: var(--layer-overlays-user-indicator-hint);\n\tstroke-width: calc(2.5px * var(--tl-scale));\n}\n\n.tl-custom-overlays {\n\tz-index: var(--layer-overlays-custom);\n}\n\n/* behind collaborator cursor */\n.tl-collaborator__cursor-hint {\n\tz-index: var(--layer-overlays-collaborator-cursor-hint);\n}\n\n.tl-collaborator__cursor {\n\tz-index: var(--layer-overlays-collaborator-cursor);\n}\n\n.tl-cursor {\n\toverflow: visible;\n}\n\n/* -------------------- Indicator ------------------- */\n\n.tl-shape-indicator {\n\ttransform-origin: top left;\n\tfill: none;\n\tstroke-width: calc(1.5px * var(--tl-scale));\n\tcontain: size layout;\n}\n\n/* ------------------ SelectionBox ------------------ */\n\n.tl-selection__bg {\n\tposition: absolute;\n\ttop: 0px;\n\tleft: 0px;\n\ttransform-origin: top left;\n\tbackground-color: transparent;\n\tpointer-events: all;\n}\n\n.tl-selection__fg__outline {\n\tfill: none;\n\tpointer-events: none;\n\tstroke: var(--color-selection-stroke);\n\tstroke-width: calc(1.5px * var(--tl-scale));\n}\n\n.tl-corner-handle {\n\tpointer-events: none;\n\tstroke: var(--color-selection-stroke);\n\tfill: var(--color-background);\n\tstroke-width: calc(1.5px * var(--tl-scale));\n}\n\n.tl-text-handle {\n\tpointer-events: none;\n\tfill: var(--color-selection-stroke);\n}\n\n.tl-corner-crop-handle {\n\tpointer-events: none;\n\tfill: none;\n\tstroke: var(--color-selection-stroke);\n}\n\n.tl-corner-crop-edge-handle {\n\tpointer-events: none;\n\tfill: none;\n\tstroke: var(--color-selection-stroke);\n}\n\n.tl-mobile-rotate__bg {\n\tpointer-events: all;\n\tcursor: var(--tl-cursor-grab);\n}\n\n.tl-mobile-rotate__fg {\n\tpointer-events: none;\n\tstroke: var(--color-selection-stroke);\n\tfill: var(--color-background);\n\tstroke-width: calc(1.5px * var(--tl-scale));\n}\n\n.tl-transparent {\n\tfill: transparent;\n\tstroke: transparent;\n}\n\n/* --------------------- Handles -------------------- */\n\n.tl-handle {\n\tpointer-events: all;\n}\n\n.tl-handle__bg {\n\tfill: transparent;\n\tstroke: transparent;\n\tpointer-events: all;\n}\n\n.tl-handle__fg {\n\tfill: var(--color-selected-contrast);\n\tstroke: var(--color-selection-stroke);\n\tstroke-width: calc(1.5px * var(--tl-scale));\n\tpointer-events: none;\n}\n\n.tl-handle__create {\n\topacity: 0;\n}\n\n.tl-handle__clone > .tl-handle__fg {\n\tfill: var(--color-selection-stroke);\n\tstroke: none;\n}\n\n.tl-handle__bg:active {\n\tfill: none;\n}\n\n@media (pointer: coarse) {\n\t.tl-handle__bg:active {\n\t\tfill: var(--color-selection-fill);\n\t}\n\n\t.tl-handle__create {\n\t\topacity: 1;\n\t}\n}\n\n.tl-rotate-corner:not(:hover),\n.tl-resize-handle:not(:hover) {\n\tcursor: none;\n}\n\n/* --------------------- Arrow Hints -------------------- */\n\n.tl-arrow-hint-handle {\n\tfill: var(--color-selected-contrast);\n\tstroke: var(--color-selection-stroke);\n\tstroke-width: calc(1.5px * var(--tl-scale));\n\tr: calc(4px * var(--tl-scale));\n}\n\n.tl-arrow-hint-snap {\n\tstroke: transparent;\n\tfill: var(--color-selection-fill);\n\tr: calc(12px * var(--tl-scale));\n}\n\n.tl-arrow-hint-snap__none,\n.tl-arrow-hint-snap__center,\n.tl-arrow-hint-snap__axis {\n\tdisplay: none;\n}\n\n.tl-arrow-hint-snap__edge {\n\tr: calc(8px * var(--tl-scale));\n}\n\n/* ------------------ Bounds Detail ----------------- */\n\n.tl-image,\n.tl-video {\n\tobject-fit: cover;\n\tbackground-size: cover;\n\twidth: 100%;\n\theight: 100%;\n}\n\n.tl-video.tl-video-is-fullscreen {\n\tobject-fit: contain;\n\tbackground-size: contain;\n}\n\n.tl-video-container,\n.tl-image-container,\n.tl-embed-container {\n\twidth: 100%;\n\theight: 100%;\n\tpointer-events: all;\n\t/* background-color: var(--color-background); */\n\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n\n.tl-image-container {\n\tposition: relative;\n\toverflow: hidden;\n}\n.tl-image {\n\tposition: absolute;\n\tinset: 0;\n}\n\n.tl-image__tg {\n\t--scale: calc(min(2, var(--tl-scale)));\n\tposition: absolute;\n\ttop: calc(var(--scale) * 8px);\n\tright: calc(var(--scale) * 8px);\n\tfont-size: 10px;\n\ttransform-origin: top right;\n\tbackground-color: var(--color-background);\n\tpadding: 2px 4px;\n\tborder-radius: var(--radius-1);\n}\n\n/* --------------------- Nametag -------------------- */\n\n.tl-collaborator-cursor {\n\tposition: absolute;\n}\n\n.tl-nametag {\n\tposition: absolute;\n\ttop: 16px;\n\tleft: 13px;\n\twidth: fit-content;\n\theight: fit-content;\n\tmax-width: 120px;\n\tpadding: 3px 6px;\n\twhite-space: nowrap;\n\tposition: absolute;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\tfont-size: 12px;\n\tfont-family: var(--font-body);\n\tborder-radius: var(--radius-2);\n\tcolor: var(--color-selected-contrast);\n}\n\n.tl-nametag-title {\n\tposition: absolute;\n\ttop: -2px;\n\tleft: 13px;\n\twidth: fit-content;\n\theight: fit-content;\n\tpadding: 0px 6px;\n\tmax-width: 120px;\n\twhite-space: nowrap;\n\tposition: absolute;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\tfont-size: 12px;\n\tfont-family: var(--font-body);\n\ttext-shadow: var(--tl-text-outline);\n\tcolor: var(--color-selected-contrast);\n}\n\n.tl-nametag-chat {\n\tposition: absolute;\n\ttop: 16px;\n\tleft: 13px;\n\twidth: fit-content;\n\theight: fit-content;\n\tcolor: var(--color-selected-contrast);\n\twhite-space: nowrap;\n\tposition: absolute;\n\tpadding: 3px 6px;\n\tfont-size: 12px;\n\tfont-family: var(--font-body);\n\topacity: 1;\n\tborder-radius: var(--radius-2);\n}\n\n.tl-cursor-chat {\n\tposition: absolute;\n\tcolor: var(--color-selected-contrast);\n\twhite-space: nowrap;\n\tpadding: 3px 6px;\n\tfont-size: 12px;\n\tfont-family: var(--font-body);\n\tpointer-events: none;\n\tz-index: var(--layer-cursor);\n\tmargin-top: 16px;\n\tmargin-left: 13px;\n\topacity: 1;\n\tborder: none;\n\tuser-select: text;\n\tborder-radius: var(--radius-2);\n}\n\n.tl-cursor-chat .tl-cursor-chat__bubble {\n\tpadding-right: 12px;\n}\n\n.tl-cursor-chat::selection {\n\tbackground: var(--color-selected);\n\tcolor: var(--color-selected-contrast);\n\ttext-shadow: none;\n}\n\n.tl-cursor-chat-fade {\n\t/* Setting to zero causes it to immediately disappear */\n\t/* Setting to near-zero causes it to fade out gradually */\n\topacity: 0.0001;\n\ttransition: opacity 5s ease-in-out;\n}\n\n.tl-cursor-chat::placeholder {\n\tcolor: var(--color-selected-contrast);\n\topacity: 0.7;\n}\n\n/* --------------------- Spinner -------------------- */\n@keyframes spinner {\n\tto {\n\t\ttransform: rotate(360deg);\n\t}\n}\n\n/* ---------------------- Text ---------------------- */\n\n.tl-text-shape-label {\n\tposition: relative;\n\tfont-weight: normal;\n\tmin-width: 1px;\n\tpadding: 0px;\n\tmargin: 0px;\n\tborder: none;\n\twidth: fit-content;\n\theight: fit-content;\n\tfont-variant: normal;\n\tfont-style: normal;\n\tpointer-events: all;\n\twhite-space: pre-wrap;\n\toverflow-wrap: break-word;\n\ttext-shadow: var(--tl-text-outline);\n}\n\n.tl-text-wrapper[data-font='draw'] {\n\tfont-family: var(--tl-font-draw);\n}\n\n.tl-text-wrapper[data-font='sans'] {\n\tfont-family: var(--tl-font-sans);\n}\n\n.tl-text-wrapper[data-font='serif'] {\n\tfont-family: var(--tl-font-serif);\n}\n\n.tl-text-wrapper[data-font='mono'] {\n\tfont-family: var(--tl-font-mono);\n}\n\n.tl-text-wrapper[data-align='start'],\n.tl-text-wrapper[data-align='start-legacy'] {\n\ttext-align: left;\n}\n\n.tl-text-wrapper[data-align='middle'],\n.tl-text-wrapper[data-align='middle-legacy'] {\n\ttext-align: center;\n}\n\n.tl-text-wrapper[data-align='end'],\n.tl-text-wrapper[data-align='end-legacy'] {\n\ttext-align: right;\n}\n\n.tl-plain-text-wrapper[data-isediting='true'] .tl-text-content {\n\topacity: 0;\n}\n\n.tl-rich-text-wrapper[data-isediting='true'] .tl-text-content {\n\tdisplay: none;\n}\n\n.tl-text {\n\t/* remove overflow from textarea on windows */\n\tmargin: 0px;\n\tpadding: 0px;\n\n\tappearance: auto;\n\tbackground: none;\n\tborder-image: none;\n\tborder: 0px;\n\tcaret-color: var(--color-text);\n\tcolor: inherit;\n\tcolumn-count: initial !important;\n\tdisplay: inline-block;\n\tfont-family: inherit;\n\tfont-feature-settings: normal;\n\tfont-kerning: auto;\n\tfont-optical-sizing: auto;\n\tfont-size: inherit;\n\tfont-stretch: 100%;\n\tfont-style: inherit;\n\tfont-variant: inherit;\n\tfont-variation-settings: normal;\n\tfont-weight: inherit;\n\tletter-spacing: inherit;\n\tline-height: inherit;\n\toutline: none;\n\toverflow-wrap: break-word;\n\ttext-align: inherit;\n\ttext-indent: 0px;\n\ttext-rendering: auto;\n\ttext-shadow: inherit;\n\ttext-transform: none;\n\twhite-space: pre-wrap;\n\tline-break: normal;\n\tword-spacing: 0px;\n\tword-wrap: break-word;\n\twriting-mode: horizontal-tb !important;\n}\n\n.tl-text-measure {\n\tposition: absolute;\n\tz-index: var(--layer-canvas-hidden);\n\ttop: 0px;\n\tleft: 0px;\n\topacity: 0;\n\twidth: max-content;\n\tbox-sizing: border-box;\n\tpointer-events: none;\n\twhite-space: pre-wrap;\n\tword-wrap: break-word;\n\toverflow-wrap: break-word;\n\tresize: none;\n\tborder: none;\n\tuser-select: none;\n\tcontain: style paint;\n\t-webkit-user-select: none;\n}\n\n.tl-text-input,\n.tl-text-content {\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tmin-width: 1px;\n\tmin-height: 1px;\n\toutline: none;\n}\n\n.tl-text-content__wrapper {\n\tposition: relative;\n\twidth: fit-content;\n\theight: fit-content;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpointer-events: none;\n\tmin-height: auto;\n}\n\n.tl-text-content {\n\toverflow: visible;\n\tpointer-events: none;\n}\n\n.tl-text-input {\n\tresize: none;\n\tuser-select: all;\n\t-webkit-user-select: text;\n\tcursor: var(--tl-cursor-text);\n}\n\n.tl-text-input:not(.tl-rich-text) {\n\t/*\n\t * Note: this `overflow: hidden` is key for scrollbars to not show up\n\t * plaintext/<textarea> editors.\n\t */\n\toverflow: hidden;\n}\n\n.tl-text-wrapper[data-isediting='false'] .tl-text-input,\n.tl-arrow-label[data-isediting='false'] .tl-text-input {\n\topacity: 0;\n\tcursor: var(--tl-cursor-default);\n}\n\n.tl-rich-text[data-is-ready-for-editing='true'],\n.tl-text-wrapper[data-is-ready-for-editing='true'] .tl-text-input {\n\tcursor: var(--tl-cursor-text);\n}\n\n.tl-text-input::selection {\n\tbackground: var(--color-selected);\n\tcolor: var(--color-selected-contrast);\n\ttext-shadow: none;\n}\n\n.tl-rich-text .ProseMirror {\n\tword-wrap: break-word;\n\toverflow-wrap: break-word;\n\twhite-space: pre-wrap;\n\n\t/**\n\t * Note: ProseMirror disables this in https://github.com/ProseMirror/prosemirror-view/commit/6b3b2205e2f3029cb8e8e86c55a190a22491df31\n\t * However, that was from 8 years ago and the browser caret issue\n\t * it mentions seems to be fixed. So, we're re-enabling it.\n\t * We'll tell ProseMirror maybe to get rid of this on their end.\n\t *\n\t */\n\t-webkit-font-variant-ligatures: inherit;\n\tfont-variant-ligatures: inherit;\n\tfont-feature-settings: inherit;\n\n\t/**\n\t * N.B. This following CSS Rule comes standard with the tiptap editor.\n\t * Combined with the above rule that it supersedes, it allows for\n\t * the auto-linking to work in text. Say, when typing example.com\n\t * this helps it automatically turn that bit of text into a link.\n\t *\n\t * However, specifically, the break-spaces features seems to cause\n\t * rendering differences when going in-and-out of edit mode. For example,\n\t * the statically rendered text 'the rain in spain falls mainly on the plain'\n\t * in a note shape will render differently when going in-and-out of edit mode.\n\t *\n\t * So, this is commented out to help make both the autolinking work (which now\n\t * relies on the white-space: pre-wrap to work and to make the static/edit-mode\n\t * rendering consistent.\n\t * In the future, we might consider just making the static rendering just use\n\t * white-space: break-spaces to make it consistent with the edit mode if need be.\n\t *\n\t * Also, the amount of ink I've spilt in my career writing comments explaining\n\t * white-space in contenteditable is incredible.\n\t *\n\t/* white-space: break-spaces; */\n}\n\n.tl-rich-text p {\n\tmargin: 0;\n\t/* Depending on the extensions, <p> tags can be empty, without a <br />. */\n\tmin-height: 1lh;\n}\n\n.tl-rich-text ul,\n.tl-rich-text ol {\n\ttext-align: left;\n\tmargin: 0;\n\tpadding-left: 3.25ch;\n\t/* Some resets, like Tailwind, nix the list styling. */\n\tlist-style: revert;\n}\n\n.tl-rich-text ol:has(> li:nth-child(10)) {\n\tpadding-left: 4.25ch;\n}\n\n.tl-rich-text ol:has(> li:nth-child(100)) {\n\tpadding-left: 5.25ch;\n}\n\n.tl-rich-text h1,\n.tl-rich-text h2,\n.tl-rich-text h3,\n.tl-rich-text h4,\n.tl-rich-text h5,\n.tl-rich-text h6 {\n\tmargin-top: 5px;\n\tmargin-bottom: 10px;\n}\n\n.tl-rich-text a {\n\tcolor: var(--color-primary);\n\ttext-decoration: underline;\n}\n\n.tl-rich-text[data-is-select-tool-active='false'] a {\n\tcursor: inherit;\n}\n\n.tl-rich-text code {\n\tfont-family: var(--tl-font-mono);\n}\n\n.tl-rich-text mark {\n\tbackground-color: #fddd00;\n\tcolor: currentColor;\n\tborder-radius: 2px;\n}\n\n.tl-theme__light .tl-rich-text mark {\n\ttext-shadow: none;\n}\n\n.tl-theme__dark .tl-rich-text mark {\n\tbackground-color: var(--color-text-highlight);\n\tcolor: currentColor;\n}\n\n@supports (color: color(display-p3 1 1 1)) {\n\t@media (color-gamut: p3) {\n\t\t.tl-container:not(.tl-theme__force-sRGB) .tl-rich-text mark {\n\t\t\tbackground-color: var(--color-text-highlight-p3);\n\t\t}\n\t}\n}\n\n.tl-text-label__inner > .tl-text-input.tl-rich-text {\n\tdisplay: none;\n\tposition: static;\n}\n\n.tl-text-wrapper[data-isediting='true'] .tl-rich-text {\n\tdisplay: block;\n}\n\n/* ------------------- Snap Lines ------------------- */\n\n.tl-snap-indicator {\n\tstroke: var(--color-accent);\n\tstroke-width: calc(1px * var(--tl-scale));\n\tfill: none;\n}\n\n.tl-snap-point {\n\tstroke: var(--color-accent);\n\tstroke-width: calc(1px * var(--tl-scale));\n\tfill: none;\n}\n\n/* -------------------- Groups ------------------ */\n\n.tl-group {\n\tstroke: var(--color-text);\n\tstroke-width: calc(1px * var(--tl-scale));\n\topacity: 0.5;\n}\n\n/* ------------------- Bookmark Shape ------------------- */\n\n.tl-bookmark__container {\n\twidth: 100%;\n\theight: 100%;\n\tposition: relative;\n\tborder: 1px solid var(--color-panel-contrast);\n\tbackground-color: var(--color-panel);\n\tborder-radius: var(--radius-2);\n\tdisplay: flex;\n\tflex-direction: column;\n\toverflow: hidden;\n}\n\n.tl-bookmark__container--safariExport {\n\tborder: 1px solid var(--color-divider);\n}\n\n.tl-bookmark__image_container {\n\tflex: 1 1 100%;\n\toverflow: hidden;\n\tborder-top-left-radius: var(--radius-1);\n\tborder-top-right-radius: var(--radius-1);\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tjustify-content: flex-end;\n\talign-items: flex-start;\n}\n\n.tl-bookmark__image_container > .tl-hyperlink-button::after {\n\tbackground-color: var(--color-panel);\n}\n\n.tl-bookmark__placeholder {\n\twidth: 100%;\n\theight: 100%;\n\tbackground-color: var(--color-muted-2);\n\tborder-bottom: 1px solid var(--color-muted-2);\n}\n\n.tl-bookmark__image {\n\twidth: 100%;\n\theight: 100%;\n\tobject-fit: cover;\n\tobject-position: center;\n\tborder-bottom: 1px solid var(--color-muted-2);\n}\n\n.tl-bookmark__copy_container {\n\tbackground-color: var(--color-muted);\n\tpadding: var(--space-4);\n\tpointer-events: all;\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: space-between;\n\tflex: 1;\n}\n\n.tl-bookmark__heading,\n.tl-bookmark__description,\n.tl-bookmark__link {\n\tmargin: 0px;\n\twidth: 100%;\n\tfont-family: inherit;\n}\n\n.tl-bookmark__heading {\n\tfont-size: 16px;\n\tline-height: 1.5;\n\tfont-weight: bold;\n\tpadding-bottom: var(--space-2);\n\toverflow: hidden;\n\tmax-height: calc((16px * 1.5) * 2);\n\t-webkit-box-orient: vertical;\n\t-webkit-line-clamp: 2;\n\tline-clamp: 2;\n\ttext-overflow: ellipsis;\n\tdisplay: -webkit-box;\n}\n\n.tl-bookmark__description {\n\tfont-size: 12px;\n\tline-height: 1.5;\n\toverflow: hidden;\n\tmax-height: calc((12px * 1.5) * 3);\n\t-webkit-box-orient: vertical;\n\t-webkit-line-clamp: 3;\n\tline-clamp: 3;\n\ttext-overflow: ellipsis;\n\tdisplay: -webkit-box;\n\tcolor: var(--color-text-2);\n\tmargin: var(--space-2) 0px;\n}\n\n.tl-bookmark__heading + .tl-bookmark__link,\n.tl-bookmark__description + .tl-bookmark__link {\n\tmargin-top: var(--space-3);\n}\n.tl-bookmark__link {\n\tfont-size: 12px;\n\tpointer-events: all;\n\tdisplay: flex;\n\tcolor: var(--color-text-2);\n\talign-items: center;\n\tcursor: var(--tl-cursor-pointer);\n\twidth: fit-content;\n\tmax-width: 100%;\n}\n\n.tl-bookmark__link > span {\n\tflex-shrink: 0px;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n}\n\n.tl-bookmark__link > .tl-hyperlink__icon {\n\tmargin-right: 8px;\n\tflex-shrink: 0;\n}\n\n.tl-bookmark__link > .tl-bookmark__favicon {\n\tmargin-right: 8px;\n\twidth: 16px;\n\theight: 16px;\n\tflex-shrink: 0;\n}\n\n/* ---------------- Hyperlink Button ---------------- */\n\n.tl-hyperlink-button {\n\tbackground: none;\n\tmargin: 0px;\n\tposition: absolute;\n\ttop: 0px;\n\tright: 0px;\n\theight: 44px;\n\twidth: 44px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-size: 12px;\n\tfont-weight: 400;\n\tcolor: var(--color-text-1);\n\tpadding: 13px;\n\tcursor: var(--tl-cursor-pointer);\n\tborder: none;\n\toutline: none;\n\tpointer-events: all;\n\tz-index: 1;\n}\n\n.tl-hyperlink-button::after {\n\tcontent: '';\n\tz-index: -1;\n\tposition: absolute;\n\tright: 6px;\n\tbottom: 6px;\n\tdisplay: block;\n\twidth: calc(100% - 12px);\n\theight: calc(100% - 12px);\n\tborder-radius: var(--radius-1);\n\tbackground-color: var(--color-background);\n\tpointer-events: none;\n}\n\n.tl-hyperlink-button:focus-visible {\n\tcolor: var(--color-selected);\n}\n\n.tl-hyperlink__icon {\n\twidth: 16px;\n\theight: 16px;\n\tbackground-color: currentColor;\n\tpointer-events: none;\n}\n\n.tl-hyperlink-button__hidden {\n\tdisplay: none;\n}\n\n/* ---------------- Geo shape ---------------- */\n\n.tl-text-label {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tcolor: var(--color-text);\n\ttext-shadow: var(--tl-text-outline);\n\tline-height: inherit;\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n}\n\n.tl-text-label[data-hastext='false'][data-isediting='false'] > .tl-text-label__inner {\n\twidth: 40px;\n\theight: 40px;\n}\n\n.tl-text-label[data-hastext='true'][data-isediting='false'] .tl-text-content {\n\tpointer-events: all;\n}\n\n.tl-text-wrapper .tl-text-content {\n\tpointer-events: all;\n\tz-index: var(--layer-text-content);\n}\n\n.tl-text-label__inner > .tl-text-content {\n\tposition: relative;\n\ttop: 0px;\n\tleft: 0px;\n\tpadding: inherit;\n\theight: fit-content;\n\twidth: fit-content;\n\tborder-radius: var(--radius-1);\n\tmax-width: 100%;\n}\n\n.tl-text-label__inner > .tl-text-input {\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tpadding: inherit;\n}\n\n.tl-text-wrapper[data-isselected='true'] .tl-text-input {\n\tz-index: var(--layer-text-editor);\n\tpointer-events: all;\n}\n\n/* This part of the rule helps preserve the occlusion rules for the shapes so we\n * don't click on shapes that are behind other shapes.\n * One extra nuance is we don't use this behavior for:\n *  - arrows which have weird geometry and just gets in the way.\n *  - draw/line shapes, because it feels restrictive to have them be 'in the way' of clicking on a textfield\n *  - shapes that are not filled\n */\n.tl-canvas:is([data-iseditinganything='true'], [data-isselectinganything='true'])\n\t.tl-shape:not(\n\t\t[data-shape-type='arrow'],\n\t\t[data-shape-type='draw'],\n\t\t[data-shape-type='line'],\n\t\t[data-shape-type='highlight'],\n\t\t[data-shape-is-filled='false']\n\t) {\n\tpointer-events: all;\n}\n\n.tl-text-label[data-textwrap='true'] > .tl-text-label__inner {\n\tmax-width: 100%;\n}\n\n.tl-text-label[data-isediting='true'] {\n\tbackground-color: transparent;\n\tmin-height: auto;\n}\n\n.tl-arrow-hint {\n\tstroke: var(--color-text-1);\n\tfill: none;\n\tstroke-linecap: round;\n\toverflow: visible;\n}\n\n/* ------------------- Arrow Shape ------------------ */\n\n.tl-arrow-label {\n\tposition: absolute;\n\ttop: -1px;\n\tleft: -1px;\n\twidth: 2px;\n\theight: 2px;\n\tpadding: 0px;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\ttext-align: center;\n\tcolor: var(--color-text);\n\ttext-shadow: var(--tl-text-outline);\n}\n\n.tl-arrow-label[data-isediting='true'] p {\n\topacity: 0;\n}\n\n.tl-arrow-label__inner {\n\tborder-radius: var(--radius-1);\n\tbox-sizing: content-box;\n\tposition: relative;\n\theight: max-content;\n\twidth: max-content;\n\tpointer-events: none;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n}\n\n.tl-arrow-label .tl-arrow {\n\tposition: relative;\n\theight: max-content;\n\tpadding: inherit;\n\toverflow: visible;\n}\n\n.tl-arrow-label textarea {\n\tpadding: inherit;\n\t/* Don't allow textarea to be zero width */\n\tmin-width: 4px;\n}\n\n/* -------------------- NoteShape ------------------- */\n\n.tl-note__container {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n\tpointer-events: all;\n\topacity: 1;\n\tz-index: var(--layer-text-container);\n\tborder-radius: 1px;\n}\n\n.tl-note__container > .tl-text-label {\n\ttext-shadow: none;\n\tcolor: currentColor;\n}\n\n/* --------------------- Loading -------------------- */\n\n.tl-loading {\n\tbackground-color: var(--color-background);\n\tcolor: var(--color-text-1);\n\theight: 100%;\n\twidth: 100%;\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: center;\n\talign-items: center;\n\tgap: var(--space-2);\n\tfont-size: 14px;\n\tfont-weight: 500;\n\topacity: 0;\n\tanimation: fade-in 0.2s ease-in-out forwards;\n\tanimation-delay: 0.2s;\n\tposition: absolute;\n\tinset: 0px;\n\tz-index: var(--layer-canvas-blocker);\n}\n\n@keyframes fade-in {\n\t0% {\n\t\topacity: 0;\n\t}\n\t100% {\n\t\topacity: 1;\n\t}\n}\n\n/* -------------------- FrameShape ------------------- */\n\n.tl-frame__body {\n\tstroke-width: calc(1px * var(--tl-scale));\n}\n\n.tl-frame__creating {\n\tstroke: var(--color-selected);\n\tfill: none;\n}\n\n.tl-frame-heading {\n\t--frame-padding-x: 6px;\n\t--frame-height: 24px;\n\t--frame-minimum-width: 32px;\n\t--frame-offset-width: 16px;\n\tdisplay: flex;\n\talign-items: center;\n\tposition: absolute;\n\ttransform-origin: 0% 100%;\n\toverflow: hidden;\n\tmax-width: 100%;\n\tmin-width: var(--frame-minimum-width);\n\theight: auto;\n\tfont-size: 12px;\n\tpadding-bottom: 4px;\n\tpointer-events: all;\n}\n\n.tl-frame-heading-hit-area {\n\tpointer-events: all;\n\t/* scale from bottom left corner so we can pin it to the top left corner of the frame */\n\ttransform-origin: 0% 100%;\n\tdisplay: flex;\n\theight: var(--frame-height);\n\twidth: 100%;\n\talign-items: center;\n\tborder-radius: var(--radius-1);\n}\n\n.tl-frame-label {\n\tpointer-events: all;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\tpadding: 0px var(--frame-padding-x);\n\tborder-radius: var(--radius-1);\n\tposition: relative;\n\tfont-size: inherit;\n\twhite-space: pre;\n}\n\n.tl-frame-label__editing {\n\tcolor: transparent;\n\twhite-space: pre;\n\twidth: auto;\n\tmin-width: var(--frame-minimum-width);\n\theight: 100%;\n\toverflow: visible;\n\tbackground-color: var(--color-panel);\n\tborder-color: var(--color-selected);\n\tbox-shadow: inset 0px 0px 0px 1.5px var(--color-selected);\n}\n\n.tl-frame-name-input {\n\tposition: absolute;\n\tborder: none;\n\tbackground: none;\n\toutline: none;\n\tpadding: 0px var(--frame-padding-x);\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tfont-size: inherit;\n\tfont-family: inherit;\n\tfont-weight: inherit;\n\twidth: 100%;\n\tcolor: var(--color-text-1);\n\tborder-radius: var(--radius-1);\n\tuser-select: all;\n\t-webkit-user-select: text;\n\twhite-space: pre;\n\tcursor: var(--tl-cursor-text);\n}\n\n/* If mobile use 16px as font size */\n/* On iOS, font size under 16px in an input will make the page zoom into the input ð¤¦ââï¸ */\n/* https://css-tricks.com/16px-or-larger-text-prevents-ios-form-zoom/ */\n@media (max-width: 600px) {\n\t.tl-frame-heading {\n\t\tfont-size: 16px;\n\t}\n}\n\n/* ------------------ iFrames Detail ----------------- */\n\n.tl-embed {\n\tborder: none;\n\tborder-radius: var(--radius-2);\n}\n\n/* -------------- Shape Error Boundary -------------- */\n\n.tl-shape-error-boundary {\n\twidth: 100%;\n\theight: 100%;\n\tbackground-color: var(--color-muted-1);\n\tborder-width: calc(1px * var(--tl-scale));\n\tborder-color: var(--color-muted-1);\n\tborder-style: solid;\n\tborder-radius: calc(var(--radius-1) * var(--tl-scale));\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tjustify-content: center;\n\ttext-align: left;\n\tposition: relative;\n\tpointer-events: all;\n\toverflow: hidden;\n\tpadding: var(--space-2);\n}\n\n.tl-shape-error-boundary::before {\n\ttransform: scale(var(--tl-scale));\n\tcontent: 'Error';\n\tfont-size: 12px;\n\tfont-family: inherit;\n\tcolor: var(--color-text-0);\n}\n\n/* ----------------- Error Boundary ----------------- */\n\n.tl-error-boundary {\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: var(--space-4);\n\tbackground-color: var(--color-background);\n\tcolor: var(--color-text-1);\n\tposition: absolute;\n}\n\n.tl-error-boundary__overlay {\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tz-index: var(--layer-error-overlay);\n\tbackground-color: var(--color-overlay);\n}\n\n.tl-error-boundary__content * {\n\tuser-select: all;\n\t-webkit-user-select: text;\n\tpointer-events: all;\n}\n\n.tl-error-boundary__canvas {\n\tpointer-events: none;\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tz-index: var(--layer-error-canvas);\n}\n\n/* some browsers seem to have some weird interactions between stacking contexts\nand pointer-events. this ::after pseudo element covers the canvas and prevents\nit from receiving any pointer events or affecting the cursor. */\n.tl-error-boundary__canvas::after {\n\tcontent: ' ';\n\tdisplay: block;\n\tposition: absolute;\n\tinset: 0px;\n\theight: 100%;\n\twidth: 100%;\n\tz-index: var(--layer-error-canvas-after);\n\tpointer-events: all;\n}\n\n.tl-error-boundary__content {\n\twidth: fit-content;\n\theight: fit-content;\n\tmax-width: 100%;\n\twidth: 400px;\n\tmax-height: 100%;\n\tbackground-color: var(--color-panel);\n\tpadding: 16px;\n\tborder-radius: 16px;\n\tbox-shadow: var(--shadow-2);\n\tfont-size: 14px;\n\tfont-weight: 400;\n\tdisplay: flex;\n\tflex-direction: column;\n\toverflow: auto;\n\tz-index: var(--layer-error-content);\n\tgap: 12px;\n}\n\n.tl-error-boundary__content__expanded {\n\twidth: 600px;\n}\n\n.tl-error-boundary__content h2 {\n\tfont-size: 16px;\n\tmargin: 0px;\n\tfont-weight: 500;\n}\n\n.tl-error-boundary__content h4 {\n\tborder: 1px solid var(--color-low-border);\n\tmargin: -6px 0 0 0;\n\tpadding: var(--space-5);\n\tborder-radius: var(--radius-2);\n\tfont-weight: normal;\n}\n\n.tl-error-boundary__content p {\n\tline-height: 1.5;\n\tmargin: 0px;\n}\n\n.tl-error-boundary__content pre {\n\tbackground-color: var(--color-muted-2);\n\tmargin-top: 0;\n\tpadding: var(--space-5);\n\tborder-radius: var(--radius-2);\n\toverflow: auto;\n\tfont-size: 12px;\n\tmax-height: 320px;\n}\n\n.tl-error-boundary__content button {\n\tbackground: none;\n\tborder: none;\n\tfont-family: inherit;\n\tfont-size: 14px;\n\tfont-weight: 500;\n\tpadding: var(--space-4);\n\tborder-radius: var(--radius-3);\n\tcursor: var(--tl-cursor-pointer);\n\tcolor: inherit;\n\tbackground-color: transparent;\n}\n\n.tl-error-boundary__content a {\n\tcolor: var(--color-selected);\n\tfont-weight: 500;\n\ttext-decoration: none;\n}\n\n.tl-error-boundary__content__error {\n\tposition: relative;\n\tmargin: -6px 0 0 0;\n}\n\n.tl-error-boundary__content__error button {\n\tposition: absolute;\n\ttop: var(--space-2);\n\tright: var(--space-2);\n\tfont-size: 12px;\n\tpadding: var(--space-2) var(--space-3);\n\tbackground-color: var(--color-panel);\n\tborder-radius: var(--radius-1);\n}\n\n.tl-error-boundary__content__actions {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\tgap: var(--space-4);\n\tmargin: 0px;\n\tmargin-left: -4px;\n}\n.tl-error-boundary__content__actions__group {\n\tdisplay: flex;\n\tgap: var(--space-4);\n}\n.tl-error-boundary__content .tl-error-boundary__reset {\n\tcolor: var(--color-warn);\n}\n.tl-error-boundary__content .tl-error-boundary__refresh {\n\tbackground-color: var(--color-primary);\n\tcolor: var(--color-selected-contrast);\n}\n.tl-container__focused:not(.tl-container__no-focus-ring)\n\t.tlui-button.tl-error-boundary__refresh:focus-visible {\n\tborder-radius: 8px;\n\toutline-offset: 0;\n}\n\n/* --------------------- Coarse --------------------- */\n\n.tl-hidden {\n\topacity: 0;\n\tpointer-events: none;\n}\n\n.debug__ui-logger {\n\tposition: absolute;\n\ttop: 62px;\n\tleft: 16px;\n\tcolor: #555;\n\tfont-size: 12px;\n\tfont-family: monospace;\n}\n\n/* ---------------- Hit test blocker ---------------- */\n\n.tl-hit-test-blocker {\n\tposition: absolute;\n\tz-index: var(--layer-canvas-blocker);\n\tinset: 0px;\n\twidth: 100%;\n\theight: 100%;\n\tpointer-events: all;\n}\n\n.tl-hit-test-blocker__hidden {\n\tdisplay: none;\n}\n\n@media (hover: hover) {\n\t.tl-handle__create:hover {\n\t\topacity: 1;\n\t}\n\n\t.tl-handle__bg:hover {\n\t\tcursor: var(--tl-cursor-grab);\n\t\tfill: var(--color-selection-fill);\n\t}\n\n\t.tl-bookmark__link:hover {\n\t\tcolor: var(--color-selected);\n\t}\n\n\t.tl-hyperlink-button:hover {\n\t\tcolor: var(--color-selected);\n\t}\n\n\t.tl-error-boundary__content button:hover {\n\t\tbackground-color: var(--color-low);\n\t}\n\t.tl-error-boundary__content a:hover {\n\t\tcolor: var(--color-text-1);\n\t}\n\t.tl-error-boundary__content .tl-error-boundary__refresh:hover {\n\t\tbackground-color: var(--color-primary);\n\t\topacity: 0.9;\n\t}\n\n\t/* These three rules help preserve clicking into specific points in text areas *while*\n * already in edit mode when jumping from shape to shape. */\n\t.tl-canvas[data-iseditinganything='true'] .tl-text-wrapper:hover .tl-text-input {\n\t\tz-index: var(--layer-text-editor);\n\t\tpointer-events: all;\n\t}\n}\n\n/* @tldraw/ui */\n\n.tl-container {\n\t--layer-above: 1;\n\t--layer-focused-input: 10;\n\t--layer-menu-click-capture: 250;\n\t--layer-panels: 300;\n\t--layer-menus: 400;\n\t--layer-toasts: 650;\n\t--layer-cursor: 700;\n\t--layer-header-footer: 999;\n\t--layer-following-indicator: 1000;\n}\n\n/* -------------------------------------------------- */\n/*                     UI Refresh                     */\n/* -------------------------------------------------- */\n\n/* Button */\n\n.tlui-button {\n\tposition: relative;\n\theight: 40px;\n\tmin-width: 40px;\n\tpadding: 0px 12px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tbackground-color: transparent;\n\tborder: transparent;\n\tcolor: currentColor;\n\tcursor: pointer;\n\tpointer-events: all;\n\tfont-weight: inherit;\n\tfont-family: inherit;\n\tline-height: inherit;\n\ttext-rendering: optimizeLegibility;\n\tfont-size: 12px;\n\tgap: 0px;\n\tcolor: var(--color-text-1);\n\tz-index: 0;\n}\n\n.tlui-button:disabled {\n\tcolor: var(--color-text-3);\n\ttext-shadow: none;\n\tcursor: default;\n}\n\n.tlui-button:disabled .tlui-kbd {\n\tcolor: var(--color-text-3);\n}\n\n.tlui-button > * {\n\tposition: relative;\n\tz-index: var(--layer-above);\n}\n\n.tlui-button__label {\n\tfont-size: 12px;\n\tflex-grow: 2;\n\ttext-align: left;\n}\n\n/*\n * We only want to show the focus ring if:\n * - the container is focused\n * - we're not using the mouse to interact (which is the .tl-container__no-focus-ring)\n */\n.tl-container__focused:not(.tl-container__no-focus-ring) .tlui-button:focus-visible {\n\tborder-radius: 10px;\n\toutline: 2px solid var(--color-focus);\n\toutline-offset: -5px;\n}\n.tl-container__focused:not(.tl-container__no-focus-ring) .tlui-button__tool:focus-visible {\n\tborder-radius: 12px;\n}\n.tlui-slider__container:has(.tlui-slider__thumb:focus-visible) {\n\tborder-radius: 10px;\n\toutline: 2px solid var(--color-focus);\n\toutline-offset: -5px;\n}\n\n.tlui-button::after {\n\tdisplay: block;\n\tcontent: '';\n\tposition: absolute;\n\tinset: 4px;\n\tborder-radius: var(--radius-2);\n\tbackground: var(--color-muted-2);\n\topacity: 0;\n}\n\n.tlui-button__menu[data-highlighted]::after {\n\topacity: 1;\n}\n\n.tlui-button[data-isactive='true']::after,\n.tlui-button[data-isactive='true']:not(:disabled, :focus-visible):active:after {\n\tbackground: var(--color-hint);\n\topacity: 1;\n}\n\n.tlui-button[aria-expanded='true'][data-direction='left']:not(:hover)::after {\n\tbackground: linear-gradient(270deg, rgba(144, 144, 144, 0) 0%, var(--color-muted-2) 100%);\n\topacity: 1;\n}\n\n@media (hover: hover) {\n\t.tlui-button:not(:disabled):hover {\n\t\tz-index: 1;\n\t}\n\n\t.tlui-button:not(:disabled):hover::after {\n\t\topacity: 1;\n\t}\n}\n\n.tlui-button__icon + .tlui-button__label {\n\tmargin-left: var(--space-2);\n}\n\n/* Low button  */\n\n.tlui-button__low {\n\tborder-radius: var(--radius-3);\n\tbackground-color: var(--color-low);\n}\n\n.tlui-button__low::after {\n\tbackground-color: var(--color-muted-2);\n\topacity: 0;\n}\n\n@media (hover: hover) {\n\t.tlui-button__low:hover::after {\n\t\topacity: 1;\n\t}\n}\n\n/* Primary / danger buttons */\n\n.tlui-button__primary {\n\tcolor: var(--color-primary);\n}\n\n.tlui-button__danger {\n\tcolor: var(--color-warn);\n\ttext-shadow: none;\n}\n\n@media (hover: hover) {\n\t.tlui-button__primary:not(:disabled, :focus-visible):hover {\n\t\tcolor: var(--color-primary);\n\t}\n\n\t.tlui-button__danger:not(:disabled, :focus-visible):hover {\n\t\tcolor: var(--color-warn);\n\t\ttext-shadow: none;\n\t}\n}\n\n/* Panel button */\n\n.tlui-button__panel {\n\tposition: relative;\n}\n\n/* Menu button */\n\n.tlui-button__menu {\n\theight: 40px;\n\tmin-height: 40px;\n\twidth: 100%;\n\tgap: 8px;\n\tmargin: -4px 0px;\n}\n\n.tlui-button__menu::after {\n\tinset: 4px;\n\tborder-radius: var(--radius-2);\n}\n\n.tlui-button__menu > .tlui-icon + .tlui-button__label {\n\tmargin-left: 0px;\n}\n\n.tlui-button__menu:nth-child(1) {\n\tmargin-top: 0px;\n}\n\n.tlui-button__menu:nth-last-child(1) {\n\tmargin-bottom: 0px;\n}\n\n/* Menu checkbox button */\n\n.tlui-button__checkbox {\n\tpadding-left: 8px;\n}\n\n.tlui-button__checkbox__indicator {\n\twidth: 15px;\n\theight: 15px;\n}\n\n/* Tool lock button */\n\n.tlui-toolbar__lock-button {\n\tposition: absolute;\n\ttop: 4px;\n\tright: 0px;\n\tpointer-events: all;\n\theight: 40px;\n\twidth: 40px;\n\tmin-width: 0px;\n\tborder-radius: var(--radius-2);\n}\n\n.tlui-toolbar__lock-button::after {\n\ttop: 4px;\n\tleft: 8px;\n\tinset: 4px;\n}\n\n/* Tool button  */\n\n.tlui-button__tool {\n\tposition: relative;\n\theight: 48px;\n\twidth: 48px;\n\tmargin-left: -2px;\n\tmargin-right: -2px;\n}\n\n.tlui-button__tool:nth-of-type(1) {\n\tmargin-left: 0px;\n}\n\n.tlui-button__tool:nth-last-of-type(1) {\n\tmargin-right: 0px;\n}\n\n.tlui-button__tool::after {\n\tinset: 4px;\n\tborder-radius: 8px;\n}\n\n.tlui-button__tool[aria-pressed='true'] {\n\tcolor: var(--color-selected-contrast);\n}\n\n.tlui-button__tool[aria-pressed='true']:not(:disabled, :focus-visible):active {\n\tcolor: var(--color-selected-contrast);\n}\n\n.tlui-button__tool[aria-pressed='true']:not(:disabled)::after {\n\tbackground: var(--color-selected);\n\topacity: 1;\n}\n\n.tlui-layout__mobile .tlui-button__tool {\n\theight: 48px;\n\twidth: 43px;\n}\n\n.tlui-layout__mobile .tlui-button__tool > .tlui-icon {\n\theight: 16px;\n\twidth: 16px;\n}\n\n/* Help */\n\n.tlui-button__help {\n\theight: 32px;\n\twidth: 32px;\n\tpadding: 0px;\n\tmin-width: 32px;\n\tborder-radius: 100%;\n\tbackground-color: var(--color-low);\n\tborder: 1px solid var(--color-low-border);\n}\n\n@media (hover: hover) {\n\t.tlui-button__help::after {\n\t\tbackground-color: var(--color-muted-2);\n\t\tborder-radius: 100%;\n\t\tinset: 4px;\n\t}\n}\n\n/* Button Row */\n\n.tlui-buttons__horizontal {\n\tdisplay: flex;\n\tflex-direction: row;\n}\n.tlui-buttons__horizontal > * {\n\tmargin-left: -2px;\n\tmargin-right: -2px;\n}\n.tlui-buttons__horizontal > *:nth-child(1) {\n\tmargin-left: 0px;\n}\n.tlui-buttons__horizontal > *:nth-last-child(1) {\n\tmargin-right: 0px;\n}\n\n/* Button Grid */\n\n.tlui-buttons__grid {\n\tdisplay: grid;\n\tgrid-template-columns: repeat(4, auto);\n\tgrid-auto-flow: row;\n\toverflow: hidden;\n}\n.tlui-buttons__grid > .tlui-button {\n\tmargin: -2px;\n}\n.tlui-buttons__grid > .tlui-button:nth-of-type(4n),\n.tlui-buttons__vertical-align > .tlui-button:nth-of-type(3n) {\n\tmargin-right: 0px;\n}\n.tlui-buttons__grid > .tlui-button:nth-of-type(4n - 3) {\n\tmargin-left: 0px;\n}\n.tlui-buttons__grid > .tlui-button:nth-of-type(-n + 4) {\n\tmargin-top: 0px;\n}\n.tlui-buttons__grid > .tlui-button:nth-last-of-type(-n + 4) {\n\tmargin-bottom: 0px;\n}\n\n/* Zoom button */\n\n.tlui-zoom-menu__button {\n\twidth: 60px;\n\tmin-width: 60px;\n\ttext-align: center;\n}\n\n.tlui-zoom-menu__button__pct {\n\twidth: 60px;\n\tmin-width: 60px;\n\ttext-align: center;\n}\n\n/* --------------------- Layout --------------------- */\n\n.tlui-layout {\n\tposition: relative;\n\tdisplay: grid;\n\tgrid-template-columns: 1fr;\n\tgrid-template-rows: minmax(0px, 1fr) auto;\n\tgrid-auto-rows: auto;\n\theight: 100%;\n\tmax-height: 100%;\n\toverflow: clip;\n\tpointer-events: none;\n\tuser-select: none;\n\tcontain: strict;\n\tz-index: var(--layer-panels);\n\ttransform: translate3d(0, 0, 0);\n\t--sab: env(safe-area-inset-bottom);\n\tfont-weight: 500;\n\tline-height: 1.6;\n\t-webkit-font-smoothing: antialiased;\n\t-moz-osx-font-smoothing: grayscale;\n\tfont-smooth: antialiased;\n\ttext-rendering: optimizeLegibility;\n}\n\n.tlui-layout__top {\n\tgrid-column: 1;\n\tgrid-row: 1;\n\tdisplay: flex;\n\tmin-width: 0px;\n\tjustify-content: space-between;\n}\n\n.tlui-layout__top__left {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: flex-start;\n\tjustify-content: flex-start;\n\twidth: 100%;\n\theight: 100%;\n\tflex: 0 1 0;\n}\n\n.tlui-layout__top__right {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: flex-end;\n\tjustify-content: flex-start;\n\theight: 100%;\n\tflex: 0 0 auto;\n\tmin-width: 0px;\n}\n\n.scrollable,\n.scrollable * {\n\tpointer-events: all;\n\ttouch-action: auto;\n\toverscroll-behavior: none;\n}\n\n/* ----------------- Helper Buttons ---------------- */\n\n.tlui-helper-buttons {\n\tposition: relative;\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: flex-start;\n\talign-items: flex-start;\n\twidth: min-content;\n\tgap: var(--space-3);\n\tmargin: var(--space-2) var(--space-3);\n\twhite-space: nowrap;\n\tpointer-events: none;\n\tz-index: var(--layer-panels);\n}\n\n/* ---------------------- Icon ---------------------- */\n\n.tlui-icon {\n\tflex-shrink: 0;\n\twidth: 18px;\n\theight: 18px;\n\tbackground-color: currentColor;\n}\n\n.tlui-icon__placeholder {\n\tflex-shrink: 0;\n\twidth: 18px;\n\theight: 18px;\n\tbackground-color: transparent;\n}\n\n.tlui-icon__small {\n\twidth: 15px;\n\theight: 15px;\n}\n\n/* --------------------- Slider --------------------- */\n\n.tlui-slider__container {\n\twidth: 100%;\n\tpadding: 0px var(--space-4);\n}\n\n.tlui-slider {\n\tposition: relative;\n\tdisplay: flex;\n\talign-items: center;\n\tuser-select: none;\n\ttouch-action: none;\n\twidth: 100%;\n}\n\n.tlui-slider__track {\n\tposition: relative;\n\tflex-grow: 1;\n\theight: 44px;\n\tcursor: pointer;\n}\n\n.tlui-slider__track::after {\n\tdisplay: block;\n\tposition: absolute;\n\ttop: calc(50% - 2px);\n\tcontent: '';\n\theight: 3px;\n\twidth: 100%;\n\tbackground-color: var(--color-muted-1);\n\tborder-radius: 14px;\n}\n\n.tlui-slider__range {\n\tposition: absolute;\n\ttop: calc(50% - 2px);\n\tleft: 0px;\n\theight: 3px;\n\tbackground-color: var(--color-selected);\n\tborder-radius: 14px;\n}\n\n.tlui-slider__thumb {\n\tall: unset;\n\tcursor: grab;\n\tdisplay: block;\n\twidth: 18px;\n\theight: 18px;\n\tposition: relative;\n\ttop: -1px;\n\tbackground-color: var(--color-panel);\n\tborder-radius: 999px;\n\tbox-shadow: inset 0px 0px 0px 2px var(--color-text-1);\n}\n\n.tlui-slider__thumb:active {\n\tcursor: grabbing;\n\tbox-shadow:\n\t\tinset 0px 0px 0px 2px var(--color-text-1),\n\t\tvar(--shadow-1);\n}\n\n/* ----------------------- Kbd ---------------------- */\n\n.tlui-kbd {\n\tfont-family: inherit;\n\tfont-size: 11px;\n\tline-height: 11px;\n\tdisplay: grid;\n\tjustify-items: center;\n\tgrid-auto-flow: column;\n\tgrid-template-columns: auto;\n\tgrid-auto-columns: minmax(1em, auto);\n\talign-self: bottom;\n\tcolor: currentColor;\n\tmargin-left: var(--space-4);\n}\n\n.tlui-kbd > span {\n\twidth: 100%;\n\ttext-align: center;\n\tdisplay: inline;\n\tmargin: 0px;\n\tpadding: 2px;\n\tborder-radius: 2px;\n}\n\n.tlui-kbd > span:last-child {\n\tpadding-right: 0;\n}\n\n.tlui-kbd:not(:last-child) {\n\tmargin-right: var(--space-2);\n}\n\n/* Focus Mode Button */\n\n.tlui-focus-button {\n\tz-index: var(--layer-panels);\n\tpointer-events: all;\n}\n\n/* --------------------- Popover -------------------- */\n\n.tlui-popover {\n\tposition: relative;\n\tdisplay: flex;\n\talign-content: stretch;\n}\n\n.tlui-popover__content {\n\tposition: relative;\n\tmax-height: calc(var(--radix-popover-content-available-height) - 8px);\n\tmargin: 0px;\n\tborder: none;\n\tborder-radius: var(--radius-3);\n\tbackground-color: var(--color-panel);\n\tbox-shadow: var(--shadow-3);\n\tz-index: var(--layer-menus);\n\toverflow: hidden;\n\toverflow-y: auto;\n\ttouch-action: auto;\n\toverscroll-behavior: none;\n\tscrollbar-width: none;\n\t-ms-overflow-style: none;\n}\n\n/* -------------------------------------------------- */\n/*                        Zones                       */\n/* -------------------------------------------------- */\n\n/* ------------------- Status Bar ------------------- */\n\n.tlui-debug-panel {\n\tbackground-color: var(--color-low);\n\twidth: 100%;\n\tdisplay: grid;\n\talign-items: center;\n\tgrid-template-columns: 1fr auto auto auto;\n\tjustify-content: space-between;\n\tpadding-left: var(--space-4);\n\tborder-top: 1px solid var(--color-background);\n\tfont-size: 12px;\n\tcolor: var(--color-text-1);\n\tz-index: var(--layer-panels);\n\tpointer-events: all;\n}\n\n.tlui-debug-panel__current-state {\n\toverflow: hidden;\n\twhite-space: nowrap;\n\ttext-overflow: ellipsis;\n}\n\n.tlui-debug-panel__fps {\n\tmargin-right: 8px;\n}\n\n.tlui-debug-panel__fps__slow {\n\tfont-weight: bold;\n\tcolor: var(--color-warn);\n}\n\n.tlui-a11y-audit {\n\tborder-collapse: collapse;\n}\n\n.tlui-a11y-audit th,\n.tlui-a11y-audit td {\n\tpadding: 8px;\n\tborder: 1px solid var(--color-low-border);\n}\n\n/* -------------------- Menu Zone ------------------- */\n\n.tlui-menu-zone {\n\tposition: relative;\n\tz-index: var(--layer-panels);\n\twidth: fit-content;\n\tborder-right: 2px solid var(--color-background);\n\tborder-bottom: 2px solid var(--color-background);\n\tborder-bottom-right-radius: var(--radius-4);\n\tbackground-color: var(--color-low);\n}\n\n.tlui-menu-zone *[data-state='open']:not(:hover)::after {\n\tbackground: linear-gradient(180deg, rgba(144, 144, 144, 0) 0%, var(--color-muted-2) 100%);\n\topacity: 1;\n}\n\n/* ------------------- Style Panel ------------------ */\n\n.tlui-style-panel__wrapper {\n\tbox-shadow: var(--shadow-2);\n\tborder-radius: var(--radius-3);\n\tpointer-events: all;\n\tbackground-color: var(--color-panel);\n\theight: fit-content;\n\tmax-height: 100%;\n\tmargin: 8px;\n\tmargin-top: 4px;\n\ttouch-action: auto;\n\toverscroll-behavior: none;\n\toverflow-y: auto;\n\toverflow-x: hidden;\n\tcolor: var(--color-text);\n}\n/* if the style panel is the only child (ie no share menu), increase the margin */\n.tlui-style-panel__wrapper:only-child {\n\tmargin-top: 8px;\n}\n\n.tlui-style-panel {\n\tposition: relative;\n\tz-index: var(--layer-panels);\n\tpointer-events: all;\n\twidth: 148px;\n\tmax-width: 148px;\n}\n\n.tlui-style-panel::-webkit-scrollbar {\n\tdisplay: none;\n}\n\n.tlui-style-panel .tlui-button.select {\n\twidth: 100%;\n}\n\n.tlui-style-panel__section {\n\tdisplay: flex;\n\tposition: relative;\n\tflex-direction: column;\n}\n\n.tlui-style-panel__section:nth-of-type(n + 2):not(:last-child) {\n\tborder-bottom: 1px solid var(--color-divider);\n}\n\n.tlui-style-panel__section:empty {\n\tdisplay: none;\n}\n\n.tlui-style-panel__section__common:not(:only-child) {\n\tmargin-bottom: 7px;\n\tborder-bottom: 1px solid var(--color-divider);\n}\n\n.tlui-style-panel__row {\n\tdisplay: flex;\n}\n/* Only really used for the alignment picker */\n.tlui-style-panel__row__extra-button {\n\tmargin-left: -2px;\n}\n\n.tlui-style-panel__double-select-picker {\n\tdisplay: flex;\n\tgrid-template-columns: 1fr auto;\n\talign-items: center;\n\tpadding-left: var(--space-4);\n\tcolor: var(--color-text-1);\n\tfont-size: 12px;\n}\n\n.tlui-style-panel__double-select-picker-label {\n\ttext-overflow: ellipsis;\n\toverflow: hidden;\n\twhite-space: nowrap;\n\tflex-grow: 2;\n\tmax-width: 100%;\n}\n\n.tlui-style-panel .tlui-button[data-state='open']:not(:hover)::after {\n\topacity: 1;\n\tbackground: linear-gradient(270deg, rgba(144, 144, 144, 0) 0%, var(--color-muted-2) 100%);\n}\n\n/* ---------------------- Input --------------------- */\n\n.tlui-input {\n\tbackground: none;\n\tmargin: 0px;\n\tposition: relative;\n\tz-index: var(--layer-above);\n\theight: 40px;\n\tmax-height: 40px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-family: inherit;\n\tfont-size: 12px;\n\tfont-weight: inherit;\n\tcolor: var(--color-text-1);\n\tpadding: var(--space-4);\n\tpadding-left: 0px;\n\tborder: none;\n\toutline: none;\n\ttext-overflow: ellipsis;\n\twidth: 100%;\n\tuser-select: all;\n\ttext-rendering: optimizeLegibility;\n\t-webkit-user-select: auto !important;\n}\n\n.tlui-input__wrapper {\n\twidth: 100%;\n\theight: 44px;\n\tdisplay: flex;\n\talign-items: center;\n\tgap: var(--space-4);\n\tcolor: var(--color-text);\n}\n\n.tlui-input__wrapper > .tlui-icon {\n\tflex-shrink: 0;\n}\n\n/* If mobile use 16px as font size */\n/* On iOS, font size under 16px in an input will make the page zoom into the input ð¤¦ââï¸ */\n/* https://css-tricks.com/16px-or-larger-text-prevents-ios-form-zoom/ */\n@media (max-width: 600px) {\n\t@supports (-webkit-touch-callout: none) {\n\t\t/* CSS specific to iOS devices */\n\t\t.tlui-input {\n\t\t\tfont-size: 16px;\n\t\t}\n\t}\n}\n\n/* ---------------- Dialog ---------------- */\n\n.tlui-dialog__overlay {\n\tposition: absolute;\n\ttop: 0px;\n\tleft: 0px;\n\twidth: 100%;\n\theight: 100%;\n\tz-index: var(--layer-canvas-overlays);\n\tbackground-color: var(--color-overlay);\n\tpointer-events: all;\n\tanimation: fadeIn 0.12s ease-out;\n\tdisplay: grid;\n\tplace-items: center;\n\toverflow-y: auto;\n\tpadding: 0px var(--space-3);\n}\n\n.tlui-dialog__content {\n\tdisplay: flex;\n\tflex-direction: column;\n\tposition: relative;\n\tcursor: default;\n\tbackground-color: var(--color-panel);\n\tbox-shadow: var(--shadow-3);\n\tborder-radius: var(--radius-3);\n\tfont-size: 12px;\n\toverflow: hidden;\n\tmin-width: 300px;\n\tmax-width: 100%;\n\tmax-height: 80%;\n}\n\n.tlui-dialog__header {\n\tposition: relative;\n\tdisplay: flex;\n\talign-items: center;\n\tflex: 0;\n\tz-index: var(--layer-header-footer);\n\tpadding-left: var(--space-4);\n\tcolor: var(--color-text);\n\theight: 40px;\n}\n\n.tlui-dialog__header__title {\n\tflex: 1;\n\tfont-weight: inherit;\n\tfont-size: 12px;\n\tmargin: 0px;\n\tcolor: var(--color-text-1);\n}\n\n.tlui-dialog__header__close {\n\tjustify-self: flex-end;\n}\n\n.tlui-dialog__body {\n\tpadding: var(--space-4) var(--space-4);\n\tflex: 0 1;\n\toverflow-y: auto;\n\toverflow-x: hidden;\n\tcolor: var(--color-text-1);\n\tuser-select: all;\n\t-webkit-user-select: text;\n}\n.tlui-dialog__body a {\n\tcolor: var(--color-selected);\n}\n\n.tlui-dialog__body ul,\n.tlui-dialog__body ol {\n\tpadding-left: 16px;\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: var(--space-4);\n}\n\n.tlui-dialog__footer {\n\tposition: relative;\n\tmin-height: 12px;\n\tz-index: var(--layer-header-footer);\n}\n\n.tlui-dialog__footer__actions {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: flex-end;\n}\n\n.tlui-dialog__footer__actions > .tlui-button:nth-last-child(n + 2) {\n\tmargin-right: -4px;\n}\n\n/* --------------------- Toolbar -------------------- */\n\n/* Wide container */\n.tlui-toolbar {\n\tgrid-column: 1 / span 3;\n\tgrid-row: 1;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tflex-grow: 2;\n\tpadding-bottom: calc(var(--space-3) + var(--sab));\n}\n\n/* Centered Content */\n.tlui-toolbar__inner {\n\tposition: relative;\n\twidth: fit-content;\n\tdisplay: flex;\n\tgap: var(--space-3);\n\talign-items: flex-end;\n}\n\n.tlui-toolbar__left {\n\twidth: fit-content;\n}\n\n/* Row of controls + lock button */\n.tlui-toolbar__extras {\n\tposition: relative;\n\tz-index: var(--layer-above);\n\twidth: 100%;\n\tpointer-events: none;\n\ttop: 6px;\n\theight: 48px;\n}\n\n.tlui-toolbar__extras:empty {\n\tdisplay: none;\n}\n\n.tlui-toolbar__extras__controls {\n\tdisplay: flex;\n\tposition: relative;\n\tflex-direction: row;\n\tz-index: var(--layer-above);\n\tbackground-color: var(--color-low);\n\tborder-top-left-radius: var(--radius-4);\n\tborder-top-right-radius: var(--radius-4);\n\tborder: 2px solid var(--color-background);\n\tmargin-left: 8px;\n\tmargin-right: 0px;\n\tpointer-events: all;\n\twidth: fit-content;\n}\n\n.tlui-toolbar__tools {\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n\tborder-radius: var(--radius-4);\n\tz-index: var(--layer-panels);\n\tpointer-events: all;\n\tposition: relative;\n\tbackground: var(--color-panel);\n\tbox-shadow: var(--shadow-2);\n}\n.tlui-toolbar__tools__list {\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n}\n\n.tlui-toolbar__overflow {\n\twidth: 40px;\n}\n\n.tlui-layout__mobile .tlui-toolbar__overflow {\n\twidth: 32px;\n\tpadding: 0px;\n}\n\n.tlui-toolbar *[data-state='open']:not(:hover)::after {\n\tbackground: linear-gradient(0deg, rgba(144, 144, 144, 0) 0%, var(--color-muted-2) 100%);\n}\n\n.tlui-layout__mobile .tlui-toolbar {\n\ttransition: transform 0.15s ease-out 0.05s;\n}\n\n/* -------------------- Help Zone ------------------- */\n\n.tlui-help-menu {\n\tpointer-events: all;\n\tposition: absolute;\n\tbottom: var(--space-2);\n\tright: var(--space-2);\n\tz-index: var(--layer-panels);\n\tborder: 2px solid var(--color-background);\n\tborder-radius: 100%;\n}\n\n/* ------------------ Context Menu ------------------ */\n\n.tlui-context-menu__move-to-page__name {\n\tmax-width: calc(min(300px, 35vw));\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n}\n\n.tlui-context-menu__move-to-page__name[data-disabled] {\n\tcolor: var(--color-text-3);\n\tpointer-events: none;\n}\n\n/* ---------------------- Menu ---------------------- */\n\n.tlui-menu:empty {\n\tdisplay: none;\n}\n\n.tlui-menu {\n\tz-index: var(--layer-menus);\n\theight: fit-content;\n\twidth: fit-content;\n\tborder-radius: var(--radius-3);\n\tpointer-events: all;\n\ttouch-action: auto;\n\toverflow-y: auto;\n\toverscroll-behavior: none;\n\tbackground-color: var(--color-panel);\n\tbox-shadow: var(--shadow-3);\n}\n\n.tlui-menu::-webkit-scrollbar {\n\tdisplay: none;\n}\n\n.tlui-menu__arrow {\n\tposition: relative;\n\ttop: -1px;\n\tfill: var(--color-panel);\n\tstroke: var(--color-panel-contrast);\n\tstroke-width: 1px;\n}\n\n.tlui-menu__group {\n\twidth: 100%;\n}\n\n.tlui-menu__group:empty {\n\tdisplay: none;\n}\n\n.tlui-menu__group {\n\tborder-bottom: 1px solid var(--color-divider);\n}\n.tlui-menu__group:nth-last-of-type(1) {\n\tborder-bottom: none;\n}\n\n.tlui-menu__submenu__trigger[data-state='open']:not(:hover)::after {\n\topacity: 1;\n\tbackground: linear-gradient(90deg, rgba(144, 144, 144, 0) 0%, var(--color-muted-2) 100%);\n}\n\n.tlui-menu__submenu__trigger[data-direction='left'][data-state='open']:not(:hover)::after {\n\topacity: 1;\n\tbackground: linear-gradient(270deg, rgba(144, 144, 144, 0) 0%, var(--color-muted-2) 100%);\n}\n\n/* Menu Sizes */\n\n.tlui-menu[data-size='large'] > .tlui-menu__group {\n\tmin-width: initial;\n}\n\n.tlui-menu[data-size='medium'] > .tlui-menu__group {\n\tmin-width: 144px;\n}\n\n.tlui-menu[data-size='small'] > .tlui-menu__group {\n\tmin-width: 96px;\n}\n\n.tlui-menu[data-size='tiny'] > .tlui-menu__group {\n\tmin-width: 0px;\n}\n\n/* ------------------ Language menu ----------------- */\n\n.tlui-language-menu {\n\tmax-height: 500px;\n}\n\n.tlui-language-menu::after {\n\tcontent: '';\n\tdisplay: block;\n\tposition: absolute;\n\tbottom: 0px;\n\tleft: 0px;\n\tright: 0px;\n\theight: 24px;\n\tbackground: linear-gradient(\n\t\tto bottom,\n\t\tvar(--color-panel-transparent) 0%,\n\t\tvar(--color-panel) 90%,\n\t\tvar(--color-panel) 100%\n\t);\n\tborder-bottom-left-radius: var(--radius-3);\n\tborder-bottom-right-radius: var(--radius-3);\n\tpointer-events: none;\n}\n\n/* ------------------ Actions Menu ------------------ */\n\n.tlui-actions-menu {\n\tmax-height: calc(100vh - 150px);\n}\n\n/* --------------------- Toasts --------------------- */\n\n.tlui-toast__viewport {\n\tposition: absolute;\n\tinset: 0px;\n\tmargin: 0px;\n\tdisplay: flex;\n\talign-items: flex-end;\n\tjustify-content: flex-end;\n\tflex-direction: column;\n\tgap: var(--space-3);\n\tpointer-events: none;\n\tpadding: 0px var(--space-3) 64px 0px;\n\tz-index: var(--layer-toasts);\n}\n\n.tlui-toast__viewport > * {\n\tpointer-events: all;\n}\n\n.tlui-toast__icon {\n\tpadding-top: 11px;\n\tpadding-left: var(--space-4);\n\tcolor: var(--color-text-1);\n}\n\n.tlui-toast__container {\n\tmin-width: 200px;\n\tdisplay: flex;\n\tflex-direction: row;\n\tbackground-color: var(--color-panel);\n\tbox-shadow: var(--shadow-2);\n\tborder-radius: var(--radius-3);\n\tfont-size: 12px;\n}\n\n.tlui-toast__container[data-severity='success'] .tlui-icon {\n\tcolor: var(--color-success);\n}\n\n.tlui-toast__container[data-severity='info'] .tlui-icon {\n\tcolor: var(--color-info);\n}\n\n.tlui-toast__container[data-severity='warning'] .tlui-icon {\n\tcolor: var(--color-warning);\n}\n\n.tlui-toast__container[data-severity='error'] .tlui-icon {\n\tcolor: var(--color-error);\n}\n\n.tlui-toast__main {\n\tflex-grow: 2;\n\tmax-width: 280px;\n}\n\n.tlui-toast__content {\n\tpadding: var(--space-4);\n\tdisplay: flex;\n\tline-height: 1.4;\n\tflex-direction: column;\n\tgap: var(--space-3);\n}\n\n.tlui-toast__main[data-actions='true'] .tlui-toast__content {\n\tpadding-bottom: var(--space-2);\n}\n\n.tlui-toast__title {\n\tfont-weight: bold;\n\tcolor: var(--color-text-1);\n\t/* this makes the default toast look better */\n\tline-height: 16px;\n}\n\n.tlui-toast__description {\n\tcolor: var(--color-text-1);\n\tpadding: var(--space-3);\n\tmargin: 0px;\n\tpadding: 0px;\n}\n\n.tlui-toast__icon + .tlui-toast__main > .tlui-toast__actions {\n\tpadding-left: 0px;\n}\n\n.tlui-toast__actions {\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: flex-start;\n\tmargin-left: 0;\n}\n\n.tlui-toast__close {\n\talign-self: flex-end;\n\tflex-shrink: 0;\n}\n\n@media (prefers-reduced-motion: no-preference) {\n\t.tlui-toast__container[data-state='open'] {\n\t\tanimation: slide-in 200ms cubic-bezier(0.785, 0.135, 0.15, 0.86);\n\t}\n\n\t.tlui-toast__container[data-state='closed'] {\n\t\tanimation: hide 100ms ease-in;\n\t}\n\n\t.tlui-toast__container[data-swipe='move'] {\n\t\ttransform: translateX(var(--radix-toast-swipe-move-x));\n\t}\n\n\t.tlui-toast__container[data-swipe='cancel'] {\n\t\ttransform: translateX(0);\n\t\ttransition: transform 200ms ease-out;\n\t}\n\n\t.tlui-toast__container[data-swipe='end'] {\n\t\tanimation: swipe-out 100ms ease-out;\n\t}\n}\n\n/* --------------------- Bottom --------------------- */\n\n.tlui-layout__bottom {\n\tgrid-row: 2;\n}\n\n.tlui-layout__bottom__main {\n\twidth: 100%;\n\tposition: relative;\n\tdisplay: flex;\n\talign-items: flex-end;\n\tjustify-content: center;\n}\n\n/* ------------------- Navigation ------------------- */\n\n.tlui-navigation-panel {\n\tdisplay: flex;\n\twidth: min-content;\n\tflex-direction: column;\n\tz-index: var(--layer-panels);\n\tpointer-events: all;\n\tposition: absolute;\n\tleft: 0px;\n\tbottom: 0px;\n}\n\n.tlui-navigation-panel::before {\n\tcontent: '';\n\tdisplay: block;\n\tposition: absolute;\n\tz-index: -1;\n\tinset: -2px -2px 0px 0px;\n\tborder-radius: 0;\n\tborder-top: 2px solid var(--color-background);\n\tborder-right: 2px solid var(--color-background);\n\tborder-top-right-radius: var(--radius-4);\n\tbackground-color: var(--color-low);\n}\n\n.tlui-navigation-panel__toggle .tlui-icon {\n\topacity: 0.24;\n}\n\n.tlui-navigation-panel__toggle:active .tlui-icon {\n\topacity: 1;\n}\n\n@media (hover: hover) {\n\t.tlui-navigation-panel__toggle:hover .tlui-icon {\n\t\topacity: 1;\n\t}\n}\n\n.tlui-minimap {\n\twidth: 100%;\n\theight: 96px;\n\tmin-height: 96px;\n\toverflow: hidden;\n\tpadding: var(--space-3);\n\tpadding-top: 0px;\n}\n\n.tlui-minimap__canvas {\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n}\n\n/* ----------------------- ... ---------------------- */\n\n@keyframes hide {\n\t0% {\n\t\topacity: 1;\n\t}\n\t100% {\n\t\topacity: 0;\n\t}\n}\n\n@keyframes slide-in {\n\tfrom {\n\t\ttransform: translateX(calc(100% + var(--space-3)));\n\t}\n\tto {\n\t\ttransform: translateX(0px);\n\t}\n}\n\n@keyframes swipe-out {\n\tfrom {\n\t\ttransform: translateX(var(--radix-toast-swipe-end-x));\n\t}\n\tto {\n\t\ttransform: translateX(calc(100% + var(--space-3)));\n\t}\n}\n\n/* ------------------- Page Select ------------------ */\n\n.tlui-page-menu__wrapper {\n\tposition: relative;\n\tdisplay: flex;\n\tflex-direction: column;\n\twidth: 260px;\n\theight: fit-content;\n\tmax-height: 50vh;\n}\n\n.tlui-page-menu__trigger {\n\twidth: 128px;\n}\n\n.tlui-page-menu__header {\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n\twidth: 100%;\n\theight: 40px;\n\tpadding-left: var(--space-4);\n\tborder-bottom: 1px solid var(--color-divider);\n}\n\n.tlui-page-menu__header > .tlui-button:nth-of-type(1) {\n\tmargin-right: -4px;\n}\n\n.tlui-page-menu__header__title {\n\tcolor: var(--color-text);\n\tfont-size: 12px;\n\tflex-grow: 2;\n}\n\n.tlui-page-menu__name {\n\tflex-grow: 2;\n\ttext-align: left;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n}\n\n.tlui-page-menu__list {\n\tposition: relative;\n\ttouch-action: auto;\n\tflex-direction: column;\n\tmax-height: 100%;\n\toverflow-x: hidden;\n\toverflow-y: auto;\n\ttouch-action: auto;\n}\n\n.tlui-page-menu__item {\n\tposition: relative;\n}\n\n.tlui-page_menu__item__submenu[data-isediting='true'] > .tlui-button[data-state='open'] {\n\topacity: 1;\n}\n\n@media (hover: hover) {\n\t.tlui-page-menu__item:hover > .tlui-page_menu__item__submenu > .tlui-button {\n\t\topacity: 1;\n\t}\n}\n\n.tlui-page-menu__item:nth-of-type(n + 2) {\n\tmargin-top: -4px;\n}\n\n.tlui-page-menu__item__button {\n\twidth: 100%;\n}\n\n.tlui-page-menu__item__button:not(:only-child) {\n\tflex-grow: 2;\n\tmargin-right: -2px;\n}\n\n.tlui-page-menu__item__button > span {\n\tdisplay: block;\n\tflex-grow: 2;\n\ttext-align: left;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n}\n\n.tlui-page-menu__item__button__checkbox {\n\tpadding-left: 35px;\n}\n\n.tlui-page-menu__item__button__check {\n\tposition: absolute;\n\tleft: 0px;\n\twidth: 24px;\n\tpadding-left: 10px;\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\tcolor: var(--color-text);\n}\n\n.tlui-page_menu__item__sortable {\n\tposition: absolute;\n\ttop: 0px;\n\tleft: 0px;\n\twidth: 100%;\n\theight: fit-content;\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n\toverflow: hidden;\n\tz-index: var(--layer-above);\n}\n\n.tlui-page_menu__item__sortable__title {\n\tflex: 1;\n}\n\n.tlui-page_menu__item__sortable__title > .tlui-input__wrapper {\n\theight: 100%;\n}\n\n.tlui-page_menu__item__sortable:focus-visible {\n\tz-index: var(--layer-focused-input);\n}\n\n.tlui-page_menu__item__sortable__handle {\n\ttouch-action: none;\n\twidth: 32px;\n\tmin-width: 0px;\n\theight: 40px;\n\tcursor: grab;\n\tcolor: var(--color-text-3);\n\tflex-shrink: 0;\n\tmargin-right: -9px;\n}\n\n.tlui-page_menu__item__sortable__handle:active {\n\tcursor: grabbing;\n}\n\n.tlui-page-menu__item__input {\n\tmargin-left: 12px;\n\theight: 100%;\n}\n\n/* The more menu has complex CSS here: */\n/* If the user can hover, then visible but opacity zero until hover */\n/* If the user cannot hover, then not displayed unless editing, and then opacity 1 */\n\n.tlui-page_menu__item__submenu {\n\tpointer-events: all;\n\tposition: absolute;\n\tright: 0px;\n\ttop: 0px;\n\theight: 100%;\n\tcursor: pointer;\n\tmargin: 0px;\n\tmargin-left: -2px;\n\tz-index: 10;\n}\n\n.tlui-page_menu__item__submenu > .tlui-button {\n\topacity: 0;\n}\n\n.tlui-page_menu__item__sortable:focus-visible > .tlui-page_menu__item__submenu > .tlui-button,\n.tlui-page_menu__item__submenu[data-isediting='true'],\n.tlui-page_menu__item__submenu > .tlui-button[data-state='open'],\n.tlui-page_menu__item__submenu > .tlui-button:focus-visible {\n\topacity: 1;\n}\n\n.tlui-page_menu__item__submenu > .tlui-button[data-state='open']:not(:hover)::after {\n\tbackground: linear-gradient(90deg, rgba(144, 144, 144, 0) 0%, var(--color-muted-2) 100%);\n}\n\n@media (any-pointer: coarse) {\n\t.tlui-page_menu__item__submenu > .tlui-button {\n\t\topacity: 1;\n\t}\n}\n\n.tlui-button__icon {\n\tpadding: 0px;\n}\n\n.tlui-page-menu__item__button .tlui-button__icon {\n\tmargin-right: 4px;\n}\n\n@media (hover: hover) {\n\t.tlui-page_menu__item__submenu[data-isediting='true'] > .tlui-button {\n\t\topacity: 0;\n\t}\n\n\t.tlui-page_menu__item__submenu:hover > .tlui-button {\n\t\topacity: 1;\n\t}\n}\n\n/* --------------------- Dialogs -------------------- */\n\n/* Edit Link Dialog */\n\n.tlui-edit-link-dialog {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: var(--space-4);\n\tcolor: var(--color-text);\n}\n\n.tlui-edit-link-dialog__input {\n\tbackground-color: var(--color-muted-2);\n\tflex-grow: 2;\n\tborder-radius: var(--radius-2);\n\tpadding: 0px var(--space-4);\n}\n\n/* Embed Dialog */\n\n.tlui-embed__spacer {\n\tflex-grow: 2;\n\tmin-height: 0px;\n\tmargin-left: calc(-1 * var(--space-4));\n\tmargin-top: calc(-1 * var(--space-4));\n\tpointer-events: none;\n}\n\n.tlui-embed-dialog__list {\n\tdisplay: flex;\n\tflex-direction: column;\n\tpadding-bottom: var(--space-5);\n}\n\n.tlui-embed-dialog__item__image {\n\twidth: 24px;\n\theight: 24px;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tbackground-size: contain;\n\tbackground-repeat: no-repeat;\n\tbackground-position: center center;\n}\n\n.tlui-embed-dialog__enter {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: var(--space-4);\n\tcolor: var(--color-text-1);\n}\n\n.tlui-embed-dialog__input {\n\tbackground-color: var(--color-muted-2);\n\tflex-grow: 2;\n\tborder-radius: var(--radius-2);\n\tpadding: 0px var(--space-4);\n}\n\n.tlui-embed-dialog__warning {\n\tcolor: var(--color-warn);\n\ttext-shadow: none;\n}\n\n.tlui-embed-dialog__instruction__link {\n\tdisplay: flex;\n\tgap: var(--space-1);\n\tmargin-top: var(--space-4);\n}\n\n.tlui-embed-dialog__enter a {\n\tcolor: var(--color-text-1);\n}\n\n.tlui-following-indicator {\n\tdisplay: block;\n\tposition: absolute;\n\tinset: 0px;\n\tborder-width: 2px;\n\tborder-style: solid;\n\tz-index: var(--layer-following-indicator);\n\tpointer-events: none;\n}\n\n/* ---------------- Offline Indicator --------------- */\n\n.tlui-offline-indicator {\n\tdisplay: flex;\n\tflex-direction: row;\n\tgap: var(--space-3);\n\tcolor: var(--color-text);\n\tbackground-color: var(--color-low);\n\tborder: 3px solid var(--color-background);\n\tpadding: 0px var(--space-5);\n\theight: 42px;\n\talign-items: center;\n\tjustify-content: center;\n\tborder-radius: 99px;\n\topacity: 0;\n\tanimation: fade-in;\n\tanimation-duration: 0.12s;\n\tanimation-delay: 2s;\n\tanimation-fill-mode: forwards;\n}\n\n/* --------------- Keyboard shortcuts --------------- */\n\n.tlui-shortcuts-dialog__header {\n\tborder-bottom: 1px solid var(--color-divider);\n}\n\n.tlui-shortcuts-dialog__body {\n\tposition: relative;\n\tcolumns: 3;\n\tcolumn-gap: var(--space-9);\n\tpointer-events: all;\n\ttouch-action: auto;\n\n\t/* Terrible fix to allow firefox users to scroll the dialog */\n\toverflow-x: auto;\n}\n\n.tlui-shortcuts-dialog__body__tablet {\n\tcolumns: 2;\n}\n\n.tlui-shortcuts-dialog__body__mobile {\n\tcolumns: 1;\n}\n\n.tlui-shortcuts-dialog__group {\n\tbreak-inside: avoid-column;\n\tpadding-bottom: var(--space-6);\n}\n\n.tlui-shortcuts-dialog__group__title {\n\tfont-size: inherit;\n\tfont-weight: inherit;\n\tmargin: 0px;\n\tcolor: var(--color-text-3);\n\theight: 32px;\n\tdisplay: flex;\n\talign-items: center;\n}\n\n.tlui-shortcuts-dialog__group__content {\n\tdisplay: flex;\n\tflex-direction: column;\n\tcolor: var(--color-text-1);\n}\n\n.tlui-shortcuts-dialog__key-pair {\n\tdisplay: flex;\n\tgap: var(--space-4);\n\talign-items: center;\n\tjustify-content: space-between;\n\theight: 32px;\n}\n\n.tlui-shortcuts-dialog__key-pair__key {\n\tflex: 1;\n\tfont-size: 12px;\n}\n\n/* ------------------- Da share zone ------------------ */\n.tlui-share-zone {\n\tpadding: 0px 0px 0px 0px;\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: flex-end;\n\tz-index: var(--layer-panels);\n\talign-items: center;\n\tpadding-top: 2px;\n\tpadding-right: 4px;\n}\n\n/* ------------------- People Menu ------------------- */\n\n.tlui-people-menu__avatars-button {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: flex-end;\n\tbackground: none;\n\tborder: none;\n\tcursor: pointer;\n\tpointer-events: all;\n\tborder-radius: var(--radius-1);\n\tpadding-right: 1px;\n\theight: 100%;\n}\n\n.tlui-people-menu__avatars {\n\tdisplay: flex;\n\tflex-direction: row;\n}\n\n.tlui-people-menu__avatar {\n\theight: 24px;\n\twidth: 24px;\n\tborder: 2px solid var(--color-background);\n\tbackground-color: var(--color-low);\n\tborder-radius: 100%;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tposition: relative;\n\tfont-size: 10px;\n\tfont-weight: bold;\n\tcolor: var(--color-selected-contrast);\n\tz-index: 2;\n}\n\n.tlui-people-menu__avatar:nth-of-type(n + 2) {\n\tmargin-left: -12px;\n}\n\n.tlui-people-menu__avatars-button[data-state='open'] {\n\topacity: 1;\n}\n\n@media (hover: hover) {\n\t.tlui-people-menu__avatars-button:hover .tlui-people-menu__avatar {\n\t\tborder-color: var(--color-low);\n\t}\n}\n\n.tlui-people-menu__more {\n\tposition: absolute;\n\ttop: 0px;\n\tright: 0px;\n\tmin-width: 0px;\n\tfont-size: 11px;\n\tfont-weight: 600;\n\tcolor: var(--color-text-1);\n\tfont-family: inherit;\n\tpadding: 0px 4px;\n\tletter-spacing: 1.5;\n}\n.tlui-people-menu__more::after {\n\tborder-radius: var(--radius-2);\n\tinset: 0px;\n}\n\n.tlui-people-menu__wrapper {\n\tposition: relative;\n\tdisplay: flex;\n\tflex-direction: column;\n\twidth: 220px;\n\theight: fit-content;\n\tmax-height: 50vh;\n}\n\n.tlui-people-menu__section {\n\tposition: relative;\n\ttouch-action: auto;\n\tflex-direction: column;\n\tmax-height: 100%;\n\toverflow-x: hidden;\n\toverflow-y: auto;\n\ttouch-action: auto;\n}\n\n.tlui-people-menu__section:first-child,\n.tlui-people-menu__section:last-child {\n\tflex-shrink: 0;\n}\n\n.tlui-people-menu__section:not(:last-child) {\n\tborder-bottom: 1px solid var(--color-divider);\n}\n\n.tlui-people-menu__user {\n\tdisplay: flex;\n\tjustify-content: flex-start;\n\talign-items: center;\n}\n\n.tlui-people-menu__user__color {\n\tflex-shrink: 0;\n}\n\n.tlui-people-menu__user__name {\n\ttext-align: left;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n\tfont-size: 12px;\n\tcolor: var(--color-text-1);\n\tmax-width: 100%;\n\tflex-grow: 1;\n\tflex-shrink: 100;\n}\n\n.tlui-people-menu__user__label {\n\ttext-align: left;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n\tfont-size: 12px;\n\tcolor: var(--color-text-3);\n\tflex-grow: 100;\n\tflex-shrink: 0;\n\tmargin-left: 4px;\n}\n\n.tlui-people-menu__user__input {\n\tflex-grow: 2;\n\theight: 100%;\n\tpadding: 0px;\n\tmargin: 0px;\n}\n\n.tlui-people-menu__user > .tlui-input__wrapper {\n\twidth: auto;\n\tdisplay: flex;\n\talign-items: auto;\n\tflex-grow: 2;\n\tgap: 8px;\n\theight: 100%;\n\tpadding: 0px;\n}\n\n.tlui-people-menu__item {\n\tposition: relative;\n}\n\n.tlui-people-menu__item:last-of-type .tlui-button__menu {\n\tmargin-bottom: 0;\n}\n\n.tlui-people-menu__item__button {\n\tpadding: 0 11px;\n\toverflow: hidden;\n}\n\n.tlui-people-menu__item > .tlui-button__menu {\n\twidth: auto;\n\tdisplay: flex;\n\talign-items: auto;\n\tjustify-content: flex-start;\n\tflex-grow: 2;\n\tgap: 11px;\n}\n\n.tlui-people-menu__name {\n\ttext-align: left;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n}\n\n.tlui-people-menu__item__follow {\n\tposition: absolute;\n\ttop: 0px;\n\tright: 0px;\n\tmax-width: 40px;\n\tflex-shrink: 0;\n}\n\n.tlui-people-menu__item[data-follow='true'],\n.tlui-people-menu__item:has(.tlui-button:focus-visible) {\n\tpadding-right: 36px;\n}\n\n.tlui-people-menu__item[data-follow='true'] .tlui-people-menu__item__follow,\n.tlui-people-menu__item:has(.tlui-button:focus-visible) .tlui-people-menu__item__follow {\n\topacity: 1;\n}\n\n@media (hover: hover) {\n\t.tlui-people-menu__item__follow {\n\t\topacity: 0;\n\t}\n\n\t.tlui-people-menu__item:hover {\n\t\tpadding-right: 36px;\n\t}\n\t.tlui-people-menu__item:hover .tlui-people-menu__item__follow {\n\t\topacity: 1;\n\t}\n}\n\n.tlui-menu-click-capture {\n\tposition: fixed;\n\tinset: 0;\n\tz-index: var(--layer-menu-click-capture);\n}\n\n/* --------------- Contextual Toolbar --------------- */\n\n.tlui-contextual-toolbar {\n\tposition: absolute;\n}\n\n/**\n * N.B. We hide the toolbar while mousing down, so no need to turn these off.\n */\n.tlui-contextual-toolbar,\n.tlui-contextual-toolbar * {\n\tpointer-events: all;\n}\n\n.tlui-contextual-toolbar [data-isactive='true']::after {\n\tbackground-color: var(--color-muted-2);\n\topacity: 1;\n}\n\n.tlui-rich-text__toolbar {\n\topacity: 0;\n\ttransition: opacity 0.08s ease-in-out;\n}\n\n.tlui-rich-text__toolbar,\n.tlui-rich-text__toolbar * {\n\tpointer-events: none;\n}\n\n.tlui-rich-text__toolbar[data-visible='true'] {\n\topacity: 1;\n}\n\n.tlui-rich-text__toolbar[data-interactive='true'],\n.tlui-rich-text__toolbar[data-interactive='true'] * {\n\tpointer-events: all;\n}\n\n.tlui-rich-text__toolbar-link-input {\n\tmargin-left: 12px;\n\t/*\n\t * Nice touch tweak: keep the link editor toolbar the same as the default toolbar.\n\t * This is so the toolbar size stays stable going in and out of the link editor.\n\t */\n\twidth: 148px;\n}\n\n.tlui-rich-text__toolbar .tlui-input__wrapper {\n\theight: 40px;\n}\n\n/* ------------------- Accessibilty ------------------- */\n\n.tl-skip-to-main-content {\n\tposition: fixed;\n\ttop: 48px;\n\tleft: -9999px;\n\tpadding: 8px 16px;\n\tz-index: var(--layer-toasts);\n}\n\n.tl-skip-to-main-content:focus {\n\tleft: 8px;\n}\n\n"],sourceRoot:""}]);const __WEBPACK_DEFAULT_EXPORT__=___CSS_LOADER_EXPORT___},"./node_modules/dom-to-image/src/dom-to-image.js":function(module){!function(global){"use strict";var util=function newUtil(){return{escape:function escape(string){return string.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension,mimeType:function mimeType(url){var extension=parseExtension(url).toLowerCase();return function mimes(){var WOFF="application/font-woff",JPEG="image/jpeg";return{woff:WOFF,woff2:WOFF,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:JPEG,jpeg:JPEG,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}()[extension]||""},dataAsUrl:function dataAsUrl(content,type){return"data:"+type+";base64,"+content},isDataUrl:function isDataUrl(url){return-1!==url.search(/^(data:)/)},canvasToBlob:function canvasToBlob(canvas){return canvas.toBlob?new Promise((function(resolve){canvas.toBlob(resolve)})):function toBlob(canvas){return new Promise((function(resolve){for(var binaryString=window.atob(canvas.toDataURL().split(",")[1]),length=binaryString.length,binaryArray=new Uint8Array(length),i=0;i<length;i++)binaryArray[i]=binaryString.charCodeAt(i);resolve(new Blob([binaryArray],{type:"image/png"}))}))}(canvas)},resolveUrl:function resolveUrl(url,baseUrl){var doc=document.implementation.createHTMLDocument(),base=doc.createElement("base");doc.head.appendChild(base);var a=doc.createElement("a");return doc.body.appendChild(a),base.href=baseUrl,a.href=url,a.href},getAndEncode:function getAndEncode(url){var TIMEOUT=3e4;domtoimage.impl.options.cacheBust&&(url+=(/\?/.test(url)?"&":"?")+(new Date).getTime());return new Promise((function(resolve){var placeholder,request=new XMLHttpRequest;if(request.onreadystatechange=done,request.ontimeout=timeout,request.responseType="blob",request.timeout=TIMEOUT,request.open("GET",url,!0),request.send(),domtoimage.impl.options.imagePlaceholder){var split=domtoimage.impl.options.imagePlaceholder.split(/,/);split&&split[1]&&(placeholder=split[1])}function done(){if(4===request.readyState)if(200===request.status){var encoder=new FileReader;encoder.onloadend=function(){var content=encoder.result.split(/,/)[1];resolve(content)},encoder.readAsDataURL(request.response)}else placeholder?resolve(placeholder):fail("cannot fetch resource: "+url+", status: "+request.status)}function timeout(){placeholder?resolve(placeholder):fail("timeout of "+TIMEOUT+"ms occured while fetching resource: "+url)}function fail(message){console.error(message),resolve("")}}))},uid:function uid(){var index=0;return function(){return"u"+fourRandomChars()+index++;function fourRandomChars(){return("0000"+(Math.random()*Math.pow(36,4)|0).toString(36)).slice(-4)}}}(),delay:function delay(ms){return function(arg){return new Promise((function(resolve){setTimeout((function(){resolve(arg)}),ms)}))}},asArray:function asArray(arrayLike){for(var array=[],length=arrayLike.length,i=0;i<length;i++)array.push(arrayLike[i]);return array},escapeXhtml:function escapeXhtml(string){return string.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function makeImage(uri){return new Promise((function(resolve,reject){var image=new Image;image.onload=function(){resolve(image)},image.onerror=reject,image.src=uri}))},width:function width(node){var leftBorder=px(node,"border-left-width"),rightBorder=px(node,"border-right-width");return node.scrollWidth+leftBorder+rightBorder},height:function height(node){var topBorder=px(node,"border-top-width"),bottomBorder=px(node,"border-bottom-width");return node.scrollHeight+topBorder+bottomBorder}};function parseExtension(url){var match=/\.([^\.\/]*?)$/g.exec(url);return match?match[1]:""}function px(node,styleProperty){var value=window.getComputedStyle(node).getPropertyValue(styleProperty);return parseFloat(value.replace("px",""))}}(),inliner=function newInliner(){var URL_REGEX=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function inlineAll(string,baseUrl,get){return nothingToInline()?Promise.resolve(string):Promise.resolve(string).then(readUrls).then((function(urls){var done=Promise.resolve(string);return urls.forEach((function(url){done=done.then((function(string){return inline(string,url,baseUrl,get)}))})),done}));function nothingToInline(){return!shouldProcess(string)}},shouldProcess,impl:{readUrls,inline}};function shouldProcess(string){return-1!==string.search(URL_REGEX)}function readUrls(string){for(var match,result=[];null!==(match=URL_REGEX.exec(string));)result.push(match[1]);return result.filter((function(url){return!util.isDataUrl(url)}))}function inline(string,url,baseUrl,get){return Promise.resolve(url).then((function(url){return baseUrl?util.resolveUrl(url,baseUrl):url})).then(get||util.getAndEncode).then((function(data){return util.dataAsUrl(data,util.mimeType(url))})).then((function(dataUrl){return string.replace(function urlAsRegex(url){return new RegExp("(url\\(['\"]?)("+util.escape(url)+")(['\"]?\\))","g")}(url),"$1"+dataUrl+"$3")}))}}(),fontFaces=function newFontFaces(){return{resolveAll:function resolveAll(){return readAll(document).then((function(webFonts){return Promise.all(webFonts.map((function(webFont){return webFont.resolve()})))})).then((function(cssStrings){return cssStrings.join("\n")}))},impl:{readAll}};function readAll(){return Promise.resolve(util.asArray(document.styleSheets)).then((function getCssRules(styleSheets){var cssRules=[];return styleSheets.forEach((function(sheet){try{util.asArray(sheet.cssRules||[]).forEach(cssRules.push.bind(cssRules))}catch(e){console.log("Error while reading CSS rules from "+sheet.href,e.toString())}})),cssRules})).then((function selectWebFontRules(cssRules){return cssRules.filter((function(rule){return rule.type===CSSRule.FONT_FACE_RULE})).filter((function(rule){return inliner.shouldProcess(rule.style.getPropertyValue("src"))}))})).then((function(rules){return rules.map(newWebFont)}));function newWebFont(webFontRule){return{resolve:function resolve(){var baseUrl=(webFontRule.parentStyleSheet||{}).href;return inliner.inlineAll(webFontRule.cssText,baseUrl)},src:function(){return webFontRule.style.getPropertyValue("src")}}}}}(),images=function newImages(){return{inlineAll:function inlineAll(node){return node instanceof Element?inlineBackground(node).then((function(){return node instanceof HTMLImageElement?newImage(node).inline():Promise.all(util.asArray(node.childNodes).map((function(child){return inlineAll(child)})))})):Promise.resolve(node);function inlineBackground(node){var background=node.style.getPropertyValue("background");return background?inliner.inlineAll(background).then((function(inlined){node.style.setProperty("background",inlined,node.style.getPropertyPriority("background"))})).then((function(){return node})):Promise.resolve(node)}},impl:{newImage}};function newImage(element){return{inline:function inline(get){return util.isDataUrl(element.src)?Promise.resolve():Promise.resolve(element.src).then(get||util.getAndEncode).then((function(data){return util.dataAsUrl(data,util.mimeType(element.src))})).then((function(dataUrl){return new Promise((function(resolve,reject){element.onload=resolve,element.onerror=reject,element.src=dataUrl}))}))}}}}(),defaultOptions={imagePlaceholder:void 0,cacheBust:!1},domtoimage={toSvg,toPng:function toPng(node,options){return draw(node,options||{}).then((function(canvas){return canvas.toDataURL()}))},toJpeg:function toJpeg(node,options){return draw(node,options=options||{}).then((function(canvas){return canvas.toDataURL("image/jpeg",options.quality||1)}))},toBlob:function toBlob(node,options){return draw(node,options||{}).then(util.canvasToBlob)},toPixelData:function toPixelData(node,options){return draw(node,options||{}).then((function(canvas){return canvas.getContext("2d").getImageData(0,0,util.width(node),util.height(node)).data}))},impl:{fontFaces,images,util,inliner,options:{}}};function toSvg(node,options){return function copyOptions(options){void 0===options.imagePlaceholder?domtoimage.impl.options.imagePlaceholder=defaultOptions.imagePlaceholder:domtoimage.impl.options.imagePlaceholder=options.imagePlaceholder;void 0===options.cacheBust?domtoimage.impl.options.cacheBust=defaultOptions.cacheBust:domtoimage.impl.options.cacheBust=options.cacheBust}(options=options||{}),Promise.resolve(node).then((function(node){return cloneNode(node,options.filter,!0)})).then(embedFonts).then(inlineImages).then((function applyOptions(clone){options.bgcolor&&(clone.style.backgroundColor=options.bgcolor);options.width&&(clone.style.width=options.width+"px");options.height&&(clone.style.height=options.height+"px");options.style&&Object.keys(options.style).forEach((function(property){clone.style[property]=options.style[property]}));return clone})).then((function(clone){return function makeSvgDataUri(node,width,height){return Promise.resolve(node).then((function(node){return node.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(node)})).then(util.escapeXhtml).then((function(xhtml){return'<foreignObject x="0" y="0" width="100%" height="100%">'+xhtml+"</foreignObject>"})).then((function(foreignObject){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+width+'" height="'+height+'">'+foreignObject+"</svg>"})).then((function(svg){return"data:image/svg+xml;charset=utf-8,"+svg}))}(clone,options.width||util.width(node),options.height||util.height(node))}))}function draw(domNode,options){return toSvg(domNode,options).then(util.makeImage).then(util.delay(100)).then((function(image){var canvas=function newCanvas(domNode){var canvas=document.createElement("canvas");if(canvas.width=options.width||util.width(domNode),canvas.height=options.height||util.height(domNode),options.bgcolor){var ctx=canvas.getContext("2d");ctx.fillStyle=options.bgcolor,ctx.fillRect(0,0,canvas.width,canvas.height)}return canvas}(domNode);return canvas.getContext("2d").drawImage(image,0,0),canvas}))}function cloneNode(node,filter,root){return root||!filter||filter(node)?Promise.resolve(node).then((function makeNodeCopy(node){return node instanceof HTMLCanvasElement?util.makeImage(node.toDataURL()):node.cloneNode(!1)})).then((function(clone){return function cloneChildren(original,clone,filter){var children=original.childNodes;return 0===children.length?Promise.resolve(clone):cloneChildrenInOrder(clone,util.asArray(children),filter).then((function(){return clone}));function cloneChildrenInOrder(parent,children,filter){var done=Promise.resolve();return children.forEach((function(child){done=done.then((function(){return cloneNode(child,filter)})).then((function(childClone){childClone&&parent.appendChild(childClone)}))})),done}}(node,clone,filter)})).then((function(clone){return function processClone(original,clone){return clone instanceof Element?Promise.resolve().then(cloneStyle).then(clonePseudoElements).then(copyUserInput).then(fixSvg).then((function(){return clone})):clone;function cloneStyle(){function copyStyle(source,target){function copyProperties(source,target){util.asArray(source).forEach((function(name){target.setProperty(name,source.getPropertyValue(name),source.getPropertyPriority(name))}))}source.cssText?target.cssText=source.cssText:copyProperties(source,target)}copyStyle(window.getComputedStyle(original),clone.style)}function clonePseudoElements(){function clonePseudoElement(element){var style=window.getComputedStyle(original,element),content=style.getPropertyValue("content");if(""!==content&&"none"!==content){var className=util.uid();clone.className=clone.className+" "+className;var styleElement=document.createElement("style");styleElement.appendChild(formatPseudoElementStyle(className,element,style)),clone.appendChild(styleElement)}function formatPseudoElementStyle(className,element,style){var selector="."+className+":"+element,cssText=style.cssText?formatCssText(style):formatCssProperties(style);return document.createTextNode(selector+"{"+cssText+"}");function formatCssText(style){var content=style.getPropertyValue("content");return style.cssText+" content: "+content+";"}function formatCssProperties(style){return util.asArray(style).map(formatProperty).join("; ")+";";function formatProperty(name){return name+": "+style.getPropertyValue(name)+(style.getPropertyPriority(name)?" !important":"")}}}}[":before",":after"].forEach((function(element){clonePseudoElement(element)}))}function copyUserInput(){original instanceof HTMLTextAreaElement&&(clone.innerHTML=original.value),original instanceof HTMLInputElement&&clone.setAttribute("value",original.value)}function fixSvg(){clone instanceof SVGElement&&(clone.setAttribute("xmlns","http://www.w3.org/2000/svg"),clone instanceof SVGRectElement&&["width","height"].forEach((function(attribute){var value=clone.getAttribute(attribute);value&&clone.style.setProperty(attribute,value)})))}}(node,clone)})):Promise.resolve()}function embedFonts(node){return fontFaces.resolveAll().then((function(cssText){var styleNode=document.createElement("style");return node.appendChild(styleNode),styleNode.appendChild(document.createTextNode(cssText)),node}))}function inlineImages(node){return images.inlineAll(node).then((function(){return node}))}module.exports=domtoimage}()},"./node_modules/eventemitter3/index.js":module=>{"use strict";var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function addListener(emitter,event,fn,context,once){if("function"!=typeof fn)throw new TypeError("The listener must be a function");var listener=new EE(fn,context||emitter,once),evt=prefix?prefix+event:event;return emitter._events[evt]?emitter._events[evt].fn?emitter._events[evt]=[emitter._events[evt],listener]:emitter._events[evt].push(listener):(emitter._events[evt]=listener,emitter._eventsCount++),emitter}function clearEvent(emitter,evt){0==--emitter._eventsCount?emitter._events=new Events:delete emitter._events[evt]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(prefix=!1)),EventEmitter.prototype.eventNames=function eventNames(){var events,name,names=[];if(0===this._eventsCount)return names;for(name in events=this._events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter.prototype.listeners=function listeners(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++)ee[i]=handlers[i].fn;return ee},EventEmitter.prototype.listenerCount=function listenerCount(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];return listeners?listeners.fn?1:listeners.length:0},EventEmitter.prototype.emit=function emit(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function on(event,fn,context){return addListener(this,event,fn,context,!1)},EventEmitter.prototype.once=function once(event,fn,context){return addListener(this,event,fn,context,!0)},EventEmitter.prototype.removeListener=function removeListener(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn)return clearEvent(this,evt),this;var listeners=this._events[evt];if(listeners.fn)listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context||clearEvent(this,evt);else{for(var i=0,events=[],length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);events.length?this._events[evt]=1===events.length?events[0]:events:clearEvent(this,evt)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(event){var evt;return event?(evt=prefix?prefix+event:event,this._events[evt]&&clearEvent(this,evt)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=prefix,EventEmitter.EventEmitter=EventEmitter,module.exports=EventEmitter},"./node_modules/lodash.isequal/index.js":(module,exports,__webpack_require__)=>{module=__webpack_require__.nmd(module);var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2,MAX_SAFE_INTEGER=9007199254740991,argsTag="[object Arguments]",arrayTag="[object Array]",asyncTag="[object AsyncFunction]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag="[object Number]",nullTag="[object Null]",objectTag="[object Object]",proxyTag="[object Proxy]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",undefinedTag="[object Undefined]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",reIsHostCtor=/^\[object .+?Constructor\]$/,reIsUint=/^(?:0|[1-9]\d*)$/,typedArrayTags={};typedArrayTags["[object Float32Array]"]=typedArrayTags["[object Float64Array]"]=typedArrayTags["[object Int8Array]"]=typedArrayTags["[object Int16Array]"]=typedArrayTags["[object Int32Array]"]=typedArrayTags["[object Uint8Array]"]=typedArrayTags["[object Uint8ClampedArray]"]=typedArrayTags["[object Uint16Array]"]=typedArrayTags["[object Uint32Array]"]=!0,typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags["[object WeakMap]"]=!1;var freeGlobal="object"==typeof __webpack_require__.g&&__webpack_require__.g&&__webpack_require__.g.Object===Object&&__webpack_require__.g,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),freeExports=exports&&!exports.nodeType&&exports,freeModule=freeExports&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,freeProcess=moduleExports&&freeGlobal.process,nodeUtil=function(){try{return freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}(),nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray;function arraySome(array,predicate){for(var index=-1,length=null==array?0:array.length;++index<length;)if(predicate(array[index],index,array))return!0;return!1}function mapToArray(map){var index=-1,result=Array(map.size);return map.forEach((function(value,key){result[++index]=[key,value]})),result}function setToArray(set){var index=-1,result=Array(set.size);return set.forEach((function(value){result[++index]=value})),result}var uid,arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype,coreJsData=root["__core-js_shared__"],funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,maskSrcKey=(uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||""))?"Symbol(src)_1."+uid:"",nativeObjectToString=objectProto.toString,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Buffer=moduleExports?root.Buffer:void 0,Symbol=root.Symbol,Uint8Array=root.Uint8Array,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,symToStringTag=Symbol?Symbol.toStringTag:void 0,nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:void 0,nativeKeys=function overArg(func,transform){return function(arg){return func(transform(arg))}}(Object.keys,Object),DataView=getNative(root,"DataView"),Map=getNative(root,"Map"),Promise=getNative(root,"Promise"),Set=getNative(root,"Set"),WeakMap=getNative(root,"WeakMap"),nativeCreate=getNative(Object,"create"),dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap),symbolProto=Symbol?Symbol.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;function Hash(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function ListCache(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function MapCache(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function SetCache(values){var index=-1,length=null==values?0:values.length;for(this.__data__=new MapCache;++index<length;)this.add(values[index])}function Stack(entries){var data=this.__data__=new ListCache(entries);this.size=data.size}function arrayLikeKeys(value,inherited){var isArr=isArray(value),isArg=!isArr&&isArguments(value),isBuff=!isArr&&!isArg&&isBuffer(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?function baseTimes(n,iteratee){for(var index=-1,result=Array(n);++index<n;)result[index]=iteratee(index);return result}(value.length,String):[],length=result.length;for(var key in value)!inherited&&!hasOwnProperty.call(value,key)||skipIndexes&&("length"==key||isBuff&&("offset"==key||"parent"==key)||isType&&("buffer"==key||"byteLength"==key||"byteOffset"==key)||isIndex(key,length))||result.push(key);return result}function assocIndexOf(array,key){for(var length=array.length;length--;)if(eq(array[length][0],key))return length;return-1}function baseGetTag(value){return null==value?void 0===value?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(value)?function getRawTag(value){var isOwn=hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=void 0;var unmasked=!0}catch(e){}var result=nativeObjectToString.call(value);unmasked&&(isOwn?value[symToStringTag]=tag:delete value[symToStringTag]);return result}(value):function objectToString(value){return nativeObjectToString.call(value)}(value)}function baseIsArguments(value){return isObjectLike(value)&&baseGetTag(value)==argsTag}function baseIsEqual(value,other,bitmask,customizer,stack){return value===other||(null==value||null==other||!isObjectLike(value)&&!isObjectLike(other)?value!=value&&other!=other:function baseIsEqualDeep(object,other,bitmask,customizer,equalFunc,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=objIsArr?arrayTag:getTag(object),othTag=othIsArr?arrayTag:getTag(other),objIsObj=(objTag=objTag==argsTag?objectTag:objTag)==objectTag,othIsObj=(othTag=othTag==argsTag?objectTag:othTag)==objectTag,isSameTag=objTag==othTag;if(isSameTag&&isBuffer(object)){if(!isBuffer(other))return!1;objIsArr=!0,objIsObj=!1}if(isSameTag&&!objIsObj)return stack||(stack=new Stack),objIsArr||isTypedArray(object)?equalArrays(object,other,bitmask,customizer,equalFunc,stack):function equalByTag(object,other,tag,bitmask,customizer,equalFunc,stack){switch(tag){case dataViewTag:if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset)return!1;object=object.buffer,other=other.buffer;case arrayBufferTag:return!(object.byteLength!=other.byteLength||!equalFunc(new Uint8Array(object),new Uint8Array(other)));case boolTag:case dateTag:case numberTag:return eq(+object,+other);case errorTag:return object.name==other.name&&object.message==other.message;case regexpTag:case stringTag:return object==other+"";case mapTag:var convert=mapToArray;case setTag:var isPartial=bitmask&COMPARE_PARTIAL_FLAG;if(convert||(convert=setToArray),object.size!=other.size&&!isPartial)return!1;var stacked=stack.get(object);if(stacked)return stacked==other;bitmask|=COMPARE_UNORDERED_FLAG,stack.set(object,other);var result=equalArrays(convert(object),convert(other),bitmask,customizer,equalFunc,stack);return stack.delete(object),result;case symbolTag:if(symbolValueOf)return symbolValueOf.call(object)==symbolValueOf.call(other)}return!1}(object,other,objTag,bitmask,customizer,equalFunc,stack);if(!(bitmask&COMPARE_PARTIAL_FLAG)){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){var objUnwrapped=objIsWrapped?object.value():object,othUnwrapped=othIsWrapped?other.value():other;return stack||(stack=new Stack),equalFunc(objUnwrapped,othUnwrapped,bitmask,customizer,stack)}}if(!isSameTag)return!1;return stack||(stack=new Stack),function equalObjects(object,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,objProps=getAllKeys(object),objLength=objProps.length,othProps=getAllKeys(other),othLength=othProps.length;if(objLength!=othLength&&!isPartial)return!1;var index=objLength;for(;index--;){var key=objProps[index];if(!(isPartial?key in other:hasOwnProperty.call(other,key)))return!1}var stacked=stack.get(object);if(stacked&&stack.get(other))return stacked==other;var result=!0;stack.set(object,other),stack.set(other,object);var skipCtor=isPartial;for(;++index<objLength;){var objValue=object[key=objProps[index]],othValue=other[key];if(customizer)var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack);if(!(void 0===compared?objValue===othValue||equalFunc(objValue,othValue,bitmask,customizer,stack):compared)){result=!1;break}skipCtor||(skipCtor="constructor"==key)}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;objCtor==othCtor||!("constructor"in object)||!("constructor"in other)||"function"==typeof objCtor&&objCtor instanceof objCtor&&"function"==typeof othCtor&&othCtor instanceof othCtor||(result=!1)}return stack.delete(object),stack.delete(other),result}(object,other,bitmask,customizer,equalFunc,stack)}(value,other,bitmask,customizer,baseIsEqual,stack))}function baseIsNative(value){return!(!isObject(value)||function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}(value))&&(isFunction(value)?reIsNative:reIsHostCtor).test(toSource(value))}function baseKeys(object){if(!function isPrototype(value){var Ctor=value&&value.constructor,proto="function"==typeof Ctor&&Ctor.prototype||objectProto;return value===proto}(object))return nativeKeys(object);var result=[];for(var key in Object(object))hasOwnProperty.call(object,key)&&"constructor"!=key&&result.push(key);return result}function equalArrays(array,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength))return!1;var stacked=stack.get(array);if(stacked&&stack.get(other))return stacked==other;var index=-1,result=!0,seen=bitmask&COMPARE_UNORDERED_FLAG?new SetCache:void 0;for(stack.set(array,other),stack.set(other,array);++index<arrLength;){var arrValue=array[index],othValue=other[index];if(customizer)var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack);if(void 0!==compared){if(compared)continue;result=!1;break}if(seen){if(!arraySome(other,(function(othValue,othIndex){if(key=othIndex,!seen.has(key)&&(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack)))return seen.push(othIndex);var key}))){result=!1;break}}else if(arrValue!==othValue&&!equalFunc(arrValue,othValue,bitmask,customizer,stack)){result=!1;break}}return stack.delete(array),stack.delete(other),result}function getAllKeys(object){return function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:function arrayPush(array,values){for(var index=-1,length=values.length,offset=array.length;++index<length;)array[offset+index]=values[index];return array}(result,symbolsFunc(object))}(object,keys,getSymbols)}function getMapData(map,key){var data=map.__data__;return function isKeyable(value){var type=typeof value;return"string"==type||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value}(key)?data["string"==typeof key?"string":"hash"]:data.map}function getNative(object,key){var value=function getValue(object,key){return null==object?void 0:object[key]}(object,key);return baseIsNative(value)?value:void 0}Hash.prototype.clear=function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{},this.size=0},Hash.prototype.delete=function hashDelete(key){var result=this.has(key)&&delete this.__data__[key];return this.size-=result?1:0,result},Hash.prototype.get=function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return"__lodash_hash_undefined__"===result?void 0:result}return hasOwnProperty.call(data,key)?data[key]:void 0},Hash.prototype.has=function hashHas(key){var data=this.__data__;return nativeCreate?void 0!==data[key]:hasOwnProperty.call(data,key)},Hash.prototype.set=function hashSet(key,value){var data=this.__data__;return this.size+=this.has(key)?0:1,data[key]=nativeCreate&&void 0===value?"__lodash_hash_undefined__":value,this},ListCache.prototype.clear=function listCacheClear(){this.__data__=[],this.size=0},ListCache.prototype.delete=function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);return!(index<0)&&(index==data.length-1?data.pop():splice.call(data,index,1),--this.size,!0)},ListCache.prototype.get=function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?void 0:data[index][1]},ListCache.prototype.has=function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1},ListCache.prototype.set=function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);return index<0?(++this.size,data.push([key,value])):data[index][1]=value,this},MapCache.prototype.clear=function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}},MapCache.prototype.delete=function mapCacheDelete(key){var result=getMapData(this,key).delete(key);return this.size-=result?1:0,result},MapCache.prototype.get=function mapCacheGet(key){return getMapData(this,key).get(key)},MapCache.prototype.has=function mapCacheHas(key){return getMapData(this,key).has(key)},MapCache.prototype.set=function mapCacheSet(key,value){var data=getMapData(this,key),size=data.size;return data.set(key,value),this.size+=data.size==size?0:1,this},SetCache.prototype.add=SetCache.prototype.push=function setCacheAdd(value){return this.__data__.set(value,"__lodash_hash_undefined__"),this},SetCache.prototype.has=function setCacheHas(value){return this.__data__.has(value)},Stack.prototype.clear=function stackClear(){this.__data__=new ListCache,this.size=0},Stack.prototype.delete=function stackDelete(key){var data=this.__data__,result=data.delete(key);return this.size=data.size,result},Stack.prototype.get=function stackGet(key){return this.__data__.get(key)},Stack.prototype.has=function stackHas(key){return this.__data__.has(key)},Stack.prototype.set=function stackSet(key,value){var data=this.__data__;if(data instanceof ListCache){var pairs=data.__data__;if(!Map||pairs.length<199)return pairs.push([key,value]),this.size=++data.size,this;data=this.__data__=new MapCache(pairs)}return data.set(key,value),this.size=data.size,this};var getSymbols=nativeGetSymbols?function(object){return null==object?[]:(object=Object(object),function arrayFilter(array,predicate){for(var index=-1,length=null==array?0:array.length,resIndex=0,result=[];++index<length;){var value=array[index];predicate(value,index,array)&&(result[resIndex++]=value)}return result}(nativeGetSymbols(object),(function(symbol){return propertyIsEnumerable.call(object,symbol)})))}:function stubArray(){return[]},getTag=baseGetTag;function isIndex(value,length){return!!(length=null==length?MAX_SAFE_INTEGER:length)&&("number"==typeof value||reIsUint.test(value))&&value>-1&&value%1==0&&value<length}function toSource(func){if(null!=func){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function eq(value,other){return value===other||value!=value&&other!=other}(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map)!=mapTag||Promise&&"[object Promise]"!=getTag(Promise.resolve())||Set&&getTag(new Set)!=setTag||WeakMap&&"[object WeakMap]"!=getTag(new WeakMap))&&(getTag=function(value){var result=baseGetTag(value),Ctor=result==objectTag?value.constructor:void 0,ctorString=Ctor?toSource(Ctor):"";if(ctorString)switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return"[object Promise]";case setCtorString:return setTag;case weakMapCtorString:return"[object WeakMap]"}return result});var isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")},isArray=Array.isArray;var isBuffer=nativeIsBuffer||function stubFalse(){return!1};function isFunction(value){if(!isObject(value))return!1;var tag=baseGetTag(value);return tag==funcTag||tag==genTag||tag==asyncTag||tag==proxyTag}function isLength(value){return"number"==typeof value&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return null!=value&&("object"==type||"function"==type)}function isObjectLike(value){return null!=value&&"object"==typeof value}var isTypedArray=nodeIsTypedArray?function baseUnary(func){return function(value){return func(value)}}(nodeIsTypedArray):function baseIsTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[baseGetTag(value)]};function keys(object){return function isArrayLike(value){return null!=value&&isLength(value.length)&&!isFunction(value)}(object)?arrayLikeKeys(object):baseKeys(object)}module.exports=function isEqual(value,other){return baseIsEqual(value,other)}},"./node_modules/lodash.throttle/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{var FUNC_ERROR_TEXT="Expected a function",NAN=NaN,symbolTag="[object Symbol]",reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,freeGlobal="object"==typeof __webpack_require__.g&&__webpack_require__.g&&__webpack_require__.g.Object===Object&&__webpack_require__.g,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),objectToString=Object.prototype.toString,nativeMax=Math.max,nativeMin=Math.min,now=function(){return root.Date.now()};function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=!1,maxing=!1,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);function invokeFunc(time){var args=lastArgs,thisArg=lastThis;return lastArgs=lastThis=void 0,lastInvokeTime=time,result=func.apply(thisArg,args)}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime;return void 0===lastCallTime||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&time-lastInvokeTime>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time))return trailingEdge(time);timerId=setTimeout(timerExpired,function remainingWait(time){var result=wait-(time-lastCallTime);return maxing?nativeMin(result,maxWait-(time-lastInvokeTime)):result}(time))}function trailingEdge(time){return timerId=void 0,trailing&&lastArgs?invokeFunc(time):(lastArgs=lastThis=void 0,result)}function debounced(){var time=now(),isInvoking=shouldInvoke(time);if(lastArgs=arguments,lastThis=this,lastCallTime=time,isInvoking){if(void 0===timerId)return function leadingEdge(time){return lastInvokeTime=time,timerId=setTimeout(timerExpired,wait),leading?invokeFunc(time):result}(lastCallTime);if(maxing)return timerId=setTimeout(timerExpired,wait),invokeFunc(lastCallTime)}return void 0===timerId&&(timerId=setTimeout(timerExpired,wait)),result}return wait=toNumber(wait)||0,isObject(options)&&(leading=!!options.leading,maxWait=(maxing="maxWait"in options)?nativeMax(toNumber(options.maxWait)||0,wait):maxWait,trailing="trailing"in options?!!options.trailing:trailing),debounced.cancel=function cancel(){void 0!==timerId&&clearTimeout(timerId),lastInvokeTime=0,lastArgs=lastCallTime=lastThis=timerId=void 0},debounced.flush=function flush(){return void 0===timerId?result:trailingEdge(now())},debounced}function isObject(value){var type=typeof value;return!!value&&("object"==type||"function"==type)}function toNumber(value){if("number"==typeof value)return value;if(function isSymbol(value){return"symbol"==typeof value||function isObjectLike(value){return!!value&&"object"==typeof value}(value)&&objectToString.call(value)==symbolTag}(value))return NAN;if(isObject(value)){var other="function"==typeof value.valueOf?value.valueOf():value;value=isObject(other)?other+"":other}if("string"!=typeof value)return 0===value?value:+value;value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}module.exports=function throttle(func,wait,options){var leading=!0,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return isObject(options)&&(leading="leading"in options?!!options.leading:leading,trailing="trailing"in options?!!options.trailing:trailing),debounce(func,wait,{leading,maxWait:wait,trailing})}},"./node_modules/lodash.uniq/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{var LARGE_ARRAY_SIZE=200,funcTag="[object Function]",genTag="[object GeneratorFunction]",reIsHostCtor=/^\[object .+?Constructor\]$/,freeGlobal="object"==typeof __webpack_require__.g&&__webpack_require__.g&&__webpack_require__.g.Object===Object&&__webpack_require__.g,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")();function arrayIncludes(array,value){return!!(array?array.length:0)&&function baseIndexOf(array,value,fromIndex){if(value!=value)return function baseFindIndex(array,predicate,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?1:-1);for(;fromRight?index--:++index<length;)if(predicate(array[index],index,array))return index;return-1}(array,baseIsNaN,fromIndex);var index=fromIndex-1,length=array.length;for(;++index<length;)if(array[index]===value)return index;return-1}(array,value,0)>-1}function arrayIncludesWith(array,value,comparator){for(var index=-1,length=array?array.length:0;++index<length;)if(comparator(value,array[index]))return!0;return!1}function baseIsNaN(value){return value!=value}function cacheHas(cache,key){return cache.has(key)}function setToArray(set){var index=-1,result=Array(set.size);return set.forEach((function(value){result[++index]=value})),result}var uid,arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype,coreJsData=root["__core-js_shared__"],maskSrcKey=(uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||""))?"Symbol(src)_1."+uid:"",funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,objectToString=objectProto.toString,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),splice=arrayProto.splice,Map=getNative(root,"Map"),Set=getNative(root,"Set"),nativeCreate=getNative(Object,"create");function Hash(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function ListCache(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function MapCache(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function SetCache(values){var index=-1,length=values?values.length:0;for(this.__data__=new MapCache;++index<length;)this.add(values[index])}function assocIndexOf(array,key){for(var value,other,length=array.length;length--;)if((value=array[length][0])===(other=key)||value!=value&&other!=other)return length;return-1}function baseIsNative(value){if(!isObject(value)||function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}(value))return!1;var pattern=function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}(value)||function isHostObject(value){var result=!1;if(null!=value&&"function"!=typeof value.toString)try{result=!!(value+"")}catch(e){}return result}(value)?reIsNative:reIsHostCtor;return pattern.test(function toSource(func){if(null!=func){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}(value))}Hash.prototype.clear=function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}},Hash.prototype.delete=function hashDelete(key){return this.has(key)&&delete this.__data__[key]},Hash.prototype.get=function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return"__lodash_hash_undefined__"===result?void 0:result}return hasOwnProperty.call(data,key)?data[key]:void 0},Hash.prototype.has=function hashHas(key){var data=this.__data__;return nativeCreate?void 0!==data[key]:hasOwnProperty.call(data,key)},Hash.prototype.set=function hashSet(key,value){return this.__data__[key]=nativeCreate&&void 0===value?"__lodash_hash_undefined__":value,this},ListCache.prototype.clear=function listCacheClear(){this.__data__=[]},ListCache.prototype.delete=function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);return!(index<0)&&(index==data.length-1?data.pop():splice.call(data,index,1),!0)},ListCache.prototype.get=function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?void 0:data[index][1]},ListCache.prototype.has=function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1},ListCache.prototype.set=function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);return index<0?data.push([key,value]):data[index][1]=value,this},MapCache.prototype.clear=function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}},MapCache.prototype.delete=function mapCacheDelete(key){return getMapData(this,key).delete(key)},MapCache.prototype.get=function mapCacheGet(key){return getMapData(this,key).get(key)},MapCache.prototype.has=function mapCacheHas(key){return getMapData(this,key).has(key)},MapCache.prototype.set=function mapCacheSet(key,value){return getMapData(this,key).set(key,value),this},SetCache.prototype.add=SetCache.prototype.push=function setCacheAdd(value){return this.__data__.set(value,"__lodash_hash_undefined__"),this},SetCache.prototype.has=function setCacheHas(value){return this.__data__.has(value)};var createSet=Set&&1/setToArray(new Set([,-0]))[1]==1/0?function(values){return new Set(values)}:function noop(){};function getMapData(map,key){var data=map.__data__;return function isKeyable(value){var type=typeof value;return"string"==type||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value}(key)?data["string"==typeof key?"string":"hash"]:data.map}function getNative(object,key){var value=function getValue(object,key){return null==object?void 0:object[key]}(object,key);return baseIsNative(value)?value:void 0}function isObject(value){var type=typeof value;return!!value&&("object"==type||"function"==type)}module.exports=function uniq(array){return array&&array.length?function baseUniq(array,iteratee,comparator){var index=-1,includes=arrayIncludes,length=array.length,isCommon=!0,result=[],seen=result;if(comparator)isCommon=!1,includes=arrayIncludesWith;else if(length>=LARGE_ARRAY_SIZE){var set=iteratee?null:createSet(array);if(set)return setToArray(set);isCommon=!1,includes=cacheHas,seen=new SetCache}else seen=iteratee?[]:result;outer:for(;++index<length;){var value=array[index],computed=iteratee?iteratee(value):value;if(value=comparator||0!==value?value:0,isCommon&&computed==computed){for(var seenIndex=seen.length;seenIndex--;)if(seen[seenIndex]===computed)continue outer;iteratee&&seen.push(computed),result.push(value)}else includes(seen,computed,comparator)||(seen!==result&&seen.push(computed),result.push(value))}return result}(array):[]}},"./node_modules/lz-string/libs/lz-string.js":(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_RESULT__,LZString=function(){var f=String.fromCharCode,keyStrBase64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",keyStrUriSafe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",baseReverseDic={};function getBaseValue(alphabet,character){if(!baseReverseDic[alphabet]){baseReverseDic[alphabet]={};for(var i=0;i<alphabet.length;i++)baseReverseDic[alphabet][alphabet.charAt(i)]=i}return baseReverseDic[alphabet][character]}var LZString={compressToBase64:function(input){if(null==input)return"";var res=LZString._compress(input,6,(function(a){return keyStrBase64.charAt(a)}));switch(res.length%4){default:case 0:return res;case 1:return res+"===";case 2:return res+"==";case 3:return res+"="}},decompressFromBase64:function(input){return null==input?"":""==input?null:LZString._decompress(input.length,32,(function(index){return getBaseValue(keyStrBase64,input.charAt(index))}))},compressToUTF16:function(input){return null==input?"":LZString._compress(input,15,(function(a){return f(a+32)}))+" "},decompressFromUTF16:function(compressed){return null==compressed?"":""==compressed?null:LZString._decompress(compressed.length,16384,(function(index){return compressed.charCodeAt(index)-32}))},compressToUint8Array:function(uncompressed){for(var compressed=LZString.compress(uncompressed),buf=new Uint8Array(2*compressed.length),i=0,TotalLen=compressed.length;i<TotalLen;i++){var current_value=compressed.charCodeAt(i);buf[2*i]=current_value>>>8,buf[2*i+1]=current_value%256}return buf},decompressFromUint8Array:function(compressed){if(null==compressed)return LZString.decompress(compressed);for(var buf=new Array(compressed.length/2),i=0,TotalLen=buf.length;i<TotalLen;i++)buf[i]=256*compressed[2*i]+compressed[2*i+1];var result=[];return buf.forEach((function(c){result.push(f(c))})),LZString.decompress(result.join(""))},compressToEncodedURIComponent:function(input){return null==input?"":LZString._compress(input,6,(function(a){return keyStrUriSafe.charAt(a)}))},decompressFromEncodedURIComponent:function(input){return null==input?"":""==input?null:(input=input.replace(/ /g,"+"),LZString._decompress(input.length,32,(function(index){return getBaseValue(keyStrUriSafe,input.charAt(index))})))},compress:function(uncompressed){return LZString._compress(uncompressed,16,(function(a){return f(a)}))},_compress:function(uncompressed,bitsPerChar,getCharFromInt){if(null==uncompressed)return"";var i,value,ii,context_dictionary={},context_dictionaryToCreate={},context_c="",context_wc="",context_w="",context_enlargeIn=2,context_dictSize=3,context_numBits=2,context_data=[],context_data_val=0,context_data_position=0;for(ii=0;ii<uncompressed.length;ii+=1)if(context_c=uncompressed.charAt(ii),Object.prototype.hasOwnProperty.call(context_dictionary,context_c)||(context_dictionary[context_c]=context_dictSize++,context_dictionaryToCreate[context_c]=!0),context_wc=context_w+context_c,Object.prototype.hasOwnProperty.call(context_dictionary,context_wc))context_w=context_wc;else{if(Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)){if(context_w.charCodeAt(0)<256){for(i=0;i<context_numBits;i++)context_data_val<<=1,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++;for(value=context_w.charCodeAt(0),i=0;i<8;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1}else{for(value=1,i=0;i<context_numBits;i++)context_data_val=context_data_val<<1|value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value=0;for(value=context_w.charCodeAt(0),i=0;i<16;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1}0==--context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++),delete context_dictionaryToCreate[context_w]}else for(value=context_dictionary[context_w],i=0;i<context_numBits;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1;0==--context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++),context_dictionary[context_wc]=context_dictSize++,context_w=String(context_c)}if(""!==context_w){if(Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)){if(context_w.charCodeAt(0)<256){for(i=0;i<context_numBits;i++)context_data_val<<=1,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++;for(value=context_w.charCodeAt(0),i=0;i<8;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1}else{for(value=1,i=0;i<context_numBits;i++)context_data_val=context_data_val<<1|value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value=0;for(value=context_w.charCodeAt(0),i=0;i<16;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1}0==--context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++),delete context_dictionaryToCreate[context_w]}else for(value=context_dictionary[context_w],i=0;i<context_numBits;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1;0==--context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++)}for(value=2,i=0;i<context_numBits;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1;for(;;){if(context_data_val<<=1,context_data_position==bitsPerChar-1){context_data.push(getCharFromInt(context_data_val));break}context_data_position++}return context_data.join("")},decompress:function(compressed){return null==compressed?"":""==compressed?null:LZString._decompress(compressed.length,32768,(function(index){return compressed.charCodeAt(index)}))},_decompress:function(length,resetValue,getNextValue){var i,w,bits,resb,maxpower,power,c,dictionary=[],enlargeIn=4,dictSize=4,numBits=3,entry="",result=[],data={val:getNextValue(0),position:resetValue,index:1};for(i=0;i<3;i+=1)dictionary[i]=i;for(bits=0,maxpower=Math.pow(2,2),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=resetValue,data.val=getNextValue(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;switch(bits){case 0:for(bits=0,maxpower=Math.pow(2,8),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=resetValue,data.val=getNextValue(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;c=f(bits);break;case 1:for(bits=0,maxpower=Math.pow(2,16),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=resetValue,data.val=getNextValue(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;c=f(bits);break;case 2:return""}for(dictionary[3]=c,w=c,result.push(c);;){if(data.index>length)return"";for(bits=0,maxpower=Math.pow(2,numBits),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=resetValue,data.val=getNextValue(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;switch(c=bits){case 0:for(bits=0,maxpower=Math.pow(2,8),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=resetValue,data.val=getNextValue(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;dictionary[dictSize++]=f(bits),c=dictSize-1,enlargeIn--;break;case 1:for(bits=0,maxpower=Math.pow(2,16),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=resetValue,data.val=getNextValue(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;dictionary[dictSize++]=f(bits),c=dictSize-1,enlargeIn--;break;case 2:return result.join("")}if(0==enlargeIn&&(enlargeIn=Math.pow(2,numBits),numBits++),dictionary[c])entry=dictionary[c];else{if(c!==dictSize)return null;entry=w+w.charAt(0)}result.push(entry),dictionary[dictSize++]=w+entry.charAt(0),w=entry,0==--enlargeIn&&(enlargeIn=Math.pow(2,numBits),numBits++)}}};return LZString}();void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return LZString}.call(exports,__webpack_require__,exports,module))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},"./node_modules/prosemirror-keymap/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{K:()=>keydownHandler,w:()=>keymap});var w3c_keyname__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/w3c-keyname/index.js"),prosemirror_state__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/prosemirror-state/dist/index.js");const mac="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),windows="undefined"!=typeof navigator&&/Win/.test(navigator.platform);function normalizeKeyName(name){let alt,ctrl,shift,meta,parts=name.split(/-(?!$)/),result=parts[parts.length-1];"Space"==result&&(result=" ");for(let i=0;i<parts.length-1;i++){let mod=parts[i];if(/^(cmd|meta|m)$/i.test(mod))meta=!0;else if(/^a(lt)?$/i.test(mod))alt=!0;else if(/^(c|ctrl|control)$/i.test(mod))ctrl=!0;else if(/^s(hift)?$/i.test(mod))shift=!0;else{if(!/^mod$/i.test(mod))throw new Error("Unrecognized modifier name: "+mod);mac?meta=!0:ctrl=!0}}return alt&&(result="Alt-"+result),ctrl&&(result="Ctrl-"+result),meta&&(result="Meta-"+result),shift&&(result="Shift-"+result),result}function modifiers(name,event,shift=!0){return event.altKey&&(name="Alt-"+name),event.ctrlKey&&(name="Ctrl-"+name),event.metaKey&&(name="Meta-"+name),shift&&event.shiftKey&&(name="Shift-"+name),name}function keymap(bindings){return new prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.k_({props:{handleKeyDown:keydownHandler(bindings)}})}function keydownHandler(bindings){let map=function normalize(map){let copy=Object.create(null);for(let prop in map)copy[normalizeKeyName(prop)]=map[prop];return copy}(bindings);return function(view,event){let baseName,name=(0,w3c_keyname__WEBPACK_IMPORTED_MODULE_0__.xT)(event),direct=map[modifiers(name,event)];if(direct&&direct(view.state,view.dispatch,view))return!0;if(1==name.length&&" "!=name){if(event.shiftKey){let noShift=map[modifiers(name,event,!1)];if(noShift&&noShift(view.state,view.dispatch,view))return!0}if((event.altKey||event.metaKey||event.ctrlKey)&&!(windows&&event.ctrlKey&&event.altKey)&&(baseName=w3c_keyname__WEBPACK_IMPORTED_MODULE_0__.E3[event.keyCode])&&baseName!=name){let fromCode=map[modifiers(baseName,event)];if(fromCode&&fromCode(view.state,view.dispatch,view))return!0}}return!1}}},"./node_modules/prosemirror-model/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function OrderedMap(content){this.content=content}__webpack_require__.d(__webpack_exports__,{S4:()=>DOMParser,ZF:()=>DOMSerializer,FK:()=>Fragment,CU:()=>Mark,sX:()=>MarkType,bP:()=>Node,u$:()=>NodeRange,vI:()=>ReplaceError,Sj:()=>Schema,Ji:()=>Slice}),OrderedMap.prototype={constructor:OrderedMap,find:function(key){for(var i=0;i<this.content.length;i+=2)if(this.content[i]===key)return i;return-1},get:function(key){var found=this.find(key);return-1==found?void 0:this.content[found+1]},update:function(key,value,newKey){var self=newKey&&newKey!=key?this.remove(newKey):this,found=self.find(key),content=self.content.slice();return-1==found?content.push(newKey||key,value):(content[found+1]=value,newKey&&(content[found]=newKey)),new OrderedMap(content)},remove:function(key){var found=this.find(key);if(-1==found)return this;var content=this.content.slice();return content.splice(found,2),new OrderedMap(content)},addToStart:function(key,value){return new OrderedMap([key,value].concat(this.remove(key).content))},addToEnd:function(key,value){var content=this.remove(key).content.slice();return content.push(key,value),new OrderedMap(content)},addBefore:function(place,key,value){var without=this.remove(key),content=without.content.slice(),found=without.find(place);return content.splice(-1==found?content.length:found,0,key,value),new OrderedMap(content)},forEach:function(f){for(var i=0;i<this.content.length;i+=2)f(this.content[i],this.content[i+1])},prepend:function(map){return(map=OrderedMap.from(map)).size?new OrderedMap(map.content.concat(this.subtract(map).content)):this},append:function(map){return(map=OrderedMap.from(map)).size?new OrderedMap(this.subtract(map).content.concat(map.content)):this},subtract:function(map){var result=this;map=OrderedMap.from(map);for(var i=0;i<map.content.length;i+=2)result=result.remove(map.content[i]);return result},toObject:function(){var result={};return this.forEach((function(key,value){result[key]=value})),result},get size(){return this.content.length>>1}},OrderedMap.from=function(value){if(value instanceof OrderedMap)return value;var content=[];if(value)for(var prop in value)content.push(prop,value[prop]);return new OrderedMap(content)};const dist=OrderedMap;function findDiffStart(a,b,pos){for(let i=0;;i++){if(i==a.childCount||i==b.childCount)return a.childCount==b.childCount?null:pos;let childA=a.child(i),childB=b.child(i);if(childA!=childB){if(!childA.sameMarkup(childB))return pos;if(childA.isText&&childA.text!=childB.text){for(let j=0;childA.text[j]==childB.text[j];j++)pos++;return pos}if(childA.content.size||childB.content.size){let inner=findDiffStart(childA.content,childB.content,pos+1);if(null!=inner)return inner}pos+=childA.nodeSize}else pos+=childA.nodeSize}}function findDiffEnd(a,b,posA,posB){for(let iA=a.childCount,iB=b.childCount;;){if(0==iA||0==iB)return iA==iB?null:{a:posA,b:posB};let childA=a.child(--iA),childB=b.child(--iB),size=childA.nodeSize;if(childA!=childB){if(!childA.sameMarkup(childB))return{a:posA,b:posB};if(childA.isText&&childA.text!=childB.text){let same=0,minSize=Math.min(childA.text.length,childB.text.length);for(;same<minSize&&childA.text[childA.text.length-same-1]==childB.text[childB.text.length-same-1];)same++,posA--,posB--;return{a:posA,b:posB}}if(childA.content.size||childB.content.size){let inner=findDiffEnd(childA.content,childB.content,posA-1,posB-1);if(inner)return inner}posA-=size,posB-=size}else posA-=size,posB-=size}}class Fragment{constructor(content,size){if(this.content=content,this.size=size||0,null==size)for(let i=0;i<content.length;i++)this.size+=content[i].nodeSize}nodesBetween(from,to,f,nodeStart=0,parent){for(let i=0,pos=0;pos<to;i++){let child=this.content[i],end=pos+child.nodeSize;if(end>from&&!1!==f(child,nodeStart+pos,parent||null,i)&&child.content.size){let start=pos+1;child.nodesBetween(Math.max(0,from-start),Math.min(child.content.size,to-start),f,nodeStart+start)}pos=end}}descendants(f){this.nodesBetween(0,this.size,f)}textBetween(from,to,blockSeparator,leafText){let text="",first=!0;return this.nodesBetween(from,to,((node,pos)=>{let nodeText=node.isText?node.text.slice(Math.max(from,pos)-pos,to-pos):node.isLeaf?leafText?"function"==typeof leafText?leafText(node):leafText:node.type.spec.leafText?node.type.spec.leafText(node):"":"";node.isBlock&&(node.isLeaf&&nodeText||node.isTextblock)&&blockSeparator&&(first?first=!1:text+=blockSeparator),text+=nodeText}),0),text}append(other){if(!other.size)return this;if(!this.size)return other;let last=this.lastChild,first=other.firstChild,content=this.content.slice(),i=0;for(last.isText&&last.sameMarkup(first)&&(content[content.length-1]=last.withText(last.text+first.text),i=1);i<other.content.length;i++)content.push(other.content[i]);return new Fragment(content,this.size+other.size)}cut(from,to=this.size){if(0==from&&to==this.size)return this;let result=[],size=0;if(to>from)for(let i=0,pos=0;pos<to;i++){let child=this.content[i],end=pos+child.nodeSize;end>from&&((pos<from||end>to)&&(child=child.isText?child.cut(Math.max(0,from-pos),Math.min(child.text.length,to-pos)):child.cut(Math.max(0,from-pos-1),Math.min(child.content.size,to-pos-1))),result.push(child),size+=child.nodeSize),pos=end}return new Fragment(result,size)}cutByIndex(from,to){return from==to?Fragment.empty:0==from&&to==this.content.length?this:new Fragment(this.content.slice(from,to))}replaceChild(index,node){let current=this.content[index];if(current==node)return this;let copy=this.content.slice(),size=this.size+node.nodeSize-current.nodeSize;return copy[index]=node,new Fragment(copy,size)}addToStart(node){return new Fragment([node].concat(this.content),this.size+node.nodeSize)}addToEnd(node){return new Fragment(this.content.concat(node),this.size+node.nodeSize)}eq(other){if(this.content.length!=other.content.length)return!1;for(let i=0;i<this.content.length;i++)if(!this.content[i].eq(other.content[i]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(index){let found=this.content[index];if(!found)throw new RangeError("Index "+index+" out of range for "+this);return found}maybeChild(index){return this.content[index]||null}forEach(f){for(let i=0,p=0;i<this.content.length;i++){let child=this.content[i];f(child,p,i),p+=child.nodeSize}}findDiffStart(other,pos=0){return findDiffStart(this,other,pos)}findDiffEnd(other,pos=this.size,otherPos=other.size){return findDiffEnd(this,other,pos,otherPos)}findIndex(pos,round=-1){if(0==pos)return retIndex(0,pos);if(pos==this.size)return retIndex(this.content.length,pos);if(pos>this.size||pos<0)throw new RangeError(`Position ${pos} outside of fragment (${this})`);for(let i=0,curPos=0;;i++){let end=curPos+this.child(i).nodeSize;if(end>=pos)return end==pos||round>0?retIndex(i+1,end):retIndex(i,curPos);curPos=end}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map((n=>n.toJSON())):null}static fromJSON(schema,value){if(!value)return Fragment.empty;if(!Array.isArray(value))throw new RangeError("Invalid input for Fragment.fromJSON");return new Fragment(value.map(schema.nodeFromJSON))}static fromArray(array){if(!array.length)return Fragment.empty;let joined,size=0;for(let i=0;i<array.length;i++){let node=array[i];size+=node.nodeSize,i&&node.isText&&array[i-1].sameMarkup(node)?(joined||(joined=array.slice(0,i)),joined[joined.length-1]=node.withText(joined[joined.length-1].text+node.text)):joined&&joined.push(node)}return new Fragment(joined||array,size)}static from(nodes){if(!nodes)return Fragment.empty;if(nodes instanceof Fragment)return nodes;if(Array.isArray(nodes))return this.fromArray(nodes);if(nodes.attrs)return new Fragment([nodes],nodes.nodeSize);throw new RangeError("Can not convert "+nodes+" to a Fragment"+(nodes.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Fragment.empty=new Fragment([],0);const found={index:0,offset:0};function retIndex(index,offset){return found.index=index,found.offset=offset,found}function compareDeep(a,b){if(a===b)return!0;if(!a||"object"!=typeof a||!b||"object"!=typeof b)return!1;let array=Array.isArray(a);if(Array.isArray(b)!=array)return!1;if(array){if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++)if(!compareDeep(a[i],b[i]))return!1}else{for(let p in a)if(!(p in b)||!compareDeep(a[p],b[p]))return!1;for(let p in b)if(!(p in a))return!1}return!0}class Mark{constructor(type,attrs){this.type=type,this.attrs=attrs}addToSet(set){let copy,placed=!1;for(let i=0;i<set.length;i++){let other=set[i];if(this.eq(other))return set;if(this.type.excludes(other.type))copy||(copy=set.slice(0,i));else{if(other.type.excludes(this.type))return set;!placed&&other.type.rank>this.type.rank&&(copy||(copy=set.slice(0,i)),copy.push(this),placed=!0),copy&&copy.push(other)}}return copy||(copy=set.slice()),placed||copy.push(this),copy}removeFromSet(set){for(let i=0;i<set.length;i++)if(this.eq(set[i]))return set.slice(0,i).concat(set.slice(i+1));return set}isInSet(set){for(let i=0;i<set.length;i++)if(this.eq(set[i]))return!0;return!1}eq(other){return this==other||this.type==other.type&&compareDeep(this.attrs,other.attrs)}toJSON(){let obj={type:this.type.name};for(let _ in this.attrs){obj.attrs=this.attrs;break}return obj}static fromJSON(schema,json){if(!json)throw new RangeError("Invalid input for Mark.fromJSON");let type=schema.marks[json.type];if(!type)throw new RangeError(`There is no mark type ${json.type} in this schema`);let mark=type.create(json.attrs);return type.checkAttrs(mark.attrs),mark}static sameSet(a,b){if(a==b)return!0;if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++)if(!a[i].eq(b[i]))return!1;return!0}static setFrom(marks){if(!marks||Array.isArray(marks)&&0==marks.length)return Mark.none;if(marks instanceof Mark)return[marks];let copy=marks.slice();return copy.sort(((a,b)=>a.type.rank-b.type.rank)),copy}}Mark.none=[];class ReplaceError extends Error{}class Slice{constructor(content,openStart,openEnd){this.content=content,this.openStart=openStart,this.openEnd=openEnd}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(pos,fragment){let content=insertInto(this.content,pos+this.openStart,fragment);return content&&new Slice(content,this.openStart,this.openEnd)}removeBetween(from,to){return new Slice(removeRange(this.content,from+this.openStart,to+this.openStart),this.openStart,this.openEnd)}eq(other){return this.content.eq(other.content)&&this.openStart==other.openStart&&this.openEnd==other.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let json={content:this.content.toJSON()};return this.openStart>0&&(json.openStart=this.openStart),this.openEnd>0&&(json.openEnd=this.openEnd),json}static fromJSON(schema,json){if(!json)return Slice.empty;let openStart=json.openStart||0,openEnd=json.openEnd||0;if("number"!=typeof openStart||"number"!=typeof openEnd)throw new RangeError("Invalid input for Slice.fromJSON");return new Slice(Fragment.fromJSON(schema,json.content),openStart,openEnd)}static maxOpen(fragment,openIsolating=!0){let openStart=0,openEnd=0;for(let n=fragment.firstChild;n&&!n.isLeaf&&(openIsolating||!n.type.spec.isolating);n=n.firstChild)openStart++;for(let n=fragment.lastChild;n&&!n.isLeaf&&(openIsolating||!n.type.spec.isolating);n=n.lastChild)openEnd++;return new Slice(fragment,openStart,openEnd)}}function removeRange(content,from,to){let{index,offset}=content.findIndex(from),child=content.maybeChild(index),{index:indexTo,offset:offsetTo}=content.findIndex(to);if(offset==from||child.isText){if(offsetTo!=to&&!content.child(indexTo).isText)throw new RangeError("Removing non-flat range");return content.cut(0,from).append(content.cut(to))}if(index!=indexTo)throw new RangeError("Removing non-flat range");return content.replaceChild(index,child.copy(removeRange(child.content,from-offset-1,to-offset-1)))}function insertInto(content,dist,insert,parent){let{index,offset}=content.findIndex(dist),child=content.maybeChild(index);if(offset==dist||child.isText)return parent&&!parent.canReplace(index,index,insert)?null:content.cut(0,dist).append(insert).append(content.cut(dist));let inner=insertInto(child.content,dist-offset-1,insert);return inner&&content.replaceChild(index,child.copy(inner))}function replace($from,$to,slice){if(slice.openStart>$from.depth)throw new ReplaceError("Inserted content deeper than insertion position");if($from.depth-slice.openStart!=$to.depth-slice.openEnd)throw new ReplaceError("Inconsistent open depths");return replaceOuter($from,$to,slice,0)}function replaceOuter($from,$to,slice,depth){let index=$from.index(depth),node=$from.node(depth);if(index==$to.index(depth)&&depth<$from.depth-slice.openStart){let inner=replaceOuter($from,$to,slice,depth+1);return node.copy(node.content.replaceChild(index,inner))}if(slice.content.size){if(slice.openStart||slice.openEnd||$from.depth!=depth||$to.depth!=depth){let{start,end}=function prepareSliceForReplace(slice,$along){let extra=$along.depth-slice.openStart,node=$along.node(extra).copy(slice.content);for(let i=extra-1;i>=0;i--)node=$along.node(i).copy(Fragment.from(node));return{start:node.resolveNoCache(slice.openStart+extra),end:node.resolveNoCache(node.content.size-slice.openEnd-extra)}}(slice,$from);return dist_close(node,replaceThreeWay($from,start,end,$to,depth))}{let parent=$from.parent,content=parent.content;return dist_close(parent,content.cut(0,$from.parentOffset).append(slice.content).append(content.cut($to.parentOffset)))}}return dist_close(node,replaceTwoWay($from,$to,depth))}function checkJoin(main,sub){if(!sub.type.compatibleContent(main.type))throw new ReplaceError("Cannot join "+sub.type.name+" onto "+main.type.name)}function joinable($before,$after,depth){let node=$before.node(depth);return checkJoin(node,$after.node(depth)),node}function addNode(child,target){let last=target.length-1;last>=0&&child.isText&&child.sameMarkup(target[last])?target[last]=child.withText(target[last].text+child.text):target.push(child)}function addRange($start,$end,depth,target){let node=($end||$start).node(depth),startIndex=0,endIndex=$end?$end.index(depth):node.childCount;$start&&(startIndex=$start.index(depth),$start.depth>depth?startIndex++:$start.textOffset&&(addNode($start.nodeAfter,target),startIndex++));for(let i=startIndex;i<endIndex;i++)addNode(node.child(i),target);$end&&$end.depth==depth&&$end.textOffset&&addNode($end.nodeBefore,target)}function dist_close(node,content){return node.type.checkContent(content),node.copy(content)}function replaceThreeWay($from,$start,$end,$to,depth){let openStart=$from.depth>depth&&joinable($from,$start,depth+1),openEnd=$to.depth>depth&&joinable($end,$to,depth+1),content=[];return addRange(null,$from,depth,content),openStart&&openEnd&&$start.index(depth)==$end.index(depth)?(checkJoin(openStart,openEnd),addNode(dist_close(openStart,replaceThreeWay($from,$start,$end,$to,depth+1)),content)):(openStart&&addNode(dist_close(openStart,replaceTwoWay($from,$start,depth+1)),content),addRange($start,$end,depth,content),openEnd&&addNode(dist_close(openEnd,replaceTwoWay($end,$to,depth+1)),content)),addRange($to,null,depth,content),new Fragment(content)}function replaceTwoWay($from,$to,depth){let content=[];if(addRange(null,$from,depth,content),$from.depth>depth){addNode(dist_close(joinable($from,$to,depth+1),replaceTwoWay($from,$to,depth+1)),content)}return addRange($to,null,depth,content),new Fragment(content)}Slice.empty=new Slice(Fragment.empty,0,0);class ResolvedPos{constructor(pos,path,parentOffset){this.pos=pos,this.path=path,this.parentOffset=parentOffset,this.depth=path.length/3-1}resolveDepth(val){return null==val?this.depth:val<0?this.depth+val:val}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(depth){return this.path[3*this.resolveDepth(depth)]}index(depth){return this.path[3*this.resolveDepth(depth)+1]}indexAfter(depth){return depth=this.resolveDepth(depth),this.index(depth)+(depth!=this.depth||this.textOffset?1:0)}start(depth){return 0==(depth=this.resolveDepth(depth))?0:this.path[3*depth-1]+1}end(depth){return depth=this.resolveDepth(depth),this.start(depth)+this.node(depth).content.size}before(depth){if(!(depth=this.resolveDepth(depth)))throw new RangeError("There is no position before the top-level node");return depth==this.depth+1?this.pos:this.path[3*depth-1]}after(depth){if(!(depth=this.resolveDepth(depth)))throw new RangeError("There is no position after the top-level node");return depth==this.depth+1?this.pos:this.path[3*depth-1]+this.path[3*depth].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let parent=this.parent,index=this.index(this.depth);if(index==parent.childCount)return null;let dOff=this.pos-this.path[this.path.length-1],child=parent.child(index);return dOff?parent.child(index).cut(dOff):child}get nodeBefore(){let index=this.index(this.depth),dOff=this.pos-this.path[this.path.length-1];return dOff?this.parent.child(index).cut(0,dOff):0==index?null:this.parent.child(index-1)}posAtIndex(index,depth){depth=this.resolveDepth(depth);let node=this.path[3*depth],pos=0==depth?0:this.path[3*depth-1]+1;for(let i=0;i<index;i++)pos+=node.child(i).nodeSize;return pos}marks(){let parent=this.parent,index=this.index();if(0==parent.content.size)return Mark.none;if(this.textOffset)return parent.child(index).marks;let main=parent.maybeChild(index-1),other=parent.maybeChild(index);if(!main){let tmp=main;main=other,other=tmp}let marks=main.marks;for(var i=0;i<marks.length;i++)!1!==marks[i].type.spec.inclusive||other&&marks[i].isInSet(other.marks)||(marks=marks[i--].removeFromSet(marks));return marks}marksAcross($end){let after=this.parent.maybeChild(this.index());if(!after||!after.isInline)return null;let marks=after.marks,next=$end.parent.maybeChild($end.index());for(var i=0;i<marks.length;i++)!1!==marks[i].type.spec.inclusive||next&&marks[i].isInSet(next.marks)||(marks=marks[i--].removeFromSet(marks));return marks}sharedDepth(pos){for(let depth=this.depth;depth>0;depth--)if(this.start(depth)<=pos&&this.end(depth)>=pos)return depth;return 0}blockRange(other=this,pred){if(other.pos<this.pos)return other.blockRange(this);for(let d=this.depth-(this.parent.inlineContent||this.pos==other.pos?1:0);d>=0;d--)if(other.pos<=this.end(d)&&(!pred||pred(this.node(d))))return new NodeRange(this,other,d);return null}sameParent(other){return this.pos-this.parentOffset==other.pos-other.parentOffset}max(other){return other.pos>this.pos?other:this}min(other){return other.pos<this.pos?other:this}toString(){let str="";for(let i=1;i<=this.depth;i++)str+=(str?"/":"")+this.node(i).type.name+"_"+this.index(i-1);return str+":"+this.parentOffset}static resolve(doc,pos){if(!(pos>=0&&pos<=doc.content.size))throw new RangeError("Position "+pos+" out of range");let path=[],start=0,parentOffset=pos;for(let node=doc;;){let{index,offset}=node.content.findIndex(parentOffset),rem=parentOffset-offset;if(path.push(node,index,start+offset),!rem)break;if(node=node.child(index),node.isText)break;parentOffset=rem-1,start+=offset+1}return new ResolvedPos(pos,path,parentOffset)}static resolveCached(doc,pos){let cache=resolveCache.get(doc);if(cache)for(let i=0;i<cache.elts.length;i++){let elt=cache.elts[i];if(elt.pos==pos)return elt}else resolveCache.set(doc,cache=new ResolveCache);let result=cache.elts[cache.i]=ResolvedPos.resolve(doc,pos);return cache.i=(cache.i+1)%resolveCacheSize,result}}class ResolveCache{constructor(){this.elts=[],this.i=0}}const resolveCacheSize=12,resolveCache=new WeakMap;class NodeRange{constructor($from,$to,depth){this.$from=$from,this.$to=$to,this.depth=depth}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const emptyAttrs=Object.create(null);class Node{constructor(type,attrs,content,marks=Mark.none){this.type=type,this.attrs=attrs,this.marks=marks,this.content=content||Fragment.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(index){return this.content.child(index)}maybeChild(index){return this.content.maybeChild(index)}forEach(f){this.content.forEach(f)}nodesBetween(from,to,f,startPos=0){this.content.nodesBetween(from,to,f,startPos,this)}descendants(f){this.nodesBetween(0,this.content.size,f)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(from,to,blockSeparator,leafText){return this.content.textBetween(from,to,blockSeparator,leafText)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(other){return this==other||this.sameMarkup(other)&&this.content.eq(other.content)}sameMarkup(other){return this.hasMarkup(other.type,other.attrs,other.marks)}hasMarkup(type,attrs,marks){return this.type==type&&compareDeep(this.attrs,attrs||type.defaultAttrs||emptyAttrs)&&Mark.sameSet(this.marks,marks||Mark.none)}copy(content=null){return content==this.content?this:new Node(this.type,this.attrs,content,this.marks)}mark(marks){return marks==this.marks?this:new Node(this.type,this.attrs,this.content,marks)}cut(from,to=this.content.size){return 0==from&&to==this.content.size?this:this.copy(this.content.cut(from,to))}slice(from,to=this.content.size,includeParents=!1){if(from==to)return Slice.empty;let $from=this.resolve(from),$to=this.resolve(to),depth=includeParents?0:$from.sharedDepth(to),start=$from.start(depth),content=$from.node(depth).content.cut($from.pos-start,$to.pos-start);return new Slice(content,$from.depth-depth,$to.depth-depth)}replace(from,to,slice){return replace(this.resolve(from),this.resolve(to),slice)}nodeAt(pos){for(let node=this;;){let{index,offset}=node.content.findIndex(pos);if(node=node.maybeChild(index),!node)return null;if(offset==pos||node.isText)return node;pos-=offset+1}}childAfter(pos){let{index,offset}=this.content.findIndex(pos);return{node:this.content.maybeChild(index),index,offset}}childBefore(pos){if(0==pos)return{node:null,index:0,offset:0};let{index,offset}=this.content.findIndex(pos);if(offset<pos)return{node:this.content.child(index),index,offset};let node=this.content.child(index-1);return{node,index:index-1,offset:offset-node.nodeSize}}resolve(pos){return ResolvedPos.resolveCached(this,pos)}resolveNoCache(pos){return ResolvedPos.resolve(this,pos)}rangeHasMark(from,to,type){let found=!1;return to>from&&this.nodesBetween(from,to,(node=>(type.isInSet(node.marks)&&(found=!0),!found))),found}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let name=this.type.name;return this.content.size&&(name+="("+this.content.toStringInner()+")"),wrapMarks(this.marks,name)}contentMatchAt(index){let match=this.type.contentMatch.matchFragment(this.content,0,index);if(!match)throw new Error("Called contentMatchAt on a node with invalid content");return match}canReplace(from,to,replacement=Fragment.empty,start=0,end=replacement.childCount){let one=this.contentMatchAt(from).matchFragment(replacement,start,end),two=one&&one.matchFragment(this.content,to);if(!two||!two.validEnd)return!1;for(let i=start;i<end;i++)if(!this.type.allowsMarks(replacement.child(i).marks))return!1;return!0}canReplaceWith(from,to,type,marks){if(marks&&!this.type.allowsMarks(marks))return!1;let start=this.contentMatchAt(from).matchType(type),end=start&&start.matchFragment(this.content,to);return!!end&&end.validEnd}canAppend(other){return other.content.size?this.canReplace(this.childCount,this.childCount,other.content):this.type.compatibleContent(other.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let copy=Mark.none;for(let i=0;i<this.marks.length;i++){let mark=this.marks[i];mark.type.checkAttrs(mark.attrs),copy=mark.addToSet(copy)}if(!Mark.sameSet(copy,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map((m=>m.type.name))}`);this.content.forEach((node=>node.check()))}toJSON(){let obj={type:this.type.name};for(let _ in this.attrs){obj.attrs=this.attrs;break}return this.content.size&&(obj.content=this.content.toJSON()),this.marks.length&&(obj.marks=this.marks.map((n=>n.toJSON()))),obj}static fromJSON(schema,json){if(!json)throw new RangeError("Invalid input for Node.fromJSON");let marks;if(json.marks){if(!Array.isArray(json.marks))throw new RangeError("Invalid mark data for Node.fromJSON");marks=json.marks.map(schema.markFromJSON)}if("text"==json.type){if("string"!=typeof json.text)throw new RangeError("Invalid text node in JSON");return schema.text(json.text,marks)}let content=Fragment.fromJSON(schema,json.content),node=schema.nodeType(json.type).create(json.attrs,content,marks);return node.type.checkAttrs(node.attrs),node}}Node.prototype.text=void 0;class TextNode extends Node{constructor(type,attrs,content,marks){if(super(type,attrs,null,marks),!content)throw new RangeError("Empty text nodes are not allowed");this.text=content}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):wrapMarks(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(from,to){return this.text.slice(from,to)}get nodeSize(){return this.text.length}mark(marks){return marks==this.marks?this:new TextNode(this.type,this.attrs,this.text,marks)}withText(text){return text==this.text?this:new TextNode(this.type,this.attrs,text,this.marks)}cut(from=0,to=this.text.length){return 0==from&&to==this.text.length?this:this.withText(this.text.slice(from,to))}eq(other){return this.sameMarkup(other)&&this.text==other.text}toJSON(){let base=super.toJSON();return base.text=this.text,base}}function wrapMarks(marks,str){for(let i=marks.length-1;i>=0;i--)str=marks[i].type.name+"("+str+")";return str}class ContentMatch{constructor(validEnd){this.validEnd=validEnd,this.next=[],this.wrapCache=[]}static parse(string,nodeTypes){let stream=new TokenStream(string,nodeTypes);if(null==stream.next)return ContentMatch.empty;let expr=parseExpr(stream);stream.next&&stream.err("Unexpected trailing text");let match=function dfa(nfa){let labeled=Object.create(null);return explore(nullFrom(nfa,0));function explore(states){let out=[];states.forEach((node=>{nfa[node].forEach((({term,to})=>{if(!term)return;let set;for(let i=0;i<out.length;i++)out[i][0]==term&&(set=out[i][1]);nullFrom(nfa,to).forEach((node=>{set||out.push([term,set=[]]),-1==set.indexOf(node)&&set.push(node)}))}))}));let state=labeled[states.join(",")]=new ContentMatch(states.indexOf(nfa.length-1)>-1);for(let i=0;i<out.length;i++){let states=out[i][1].sort(cmp);state.next.push({type:out[i][0],next:labeled[states.join(",")]||explore(states)})}return state}}(function nfa(expr){let nfa=[[]];return connect(compile(expr,0),node()),nfa;function node(){return nfa.push([])-1}function edge(from,to,term){let edge={term,to};return nfa[from].push(edge),edge}function connect(edges,to){edges.forEach((edge=>edge.to=to))}function compile(expr,from){if("choice"==expr.type)return expr.exprs.reduce(((out,expr)=>out.concat(compile(expr,from))),[]);if("seq"!=expr.type){if("star"==expr.type){let loop=node();return edge(from,loop),connect(compile(expr.expr,loop),loop),[edge(loop)]}if("plus"==expr.type){let loop=node();return connect(compile(expr.expr,from),loop),connect(compile(expr.expr,loop),loop),[edge(loop)]}if("opt"==expr.type)return[edge(from)].concat(compile(expr.expr,from));if("range"==expr.type){let cur=from;for(let i=0;i<expr.min;i++){let next=node();connect(compile(expr.expr,cur),next),cur=next}if(-1==expr.max)connect(compile(expr.expr,cur),cur);else for(let i=expr.min;i<expr.max;i++){let next=node();edge(cur,next),connect(compile(expr.expr,cur),next),cur=next}return[edge(cur)]}if("name"==expr.type)return[edge(from,void 0,expr.value)];throw new Error("Unknown expr type")}for(let i=0;;i++){let next=compile(expr.exprs[i],from);if(i==expr.exprs.length-1)return next;connect(next,from=node())}}}(expr));return function checkForDeadEnds(match,stream){for(let i=0,work=[match];i<work.length;i++){let state=work[i],dead=!state.validEnd,nodes=[];for(let j=0;j<state.next.length;j++){let{type,next}=state.next[j];nodes.push(type.name),!dead||type.isText||type.hasRequiredAttrs()||(dead=!1),-1==work.indexOf(next)&&work.push(next)}dead&&stream.err("Only non-generatable nodes ("+nodes.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(match,stream),match}matchType(type){for(let i=0;i<this.next.length;i++)if(this.next[i].type==type)return this.next[i].next;return null}matchFragment(frag,start=0,end=frag.childCount){let cur=this;for(let i=start;cur&&i<end;i++)cur=cur.matchType(frag.child(i).type);return cur}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let i=0;i<this.next.length;i++){let{type}=this.next[i];if(!type.isText&&!type.hasRequiredAttrs())return type}return null}compatible(other){for(let i=0;i<this.next.length;i++)for(let j=0;j<other.next.length;j++)if(this.next[i].type==other.next[j].type)return!0;return!1}fillBefore(after,toEnd=!1,startIndex=0){let seen=[this];return function search(match,types){let finished=match.matchFragment(after,startIndex);if(finished&&(!toEnd||finished.validEnd))return Fragment.from(types.map((tp=>tp.createAndFill())));for(let i=0;i<match.next.length;i++){let{type,next}=match.next[i];if(!type.isText&&!type.hasRequiredAttrs()&&-1==seen.indexOf(next)){seen.push(next);let found=search(next,types.concat(type));if(found)return found}}return null}(this,[])}findWrapping(target){for(let i=0;i<this.wrapCache.length;i+=2)if(this.wrapCache[i]==target)return this.wrapCache[i+1];let computed=this.computeWrapping(target);return this.wrapCache.push(target,computed),computed}computeWrapping(target){let seen=Object.create(null),active=[{match:this,type:null,via:null}];for(;active.length;){let current=active.shift(),match=current.match;if(match.matchType(target)){let result=[];for(let obj=current;obj.type;obj=obj.via)result.push(obj.type);return result.reverse()}for(let i=0;i<match.next.length;i++){let{type,next}=match.next[i];type.isLeaf||type.hasRequiredAttrs()||type.name in seen||current.type&&!next.validEnd||(active.push({match:type.contentMatch,type,via:current}),seen[type.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(n){if(n>=this.next.length)throw new RangeError(`There's no ${n}th edge in this content match`);return this.next[n]}toString(){let seen=[];return function scan(m){seen.push(m);for(let i=0;i<m.next.length;i++)-1==seen.indexOf(m.next[i].next)&&scan(m.next[i].next)}(this),seen.map(((m,i)=>{let out=i+(m.validEnd?"*":" ")+" ";for(let i=0;i<m.next.length;i++)out+=(i?", ":"")+m.next[i].type.name+"->"+seen.indexOf(m.next[i].next);return out})).join("\n")}}ContentMatch.empty=new ContentMatch(!0);class TokenStream{constructor(string,nodeTypes){this.string=string,this.nodeTypes=nodeTypes,this.inline=null,this.pos=0,this.tokens=string.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(tok){return this.next==tok&&(this.pos++||!0)}err(str){throw new SyntaxError(str+" (in content expression '"+this.string+"')")}}function parseExpr(stream){let exprs=[];do{exprs.push(parseExprSeq(stream))}while(stream.eat("|"));return 1==exprs.length?exprs[0]:{type:"choice",exprs}}function parseExprSeq(stream){let exprs=[];do{exprs.push(parseExprSubscript(stream))}while(stream.next&&")"!=stream.next&&"|"!=stream.next);return 1==exprs.length?exprs[0]:{type:"seq",exprs}}function parseExprSubscript(stream){let expr=function parseExprAtom(stream){if(stream.eat("(")){let expr=parseExpr(stream);return stream.eat(")")||stream.err("Missing closing paren"),expr}if(!/\W/.test(stream.next)){let exprs=function resolveName(stream,name){let types=stream.nodeTypes,type=types[name];if(type)return[type];let result=[];for(let typeName in types){let type=types[typeName];type.isInGroup(name)&&result.push(type)}0==result.length&&stream.err("No node type or group '"+name+"' found");return result}(stream,stream.next).map((type=>(null==stream.inline?stream.inline=type.isInline:stream.inline!=type.isInline&&stream.err("Mixing inline and block content"),{type:"name",value:type})));return stream.pos++,1==exprs.length?exprs[0]:{type:"choice",exprs}}stream.err("Unexpected token '"+stream.next+"'")}(stream);for(;;)if(stream.eat("+"))expr={type:"plus",expr};else if(stream.eat("*"))expr={type:"star",expr};else if(stream.eat("?"))expr={type:"opt",expr};else{if(!stream.eat("{"))break;expr=parseExprRange(stream,expr)}return expr}function parseNum(stream){/\D/.test(stream.next)&&stream.err("Expected number, got '"+stream.next+"'");let result=Number(stream.next);return stream.pos++,result}function parseExprRange(stream,expr){let min=parseNum(stream),max=min;return stream.eat(",")&&(max="}"!=stream.next?parseNum(stream):-1),stream.eat("}")||stream.err("Unclosed braced range"),{type:"range",min,max,expr}}function cmp(a,b){return b-a}function nullFrom(nfa,node){let result=[];return function scan(node){let edges=nfa[node];if(1==edges.length&&!edges[0].term)return scan(edges[0].to);result.push(node);for(let i=0;i<edges.length;i++){let{term,to}=edges[i];term||-1!=result.indexOf(to)||scan(to)}}(node),result.sort(cmp)}function defaultAttrs(attrs){let defaults=Object.create(null);for(let attrName in attrs){let attr=attrs[attrName];if(!attr.hasDefault)return null;defaults[attrName]=attr.default}return defaults}function computeAttrs(attrs,value){let built=Object.create(null);for(let name in attrs){let given=value&&value[name];if(void 0===given){let attr=attrs[name];if(!attr.hasDefault)throw new RangeError("No value supplied for attribute "+name);given=attr.default}built[name]=given}return built}function checkAttrs(attrs,values,type,name){for(let name in values)if(!(name in attrs))throw new RangeError(`Unsupported attribute ${name} for ${type} of type ${name}`);for(let name in attrs){let attr=attrs[name];attr.validate&&attr.validate(values[name])}}function initAttrs(typeName,attrs){let result=Object.create(null);if(attrs)for(let name in attrs)result[name]=new Attribute(typeName,name,attrs[name]);return result}class NodeType{constructor(name,schema,spec){this.name=name,this.schema=schema,this.spec=spec,this.markSet=null,this.groups=spec.group?spec.group.split(" "):[],this.attrs=initAttrs(name,spec.attrs),this.defaultAttrs=defaultAttrs(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(spec.inline||"text"==name),this.isText="text"==name}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ContentMatch.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(group){return this.groups.indexOf(group)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let n in this.attrs)if(this.attrs[n].isRequired)return!0;return!1}compatibleContent(other){return this==other||this.contentMatch.compatible(other.contentMatch)}computeAttrs(attrs){return!attrs&&this.defaultAttrs?this.defaultAttrs:computeAttrs(this.attrs,attrs)}create(attrs=null,content,marks){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Node(this,this.computeAttrs(attrs),Fragment.from(content),Mark.setFrom(marks))}createChecked(attrs=null,content,marks){return content=Fragment.from(content),this.checkContent(content),new Node(this,this.computeAttrs(attrs),content,Mark.setFrom(marks))}createAndFill(attrs=null,content,marks){if(attrs=this.computeAttrs(attrs),(content=Fragment.from(content)).size){let before=this.contentMatch.fillBefore(content);if(!before)return null;content=before.append(content)}let matched=this.contentMatch.matchFragment(content),after=matched&&matched.fillBefore(Fragment.empty,!0);return after?new Node(this,attrs,content.append(after),Mark.setFrom(marks)):null}validContent(content){let result=this.contentMatch.matchFragment(content);if(!result||!result.validEnd)return!1;for(let i=0;i<content.childCount;i++)if(!this.allowsMarks(content.child(i).marks))return!1;return!0}checkContent(content){if(!this.validContent(content))throw new RangeError(`Invalid content for node ${this.name}: ${content.toString().slice(0,50)}`)}checkAttrs(attrs){checkAttrs(this.attrs,attrs,"node",this.name)}allowsMarkType(markType){return null==this.markSet||this.markSet.indexOf(markType)>-1}allowsMarks(marks){if(null==this.markSet)return!0;for(let i=0;i<marks.length;i++)if(!this.allowsMarkType(marks[i].type))return!1;return!0}allowedMarks(marks){if(null==this.markSet)return marks;let copy;for(let i=0;i<marks.length;i++)this.allowsMarkType(marks[i].type)?copy&&copy.push(marks[i]):copy||(copy=marks.slice(0,i));return copy?copy.length?copy:Mark.none:marks}static compile(nodes,schema){let result=Object.create(null);nodes.forEach(((name,spec)=>result[name]=new NodeType(name,schema,spec)));let topType=schema.spec.topNode||"doc";if(!result[topType])throw new RangeError("Schema is missing its top node type ('"+topType+"')");if(!result.text)throw new RangeError("Every schema needs a 'text' type");for(let _ in result.text.attrs)throw new RangeError("The text node type should not have attributes");return result}}class Attribute{constructor(typeName,attrName,options){this.hasDefault=Object.prototype.hasOwnProperty.call(options,"default"),this.default=options.default,this.validate="string"==typeof options.validate?function validateType(typeName,attrName,type){let types=type.split("|");return value=>{let name=null===value?"null":typeof value;if(types.indexOf(name)<0)throw new RangeError(`Expected value of type ${types} for attribute ${attrName} on type ${typeName}, got ${name}`)}}(typeName,attrName,options.validate):options.validate}get isRequired(){return!this.hasDefault}}class MarkType{constructor(name,rank,schema,spec){this.name=name,this.rank=rank,this.schema=schema,this.spec=spec,this.attrs=initAttrs(name,spec.attrs),this.excluded=null;let defaults=defaultAttrs(this.attrs);this.instance=defaults?new Mark(this,defaults):null}create(attrs=null){return!attrs&&this.instance?this.instance:new Mark(this,computeAttrs(this.attrs,attrs))}static compile(marks,schema){let result=Object.create(null),rank=0;return marks.forEach(((name,spec)=>result[name]=new MarkType(name,rank++,schema,spec))),result}removeFromSet(set){for(var i=0;i<set.length;i++)set[i].type==this&&(set=set.slice(0,i).concat(set.slice(i+1)),i--);return set}isInSet(set){for(let i=0;i<set.length;i++)if(set[i].type==this)return set[i]}checkAttrs(attrs){checkAttrs(this.attrs,attrs,"mark",this.name)}excludes(other){return this.excluded.indexOf(other)>-1}}class Schema{constructor(spec){this.linebreakReplacement=null,this.cached=Object.create(null);let instanceSpec=this.spec={};for(let prop in spec)instanceSpec[prop]=spec[prop];instanceSpec.nodes=dist.from(spec.nodes),instanceSpec.marks=dist.from(spec.marks||{}),this.nodes=NodeType.compile(this.spec.nodes,this),this.marks=MarkType.compile(this.spec.marks,this);let contentExprCache=Object.create(null);for(let prop in this.nodes){if(prop in this.marks)throw new RangeError(prop+" can not be both a node and a mark");let type=this.nodes[prop],contentExpr=type.spec.content||"",markExpr=type.spec.marks;if(type.contentMatch=contentExprCache[contentExpr]||(contentExprCache[contentExpr]=ContentMatch.parse(contentExpr,this.nodes)),type.inlineContent=type.contentMatch.inlineContent,type.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!type.isInline||!type.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=type}type.markSet="_"==markExpr?null:markExpr?gatherMarks(this,markExpr.split(" ")):""!=markExpr&&type.inlineContent?null:[]}for(let prop in this.marks){let type=this.marks[prop],excl=type.spec.excludes;type.excluded=null==excl?[type]:""==excl?[]:gatherMarks(this,excl.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(type,attrs=null,content,marks){if("string"==typeof type)type=this.nodeType(type);else{if(!(type instanceof NodeType))throw new RangeError("Invalid node type: "+type);if(type.schema!=this)throw new RangeError("Node type from different schema used ("+type.name+")")}return type.createChecked(attrs,content,marks)}text(text,marks){let type=this.nodes.text;return new TextNode(type,type.defaultAttrs,text,Mark.setFrom(marks))}mark(type,attrs){return"string"==typeof type&&(type=this.marks[type]),type.create(attrs)}nodeFromJSON(json){return Node.fromJSON(this,json)}markFromJSON(json){return Mark.fromJSON(this,json)}nodeType(name){let found=this.nodes[name];if(!found)throw new RangeError("Unknown node type: "+name);return found}}function gatherMarks(schema,marks){let found=[];for(let i=0;i<marks.length;i++){let name=marks[i],mark=schema.marks[name],ok=mark;if(mark)found.push(mark);else for(let prop in schema.marks){let mark=schema.marks[prop];("_"==name||mark.spec.group&&mark.spec.group.split(" ").indexOf(name)>-1)&&found.push(ok=mark)}if(!ok)throw new SyntaxError("Unknown mark type: '"+marks[i]+"'")}return found}class DOMParser{constructor(schema,rules){this.schema=schema,this.rules=rules,this.tags=[],this.styles=[];let matchedStyles=this.matchedStyles=[];rules.forEach((rule=>{if(function isTagRule(rule){return null!=rule.tag}(rule))this.tags.push(rule);else if(function isStyleRule(rule){return null!=rule.style}(rule)){let prop=/[^=]*/.exec(rule.style)[0];matchedStyles.indexOf(prop)<0&&matchedStyles.push(prop),this.styles.push(rule)}})),this.normalizeLists=!this.tags.some((r=>{if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;let node=schema.nodes[r.node];return node.contentMatch.matchType(node)}))}parse(dom,options={}){let context=new ParseContext(this,options,!1);return context.addAll(dom,Mark.none,options.from,options.to),context.finish()}parseSlice(dom,options={}){let context=new ParseContext(this,options,!0);return context.addAll(dom,Mark.none,options.from,options.to),Slice.maxOpen(context.finish())}matchTag(dom,context,after){for(let i=after?this.tags.indexOf(after)+1:0;i<this.tags.length;i++){let rule=this.tags[i];if(matches(dom,rule.tag)&&(void 0===rule.namespace||dom.namespaceURI==rule.namespace)&&(!rule.context||context.matchesContext(rule.context))){if(rule.getAttrs){let result=rule.getAttrs(dom);if(!1===result)continue;rule.attrs=result||void 0}return rule}}}matchStyle(prop,value,context,after){for(let i=after?this.styles.indexOf(after)+1:0;i<this.styles.length;i++){let rule=this.styles[i],style=rule.style;if(!(0!=style.indexOf(prop)||rule.context&&!context.matchesContext(rule.context)||style.length>prop.length&&(61!=style.charCodeAt(prop.length)||style.slice(prop.length+1)!=value))){if(rule.getAttrs){let result=rule.getAttrs(value);if(!1===result)continue;rule.attrs=result||void 0}return rule}}}static schemaRules(schema){let result=[];function insert(rule){let priority=null==rule.priority?50:rule.priority,i=0;for(;i<result.length;i++){let next=result[i];if((null==next.priority?50:next.priority)<priority)break}result.splice(i,0,rule)}for(let name in schema.marks){let rules=schema.marks[name].spec.parseDOM;rules&&rules.forEach((rule=>{insert(rule=copy(rule)),rule.mark||rule.ignore||rule.clearMark||(rule.mark=name)}))}for(let name in schema.nodes){let rules=schema.nodes[name].spec.parseDOM;rules&&rules.forEach((rule=>{insert(rule=copy(rule)),rule.node||rule.ignore||rule.mark||(rule.node=name)}))}return result}static fromSchema(schema){return schema.cached.domParser||(schema.cached.domParser=new DOMParser(schema,DOMParser.schemaRules(schema)))}}const blockTags={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},ignoreTags={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},listTags={ol:!0,ul:!0};function wsOptionsFor(type,preserveWhitespace,base){return null!=preserveWhitespace?(preserveWhitespace?1:0)|("full"===preserveWhitespace?2:0):type&&"pre"==type.whitespace?3:-5&base}class NodeContext{constructor(type,attrs,marks,solid,match,options){this.type=type,this.attrs=attrs,this.marks=marks,this.solid=solid,this.options=options,this.content=[],this.activeMarks=Mark.none,this.match=match||(4&options?null:type.contentMatch)}findWrapping(node){if(!this.match){if(!this.type)return[];let fill=this.type.contentMatch.fillBefore(Fragment.from(node));if(!fill){let wrap,start=this.type.contentMatch;return(wrap=start.findWrapping(node.type))?(this.match=start,wrap):null}this.match=this.type.contentMatch.matchFragment(fill)}return this.match.findWrapping(node.type)}finish(openEnd){if(!(1&this.options)){let m,last=this.content[this.content.length-1];if(last&&last.isText&&(m=/[ \t\r\n\u000c]+$/.exec(last.text))){let text=last;last.text.length==m[0].length?this.content.pop():this.content[this.content.length-1]=text.withText(text.text.slice(0,text.text.length-m[0].length))}}let content=Fragment.from(this.content);return!openEnd&&this.match&&(content=content.append(this.match.fillBefore(Fragment.empty,!0))),this.type?this.type.create(this.attrs,content,this.marks):content}inlineContext(node){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:node.parentNode&&!blockTags.hasOwnProperty(node.parentNode.nodeName.toLowerCase())}}class ParseContext{constructor(parser,options,isOpen){this.parser=parser,this.options=options,this.isOpen=isOpen,this.open=0,this.localPreserveWS=!1;let topContext,topNode=options.topNode,topOptions=wsOptionsFor(null,options.preserveWhitespace,0)|(isOpen?4:0);topContext=topNode?new NodeContext(topNode.type,topNode.attrs,Mark.none,!0,options.topMatch||topNode.type.contentMatch,topOptions):new NodeContext(isOpen?null:parser.schema.topNodeType,null,Mark.none,!0,null,topOptions),this.nodes=[topContext],this.find=options.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(dom,marks){3==dom.nodeType?this.addTextNode(dom,marks):1==dom.nodeType&&this.addElement(dom,marks)}addTextNode(dom,marks){let value=dom.nodeValue,top=this.top,preserveWS=2&top.options?"full":this.localPreserveWS||(1&top.options)>0;if("full"===preserveWS||top.inlineContext(dom)||/[^ \t\r\n\u000c]/.test(value)){if(preserveWS)value="full"!==preserveWS?value.replace(/\r?\n|\r/g," "):value.replace(/\r\n?/g,"\n");else if(value=value.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(value)&&this.open==this.nodes.length-1){let nodeBefore=top.content[top.content.length-1],domNodeBefore=dom.previousSibling;(!nodeBefore||domNodeBefore&&"BR"==domNodeBefore.nodeName||nodeBefore.isText&&/[ \t\r\n\u000c]$/.test(nodeBefore.text))&&(value=value.slice(1))}value&&this.insertNode(this.parser.schema.text(value),marks,!/\S/.test(value)),this.findInText(dom)}else this.findInside(dom)}addElement(dom,marks,matchAfter){let outerWS=this.localPreserveWS,top=this.top;("PRE"==dom.tagName||/pre/.test(dom.style&&dom.style.whiteSpace))&&(this.localPreserveWS=!0);let ruleID,name=dom.nodeName.toLowerCase();listTags.hasOwnProperty(name)&&this.parser.normalizeLists&&function normalizeList(dom){for(let child=dom.firstChild,prevItem=null;child;child=child.nextSibling){let name=1==child.nodeType?child.nodeName.toLowerCase():null;name&&listTags.hasOwnProperty(name)&&prevItem?(prevItem.appendChild(child),child=prevItem):"li"==name?prevItem=child:name&&(prevItem=null)}}(dom);let rule=this.options.ruleFromNode&&this.options.ruleFromNode(dom)||(ruleID=this.parser.matchTag(dom,this,matchAfter));out:if(rule?rule.ignore:ignoreTags.hasOwnProperty(name))this.findInside(dom),this.ignoreFallback(dom,marks);else if(!rule||rule.skip||rule.closeParent){rule&&rule.closeParent?this.open=Math.max(0,this.open-1):rule&&rule.skip.nodeType&&(dom=rule.skip);let sync,oldNeedsBlock=this.needsBlock;if(blockTags.hasOwnProperty(name))top.content.length&&top.content[0].isInline&&this.open&&(this.open--,top=this.top),sync=!0,top.type||(this.needsBlock=!0);else if(!dom.firstChild){this.leafFallback(dom,marks);break out}let innerMarks=rule&&rule.skip?marks:this.readStyles(dom,marks);innerMarks&&this.addAll(dom,innerMarks),sync&&this.sync(top),this.needsBlock=oldNeedsBlock}else{let innerMarks=this.readStyles(dom,marks);innerMarks&&this.addElementByRule(dom,rule,innerMarks,!1===rule.consuming?ruleID:void 0)}this.localPreserveWS=outerWS}leafFallback(dom,marks){"BR"==dom.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(dom.ownerDocument.createTextNode("\n"),marks)}ignoreFallback(dom,marks){"BR"!=dom.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"),marks,!0)}readStyles(dom,marks){let styles=dom.style;if(styles&&styles.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let name=this.parser.matchedStyles[i],value=styles.getPropertyValue(name);if(value)for(let after;;){let rule=this.parser.matchStyle(name,value,this,after);if(!rule)break;if(rule.ignore)return null;if(marks=rule.clearMark?marks.filter((m=>!rule.clearMark(m))):marks.concat(this.parser.schema.marks[rule.mark].create(rule.attrs)),!1!==rule.consuming)break;after=rule}}return marks}addElementByRule(dom,rule,marks,continueAfter){let sync,nodeType;if(rule.node)if(nodeType=this.parser.schema.nodes[rule.node],nodeType.isLeaf)this.insertNode(nodeType.create(rule.attrs),marks,"BR"==dom.nodeName)||this.leafFallback(dom,marks);else{let inner=this.enter(nodeType,rule.attrs||null,marks,rule.preserveWhitespace);inner&&(sync=!0,marks=inner)}else{let markType=this.parser.schema.marks[rule.mark];marks=marks.concat(markType.create(rule.attrs))}let startIn=this.top;if(nodeType&&nodeType.isLeaf)this.findInside(dom);else if(continueAfter)this.addElement(dom,marks,continueAfter);else if(rule.getContent)this.findInside(dom),rule.getContent(dom,this.parser.schema).forEach((node=>this.insertNode(node,marks,!1)));else{let contentDOM=dom;"string"==typeof rule.contentElement?contentDOM=dom.querySelector(rule.contentElement):"function"==typeof rule.contentElement?contentDOM=rule.contentElement(dom):rule.contentElement&&(contentDOM=rule.contentElement),this.findAround(dom,contentDOM,!0),this.addAll(contentDOM,marks),this.findAround(dom,contentDOM,!1)}sync&&this.sync(startIn)&&this.open--}addAll(parent,marks,startIndex,endIndex){let index=startIndex||0;for(let dom=startIndex?parent.childNodes[startIndex]:parent.firstChild,end=null==endIndex?null:parent.childNodes[endIndex];dom!=end;dom=dom.nextSibling,++index)this.findAtPoint(parent,index),this.addDOM(dom,marks);this.findAtPoint(parent,index)}findPlace(node,marks,cautious){let route,sync;for(let depth=this.open,penalty=0;depth>=0;depth--){let cx=this.nodes[depth],found=cx.findWrapping(node);if(found&&(!route||route.length>found.length+penalty)&&(route=found,sync=cx,!found.length))break;if(cx.solid){if(cautious)break;penalty+=2}}if(!route)return null;this.sync(sync);for(let i=0;i<route.length;i++)marks=this.enterInner(route[i],null,marks,!1);return marks}insertNode(node,marks,cautious){if(node.isInline&&this.needsBlock&&!this.top.type){let block=this.textblockFromContext();block&&(marks=this.enterInner(block,null,marks))}let innerMarks=this.findPlace(node,marks,cautious);if(innerMarks){this.closeExtra();let top=this.top;top.match&&(top.match=top.match.matchType(node.type));let nodeMarks=Mark.none;for(let m of innerMarks.concat(node.marks))(top.type?top.type.allowsMarkType(m.type):markMayApply(m.type,node.type))&&(nodeMarks=m.addToSet(nodeMarks));return top.content.push(node.mark(nodeMarks)),!0}return!1}enter(type,attrs,marks,preserveWS){let innerMarks=this.findPlace(type.create(attrs),marks,!1);return innerMarks&&(innerMarks=this.enterInner(type,attrs,marks,!0,preserveWS)),innerMarks}enterInner(type,attrs,marks,solid=!1,preserveWS){this.closeExtra();let top=this.top;top.match=top.match&&top.match.matchType(type);let options=wsOptionsFor(type,preserveWS,top.options);4&top.options&&0==top.content.length&&(options|=4);let applyMarks=Mark.none;return marks=marks.filter((m=>!(top.type?top.type.allowsMarkType(m.type):markMayApply(m.type,type))||(applyMarks=m.addToSet(applyMarks),!1))),this.nodes.push(new NodeContext(type,attrs,applyMarks,solid,null,options)),this.open++,marks}closeExtra(openEnd=!1){let i=this.nodes.length-1;if(i>this.open){for(;i>this.open;i--)this.nodes[i-1].content.push(this.nodes[i].finish(openEnd));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!(!this.isOpen&&!this.options.topOpen))}sync(to){for(let i=this.open;i>=0;i--){if(this.nodes[i]==to)return this.open=i,!0;this.localPreserveWS&&(this.nodes[i].options|=1)}return!1}get currentPos(){this.closeExtra();let pos=0;for(let i=this.open;i>=0;i--){let content=this.nodes[i].content;for(let j=content.length-1;j>=0;j--)pos+=content[j].nodeSize;i&&pos++}return pos}findAtPoint(parent,offset){if(this.find)for(let i=0;i<this.find.length;i++)this.find[i].node==parent&&this.find[i].offset==offset&&(this.find[i].pos=this.currentPos)}findInside(parent){if(this.find)for(let i=0;i<this.find.length;i++)null==this.find[i].pos&&1==parent.nodeType&&parent.contains(this.find[i].node)&&(this.find[i].pos=this.currentPos)}findAround(parent,content,before){if(parent!=content&&this.find)for(let i=0;i<this.find.length;i++)if(null==this.find[i].pos&&1==parent.nodeType&&parent.contains(this.find[i].node)){content.compareDocumentPosition(this.find[i].node)&(before?2:4)&&(this.find[i].pos=this.currentPos)}}findInText(textNode){if(this.find)for(let i=0;i<this.find.length;i++)this.find[i].node==textNode&&(this.find[i].pos=this.currentPos-(textNode.nodeValue.length-this.find[i].offset))}matchesContext(context){if(context.indexOf("|")>-1)return context.split(/\s*\|\s*/).some(this.matchesContext,this);let parts=context.split("/"),option=this.options.context,useRoot=!(this.isOpen||option&&option.parent.type!=this.nodes[0].type),minDepth=-(option?option.depth+1:0)+(useRoot?0:1),match=(i,depth)=>{for(;i>=0;i--){let part=parts[i];if(""==part){if(i==parts.length-1||0==i)continue;for(;depth>=minDepth;depth--)if(match(i-1,depth))return!0;return!1}{let next=depth>0||0==depth&&useRoot?this.nodes[depth].type:option&&depth>=minDepth?option.node(depth-minDepth).type:null;if(!next||next.name!=part&&!next.isInGroup(part))return!1;depth--}}return!0};return match(parts.length-1,this.open)}textblockFromContext(){let $context=this.options.context;if($context)for(let d=$context.depth;d>=0;d--){let deflt=$context.node(d).contentMatchAt($context.indexAfter(d)).defaultType;if(deflt&&deflt.isTextblock&&deflt.defaultAttrs)return deflt}for(let name in this.parser.schema.nodes){let type=this.parser.schema.nodes[name];if(type.isTextblock&&type.defaultAttrs)return type}}}function matches(dom,selector){return(dom.matches||dom.msMatchesSelector||dom.webkitMatchesSelector||dom.mozMatchesSelector).call(dom,selector)}function copy(obj){let copy={};for(let prop in obj)copy[prop]=obj[prop];return copy}function markMayApply(markType,nodeType){let nodes=nodeType.schema.nodes;for(let name in nodes){let parent=nodes[name];if(!parent.allowsMarkType(markType))continue;let seen=[],scan=match=>{seen.push(match);for(let i=0;i<match.edgeCount;i++){let{type,next}=match.edge(i);if(type==nodeType)return!0;if(seen.indexOf(next)<0&&scan(next))return!0}};if(scan(parent.contentMatch))return!0}}class DOMSerializer{constructor(nodes,marks){this.nodes=nodes,this.marks=marks}serializeFragment(fragment,options={},target){target||(target=doc(options).createDocumentFragment());let top=target,active=[];return fragment.forEach((node=>{if(active.length||node.marks.length){let keep=0,rendered=0;for(;keep<active.length&&rendered<node.marks.length;){let next=node.marks[rendered];if(this.marks[next.type.name]){if(!next.eq(active[keep][0])||!1===next.type.spec.spanning)break;keep++,rendered++}else rendered++}for(;keep<active.length;)top=active.pop()[1];for(;rendered<node.marks.length;){let add=node.marks[rendered++],markDOM=this.serializeMark(add,node.isInline,options);markDOM&&(active.push([add,top]),top.appendChild(markDOM.dom),top=markDOM.contentDOM||markDOM.dom)}}top.appendChild(this.serializeNodeInner(node,options))})),target}serializeNodeInner(node,options){let{dom,contentDOM}=renderSpec(doc(options),this.nodes[node.type.name](node),null,node.attrs);if(contentDOM){if(node.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(node.content,options,contentDOM)}return dom}serializeNode(node,options={}){let dom=this.serializeNodeInner(node,options);for(let i=node.marks.length-1;i>=0;i--){let wrap=this.serializeMark(node.marks[i],node.isInline,options);wrap&&((wrap.contentDOM||wrap.dom).appendChild(dom),dom=wrap.dom)}return dom}serializeMark(mark,inline,options={}){let toDOM=this.marks[mark.type.name];return toDOM&&renderSpec(doc(options),toDOM(mark,inline),null,mark.attrs)}static renderSpec(doc,structure,xmlNS=null,blockArraysIn){return renderSpec(doc,structure,xmlNS,blockArraysIn)}static fromSchema(schema){return schema.cached.domSerializer||(schema.cached.domSerializer=new DOMSerializer(this.nodesFromSchema(schema),this.marksFromSchema(schema)))}static nodesFromSchema(schema){let result=gatherToDOM(schema.nodes);return result.text||(result.text=node=>node.text),result}static marksFromSchema(schema){return gatherToDOM(schema.marks)}}function gatherToDOM(obj){let result={};for(let name in obj){let toDOM=obj[name].spec.toDOM;toDOM&&(result[name]=toDOM)}return result}function doc(options){return options.document||window.document}const suspiciousAttributeCache=new WeakMap;function suspiciousAttributes(attrs){let value=suspiciousAttributeCache.get(attrs);return void 0===value&&suspiciousAttributeCache.set(attrs,value=function suspiciousAttributesInner(attrs){let result=null;function scan(value){if(value&&"object"==typeof value)if(Array.isArray(value))if("string"==typeof value[0])result||(result=[]),result.push(value);else for(let i=0;i<value.length;i++)scan(value[i]);else for(let prop in value)scan(value[prop])}return scan(attrs),result}(attrs)),value}function renderSpec(doc,structure,xmlNS,blockArraysIn){if("string"==typeof structure)return{dom:doc.createTextNode(structure)};if(null!=structure.nodeType)return{dom:structure};if(structure.dom&&null!=structure.dom.nodeType)return structure;let suspicious,tagName=structure[0];if("string"!=typeof tagName)throw new RangeError("Invalid array passed to renderSpec");if(blockArraysIn&&(suspicious=suspiciousAttributes(blockArraysIn))&&suspicious.indexOf(structure)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let contentDOM,space=tagName.indexOf(" ");space>0&&(xmlNS=tagName.slice(0,space),tagName=tagName.slice(space+1));let dom=xmlNS?doc.createElementNS(xmlNS,tagName):doc.createElement(tagName),attrs=structure[1],start=1;if(attrs&&"object"==typeof attrs&&null==attrs.nodeType&&!Array.isArray(attrs)){start=2;for(let name in attrs)if(null!=attrs[name]){let space=name.indexOf(" ");space>0?dom.setAttributeNS(name.slice(0,space),name.slice(space+1),attrs[name]):dom.setAttribute(name,attrs[name])}}for(let i=start;i<structure.length;i++){let child=structure[i];if(0===child){if(i<structure.length-1||i>start)throw new RangeError("Content hole must be the only child of its parent node");return{dom,contentDOM:dom}}{let{dom:inner,contentDOM:innerContent}=renderSpec(doc,child,xmlNS,blockArraysIn);if(dom.appendChild(inner),innerContent){if(contentDOM)throw new RangeError("Multiple content holes");contentDOM=innerContent}}}return{dom,contentDOM}}},"./node_modules/prosemirror-state/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{$t:()=>EditorState,LN:()=>Selection,U3:()=>TextSelection,hs:()=>PluginKey,i5:()=>AllSelection,k_:()=>Plugin,nh:()=>NodeSelection});var prosemirror_model__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/prosemirror-model/dist/index.js"),prosemirror_transform__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/prosemirror-transform/dist/index.js");const classesById=Object.create(null);class Selection{constructor($anchor,$head,ranges){this.$anchor=$anchor,this.$head=$head,this.ranges=ranges||[new SelectionRange($anchor.min($head),$anchor.max($head))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let ranges=this.ranges;for(let i=0;i<ranges.length;i++)if(ranges[i].$from.pos!=ranges[i].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(tr,content=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.empty){let lastNode=content.content.lastChild,lastParent=null;for(let i=0;i<content.openEnd;i++)lastParent=lastNode,lastNode=lastNode.lastChild;let mapFrom=tr.steps.length,ranges=this.ranges;for(let i=0;i<ranges.length;i++){let{$from,$to}=ranges[i],mapping=tr.mapping.slice(mapFrom);tr.replaceRange(mapping.map($from.pos),mapping.map($to.pos),i?prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.empty:content),0==i&&selectionToInsertionEnd(tr,mapFrom,(lastNode?lastNode.isInline:lastParent&&lastParent.isTextblock)?-1:1)}}replaceWith(tr,node){let mapFrom=tr.steps.length,ranges=this.ranges;for(let i=0;i<ranges.length;i++){let{$from,$to}=ranges[i],mapping=tr.mapping.slice(mapFrom),from=mapping.map($from.pos),to=mapping.map($to.pos);i?tr.deleteRange(from,to):(tr.replaceRangeWith(from,to,node),selectionToInsertionEnd(tr,mapFrom,node.isInline?-1:1))}}static findFrom($pos,dir,textOnly=!1){let inner=$pos.parent.inlineContent?new TextSelection($pos):findSelectionIn($pos.node(0),$pos.parent,$pos.pos,$pos.index(),dir,textOnly);if(inner)return inner;for(let depth=$pos.depth-1;depth>=0;depth--){let found=dir<0?findSelectionIn($pos.node(0),$pos.node(depth),$pos.before(depth+1),$pos.index(depth),dir,textOnly):findSelectionIn($pos.node(0),$pos.node(depth),$pos.after(depth+1),$pos.index(depth)+1,dir,textOnly);if(found)return found}return null}static near($pos,bias=1){return this.findFrom($pos,bias)||this.findFrom($pos,-bias)||new AllSelection($pos.node(0))}static atStart(doc){return findSelectionIn(doc,doc,0,0,1)||new AllSelection(doc)}static atEnd(doc){return findSelectionIn(doc,doc,doc.content.size,doc.childCount,-1)||new AllSelection(doc)}static fromJSON(doc,json){if(!json||!json.type)throw new RangeError("Invalid input for Selection.fromJSON");let cls=classesById[json.type];if(!cls)throw new RangeError(`No selection type ${json.type} defined`);return cls.fromJSON(doc,json)}static jsonID(id,selectionClass){if(id in classesById)throw new RangeError("Duplicate use of selection JSON ID "+id);return classesById[id]=selectionClass,selectionClass.prototype.jsonID=id,selectionClass}getBookmark(){return TextSelection.between(this.$anchor,this.$head).getBookmark()}}Selection.prototype.visible=!0;class SelectionRange{constructor($from,$to){this.$from=$from,this.$to=$to}}let warnedAboutTextSelection=!1;function checkTextSelection($pos){warnedAboutTextSelection||$pos.parent.inlineContent||(warnedAboutTextSelection=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+$pos.parent.type.name+")"))}class TextSelection extends Selection{constructor($anchor,$head=$anchor){checkTextSelection($anchor),checkTextSelection($head),super($anchor,$head)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(doc,mapping){let $head=doc.resolve(mapping.map(this.head));if(!$head.parent.inlineContent)return Selection.near($head);let $anchor=doc.resolve(mapping.map(this.anchor));return new TextSelection($anchor.parent.inlineContent?$anchor:$head,$head)}replace(tr,content=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.empty){if(super.replace(tr,content),content==prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.empty){let marks=this.$from.marksAcross(this.$to);marks&&tr.ensureMarks(marks)}}eq(other){return other instanceof TextSelection&&other.anchor==this.anchor&&other.head==this.head}getBookmark(){return new TextBookmark(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(doc,json){if("number"!=typeof json.anchor||"number"!=typeof json.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new TextSelection(doc.resolve(json.anchor),doc.resolve(json.head))}static create(doc,anchor,head=anchor){let $anchor=doc.resolve(anchor);return new this($anchor,head==anchor?$anchor:doc.resolve(head))}static between($anchor,$head,bias){let dPos=$anchor.pos-$head.pos;if(bias&&!dPos||(bias=dPos>=0?1:-1),!$head.parent.inlineContent){let found=Selection.findFrom($head,bias,!0)||Selection.findFrom($head,-bias,!0);if(!found)return Selection.near($head,bias);$head=found.$head}return $anchor.parent.inlineContent||(0==dPos||($anchor=(Selection.findFrom($anchor,-bias,!0)||Selection.findFrom($anchor,bias,!0)).$anchor).pos<$head.pos!=dPos<0)&&($anchor=$head),new TextSelection($anchor,$head)}}Selection.jsonID("text",TextSelection);class TextBookmark{constructor(anchor,head){this.anchor=anchor,this.head=head}map(mapping){return new TextBookmark(mapping.map(this.anchor),mapping.map(this.head))}resolve(doc){return TextSelection.between(doc.resolve(this.anchor),doc.resolve(this.head))}}class NodeSelection extends Selection{constructor($pos){let node=$pos.nodeAfter,$end=$pos.node(0).resolve($pos.pos+node.nodeSize);super($pos,$end),this.node=node}map(doc,mapping){let{deleted,pos}=mapping.mapResult(this.anchor),$pos=doc.resolve(pos);return deleted?Selection.near($pos):new NodeSelection($pos)}content(){return new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(this.node),0,0)}eq(other){return other instanceof NodeSelection&&other.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new NodeBookmark(this.anchor)}static fromJSON(doc,json){if("number"!=typeof json.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new NodeSelection(doc.resolve(json.anchor))}static create(doc,from){return new NodeSelection(doc.resolve(from))}static isSelectable(node){return!node.isText&&!1!==node.type.spec.selectable}}NodeSelection.prototype.visible=!1,Selection.jsonID("node",NodeSelection);class NodeBookmark{constructor(anchor){this.anchor=anchor}map(mapping){let{deleted,pos}=mapping.mapResult(this.anchor);return deleted?new TextBookmark(pos,pos):new NodeBookmark(pos)}resolve(doc){let $pos=doc.resolve(this.anchor),node=$pos.nodeAfter;return node&&NodeSelection.isSelectable(node)?new NodeSelection($pos):Selection.near($pos)}}class AllSelection extends Selection{constructor(doc){super(doc.resolve(0),doc.resolve(doc.content.size))}replace(tr,content=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.empty){if(content==prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.empty){tr.delete(0,tr.doc.content.size);let sel=Selection.atStart(tr.doc);sel.eq(tr.selection)||tr.setSelection(sel)}else super.replace(tr,content)}toJSON(){return{type:"all"}}static fromJSON(doc){return new AllSelection(doc)}map(doc){return new AllSelection(doc)}eq(other){return other instanceof AllSelection}getBookmark(){return AllBookmark}}Selection.jsonID("all",AllSelection);const AllBookmark={map(){return this},resolve:doc=>new AllSelection(doc)};function findSelectionIn(doc,node,pos,index,dir,text=!1){if(node.inlineContent)return TextSelection.create(doc,pos);for(let i=index-(dir>0?0:1);dir>0?i<node.childCount:i>=0;i+=dir){let child=node.child(i);if(child.isAtom){if(!text&&NodeSelection.isSelectable(child))return NodeSelection.create(doc,pos-(dir<0?child.nodeSize:0))}else{let inner=findSelectionIn(doc,child,pos+dir,dir<0?child.childCount:0,dir,text);if(inner)return inner}pos+=child.nodeSize*dir}return null}function selectionToInsertionEnd(tr,startLen,bias){let last=tr.steps.length-1;if(last<startLen)return;let end,step=tr.steps[last];(step instanceof prosemirror_transform__WEBPACK_IMPORTED_MODULE_1__.Ln||step instanceof prosemirror_transform__WEBPACK_IMPORTED_MODULE_1__.Wg)&&(tr.mapping.maps[last].forEach(((_from,_to,_newFrom,newTo)=>{null==end&&(end=newTo)})),tr.setSelection(Selection.near(tr.doc.resolve(end),bias)))}class Transaction extends prosemirror_transform__WEBPACK_IMPORTED_MODULE_1__.dL{constructor(state){super(state.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=state.selection,this.storedMarks=state.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(selection){if(selection.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=selection,this.curSelectionFor=this.steps.length,this.updated=-3&this.updated|1,this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(marks){return this.storedMarks=marks,this.updated|=2,this}ensureMarks(marks){return prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.CU.sameSet(this.storedMarks||this.selection.$from.marks(),marks)||this.setStoredMarks(marks),this}addStoredMark(mark){return this.ensureMarks(mark.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(mark){return this.ensureMarks(mark.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(step,doc){super.addStep(step,doc),this.updated=-3&this.updated,this.storedMarks=null}setTime(time){return this.time=time,this}replaceSelection(slice){return this.selection.replace(this,slice),this}replaceSelectionWith(node,inheritMarks=!0){let selection=this.selection;return inheritMarks&&(node=node.mark(this.storedMarks||(selection.empty?selection.$from.marks():selection.$from.marksAcross(selection.$to)||prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.CU.none))),selection.replaceWith(this,node),this}deleteSelection(){return this.selection.replace(this),this}insertText(text,from,to){let schema=this.doc.type.schema;if(null==from)return text?this.replaceSelectionWith(schema.text(text),!0):this.deleteSelection();{if(null==to&&(to=from),to=null==to?from:to,!text)return this.deleteRange(from,to);let marks=this.storedMarks;if(!marks){let $from=this.doc.resolve(from);marks=to==from?$from.marks():$from.marksAcross(this.doc.resolve(to))}return this.replaceRangeWith(from,to,schema.text(text,marks)),this.selection.empty||this.setSelection(Selection.near(this.selection.$to)),this}}setMeta(key,value){return this.meta["string"==typeof key?key:key.key]=value,this}getMeta(key){return this.meta["string"==typeof key?key:key.key]}get isGeneric(){for(let _ in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function bind(f,self){return self&&f?f.bind(self):f}class FieldDesc{constructor(name,desc,self){this.name=name,this.init=bind(desc.init,self),this.apply=bind(desc.apply,self)}}const baseFields=[new FieldDesc("doc",{init:config=>config.doc||config.schema.topNodeType.createAndFill(),apply:tr=>tr.doc}),new FieldDesc("selection",{init:(config,instance)=>config.selection||Selection.atStart(instance.doc),apply:tr=>tr.selection}),new FieldDesc("storedMarks",{init:config=>config.storedMarks||null,apply:(tr,_marks,_old,state)=>state.selection.$cursor?tr.storedMarks:null}),new FieldDesc("scrollToSelection",{init:()=>0,apply:(tr,prev)=>tr.scrolledIntoView?prev+1:prev})];class Configuration{constructor(schema,plugins){this.schema=schema,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=baseFields.slice(),plugins&&plugins.forEach((plugin=>{if(this.pluginsByKey[plugin.key])throw new RangeError("Adding different instances of a keyed plugin ("+plugin.key+")");this.plugins.push(plugin),this.pluginsByKey[plugin.key]=plugin,plugin.spec.state&&this.fields.push(new FieldDesc(plugin.key,plugin.spec.state,plugin))}))}}class EditorState{constructor(config){this.config=config}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(tr){return this.applyTransaction(tr).state}filterTransaction(tr,ignore=-1){for(let i=0;i<this.config.plugins.length;i++)if(i!=ignore){let plugin=this.config.plugins[i];if(plugin.spec.filterTransaction&&!plugin.spec.filterTransaction.call(plugin,tr,this))return!1}return!0}applyTransaction(rootTr){if(!this.filterTransaction(rootTr))return{state:this,transactions:[]};let trs=[rootTr],newState=this.applyInner(rootTr),seen=null;for(;;){let haveNew=!1;for(let i=0;i<this.config.plugins.length;i++){let plugin=this.config.plugins[i];if(plugin.spec.appendTransaction){let n=seen?seen[i].n:0,oldState=seen?seen[i].state:this,tr=n<trs.length&&plugin.spec.appendTransaction.call(plugin,n?trs.slice(n):trs,oldState,newState);if(tr&&newState.filterTransaction(tr,i)){if(tr.setMeta("appendedTransaction",rootTr),!seen){seen=[];for(let j=0;j<this.config.plugins.length;j++)seen.push(j<i?{state:newState,n:trs.length}:{state:this,n:0})}trs.push(tr),newState=newState.applyInner(tr),haveNew=!0}seen&&(seen[i]={state:newState,n:trs.length})}}if(!haveNew)return{state:newState,transactions:trs}}}applyInner(tr){if(!tr.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let newInstance=new EditorState(this.config),fields=this.config.fields;for(let i=0;i<fields.length;i++){let field=fields[i];newInstance[field.name]=field.apply(tr,this[field.name],this,newInstance)}return newInstance}get tr(){return new Transaction(this)}static create(config){let $config=new Configuration(config.doc?config.doc.type.schema:config.schema,config.plugins),instance=new EditorState($config);for(let i=0;i<$config.fields.length;i++)instance[$config.fields[i].name]=$config.fields[i].init(config,instance);return instance}reconfigure(config){let $config=new Configuration(this.schema,config.plugins),fields=$config.fields,instance=new EditorState($config);for(let i=0;i<fields.length;i++){let name=fields[i].name;instance[name]=this.hasOwnProperty(name)?this[name]:fields[i].init(config,instance)}return instance}toJSON(pluginFields){let result={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(result.storedMarks=this.storedMarks.map((m=>m.toJSON()))),pluginFields&&"object"==typeof pluginFields)for(let prop in pluginFields){if("doc"==prop||"selection"==prop)throw new RangeError("The JSON fields `doc` and `selection` are reserved");let plugin=pluginFields[prop],state=plugin.spec.state;state&&state.toJSON&&(result[prop]=state.toJSON.call(plugin,this[plugin.key]))}return result}static fromJSON(config,json,pluginFields){if(!json)throw new RangeError("Invalid input for EditorState.fromJSON");if(!config.schema)throw new RangeError("Required config field 'schema' missing");let $config=new Configuration(config.schema,config.plugins),instance=new EditorState($config);return $config.fields.forEach((field=>{if("doc"==field.name)instance.doc=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.bP.fromJSON(config.schema,json.doc);else if("selection"==field.name)instance.selection=Selection.fromJSON(instance.doc,json.selection);else if("storedMarks"==field.name)json.storedMarks&&(instance.storedMarks=json.storedMarks.map(config.schema.markFromJSON));else{if(pluginFields)for(let prop in pluginFields){let plugin=pluginFields[prop],state=plugin.spec.state;if(plugin.key==field.name&&state&&state.fromJSON&&Object.prototype.hasOwnProperty.call(json,prop))return void(instance[field.name]=state.fromJSON.call(plugin,config,json[prop],instance))}instance[field.name]=field.init(config,instance)}})),instance}}function bindProps(obj,self,target){for(let prop in obj){let val=obj[prop];val instanceof Function?val=val.bind(self):"handleDOMEvents"==prop&&(val=bindProps(val,self,{})),target[prop]=val}return target}class Plugin{constructor(spec){this.spec=spec,this.props={},spec.props&&bindProps(spec.props,this,this.props),this.key=spec.key?spec.key.key:createKey("plugin")}getState(state){return state[this.key]}}const keys=Object.create(null);function createKey(name){return name in keys?name+"$"+ ++keys[name]:(keys[name]=0,name+"$")}class PluginKey{constructor(name="key"){this.key=createKey(name)}get(state){return state.config.pluginsByKey[this.key]}getState(state){return state[this.key]}}},"./node_modules/prosemirror-transform/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{$L:()=>replaceStep,Ln:()=>ReplaceStep,N0:()=>joinPoint,Um:()=>dropPoint,Wg:()=>ReplaceAroundStep,X9:()=>Mapping,dL:()=>Transform,jP:()=>liftTarget,n9:()=>canJoin,oM:()=>findWrapping,zy:()=>canSplit});var prosemirror_model__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/prosemirror-model/dist/index.js");const factor16=Math.pow(2,16);function recoverIndex(value){return 65535&value}class MapResult{constructor(pos,delInfo,recover){this.pos=pos,this.delInfo=delInfo,this.recover=recover}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class StepMap{constructor(ranges,inverted=!1){if(this.ranges=ranges,this.inverted=inverted,!ranges.length&&StepMap.empty)return StepMap.empty}recover(value){let diff=0,index=recoverIndex(value);if(!this.inverted)for(let i=0;i<index;i++)diff+=this.ranges[3*i+2]-this.ranges[3*i+1];return this.ranges[3*index]+diff+function recoverOffset(value){return(value-(65535&value))/factor16}(value)}mapResult(pos,assoc=1){return this._map(pos,assoc,!1)}map(pos,assoc=1){return this._map(pos,assoc,!0)}_map(pos,assoc,simple){let diff=0,oldIndex=this.inverted?2:1,newIndex=this.inverted?1:2;for(let i=0;i<this.ranges.length;i+=3){let start=this.ranges[i]-(this.inverted?diff:0);if(start>pos)break;let oldSize=this.ranges[i+oldIndex],newSize=this.ranges[i+newIndex],end=start+oldSize;if(pos<=end){let result=start+diff+((oldSize?pos==start?-1:pos==end?1:assoc:assoc)<0?0:newSize);if(simple)return result;let recover=pos==(assoc<0?start:end)?null:i/3+(pos-start)*factor16,del=pos==start?2:pos==end?1:4;return(assoc<0?pos!=start:pos!=end)&&(del|=8),new MapResult(result,del,recover)}diff+=newSize-oldSize}return simple?pos+diff:new MapResult(pos+diff,0,null)}touches(pos,recover){let diff=0,index=recoverIndex(recover),oldIndex=this.inverted?2:1,newIndex=this.inverted?1:2;for(let i=0;i<this.ranges.length;i+=3){let start=this.ranges[i]-(this.inverted?diff:0);if(start>pos)break;let oldSize=this.ranges[i+oldIndex];if(pos<=start+oldSize&&i==3*index)return!0;diff+=this.ranges[i+newIndex]-oldSize}return!1}forEach(f){let oldIndex=this.inverted?2:1,newIndex=this.inverted?1:2;for(let i=0,diff=0;i<this.ranges.length;i+=3){let start=this.ranges[i],oldStart=start-(this.inverted?diff:0),newStart=start+(this.inverted?0:diff),oldSize=this.ranges[i+oldIndex],newSize=this.ranges[i+newIndex];f(oldStart,oldStart+oldSize,newStart,newStart+newSize),diff+=newSize-oldSize}}invert(){return new StepMap(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(n){return 0==n?StepMap.empty:new StepMap(n<0?[0,-n,0]:[0,0,n])}}StepMap.empty=new StepMap([]);class Mapping{constructor(maps,mirror,from=0,to=(maps?maps.length:0)){this.mirror=mirror,this.from=from,this.to=to,this._maps=maps||[],this.ownData=!(maps||mirror)}get maps(){return this._maps}slice(from=0,to=this.maps.length){return new Mapping(this._maps,this.mirror,from,to)}appendMap(map,mirrors){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(map),null!=mirrors&&this.setMirror(this._maps.length-1,mirrors)}appendMapping(mapping){for(let i=0,startSize=this._maps.length;i<mapping._maps.length;i++){let mirr=mapping.getMirror(i);this.appendMap(mapping._maps[i],null!=mirr&&mirr<i?startSize+mirr:void 0)}}getMirror(n){if(this.mirror)for(let i=0;i<this.mirror.length;i++)if(this.mirror[i]==n)return this.mirror[i+(i%2?-1:1)]}setMirror(n,m){this.mirror||(this.mirror=[]),this.mirror.push(n,m)}appendMappingInverted(mapping){for(let i=mapping.maps.length-1,totalSize=this._maps.length+mapping._maps.length;i>=0;i--){let mirr=mapping.getMirror(i);this.appendMap(mapping._maps[i].invert(),null!=mirr&&mirr>i?totalSize-mirr-1:void 0)}}invert(){let inverse=new Mapping;return inverse.appendMappingInverted(this),inverse}map(pos,assoc=1){if(this.mirror)return this._map(pos,assoc,!0);for(let i=this.from;i<this.to;i++)pos=this._maps[i].map(pos,assoc);return pos}mapResult(pos,assoc=1){return this._map(pos,assoc,!1)}_map(pos,assoc,simple){let delInfo=0;for(let i=this.from;i<this.to;i++){let result=this._maps[i].mapResult(pos,assoc);if(null!=result.recover){let corr=this.getMirror(i);if(null!=corr&&corr>i&&corr<this.to){i=corr,pos=this._maps[corr].recover(result.recover);continue}}delInfo|=result.delInfo,pos=result.pos}return simple?pos:new MapResult(pos,delInfo,null)}}const stepsByID=Object.create(null);class Step{getMap(){return StepMap.empty}merge(other){return null}static fromJSON(schema,json){if(!json||!json.stepType)throw new RangeError("Invalid input for Step.fromJSON");let type=stepsByID[json.stepType];if(!type)throw new RangeError(`No step type ${json.stepType} defined`);return type.fromJSON(schema,json)}static jsonID(id,stepClass){if(id in stepsByID)throw new RangeError("Duplicate use of step JSON ID "+id);return stepsByID[id]=stepClass,stepClass.prototype.jsonID=id,stepClass}}class StepResult{constructor(doc,failed){this.doc=doc,this.failed=failed}static ok(doc){return new StepResult(doc,null)}static fail(message){return new StepResult(null,message)}static fromReplace(doc,from,to,slice){try{return StepResult.ok(doc.replace(from,to,slice))}catch(e){if(e instanceof prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.vI)return StepResult.fail(e.message);throw e}}}function mapFragment(fragment,f,parent){let mapped=[];for(let i=0;i<fragment.childCount;i++){let child=fragment.child(i);child.content.size&&(child=child.copy(mapFragment(child.content,f,child))),child.isInline&&(child=f(child,parent,i)),mapped.push(child)}return prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.fromArray(mapped)}class AddMarkStep extends Step{constructor(from,to,mark){super(),this.from=from,this.to=to,this.mark=mark}apply(doc){let oldSlice=doc.slice(this.from,this.to),$from=doc.resolve(this.from),parent=$from.node($from.sharedDepth(this.to)),slice=new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(mapFragment(oldSlice.content,((node,parent)=>node.isAtom&&parent.type.allowsMarkType(this.mark.type)?node.mark(this.mark.addToSet(node.marks)):node),parent),oldSlice.openStart,oldSlice.openEnd);return StepResult.fromReplace(doc,this.from,this.to,slice)}invert(){return new RemoveMarkStep(this.from,this.to,this.mark)}map(mapping){let from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1);return from.deleted&&to.deleted||from.pos>=to.pos?null:new AddMarkStep(from.pos,to.pos,this.mark)}merge(other){return other instanceof AddMarkStep&&other.mark.eq(this.mark)&&this.from<=other.to&&this.to>=other.from?new AddMarkStep(Math.min(this.from,other.from),Math.max(this.to,other.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(schema,json){if("number"!=typeof json.from||"number"!=typeof json.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new AddMarkStep(json.from,json.to,schema.markFromJSON(json.mark))}}Step.jsonID("addMark",AddMarkStep);class RemoveMarkStep extends Step{constructor(from,to,mark){super(),this.from=from,this.to=to,this.mark=mark}apply(doc){let oldSlice=doc.slice(this.from,this.to),slice=new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(mapFragment(oldSlice.content,(node=>node.mark(this.mark.removeFromSet(node.marks))),doc),oldSlice.openStart,oldSlice.openEnd);return StepResult.fromReplace(doc,this.from,this.to,slice)}invert(){return new AddMarkStep(this.from,this.to,this.mark)}map(mapping){let from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1);return from.deleted&&to.deleted||from.pos>=to.pos?null:new RemoveMarkStep(from.pos,to.pos,this.mark)}merge(other){return other instanceof RemoveMarkStep&&other.mark.eq(this.mark)&&this.from<=other.to&&this.to>=other.from?new RemoveMarkStep(Math.min(this.from,other.from),Math.max(this.to,other.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(schema,json){if("number"!=typeof json.from||"number"!=typeof json.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new RemoveMarkStep(json.from,json.to,schema.markFromJSON(json.mark))}}Step.jsonID("removeMark",RemoveMarkStep);class AddNodeMarkStep extends Step{constructor(pos,mark){super(),this.pos=pos,this.mark=mark}apply(doc){let node=doc.nodeAt(this.pos);if(!node)return StepResult.fail("No node at mark step's position");let updated=node.type.create(node.attrs,null,this.mark.addToSet(node.marks));return StepResult.fromReplace(doc,this.pos,this.pos+1,new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(updated),0,node.isLeaf?0:1))}invert(doc){let node=doc.nodeAt(this.pos);if(node){let newSet=this.mark.addToSet(node.marks);if(newSet.length==node.marks.length){for(let i=0;i<node.marks.length;i++)if(!node.marks[i].isInSet(newSet))return new AddNodeMarkStep(this.pos,node.marks[i]);return new AddNodeMarkStep(this.pos,this.mark)}}return new RemoveNodeMarkStep(this.pos,this.mark)}map(mapping){let pos=mapping.mapResult(this.pos,1);return pos.deletedAfter?null:new AddNodeMarkStep(pos.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(schema,json){if("number"!=typeof json.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new AddNodeMarkStep(json.pos,schema.markFromJSON(json.mark))}}Step.jsonID("addNodeMark",AddNodeMarkStep);class RemoveNodeMarkStep extends Step{constructor(pos,mark){super(),this.pos=pos,this.mark=mark}apply(doc){let node=doc.nodeAt(this.pos);if(!node)return StepResult.fail("No node at mark step's position");let updated=node.type.create(node.attrs,null,this.mark.removeFromSet(node.marks));return StepResult.fromReplace(doc,this.pos,this.pos+1,new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(updated),0,node.isLeaf?0:1))}invert(doc){let node=doc.nodeAt(this.pos);return node&&this.mark.isInSet(node.marks)?new AddNodeMarkStep(this.pos,this.mark):this}map(mapping){let pos=mapping.mapResult(this.pos,1);return pos.deletedAfter?null:new RemoveNodeMarkStep(pos.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(schema,json){if("number"!=typeof json.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new RemoveNodeMarkStep(json.pos,schema.markFromJSON(json.mark))}}Step.jsonID("removeNodeMark",RemoveNodeMarkStep);class ReplaceStep extends Step{constructor(from,to,slice,structure=!1){super(),this.from=from,this.to=to,this.slice=slice,this.structure=structure}apply(doc){return this.structure&&contentBetween(doc,this.from,this.to)?StepResult.fail("Structure replace would overwrite content"):StepResult.fromReplace(doc,this.from,this.to,this.slice)}getMap(){return new StepMap([this.from,this.to-this.from,this.slice.size])}invert(doc){return new ReplaceStep(this.from,this.from+this.slice.size,doc.slice(this.from,this.to))}map(mapping){let from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1);return from.deletedAcross&&to.deletedAcross?null:new ReplaceStep(from.pos,Math.max(from.pos,to.pos),this.slice,this.structure)}merge(other){if(!(other instanceof ReplaceStep)||other.structure||this.structure)return null;if(this.from+this.slice.size!=other.from||this.slice.openEnd||other.slice.openStart){if(other.to!=this.from||this.slice.openStart||other.slice.openEnd)return null;{let slice=this.slice.size+other.slice.size==0?prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.empty:new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(other.slice.content.append(this.slice.content),other.slice.openStart,this.slice.openEnd);return new ReplaceStep(other.from,this.to,slice,this.structure)}}{let slice=this.slice.size+other.slice.size==0?prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.empty:new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(this.slice.content.append(other.slice.content),this.slice.openStart,other.slice.openEnd);return new ReplaceStep(this.from,this.to+(other.to-other.from),slice,this.structure)}}toJSON(){let json={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(json.slice=this.slice.toJSON()),this.structure&&(json.structure=!0),json}static fromJSON(schema,json){if("number"!=typeof json.from||"number"!=typeof json.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ReplaceStep(json.from,json.to,prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.fromJSON(schema,json.slice),!!json.structure)}}Step.jsonID("replace",ReplaceStep);class ReplaceAroundStep extends Step{constructor(from,to,gapFrom,gapTo,slice,insert,structure=!1){super(),this.from=from,this.to=to,this.gapFrom=gapFrom,this.gapTo=gapTo,this.slice=slice,this.insert=insert,this.structure=structure}apply(doc){if(this.structure&&(contentBetween(doc,this.from,this.gapFrom)||contentBetween(doc,this.gapTo,this.to)))return StepResult.fail("Structure gap-replace would overwrite content");let gap=doc.slice(this.gapFrom,this.gapTo);if(gap.openStart||gap.openEnd)return StepResult.fail("Gap is not a flat range");let inserted=this.slice.insertAt(this.insert,gap.content);return inserted?StepResult.fromReplace(doc,this.from,this.to,inserted):StepResult.fail("Content does not fit in gap")}getMap(){return new StepMap([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(doc){let gap=this.gapTo-this.gapFrom;return new ReplaceAroundStep(this.from,this.from+this.slice.size+gap,this.from+this.insert,this.from+this.insert+gap,doc.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(mapping){let from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1),gapFrom=this.from==this.gapFrom?from.pos:mapping.map(this.gapFrom,-1),gapTo=this.to==this.gapTo?to.pos:mapping.map(this.gapTo,1);return from.deletedAcross&&to.deletedAcross||gapFrom<from.pos||gapTo>to.pos?null:new ReplaceAroundStep(from.pos,to.pos,gapFrom,gapTo,this.slice,this.insert,this.structure)}toJSON(){let json={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(json.slice=this.slice.toJSON()),this.structure&&(json.structure=!0),json}static fromJSON(schema,json){if("number"!=typeof json.from||"number"!=typeof json.to||"number"!=typeof json.gapFrom||"number"!=typeof json.gapTo||"number"!=typeof json.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ReplaceAroundStep(json.from,json.to,json.gapFrom,json.gapTo,prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.fromJSON(schema,json.slice),json.insert,!!json.structure)}}function contentBetween(doc,from,to){let $from=doc.resolve(from),dist=to-from,depth=$from.depth;for(;dist>0&&depth>0&&$from.indexAfter(depth)==$from.node(depth).childCount;)depth--,dist--;if(dist>0){let next=$from.node(depth).maybeChild($from.indexAfter(depth));for(;dist>0;){if(!next||next.isLeaf)return!0;next=next.firstChild,dist--}}return!1}function clearIncompatible(tr,pos,parentType,match=parentType.contentMatch,clearNewlines=!0){let node=tr.doc.nodeAt(pos),replSteps=[],cur=pos+1;for(let i=0;i<node.childCount;i++){let child=node.child(i),end=cur+child.nodeSize,allowed=match.matchType(child.type);if(allowed){match=allowed;for(let j=0;j<child.marks.length;j++)parentType.allowsMarkType(child.marks[j].type)||tr.step(new RemoveMarkStep(cur,end,child.marks[j]));if(clearNewlines&&child.isText&&"pre"!=parentType.whitespace){let m,slice,newline=/\r?\n|\r/g;for(;m=newline.exec(child.text);)slice||(slice=new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(parentType.schema.text(" ",parentType.allowedMarks(child.marks))),0,0)),replSteps.push(new ReplaceStep(cur+m.index,cur+m.index+m[0].length,slice))}}else replSteps.push(new ReplaceStep(cur,end,prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.empty));cur=end}if(!match.validEnd){let fill=match.fillBefore(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.empty,!0);tr.replace(cur,cur,new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(fill,0,0))}for(let i=replSteps.length-1;i>=0;i--)tr.step(replSteps[i])}function canCut(node,start,end){return(0==start||node.canReplace(start,node.childCount))&&(end==node.childCount||node.canReplace(0,end))}function liftTarget(range){let content=range.parent.content.cutByIndex(range.startIndex,range.endIndex);for(let depth=range.depth;;--depth){let node=range.$from.node(depth),index=range.$from.index(depth),endIndex=range.$to.indexAfter(depth);if(depth<range.depth&&node.canReplace(index,endIndex,content))return depth;if(0==depth||node.type.spec.isolating||!canCut(node,index,endIndex))break}return null}function findWrapping(range,nodeType,attrs=null,innerRange=range){let around=function findWrappingOutside(range,type){let{parent,startIndex,endIndex}=range,around=parent.contentMatchAt(startIndex).findWrapping(type);if(!around)return null;let outer=around.length?around[0]:type;return parent.canReplaceWith(startIndex,endIndex,outer)?around:null}(range,nodeType),inner=around&&function findWrappingInside(range,type){let{parent,startIndex,endIndex}=range,inner=parent.child(startIndex),inside=type.contentMatch.findWrapping(inner.type);if(!inside)return null;let innerMatch=(inside.length?inside[inside.length-1]:type).contentMatch;for(let i=startIndex;innerMatch&&i<endIndex;i++)innerMatch=innerMatch.matchType(parent.child(i).type);return innerMatch&&innerMatch.validEnd?inside:null}(innerRange,nodeType);return inner?around.map(withAttrs).concat({type:nodeType,attrs}).concat(inner.map(withAttrs)):null}function withAttrs(type){return{type,attrs:null}}function replaceNewlines(tr,node,pos,mapFrom){node.forEach(((child,offset)=>{if(child.isText){let m,newline=/\r?\n|\r/g;for(;m=newline.exec(child.text);){let start=tr.mapping.slice(mapFrom).map(pos+1+offset+m.index);tr.replaceWith(start,start+1,node.type.schema.linebreakReplacement.create())}}}))}function replaceLinebreaks(tr,node,pos,mapFrom){node.forEach(((child,offset)=>{if(child.type==child.type.schema.linebreakReplacement){let start=tr.mapping.slice(mapFrom).map(pos+1+offset);tr.replaceWith(start,start+1,node.type.schema.text("\n"))}}))}function canSplit(doc,pos,depth=1,typesAfter){let $pos=doc.resolve(pos),base=$pos.depth-depth,innerType=typesAfter&&typesAfter[typesAfter.length-1]||$pos.parent;if(base<0||$pos.parent.type.spec.isolating||!$pos.parent.canReplace($pos.index(),$pos.parent.childCount)||!innerType.type.validContent($pos.parent.content.cutByIndex($pos.index(),$pos.parent.childCount)))return!1;for(let d=$pos.depth-1,i=depth-2;d>base;d--,i--){let node=$pos.node(d),index=$pos.index(d);if(node.type.spec.isolating)return!1;let rest=node.content.cutByIndex(index,node.childCount),overrideChild=typesAfter&&typesAfter[i+1];overrideChild&&(rest=rest.replaceChild(0,overrideChild.type.create(overrideChild.attrs)));let after=typesAfter&&typesAfter[i]||node;if(!node.canReplace(index+1,node.childCount)||!after.type.validContent(rest))return!1}let index=$pos.indexAfter(base),baseType=typesAfter&&typesAfter[0];return $pos.node(base).canReplaceWith(index,index,baseType?baseType.type:$pos.node(base+1).type)}function canJoin(doc,pos){let $pos=doc.resolve(pos),index=$pos.index();return joinable($pos.nodeBefore,$pos.nodeAfter)&&$pos.parent.canReplace(index,index+1)}function joinable(a,b){return!(!a||!b||a.isLeaf||!function canAppendWithSubstitutedLinebreaks(a,b){b.content.size||a.type.compatibleContent(b.type);let match=a.contentMatchAt(a.childCount),{linebreakReplacement}=a.type.schema;for(let i=0;i<b.childCount;i++){let child=b.child(i),type=child.type==linebreakReplacement?a.type.schema.nodes.text:child.type;if(match=match.matchType(type),!match)return!1;if(!a.type.allowsMarks(child.marks))return!1}return match.validEnd}(a,b))}function joinPoint(doc,pos,dir=-1){let $pos=doc.resolve(pos);for(let d=$pos.depth;;d--){let before,after,index=$pos.index(d);if(d==$pos.depth?(before=$pos.nodeBefore,after=$pos.nodeAfter):dir>0?(before=$pos.node(d+1),index++,after=$pos.node(d).maybeChild(index)):(before=$pos.node(d).maybeChild(index-1),after=$pos.node(d+1)),before&&!before.isTextblock&&joinable(before,after)&&$pos.node(d).canReplace(index,index+1))return pos;if(0==d)break;pos=dir<0?$pos.before(d):$pos.after(d)}}function dropPoint(doc,pos,slice){let $pos=doc.resolve(pos);if(!slice.content.size)return pos;let content=slice.content;for(let i=0;i<slice.openStart;i++)content=content.firstChild.content;for(let pass=1;pass<=(0==slice.openStart&&slice.size?2:1);pass++)for(let d=$pos.depth;d>=0;d--){let bias=d==$pos.depth?0:$pos.pos<=($pos.start(d+1)+$pos.end(d+1))/2?-1:1,insertPos=$pos.index(d)+(bias>0?1:0),parent=$pos.node(d),fits=!1;if(1==pass)fits=parent.canReplace(insertPos,insertPos,content);else{let wrapping=parent.contentMatchAt(insertPos).findWrapping(content.firstChild.type);fits=wrapping&&parent.canReplaceWith(insertPos,insertPos,wrapping[0])}if(fits)return 0==bias?$pos.pos:bias<0?$pos.before(d+1):$pos.after(d+1)}return null}function replaceStep(doc,from,to=from,slice=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.empty){if(from==to&&!slice.size)return null;let $from=doc.resolve(from),$to=doc.resolve(to);return fitsTrivially($from,$to,slice)?new ReplaceStep(from,to,slice):new Fitter($from,$to,slice).fit()}function fitsTrivially($from,$to,slice){return!slice.openStart&&!slice.openEnd&&$from.start()==$to.start()&&$from.parent.canReplace($from.index(),$to.index(),slice.content)}Step.jsonID("replaceAround",ReplaceAroundStep);class Fitter{constructor($from,$to,unplaced){this.$from=$from,this.$to=$to,this.unplaced=unplaced,this.frontier=[],this.placed=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.empty;for(let i=0;i<=$from.depth;i++){let node=$from.node(i);this.frontier.push({type:node.type,match:node.contentMatchAt($from.indexAfter(i))})}for(let i=$from.depth;i>0;i--)this.placed=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from($from.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let fit=this.findFittable();fit?this.placeNodes(fit):this.openMore()||this.dropNode()}let moveInline=this.mustMoveInline(),placedSize=this.placed.size-this.depth-this.$from.depth,$from=this.$from,$to=this.close(moveInline<0?this.$to:$from.doc.resolve(moveInline));if(!$to)return null;let content=this.placed,openStart=$from.depth,openEnd=$to.depth;for(;openStart&&openEnd&&1==content.childCount;)content=content.firstChild.content,openStart--,openEnd--;let slice=new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(content,openStart,openEnd);return moveInline>-1?new ReplaceAroundStep($from.pos,moveInline,this.$to.pos,this.$to.end(),slice,placedSize):slice.size||$from.pos!=this.$to.pos?new ReplaceStep($from.pos,$to.pos,slice):null}findFittable(){let startDepth=this.unplaced.openStart;for(let cur=this.unplaced.content,d=0,openEnd=this.unplaced.openEnd;d<startDepth;d++){let node=cur.firstChild;if(cur.childCount>1&&(openEnd=0),node.type.spec.isolating&&openEnd<=d){startDepth=d;break}cur=node.content}for(let pass=1;pass<=2;pass++)for(let sliceDepth=1==pass?startDepth:this.unplaced.openStart;sliceDepth>=0;sliceDepth--){let fragment,parent=null;sliceDepth?(parent=contentAt(this.unplaced.content,sliceDepth-1).firstChild,fragment=parent.content):fragment=this.unplaced.content;let first=fragment.firstChild;for(let frontierDepth=this.depth;frontierDepth>=0;frontierDepth--){let wrap,{type,match}=this.frontier[frontierDepth],inject=null;if(1==pass&&(first?match.matchType(first.type)||(inject=match.fillBefore(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(first),!1)):parent&&type.compatibleContent(parent.type)))return{sliceDepth,frontierDepth,parent,inject};if(2==pass&&first&&(wrap=match.findWrapping(first.type)))return{sliceDepth,frontierDepth,parent,wrap};if(parent&&match.matchType(parent.type))break}}}openMore(){let{content,openStart,openEnd}=this.unplaced,inner=contentAt(content,openStart);return!(!inner.childCount||inner.firstChild.isLeaf)&&(this.unplaced=new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(content,openStart+1,Math.max(openEnd,inner.size+openStart>=content.size-openEnd?openStart+1:0)),!0)}dropNode(){let{content,openStart,openEnd}=this.unplaced,inner=contentAt(content,openStart);if(inner.childCount<=1&&openStart>0){let openAtEnd=content.size-openStart<=openStart+inner.size;this.unplaced=new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(dropFromFragment(content,openStart-1,1),openStart-1,openAtEnd?openStart-1:openEnd)}else this.unplaced=new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(dropFromFragment(content,openStart,1),openStart,openEnd)}placeNodes({sliceDepth,frontierDepth,parent,inject,wrap}){for(;this.depth>frontierDepth;)this.closeFrontierNode();if(wrap)for(let i=0;i<wrap.length;i++)this.openFrontierNode(wrap[i]);let slice=this.unplaced,fragment=parent?parent.content:slice.content,openStart=slice.openStart-sliceDepth,taken=0,add=[],{match,type}=this.frontier[frontierDepth];if(inject){for(let i=0;i<inject.childCount;i++)add.push(inject.child(i));match=match.matchFragment(inject)}let openEndCount=fragment.size+sliceDepth-(slice.content.size-slice.openEnd);for(;taken<fragment.childCount;){let next=fragment.child(taken),matches=match.matchType(next.type);if(!matches)break;taken++,(taken>1||0==openStart||next.content.size)&&(match=matches,add.push(closeNodeStart(next.mark(type.allowedMarks(next.marks)),1==taken?openStart:0,taken==fragment.childCount?openEndCount:-1)))}let toEnd=taken==fragment.childCount;toEnd||(openEndCount=-1),this.placed=addToFragment(this.placed,frontierDepth,prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(add)),this.frontier[frontierDepth].match=match,toEnd&&openEndCount<0&&parent&&parent.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let i=0,cur=fragment;i<openEndCount;i++){let node=cur.lastChild;this.frontier.push({type:node.type,match:node.contentMatchAt(node.childCount)}),cur=node.content}this.unplaced=toEnd?0==sliceDepth?prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.empty:new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(dropFromFragment(slice.content,sliceDepth-1,1),sliceDepth-1,openEndCount<0?slice.openEnd:sliceDepth-1):new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(dropFromFragment(slice.content,sliceDepth,taken),slice.openStart,slice.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let level,top=this.frontier[this.depth];if(!top.type.isTextblock||!contentAfterFits(this.$to,this.$to.depth,top.type,top.match,!1)||this.$to.depth==this.depth&&(level=this.findCloseLevel(this.$to))&&level.depth==this.depth)return-1;let{depth}=this.$to,after=this.$to.after(depth);for(;depth>1&&after==this.$to.end(--depth);)++after;return after}findCloseLevel($to){scan:for(let i=Math.min(this.depth,$to.depth);i>=0;i--){let{match,type}=this.frontier[i],dropInner=i<$to.depth&&$to.end(i+1)==$to.pos+($to.depth-(i+1)),fit=contentAfterFits($to,i,type,match,dropInner);if(fit){for(let d=i-1;d>=0;d--){let{match,type}=this.frontier[d],matches=contentAfterFits($to,d,type,match,!0);if(!matches||matches.childCount)continue scan}return{depth:i,fit,move:dropInner?$to.doc.resolve($to.after(i+1)):$to}}}}close($to){let close=this.findCloseLevel($to);if(!close)return null;for(;this.depth>close.depth;)this.closeFrontierNode();close.fit.childCount&&(this.placed=addToFragment(this.placed,close.depth,close.fit)),$to=close.move;for(let d=close.depth+1;d<=$to.depth;d++){let node=$to.node(d),add=node.type.contentMatch.fillBefore(node.content,!0,$to.index(d));this.openFrontierNode(node.type,node.attrs,add)}return $to}openFrontierNode(type,attrs=null,content){let top=this.frontier[this.depth];top.match=top.match.matchType(type),this.placed=addToFragment(this.placed,this.depth,prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(type.create(attrs,content))),this.frontier.push({type,match:type.contentMatch})}closeFrontierNode(){let add=this.frontier.pop().match.fillBefore(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.empty,!0);add.childCount&&(this.placed=addToFragment(this.placed,this.frontier.length,add))}}function dropFromFragment(fragment,depth,count){return 0==depth?fragment.cutByIndex(count,fragment.childCount):fragment.replaceChild(0,fragment.firstChild.copy(dropFromFragment(fragment.firstChild.content,depth-1,count)))}function addToFragment(fragment,depth,content){return 0==depth?fragment.append(content):fragment.replaceChild(fragment.childCount-1,fragment.lastChild.copy(addToFragment(fragment.lastChild.content,depth-1,content)))}function contentAt(fragment,depth){for(let i=0;i<depth;i++)fragment=fragment.firstChild.content;return fragment}function closeNodeStart(node,openStart,openEnd){if(openStart<=0)return node;let frag=node.content;return openStart>1&&(frag=frag.replaceChild(0,closeNodeStart(frag.firstChild,openStart-1,1==frag.childCount?openEnd-1:0))),openStart>0&&(frag=node.type.contentMatch.fillBefore(frag).append(frag),openEnd<=0&&(frag=frag.append(node.type.contentMatch.matchFragment(frag).fillBefore(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.empty,!0)))),node.copy(frag)}function contentAfterFits($to,depth,type,match,open){let node=$to.node(depth),index=open?$to.indexAfter(depth):$to.index(depth);if(index==node.childCount&&!type.compatibleContent(node.type))return null;let fit=match.fillBefore(node.content,!0,index);return fit&&!function invalidMarks(type,fragment,start){for(let i=start;i<fragment.childCount;i++)if(!type.allowsMarks(fragment.child(i).marks))return!0;return!1}(type,node.content,index)?fit:null}function closeFragment(fragment,depth,oldOpen,newOpen,parent){if(depth<oldOpen){let first=fragment.firstChild;fragment=fragment.replaceChild(0,first.copy(closeFragment(first.content,depth+1,oldOpen,newOpen,first)))}if(depth>newOpen){let match=parent.contentMatchAt(0),start=match.fillBefore(fragment).append(fragment);fragment=start.append(match.matchFragment(start).fillBefore(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.empty,!0))}return fragment}function coveredDepths($from,$to){let result=[];for(let d=Math.min($from.depth,$to.depth);d>=0;d--){let start=$from.start(d);if(start<$from.pos-($from.depth-d)||$to.end(d)>$to.pos+($to.depth-d)||$from.node(d).type.spec.isolating||$to.node(d).type.spec.isolating)break;(start==$to.start(d)||d==$from.depth&&d==$to.depth&&$from.parent.inlineContent&&$to.parent.inlineContent&&d&&$to.start(d-1)==start-1)&&result.push(d)}return result}class AttrStep extends Step{constructor(pos,attr,value){super(),this.pos=pos,this.attr=attr,this.value=value}apply(doc){let node=doc.nodeAt(this.pos);if(!node)return StepResult.fail("No node at attribute step's position");let attrs=Object.create(null);for(let name in node.attrs)attrs[name]=node.attrs[name];attrs[this.attr]=this.value;let updated=node.type.create(attrs,null,node.marks);return StepResult.fromReplace(doc,this.pos,this.pos+1,new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(updated),0,node.isLeaf?0:1))}getMap(){return StepMap.empty}invert(doc){return new AttrStep(this.pos,this.attr,doc.nodeAt(this.pos).attrs[this.attr])}map(mapping){let pos=mapping.mapResult(this.pos,1);return pos.deletedAfter?null:new AttrStep(pos.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(schema,json){if("number"!=typeof json.pos||"string"!=typeof json.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new AttrStep(json.pos,json.attr,json.value)}}Step.jsonID("attr",AttrStep);class DocAttrStep extends Step{constructor(attr,value){super(),this.attr=attr,this.value=value}apply(doc){let attrs=Object.create(null);for(let name in doc.attrs)attrs[name]=doc.attrs[name];attrs[this.attr]=this.value;let updated=doc.type.create(attrs,doc.content,doc.marks);return StepResult.ok(updated)}getMap(){return StepMap.empty}invert(doc){return new DocAttrStep(this.attr,doc.attrs[this.attr])}map(mapping){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(schema,json){if("string"!=typeof json.attr)throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new DocAttrStep(json.attr,json.value)}}Step.jsonID("docAttr",DocAttrStep);let TransformError=class extends Error{};TransformError=function TransformError(message){let err=Error.call(this,message);return err.__proto__=TransformError.prototype,err},(TransformError.prototype=Object.create(Error.prototype)).constructor=TransformError,TransformError.prototype.name="TransformError";class Transform{constructor(doc){this.doc=doc,this.steps=[],this.docs=[],this.mapping=new Mapping}get before(){return this.docs.length?this.docs[0]:this.doc}step(step){let result=this.maybeStep(step);if(result.failed)throw new TransformError(result.failed);return this}maybeStep(step){let result=step.apply(this.doc);return result.failed||this.addStep(step,result.doc),result}get docChanged(){return this.steps.length>0}addStep(step,doc){this.docs.push(this.doc),this.steps.push(step),this.mapping.appendMap(step.getMap()),this.doc=doc}replace(from,to=from,slice=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.empty){let step=replaceStep(this.doc,from,to,slice);return step&&this.step(step),this}replaceWith(from,to,content){return this.replace(from,to,new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(content),0,0))}delete(from,to){return this.replace(from,to,prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.empty)}insert(pos,content){return this.replaceWith(pos,pos,content)}replaceRange(from,to,slice){return function replaceRange(tr,from,to,slice){if(!slice.size)return tr.deleteRange(from,to);let $from=tr.doc.resolve(from),$to=tr.doc.resolve(to);if(fitsTrivially($from,$to,slice))return tr.step(new ReplaceStep(from,to,slice));let targetDepths=coveredDepths($from,tr.doc.resolve(to));0==targetDepths[targetDepths.length-1]&&targetDepths.pop();let preferredTarget=-($from.depth+1);targetDepths.unshift(preferredTarget);for(let d=$from.depth,pos=$from.pos-1;d>0;d--,pos--){let spec=$from.node(d).type.spec;if(spec.defining||spec.definingAsContext||spec.isolating)break;targetDepths.indexOf(d)>-1?preferredTarget=d:$from.before(d)==pos&&targetDepths.splice(1,0,-d)}let preferredTargetIndex=targetDepths.indexOf(preferredTarget),leftNodes=[],preferredDepth=slice.openStart;for(let content=slice.content,i=0;;i++){let node=content.firstChild;if(leftNodes.push(node),i==slice.openStart)break;content=node.content}for(let d=preferredDepth-1;d>=0;d--){let leftNode=leftNodes[d],def=(type=leftNode.type).spec.defining||type.spec.definingForContent;if(def&&!leftNode.sameMarkup($from.node(Math.abs(preferredTarget)-1)))preferredDepth=d;else if(def||!leftNode.type.isTextblock)break}var type;for(let j=slice.openStart;j>=0;j--){let openDepth=(j+preferredDepth+1)%(slice.openStart+1),insert=leftNodes[openDepth];if(insert)for(let i=0;i<targetDepths.length;i++){let targetDepth=targetDepths[(i+preferredTargetIndex)%targetDepths.length],expand=!0;targetDepth<0&&(expand=!1,targetDepth=-targetDepth);let parent=$from.node(targetDepth-1),index=$from.index(targetDepth-1);if(parent.canReplaceWith(index,index,insert.type,insert.marks))return tr.replace($from.before(targetDepth),expand?$to.after(targetDepth):to,new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(closeFragment(slice.content,0,slice.openStart,openDepth),openDepth,slice.openEnd))}}let startSteps=tr.steps.length;for(let i=targetDepths.length-1;i>=0&&(tr.replace(from,to,slice),!(tr.steps.length>startSteps));i--){let depth=targetDepths[i];depth<0||(from=$from.before(depth),to=$to.after(depth))}}(this,from,to,slice),this}replaceRangeWith(from,to,node){return function replaceRangeWith(tr,from,to,node){if(!node.isInline&&from==to&&tr.doc.resolve(from).parent.content.size){let point=function insertPoint(doc,pos,nodeType){let $pos=doc.resolve(pos);if($pos.parent.canReplaceWith($pos.index(),$pos.index(),nodeType))return pos;if(0==$pos.parentOffset)for(let d=$pos.depth-1;d>=0;d--){let index=$pos.index(d);if($pos.node(d).canReplaceWith(index,index,nodeType))return $pos.before(d+1);if(index>0)return null}if($pos.parentOffset==$pos.parent.content.size)for(let d=$pos.depth-1;d>=0;d--){let index=$pos.indexAfter(d);if($pos.node(d).canReplaceWith(index,index,nodeType))return $pos.after(d+1);if(index<$pos.node(d).childCount)return null}return null}(tr.doc,from,node.type);null!=point&&(from=to=point)}tr.replaceRange(from,to,new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(node),0,0))}(this,from,to,node),this}deleteRange(from,to){return function deleteRange(tr,from,to){let $from=tr.doc.resolve(from),$to=tr.doc.resolve(to),covered=coveredDepths($from,$to);for(let i=0;i<covered.length;i++){let depth=covered[i],last=i==covered.length-1;if(last&&0==depth||$from.node(depth).type.contentMatch.validEnd)return tr.delete($from.start(depth),$to.end(depth));if(depth>0&&(last||$from.node(depth-1).canReplace($from.index(depth-1),$to.indexAfter(depth-1))))return tr.delete($from.before(depth),$to.after(depth))}for(let d=1;d<=$from.depth&&d<=$to.depth;d++)if(from-$from.start(d)==$from.depth-d&&to>$from.end(d)&&$to.end(d)-to!=$to.depth-d&&$from.start(d-1)==$to.start(d-1)&&$from.node(d-1).canReplace($from.index(d-1),$to.index(d-1)))return tr.delete($from.before(d),to);tr.delete(from,to)}(this,from,to),this}lift(range,target){return function lift(tr,range,target){let{$from,$to,depth}=range,gapStart=$from.before(depth+1),gapEnd=$to.after(depth+1),start=gapStart,end=gapEnd,before=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.empty,openStart=0;for(let d=depth,splitting=!1;d>target;d--)splitting||$from.index(d)>0?(splitting=!0,before=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from($from.node(d).copy(before)),openStart++):start--;let after=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.empty,openEnd=0;for(let d=depth,splitting=!1;d>target;d--)splitting||$to.after(d+1)<$to.end(d)?(splitting=!0,after=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from($to.node(d).copy(after)),openEnd++):end++;tr.step(new ReplaceAroundStep(start,end,gapStart,gapEnd,new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(before.append(after),openStart,openEnd),before.size-openStart,!0))}(this,range,target),this}join(pos,depth=1){return function join(tr,pos,depth){let convertNewlines=null,{linebreakReplacement}=tr.doc.type.schema,$before=tr.doc.resolve(pos-depth),beforeType=$before.node().type;if(linebreakReplacement&&beforeType.inlineContent){let pre="pre"==beforeType.whitespace,supportLinebreak=!!beforeType.contentMatch.matchType(linebreakReplacement);pre&&!supportLinebreak?convertNewlines=!1:!pre&&supportLinebreak&&(convertNewlines=!0)}let mapFrom=tr.steps.length;if(!1===convertNewlines){let $after=tr.doc.resolve(pos+depth);replaceLinebreaks(tr,$after.node(),$after.before(),mapFrom)}beforeType.inlineContent&&clearIncompatible(tr,pos+depth-1,beforeType,$before.node().contentMatchAt($before.index()),null==convertNewlines);let mapping=tr.mapping.slice(mapFrom),start=mapping.map(pos-depth);if(tr.step(new ReplaceStep(start,mapping.map(pos+depth,-1),prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.empty,!0)),!0===convertNewlines){let $full=tr.doc.resolve(start);replaceNewlines(tr,$full.node(),$full.before(),tr.steps.length)}return tr}(this,pos,depth),this}wrap(range,wrappers){return function wrap(tr,range,wrappers){let content=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.empty;for(let i=wrappers.length-1;i>=0;i--){if(content.size){let match=wrappers[i].type.contentMatch.matchFragment(content);if(!match||!match.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}content=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(wrappers[i].type.create(wrappers[i].attrs,content))}let start=range.start,end=range.end;tr.step(new ReplaceAroundStep(start,end,start,end,new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(content,0,0),wrappers.length,!0))}(this,range,wrappers),this}setBlockType(from,to=from,type,attrs=null){return function setBlockType(tr,from,to,type,attrs){if(!type.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let mapFrom=tr.steps.length;tr.doc.nodesBetween(from,to,((node,pos)=>{let attrsHere="function"==typeof attrs?attrs(node):attrs;if(node.isTextblock&&!node.hasMarkup(type,attrsHere)&&function canChangeType(doc,pos,type){let $pos=doc.resolve(pos),index=$pos.index();return $pos.parent.canReplaceWith(index,index+1,type)}(tr.doc,tr.mapping.slice(mapFrom).map(pos),type)){let convertNewlines=null;if(type.schema.linebreakReplacement){let pre="pre"==type.whitespace,supportLinebreak=!!type.contentMatch.matchType(type.schema.linebreakReplacement);pre&&!supportLinebreak?convertNewlines=!1:!pre&&supportLinebreak&&(convertNewlines=!0)}!1===convertNewlines&&replaceLinebreaks(tr,node,pos,mapFrom),clearIncompatible(tr,tr.mapping.slice(mapFrom).map(pos,1),type,void 0,null===convertNewlines);let mapping=tr.mapping.slice(mapFrom),startM=mapping.map(pos,1),endM=mapping.map(pos+node.nodeSize,1);return tr.step(new ReplaceAroundStep(startM,endM,startM+1,endM-1,new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(type.create(attrsHere,null,node.marks)),0,0),1,!0)),!0===convertNewlines&&replaceNewlines(tr,node,pos,mapFrom),!1}}))}(this,from,to,type,attrs),this}setNodeMarkup(pos,type,attrs=null,marks){return function setNodeMarkup(tr,pos,type,attrs,marks){let node=tr.doc.nodeAt(pos);if(!node)throw new RangeError("No node at given position");type||(type=node.type);let newNode=type.create(attrs,null,marks||node.marks);if(node.isLeaf)return tr.replaceWith(pos,pos+node.nodeSize,newNode);if(!type.validContent(node.content))throw new RangeError("Invalid content for node type "+type.name);tr.step(new ReplaceAroundStep(pos,pos+node.nodeSize,pos+1,pos+node.nodeSize-1,new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(newNode),0,0),1,!0))}(this,pos,type,attrs,marks),this}setNodeAttribute(pos,attr,value){return this.step(new AttrStep(pos,attr,value)),this}setDocAttribute(attr,value){return this.step(new DocAttrStep(attr,value)),this}addNodeMark(pos,mark){return this.step(new AddNodeMarkStep(pos,mark)),this}removeNodeMark(pos,mark){let node=this.doc.nodeAt(pos);if(!node)throw new RangeError("No node at position "+pos);if(mark instanceof prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.CU)mark.isInSet(node.marks)&&this.step(new RemoveNodeMarkStep(pos,mark));else{let found,set=node.marks,steps=[];for(;found=mark.isInSet(set);)steps.push(new RemoveNodeMarkStep(pos,found)),set=found.removeFromSet(set);for(let i=steps.length-1;i>=0;i--)this.step(steps[i])}return this}split(pos,depth=1,typesAfter){return function split(tr,pos,depth=1,typesAfter){let $pos=tr.doc.resolve(pos),before=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.empty,after=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.empty;for(let d=$pos.depth,e=$pos.depth-depth,i=depth-1;d>e;d--,i--){before=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from($pos.node(d).copy(before));let typeAfter=typesAfter&&typesAfter[i];after=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(typeAfter?typeAfter.type.create(typeAfter.attrs,after):$pos.node(d).copy(after))}tr.step(new ReplaceStep(pos,pos,new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(before.append(after),depth,depth),!0))}(this,pos,depth,typesAfter),this}addMark(from,to,mark){return function addMark(tr,from,to,mark){let removing,adding,removed=[],added=[];tr.doc.nodesBetween(from,to,((node,pos,parent)=>{if(!node.isInline)return;let marks=node.marks;if(!mark.isInSet(marks)&&parent.type.allowsMarkType(mark.type)){let start=Math.max(pos,from),end=Math.min(pos+node.nodeSize,to),newSet=mark.addToSet(marks);for(let i=0;i<marks.length;i++)marks[i].isInSet(newSet)||(removing&&removing.to==start&&removing.mark.eq(marks[i])?removing.to=end:removed.push(removing=new RemoveMarkStep(start,end,marks[i])));adding&&adding.to==start?adding.to=end:added.push(adding=new AddMarkStep(start,end,mark))}})),removed.forEach((s=>tr.step(s))),added.forEach((s=>tr.step(s)))}(this,from,to,mark),this}removeMark(from,to,mark){return function removeMark(tr,from,to,mark){let matched=[],step=0;tr.doc.nodesBetween(from,to,((node,pos)=>{if(!node.isInline)return;step++;let toRemove=null;if(mark instanceof prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.sX){let found,set=node.marks;for(;found=mark.isInSet(set);)(toRemove||(toRemove=[])).push(found),set=found.removeFromSet(set)}else mark?mark.isInSet(node.marks)&&(toRemove=[mark]):toRemove=node.marks;if(toRemove&&toRemove.length){let end=Math.min(pos+node.nodeSize,to);for(let i=0;i<toRemove.length;i++){let found,style=toRemove[i];for(let j=0;j<matched.length;j++){let m=matched[j];m.step==step-1&&style.eq(matched[j].style)&&(found=m)}found?(found.to=end,found.step=step):matched.push({style,from:Math.max(pos,from),to:end,step})}}})),matched.forEach((m=>tr.step(new RemoveMarkStep(m.from,m.to,m.style))))}(this,from,to,mark),this}clearIncompatible(pos,parentType,match){return clearIncompatible(this,pos,parentType,match),this}}},"./node_modules/prosemirror-view/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Lz:()=>EditorView,NZ:()=>Decoration,zF:()=>DecorationSet});var prosemirror_state__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/prosemirror-state/dist/index.js"),prosemirror_model__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/prosemirror-model/dist/index.js"),prosemirror_transform__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/prosemirror-transform/dist/index.js");const domIndex=function(node){for(var index=0;;index++)if(!(node=node.previousSibling))return index},parentNode=function(node){let parent=node.assignedSlot||node.parentNode;return parent&&11==parent.nodeType?parent.host:parent};let reusedRange=null;const textRange=function(node,from,to){let range=reusedRange||(reusedRange=document.createRange());return range.setEnd(node,null==to?node.nodeValue.length:to),range.setStart(node,from||0),range},isEquivalentPosition=function(node,off,targetNode,targetOff){return targetNode&&(scanFor(node,off,targetNode,targetOff,-1)||scanFor(node,off,targetNode,targetOff,1))},atomElements=/^(img|br|input|textarea|hr)$/i;function scanFor(node,off,targetNode,targetOff,dir){for(;;){if(node==targetNode&&off==targetOff)return!0;if(off==(dir<0?0:nodeSize(node))){let parent=node.parentNode;if(!parent||1!=parent.nodeType||hasBlockDesc(node)||atomElements.test(node.nodeName)||"false"==node.contentEditable)return!1;off=domIndex(node)+(dir<0?0:1),node=parent}else{if(1!=node.nodeType)return!1;if("false"==(node=node.childNodes[off+(dir<0?-1:0)]).contentEditable)return!1;off=dir<0?nodeSize(node):0}}}function nodeSize(node){return 3==node.nodeType?node.nodeValue.length:node.childNodes.length}function hasBlockDesc(dom){let desc;for(let cur=dom;cur&&!(desc=cur.pmViewDesc);cur=cur.parentNode);return desc&&desc.node&&desc.node.isBlock&&(desc.dom==dom||desc.contentDOM==dom)}const selectionCollapsed=function(domSel){return domSel.focusNode&&isEquivalentPosition(domSel.focusNode,domSel.focusOffset,domSel.anchorNode,domSel.anchorOffset)};function keyEvent(keyCode,key){let event=document.createEvent("Event");return event.initEvent("keydown",!0,!0),event.keyCode=keyCode,event.key=event.code=key,event}const nav="undefined"!=typeof navigator?navigator:null,doc="undefined"!=typeof document?document:null,agent=nav&&nav.userAgent||"",ie_edge=/Edge\/(\d+)/.exec(agent),ie_upto10=/MSIE \d/.exec(agent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(agent),ie=!!(ie_upto10||ie_11up||ie_edge),ie_version=ie_upto10?document.documentMode:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko=!ie&&/gecko\/(\d+)/i.test(agent);gecko&&(/Firefox\/(\d+)/.exec(agent)||[0,0])[1];const _chrome=!ie&&/Chrome\/(\d+)/.exec(agent),chrome=!!_chrome,chrome_version=_chrome?+_chrome[1]:0,safari=!ie&&!!nav&&/Apple Computer/.test(nav.vendor),ios=safari&&(/Mobile\/\w+/.test(agent)||!!nav&&nav.maxTouchPoints>2),mac=ios||!!nav&&/Mac/.test(nav.platform),windows=!!nav&&/Win/.test(nav.platform),android=/Android \d/.test(agent),webkit=!!doc&&"webkitFontSmoothing"in doc.documentElement.style,webkit_version=webkit?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function windowRect(doc){let vp=doc.defaultView&&doc.defaultView.visualViewport;return vp?{left:0,right:vp.width,top:0,bottom:vp.height}:{left:0,right:doc.documentElement.clientWidth,top:0,bottom:doc.documentElement.clientHeight}}function getSide(value,side){return"number"==typeof value?value:value[side]}function clientRect(node){let rect=node.getBoundingClientRect(),scaleX=rect.width/node.offsetWidth||1,scaleY=rect.height/node.offsetHeight||1;return{left:rect.left,right:rect.left+node.clientWidth*scaleX,top:rect.top,bottom:rect.top+node.clientHeight*scaleY}}function scrollRectIntoView(view,rect,startDOM){let scrollThreshold=view.someProp("scrollThreshold")||0,scrollMargin=view.someProp("scrollMargin")||5,doc=view.dom.ownerDocument;for(let parent=startDOM||view.dom;parent;){if(1!=parent.nodeType){parent=parentNode(parent);continue}let elt=parent,atTop=elt==doc.body,bounding=atTop?windowRect(doc):clientRect(elt),moveX=0,moveY=0;if(rect.top<bounding.top+getSide(scrollThreshold,"top")?moveY=-(bounding.top-rect.top+getSide(scrollMargin,"top")):rect.bottom>bounding.bottom-getSide(scrollThreshold,"bottom")&&(moveY=rect.bottom-rect.top>bounding.bottom-bounding.top?rect.top+getSide(scrollMargin,"top")-bounding.top:rect.bottom-bounding.bottom+getSide(scrollMargin,"bottom")),rect.left<bounding.left+getSide(scrollThreshold,"left")?moveX=-(bounding.left-rect.left+getSide(scrollMargin,"left")):rect.right>bounding.right-getSide(scrollThreshold,"right")&&(moveX=rect.right-bounding.right+getSide(scrollMargin,"right")),moveX||moveY)if(atTop)doc.defaultView.scrollBy(moveX,moveY);else{let startX=elt.scrollLeft,startY=elt.scrollTop;moveY&&(elt.scrollTop+=moveY),moveX&&(elt.scrollLeft+=moveX);let dX=elt.scrollLeft-startX,dY=elt.scrollTop-startY;rect={left:rect.left-dX,top:rect.top-dY,right:rect.right-dX,bottom:rect.bottom-dY}}let pos=atTop?"fixed":getComputedStyle(parent).position;if(/^(fixed|sticky)$/.test(pos))break;parent="absolute"==pos?parent.offsetParent:parentNode(parent)}}function scrollStack(dom){let stack=[],doc=dom.ownerDocument;for(let cur=dom;cur&&(stack.push({dom:cur,top:cur.scrollTop,left:cur.scrollLeft}),dom!=doc);cur=parentNode(cur));return stack}function restoreScrollStack(stack,dTop){for(let i=0;i<stack.length;i++){let{dom,top,left}=stack[i];dom.scrollTop!=top+dTop&&(dom.scrollTop=top+dTop),dom.scrollLeft!=left&&(dom.scrollLeft=left)}}let preventScrollSupported=null;function findOffsetInNode(node,coords){let closest,coordsClosest,firstBelow,coordsBelow,dxClosest=2e8,offset=0,rowBot=coords.top,rowTop=coords.top;for(let child=node.firstChild,childIndex=0;child;child=child.nextSibling,childIndex++){let rects;if(1==child.nodeType)rects=child.getClientRects();else{if(3!=child.nodeType)continue;rects=textRange(child).getClientRects()}for(let i=0;i<rects.length;i++){let rect=rects[i];if(rect.top<=rowBot&&rect.bottom>=rowTop){rowBot=Math.max(rect.bottom,rowBot),rowTop=Math.min(rect.top,rowTop);let dx=rect.left>coords.left?rect.left-coords.left:rect.right<coords.left?coords.left-rect.right:0;if(dx<dxClosest){closest=child,dxClosest=dx,coordsClosest=dx&&3==closest.nodeType?{left:rect.right<coords.left?rect.right:rect.left,top:coords.top}:coords,1==child.nodeType&&dx&&(offset=childIndex+(coords.left>=(rect.left+rect.right)/2?1:0));continue}}else rect.top>coords.top&&!firstBelow&&rect.left<=coords.left&&rect.right>=coords.left&&(firstBelow=child,coordsBelow={left:Math.max(rect.left,Math.min(rect.right,coords.left)),top:rect.top});!closest&&(coords.left>=rect.right&&coords.top>=rect.top||coords.left>=rect.left&&coords.top>=rect.bottom)&&(offset=childIndex+1)}}return!closest&&firstBelow&&(closest=firstBelow,coordsClosest=coordsBelow,dxClosest=0),closest&&3==closest.nodeType?function findOffsetInText(node,coords){let len=node.nodeValue.length,range=document.createRange();for(let i=0;i<len;i++){range.setEnd(node,i+1),range.setStart(node,i);let rect=singleRect(range,1);if(rect.top!=rect.bottom&&inRect(coords,rect))return{node,offset:i+(coords.left>=(rect.left+rect.right)/2?1:0)}}return{node,offset:0}}(closest,coordsClosest):!closest||dxClosest&&1==closest.nodeType?{node,offset}:findOffsetInNode(closest,coordsClosest)}function inRect(coords,rect){return coords.left>=rect.left-1&&coords.left<=rect.right+1&&coords.top>=rect.top-1&&coords.top<=rect.bottom+1}function elementFromPoint(element,coords,box){let len=element.childNodes.length;if(len&&box.top<box.bottom)for(let startI=Math.max(0,Math.min(len-1,Math.floor(len*(coords.top-box.top)/(box.bottom-box.top))-2)),i=startI;;){let child=element.childNodes[i];if(1==child.nodeType){let rects=child.getClientRects();for(let j=0;j<rects.length;j++){let rect=rects[j];if(inRect(coords,rect))return elementFromPoint(child,coords,rect)}}if((i=(i+1)%len)==startI)break}return element}function posAtCoords(view,coords){let node,doc=view.dom.ownerDocument,offset=0,caret=function caretFromPoint(doc,x,y){if(doc.caretPositionFromPoint)try{let pos=doc.caretPositionFromPoint(x,y);if(pos)return{node:pos.offsetNode,offset:Math.min(nodeSize(pos.offsetNode),pos.offset)}}catch(_){}if(doc.caretRangeFromPoint){let range=doc.caretRangeFromPoint(x,y);if(range)return{node:range.startContainer,offset:Math.min(nodeSize(range.startContainer),range.startOffset)}}}(doc,coords.left,coords.top);caret&&({node,offset}=caret);let pos,elt=(view.root.elementFromPoint?view.root:doc).elementFromPoint(coords.left,coords.top);if(!elt||!view.dom.contains(1!=elt.nodeType?elt.parentNode:elt)){let box=view.dom.getBoundingClientRect();if(!inRect(coords,box))return null;if(elt=elementFromPoint(view.dom,coords,box),!elt)return null}if(safari)for(let p=elt;node&&p;p=parentNode(p))p.draggable&&(node=void 0);if(elt=function targetKludge(dom,coords){let parent=dom.parentNode;return parent&&/^li$/i.test(parent.nodeName)&&coords.left<dom.getBoundingClientRect().left?parent:dom}(elt,coords),node){if(gecko&&1==node.nodeType&&(offset=Math.min(offset,node.childNodes.length),offset<node.childNodes.length)){let box,next=node.childNodes[offset];"IMG"==next.nodeName&&(box=next.getBoundingClientRect()).right<=coords.left&&box.bottom>coords.top&&offset++}let prev;webkit&&offset&&1==node.nodeType&&1==(prev=node.childNodes[offset-1]).nodeType&&"false"==prev.contentEditable&&prev.getBoundingClientRect().top>=coords.top&&offset--,node==view.dom&&offset==node.childNodes.length-1&&1==node.lastChild.nodeType&&coords.top>node.lastChild.getBoundingClientRect().bottom?pos=view.state.doc.content.size:0!=offset&&1==node.nodeType&&"BR"==node.childNodes[offset-1].nodeName||(pos=function posFromCaret(view,node,offset,coords){let outsideBlock=-1;for(let cur=node,sawBlock=!1;cur!=view.dom;){let rect,desc=view.docView.nearestDesc(cur,!0);if(!desc)return null;if(1==desc.dom.nodeType&&(desc.node.isBlock&&desc.parent||!desc.contentDOM)&&((rect=desc.dom.getBoundingClientRect()).width||rect.height)&&(desc.node.isBlock&&desc.parent&&(!sawBlock&&rect.left>coords.left||rect.top>coords.top?outsideBlock=desc.posBefore:(!sawBlock&&rect.right<coords.left||rect.bottom<coords.top)&&(outsideBlock=desc.posAfter),sawBlock=!0),!desc.contentDOM&&outsideBlock<0&&!desc.node.isText))return(desc.node.isBlock?coords.top<(rect.top+rect.bottom)/2:coords.left<(rect.left+rect.right)/2)?desc.posBefore:desc.posAfter;cur=desc.dom.parentNode}return outsideBlock>-1?outsideBlock:view.docView.posFromDOM(node,offset,-1)}(view,node,offset,coords))}null==pos&&(pos=function posFromElement(view,elt,coords){let{node,offset}=findOffsetInNode(elt,coords),bias=-1;if(1==node.nodeType&&!node.firstChild){let rect=node.getBoundingClientRect();bias=rect.left!=rect.right&&coords.left>(rect.left+rect.right)/2?1:-1}return view.docView.posFromDOM(node,offset,bias)}(view,elt,coords));let desc=view.docView.nearestDesc(elt,!0);return{pos,inside:desc?desc.posAtStart-desc.border:-1}}function nonZero(rect){return rect.top<rect.bottom||rect.left<rect.right}function singleRect(target,bias){let rects=target.getClientRects();if(rects.length){let first=rects[bias<0?0:rects.length-1];if(nonZero(first))return first}return Array.prototype.find.call(rects,nonZero)||target.getBoundingClientRect()}const BIDI=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function coordsAtPos(view,pos,side){let{node,offset,atom}=view.docView.domFromPos(pos,side<0?-1:1),supportEmptyRange=webkit||gecko;if(3==node.nodeType){if(!supportEmptyRange||!BIDI.test(node.nodeValue)&&(side<0?offset:offset!=node.nodeValue.length)){let from=offset,to=offset,takeSide=side<0?1:-1;return side<0&&!offset?(to++,takeSide=-1):side>=0&&offset==node.nodeValue.length?(from--,takeSide=1):side<0?from--:to++,flattenV(singleRect(textRange(node,from,to),takeSide),takeSide<0)}{let rect=singleRect(textRange(node,offset,offset),side);if(gecko&&offset&&/\s/.test(node.nodeValue[offset-1])&&offset<node.nodeValue.length){let rectBefore=singleRect(textRange(node,offset-1,offset-1),-1);if(rectBefore.top==rect.top){let rectAfter=singleRect(textRange(node,offset,offset+1),-1);if(rectAfter.top!=rect.top)return flattenV(rectAfter,rectAfter.left<rectBefore.left)}}return rect}}if(!view.state.doc.resolve(pos-(atom||0)).parent.inlineContent){if(null==atom&&offset&&(side<0||offset==nodeSize(node))){let before=node.childNodes[offset-1];if(1==before.nodeType)return flattenH(before.getBoundingClientRect(),!1)}if(null==atom&&offset<nodeSize(node)){let after=node.childNodes[offset];if(1==after.nodeType)return flattenH(after.getBoundingClientRect(),!0)}return flattenH(node.getBoundingClientRect(),side>=0)}if(null==atom&&offset&&(side<0||offset==nodeSize(node))){let before=node.childNodes[offset-1],target=3==before.nodeType?textRange(before,nodeSize(before)-(supportEmptyRange?0:1)):1!=before.nodeType||"BR"==before.nodeName&&before.nextSibling?null:before;if(target)return flattenV(singleRect(target,1),!1)}if(null==atom&&offset<nodeSize(node)){let after=node.childNodes[offset];for(;after.pmViewDesc&&after.pmViewDesc.ignoreForCoords;)after=after.nextSibling;let target=after?3==after.nodeType?textRange(after,0,supportEmptyRange?0:1):1==after.nodeType?after:null:null;if(target)return flattenV(singleRect(target,-1),!0)}return flattenV(singleRect(3==node.nodeType?textRange(node):node,-side),side>=0)}function flattenV(rect,left){if(0==rect.width)return rect;let x=left?rect.left:rect.right;return{top:rect.top,bottom:rect.bottom,left:x,right:x}}function flattenH(rect,top){if(0==rect.height)return rect;let y=top?rect.top:rect.bottom;return{top:y,bottom:y,left:rect.left,right:rect.right}}function withFlushedState(view,state,f){let viewState=view.state,active=view.root.activeElement;viewState!=state&&view.updateState(state),active!=view.dom&&view.focus();try{return f()}finally{viewState!=state&&view.updateState(viewState),active!=view.dom&&active&&active.focus()}}const maybeRTL=/[\u0590-\u08ac]/;let cachedState=null,cachedDir=null,cachedResult=!1;function endOfTextblock(view,state,dir){return cachedState==state&&cachedDir==dir?cachedResult:(cachedState=state,cachedDir=dir,cachedResult="up"==dir||"down"==dir?function endOfTextblockVertical(view,state,dir){let sel=state.selection,$pos="up"==dir?sel.$from:sel.$to;return withFlushedState(view,state,(()=>{let{node:dom}=view.docView.domFromPos($pos.pos,"up"==dir?-1:1);for(;;){let nearest=view.docView.nearestDesc(dom,!0);if(!nearest)break;if(nearest.node.isBlock){dom=nearest.contentDOM||nearest.dom;break}dom=nearest.dom.parentNode}let coords=coordsAtPos(view,$pos.pos,1);for(let child=dom.firstChild;child;child=child.nextSibling){let boxes;if(1==child.nodeType)boxes=child.getClientRects();else{if(3!=child.nodeType)continue;boxes=textRange(child,0,child.nodeValue.length).getClientRects()}for(let i=0;i<boxes.length;i++){let box=boxes[i];if(box.bottom>box.top+1&&("up"==dir?coords.top-box.top>2*(box.bottom-coords.top):box.bottom-coords.bottom>2*(coords.bottom-box.top)))return!1}}return!0}))}(view,state,dir):function endOfTextblockHorizontal(view,state,dir){let{$head}=state.selection;if(!$head.parent.isTextblock)return!1;let offset=$head.parentOffset,atStart=!offset,atEnd=offset==$head.parent.content.size,sel=view.domSelection();return sel?maybeRTL.test($head.parent.textContent)&&sel.modify?withFlushedState(view,state,(()=>{let{focusNode:oldNode,focusOffset:oldOff,anchorNode,anchorOffset}=view.domSelectionRange(),oldBidiLevel=sel.caretBidiLevel;sel.modify("move",dir,"character");let parentDOM=$head.depth?view.docView.domAfterPos($head.before()):view.dom,{focusNode:newNode,focusOffset:newOff}=view.domSelectionRange(),result=newNode&&!parentDOM.contains(1==newNode.nodeType?newNode:newNode.parentNode)||oldNode==newNode&&oldOff==newOff;try{sel.collapse(anchorNode,anchorOffset),oldNode&&(oldNode!=anchorNode||oldOff!=anchorOffset)&&sel.extend&&sel.extend(oldNode,oldOff)}catch(_){}return null!=oldBidiLevel&&(sel.caretBidiLevel=oldBidiLevel),result})):"left"==dir||"backward"==dir?atStart:atEnd:$head.pos==$head.start()||$head.pos==$head.end()}(view,state,dir))}class ViewDesc{constructor(parent,children,dom,contentDOM){this.parent=parent,this.children=children,this.dom=dom,this.contentDOM=contentDOM,this.dirty=0,dom.pmViewDesc=this}matchesWidget(widget){return!1}matchesMark(mark){return!1}matchesNode(node,outerDeco,innerDeco){return!1}matchesHack(nodeName){return!1}parseRule(){return null}stopEvent(event){return!1}get size(){let size=0;for(let i=0;i<this.children.length;i++)size+=this.children[i].size;return size}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let i=0;i<this.children.length;i++)this.children[i].destroy()}posBeforeChild(child){for(let i=0,pos=this.posAtStart;;i++){let cur=this.children[i];if(cur==child)return pos;pos+=cur.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(dom,offset,bias){if(this.contentDOM&&this.contentDOM.contains(1==dom.nodeType?dom:dom.parentNode)){if(bias<0){let domBefore,desc;if(dom==this.contentDOM)domBefore=dom.childNodes[offset-1];else{for(;dom.parentNode!=this.contentDOM;)dom=dom.parentNode;domBefore=dom.previousSibling}for(;domBefore&&(!(desc=domBefore.pmViewDesc)||desc.parent!=this);)domBefore=domBefore.previousSibling;return domBefore?this.posBeforeChild(desc)+desc.size:this.posAtStart}{let domAfter,desc;if(dom==this.contentDOM)domAfter=dom.childNodes[offset];else{for(;dom.parentNode!=this.contentDOM;)dom=dom.parentNode;domAfter=dom.nextSibling}for(;domAfter&&(!(desc=domAfter.pmViewDesc)||desc.parent!=this);)domAfter=domAfter.nextSibling;return domAfter?this.posBeforeChild(desc):this.posAtEnd}}let atEnd;if(dom==this.dom&&this.contentDOM)atEnd=offset>domIndex(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))atEnd=2&dom.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==offset)for(let search=dom;;search=search.parentNode){if(search==this.dom){atEnd=!1;break}if(search.previousSibling)break}if(null==atEnd&&offset==dom.childNodes.length)for(let search=dom;;search=search.parentNode){if(search==this.dom){atEnd=!0;break}if(search.nextSibling)break}}return(null==atEnd?bias>0:atEnd)?this.posAtEnd:this.posAtStart}nearestDesc(dom,onlyNodes=!1){for(let first=!0,cur=dom;cur;cur=cur.parentNode){let nodeDOM,desc=this.getDesc(cur);if(desc&&(!onlyNodes||desc.node)){if(!first||!(nodeDOM=desc.nodeDOM)||(1==nodeDOM.nodeType?nodeDOM.contains(1==dom.nodeType?dom:dom.parentNode):nodeDOM==dom))return desc;first=!1}}}getDesc(dom){let desc=dom.pmViewDesc;for(let cur=desc;cur;cur=cur.parent)if(cur==this)return desc}posFromDOM(dom,offset,bias){for(let scan=dom;scan;scan=scan.parentNode){let desc=this.getDesc(scan);if(desc)return desc.localPosFromDOM(dom,offset,bias)}return-1}descAt(pos){for(let i=0,offset=0;i<this.children.length;i++){let child=this.children[i],end=offset+child.size;if(offset==pos&&end!=offset){for(;!child.border&&child.children.length;)for(let i=0;i<child.children.length;i++){let inner=child.children[i];if(inner.size){child=inner;break}}return child}if(pos<end)return child.descAt(pos-offset-child.border);offset=end}}domFromPos(pos,side){if(!this.contentDOM)return{node:this.dom,offset:0,atom:pos+1};let i=0,offset=0;for(let curPos=0;i<this.children.length;i++){let child=this.children[i],end=curPos+child.size;if(end>pos||child instanceof TrailingHackViewDesc){offset=pos-curPos;break}curPos=end}if(offset)return this.children[i].domFromPos(offset-this.children[i].border,side);for(let prev;i&&!(prev=this.children[i-1]).size&&prev instanceof WidgetViewDesc&&prev.side>=0;i--);if(side<=0){let prev,enter=!0;for(;prev=i?this.children[i-1]:null,prev&&prev.dom.parentNode!=this.contentDOM;i--,enter=!1);return prev&&side&&enter&&!prev.border&&!prev.domAtom?prev.domFromPos(prev.size,side):{node:this.contentDOM,offset:prev?domIndex(prev.dom)+1:0}}{let next,enter=!0;for(;next=i<this.children.length?this.children[i]:null,next&&next.dom.parentNode!=this.contentDOM;i++,enter=!1);return next&&enter&&!next.border&&!next.domAtom?next.domFromPos(0,side):{node:this.contentDOM,offset:next?domIndex(next.dom):this.contentDOM.childNodes.length}}}parseRange(from,to,base=0){if(0==this.children.length)return{node:this.contentDOM,from,to,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let fromOffset=-1,toOffset=-1;for(let offset=base,i=0;;i++){let child=this.children[i],end=offset+child.size;if(-1==fromOffset&&from<=end){let childBase=offset+child.border;if(from>=childBase&&to<=end-child.border&&child.node&&child.contentDOM&&this.contentDOM.contains(child.contentDOM))return child.parseRange(from,to,childBase);from=offset;for(let j=i;j>0;j--){let prev=this.children[j-1];if(prev.size&&prev.dom.parentNode==this.contentDOM&&!prev.emptyChildAt(1)){fromOffset=domIndex(prev.dom)+1;break}from-=prev.size}-1==fromOffset&&(fromOffset=0)}if(fromOffset>-1&&(end>to||i==this.children.length-1)){to=end;for(let j=i+1;j<this.children.length;j++){let next=this.children[j];if(next.size&&next.dom.parentNode==this.contentDOM&&!next.emptyChildAt(-1)){toOffset=domIndex(next.dom);break}to+=next.size}-1==toOffset&&(toOffset=this.contentDOM.childNodes.length);break}offset=end}return{node:this.contentDOM,from,to,fromOffset,toOffset}}emptyChildAt(side){if(this.border||!this.contentDOM||!this.children.length)return!1;let child=this.children[side<0?0:this.children.length-1];return 0==child.size||child.emptyChildAt(side)}domAfterPos(pos){let{node,offset}=this.domFromPos(pos,0);if(1!=node.nodeType||offset==node.childNodes.length)throw new RangeError("No node after pos "+pos);return node.childNodes[offset]}setSelection(anchor,head,view,force=!1){let from=Math.min(anchor,head),to=Math.max(anchor,head);for(let i=0,offset=0;i<this.children.length;i++){let child=this.children[i],end=offset+child.size;if(from>offset&&to<end)return child.setSelection(anchor-offset-child.border,head-offset-child.border,view,force);offset=end}let anchorDOM=this.domFromPos(anchor,anchor?-1:1),headDOM=head==anchor?anchorDOM:this.domFromPos(head,head?-1:1),domSel=view.root.getSelection(),selRange=view.domSelectionRange(),brKludge=!1;if((gecko||safari)&&anchor==head){let{node,offset}=anchorDOM;if(3==node.nodeType){if(brKludge=!(!offset||"\n"!=node.nodeValue[offset-1]),brKludge&&offset==node.nodeValue.length)for(let after,scan=node;scan;scan=scan.parentNode){if(after=scan.nextSibling){"BR"==after.nodeName&&(anchorDOM=headDOM={node:after.parentNode,offset:domIndex(after)+1});break}let desc=scan.pmViewDesc;if(desc&&desc.node&&desc.node.isBlock)break}}else{let prev=node.childNodes[offset-1];brKludge=prev&&("BR"==prev.nodeName||"false"==prev.contentEditable)}}if(gecko&&selRange.focusNode&&selRange.focusNode!=headDOM.node&&1==selRange.focusNode.nodeType){let after=selRange.focusNode.childNodes[selRange.focusOffset];after&&"false"==after.contentEditable&&(force=!0)}if(!(force||brKludge&&safari)&&isEquivalentPosition(anchorDOM.node,anchorDOM.offset,selRange.anchorNode,selRange.anchorOffset)&&isEquivalentPosition(headDOM.node,headDOM.offset,selRange.focusNode,selRange.focusOffset))return;let domSelExtended=!1;if((domSel.extend||anchor==head)&&!brKludge){domSel.collapse(anchorDOM.node,anchorDOM.offset);try{anchor!=head&&domSel.extend(headDOM.node,headDOM.offset),domSelExtended=!0}catch(_){}}if(!domSelExtended){if(anchor>head){let tmp=anchorDOM;anchorDOM=headDOM,headDOM=tmp}let range=document.createRange();range.setEnd(headDOM.node,headDOM.offset),range.setStart(anchorDOM.node,anchorDOM.offset),domSel.removeAllRanges(),domSel.addRange(range)}}ignoreMutation(mutation){return!this.contentDOM&&"selection"!=mutation.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(from,to){for(let offset=0,i=0;i<this.children.length;i++){let child=this.children[i],end=offset+child.size;if(offset==end?from<=end&&to>=offset:from<end&&to>offset){let startInside=offset+child.border,endInside=end-child.border;if(from>=startInside&&to<=endInside)return this.dirty=from==offset||to==end?2:1,void(from!=startInside||to!=endInside||!child.contentLost&&child.dom.parentNode==this.contentDOM?child.markDirty(from-startInside,to-startInside):child.dirty=3);child.dirty=child.dom!=child.contentDOM||child.dom.parentNode!=this.contentDOM||child.children.length?3:2}offset=end}this.dirty=2}markParentsDirty(){let level=1;for(let node=this.parent;node;node=node.parent,level++){let dirty=1==level?2:1;node.dirty<dirty&&(node.dirty=dirty)}}get domAtom(){return!1}get ignoreForCoords(){return!1}isText(text){return!1}}class WidgetViewDesc extends ViewDesc{constructor(parent,widget,view,pos){let self,dom=widget.type.toDOM;if("function"==typeof dom&&(dom=dom(view,(()=>self?self.parent?self.parent.posBeforeChild(self):void 0:pos))),!widget.type.spec.raw){if(1!=dom.nodeType){let wrap=document.createElement("span");wrap.appendChild(dom),dom=wrap}dom.contentEditable="false",dom.classList.add("ProseMirror-widget")}super(parent,[],dom,null),this.widget=widget,this.widget=widget,self=this}matchesWidget(widget){return 0==this.dirty&&widget.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(event){let stop=this.widget.spec.stopEvent;return!!stop&&stop(event)}ignoreMutation(mutation){return"selection"!=mutation.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class CompositionViewDesc extends ViewDesc{constructor(parent,dom,textDOM,text){super(parent,[],dom,null),this.textDOM=textDOM,this.text=text}get size(){return this.text.length}localPosFromDOM(dom,offset){return dom!=this.textDOM?this.posAtStart+(offset?this.size:0):this.posAtStart+offset}domFromPos(pos){return{node:this.textDOM,offset:pos}}ignoreMutation(mut){return"characterData"===mut.type&&mut.target.nodeValue==mut.oldValue}}class MarkViewDesc extends ViewDesc{constructor(parent,mark,dom,contentDOM,spec){super(parent,[],dom,contentDOM),this.mark=mark,this.spec=spec}static create(parent,mark,inline,view){let custom=view.nodeViews[mark.type.name],spec=custom&&custom(mark,view,inline);return spec&&spec.dom||(spec=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.ZF.renderSpec(document,mark.type.spec.toDOM(mark,inline),null,mark.attrs)),new MarkViewDesc(parent,mark,spec.dom,spec.contentDOM||spec.dom,spec)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(mark){return 3!=this.dirty&&this.mark.eq(mark)}markDirty(from,to){if(super.markDirty(from,to),0!=this.dirty){let parent=this.parent;for(;!parent.node;)parent=parent.parent;parent.dirty<this.dirty&&(parent.dirty=this.dirty),this.dirty=0}}slice(from,to,view){let copy=MarkViewDesc.create(this.parent,this.mark,!0,view),nodes=this.children,size=this.size;to<size&&(nodes=replaceNodes(nodes,to,size,view)),from>0&&(nodes=replaceNodes(nodes,0,from,view));for(let i=0;i<nodes.length;i++)nodes[i].parent=copy;return copy.children=nodes,copy}ignoreMutation(mutation){return this.spec.ignoreMutation?this.spec.ignoreMutation(mutation):super.ignoreMutation(mutation)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class NodeViewDesc extends ViewDesc{constructor(parent,node,outerDeco,innerDeco,dom,contentDOM,nodeDOM,view,pos){super(parent,[],dom,contentDOM),this.node=node,this.outerDeco=outerDeco,this.innerDeco=innerDeco,this.nodeDOM=nodeDOM}static create(parent,node,outerDeco,innerDeco,view,pos){let descObj,custom=view.nodeViews[node.type.name],spec=custom&&custom(node,view,(()=>descObj?descObj.parent?descObj.parent.posBeforeChild(descObj):void 0:pos),outerDeco,innerDeco),dom=spec&&spec.dom,contentDOM=spec&&spec.contentDOM;if(node.isText)if(dom){if(3!=dom.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else dom=document.createTextNode(node.text);else if(!dom){let spec=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.ZF.renderSpec(document,node.type.spec.toDOM(node),null,node.attrs);({dom,contentDOM}=spec)}contentDOM||node.isText||"BR"==dom.nodeName||(dom.hasAttribute("contenteditable")||(dom.contentEditable="false"),node.type.spec.draggable&&(dom.draggable=!0));let nodeDOM=dom;return dom=applyOuterDeco(dom,outerDeco,node),spec?descObj=new CustomNodeViewDesc(parent,node,outerDeco,innerDeco,dom,contentDOM||null,nodeDOM,spec,view,pos+1):node.isText?new TextViewDesc(parent,node,outerDeco,innerDeco,dom,nodeDOM,view):new NodeViewDesc(parent,node,outerDeco,innerDeco,dom,contentDOM||null,nodeDOM,view,pos+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let rule={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(rule.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let i=this.children.length-1;i>=0;i--){let child=this.children[i];if(this.dom.contains(child.dom.parentNode)){rule.contentElement=child.dom.parentNode;break}}rule.contentElement||(rule.getContent=()=>prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.empty)}else rule.contentElement=this.contentDOM;else rule.getContent=()=>this.node.content;return rule}matchesNode(node,outerDeco,innerDeco){return 0==this.dirty&&node.eq(this.node)&&sameOuterDeco(outerDeco,this.outerDeco)&&innerDeco.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(view,pos){let inline=this.node.inlineContent,off=pos,composition=view.composing?this.localCompositionInfo(view,pos):null,localComposition=composition&&composition.pos>-1?composition:null,compositionInChild=composition&&composition.pos<0,updater=new ViewTreeUpdater(this,localComposition&&localComposition.node,view);!function iterDeco(parent,deco,onWidget,onNode){let locals=deco.locals(parent),offset=0;if(0==locals.length){for(let i=0;i<parent.childCount;i++){let child=parent.child(i);onNode(child,locals,deco.forChild(offset,child),i),offset+=child.nodeSize}return}let decoIndex=0,active=[],restNode=null;for(let parentIndex=0;;){let widget,widgets,child,index;for(;decoIndex<locals.length&&locals[decoIndex].to==offset;){let next=locals[decoIndex++];next.widget&&(widget?(widgets||(widgets=[widget])).push(next):widget=next)}if(widget)if(widgets){widgets.sort(compareSide);for(let i=0;i<widgets.length;i++)onWidget(widgets[i],parentIndex,!!restNode)}else onWidget(widget,parentIndex,!!restNode);if(restNode)index=-1,child=restNode,restNode=null;else{if(!(parentIndex<parent.childCount))break;index=parentIndex,child=parent.child(parentIndex++)}for(let i=0;i<active.length;i++)active[i].to<=offset&&active.splice(i--,1);for(;decoIndex<locals.length&&locals[decoIndex].from<=offset&&locals[decoIndex].to>offset;)active.push(locals[decoIndex++]);let end=offset+child.nodeSize;if(child.isText){let cutAt=end;decoIndex<locals.length&&locals[decoIndex].from<cutAt&&(cutAt=locals[decoIndex].from);for(let i=0;i<active.length;i++)active[i].to<cutAt&&(cutAt=active[i].to);cutAt<end&&(restNode=child.cut(cutAt-offset),child=child.cut(0,cutAt-offset),end=cutAt,index=-1)}else for(;decoIndex<locals.length&&locals[decoIndex].to<end;)decoIndex++;onNode(child,child.isInline&&!child.isLeaf?active.filter((d=>!d.inline)):active.slice(),deco.forChild(offset,child),index),offset=end}}(this.node,this.innerDeco,((widget,i,insideNode)=>{widget.spec.marks?updater.syncToMarks(widget.spec.marks,inline,view):widget.type.side>=0&&!insideNode&&updater.syncToMarks(i==this.node.childCount?prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.CU.none:this.node.child(i).marks,inline,view),updater.placeWidget(widget,view,off)}),((child,outerDeco,innerDeco,i)=>{let compIndex;updater.syncToMarks(child.marks,inline,view),updater.findNodeMatch(child,outerDeco,innerDeco,i)||compositionInChild&&view.state.selection.from>off&&view.state.selection.to<off+child.nodeSize&&(compIndex=updater.findIndexWithChild(composition.node))>-1&&updater.updateNodeAt(child,outerDeco,innerDeco,compIndex,view)||updater.updateNextNode(child,outerDeco,innerDeco,view,i,off)||updater.addNode(child,outerDeco,innerDeco,view,off),off+=child.nodeSize})),updater.syncToMarks([],inline,view),this.node.isTextblock&&updater.addTextblockHacks(),updater.destroyRest(),(updater.changed||2==this.dirty)&&(localComposition&&this.protectLocalComposition(view,localComposition),renderDescs(this.contentDOM,this.children,view),ios&&function iosHacks(dom){if("UL"==dom.nodeName||"OL"==dom.nodeName){let oldCSS=dom.style.cssText;dom.style.cssText=oldCSS+"; list-style: square !important",window.getComputedStyle(dom).listStyle,dom.style.cssText=oldCSS}}(this.dom))}localCompositionInfo(view,pos){let{from,to}=view.state.selection;if(!(view.state.selection instanceof prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.U3)||from<pos||to>pos+this.node.content.size)return null;let textNode=view.input.compositionNode;if(!textNode||!this.dom.contains(textNode.parentNode))return null;if(this.node.inlineContent){let text=textNode.nodeValue,textPos=function findTextInFragment(frag,text,from,to){for(let i=0,pos=0;i<frag.childCount&&pos<=to;){let child=frag.child(i++),childStart=pos;if(pos+=child.nodeSize,!child.isText)continue;let str=child.text;for(;i<frag.childCount;){let next=frag.child(i++);if(pos+=next.nodeSize,!next.isText)break;str+=next.text}if(pos>=from){if(pos>=to&&str.slice(to-text.length-childStart,to-childStart)==text)return to-text.length;let found=childStart<to?str.lastIndexOf(text,to-childStart-1):-1;if(found>=0&&found+text.length+childStart>=from)return childStart+found;if(from==to&&str.length>=to+text.length-childStart&&str.slice(to-childStart,to-childStart+text.length)==text)return to}}return-1}(this.node.content,text,from-pos,to-pos);return textPos<0?null:{node:textNode,pos:textPos,text}}return{node:textNode,pos:-1,text:""}}protectLocalComposition(view,{node,pos,text}){if(this.getDesc(node))return;let topNode=node;for(;topNode.parentNode!=this.contentDOM;topNode=topNode.parentNode){for(;topNode.previousSibling;)topNode.parentNode.removeChild(topNode.previousSibling);for(;topNode.nextSibling;)topNode.parentNode.removeChild(topNode.nextSibling);topNode.pmViewDesc&&(topNode.pmViewDesc=void 0)}let desc=new CompositionViewDesc(this,topNode,node,text);view.input.compositionNodes.push(desc),this.children=replaceNodes(this.children,pos,pos+text.length,view,desc)}update(node,outerDeco,innerDeco,view){return!(3==this.dirty||!node.sameMarkup(this.node))&&(this.updateInner(node,outerDeco,innerDeco,view),!0)}updateInner(node,outerDeco,innerDeco,view){this.updateOuterDeco(outerDeco),this.node=node,this.innerDeco=innerDeco,this.contentDOM&&this.updateChildren(view,this.posAtStart),this.dirty=0}updateOuterDeco(outerDeco){if(sameOuterDeco(outerDeco,this.outerDeco))return;let needsWrap=1!=this.nodeDOM.nodeType,oldDOM=this.dom;this.dom=patchOuterDeco(this.dom,this.nodeDOM,computeOuterDeco(this.outerDeco,this.node,needsWrap),computeOuterDeco(outerDeco,this.node,needsWrap)),this.dom!=oldDOM&&(oldDOM.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=outerDeco}selectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.dom.draggable=!0)}deselectNode(){1==this.nodeDOM.nodeType&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function docViewDesc(doc,outerDeco,innerDeco,dom,view){applyOuterDeco(dom,outerDeco,doc);let docView=new NodeViewDesc(void 0,doc,outerDeco,innerDeco,dom,dom,dom,view,0);return docView.contentDOM&&docView.updateChildren(view,0),docView}class TextViewDesc extends NodeViewDesc{constructor(parent,node,outerDeco,innerDeco,dom,nodeDOM,view){super(parent,node,outerDeco,innerDeco,dom,null,nodeDOM,view,0)}parseRule(){let skip=this.nodeDOM.parentNode;for(;skip&&skip!=this.dom&&!skip.pmIsDeco;)skip=skip.parentNode;return{skip:skip||!0}}update(node,outerDeco,innerDeco,view){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!node.sameMarkup(this.node))&&(this.updateOuterDeco(outerDeco),0==this.dirty&&node.text==this.node.text||node.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=node.text,view.trackWrites==this.nodeDOM&&(view.trackWrites=null)),this.node=node,this.dirty=0,!0)}inParent(){let parentDOM=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==parentDOM)return!0;return!1}domFromPos(pos){return{node:this.nodeDOM,offset:pos}}localPosFromDOM(dom,offset,bias){return dom==this.nodeDOM?this.posAtStart+Math.min(offset,this.node.text.length):super.localPosFromDOM(dom,offset,bias)}ignoreMutation(mutation){return"characterData"!=mutation.type&&"selection"!=mutation.type}slice(from,to,view){let node=this.node.cut(from,to),dom=document.createTextNode(node.text);return new TextViewDesc(this.parent,node,this.outerDeco,this.innerDeco,dom,dom,view)}markDirty(from,to){super.markDirty(from,to),this.dom==this.nodeDOM||0!=from&&to!=this.nodeDOM.nodeValue.length||(this.dirty=3)}get domAtom(){return!1}isText(text){return this.node.text==text}}class TrailingHackViewDesc extends ViewDesc{parseRule(){return{ignore:!0}}matchesHack(nodeName){return 0==this.dirty&&this.dom.nodeName==nodeName}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class CustomNodeViewDesc extends NodeViewDesc{constructor(parent,node,outerDeco,innerDeco,dom,contentDOM,nodeDOM,spec,view,pos){super(parent,node,outerDeco,innerDeco,dom,contentDOM,nodeDOM,view,pos),this.spec=spec}update(node,outerDeco,innerDeco,view){if(3==this.dirty)return!1;if(this.spec.update&&(this.node.type==node.type||this.spec.multiType)){let result=this.spec.update(node,outerDeco,innerDeco);return result&&this.updateInner(node,outerDeco,innerDeco,view),result}return!(!this.contentDOM&&!node.isLeaf)&&super.update(node,outerDeco,innerDeco,view)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(anchor,head,view,force){this.spec.setSelection?this.spec.setSelection(anchor,head,view.root):super.setSelection(anchor,head,view,force)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(event){return!!this.spec.stopEvent&&this.spec.stopEvent(event)}ignoreMutation(mutation){return this.spec.ignoreMutation?this.spec.ignoreMutation(mutation):super.ignoreMutation(mutation)}}function renderDescs(parentDOM,descs,view){let dom=parentDOM.firstChild,written=!1;for(let i=0;i<descs.length;i++){let desc=descs[i],childDOM=desc.dom;if(childDOM.parentNode==parentDOM){for(;childDOM!=dom;)dom=rm(dom),written=!0;dom=dom.nextSibling}else written=!0,parentDOM.insertBefore(childDOM,dom);if(desc instanceof MarkViewDesc){let pos=dom?dom.previousSibling:parentDOM.lastChild;renderDescs(desc.contentDOM,desc.children,view),dom=pos?pos.nextSibling:parentDOM.firstChild}}for(;dom;)dom=rm(dom),written=!0;written&&view.trackWrites==parentDOM&&(view.trackWrites=null)}const OuterDecoLevel=function(nodeName){nodeName&&(this.nodeName=nodeName)};OuterDecoLevel.prototype=Object.create(null);const noDeco=[new OuterDecoLevel];function computeOuterDeco(outerDeco,node,needsWrap){if(0==outerDeco.length)return noDeco;let top=needsWrap?noDeco[0]:new OuterDecoLevel,result=[top];for(let i=0;i<outerDeco.length;i++){let attrs=outerDeco[i].type.attrs;if(attrs){attrs.nodeName&&result.push(top=new OuterDecoLevel(attrs.nodeName));for(let name in attrs){let val=attrs[name];null!=val&&(needsWrap&&1==result.length&&result.push(top=new OuterDecoLevel(node.isInline?"span":"div")),"class"==name?top.class=(top.class?top.class+" ":"")+val:"style"==name?top.style=(top.style?top.style+";":"")+val:"nodeName"!=name&&(top[name]=val))}}}return result}function patchOuterDeco(outerDOM,nodeDOM,prevComputed,curComputed){if(prevComputed==noDeco&&curComputed==noDeco)return nodeDOM;let curDOM=nodeDOM;for(let i=0;i<curComputed.length;i++){let deco=curComputed[i],prev=prevComputed[i];if(i){let parent;prev&&prev.nodeName==deco.nodeName&&curDOM!=outerDOM&&(parent=curDOM.parentNode)&&parent.nodeName.toLowerCase()==deco.nodeName||(parent=document.createElement(deco.nodeName),parent.pmIsDeco=!0,parent.appendChild(curDOM),prev=noDeco[0]),curDOM=parent}patchAttributes(curDOM,prev||noDeco[0],deco)}return curDOM}function patchAttributes(dom,prev,cur){for(let name in prev)"class"==name||"style"==name||"nodeName"==name||name in cur||dom.removeAttribute(name);for(let name in cur)"class"!=name&&"style"!=name&&"nodeName"!=name&&cur[name]!=prev[name]&&dom.setAttribute(name,cur[name]);if(prev.class!=cur.class){let prevList=prev.class?prev.class.split(" ").filter(Boolean):[],curList=cur.class?cur.class.split(" ").filter(Boolean):[];for(let i=0;i<prevList.length;i++)-1==curList.indexOf(prevList[i])&&dom.classList.remove(prevList[i]);for(let i=0;i<curList.length;i++)-1==prevList.indexOf(curList[i])&&dom.classList.add(curList[i]);0==dom.classList.length&&dom.removeAttribute("class")}if(prev.style!=cur.style){if(prev.style){let m,prop=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;for(;m=prop.exec(prev.style);)dom.style.removeProperty(m[1])}cur.style&&(dom.style.cssText+=cur.style)}}function applyOuterDeco(dom,deco,node){return patchOuterDeco(dom,dom,noDeco,computeOuterDeco(deco,node,1!=dom.nodeType))}function sameOuterDeco(a,b){if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++)if(!a[i].type.eq(b[i].type))return!1;return!0}function rm(dom){let next=dom.nextSibling;return dom.parentNode.removeChild(dom),next}class ViewTreeUpdater{constructor(top,lock,view){this.lock=lock,this.view=view,this.index=0,this.stack=[],this.changed=!1,this.top=top,this.preMatch=function preMatch(frag,parentDesc){let curDesc=parentDesc,descI=curDesc.children.length,fI=frag.childCount,matched=new Map,matches=[];outer:for(;fI>0;){let desc;for(;;)if(descI){let next=curDesc.children[descI-1];if(!(next instanceof MarkViewDesc)){desc=next,descI--;break}curDesc=next,descI=next.children.length}else{if(curDesc==parentDesc)break outer;descI=curDesc.parent.children.indexOf(curDesc),curDesc=curDesc.parent}let node=desc.node;if(node){if(node!=frag.child(fI-1))break;--fI,matched.set(desc,fI),matches.push(desc)}}return{index:fI,matched,matches:matches.reverse()}}(top.node.content,top)}destroyBetween(start,end){if(start!=end){for(let i=start;i<end;i++)this.top.children[i].destroy();this.top.children.splice(start,end-start),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(marks,inline,view){let keep=0,depth=this.stack.length>>1,maxKeep=Math.min(depth,marks.length);for(;keep<maxKeep&&(keep==depth-1?this.top:this.stack[keep+1<<1]).matchesMark(marks[keep])&&!1!==marks[keep].type.spec.spanning;)keep++;for(;keep<depth;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),depth--;for(;depth<marks.length;){this.stack.push(this.top,this.index+1);let found=-1;for(let i=this.index;i<Math.min(this.index+3,this.top.children.length);i++){let next=this.top.children[i];if(next.matchesMark(marks[depth])&&!this.isLocked(next.dom)){found=i;break}}if(found>-1)found>this.index&&(this.changed=!0,this.destroyBetween(this.index,found)),this.top=this.top.children[this.index];else{let markDesc=MarkViewDesc.create(this.top,marks[depth],inline,view);this.top.children.splice(this.index,0,markDesc),this.top=markDesc,this.changed=!0}this.index=0,depth++}}findNodeMatch(node,outerDeco,innerDeco,index){let targetDesc,found=-1;if(index>=this.preMatch.index&&(targetDesc=this.preMatch.matches[index-this.preMatch.index]).parent==this.top&&targetDesc.matchesNode(node,outerDeco,innerDeco))found=this.top.children.indexOf(targetDesc,this.index);else for(let i=this.index,e=Math.min(this.top.children.length,i+5);i<e;i++){let child=this.top.children[i];if(child.matchesNode(node,outerDeco,innerDeco)&&!this.preMatch.matched.has(child)){found=i;break}}return!(found<0)&&(this.destroyBetween(this.index,found),this.index++,!0)}updateNodeAt(node,outerDeco,innerDeco,index,view){let child=this.top.children[index];return 3==child.dirty&&child.dom==child.contentDOM&&(child.dirty=2),!!child.update(node,outerDeco,innerDeco,view)&&(this.destroyBetween(this.index,index),this.index++,!0)}findIndexWithChild(domNode){for(;;){let parent=domNode.parentNode;if(!parent)return-1;if(parent==this.top.contentDOM){let desc=domNode.pmViewDesc;if(desc)for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==desc)return i;return-1}domNode=parent}}updateNextNode(node,outerDeco,innerDeco,view,index,pos){for(let i=this.index;i<this.top.children.length;i++){let next=this.top.children[i];if(next instanceof NodeViewDesc){let preMatch=this.preMatch.matched.get(next);if(null!=preMatch&&preMatch!=index)return!1;let updated,nextDOM=next.dom,locked=this.isLocked(nextDOM)&&!(node.isText&&next.node&&next.node.isText&&next.nodeDOM.nodeValue==node.text&&3!=next.dirty&&sameOuterDeco(outerDeco,next.outerDeco));if(!locked&&next.update(node,outerDeco,innerDeco,view))return this.destroyBetween(this.index,i),next.dom!=nextDOM&&(this.changed=!0),this.index++,!0;if(!locked&&(updated=this.recreateWrapper(next,node,outerDeco,innerDeco,view,pos)))return this.destroyBetween(this.index,i),this.top.children[this.index]=updated,updated.contentDOM&&(updated.dirty=2,updated.updateChildren(view,pos+1),updated.dirty=0),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(next,node,outerDeco,innerDeco,view,pos){if(next.dirty||node.isAtom||!next.children.length||!next.node.content.eq(node.content)||!sameOuterDeco(outerDeco,next.outerDeco)||!innerDeco.eq(next.innerDeco))return null;let wrapper=NodeViewDesc.create(this.top,node,outerDeco,innerDeco,view,pos);if(wrapper.contentDOM){wrapper.children=next.children,next.children=[];for(let ch of wrapper.children)ch.parent=wrapper}return next.destroy(),wrapper}addNode(node,outerDeco,innerDeco,view,pos){let desc=NodeViewDesc.create(this.top,node,outerDeco,innerDeco,view,pos);desc.contentDOM&&desc.updateChildren(view,pos+1),this.top.children.splice(this.index++,0,desc),this.changed=!0}placeWidget(widget,view,pos){let next=this.index<this.top.children.length?this.top.children[this.index]:null;if(!next||!next.matchesWidget(widget)||widget!=next.widget&&next.widget.type.toDOM.parentNode){let desc=new WidgetViewDesc(this.top,widget,view,pos);this.top.children.splice(this.index++,0,desc),this.changed=!0}else this.index++}addTextblockHacks(){let lastChild=this.top.children[this.index-1],parent=this.top;for(;lastChild instanceof MarkViewDesc;)parent=lastChild,lastChild=parent.children[parent.children.length-1];(!lastChild||!(lastChild instanceof TextViewDesc)||/\n$/.test(lastChild.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(lastChild.node.text))&&((safari||chrome)&&lastChild&&"false"==lastChild.dom.contentEditable&&this.addHackNode("IMG",parent),this.addHackNode("BR",this.top))}addHackNode(nodeName,parent){if(parent==this.top&&this.index<parent.children.length&&parent.children[this.index].matchesHack(nodeName))this.index++;else{let dom=document.createElement(nodeName);"IMG"==nodeName&&(dom.className="ProseMirror-separator",dom.alt=""),"BR"==nodeName&&(dom.className="ProseMirror-trailingBreak");let hack=new TrailingHackViewDesc(this.top,[],dom,null);parent!=this.top?parent.children.push(hack):parent.children.splice(this.index++,0,hack),this.changed=!0}}isLocked(node){return this.lock&&(node==this.lock||1==node.nodeType&&node.contains(this.lock.parentNode))}}function compareSide(a,b){return a.type.side-b.type.side}function replaceNodes(nodes,from,to,view,replacement){let result=[];for(let i=0,off=0;i<nodes.length;i++){let child=nodes[i],start=off,end=off+=child.size;start>=to||end<=from?result.push(child):(start<from&&result.push(child.slice(0,from-start,view)),replacement&&(result.push(replacement),replacement=void 0),end>to&&result.push(child.slice(to-start,child.size,view)))}return result}function selectionFromDOM(view,origin=null){let domSel=view.domSelectionRange(),doc=view.state.doc;if(!domSel.focusNode)return null;let nearestDesc=view.docView.nearestDesc(domSel.focusNode),inWidget=nearestDesc&&0==nearestDesc.size,head=view.docView.posFromDOM(domSel.focusNode,domSel.focusOffset,1);if(head<0)return null;let anchor,selection,$head=doc.resolve(head);if(selectionCollapsed(domSel)){for(anchor=head;nearestDesc&&!nearestDesc.node;)nearestDesc=nearestDesc.parent;let nearestDescNode=nearestDesc.node;if(nearestDesc&&nearestDescNode.isAtom&&prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh.isSelectable(nearestDescNode)&&nearestDesc.parent&&(!nearestDescNode.isInline||!function isOnEdge(node,offset,parent){for(let atStart=0==offset,atEnd=offset==nodeSize(node);atStart||atEnd;){if(node==parent)return!0;let index=domIndex(node);if(!(node=node.parentNode))return!1;atStart=atStart&&0==index,atEnd=atEnd&&index==nodeSize(node)}}(domSel.focusNode,domSel.focusOffset,nearestDesc.dom))){let pos=nearestDesc.posBefore;selection=new prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh(head==pos?$head:doc.resolve(pos))}}else{if(domSel instanceof view.dom.ownerDocument.defaultView.Selection&&domSel.rangeCount>1){let min=head,max=head;for(let i=0;i<domSel.rangeCount;i++){let range=domSel.getRangeAt(i);min=Math.min(min,view.docView.posFromDOM(range.startContainer,range.startOffset,1)),max=Math.max(max,view.docView.posFromDOM(range.endContainer,range.endOffset,-1))}if(min<0)return null;[anchor,head]=max==view.state.selection.anchor?[max,min]:[min,max],$head=doc.resolve(head)}else anchor=view.docView.posFromDOM(domSel.anchorNode,domSel.anchorOffset,1);if(anchor<0)return null}let $anchor=doc.resolve(anchor);if(!selection){selection=selectionBetween(view,$anchor,$head,"pointer"==origin||view.state.selection.head<$head.pos&&!inWidget?1:-1)}return selection}function editorOwnsSelection(view){return view.editable?view.hasFocus():hasSelection(view)&&document.activeElement&&document.activeElement.contains(view.dom)}function selectionToDOM(view,force=!1){let sel=view.state.selection;if(syncNodeSelection(view,sel),editorOwnsSelection(view)){if(!force&&view.input.mouseDown&&view.input.mouseDown.allowDefault&&chrome){let domSel=view.domSelectionRange(),curSel=view.domObserver.currentSelection;if(domSel.anchorNode&&curSel.anchorNode&&isEquivalentPosition(domSel.anchorNode,domSel.anchorOffset,curSel.anchorNode,curSel.anchorOffset))return view.input.mouseDown.delayedSelectionSync=!0,void view.domObserver.setCurSelection()}if(view.domObserver.disconnectSelection(),view.cursorWrapper)!function selectCursorWrapper(view){let domSel=view.domSelection(),range=document.createRange();if(!domSel)return;let node=view.cursorWrapper.dom,img="IMG"==node.nodeName;img?range.setStart(node.parentNode,domIndex(node)+1):range.setStart(node,0);range.collapse(!0),domSel.removeAllRanges(),domSel.addRange(range),!img&&!view.state.selection.visible&&ie&&ie_version<=11&&(node.disabled=!0,node.disabled=!1)}(view);else{let resetEditableFrom,resetEditableTo,{anchor,head}=sel;!brokenSelectBetweenUneditable||sel instanceof prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.U3||(sel.$from.parent.inlineContent||(resetEditableFrom=temporarilyEditableNear(view,sel.from)),sel.empty||sel.$from.parent.inlineContent||(resetEditableTo=temporarilyEditableNear(view,sel.to))),view.docView.setSelection(anchor,head,view,force),brokenSelectBetweenUneditable&&(resetEditableFrom&&resetEditable(resetEditableFrom),resetEditableTo&&resetEditable(resetEditableTo)),sel.visible?view.dom.classList.remove("ProseMirror-hideselection"):(view.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function removeClassOnSelectionChange(view){let doc=view.dom.ownerDocument;doc.removeEventListener("selectionchange",view.input.hideSelectionGuard);let domSel=view.domSelectionRange(),node=domSel.anchorNode,offset=domSel.anchorOffset;doc.addEventListener("selectionchange",view.input.hideSelectionGuard=()=>{domSel.anchorNode==node&&domSel.anchorOffset==offset||(doc.removeEventListener("selectionchange",view.input.hideSelectionGuard),setTimeout((()=>{editorOwnsSelection(view)&&!view.state.selection.visible||view.dom.classList.remove("ProseMirror-hideselection")}),20))})}(view))}view.domObserver.setCurSelection(),view.domObserver.connectSelection()}}const brokenSelectBetweenUneditable=safari||chrome&&chrome_version<63;function temporarilyEditableNear(view,pos){let{node,offset}=view.docView.domFromPos(pos,0),after=offset<node.childNodes.length?node.childNodes[offset]:null,before=offset?node.childNodes[offset-1]:null;if(safari&&after&&"false"==after.contentEditable)return setEditable(after);if(!(after&&"false"!=after.contentEditable||before&&"false"!=before.contentEditable)){if(after)return setEditable(after);if(before)return setEditable(before)}}function setEditable(element){return element.contentEditable="true",safari&&element.draggable&&(element.draggable=!1,element.wasDraggable=!0),element}function resetEditable(element){element.contentEditable="false",element.wasDraggable&&(element.draggable=!0,element.wasDraggable=null)}function syncNodeSelection(view,sel){if(sel instanceof prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh){let desc=view.docView.descAt(sel.from);desc!=view.lastSelectedViewDesc&&(clearNodeSelection(view),desc&&desc.selectNode(),view.lastSelectedViewDesc=desc)}else clearNodeSelection(view)}function clearNodeSelection(view){view.lastSelectedViewDesc&&(view.lastSelectedViewDesc.parent&&view.lastSelectedViewDesc.deselectNode(),view.lastSelectedViewDesc=void 0)}function selectionBetween(view,$anchor,$head,bias){return view.someProp("createSelectionBetween",(f=>f(view,$anchor,$head)))||prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.U3.between($anchor,$head,bias)}function hasFocusAndSelection(view){return!(view.editable&&!view.hasFocus())&&hasSelection(view)}function hasSelection(view){let sel=view.domSelectionRange();if(!sel.anchorNode)return!1;try{return view.dom.contains(3==sel.anchorNode.nodeType?sel.anchorNode.parentNode:sel.anchorNode)&&(view.editable||view.dom.contains(3==sel.focusNode.nodeType?sel.focusNode.parentNode:sel.focusNode))}catch(_){return!1}}function moveSelectionBlock(state,dir){let{$anchor,$head}=state.selection,$side=dir>0?$anchor.max($head):$anchor.min($head),$start=$side.parent.inlineContent?$side.depth?state.doc.resolve(dir>0?$side.after():$side.before()):null:$side;return $start&&prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.LN.findFrom($start,dir)}function apply(view,sel){return view.dispatch(view.state.tr.setSelection(sel).scrollIntoView()),!0}function selectHorizontally(view,dir,mods){let sel=view.state.selection;if(!(sel instanceof prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.U3)){if(sel instanceof prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh&&sel.node.isInline)return apply(view,new prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.U3(dir>0?sel.$to:sel.$from));{let next=moveSelectionBlock(view.state,dir);return!!next&&apply(view,next)}}if(mods.indexOf("s")>-1){let{$head}=sel,node=$head.textOffset?null:dir<0?$head.nodeBefore:$head.nodeAfter;if(!node||node.isText||!node.isLeaf)return!1;let $newHead=view.state.doc.resolve($head.pos+node.nodeSize*(dir<0?-1:1));return apply(view,new prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.U3(sel.$anchor,$newHead))}if(!sel.empty)return!1;if(view.endOfTextblock(dir>0?"forward":"backward")){let next=moveSelectionBlock(view.state,dir);return!!(next&&next instanceof prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh)&&apply(view,next)}if(!(mac&&mods.indexOf("m")>-1)){let desc,$head=sel.$head,node=$head.textOffset?null:dir<0?$head.nodeBefore:$head.nodeAfter;if(!node||node.isText)return!1;let nodePos=dir<0?$head.pos-node.nodeSize:$head.pos;return!!(node.isAtom||(desc=view.docView.descAt(nodePos))&&!desc.contentDOM)&&(prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh.isSelectable(node)?apply(view,new prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh(dir<0?view.state.doc.resolve($head.pos-node.nodeSize):$head)):!!webkit&&apply(view,new prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.U3(view.state.doc.resolve(dir<0?nodePos:nodePos+node.nodeSize))))}}function nodeLen(node){return 3==node.nodeType?node.nodeValue.length:node.childNodes.length}function isIgnorable(dom,dir){let desc=dom.pmViewDesc;return desc&&0==desc.size&&(dir<0||dom.nextSibling||"BR"!=dom.nodeName)}function skipIgnoredNodes(view,dir){return dir<0?function skipIgnoredNodesBefore(view){let sel=view.domSelectionRange(),node=sel.focusNode,offset=sel.focusOffset;if(!node)return;let moveNode,moveOffset,force=!1;gecko&&1==node.nodeType&&offset<nodeLen(node)&&isIgnorable(node.childNodes[offset],-1)&&(force=!0);for(;;)if(offset>0){if(1!=node.nodeType)break;{let before=node.childNodes[offset-1];if(isIgnorable(before,-1))moveNode=node,moveOffset=--offset;else{if(3!=before.nodeType)break;node=before,offset=node.nodeValue.length}}}else{if(isBlockNode(node))break;{let prev=node.previousSibling;for(;prev&&isIgnorable(prev,-1);)moveNode=node.parentNode,moveOffset=domIndex(prev),prev=prev.previousSibling;if(prev)node=prev,offset=nodeLen(node);else{if(node=node.parentNode,node==view.dom)break;offset=0}}}force?setSelFocus(view,node,offset):moveNode&&setSelFocus(view,moveNode,moveOffset)}(view):function skipIgnoredNodesAfter(view){let sel=view.domSelectionRange(),node=sel.focusNode,offset=sel.focusOffset;if(!node)return;let moveNode,moveOffset,len=nodeLen(node);for(;;)if(offset<len){if(1!=node.nodeType)break;if(!isIgnorable(node.childNodes[offset],1))break;moveNode=node,moveOffset=++offset}else{if(isBlockNode(node))break;{let next=node.nextSibling;for(;next&&isIgnorable(next,1);)moveNode=next.parentNode,moveOffset=domIndex(next)+1,next=next.nextSibling;if(next)node=next,offset=0,len=nodeLen(node);else{if(node=node.parentNode,node==view.dom)break;offset=len=0}}}moveNode&&setSelFocus(view,moveNode,moveOffset)}(view)}function isBlockNode(dom){let desc=dom.pmViewDesc;return desc&&desc.node&&desc.node.isBlock}function setSelFocus(view,node,offset){if(3!=node.nodeType){let before,after;(after=function textNodeAfter(node,offset){for(;node&&offset==node.childNodes.length&&!hasBlockDesc(node);)offset=domIndex(node)+1,node=node.parentNode;for(;node&&offset<node.childNodes.length;){let next=node.childNodes[offset];if(3==next.nodeType)return next;if(1==next.nodeType&&"false"==next.contentEditable)break;node=next,offset=0}}(node,offset))?(node=after,offset=0):(before=function textNodeBefore(node,offset){for(;node&&!offset&&!hasBlockDesc(node);)offset=domIndex(node),node=node.parentNode;for(;node&&offset;){let next=node.childNodes[offset-1];if(3==next.nodeType)return next;if(1==next.nodeType&&"false"==next.contentEditable)break;offset=(node=next).childNodes.length}}(node,offset))&&(node=before,offset=before.nodeValue.length)}let sel=view.domSelection();if(!sel)return;if(selectionCollapsed(sel)){let range=document.createRange();range.setEnd(node,offset),range.setStart(node,offset),sel.removeAllRanges(),sel.addRange(range)}else sel.extend&&sel.extend(node,offset);view.domObserver.setCurSelection();let{state}=view;setTimeout((()=>{view.state==state&&selectionToDOM(view)}),50)}function findDirection(view,pos){let $pos=view.state.doc.resolve(pos);if(!chrome&&!windows&&$pos.parent.inlineContent){let coords=view.coordsAtPos(pos);if(pos>$pos.start()){let before=view.coordsAtPos(pos-1),mid=(before.top+before.bottom)/2;if(mid>coords.top&&mid<coords.bottom&&Math.abs(before.left-coords.left)>1)return before.left<coords.left?"ltr":"rtl"}if(pos<$pos.end()){let after=view.coordsAtPos(pos+1),mid=(after.top+after.bottom)/2;if(mid>coords.top&&mid<coords.bottom&&Math.abs(after.left-coords.left)>1)return after.left>coords.left?"ltr":"rtl"}}return"rtl"==getComputedStyle(view.dom).direction?"rtl":"ltr"}function selectVertically(view,dir,mods){let sel=view.state.selection;if(sel instanceof prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.U3&&!sel.empty||mods.indexOf("s")>-1)return!1;if(mac&&mods.indexOf("m")>-1)return!1;let{$from,$to}=sel;if(!$from.parent.inlineContent||view.endOfTextblock(dir<0?"up":"down")){let next=moveSelectionBlock(view.state,dir);if(next&&next instanceof prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh)return apply(view,next)}if(!$from.parent.inlineContent){let side=dir<0?$from:$to,beyond=sel instanceof prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.i5?prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.LN.near(side,dir):prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.LN.findFrom(side,dir);return!!beyond&&apply(view,beyond)}return!1}function stopNativeHorizontalDelete(view,dir){if(!(view.state.selection instanceof prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.U3))return!0;let{$head,$anchor,empty}=view.state.selection;if(!$head.sameParent($anchor))return!0;if(!empty)return!1;if(view.endOfTextblock(dir>0?"forward":"backward"))return!0;let nextNode=!$head.textOffset&&(dir<0?$head.nodeBefore:$head.nodeAfter);if(nextNode&&!nextNode.isText){let tr=view.state.tr;return dir<0?tr.delete($head.pos-nextNode.nodeSize,$head.pos):tr.delete($head.pos,$head.pos+nextNode.nodeSize),view.dispatch(tr),!0}return!1}function switchEditable(view,node,state){view.domObserver.stop(),node.contentEditable=state,view.domObserver.start()}function captureKeyDown(view,event){let code=event.keyCode,mods=function getMods(event){let result="";return event.ctrlKey&&(result+="c"),event.metaKey&&(result+="m"),event.altKey&&(result+="a"),event.shiftKey&&(result+="s"),result}(event);if(8==code||mac&&72==code&&"c"==mods)return stopNativeHorizontalDelete(view,-1)||skipIgnoredNodes(view,-1);if(46==code&&!event.shiftKey||mac&&68==code&&"c"==mods)return stopNativeHorizontalDelete(view,1)||skipIgnoredNodes(view,1);if(13==code||27==code)return!0;if(37==code||mac&&66==code&&"c"==mods){let dir=37==code?"ltr"==findDirection(view,view.state.selection.from)?-1:1:-1;return selectHorizontally(view,dir,mods)||skipIgnoredNodes(view,dir)}if(39==code||mac&&70==code&&"c"==mods){let dir=39==code?"ltr"==findDirection(view,view.state.selection.from)?1:-1:1;return selectHorizontally(view,dir,mods)||skipIgnoredNodes(view,dir)}return 38==code||mac&&80==code&&"c"==mods?selectVertically(view,-1,mods)||skipIgnoredNodes(view,-1):40==code||mac&&78==code&&"c"==mods?function safariDownArrowBug(view){if(!safari||view.state.selection.$head.parentOffset>0)return!1;let{focusNode,focusOffset}=view.domSelectionRange();if(focusNode&&1==focusNode.nodeType&&0==focusOffset&&focusNode.firstChild&&"false"==focusNode.firstChild.contentEditable){let child=focusNode.firstChild;switchEditable(view,child,"true"),setTimeout((()=>switchEditable(view,child,"false")),20)}return!1}(view)||selectVertically(view,1,mods)||skipIgnoredNodes(view,1):mods==(mac?"m":"c")&&(66==code||73==code||89==code||90==code)}function serializeForClipboard(view,slice){view.someProp("transformCopied",(f=>{slice=f(slice,view)}));let context=[],{content,openStart,openEnd}=slice;for(;openStart>1&&openEnd>1&&1==content.childCount&&1==content.firstChild.childCount;){openStart--,openEnd--;let node=content.firstChild;context.push(node.type.name,node.attrs!=node.type.defaultAttrs?node.attrs:null),content=node.content}let serializer=view.someProp("clipboardSerializer")||prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.ZF.fromSchema(view.state.schema),doc=detachedDoc(),wrap=doc.createElement("div");wrap.appendChild(serializer.serializeFragment(content,{document:doc}));let needsWrap,firstChild=wrap.firstChild,wrappers=0;for(;firstChild&&1==firstChild.nodeType&&(needsWrap=wrapMap[firstChild.nodeName.toLowerCase()]);){for(let i=needsWrap.length-1;i>=0;i--){let wrapper=doc.createElement(needsWrap[i]);for(;wrap.firstChild;)wrapper.appendChild(wrap.firstChild);wrap.appendChild(wrapper),wrappers++}firstChild=wrap.firstChild}return firstChild&&1==firstChild.nodeType&&firstChild.setAttribute("data-pm-slice",`${openStart} ${openEnd}${wrappers?` -${wrappers}`:""} ${JSON.stringify(context)}`),{dom:wrap,text:view.someProp("clipboardTextSerializer",(f=>f(slice,view)))||slice.content.textBetween(0,slice.content.size,"\n\n"),slice}}function parseFromClipboard(view,text,html,plainText,$context){let dom,slice,inCode=$context.parent.type.spec.code;if(!html&&!text)return null;let asText=text&&(plainText||inCode||!html);if(asText){if(view.someProp("transformPastedText",(f=>{text=f(text,inCode||plainText,view)})),inCode)return text?new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(view.state.schema.text(text.replace(/\r\n?/g,"\n"))),0,0):prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.empty;let parsed=view.someProp("clipboardTextParser",(f=>f(text,$context,plainText,view)));if(parsed)slice=parsed;else{let marks=$context.marks(),{schema}=view.state,serializer=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.ZF.fromSchema(schema);dom=document.createElement("div"),text.split(/(?:\r\n?|\n)+/).forEach((block=>{let p=dom.appendChild(document.createElement("p"));block&&p.appendChild(serializer.serializeNode(schema.text(block,marks)))}))}}else view.someProp("transformPastedHTML",(f=>{html=f(html,view)})),dom=function readHTML(html){let metas=/^(\s*<meta [^>]*>)*/.exec(html);metas&&(html=html.slice(metas[0].length));let wrap,elt=detachedDoc().createElement("div"),firstTag=/<([a-z][^>\s]+)/i.exec(html);(wrap=firstTag&&wrapMap[firstTag[1].toLowerCase()])&&(html=wrap.map((n=>"<"+n+">")).join("")+html+wrap.map((n=>"</"+n+">")).reverse().join(""));if(elt.innerHTML=function maybeWrapTrusted(html){let trustedTypes=window.trustedTypes;if(!trustedTypes)return html;_policy||(_policy=trustedTypes.defaultPolicy||trustedTypes.createPolicy("ProseMirrorClipboard",{createHTML:s=>s}));return _policy.createHTML(html)}(html),wrap)for(let i=0;i<wrap.length;i++)elt=elt.querySelector(wrap[i])||elt;return elt}(html),webkit&&function restoreReplacedSpaces(dom){let nodes=dom.querySelectorAll(chrome?"span:not([class]):not([style])":"span.Apple-converted-space");for(let i=0;i<nodes.length;i++){let node=nodes[i];1==node.childNodes.length&&"Â "==node.textContent&&node.parentNode&&node.parentNode.replaceChild(dom.ownerDocument.createTextNode(" "),node)}}(dom);let contextNode=dom&&dom.querySelector("[data-pm-slice]"),sliceData=contextNode&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(contextNode.getAttribute("data-pm-slice")||"");if(sliceData&&sliceData[3])for(let i=+sliceData[3];i>0;i--){let child=dom.firstChild;for(;child&&1!=child.nodeType;)child=child.nextSibling;if(!child)break;dom=child}if(!slice){let parser=view.someProp("clipboardParser")||view.someProp("domParser")||prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.S4.fromSchema(view.state.schema);slice=parser.parseSlice(dom,{preserveWhitespace:!(!asText&&!sliceData),context:$context,ruleFromNode:dom=>"BR"!=dom.nodeName||dom.nextSibling||!dom.parentNode||inlineParents.test(dom.parentNode.nodeName)?null:{ignore:!0}})}if(sliceData)slice=function addContext(slice,context){if(!slice.size)return slice;let array,schema=slice.content.firstChild.type.schema;try{array=JSON.parse(context)}catch(e){return slice}let{content,openStart,openEnd}=slice;for(let i=array.length-2;i>=0;i-=2){let type=schema.nodes[array[i]];if(!type||type.hasRequiredAttrs())break;content=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(type.create(array[i+1],content)),openStart++,openEnd++}return new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(content,openStart,openEnd)}(closeSlice(slice,+sliceData[1],+sliceData[2]),sliceData[4]);else if(slice=prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.maxOpen(function normalizeSiblings(fragment,$context){if(fragment.childCount<2)return fragment;for(let d=$context.depth;d>=0;d--){let lastWrap,match=$context.node(d).contentMatchAt($context.index(d)),result=[];if(fragment.forEach((node=>{if(!result)return;let inLast,wrap=match.findWrapping(node.type);if(!wrap)return result=null;if(inLast=result.length&&lastWrap.length&&addToSibling(wrap,lastWrap,node,result[result.length-1],0))result[result.length-1]=inLast;else{result.length&&(result[result.length-1]=closeRight(result[result.length-1],lastWrap.length));let wrapped=withWrappers(node,wrap);result.push(wrapped),match=match.matchType(wrapped.type),lastWrap=wrap}})),result)return prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(result)}return fragment}(slice.content,$context),!0),slice.openStart||slice.openEnd){let openStart=0,openEnd=0;for(let node=slice.content.firstChild;openStart<slice.openStart&&!node.type.spec.isolating;openStart++,node=node.firstChild);for(let node=slice.content.lastChild;openEnd<slice.openEnd&&!node.type.spec.isolating;openEnd++,node=node.lastChild);slice=closeSlice(slice,openStart,openEnd)}return view.someProp("transformPasted",(f=>{slice=f(slice,view)})),slice}const inlineParents=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function withWrappers(node,wrap,from=0){for(let i=wrap.length-1;i>=from;i--)node=wrap[i].create(null,prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(node));return node}function addToSibling(wrap,lastWrap,node,sibling,depth){if(depth<wrap.length&&depth<lastWrap.length&&wrap[depth]==lastWrap[depth]){let inner=addToSibling(wrap,lastWrap,node,sibling.lastChild,depth+1);if(inner)return sibling.copy(sibling.content.replaceChild(sibling.childCount-1,inner));if(sibling.contentMatchAt(sibling.childCount).matchType(depth==wrap.length-1?node.type:wrap[depth+1]))return sibling.copy(sibling.content.append(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(withWrappers(node,wrap,depth+1))))}}function closeRight(node,depth){if(0==depth)return node;let fragment=node.content.replaceChild(node.childCount-1,closeRight(node.lastChild,depth-1)),fill=node.contentMatchAt(node.childCount).fillBefore(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.empty,!0);return node.copy(fragment.append(fill))}function closeRange(fragment,side,from,to,depth,openEnd){let node=side<0?fragment.firstChild:fragment.lastChild,inner=node.content;return fragment.childCount>1&&(openEnd=0),depth<to-1&&(inner=closeRange(inner,side,from,to,depth+1,openEnd)),depth>=from&&(inner=side<0?node.contentMatchAt(0).fillBefore(inner,openEnd<=depth).append(inner):inner.append(node.contentMatchAt(node.childCount).fillBefore(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.empty,!0))),fragment.replaceChild(side<0?0:fragment.childCount-1,node.copy(inner))}function closeSlice(slice,openStart,openEnd){return openStart<slice.openStart&&(slice=new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(closeRange(slice.content,-1,openStart,slice.openStart,0,slice.openEnd),openStart,slice.openEnd)),openEnd<slice.openEnd&&(slice=new prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji(closeRange(slice.content,1,openEnd,slice.openEnd,0,0),slice.openStart,openEnd)),slice}const wrapMap={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let _detachedDoc=null;function detachedDoc(){return _detachedDoc||(_detachedDoc=document.implementation.createHTMLDocument("title"))}let _policy=null;const handlers={},editHandlers={},passiveHandlers={touchstart:!0,touchmove:!0};class InputState{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function setSelectionOrigin(view,origin){view.input.lastSelectionOrigin=origin,view.input.lastSelectionTime=Date.now()}function ensureListeners(view){view.someProp("handleDOMEvents",(currentHandlers=>{for(let type in currentHandlers)view.input.eventHandlers[type]||view.dom.addEventListener(type,view.input.eventHandlers[type]=event=>runCustomHandler(view,event))}))}function runCustomHandler(view,event){return view.someProp("handleDOMEvents",(handlers=>{let handler=handlers[event.type];return!!handler&&(handler(view,event)||event.defaultPrevented)}))}function eventBelongsToView(view,event){if(!event.bubbles)return!0;if(event.defaultPrevented)return!1;for(let node=event.target;node!=view.dom;node=node.parentNode)if(!node||11==node.nodeType||node.pmViewDesc&&node.pmViewDesc.stopEvent(event))return!1;return!0}function eventCoords(event){return{left:event.clientX,top:event.clientY}}function runHandlerOnContext(view,propName,pos,inside,event){if(-1==inside)return!1;let $pos=view.state.doc.resolve(inside);for(let i=$pos.depth+1;i>0;i--)if(view.someProp(propName,(f=>i>$pos.depth?f(view,pos,$pos.nodeAfter,$pos.before(i),event,!0):f(view,pos,$pos.node(i),$pos.before(i),event,!1))))return!0;return!1}function updateSelection(view,selection,origin){if(view.focused||view.focus(),view.state.selection.eq(selection))return;let tr=view.state.tr.setSelection(selection);"pointer"==origin&&tr.setMeta("pointer",!0),view.dispatch(tr)}function handleSingleClick(view,pos,inside,event,selectNode){return runHandlerOnContext(view,"handleClickOn",pos,inside,event)||view.someProp("handleClick",(f=>f(view,pos,event)))||(selectNode?function selectClickedNode(view,inside){if(-1==inside)return!1;let selectedNode,selectAt,sel=view.state.selection;sel instanceof prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh&&(selectedNode=sel.node);let $pos=view.state.doc.resolve(inside);for(let i=$pos.depth+1;i>0;i--){let node=i>$pos.depth?$pos.nodeAfter:$pos.node(i);if(prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh.isSelectable(node)){selectAt=selectedNode&&sel.$from.depth>0&&i>=sel.$from.depth&&$pos.before(sel.$from.depth+1)==sel.$from.pos?$pos.before(sel.$from.depth):$pos.before(i);break}}return null!=selectAt&&(updateSelection(view,prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh.create(view.state.doc,selectAt),"pointer"),!0)}(view,inside):function selectClickedLeaf(view,inside){if(-1==inside)return!1;let $pos=view.state.doc.resolve(inside),node=$pos.nodeAfter;return!!(node&&node.isAtom&&prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh.isSelectable(node))&&(updateSelection(view,new prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh($pos),"pointer"),!0)}(view,inside))}function handleDoubleClick(view,pos,inside,event){return runHandlerOnContext(view,"handleDoubleClickOn",pos,inside,event)||view.someProp("handleDoubleClick",(f=>f(view,pos,event)))}function handleTripleClick(view,pos,inside,event){return runHandlerOnContext(view,"handleTripleClickOn",pos,inside,event)||view.someProp("handleTripleClick",(f=>f(view,pos,event)))||function defaultTripleClick(view,inside,event){if(0!=event.button)return!1;let doc=view.state.doc;if(-1==inside)return!!doc.inlineContent&&(updateSelection(view,prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.U3.create(doc,0,doc.content.size),"pointer"),!0);let $pos=doc.resolve(inside);for(let i=$pos.depth+1;i>0;i--){let node=i>$pos.depth?$pos.nodeAfter:$pos.node(i),nodePos=$pos.before(i);if(node.inlineContent)updateSelection(view,prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.U3.create(doc,nodePos+1,nodePos+1+node.content.size),"pointer");else{if(!prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh.isSelectable(node))continue;updateSelection(view,prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh.create(doc,nodePos),"pointer")}return!0}}(view,inside,event)}function forceDOMFlush(view){return endComposition(view)}editHandlers.keydown=(view,_event)=>{let event=_event;if(view.input.shiftKey=16==event.keyCode||event.shiftKey,!inOrNearComposition(view,event)&&(view.input.lastKeyCode=event.keyCode,view.input.lastKeyCodeTime=Date.now(),!android||!chrome||13!=event.keyCode))if(229!=event.keyCode&&view.domObserver.forceFlush(),!ios||13!=event.keyCode||event.ctrlKey||event.altKey||event.metaKey)view.someProp("handleKeyDown",(f=>f(view,event)))||captureKeyDown(view,event)?event.preventDefault():setSelectionOrigin(view,"key");else{let now=Date.now();view.input.lastIOSEnter=now,view.input.lastIOSEnterFallbackTimeout=setTimeout((()=>{view.input.lastIOSEnter==now&&(view.someProp("handleKeyDown",(f=>f(view,keyEvent(13,"Enter")))),view.input.lastIOSEnter=0)}),200)}},editHandlers.keyup=(view,event)=>{16==event.keyCode&&(view.input.shiftKey=!1)},editHandlers.keypress=(view,_event)=>{let event=_event;if(inOrNearComposition(view,event)||!event.charCode||event.ctrlKey&&!event.altKey||mac&&event.metaKey)return;if(view.someProp("handleKeyPress",(f=>f(view,event))))return void event.preventDefault();let sel=view.state.selection;if(!(sel instanceof prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.U3&&sel.$from.sameParent(sel.$to))){let text=String.fromCharCode(event.charCode);/[\r\n]/.test(text)||view.someProp("handleTextInput",(f=>f(view,sel.$from.pos,sel.$to.pos,text)))||view.dispatch(view.state.tr.insertText(text).scrollIntoView()),event.preventDefault()}};const selectNodeModifier=mac?"metaKey":"ctrlKey";handlers.mousedown=(view,_event)=>{let event=_event;view.input.shiftKey=event.shiftKey;let flushed=forceDOMFlush(view),now=Date.now(),type="singleClick";now-view.input.lastClick.time<500&&function isNear(event,click){let dx=click.x-event.clientX,dy=click.y-event.clientY;return dx*dx+dy*dy<100}(event,view.input.lastClick)&&!event[selectNodeModifier]&&view.input.lastClick.button==event.button&&("singleClick"==view.input.lastClick.type?type="doubleClick":"doubleClick"==view.input.lastClick.type&&(type="tripleClick")),view.input.lastClick={time:now,x:event.clientX,y:event.clientY,type,button:event.button};let pos=view.posAtCoords(eventCoords(event));pos&&("singleClick"==type?(view.input.mouseDown&&view.input.mouseDown.done(),view.input.mouseDown=new MouseDown(view,pos,event,!!flushed)):("doubleClick"==type?handleDoubleClick:handleTripleClick)(view,pos.pos,pos.inside,event)?event.preventDefault():setSelectionOrigin(view,"pointer"))};class MouseDown{constructor(view,pos,event,flushed){let targetNode,targetPos;if(this.view=view,this.pos=pos,this.event=event,this.flushed=flushed,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=view.state.doc,this.selectNode=!!event[selectNodeModifier],this.allowDefault=event.shiftKey,pos.inside>-1)targetNode=view.state.doc.nodeAt(pos.inside),targetPos=pos.inside;else{let $pos=view.state.doc.resolve(pos.pos);targetNode=$pos.parent,targetPos=$pos.depth?$pos.before():0}const target=flushed?null:event.target,targetDesc=target?view.docView.nearestDesc(target,!0):null;this.target=targetDesc&&1==targetDesc.dom.nodeType?targetDesc.dom:null;let{selection}=view.state;(0==event.button&&targetNode.type.spec.draggable&&!1!==targetNode.type.spec.selectable||selection instanceof prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh&&selection.from<=targetPos&&selection.to>targetPos)&&(this.mightDrag={node:targetNode,pos:targetPos,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!gecko||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout((()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")}),20),this.view.domObserver.start()),view.root.addEventListener("mouseup",this.up=this.up.bind(this)),view.root.addEventListener("mousemove",this.move=this.move.bind(this)),setSelectionOrigin(view,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout((()=>selectionToDOM(this.view))),this.view.input.mouseDown=null}up(event){if(this.done(),!this.view.dom.contains(event.target))return;let pos=this.pos;this.view.state.doc!=this.startDoc&&(pos=this.view.posAtCoords(eventCoords(event))),this.updateAllowDefault(event),this.allowDefault||!pos?setSelectionOrigin(this.view,"pointer"):handleSingleClick(this.view,pos.pos,pos.inside,event,this.selectNode)?event.preventDefault():0==event.button&&(this.flushed||safari&&this.mightDrag&&!this.mightDrag.node.isAtom||chrome&&!this.view.state.selection.visible&&Math.min(Math.abs(pos.pos-this.view.state.selection.from),Math.abs(pos.pos-this.view.state.selection.to))<=2)?(updateSelection(this.view,prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.LN.near(this.view.state.doc.resolve(pos.pos)),"pointer"),event.preventDefault()):setSelectionOrigin(this.view,"pointer")}move(event){this.updateAllowDefault(event),setSelectionOrigin(this.view,"pointer"),0==event.buttons&&this.done()}updateAllowDefault(event){!this.allowDefault&&(Math.abs(this.event.x-event.clientX)>4||Math.abs(this.event.y-event.clientY)>4)&&(this.allowDefault=!0)}}function inOrNearComposition(view,event){return!!view.composing||!!(safari&&Math.abs(event.timeStamp-view.input.compositionEndedAt)<500)&&(view.input.compositionEndedAt=-2e8,!0)}handlers.touchstart=view=>{view.input.lastTouch=Date.now(),forceDOMFlush(view),setSelectionOrigin(view,"pointer")},handlers.touchmove=view=>{view.input.lastTouch=Date.now(),setSelectionOrigin(view,"pointer")},handlers.contextmenu=view=>forceDOMFlush(view);const timeoutComposition=android?5e3:-1;function scheduleComposeEnd(view,delay){clearTimeout(view.input.composingTimeout),delay>-1&&(view.input.composingTimeout=setTimeout((()=>endComposition(view)),delay))}function clearComposition(view){for(view.composing&&(view.input.composing=!1,view.input.compositionEndedAt=function timestampFromCustomEvent(){let event=document.createEvent("Event");return event.initEvent("event",!0,!0),event.timeStamp}());view.input.compositionNodes.length>0;)view.input.compositionNodes.pop().markParentsDirty()}function findCompositionNode(view){let sel=view.domSelectionRange();if(!sel.focusNode)return null;let textBefore=function textNodeBefore$1(node,offset){for(;;){if(3==node.nodeType&&offset)return node;if(1==node.nodeType&&offset>0){if("false"==node.contentEditable)return null;offset=nodeSize(node=node.childNodes[offset-1])}else{if(!node.parentNode||hasBlockDesc(node))return null;offset=domIndex(node),node=node.parentNode}}}(sel.focusNode,sel.focusOffset),textAfter=function textNodeAfter$1(node,offset){for(;;){if(3==node.nodeType&&offset<node.nodeValue.length)return node;if(1==node.nodeType&&offset<node.childNodes.length){if("false"==node.contentEditable)return null;node=node.childNodes[offset],offset=0}else{if(!node.parentNode||hasBlockDesc(node))return null;offset=domIndex(node)+1,node=node.parentNode}}}(sel.focusNode,sel.focusOffset);if(textBefore&&textAfter&&textBefore!=textAfter){let descAfter=textAfter.pmViewDesc,lastChanged=view.domObserver.lastChangedTextNode;if(textBefore==lastChanged||textAfter==lastChanged)return lastChanged;if(!descAfter||!descAfter.isText(textAfter.nodeValue))return textAfter;if(view.input.compositionNode==textAfter){let descBefore=textBefore.pmViewDesc;if(descBefore&&descBefore.isText(textBefore.nodeValue))return textAfter}}return textBefore||textAfter}function endComposition(view,restarting=!1){if(!(android&&view.domObserver.flushingSoon>=0)){if(view.domObserver.forceFlush(),clearComposition(view),restarting||view.docView&&view.docView.dirty){let sel=selectionFromDOM(view),cur=view.state.selection;return sel&&!sel.eq(cur)?view.dispatch(view.state.tr.setSelection(sel)):!view.markCursor&&!restarting||cur.$from.node(cur.$from.sharedDepth(cur.to)).inlineContent?view.updateState(view.state):view.dispatch(view.state.tr.deleteSelection()),!0}return!1}}editHandlers.compositionstart=editHandlers.compositionupdate=view=>{if(!view.composing){view.domObserver.flush();let{state}=view,$pos=state.selection.$to;if(state.selection instanceof prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.U3&&(state.storedMarks||!$pos.textOffset&&$pos.parentOffset&&$pos.nodeBefore.marks.some((m=>!1===m.type.spec.inclusive))))view.markCursor=view.state.storedMarks||$pos.marks(),endComposition(view,!0),view.markCursor=null;else if(endComposition(view,!state.selection.empty),gecko&&state.selection.empty&&$pos.parentOffset&&!$pos.textOffset&&$pos.nodeBefore.marks.length){let sel=view.domSelectionRange();for(let node=sel.focusNode,offset=sel.focusOffset;node&&1==node.nodeType&&0!=offset;){let before=offset<0?node.lastChild:node.childNodes[offset-1];if(!before)break;if(3==before.nodeType){let sel=view.domSelection();sel&&sel.collapse(before,before.nodeValue.length);break}node=before,offset=-1}}view.input.composing=!0}scheduleComposeEnd(view,timeoutComposition)},editHandlers.compositionend=(view,event)=>{view.composing&&(view.input.composing=!1,view.input.compositionEndedAt=event.timeStamp,view.input.compositionPendingChanges=view.domObserver.pendingRecords().length?view.input.compositionID:0,view.input.compositionNode=null,view.input.compositionPendingChanges&&Promise.resolve().then((()=>view.domObserver.flush())),view.input.compositionID++,scheduleComposeEnd(view,20))};const brokenClipboardAPI=ie&&ie_version<15||ios&&webkit_version<604;function doPaste(view,text,html,preferPlain,event){let slice=parseFromClipboard(view,text,html,preferPlain,view.state.selection.$from);if(view.someProp("handlePaste",(f=>f(view,event,slice||prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.empty))))return!0;if(!slice)return!1;let singleNode=function sliceSingleNode(slice){return 0==slice.openStart&&0==slice.openEnd&&1==slice.content.childCount?slice.content.firstChild:null}(slice),tr=singleNode?view.state.tr.replaceSelectionWith(singleNode,preferPlain):view.state.tr.replaceSelection(slice);return view.dispatch(tr.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function getText(clipboardData){let text=clipboardData.getData("text/plain")||clipboardData.getData("Text");if(text)return text;let uris=clipboardData.getData("text/uri-list");return uris?uris.replace(/\r?\n/g," "):""}handlers.copy=editHandlers.cut=(view,_event)=>{let event=_event,sel=view.state.selection,cut="cut"==event.type;if(sel.empty)return;let data=brokenClipboardAPI?null:event.clipboardData,slice=sel.content(),{dom,text}=serializeForClipboard(view,slice);data?(event.preventDefault(),data.clearData(),data.setData("text/html",dom.innerHTML),data.setData("text/plain",text)):function captureCopy(view,dom){if(!view.dom.parentNode)return;let wrap=view.dom.parentNode.appendChild(document.createElement("div"));wrap.appendChild(dom),wrap.style.cssText="position: fixed; left: -10000px; top: 10px";let sel=getSelection(),range=document.createRange();range.selectNodeContents(dom),view.dom.blur(),sel.removeAllRanges(),sel.addRange(range),setTimeout((()=>{wrap.parentNode&&wrap.parentNode.removeChild(wrap),view.focus()}),50)}(view,dom),cut&&view.dispatch(view.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},editHandlers.paste=(view,_event)=>{let event=_event;if(view.composing&&!android)return;let data=brokenClipboardAPI?null:event.clipboardData,plain=view.input.shiftKey&&45!=view.input.lastKeyCode;data&&doPaste(view,getText(data),data.getData("text/html"),plain,event)?event.preventDefault():function capturePaste(view,event){if(!view.dom.parentNode)return;let plainText=view.input.shiftKey||view.state.selection.$from.parent.type.spec.code,target=view.dom.parentNode.appendChild(document.createElement(plainText?"textarea":"div"));plainText||(target.contentEditable="true"),target.style.cssText="position: fixed; left: -10000px; top: 10px",target.focus();let plain=view.input.shiftKey&&45!=view.input.lastKeyCode;setTimeout((()=>{view.focus(),target.parentNode&&target.parentNode.removeChild(target),plainText?doPaste(view,target.value,null,plain,event):doPaste(view,target.textContent,target.innerHTML,plain,event)}),50)}(view,event)};class Dragging{constructor(slice,move,node){this.slice=slice,this.move=move,this.node=node}}const dragCopyModifier=mac?"altKey":"ctrlKey";function dragMoves(view,event){let moves=view.someProp("dragCopies",(test=>!test(event)));return null!=moves?moves:!event[dragCopyModifier]}handlers.dragstart=(view,_event)=>{let event=_event,mouseDown=view.input.mouseDown;if(mouseDown&&mouseDown.done(),!event.dataTransfer)return;let node,sel=view.state.selection,pos=sel.empty?null:view.posAtCoords(eventCoords(event));if(pos&&pos.pos>=sel.from&&pos.pos<=(sel instanceof prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh?sel.to-1:sel.to));else if(mouseDown&&mouseDown.mightDrag)node=prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh.create(view.state.doc,mouseDown.mightDrag.pos);else if(event.target&&1==event.target.nodeType){let desc=view.docView.nearestDesc(event.target,!0);desc&&desc.node.type.spec.draggable&&desc!=view.docView&&(node=prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh.create(view.state.doc,desc.posBefore))}let draggedSlice=(node||view.state.selection).content(),{dom,text,slice}=serializeForClipboard(view,draggedSlice);(!event.dataTransfer.files.length||!chrome||chrome_version>120)&&event.dataTransfer.clearData(),event.dataTransfer.setData(brokenClipboardAPI?"Text":"text/html",dom.innerHTML),event.dataTransfer.effectAllowed="copyMove",brokenClipboardAPI||event.dataTransfer.setData("text/plain",text),view.dragging=new Dragging(slice,dragMoves(view,event),node)},handlers.dragend=view=>{let dragging=view.dragging;window.setTimeout((()=>{view.dragging==dragging&&(view.dragging=null)}),50)},editHandlers.dragover=editHandlers.dragenter=(_,e)=>e.preventDefault(),editHandlers.drop=(view,_event)=>{let event=_event,dragging=view.dragging;if(view.dragging=null,!event.dataTransfer)return;let eventPos=view.posAtCoords(eventCoords(event));if(!eventPos)return;let $mouse=view.state.doc.resolve(eventPos.pos),slice=dragging&&dragging.slice;slice?view.someProp("transformPasted",(f=>{slice=f(slice,view)})):slice=parseFromClipboard(view,getText(event.dataTransfer),brokenClipboardAPI?null:event.dataTransfer.getData("text/html"),!1,$mouse);let move=!(!dragging||!dragMoves(view,event));if(view.someProp("handleDrop",(f=>f(view,event,slice||prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.Ji.empty,move))))return void event.preventDefault();if(!slice)return;event.preventDefault();let insertPos=slice?(0,prosemirror_transform__WEBPACK_IMPORTED_MODULE_2__.Um)(view.state.doc,$mouse.pos,slice):$mouse.pos;null==insertPos&&(insertPos=$mouse.pos);let tr=view.state.tr;if(move){let{node}=dragging;node?node.replace(tr):tr.deleteSelection()}let pos=tr.mapping.map(insertPos),isNode=0==slice.openStart&&0==slice.openEnd&&1==slice.content.childCount,beforeInsert=tr.doc;if(isNode?tr.replaceRangeWith(pos,pos,slice.content.firstChild):tr.replaceRange(pos,pos,slice),tr.doc.eq(beforeInsert))return;let $pos=tr.doc.resolve(pos);if(isNode&&prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh.isSelectable(slice.content.firstChild)&&$pos.nodeAfter&&$pos.nodeAfter.sameMarkup(slice.content.firstChild))tr.setSelection(new prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh($pos));else{let end=tr.mapping.map(insertPos);tr.mapping.maps[tr.mapping.maps.length-1].forEach(((_from,_to,_newFrom,newTo)=>end=newTo)),tr.setSelection(selectionBetween(view,$pos,tr.doc.resolve(end)))}view.focus(),view.dispatch(tr.setMeta("uiEvent","drop"))},handlers.focus=view=>{view.input.lastFocus=Date.now(),view.focused||(view.domObserver.stop(),view.dom.classList.add("ProseMirror-focused"),view.domObserver.start(),view.focused=!0,setTimeout((()=>{view.docView&&view.hasFocus()&&!view.domObserver.currentSelection.eq(view.domSelectionRange())&&selectionToDOM(view)}),20))},handlers.blur=(view,_event)=>{let event=_event;view.focused&&(view.domObserver.stop(),view.dom.classList.remove("ProseMirror-focused"),view.domObserver.start(),event.relatedTarget&&view.dom.contains(event.relatedTarget)&&view.domObserver.currentSelection.clear(),view.focused=!1)},handlers.beforeinput=(view,_event)=>{if(chrome&&android&&"deleteContentBackward"==_event.inputType){view.domObserver.flushSoon();let{domChangeCount}=view.input;setTimeout((()=>{if(view.input.domChangeCount!=domChangeCount)return;if(view.dom.blur(),view.focus(),view.someProp("handleKeyDown",(f=>f(view,keyEvent(8,"Backspace")))))return;let{$cursor}=view.state.selection;$cursor&&$cursor.pos>0&&view.dispatch(view.state.tr.delete($cursor.pos-1,$cursor.pos).scrollIntoView())}),50)}};for(let prop in editHandlers)handlers[prop]=editHandlers[prop];function compareObjs(a,b){if(a==b)return!0;for(let p in a)if(a[p]!==b[p])return!1;for(let p in b)if(!(p in a))return!1;return!0}class WidgetType{constructor(toDOM,spec){this.toDOM=toDOM,this.spec=spec||noSpec,this.side=this.spec.side||0}map(mapping,span,offset,oldOffset){let{pos,deleted}=mapping.mapResult(span.from+oldOffset,this.side<0?-1:1);return deleted?null:new Decoration(pos-offset,pos-offset,this)}valid(){return!0}eq(other){return this==other||other instanceof WidgetType&&(this.spec.key&&this.spec.key==other.spec.key||this.toDOM==other.toDOM&&compareObjs(this.spec,other.spec))}destroy(node){this.spec.destroy&&this.spec.destroy(node)}}class InlineType{constructor(attrs,spec){this.attrs=attrs,this.spec=spec||noSpec}map(mapping,span,offset,oldOffset){let from=mapping.map(span.from+oldOffset,this.spec.inclusiveStart?-1:1)-offset,to=mapping.map(span.to+oldOffset,this.spec.inclusiveEnd?1:-1)-offset;return from>=to?null:new Decoration(from,to,this)}valid(_,span){return span.from<span.to}eq(other){return this==other||other instanceof InlineType&&compareObjs(this.attrs,other.attrs)&&compareObjs(this.spec,other.spec)}static is(span){return span.type instanceof InlineType}destroy(){}}class NodeType{constructor(attrs,spec){this.attrs=attrs,this.spec=spec||noSpec}map(mapping,span,offset,oldOffset){let from=mapping.mapResult(span.from+oldOffset,1);if(from.deleted)return null;let to=mapping.mapResult(span.to+oldOffset,-1);return to.deleted||to.pos<=from.pos?null:new Decoration(from.pos-offset,to.pos-offset,this)}valid(node,span){let child,{index,offset}=node.content.findIndex(span.from);return offset==span.from&&!(child=node.child(index)).isText&&offset+child.nodeSize==span.to}eq(other){return this==other||other instanceof NodeType&&compareObjs(this.attrs,other.attrs)&&compareObjs(this.spec,other.spec)}destroy(){}}class Decoration{constructor(from,to,type){this.from=from,this.to=to,this.type=type}copy(from,to){return new Decoration(from,to,this.type)}eq(other,offset=0){return this.type.eq(other.type)&&this.from+offset==other.from&&this.to+offset==other.to}map(mapping,offset,oldOffset){return this.type.map(mapping,this,offset,oldOffset)}static widget(pos,toDOM,spec){return new Decoration(pos,pos,new WidgetType(toDOM,spec))}static inline(from,to,attrs,spec){return new Decoration(from,to,new InlineType(attrs,spec))}static node(from,to,attrs,spec){return new Decoration(from,to,new NodeType(attrs,spec))}get spec(){return this.type.spec}get inline(){return this.type instanceof InlineType}get widget(){return this.type instanceof WidgetType}}const none=[],noSpec={};class DecorationSet{constructor(local,children){this.local=local.length?local:none,this.children=children.length?children:none}static create(doc,decorations){return decorations.length?buildTree(decorations,doc,0,noSpec):empty}find(start,end,predicate){let result=[];return this.findInner(null==start?0:start,null==end?1e9:end,result,0,predicate),result}findInner(start,end,result,offset,predicate){for(let i=0;i<this.local.length;i++){let span=this.local[i];span.from<=end&&span.to>=start&&(!predicate||predicate(span.spec))&&result.push(span.copy(span.from+offset,span.to+offset))}for(let i=0;i<this.children.length;i+=3)if(this.children[i]<end&&this.children[i+1]>start){let childOff=this.children[i]+1;this.children[i+2].findInner(start-childOff,end-childOff,result,offset+childOff,predicate)}}map(mapping,doc,options){return this==empty||0==mapping.maps.length?this:this.mapInner(mapping,doc,0,0,options||noSpec)}mapInner(mapping,node,offset,oldOffset,options){let newLocal;for(let i=0;i<this.local.length;i++){let mapped=this.local[i].map(mapping,offset,oldOffset);mapped&&mapped.type.valid(node,mapped)?(newLocal||(newLocal=[])).push(mapped):options.onRemove&&options.onRemove(this.local[i].spec)}return this.children.length?function mapChildren(oldChildren,newLocal,mapping,node,offset,oldOffset,options){let children=oldChildren.slice();for(let i=0,baseOffset=oldOffset;i<mapping.maps.length;i++){let moved=0;mapping.maps[i].forEach(((oldStart,oldEnd,newStart,newEnd)=>{let dSize=newEnd-newStart-(oldEnd-oldStart);for(let i=0;i<children.length;i+=3){let end=children[i+1];if(end<0||oldStart>end+baseOffset-moved)continue;let start=children[i]+baseOffset-moved;oldEnd>=start?children[i+1]=oldStart<=start?-2:-1:oldStart>=baseOffset&&dSize&&(children[i]+=dSize,children[i+1]+=dSize)}moved+=dSize})),baseOffset=mapping.maps[i].map(baseOffset,-1)}let mustRebuild=!1;for(let i=0;i<children.length;i+=3)if(children[i+1]<0){if(-2==children[i+1]){mustRebuild=!0,children[i+1]=-1;continue}let from=mapping.map(oldChildren[i]+oldOffset),fromLocal=from-offset;if(fromLocal<0||fromLocal>=node.content.size){mustRebuild=!0;continue}let toLocal=mapping.map(oldChildren[i+1]+oldOffset,-1)-offset,{index,offset:childOffset}=node.content.findIndex(fromLocal),childNode=node.maybeChild(index);if(childNode&&childOffset==fromLocal&&childOffset+childNode.nodeSize==toLocal){let mapped=children[i+2].mapInner(mapping,childNode,from+1,oldChildren[i]+oldOffset+1,options);mapped!=empty?(children[i]=fromLocal,children[i+1]=toLocal,children[i+2]=mapped):(children[i+1]=-2,mustRebuild=!0)}else mustRebuild=!0}if(mustRebuild){let decorations=function mapAndGatherRemainingDecorations(children,oldChildren,decorations,mapping,offset,oldOffset,options){function gather(set,oldOffset){for(let i=0;i<set.local.length;i++){let mapped=set.local[i].map(mapping,offset,oldOffset);mapped?decorations.push(mapped):options.onRemove&&options.onRemove(set.local[i].spec)}for(let i=0;i<set.children.length;i+=3)gather(set.children[i+2],set.children[i]+oldOffset+1)}for(let i=0;i<children.length;i+=3)-1==children[i+1]&&gather(children[i+2],oldChildren[i]+oldOffset+1);return decorations}(children,oldChildren,newLocal,mapping,offset,oldOffset,options),built=buildTree(decorations,node,0,options);newLocal=built.local;for(let i=0;i<children.length;i+=3)children[i+1]<0&&(children.splice(i,3),i-=3);for(let i=0,j=0;i<built.children.length;i+=3){let from=built.children[i];for(;j<children.length&&children[j]<from;)j+=3;children.splice(j,0,built.children[i],built.children[i+1],built.children[i+2])}}return new DecorationSet(newLocal.sort(byPos),children)}(this.children,newLocal||[],mapping,node,offset,oldOffset,options):newLocal?new DecorationSet(newLocal.sort(byPos),none):empty}add(doc,decorations){return decorations.length?this==empty?DecorationSet.create(doc,decorations):this.addInner(doc,decorations,0):this}addInner(doc,decorations,offset){let children,childIndex=0;doc.forEach(((childNode,childOffset)=>{let found,baseOffset=childOffset+offset;if(found=takeSpansForNode(decorations,childNode,baseOffset)){for(children||(children=this.children.slice());childIndex<children.length&&children[childIndex]<childOffset;)childIndex+=3;children[childIndex]==childOffset?children[childIndex+2]=children[childIndex+2].addInner(childNode,found,baseOffset+1):children.splice(childIndex,0,childOffset,childOffset+childNode.nodeSize,buildTree(found,childNode,baseOffset+1,noSpec)),childIndex+=3}}));let local=moveSpans(childIndex?withoutNulls(decorations):decorations,-offset);for(let i=0;i<local.length;i++)local[i].type.valid(doc,local[i])||local.splice(i--,1);return new DecorationSet(local.length?this.local.concat(local).sort(byPos):this.local,children||this.children)}remove(decorations){return 0==decorations.length||this==empty?this:this.removeInner(decorations,0)}removeInner(decorations,offset){let children=this.children,local=this.local;for(let i=0;i<children.length;i+=3){let found,from=children[i]+offset,to=children[i+1]+offset;for(let span,j=0;j<decorations.length;j++)(span=decorations[j])&&span.from>from&&span.to<to&&(decorations[j]=null,(found||(found=[])).push(span));if(!found)continue;children==this.children&&(children=this.children.slice());let removed=children[i+2].removeInner(found,from+1);removed!=empty?children[i+2]=removed:(children.splice(i,3),i-=3)}if(local.length)for(let span,i=0;i<decorations.length;i++)if(span=decorations[i])for(let j=0;j<local.length;j++)local[j].eq(span,offset)&&(local==this.local&&(local=this.local.slice()),local.splice(j--,1));return children==this.children&&local==this.local?this:local.length||children.length?new DecorationSet(local,children):empty}forChild(offset,node){if(this==empty)return this;if(node.isLeaf)return DecorationSet.empty;let child,local;for(let i=0;i<this.children.length;i+=3)if(this.children[i]>=offset){this.children[i]==offset&&(child=this.children[i+2]);break}let start=offset+1,end=start+node.content.size;for(let i=0;i<this.local.length;i++){let dec=this.local[i];if(dec.from<end&&dec.to>start&&dec.type instanceof InlineType){let from=Math.max(start,dec.from)-start,to=Math.min(end,dec.to)-start;from<to&&(local||(local=[])).push(dec.copy(from,to))}}if(local){let localSet=new DecorationSet(local.sort(byPos),none);return child?new DecorationGroup([localSet,child]):localSet}return child||empty}eq(other){if(this==other)return!0;if(!(other instanceof DecorationSet)||this.local.length!=other.local.length||this.children.length!=other.children.length)return!1;for(let i=0;i<this.local.length;i++)if(!this.local[i].eq(other.local[i]))return!1;for(let i=0;i<this.children.length;i+=3)if(this.children[i]!=other.children[i]||this.children[i+1]!=other.children[i+1]||!this.children[i+2].eq(other.children[i+2]))return!1;return!0}locals(node){return removeOverlap(this.localsInner(node))}localsInner(node){if(this==empty)return none;if(node.inlineContent||!this.local.some(InlineType.is))return this.local;let result=[];for(let i=0;i<this.local.length;i++)this.local[i].type instanceof InlineType||result.push(this.local[i]);return result}forEachSet(f){f(this)}}DecorationSet.empty=new DecorationSet([],[]),DecorationSet.removeOverlap=removeOverlap;const empty=DecorationSet.empty;class DecorationGroup{constructor(members){this.members=members}map(mapping,doc){const mappedDecos=this.members.map((member=>member.map(mapping,doc,noSpec)));return DecorationGroup.from(mappedDecos)}forChild(offset,child){if(child.isLeaf)return DecorationSet.empty;let found=[];for(let i=0;i<this.members.length;i++){let result=this.members[i].forChild(offset,child);result!=empty&&(result instanceof DecorationGroup?found=found.concat(result.members):found.push(result))}return DecorationGroup.from(found)}eq(other){if(!(other instanceof DecorationGroup)||other.members.length!=this.members.length)return!1;for(let i=0;i<this.members.length;i++)if(!this.members[i].eq(other.members[i]))return!1;return!0}locals(node){let result,sorted=!0;for(let i=0;i<this.members.length;i++){let locals=this.members[i].localsInner(node);if(locals.length)if(result){sorted&&(result=result.slice(),sorted=!1);for(let j=0;j<locals.length;j++)result.push(locals[j])}else result=locals}return result?removeOverlap(sorted?result:result.sort(byPos)):none}static from(members){switch(members.length){case 0:return empty;case 1:return members[0];default:return new DecorationGroup(members.every((m=>m instanceof DecorationSet))?members:members.reduce(((r,m)=>r.concat(m instanceof DecorationSet?m:m.members)),[]))}}forEachSet(f){for(let i=0;i<this.members.length;i++)this.members[i].forEachSet(f)}}function moveSpans(spans,offset){if(!offset||!spans.length)return spans;let result=[];for(let i=0;i<spans.length;i++){let span=spans[i];result.push(new Decoration(span.from+offset,span.to+offset,span.type))}return result}function takeSpansForNode(spans,node,offset){if(node.isLeaf)return null;let end=offset+node.nodeSize,found=null;for(let span,i=0;i<spans.length;i++)(span=spans[i])&&span.from>offset&&span.to<end&&((found||(found=[])).push(span),spans[i]=null);return found}function withoutNulls(array){let result=[];for(let i=0;i<array.length;i++)null!=array[i]&&result.push(array[i]);return result}function buildTree(spans,node,offset,options){let children=[],hasNulls=!1;node.forEach(((childNode,localStart)=>{let found=takeSpansForNode(spans,childNode,localStart+offset);if(found){hasNulls=!0;let subtree=buildTree(found,childNode,offset+localStart+1,options);subtree!=empty&&children.push(localStart,localStart+childNode.nodeSize,subtree)}}));let locals=moveSpans(hasNulls?withoutNulls(spans):spans,-offset).sort(byPos);for(let i=0;i<locals.length;i++)locals[i].type.valid(node,locals[i])||(options.onRemove&&options.onRemove(locals[i].spec),locals.splice(i--,1));return locals.length||children.length?new DecorationSet(locals,children):empty}function byPos(a,b){return a.from-b.from||a.to-b.to}function removeOverlap(spans){let working=spans;for(let i=0;i<working.length-1;i++){let span=working[i];if(span.from!=span.to)for(let j=i+1;j<working.length;j++){let next=working[j];if(next.from!=span.from){next.from<span.to&&(working==spans&&(working=spans.slice()),working[i]=span.copy(span.from,next.from),insertAhead(working,j,span.copy(next.from,span.to)));break}next.to!=span.to&&(working==spans&&(working=spans.slice()),working[j]=next.copy(next.from,span.to),insertAhead(working,j+1,next.copy(span.to,next.to)))}}return working}function insertAhead(array,i,deco){for(;i<array.length&&byPos(deco,array[i])>0;)i++;array.splice(i,0,deco)}function viewDecorations(view){let found=[];return view.someProp("decorations",(f=>{let result=f(view.state);result&&result!=empty&&found.push(result)})),view.cursorWrapper&&found.push(DecorationSet.create(view.state.doc,[view.cursorWrapper.deco])),DecorationGroup.from(found)}const observeOptions={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},useCharData=ie&&ie_version<=11;class SelectionState{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(sel){this.anchorNode=sel.anchorNode,this.anchorOffset=sel.anchorOffset,this.focusNode=sel.focusNode,this.focusOffset=sel.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(sel){return sel.anchorNode==this.anchorNode&&sel.anchorOffset==this.anchorOffset&&sel.focusNode==this.focusNode&&sel.focusOffset==this.focusOffset}}class DOMObserver{constructor(view,handleDOMChange){this.view=view,this.handleDOMChange=handleDOMChange,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new SelectionState,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver((mutations=>{for(let i=0;i<mutations.length;i++)this.queue.push(mutations[i]);ie&&ie_version<=11&&mutations.some((m=>"childList"==m.type&&m.removedNodes.length||"characterData"==m.type&&m.oldValue.length>m.target.nodeValue.length))?this.flushSoon():this.flush()})),useCharData&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout((()=>{this.flushingSoon=-1,this.flush()}),20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,observeOptions)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let take=this.observer.takeRecords();if(take.length){for(let i=0;i<take.length;i++)this.queue.push(take[i]);window.setTimeout((()=>this.flush()),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout((()=>this.suppressingSelectionUpdates=!1),50)}onSelectionChange(){if(hasFocusAndSelection(this.view)){if(this.suppressingSelectionUpdates)return selectionToDOM(this.view);if(ie&&ie_version<=11&&!this.view.state.selection.empty){let sel=this.view.domSelectionRange();if(sel.focusNode&&isEquivalentPosition(sel.focusNode,sel.focusOffset,sel.anchorNode,sel.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(sel){if(!sel.focusNode)return!0;let container,ancestors=new Set;for(let scan=sel.focusNode;scan;scan=parentNode(scan))ancestors.add(scan);for(let scan=sel.anchorNode;scan;scan=parentNode(scan))if(ancestors.has(scan)){container=scan;break}let desc=container&&this.view.docView.nearestDesc(container);return desc&&desc.ignoreMutation({type:"selection",target:3==container.nodeType?container.parentNode:container})?(this.setCurSelection(),!0):void 0}pendingRecords(){if(this.observer)for(let mut of this.observer.takeRecords())this.queue.push(mut);return this.queue}flush(){let{view}=this;if(!view.docView||this.flushingSoon>-1)return;let mutations=this.pendingRecords();mutations.length&&(this.queue=[]);let sel=view.domSelectionRange(),newSel=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(sel)&&hasFocusAndSelection(view)&&!this.ignoreSelectionChange(sel),from=-1,to=-1,typeOver=!1,added=[];if(view.editable)for(let i=0;i<mutations.length;i++){let result=this.registerMutation(mutations[i],added);result&&(from=from<0?result.from:Math.min(result.from,from),to=to<0?result.to:Math.max(result.to,to),result.typeOver&&(typeOver=!0))}if(gecko&&added.length){let brs=added.filter((n=>"BR"==n.nodeName));if(2==brs.length){let[a,b]=brs;a.parentNode&&a.parentNode.parentNode==b.parentNode?b.remove():a.remove()}else{let{focusNode}=this.currentSelection;for(let br of brs){let parent=br.parentNode;!parent||"LI"!=parent.nodeName||focusNode&&blockParent(view,focusNode)==parent||br.remove()}}}let readSel=null;from<0&&newSel&&view.input.lastFocus>Date.now()-200&&Math.max(view.input.lastTouch,view.input.lastClick.time)<Date.now()-300&&selectionCollapsed(sel)&&(readSel=selectionFromDOM(view))&&readSel.eq(prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.LN.near(view.state.doc.resolve(0),1))?(view.input.lastFocus=0,selectionToDOM(view),this.currentSelection.set(sel),view.scrollToSelection()):(from>-1||newSel)&&(from>-1&&(view.docView.markDirty(from,to),function checkCSS(view){if(cssChecked.has(view))return;if(cssChecked.set(view,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(view.dom).whiteSpace)){if(view.requiresGeckoHackNode=gecko,cssCheckWarned)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),cssCheckWarned=!0}}(view)),this.handleDOMChange(from,to,typeOver,added),view.docView&&view.docView.dirty?view.updateState(view.state):this.currentSelection.eq(sel)||selectionToDOM(view),this.currentSelection.set(sel))}registerMutation(mut,added){if(added.indexOf(mut.target)>-1)return null;let desc=this.view.docView.nearestDesc(mut.target);if("attributes"==mut.type&&(desc==this.view.docView||"contenteditable"==mut.attributeName||"style"==mut.attributeName&&!mut.oldValue&&!mut.target.getAttribute("style")))return null;if(!desc||desc.ignoreMutation(mut))return null;if("childList"==mut.type){for(let i=0;i<mut.addedNodes.length;i++){let node=mut.addedNodes[i];added.push(node),3==node.nodeType&&(this.lastChangedTextNode=node)}if(desc.contentDOM&&desc.contentDOM!=desc.dom&&!desc.contentDOM.contains(mut.target))return{from:desc.posBefore,to:desc.posAfter};let prev=mut.previousSibling,next=mut.nextSibling;if(ie&&ie_version<=11&&mut.addedNodes.length)for(let i=0;i<mut.addedNodes.length;i++){let{previousSibling,nextSibling}=mut.addedNodes[i];(!previousSibling||Array.prototype.indexOf.call(mut.addedNodes,previousSibling)<0)&&(prev=previousSibling),(!nextSibling||Array.prototype.indexOf.call(mut.addedNodes,nextSibling)<0)&&(next=nextSibling)}let fromOffset=prev&&prev.parentNode==mut.target?domIndex(prev)+1:0,from=desc.localPosFromDOM(mut.target,fromOffset,-1),toOffset=next&&next.parentNode==mut.target?domIndex(next):mut.target.childNodes.length;return{from,to:desc.localPosFromDOM(mut.target,toOffset,1)}}return"attributes"==mut.type?{from:desc.posAtStart-desc.border,to:desc.posAtEnd+desc.border}:(this.lastChangedTextNode=mut.target,{from:desc.posAtStart,to:desc.posAtEnd,typeOver:mut.target.nodeValue==mut.oldValue})}}let cssChecked=new WeakMap,cssCheckWarned=!1;function rangeToSelectionRange(view,range){let anchorNode=range.startContainer,anchorOffset=range.startOffset,focusNode=range.endContainer,focusOffset=range.endOffset,currentAnchor=view.domAtPos(view.state.selection.anchor);return isEquivalentPosition(currentAnchor.node,currentAnchor.offset,focusNode,focusOffset)&&([anchorNode,anchorOffset,focusNode,focusOffset]=[focusNode,focusOffset,anchorNode,anchorOffset]),{anchorNode,anchorOffset,focusNode,focusOffset}}function blockParent(view,node){for(let p=node.parentNode;p&&p!=view.dom;p=p.parentNode){let desc=view.docView.nearestDesc(p,!0);if(desc&&desc.node.isBlock)return p}return null}function ruleFromNode(dom){let desc=dom.pmViewDesc;if(desc)return desc.parseRule();if("BR"==dom.nodeName&&dom.parentNode){if(safari&&/^(ul|ol)$/i.test(dom.parentNode.nodeName)){let skip=document.createElement("div");return skip.appendChild(document.createElement("li")),{skip}}if(dom.parentNode.lastChild==dom||safari&&/^(tr|table)$/i.test(dom.parentNode.nodeName))return{ignore:!0}}else if("IMG"==dom.nodeName&&dom.getAttribute("mark-placeholder"))return{ignore:!0};return null}const isInline=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function readDOMChange(view,from,to,typeOver,addedNodes){let compositionID=view.input.compositionPendingChanges||(view.composing?view.input.compositionID:0);if(view.input.compositionPendingChanges=0,from<0){let origin=view.input.lastSelectionTime>Date.now()-50?view.input.lastSelectionOrigin:null,newSel=selectionFromDOM(view,origin);if(newSel&&!view.state.selection.eq(newSel)){if(chrome&&android&&13===view.input.lastKeyCode&&Date.now()-100<view.input.lastKeyCodeTime&&view.someProp("handleKeyDown",(f=>f(view,keyEvent(13,"Enter")))))return;let tr=view.state.tr.setSelection(newSel);"pointer"==origin?tr.setMeta("pointer",!0):"key"==origin&&tr.scrollIntoView(),compositionID&&tr.setMeta("composition",compositionID),view.dispatch(tr)}return}let $before=view.state.doc.resolve(from),shared=$before.sharedDepth(to);from=$before.before(shared+1),to=view.state.doc.resolve(to).after(shared+1);let preferredPos,preferredSide,sel=view.state.selection,parse=function parseBetween(view,from_,to_){let find,{node:parent,fromOffset,toOffset,from,to}=view.docView.parseRange(from_,to_),domSel=view.domSelectionRange(),anchor=domSel.anchorNode;if(anchor&&view.dom.contains(1==anchor.nodeType?anchor:anchor.parentNode)&&(find=[{node:anchor,offset:domSel.anchorOffset}],selectionCollapsed(domSel)||find.push({node:domSel.focusNode,offset:domSel.focusOffset})),chrome&&8===view.input.lastKeyCode)for(let off=toOffset;off>fromOffset;off--){let node=parent.childNodes[off-1],desc=node.pmViewDesc;if("BR"==node.nodeName&&!desc){toOffset=off;break}if(!desc||desc.size)break}let startDoc=view.state.doc,parser=view.someProp("domParser")||prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.S4.fromSchema(view.state.schema),$from=startDoc.resolve(from),sel=null,doc=parser.parse(parent,{topNode:$from.parent,topMatch:$from.parent.contentMatchAt($from.index()),topOpen:!0,from:fromOffset,to:toOffset,preserveWhitespace:"pre"!=$from.parent.type.whitespace||"full",findPositions:find,ruleFromNode,context:$from});if(find&&null!=find[0].pos){let anchor=find[0].pos,head=find[1]&&find[1].pos;null==head&&(head=anchor),sel={anchor:anchor+from,head:head+from}}return{doc,sel,from,to}}(view,from,to),doc=view.state.doc,compare=doc.slice(parse.from,parse.to);8===view.input.lastKeyCode&&Date.now()-100<view.input.lastKeyCodeTime?(preferredPos=view.state.selection.to,preferredSide="end"):(preferredPos=view.state.selection.from,preferredSide="start"),view.input.lastKeyCode=null;let change=function findDiff(a,b,pos,preferredPos,preferredSide){let start=a.findDiffStart(b,pos);if(null==start)return null;let{a:endA,b:endB}=a.findDiffEnd(b,pos+a.size,pos+b.size);if("end"==preferredSide){preferredPos-=endA+Math.max(0,start-Math.min(endA,endB))-start}if(endA<start&&a.size<b.size){let move=preferredPos<=start&&preferredPos>=endA?start-preferredPos:0;start-=move,start&&start<b.size&&isSurrogatePair(b.textBetween(start-1,start+1))&&(start+=move?1:-1),endB=start+(endB-endA),endA=start}else if(endB<start){let move=preferredPos<=start&&preferredPos>=endB?start-preferredPos:0;start-=move,start&&start<a.size&&isSurrogatePair(a.textBetween(start-1,start+1))&&(start+=move?1:-1),endA=start+(endA-endB),endB=start}return{start,endA,endB}}(compare.content,parse.doc.content,parse.from,preferredPos,preferredSide);if(change&&view.input.domChangeCount++,(ios&&view.input.lastIOSEnter>Date.now()-225||android)&&addedNodes.some((n=>1==n.nodeType&&!isInline.test(n.nodeName)))&&(!change||change.endA>=change.endB)&&view.someProp("handleKeyDown",(f=>f(view,keyEvent(13,"Enter")))))return void(view.input.lastIOSEnter=0);if(!change){if(!(typeOver&&sel instanceof prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.U3&&!sel.empty&&sel.$head.sameParent(sel.$anchor))||view.composing||parse.sel&&parse.sel.anchor!=parse.sel.head){if(parse.sel){let sel=resolveSelection(view,view.state.doc,parse.sel);if(sel&&!sel.eq(view.state.selection)){let tr=view.state.tr.setSelection(sel);compositionID&&tr.setMeta("composition",compositionID),view.dispatch(tr)}}return}change={start:sel.from,endA:sel.to,endB:sel.to}}view.state.selection.from<view.state.selection.to&&change.start==change.endB&&view.state.selection instanceof prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.U3&&(change.start>view.state.selection.from&&change.start<=view.state.selection.from+2&&view.state.selection.from>=parse.from?change.start=view.state.selection.from:change.endA<view.state.selection.to&&change.endA>=view.state.selection.to-2&&view.state.selection.to<=parse.to&&(change.endB+=view.state.selection.to-change.endA,change.endA=view.state.selection.to)),ie&&ie_version<=11&&change.endB==change.start+1&&change.endA==change.start&&change.start>parse.from&&" Â "==parse.doc.textBetween(change.start-parse.from-1,change.start-parse.from+1)&&(change.start--,change.endA--,change.endB--);let nextSel,$from=parse.doc.resolveNoCache(change.start-parse.from),$to=parse.doc.resolveNoCache(change.endB-parse.from),$fromA=doc.resolve(change.start),inlineChange=$from.sameParent($to)&&$from.parent.inlineContent&&$fromA.end()>=change.endA;if((ios&&view.input.lastIOSEnter>Date.now()-225&&(!inlineChange||addedNodes.some((n=>"DIV"==n.nodeName||"P"==n.nodeName)))||!inlineChange&&$from.pos<parse.doc.content.size&&(!$from.sameParent($to)||!$from.parent.inlineContent)&&!/\S/.test(parse.doc.textBetween($from.pos,$to.pos,"",""))&&(nextSel=prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.LN.findFrom(parse.doc.resolve($from.pos+1),1,!0))&&nextSel.head>$from.pos)&&view.someProp("handleKeyDown",(f=>f(view,keyEvent(13,"Enter")))))return void(view.input.lastIOSEnter=0);if(view.state.selection.anchor>change.start&&function looksLikeBackspace(old,start,end,$newStart,$newEnd){if(end-start<=$newEnd.pos-$newStart.pos||skipClosingAndOpening($newStart,!0,!1)<$newEnd.pos)return!1;let $start=old.resolve(start);if(!$newStart.parent.isTextblock){let after=$start.nodeAfter;return null!=after&&end==start+after.nodeSize}if($start.parentOffset<$start.parent.content.size||!$start.parent.isTextblock)return!1;let $next=old.resolve(skipClosingAndOpening($start,!0,!0));return!(!$next.parent.isTextblock||$next.pos>end||skipClosingAndOpening($next,!0,!1)<end)&&$newStart.parent.content.cut($newStart.parentOffset).eq($next.parent.content)}(doc,change.start,change.endA,$from,$to)&&view.someProp("handleKeyDown",(f=>f(view,keyEvent(8,"Backspace")))))return void(android&&chrome&&view.domObserver.suppressSelectionUpdates());chrome&&change.endB==change.start&&(view.input.lastChromeDelete=Date.now()),android&&!inlineChange&&$from.start()!=$to.start()&&0==$to.parentOffset&&$from.depth==$to.depth&&parse.sel&&parse.sel.anchor==parse.sel.head&&parse.sel.head==change.endA&&(change.endB-=2,$to=parse.doc.resolveNoCache(change.endB-parse.from),setTimeout((()=>{view.someProp("handleKeyDown",(function(f){return f(view,keyEvent(13,"Enter"))}))}),20));let tr,storedMarks,markChange,chFrom=change.start,chTo=change.endA;if(inlineChange)if($from.pos==$to.pos)ie&&ie_version<=11&&0==$from.parentOffset&&(view.domObserver.suppressSelectionUpdates(),setTimeout((()=>selectionToDOM(view)),20)),tr=view.state.tr.delete(chFrom,chTo),storedMarks=doc.resolve(change.start).marksAcross(doc.resolve(change.endA));else if(change.endA==change.endB&&(markChange=function isMarkChange(cur,prev){let type,mark,update,curMarks=cur.firstChild.marks,prevMarks=prev.firstChild.marks,added=curMarks,removed=prevMarks;for(let i=0;i<prevMarks.length;i++)added=prevMarks[i].removeFromSet(added);for(let i=0;i<curMarks.length;i++)removed=curMarks[i].removeFromSet(removed);if(1==added.length&&0==removed.length)mark=added[0],type="add",update=node=>node.mark(mark.addToSet(node.marks));else{if(0!=added.length||1!=removed.length)return null;mark=removed[0],type="remove",update=node=>node.mark(mark.removeFromSet(node.marks))}let updated=[];for(let i=0;i<prev.childCount;i++)updated.push(update(prev.child(i)));if(prosemirror_model__WEBPACK_IMPORTED_MODULE_0__.FK.from(updated).eq(cur))return{mark,type}}($from.parent.content.cut($from.parentOffset,$to.parentOffset),$fromA.parent.content.cut($fromA.parentOffset,change.endA-$fromA.start()))))tr=view.state.tr,"add"==markChange.type?tr.addMark(chFrom,chTo,markChange.mark):tr.removeMark(chFrom,chTo,markChange.mark);else if($from.parent.child($from.index()).isText&&$from.index()==$to.index()-($to.textOffset?0:1)){let text=$from.parent.textBetween($from.parentOffset,$to.parentOffset);if(view.someProp("handleTextInput",(f=>f(view,chFrom,chTo,text))))return;tr=view.state.tr.insertText(text,chFrom,chTo)}if(tr||(tr=view.state.tr.replace(chFrom,chTo,parse.doc.slice(change.start-parse.from,change.endB-parse.from))),parse.sel){let sel=resolveSelection(view,tr.doc,parse.sel);sel&&!(chrome&&view.composing&&sel.empty&&(change.start!=change.endB||view.input.lastChromeDelete<Date.now()-100)&&(sel.head==chFrom||sel.head==tr.mapping.map(chTo)-1)||ie&&sel.empty&&sel.head==chFrom)&&tr.setSelection(sel)}storedMarks&&tr.ensureMarks(storedMarks),compositionID&&tr.setMeta("composition",compositionID),view.dispatch(tr.scrollIntoView())}function resolveSelection(view,doc,parsedSel){return Math.max(parsedSel.anchor,parsedSel.head)>doc.content.size?null:selectionBetween(view,doc.resolve(parsedSel.anchor),doc.resolve(parsedSel.head))}function skipClosingAndOpening($pos,fromEnd,mayOpen){let depth=$pos.depth,end=fromEnd?$pos.end():$pos.pos;for(;depth>0&&(fromEnd||$pos.indexAfter(depth)==$pos.node(depth).childCount);)depth--,end++,fromEnd=!1;if(mayOpen){let next=$pos.node(depth).maybeChild($pos.indexAfter(depth));for(;next&&!next.isLeaf;)next=next.firstChild,end++}return end}function isSurrogatePair(str){if(2!=str.length)return!1;let a=str.charCodeAt(0),b=str.charCodeAt(1);return a>=56320&&a<=57343&&b>=55296&&b<=56319}class EditorView{constructor(place,props){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new InputState,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=props,this.state=props.state,this.directPlugins=props.plugins||[],this.directPlugins.forEach(checkStateComponent),this.dispatch=this.dispatch.bind(this),this.dom=place&&place.mount||document.createElement("div"),place&&(place.appendChild?place.appendChild(this.dom):"function"==typeof place?place(this.dom):place.mount&&(this.mounted=!0)),this.editable=getEditable(this),updateCursorWrapper(this),this.nodeViews=buildNodeViews(this),this.docView=docViewDesc(this.state.doc,computeDocDeco(this),viewDecorations(this),this.dom,this),this.domObserver=new DOMObserver(this,((from,to,typeOver,added)=>readDOMChange(this,from,to,typeOver,added))),this.domObserver.start(),function initInput(view){for(let event in handlers){let handler=handlers[event];view.dom.addEventListener(event,view.input.eventHandlers[event]=event=>{!eventBelongsToView(view,event)||runCustomHandler(view,event)||!view.editable&&event.type in editHandlers||handler(view,event)},passiveHandlers[event]?{passive:!0}:void 0)}safari&&view.dom.addEventListener("input",(()=>null)),ensureListeners(view)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let prev=this._props;this._props={};for(let name in prev)this._props[name]=prev[name];this._props.state=this.state}return this._props}update(props){props.handleDOMEvents!=this._props.handleDOMEvents&&ensureListeners(this);let prevProps=this._props;this._props=props,props.plugins&&(props.plugins.forEach(checkStateComponent),this.directPlugins=props.plugins),this.updateStateInner(props.state,prevProps)}setProps(props){let updated={};for(let name in this._props)updated[name]=this._props[name];updated.state=this.state;for(let name in props)updated[name]=props[name];this.update(updated)}updateState(state){this.updateStateInner(state,this._props)}updateStateInner(state,prevProps){var _a;let prev=this.state,redraw=!1,updateSel=!1;state.storedMarks&&this.composing&&(clearComposition(this),updateSel=!0),this.state=state;let pluginsChanged=prev.plugins!=state.plugins||this._props.plugins!=prevProps.plugins;if(pluginsChanged||this._props.plugins!=prevProps.plugins||this._props.nodeViews!=prevProps.nodeViews){let nodeViews=buildNodeViews(this);(function changedNodeViews(a,b){let nA=0,nB=0;for(let prop in a){if(a[prop]!=b[prop])return!0;nA++}for(let _ in b)nB++;return nA!=nB})(nodeViews,this.nodeViews)&&(this.nodeViews=nodeViews,redraw=!0)}(pluginsChanged||prevProps.handleDOMEvents!=this._props.handleDOMEvents)&&ensureListeners(this),this.editable=getEditable(this),updateCursorWrapper(this);let innerDeco=viewDecorations(this),outerDeco=computeDocDeco(this),scroll=prev.plugins==state.plugins||prev.doc.eq(state.doc)?state.scrollToSelection>prev.scrollToSelection?"to selection":"preserve":"reset",updateDoc=redraw||!this.docView.matchesNode(state.doc,outerDeco,innerDeco);!updateDoc&&state.selection.eq(prev.selection)||(updateSel=!0);let oldScrollPos="preserve"==scroll&&updateSel&&null==this.dom.style.overflowAnchor&&function storeScrollPos(view){let refDOM,refTop,rect=view.dom.getBoundingClientRect(),startY=Math.max(0,rect.top);for(let x=(rect.left+rect.right)/2,y=startY+1;y<Math.min(innerHeight,rect.bottom);y+=5){let dom=view.root.elementFromPoint(x,y);if(!dom||dom==view.dom||!view.dom.contains(dom))continue;let localRect=dom.getBoundingClientRect();if(localRect.top>=startY-20){refDOM=dom,refTop=localRect.top;break}}return{refDOM,refTop,stack:scrollStack(view.dom)}}(this);if(updateSel){this.domObserver.stop();let forceSelUpdate=updateDoc&&(ie||chrome)&&!this.composing&&!prev.selection.empty&&!state.selection.empty&&function selectionContextChanged(sel1,sel2){let depth=Math.min(sel1.$anchor.sharedDepth(sel1.head),sel2.$anchor.sharedDepth(sel2.head));return sel1.$anchor.start(depth)!=sel2.$anchor.start(depth)}(prev.selection,state.selection);if(updateDoc){let chromeKludge=chrome?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=findCompositionNode(this)),!redraw&&this.docView.update(state.doc,outerDeco,innerDeco,this)||(this.docView.updateOuterDeco(outerDeco),this.docView.destroy(),this.docView=docViewDesc(state.doc,outerDeco,innerDeco,this.dom,this)),chromeKludge&&!this.trackWrites&&(forceSelUpdate=!0)}forceSelUpdate||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&function anchorInRightPlace(view){let anchorDOM=view.docView.domFromPos(view.state.selection.anchor,0),domSel=view.domSelectionRange();return isEquivalentPosition(anchorDOM.node,anchorDOM.offset,domSel.anchorNode,domSel.anchorOffset)}(this))?selectionToDOM(this,forceSelUpdate):(syncNodeSelection(this,state.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(prev),(null===(_a=this.dragging)||void 0===_a?void 0:_a.node)&&!prev.doc.eq(state.doc)&&this.updateDraggedNode(this.dragging,prev),"reset"==scroll?this.dom.scrollTop=0:"to selection"==scroll?this.scrollToSelection():oldScrollPos&&function resetScrollPos({refDOM,refTop,stack}){let newRefTop=refDOM?refDOM.getBoundingClientRect().top:0;restoreScrollStack(stack,0==newRefTop?0:newRefTop-refTop)}(oldScrollPos)}scrollToSelection(){let startDOM=this.domSelectionRange().focusNode;if(startDOM&&this.dom.contains(1==startDOM.nodeType?startDOM:startDOM.parentNode))if(this.someProp("handleScrollToSelection",(f=>f(this))));else if(this.state.selection instanceof prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh){let target=this.docView.domAfterPos(this.state.selection.from);1==target.nodeType&&scrollRectIntoView(this,target.getBoundingClientRect(),startDOM)}else scrollRectIntoView(this,this.coordsAtPos(this.state.selection.head,1),startDOM);else;}destroyPluginViews(){let view;for(;view=this.pluginViews.pop();)view.destroy&&view.destroy()}updatePluginViews(prevState){if(prevState&&prevState.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let i=0;i<this.pluginViews.length;i++){let pluginView=this.pluginViews[i];pluginView.update&&pluginView.update(this,prevState)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let i=0;i<this.directPlugins.length;i++){let plugin=this.directPlugins[i];plugin.spec.view&&this.pluginViews.push(plugin.spec.view(this))}for(let i=0;i<this.state.plugins.length;i++){let plugin=this.state.plugins[i];plugin.spec.view&&this.pluginViews.push(plugin.spec.view(this))}}}updateDraggedNode(dragging,prev){let sel=dragging.node,found=-1;if(this.state.doc.nodeAt(sel.from)==sel.node)found=sel.from;else{let movedPos=sel.from+(this.state.doc.content.size-prev.doc.content.size);(movedPos>0&&this.state.doc.nodeAt(movedPos))==sel.node&&(found=movedPos)}this.dragging=new Dragging(dragging.slice,dragging.move,found<0?void 0:prosemirror_state__WEBPACK_IMPORTED_MODULE_1__.nh.create(this.state.doc,found))}someProp(propName,f){let value,prop=this._props&&this._props[propName];if(null!=prop&&(value=f?f(prop):prop))return value;for(let i=0;i<this.directPlugins.length;i++){let prop=this.directPlugins[i].props[propName];if(null!=prop&&(value=f?f(prop):prop))return value}let plugins=this.state.plugins;if(plugins)for(let i=0;i<plugins.length;i++){let prop=plugins[i].props[propName];if(null!=prop&&(value=f?f(prop):prop))return value}}hasFocus(){if(ie){let node=this.root.activeElement;if(node==this.dom)return!0;if(!node||!this.dom.contains(node))return!1;for(;node&&this.dom!=node&&this.dom.contains(node);){if("false"==node.contentEditable)return!1;node=node.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function focusPreventScroll(dom){if(dom.setActive)return dom.setActive();if(preventScrollSupported)return dom.focus(preventScrollSupported);let stored=scrollStack(dom);dom.focus(null==preventScrollSupported?{get preventScroll(){return preventScrollSupported={preventScroll:!0},!0}}:void 0),preventScrollSupported||(preventScrollSupported=!1,restoreScrollStack(stored,0))}(this.dom),selectionToDOM(this),this.domObserver.start()}get root(){let cached=this._root;if(null==cached)for(let search=this.dom.parentNode;search;search=search.parentNode)if(9==search.nodeType||11==search.nodeType&&search.host)return search.getSelection||(Object.getPrototypeOf(search).getSelection=()=>search.ownerDocument.getSelection()),this._root=search;return cached||document}updateRoot(){this._root=null}posAtCoords(coords){return posAtCoords(this,coords)}coordsAtPos(pos,side=1){return coordsAtPos(this,pos,side)}domAtPos(pos,side=0){return this.docView.domFromPos(pos,side)}nodeDOM(pos){let desc=this.docView.descAt(pos);return desc?desc.nodeDOM:null}posAtDOM(node,offset,bias=-1){let pos=this.docView.posFromDOM(node,offset,bias);if(null==pos)throw new RangeError("DOM position not inside the editor");return pos}endOfTextblock(dir,state){return endOfTextblock(this,state||this.state,dir)}pasteHTML(html,event){return doPaste(this,"",html,!1,event||new ClipboardEvent("paste"))}pasteText(text,event){return doPaste(this,text,null,!0,event||new ClipboardEvent("paste"))}serializeForClipboard(slice){return serializeForClipboard(this,slice)}destroy(){this.docView&&(!function destroyInput(view){view.domObserver.stop();for(let type in view.input.eventHandlers)view.dom.removeEventListener(type,view.input.eventHandlers[type]);clearTimeout(view.input.composingTimeout),clearTimeout(view.input.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],viewDecorations(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,reusedRange=null)}get isDestroyed(){return null==this.docView}dispatchEvent(event){return function dispatchEvent(view,event){runCustomHandler(view,event)||!handlers[event.type]||!view.editable&&event.type in editHandlers||handlers[event.type](view,event)}(this,event)}dispatch(tr){let dispatchTransaction=this._props.dispatchTransaction;dispatchTransaction?dispatchTransaction.call(this,tr):this.updateState(this.state.apply(tr))}domSelectionRange(){let sel=this.domSelection();return sel?safari&&11===this.root.nodeType&&function deepActiveElement(doc){let elt=doc.activeElement;for(;elt&&elt.shadowRoot;)elt=elt.shadowRoot.activeElement;return elt}(this.dom.ownerDocument)==this.dom&&function safariShadowSelectionRange(view,selection){if(selection.getComposedRanges){let range=selection.getComposedRanges(view.root)[0];if(range)return rangeToSelectionRange(view,range)}let found;function read(event){event.preventDefault(),event.stopImmediatePropagation(),found=event.getTargetRanges()[0]}return view.dom.addEventListener("beforeinput",read,!0),document.execCommand("indent"),view.dom.removeEventListener("beforeinput",read,!0),found?rangeToSelectionRange(view,found):null}(this,sel)||sel:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}function computeDocDeco(view){let attrs=Object.create(null);return attrs.class="ProseMirror",attrs.contenteditable=String(view.editable),view.someProp("attributes",(value=>{if("function"==typeof value&&(value=value(view.state)),value)for(let attr in value)"class"==attr?attrs.class+=" "+value[attr]:"style"==attr?attrs.style=(attrs.style?attrs.style+";":"")+value[attr]:attrs[attr]||"contenteditable"==attr||"nodeName"==attr||(attrs[attr]=String(value[attr]))})),attrs.translate||(attrs.translate="no"),[Decoration.node(0,view.state.doc.content.size,attrs)]}function updateCursorWrapper(view){if(view.markCursor){let dom=document.createElement("img");dom.className="ProseMirror-separator",dom.setAttribute("mark-placeholder","true"),dom.setAttribute("alt",""),view.cursorWrapper={dom,deco:Decoration.widget(view.state.selection.from,dom,{raw:!0,marks:view.markCursor})}}else view.cursorWrapper=null}function getEditable(view){return!view.someProp("editable",(value=>!1===value(view.state)))}function buildNodeViews(view){let result=Object.create(null);function add(obj){for(let prop in obj)Object.prototype.hasOwnProperty.call(result,prop)||(result[prop]=obj[prop])}return view.someProp("nodeViews",add),view.someProp("markViews",add),result}function checkStateComponent(plugin){if(plugin.spec.state||plugin.spec.filterTransaction||plugin.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}},"./node_modules/@tldraw/tldraw/tldraw.css":(__unused_webpack_module,__unused_webpack___webpack_exports__,__webpack_require__)=>{"use strict";var _style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0__),_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1__),_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/style-loader/dist/runtime/insertBySelector.js"),_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2__),_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3__),_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4__),_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5__),_css_loader_dist_cjs_js_ruleSet_1_rules_7_use_1_storybook_addon_styling_node_modules_postcss_loader_dist_cjs_js_ruleSet_1_rules_7_use_2_tldraw_css__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[7].use[1]!./node_modules/@storybook/addon-styling/node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[7].use[2]!./node_modules/@tldraw/tldraw/tldraw.css"),options={};options.styleTagTransform=_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5___default(),options.setAttributes=_style_loader_dist_runtime_setAttributesWithoutAttributes_js__WEBPACK_IMPORTED_MODULE_3___default(),options.insert=_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2___default().bind(null,"head"),options.domAPI=_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1___default(),options.insertStyleElement=_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4___default();_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0___default()(_css_loader_dist_cjs_js_ruleSet_1_rules_7_use_1_storybook_addon_styling_node_modules_postcss_loader_dist_cjs_js_ruleSet_1_rules_7_use_2_tldraw_css__WEBPACK_IMPORTED_MODULE_6__.A,options),_css_loader_dist_cjs_js_ruleSet_1_rules_7_use_1_storybook_addon_styling_node_modules_postcss_loader_dist_cjs_js_ruleSet_1_rules_7_use_2_tldraw_css__WEBPACK_IMPORTED_MODULE_6__.A&&_css_loader_dist_cjs_js_ruleSet_1_rules_7_use_1_storybook_addon_styling_node_modules_postcss_loader_dist_cjs_js_ruleSet_1_rules_7_use_2_tldraw_css__WEBPACK_IMPORTED_MODULE_6__.A.locals&&_css_loader_dist_cjs_js_ruleSet_1_rules_7_use_1_storybook_addon_styling_node_modules_postcss_loader_dist_cjs_js_ruleSet_1_rules_7_use_2_tldraw_css__WEBPACK_IMPORTED_MODULE_6__.A.locals}}]);