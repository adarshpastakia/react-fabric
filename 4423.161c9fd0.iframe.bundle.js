"use strict";(self.webpackChunkreact_fabric=self.webpackChunkreact_fabric||[]).push([[4423],{"./packages/lexical/src/components/StickyComponent.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{StickyComponent:()=>StickyComponent});var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),LexicalAutoFocusPlugin_prod=__webpack_require__("./node_modules/@lexical/react/LexicalAutoFocusPlugin.prod.mjs"),LexicalComposerContext_prod=__webpack_require__("./node_modules/@lexical/react/LexicalComposerContext.prod.mjs"),LexicalContentEditable_prod=__webpack_require__("./node_modules/@lexical/react/LexicalContentEditable.prod.mjs"),LexicalErrorBoundary_prod=__webpack_require__("./node_modules/@lexical/react/LexicalErrorBoundary.prod.mjs"),react=__webpack_require__("./node_modules/react/index.js");const o=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],b=o[Math.floor(Math.random()*o.length)],e=(0,react.createContext)({clientID:0,color:b[1],isCollabActive:!1,name:b[0],yjsDocMap:new Map});var c=function s(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}((function(e){const t=new URLSearchParams;t.append("code",e);for(let e=1;e<arguments.length;e++)t.append("v",arguments[e]);throw Error(`Minified Lexical error #${e}; visit https://lexical.dev/docs/error?${t} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}));function p(e){const t=e.transform();return null!==t?new Set([t]):new Set}function d({initialEditor:s,children:d,initialNodes:f,initialTheme:u,skipCollabChecks:m}){const h=(0,react.useRef)(!1),x=(0,react.useContext)(LexicalComposerContext_prod.Gu);null==x&&c(9);const[_,{getTheme:g}]=x,v=(0,react.useMemo)((()=>{const e=u||g()||void 0,t=(0,LexicalComposerContext_prod.Mx)(x,e);if(void 0!==e&&(s._config.theme=e),s._parentEditor=_,f)for(let e of f){let t=null,r=null;if("function"!=typeof e){const o=e;e=o.replace,t=o.with,r=o.withKlass||null}const o=s._nodes.get(e.getType());s._nodes.set(e.getType(),{exportDOM:o?o.exportDOM:void 0,klass:e,replace:t,replaceWithKlass:r,transforms:p(e)})}else{const e=s._nodes=new Map(_._nodes);for(const[t,r]of e)s._nodes.set(t,{exportDOM:r.exportDOM,klass:r.klass,replace:r.replace,replaceWithKlass:r.replaceWithKlass,transforms:p(r.klass)})}return s._config.namespace=_._config.namespace,s._editable=_._editable,[s,t]}),[]),{isCollabActive:w,yjsDocMap:b}=function l(r,o){const b=(0,react.useContext)(e);return null!=r&&(b.name=r),null!=o&&(b.color=o),b}(),M=m||h.current||b.has(s.getKey());return(0,react.useEffect)((()=>{M&&(h.current=!0)}),[M]),(0,react.useEffect)((()=>_.registerEditableListener((e=>{s.setEditable(e)}))),[s,_]),(0,jsx_runtime.jsx)(LexicalComposerContext_prod.Gu.Provider,{value:v,children:!w||M?d:null})}var LexicalRichTextPlugin_prod=__webpack_require__("./node_modules/@lexical/react/LexicalRichTextPlugin.prod.mjs"),mdi=__webpack_require__("./node_modules/@mdi/js/mdi.js"),esm=__webpack_require__("./packages/core/dist/esm/index.js"),Lexical_prod=__webpack_require__("./node_modules/lexical/Lexical.prod.mjs"),StickyNode=__webpack_require__("./packages/lexical/src/nodes/StickyNode.tsx");function positionSticky(stickyElem,positioning){const style=stickyElem.style;style.top=`${positioning.y}px`,style.left=`${positioning.x}px`}const StickyComponent=({x=0,y=0,nodeKey,color,state,user})=>{const[editor]=(0,LexicalComposerContext_prod.DF)(),stickyContainerRef=(0,react.useRef)(null),positioningRef=(0,react.useRef)({isDragging:!1,offsetX:0,offsetY:0,rootElementRect:{left:8,top:8},x:8,y:8});(0,react.useEffect)((()=>{const position=positioningRef.current;position.x=x,position.y=y;const stickyContainer=stickyContainerRef.current;null!==stickyContainer&&(positioningRef.current.rootElementRect={left:x,top:y},positionSticky(stickyContainer,position))}),[x,y]),(0,react.useEffect)((()=>{const stickyContainer=stickyContainerRef.current;null!==stickyContainer&&setTimeout((()=>{stickyContainer.style.setProperty("transition","top 300ms ease 0s, left 300ms ease 0s")}),500)}),[]);const handlePointerMove=event=>{const stickyContainer=stickyContainerRef.current,positioning=positioningRef.current,rootElementRect=positioning.rootElementRect;null!==stickyContainer&&positioning.isDragging&&null!==rootElementRect&&(positioning.x=rootElementRect.left+(event.pageX-positioning.offsetX),positioning.y=rootElementRect.top+(event.pageY-positioning.offsetY),positioning.x<0&&(positioning.x=0),positioning.x>642&&(positioning.x=642-stickyContainer.offsetWidth),positioning.y<0&&(positioning.y=0),positionSticky(stickyContainer,positioning))},handlePointerUp=event=>{const stickyContainer=stickyContainerRef.current,positioning=positioningRef.current;null!==stickyContainer&&(positioning.isDragging=!1,stickyContainer.classList.remove("dragging"),editor.update((()=>{const node=(0,Lexical_prod.ns)(nodeKey);(0,StickyNode.oL)(node)&&node.setPosition(positioning.x,positioning.y)}))),document.removeEventListener("pointermove",handlePointerMove),document.removeEventListener("pointerup",handlePointerUp)},innerEditor=(0,react.useMemo)((()=>{const editor=(0,Lexical_prod.ie)({editable:!0});if(state){const editorState=editor.parseEditorState(state);editor.setEditorState(editorState)}return editor}),[]);return(0,react.useEffect)((()=>{if(innerEditor._editable){const dispose=innerEditor.registerUpdateListener((({editorState})=>{editor.update((()=>{const node=(0,Lexical_prod.ns)(nodeKey);(0,StickyNode.oL)(node)&&node.updateState(innerEditor.getEditorState().toJSON())}))}));return()=>{dispose()}}}),[innerEditor._editable]),(0,jsx_runtime.jsxs)("div",{ref:stickyContainerRef,className:"sticky__container",children:[(0,jsx_runtime.jsx)("div",{className:"sticky__handle",onPointerDown:event=>{const stickyContainer=stickyContainerRef.current;if(null==stickyContainer||2===event.button||event.target!==stickyContainer.firstChild)return;const stickContainer=stickyContainer,positioning=positioningRef.current;null!==stickContainer&&(positioning.offsetX=event.clientX,positioning.offsetY=event.clientY,positioning.rootElementRect={left:positioning.x,top:positioning.y},positioning.isDragging=!0,stickContainer.classList.add("dragging"),document.addEventListener("pointermove",handlePointerMove),document.addEventListener("pointerup",handlePointerUp),event.preventDefault())}}),(0,jsx_runtime.jsxs)("div",{className:`sticky-note ${color}`,children:[(0,jsx_runtime.jsxs)("div",{className:"sticky__tools",children:[(0,jsx_runtime.jsx)("button",{onClick:()=>{editor.update((()=>{const node=(0,Lexical_prod.ns)(nodeKey);(0,StickyNode.oL)(node)&&node.toggleColor()}))},className:"sticky--color","aria-label":"Change sticky note color",title:"Color",children:(0,jsx_runtime.jsx)(esm.In,{icon:mdi.mDf})}),(0,jsx_runtime.jsx)("button",{onClick:()=>{editor.update((()=>{const node=(0,Lexical_prod.ns)(nodeKey);(0,StickyNode.oL)(node)&&node.remove()}))},className:"sticky--delete","aria-label":"Delete sticky note",title:"Delete",children:(0,jsx_runtime.jsx)(esm.In,{icon:mdi.hyP})})]}),(0,jsx_runtime.jsx)("div",{className:"text-sm font-semibold",children:user}),(0,jsx_runtime.jsxs)(d,{initialEditor:innerEditor,initialTheme:{paragraph:"sticky__paragraph",text:{bold:"editor-textBold",code:"editor-textCode",italic:"editor-textItalic",strikethrough:"editor-textStrikethrough",subscript:"editor-textSubscript",superscript:"editor-textSuperscript",underline:"editor-textUnderline",underlineStrikethrough:"editor-textUnderlineStrikethrough"}},children:[(0,jsx_runtime.jsx)(LexicalRichTextPlugin_prod.$,{contentEditable:(0,jsx_runtime.jsx)(LexicalContentEditable_prod.a,{className:"sticky__editor"}),placeholder:(0,jsx_runtime.jsx)("div",{className:"sticky-placeholder",children:"Sticky note..."}),ErrorBoundary:LexicalErrorBoundary_prod.A}),(0,jsx_runtime.jsx)(LexicalAutoFocusPlugin_prod.x,{})]})]})]})};try{StickyComponent.displayName="StickyComponent",StickyComponent.__docgenInfo={description:"",displayName:"StickyComponent",props:{user:{defaultValue:null,description:"",name:"user",required:!0,type:{name:"string"}},state:{defaultValue:null,description:"",name:"state",required:!1,type:{name:"any"}},color:{defaultValue:null,description:"",name:"color",required:!0,type:{name:"enum",value:[{value:'"pink"'},{value:'"yellow"'}]}},nodeKey:{defaultValue:null,description:"",name:"nodeKey",required:!0,type:{name:"string"}},x:{defaultValue:{value:"0"},description:"",name:"x",required:!1,type:{name:"number"}},y:{defaultValue:{value:"0"},description:"",name:"y",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/lexical/src/components/StickyComponent.tsx#StickyComponent"]={docgenInfo:StickyComponent.__docgenInfo,name:"StickyComponent",path:"packages/lexical/src/components/StickyComponent.tsx#StickyComponent"})}catch(__react_docgen_typescript_loader_error){}}}]);