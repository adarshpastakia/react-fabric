import{l5 as g,l6 as D,l7 as d,l8 as F,l9 as p,la as A,bO as w,b$ as v,lb as z,lc as S,ld as m,fB as y,le as $}from"./ShadowCastClear.glsl.js";function E(t,e=!1){return t<=D?e?new Array(t).fill(0):new Array(t):g(t)}function J(t,e,n=null){const a=[],r=e.mapPositions,u=I(e,a),i=u.data,l=u.indices.length,o=d(l);return x(e,a,o),T(e,a,o),G(e,a,o),R(e,a,u.indices,o),j(e,a,u.indices,o),B(e,a),C(e,a,u.indices,o),H(e,a,i),new F(t,a,r,2,n)}function I(t,e){const{attributeData:{position:n},removeDuplicateStartEnd:a}=t,r=M(n)&&a,u=n.length/3-(r?1:0),i=new Array(2*(u-1)),l=r?n.slice(0,-3):n;let o=0;for(let s=0;s<u-1;s++)i[o++]=s,i[o++]=s+1;const c=new p(l,i,3,r);return e.push(["position",c]),c}function x(t,e,n){if(t.attributeData.colorFeature!=null)return;const a=t.attributeData.color;e.push(["color",new p(a??A,n,4)])}function G(t,e,n){t.attributeData.normal&&e.push(["normal",new p(t.attributeData.normal,n,3)])}function R(t,e,n,a){const r=t.attributeData.colorFeature;r!=null&&(typeof r=="number"?e.push(["colorFeatureAttribute",new p([r],a,1,!0)]):e.push(["colorFeatureAttribute",new p(r,n,1,!0)]))}function T(t,e,n){t.attributeData.sizeFeature==null&&e.push(["size",new p([t.attributeData.size??1],n,1,!0)])}function j(t,e,n,a){const r=t.attributeData.sizeFeature;r!=null&&(typeof r=="number"?e.push(["sizeFeatureAttribute",new p([r],a,1,!0)]):e.push(["sizeFeatureAttribute",new p(r,n,1,!0)]))}function B(t,e){const{attributeData:{position:n,timeStamps:a}}=t;if(!a)return;const r=n.length/3,u=new Array(2*(r-1));let i=0;for(let l=0;l<r-1;l++)u[i++]=l,u[i++]=l+1;e.push(["timeStamps",new p(a,u,h,!0)])}function C(t,e,n,a){const r=t.attributeData.opacityFeature;r!=null&&(typeof r=="number"?e.push(["opacityFeatureAttribute",new p([r],a,1,!0)]):e.push(["opacityFeatureAttribute",new p(r,n,1,!0)]))}function H(t,e,n){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==1||!t.overlayInfo.spatialReference.isGeographic)return;const a=w(n.length),r=v(t.overlayInfo.spatialReference);for(let f=0;f<a.length;f+=3)z(n,f,a,f,r);const u=n.length/3,i=S(u+1);let l=O,o=P,c=0,s=0;m(l,a[s++],a[s++]),s++,i[0]=0;for(let f=1;f<u+1;++f)f===u&&(s=0),m(o,a[s++],a[s++]),s++,c+=$(l,o),i[f]=c,[l,o]=[o,l];e.push(["distanceToStart",new p(i,e[0][1].indices,1,!0)])}function M(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const O=y(),P=y(),h=4;function U(t,e,n,a,r){if(t==null||t.length===0)return[];const u=[];return t.forEach((i,l)=>{const o=i.length,c=w(3*o);i.forEach((f,b)=>{c[3*b]=f[0],c[3*b+1]=f[1],c[3*b+2]=f[2]});const s={attributeData:{position:c,normal:e,colorFeature:n==null?void 0:n[l],opacityFeature:a==null?void 0:a[l],sizeFeature:r==null?void 0:r[l]},removeDuplicateStartEnd:!1};u.push(s)}),u}function K(t,e,n,a,r,u){if(t==null||t.length===0)return[];const i=U(t,e,a,r,u);return t.forEach((l,o)=>{const c=n==null?void 0:n[o],s=c!=null?k(c.timeStamps,c.streamlineType):void 0;i[o].attributeData.timeStamps=s}),i}function k(t,e){const n=E(t.length*h),a=t[0],r=t[t.length-1];for(let u=0;u<t.length;u++)n[u*h]=t[u],n[u*h+1]=a,n[u*h+2]=r,n[u*h+3]=e+.5;return n}export{K as E,U as S,J as f,E as n};
