import{E as d,V as g}from"./ShadowCastClear.glsl.js";import{f as h,d as w}from"./dataUtils.js";import{x as D,f as _}from"./loadUtils2.js";import"./iframe-qDaPDssc.js";import"./index.js";import"./Viewport.js";import"./debounce.js";import"./index2.js";import"./Section.js";import"./ErrorBoundary.js";import"./createClass.js";import"./Global.js";import"./useIsDark.js";import"./FeatureTileDescriptor.js";let m=class{constructor(){this._tileData=new Map}async generateStreamlines(a){const{flowData:n,flowExtentInfo:t,needsMagnitude:e,simulationSettings:l,startPositions:p}=a,s=u(h(l,n),l,t.modelSize,e,p);return{result:{streamlines:s},transferList:s==null?void 0:s.map(i=>i.vertices.buffer)}}async generateTiledStreamlines(a){const{flowDataTiles:n,flowExtentInfo:t,needsMagnitude:e,reset:l,simulationSettings:p,startPositions:s}=a;this._updateTileData(n,l);const i=u(D(p,this._tileData,t),p,t.modelSize,e,s);return{result:{streamlines:i},transferList:(i==null?void 0:i.map(o=>o.vertices.buffer))??[]}}_updateTileData(a,n){n&&this._tileData.forEach((t,e)=>{a.get(e)==null&&this._tileData.delete(e)}),a.forEach((t,e)=>{t.type==="delete"?this._tileData.delete(e):t.type!=="on-worker"&&t.type!=="waiting"&&this._tileData.set(e,t.data)})}};m=d([g("esri.views.3d.support.flow.FlowWorker")],m);const A=m;function u(a,n,t,e,l){if(a==null)return;const p=w(n,a,t[0],t[1],{positions:l}),s=[],i=_(e);for(const{vertices:o,stage:c}of p){const f=new Float32Array(o.length*i);for(let r=0;r<o.length;r++)f[r*i]=o[r].x,f[r*i+1]=o[r].y,f[r*i+2]=o[r].t,e&&(f[r*i+3]=o[r].speed);s.push({vertices:f,stage:c,hasMagnitude:e})}return s}export{A as default};
