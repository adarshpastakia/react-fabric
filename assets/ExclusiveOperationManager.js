import{ac as v,bx as y,$ as O,af as p,h2 as c,ar as S,ah as m}from"./ShadowCastClear.glsl.js";class d{constructor(){this._currentOperationSignal=v(null)}get currentOperationType(){var t;return((t=this._currentOperationSignal.value)==null?void 0:t.type)??null}destroy(){this.stop()}async start(t,h,s){const a=this._currentOperationSignal.value;a==null||a.stop();const i=new AbortController,l=s==null?void 0:s.signal,o=AbortSignal.any([i.signal,l].filter(y)),n=O();let e=!1;const u=()=>{e||(e=!0,n.reject(m()))},r={type:t,resolve:g=>{e||(e=!0,n.resolve(g))},reject:u,promise:n.promise,stop:()=>i.abort(),handles:[]};this._currentOperationSignal.value=r,r.handles.push(p(l,()=>{i.abort()}),p(o,()=>{c(r.handles),e||u()}));try{return a&&(await a.promise.catch(()=>{}),S(o)),await h(r,o),await n.promise}finally{c(r.handles),this._currentOperationSignal.value===r&&(this._currentOperationSignal.value=null)}}stop(){var t;(t=this._currentOperationSignal.value)==null||t.stop()}}export{d as s};
