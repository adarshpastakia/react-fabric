import{bj as p,bo as w,E as m,V as b,f7 as y,ar as d,f0 as O,ew as $,bi as T,af as j,ef as A,ae as C}from"./ShadowCastClear.glsl.js";import{r as g}from"./InteractiveToolBase.js";let f=class extends g{constructor(t){super(t)}initialize(){this.addHandles(p(()=>this.analysisViewData.visible,t=>this.visible=t,w))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};f=m([b("esri.views.interactive.AnalysisToolBase")],f);function D(t,e){t.interactive=!0;const{tool:s,view:i}=t;i.activeTool=s;let a=j(e,()=>{i.activeTool===s&&(i.activeTool=null)});return y(async n=>{await A(()=>{var o;return!((o=t.tool)!=null&&o.active)},n),a=C(a)},e)}function z(t,e){return p(()=>t.interactive,()=>V(t,e),w)}function V(t,e){t.interactive?_(t,e):h(t)}function _(t,e){h(t);const{view:s,analysis:i}=t,a=new e({view:s,analysis:i,analysisViewData:t});return t.tool=a,s.tools.add(a),a}function h(t){const{view:e,tool:s}=t;s!=null&&(e.tools.remove(s),t.tool=null)}function x(t,e){var a;const s=t.userOperation,i=y(async n=>{var v;if(s){const l=s.promise.catch(()=>{});s==null||s.abort(),await l,d(n)}const o=D(t,{signal:n}),u=(e==null?void 0:e.shouldRejectOnCancel)??(()=>!0),r=O([$(()=>t.tool,"cancel",()=>{u()&&o.abort()})]),{tool:c}=t;try{c&&(c.resetCreated(),(v=e==null?void 0:e.onToolActivated)==null||v.call(e,c)),await o.promise,d(n)}catch(l){if(n.aborted||!T(l)||u())throw l}finally{r==null||r.remove()}},{signal:(a=e==null?void 0:e.abortOptions)==null?void 0:a.signal});return t.userOperation=i,i.promise.finally(()=>{t.userOperation===i&&(t.userOperation=null)})}async function B(t,e){const s=t.analysis.clone();return await x(t,{abortOptions:e==null?void 0:e.placementOptions,onToolActivated:e==null?void 0:e.onToolActivated,shouldRejectOnCancel:()=>{const{analysis:i}=t;return!i.valid||i.equals(s)}}),{}}export{B as d,h as f,z as m,f as o,x as y};
