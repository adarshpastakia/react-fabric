import{P as ie,a as se}from"./pieChart.js";import{b as xe,c as ve,d as we}from"./pieChart.js";import{r as T,m as B,_ as I}from"./Animation.js";import{a as q}from"./Theme.js";import{G as Z,g as G,t as x,e as C,s as M,h as F,L as le}from"./Label.js";import{T as ae}from"./Tick.js";import{b as ee,a as X,p as w}from"./Percent.js";import{e as te,i as K}from"./Disposer.js";import"./ColorSet.js";import"./DefaultTheme.js";import"./Slice.js";import"./RadialLabel.js";class z extends Z{constructor(){super(...arguments),Object.defineProperty(this,"_projectionDirty",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_tlx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_tly",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_trx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_try",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_blx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_bly",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_brx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_bry",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_cprx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_cplx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_cpry",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_cply",{enumerable:!0,configurable:!0,writable:!0,value:0})}_afterNew(){super._afterNew(),this.set("draw",e=>{const t=this.width(),i=this.height();let s=Math.min(t,i)/2,l=T(this.get("cornerRadiusTL",0),s),r=T(this.get("cornerRadiusTR",0),s),a=T(this.get("cornerRadiusBR",0),s),o=T(this.get("cornerRadiusBL",0),s),h=this._trx,c=this._try,g=this._tlx,p=this._tly,m=this._brx,f=this._bry,n=this._blx,u=this._bly;c==p&&(c=c-.01),f==u&&(f=f-.01);let _=G({x:g,y:p},{x:h,y:c}),d=G({x:h,y:c},{x:m,y:f}),y=G({x:m,y:f},{x:n,y:u}),b=G({x:n,y:u},{x:g,y:p});this.get("orientation")=="horizontal"?(l=Math.min(l,Math.abs(p-c)/2),r=Math.min(r,Math.abs(p-c)/2),a=Math.min(a,Math.abs(u-f)/2),o=Math.min(o,Math.abs(u-f)/2)):(l=Math.min(l,Math.abs(g-h)/2),r=Math.min(r,Math.abs(g-h)/2),a=Math.min(a,Math.abs(n-m)/2),o=Math.min(o,Math.abs(n-m)/2));const v=g-l*x((_-b)/2)*C(b),k=p-l*x((_-b)/2)*M(b),j=g-l*x((b-_)/2)*C(_),S=p-l*x((b-_)/2)*M(_),P=h-r*x((d-_)/2)*C(_),E=c-r*x((d-_)/2)*M(_),D=h-r*x((_-d)/2)*C(d),L=c-r*x((_-d)/2)*M(d),N=m-a*x((y-d)/2)*C(d),O=f-a*x((y-d)/2)*M(d),W=m-a*x((d-y)/2)*C(y),A=f-a*x((d-y)/2)*M(y),$=n-o*x((b-y)/2)*C(y),R=u-o*x((b-y)/2)*M(y),J=n-o*x((y-b)/2)*C(b),re=u-o*x((y-b)/2)*M(b);e.moveTo(j,S),e.lineTo(P,E),e.arcTo(h,c,D,L,r),e.quadraticCurveTo(this._cprx,this._cpry,N,O),e.arcTo(m,f,W,A,a),e.lineTo($,R),e.arcTo(n,u,J,re,o),e.quadraticCurveTo(this._cplx,this._cply,v,k),e.arcTo(g,p,j,S,l)})}getPoint(e,t){let i=this.width(),s=this.height();const l=this.get("topWidth",0),r=this.get("bottomWidth",0);if(this.get("orientation")=="vertical"){let a=-l/2,o=l/2,h=r/2,c=-r/2,g=a+(c-a)*t,p=o+(h-o)*t;return{x:g+(p-g)*e,y:s*t}}else{let a=-l/2,o=l/2,h=r/2,c=-r/2,g=a+(c-a)*e,p=o+(h-o)*e;return{x:i*e,y:g+(p-g)*t}}}_changed(){if(this.isDirty("topWidth")||this.isDirty("bottomWidth")||this.isDirty("expandDistance")||this.isDirty("orientation")||this.isDirty("width")||this.isDirty("height")){const e=this.width(),t=this.height(),i=this.get("topWidth",0),s=this.get("bottomWidth",0);this._clear=!0;let l=this.get("expandDistance",0);this.get("orientation")=="vertical"?(this._tlx=-i/2,this._tly=0,this._trx=i/2,this._try=0,this._brx=s/2,this._bry=t,this._blx=-s/2,this._bly=t,this._cprx=this._trx+(this._brx-this._trx)/2+l*t,this._cpry=this._try+.5*t,this._cplx=this._tlx+(this._blx-this._tlx)/2-l*t,this._cply=this._tly+.5*t):(this._tly=i/2,this._tlx=0,this._try=-i/2,this._trx=0,this._bry=-s/2,this._brx=e,this._bly=s/2,this._blx=e,this._cpry=this._try+(this._bry-this._try)/2-l*e,this._cprx=this._trx+.5*e,this._cply=this._tly+(this._bly-this._tly)/2+l*e,this._cplx=this._tlx+.5*e)}super._changed()}}Object.defineProperty(z,"className",{enumerable:!0,configurable:!0,writable:!0,value:"FunnelSlice"});Object.defineProperty(z,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:Z.classNames.concat([z.className])});class H extends ie{constructor(){super(...arguments),Object.defineProperty(this,"_tag",{enumerable:!0,configurable:!0,writable:!0,value:"funnel"}),Object.defineProperty(this,"links",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(this._makeLinks())}),Object.defineProperty(this,"_total",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_count",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_nextCoord",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_opposite",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_makeSlices(){return new F(q.new({}),()=>z._new(this._root,{themeTags:B(this.slices.template.get("themeTags",[]),[this._tag,"series","slice",this.get("orientation")])},[this.slices.template]))}_makeLabels(){return new F(q.new({}),()=>le._new(this._root,{themeTags:B(this.labels.template.get("themeTags",[]),[this._tag,"series","label",this.get("orientation")])},[this.labels.template]))}_makeTicks(){return new F(q.new({}),()=>ae._new(this._root,{themeTags:B(this.ticks.template.get("themeTags",[]),[this._tag,"series","tick",this.get("orientation")])},[this.ticks.template]))}_makeLinks(){return new F(q.new({}),()=>z._new(this._root,{themeTags:B(this.links.template.get("themeTags",[]),[this._tag,"series","link",this.get("orientation")])},[this.links.template]))}makeLink(e){const t=this.slicesContainer.children.push(this.links.make());return t._setDataItem(e),e.set("link",t),this.links.push(t),t}_afterNew(){super._afterNew();const e=this.slicesContainer;e.setAll({isMeasured:!0,position:"relative",width:ee(100),height:ee(100)}),e.onPrivate("width",()=>{this.markDirtySize()}),e.onPrivate("height",()=>{this.markDirtySize()}),this.get("orientation")=="vertical"?this.set("layout",this._root.horizontalLayout):this.set("layout",this._root.verticalLayout)}processDataItem(e){super.processDataItem(e);const t=this.makeSlice(e);t._setDataItem(e),e.set("slice",t),this.makeLink(e);const i=this.makeLabel(e);i.on("x",()=>{this._updateTick(e)}),i.on("y",()=>{this._updateTick(e)}),this.makeTick(e),t.events.on("positionchanged",()=>{i.markDirty()}),t.events.on("boundschanged",()=>{const s=t.dataItem;s&&this._updateTick(s)})}_updateChildren(){this._opposite=!1,this.children.indexOf(this.labelsContainer)==0&&(this._opposite=!0);let e=0,t=0;if(te(this.dataItems,i=>{const s=i.get("value");K(s)&&(t++,s>0?e+=Math.abs(i.get("valueWorking",s)/s):this.get("ignoreZeroValues",!1)||i.isHidden()?t--:e+=1)}),this._total=1/t*e,this._count=t,this.isDirty("alignLabels")&&this._fixLayout(),this._total>0&&(this._valuesDirty||this._sizeDirty)){const i=this.slicesContainer;let s;this.get("orientation")=="vertical"?s=i.innerHeight():s=i.innerWidth(),this._nextCoord=this.get("startLocation",0)*s,this.markDirtyBounds();let l=0;te(this._dataItems,r=>{this.updateLegendValue(r),r.set("index",l),l++;const a=r.get("slice"),o=r.get("tick"),h=r.get("label"),c=r.get("link"),g=r.get("fill"),p=r.get("fillPattern");a._setDefault("fill",g),a._setDefault("stroke",g),a._setDefault("fillPattern",p),c._setDefault("fill",g),c._setDefault("stroke",g);const m=r.get("value");K(m)&&(m==0&&this.get("ignoreZeroValues")?(a.setPrivate("visible",!1),o.setPrivate("visible",!1),h.setPrivate("visible",!1)):(a.setPrivate("visible",!0),o.setPrivate("visible",!0),h.setPrivate("visible",!0),this.decorateSlice(r),this.isLast(r)?c.setPrivate("visible",!1):r.isHidden()||c.setPrivate("visible",!0)))})}super._updateChildren()}_fixLayout(){const e=this.get("orientation"),t=this.labelsContainer,i=this.labels.template;this.get("alignLabels")?(t.set("position","relative"),t.setAll({isMeasured:!0}),e=="vertical"?(this.set("layout",this._root.horizontalLayout),i.setAll({centerX:X,x:X})):(this.set("layout",this._root.verticalLayout),i.setAll({centerX:0,x:0}))):(t.setAll({isMeasured:!1,position:"absolute"}),e=="vertical"?(t.setAll({x:w}),i.setAll({centerX:w,x:0})):(t.setAll({y:w}),i.setAll({centerX:w,y:0}))),this.markDirtySize()}getNextValue(e){let t=e.get("index"),i=e.get("valueWorking",0);if(t<this.dataItems.length-1){let s=this.dataItems[t+1];if(i=s.get("valueWorking",0),s.isHidden()||s.get("value")==0&&this.get("ignoreZeroValues"))return this.getNextValue(s)}return i}isLast(e){let t=e.get("index");if(t==this.dataItems.length-1)return!0;for(let i=t+1;i<this.dataItems.length;i++)if(!this.dataItems[i].isHidden())return!1;return!0}decorateSlice(e){const t=this.get("orientation"),i=e.get("slice"),s=e.get("label"),l=e.get("link"),r=this.slicesContainer;let a=r.innerWidth(),o=r.innerHeight(),h=a;t=="horizontal"&&(h=o);const c=this.getNextValue(e),g=e.get("value",0),p=Math.abs(e.get("valueWorking",g)),m=this.get("bottomRatio",0),f=this.getPrivate("valueHigh",0);let n=1;g!=0?n=p/Math.abs(g):e.isHidden()&&(n=1e-6),this._nextCoord==1/0&&(this._nextCoord=0);let u=p/f*h,_=(p-(p-c)*m)/f*h;i.setAll({topWidth:u,bottomWidth:_,orientation:t}),l.setAll({topWidth:_,bottomWidth:(p-(p-c))/f*h,orientation:t});const d=this.get("startLocation",0),y=this.get("endLocation",1);if(t=="vertical"){let b=l.height()*n;o=o*(y-d)+b,i.set("y",this._nextCoord);let v=Math.min(1e5,Math.max(0,o/this._count*n/this._total-b));i.setAll({height:v,x:a/2});let k=this._nextCoord+v/2;s.set("y",k),this._nextCoord+=v+b,l.setAll({y:this._nextCoord-b,x:a/2})}else{let b=l.width()*n;a=a*(y-d)+b,i.set("x",this._nextCoord);let v=Math.min(1e5,Math.max(0,a/this._count*n/this._total-b));i.setAll({width:v,y:o/2});const k=this._nextCoord+v/2;s.set("x",k),this._nextCoord+=v+b,l.setAll({x:this._nextCoord-b,y:o/2})}}hideDataItem(e,t){const i=Object.create(null,{hideDataItem:{get:()=>super.hideDataItem}});return I(this,void 0,void 0,function*(){return e.get("link").hide(t),i.hideDataItem.call(this,e,t)})}showDataItem(e,t){const i=Object.create(null,{showDataItem:{get:()=>super.showDataItem}});return I(this,void 0,void 0,function*(){return e.get("link").show(t),i.showDataItem.call(this,e,t)})}_updateTick(e){if(this.get("alignLabels")){const t=e.get("tick"),i=e.get("label"),s=e.get("slice");if(t&&s&&i){const l=this.labelsContainer,r=this.slicesContainer;let a=t.get("location",.5);const o=l.width(),h=l.height(),c=l.get("paddingLeft",0),g=l.get("paddingRight",0),p=l.get("paddingTop",0),m=l.get("paddingBottom",0);let f={x:0,y:0},n={x:0,y:0},u={x:0,y:0};this._opposite&&(a=1-a),this.get("orientation")=="vertical"?(f=s.getPoint(a,.5),f.x+=s.x()+r.x(),f.y+=s.y()+r.y(),this._opposite?(n.x=o,n.y=i.y(),u.x=o-c,u.y=n.y):(n.x=r.x()+r.width(),n.y=i.y(),u.x=n.x+o-i.width()-g,u.y=n.y)):(f=s.getPoint(.5,a),f.x+=s.x()+r.x(),f.y+=s.y()+r.y(),this._opposite?(n.y=h,n.x=i.x(),u.y=h-p,u.x=n.x):(n.y=r.y()+r.height(),n.x=i.x(),u.y=n.y+h-i.height()-m,u.x=n.x)),t.set("points",[f,n,u])}}}disposeDataItem(e){super.disposeDataItem(e);let t=e.get("link");t&&(this.links.removeValue(t),t.dispose())}_positionBullet(e){const t=e.get("sprite");if(t){const s=t.dataItem.get("slice");if(s){const l=s.width(),r=s.height(),a=e.get("locationX",.5),o=e.get("locationY",.5);let h=0,c=0;this.get("orientation")=="horizontal"?c=r/2:h=l/2,t.setAll({x:s.x()+l*a-h,y:s.y()-c+r*o})}}}}Object.defineProperty(H,"className",{enumerable:!0,configurable:!0,writable:!0,value:"FunnelSeries"});Object.defineProperty(H,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:ie.classNames.concat([H.className])});class Y extends H{constructor(){super(...arguments),Object.defineProperty(this,"_tag",{enumerable:!0,configurable:!0,writable:!0,value:"pyramid"}),Object.defineProperty(this,"_nextSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}_prepareChildren(){super._prepareChildren(),this._nextSize=void 0}decorateSlice(e){const t=this.get("orientation"),i=this.slicesContainer,s=e.get("slice"),l=e.get("label"),r=e.get("link"),a=this.get("valueIs","area"),o=this.getPrivate("valueAbsoluteSum",0);if(o==0)return;const h=this.get("startLocation",0),c=this.get("endLocation",1),g=this.get("topWidth",0),p=this.get("bottomWidth",X),m=Math.abs(e.get("valueWorking",0)),f=e.get("value",0);let n,u,_=i.innerHeight(),d=i.innerWidth(),y=r.width(),b=r.height();t=="horizontal"&&([d,_]=[_,d],[y,b]=[b,y]);const v=d/2;let k=1;f!=0?k=m/Math.abs(f):e.isHidden()&&(k=1e-6),b*=k,_=_*(c-h)-b*(this._count*this._total-1);let j=T(g,d);K(this._nextSize)||(this._nextSize=j);let S=T(p,d),P=this._nextSize,E=Math.atan2(_,j-S),D=Math.tan(Math.PI/2-E);if(D==0&&(D=1e-8),a=="area"){let R=(j+S)/2*_*m/o,J=Math.abs(P*P-2*R*D);n=(P-Math.sqrt(J))/D,n>0?u=(2*R-n*P)/n:u=P}else n=_*m/o,u=P-n*D;let L=this._nextCoord+n/2,N=v,O=this._nextCoord,W=v,A=O+n;t=="vertical"?(l.set("y",L),l.get("opacity")>0&&this._rLabels.push({label:l,y:L}),s.set("height",n)):(l.set("x",L),l.get("opacity")>0&&this._hLabels.push({label:l,y:L}),[N,O]=[O,N],[W,A]=[A,W],s.set("width",n)),s.setAll({orientation:t,bottomWidth:u,topWidth:P,x:N,y:O}),r.setAll({orientation:t,x:W,y:A,topWidth:u,bottomWidth:u}),this._nextSize=u,this._nextCoord+=n+b}}Object.defineProperty(Y,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PyramidSeries"});Object.defineProperty(Y,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:H.classNames.concat([Y.className])});class Q extends Y{constructor(){super(...arguments),Object.defineProperty(this,"_tag",{enumerable:!0,configurable:!0,writable:!0,value:"pictorial"}),Object.defineProperty(this,"seriesMask",{enumerable:!0,configurable:!0,writable:!0,value:Z.new(this._root,{position:"absolute",x:w,y:w,centerX:w,centerY:w})}),Object.defineProperty(this,"seriesGraphics",{enumerable:!0,configurable:!0,writable:!0,value:this.slicesContainer.children.push(Z.new(this._root,{themeTags:["pictorial","background"],position:"absolute",x:w,y:w,centerX:w,centerY:w}))})}_afterNew(){super._afterNew(),this.set("topWidth",X),this.set("bottomWidth",X),this.set("valueIs","height"),this.slicesContainer.set("mask",this.seriesMask)}_updateScale(){let e=this.slicesContainer,t=e.innerWidth(),i=e.innerHeight(),s=this.seriesMask,l=this.seriesGraphics,r=s.get("scale",1);const a=s.localBounds();let o=a.right-a.left,h=a.bottom-a.top;this.get("orientation")=="horizontal"?r=t/o:r=i/h,r!=1/0&&r!=NaN&&(s.set("scale",r),s.set("x",t/2),s.set("y",i/2),l.set("scale",r),l.set("x",t/2),l.set("y",i/2))}_prepareChildren(){if(super._prepareChildren(),this.isDirty("svgPath")){const e=this.get("svgPath");this.seriesMask.set("svgPath",e),this.seriesGraphics.set("svgPath",e)}this._updateScale()}}Object.defineProperty(Q,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PictorialStackedSeries"});Object.defineProperty(Q,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:Y.classNames.concat([Q.className])});class U extends se{_afterNew(){super._afterNew(),this.seriesContainer.setAll({isMeasured:!0,layout:this._root.horizontalLayout})}}Object.defineProperty(U,"className",{enumerable:!0,configurable:!0,writable:!0,value:"SlicedChart"});Object.defineProperty(U,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:se.classNames.concat([U.className])});export{xe as DefaultTheme,H as FunnelSeries,z as FunnelSlice,se as PercentChart,ie as PercentSeries,Q as PictorialStackedSeries,ve as PieChart,we as PieSeries,Y as PyramidSeries,U as SlicedChart};
