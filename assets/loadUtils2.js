import{hy as z,ma as j,mb as S,a4 as $,mc as y,md as k,b_ as I}from"./ShadowCastClear.glsl.js";import{f as A}from"./dataUtils.js";import{h as R}from"./FeatureTileDescriptor.js";class C{constructor(t,n,o,l,i){this.extent=t,this.timeExtent=n,this.size=o,this.pixelRatio=l,this.time=i}get flowExtentInfo(){var t;return{modelSize:this.size,valid:(t=$(this.extent.spatialReference))==null?void 0:t.valid,extent:S(this.extent)}}insideMapExtent(t,n){return v(this.flowExtentInfo,t,n)}modelToMapSpace(t,n,o){return E(this.flowExtentInfo,t,n,o)}}function v(e,t,n){const{extent:o,valid:l}=e,[i,u,r,s]=o;return!(n<u||n>s)&&(l!=null&&i>r?t>=r||t<=i:t>=i&&t<=r)}function E(e,t,n,o){const{extent:l,modelSize:i,valid:u}=e,[r,s,c]=l,f=G(r,c,u);let a=t/i[0]*f+r;return u!=null&&o&&(a=new z(u[0],u[1]).normalize(a)),[a,(i[1]-n)/i[1]*j(l)+s]}function F(e,t,n){return n!=null&&Math.abs(e-n.valid[0])<n.dx&&Math.abs(t-n.valid[1])<n.dx}function G(e,t,n){if(n!=null&&e>t){const[o,l]=n;return l-e+(t-o)}return t-e}function D(e){return e?4:3}function H(e){return e[0].vertices instanceof Float32Array}class J{constructor(t,n,o,l,i,u){this.data=t,this.mask=n,this.width=o,this.height=l,this.lij=i,this.extent=u}}function K(e){return R(e.lij[0],e.lij[1],e.lij[2])}function L(e,t){let[n,o,l,i]=[null,null,null,null];for(const u of e){const r=u.extent;n=b(r[0],n),o=b(r[1],o),l=w(r[2],l),i=w(r[3],i)}if(n==null||o==null||l==null||i==null)return null;if(F(n,l,t)){const u=[...e].toSorted((a,h)=>a.extent[0]-h.extent[0]);let r=u[0].extent[2],s=0,c=0,f=0;for(let a=1;a<u.length;a++){const[h,x,d]=u[a].extent;if(r<h&&(f++,s=r,c=h,f>1))break;r=Math.max(r,d)}f===1&&(n=c,l=s)}return I([n,o,l,i])}function w(e,t){return t==null?e:Math.max(e,t)}function b(e,t){return t==null?e:Math.min(e,t)}function N(e,t,n){const[o,l]=n.modelSize;let i=null;const u=new Map;t.forEach(s=>{u.set(s.lij,A(e,s))});const r=(s,c,f)=>y(s.extent,c,f);return(s,c)=>{const f=Math.round(s),a=Math.round(c);if(!e.wrapAround&&(f<0||f>=o||a<0||a>=l))return[0,0];const[h,x]=E(n,s,c,!0);if(!v(n,h,x))return[0,0];if(i==null||!r(i,h,x)){i=null;for(const[T,M]of t)if(r(M,h,x)){i=M;break}}if((i==null?void 0:i.data)==null)return[0,0];const d=u.get(i.lij);if(d==null)return[0,0];const{width:g,height:p,extent:m}=i;return d((h-m[0])/k(m)*g,p-(x-m[1])/j(m)*p)}}export{H as a,G as b,J as c,D as f,K as h,L as m,C as o,F as s,N as x};
