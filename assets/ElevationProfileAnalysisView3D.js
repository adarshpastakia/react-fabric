import{bJ as R,gy as L,l1 as H,bj as v,bk as U,sp as G,bI as q,gK as A,sq as F,oJ as M,b$ as N,gz as j,ha as B,sr as J,mM as $,hd as K,E as s,F as r,V as g,b6 as P,ae as W,ed as Y,bo as D,ss as Q,f0 as X,oV as Z,bE as ee,gH as te,ms as ie,b8 as se,fz as re}from"./ShadowCastClear.glsl.js";import{e as oe}from"./AnalysisView3D.js";import{p as ne,t as f,r as ae,o as le,i as ue,l as pe,a as ce,k as he,n as de,u as ye,b as ve,L as me}from"./ElevationProfileTool.js";import{b as _e}from"./settings.js";import{R as T}from"./OutlineVisualElement.js";import"./iframe-DpfJK_wQ.js";import"./index.js";import"./Viewport.js";import"./debounce.js";import"./index2.js";import"./Section.js";import"./ErrorBoundary.js";import"./createClass.js";import"./Global.js";import"./useIsDark.js";import"./AnalysisView.js";import"./createUtils.js";import"./distanceOperator.js";import"./Point2D.js";import"./Distance2DCalculator-CXhBP-8I.js";import"./ProjectionTransformation.js";import"./Envelope2D.js";import"./Transformation2D.js";import"./OperatorDefinitions.js";import"./apiConverter.js";import"./jsonConverter.js";import"./simplifyOperator2.js";import"./operatorSimplify.js";import"./ExclusiveOperationManager.js";import"./SketchViewModel.js";import"./SketchOptions.js";import"./euclideanLengthMeasurementUtils.js";import"./geometry2dUtils.js";import"./geodeticLengthOperator.js";import"./geodeticCurveType.js";import"./automaticAreaMeasurementUtils.js";import"./geodesicAreaMeasurementUtils.js";import"./earcut.js";import"./automaticLengthMeasurementUtils.js";import"./lineStippleUtils.js";import"./EngineVisualElement.js";import"./VisualElement.js";import"./LaserlinePath.glsl.js";import"./line.js";import"./line2.js";import"./triangulationUtils.js";import"./deduplicate.js";const ge=2e5;let l=class extends ne{constructor(){super(...arguments),this.type="scene",this.numSamplesForPreview=50,this.numSamplesPerChunk=25,this._getStableElevationDependencies=f(()=>{var t;const e=this._view;return e?{view:e,stationary:e.stationary,geometry:(t=this.controller)==null?void 0:t.analysis.geometry,visibleLayerIds:this._getStableLayerIds(),maxIntersectionDistance:this._maxIntersectionDistance,intersectOptions:this._intersectOptions,spatialReference:this._getStableSpatialReference()}:null},$),this._getStableSpatialReference=f(()=>{var e;return(e=this._view)==null?void 0:e.spatialReference},K),this._getStableLayerIds=f(()=>ae(this._view),$),this._getStablePointCloudLayers=f(()=>{const e=this._view;return e?e.allLayerViews.toArray().filter(t=>{var i;return((i=t.layer)==null?void 0:i.type)==="point-cloud"}).map(t=>t.layer):[]},$),this._vecA=R(),this._vecB=R(),this._ray=L()}get minDemResolution(){var i,o;const e=this._view;if(!e)return null;const t=(o=(i=e.pointsOfInterest)==null?void 0:i.focus)==null?void 0:o.worldUnitsPerContentPixel;return t==null?null:t*H(e.spatialReference)}initialize(){const e=()=>this.onInvalidate(this);return this.addHandles([v(()=>this._queryElevationDependencies,e,U),this.controller.onElevationChange(e)])}async queryElevation(e,{noDataValue:t,signal:i}){const o=this._queryElevationDependencies;if(o==null)throw new Error(`${this.declaredClass}: no dependencies`);const a=this._intersector;if(a==null)throw new Error(`${this.declaredClass}: no view`);const{intersectOptions:p,view:h,spatialReference:c}=o,V=h.renderCoordsHelper,k=h.sceneIntersectionHelper,z=this._vecA,w=this._vecA,m=this._vecB,x=this._ray;if(!c)return{geometry:e,noDataValue:t};const b=await G.fromGeometry(e).project(c,i);if(!b)return{geometry:e,noDataValue:t};const I=b.coordinates,C=I.length;for(let E=0;E<C;++E){const _=I[E];q(m,_.x,_.y,_.z??0),V.toRenderCoords(m,c,m),V.setAltitude(z,ge,m);const S=A(z,m,x);k.computeIntersection(S,a,!0,p);const O=we(o,a.results.all);O?(O.getIntersectionPoint(w),V.fromRenderCoords(w,w,c),_.z=w[2]):_.z=t}return{geometry:b.export(),noDataValue:t}}get _queryElevationDependencies(){return this._getStableElevationDependencies()}get _intersectOptions(){const e=this._view;if(!e||e.destroyed)return{};const{include:t,exclude:i}=this.profile;return F(e,{include:t,exclude:[...this._pointCloudLayers,...M(i)?i:i?[i]:[]]})}get _pointCloudLayers(){return this._getStablePointCloudLayers()}get _view(){const e=this.controller.view;return e.type==="3d"?e:null}get _maxIntersectionDistance(){const e=this._view;return e!=null&&e.renderCoordsHelper?N(e.spatialReference).radius/e.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY}get _intersector(){const e=this._view;if(!e)return null;const t=new j(e.state.viewingMode),i=t.options;return i.hud=!1,i.invisibleTerrain=!1,i.backfacesTerrain=!1,i.selectionMode=!1,i.store=2,t}};function we({intersectOptions:e,maxIntersectionDistance:t,view:i},o){const a=e.graphics,p=!(!(a!=null&&a.include)&&!(a!=null&&a.exclude));for(const h of o)if(h.withinDistance(t)){if(p){const c=B(h,i);if(c!=null&&!J(a,c))continue}return h}return null}s([r({readOnly:!0})],l.prototype,"minDemResolution",null),s([r()],l.prototype,"_queryElevationDependencies",null),s([r()],l.prototype,"_intersectOptions",null),s([r()],l.prototype,"_pointCloudLayers",null),s([r()],l.prototype,"_view",null),s([r()],l.prototype,"_maxIntersectionDistance",null),s([r()],l.prototype,"_intersector",null),l=s([g("esri.views.3d.analysis.ElevationProfile.ElevationProfileLineSceneComputation")],l);let d=class extends P{constructor(t){super(t),this._visualElementHandle=null}initialize(){this._settings=new _e({getTheme:()=>this.view.effectiveTheme}),this.addHandles(le({analysisViewData:this.analysisViewData,remove:()=>this._remove(),show:t=>this._show(t)}))}destroy(){this._remove()}get updating(){return!1}_remove(){this._visualElementHandle=W(this._visualElementHandle)}_show(t){this._remove();const{view:i}=this,o=new T({view:i,geometry:this.analysisViewData.analysis.geometry,attached:!1,renderOccluded:8,isDecoration:!0}),a=[v(()=>this.analysisViewData.analysis.elevationInfo,p=>{o.elevationInfo=p,o.isDraped=Q(!0,p)==="on-the-ground"},D),v(()=>this.analysisViewData.analysis.geometry,p=>{o.geometry=p}),i.maskOccludee(t),Y(o)];this._settings.visualElements.lineObjects.outline.apply(o),o.attached=!0,this._visualElementHandle=X(a)}};s([r({constructOnly:!0})],d.prototype,"view",void 0),s([r({constructOnly:!0})],d.prototype,"analysisViewData",void 0),s([r()],d.prototype,"updating",null),d=s([g("esri.views.3d.analysis.ElevationProfile.ElevationProfileGeometryVisualization3D")],d);let u=class extends P{constructor(e){super(e),this._updateGeometryThrottled=Z(t=>{if(!t)return;const{samples:i,spatialReference:o}=t,a=i!=null&&i.length>0;this._visualElement.geometry=a?pe(i,o):null},ue().profileLinesUpdateThrottleMillis)}initialize(){this._visualElement=new T({view:this.view,elevationInfo:te,innerWidth:0,innerColor:ee(0,0,0,0),width:3,falloff:0,renderOccluded:16,isDecoration:!0}),this.addHandles([v(()=>{var e;return{color:(e=this._result)==null?void 0:e.computation.profile.color,visible:this._effectiveVisible}},({color:e,visible:t})=>{e&&(this._visualElement.color=ie(se.toUnitRGBA(e))),this._visualElement.visible=t},D),v(()=>this.analysisViewData.analysis.geometry,()=>{this._visualElement.geometry=null},D),v(()=>this._geometryUpdateParameters,e=>this._updateGeometryThrottled(e),D),this._updateGeometryThrottled])}destroy(){this._visualElement.destroy()}get updating(){return this._updateGeometryThrottled.hasPendingUpdates()}get _result(){return this.getResult()}get _effectiveVisible(){const{analysisViewData:e,_result:t}=this;return e.visible&&t!=null&&t.available&&t.computation.profile.viewOptions.lineVisible}get _geometryUpdateParameters(){var e;return this._effectiveVisible&&this.analysisViewData.progress!==1?null:{samples:(e=this._result)==null?void 0:e.samples,spatialReference:this.view.spatialReference}}};s([r()],u.prototype,"view",void 0),s([r()],u.prototype,"analysisViewData",void 0),s([r()],u.prototype,"getResult",void 0),s([r()],u.prototype,"updating",null),s([r()],u.prototype,"_result",null),s([r()],u.prototype,"_effectiveVisible",null),s([r()],u.prototype,"_geometryUpdateParameters",null),u=s([g("esri.views.3d.analysis.ElevationProfile.ElevationProfileLineVisualization3D")],u);let y=class extends P{constructor(e){super(e)}initialize(){const{view:e,analysisViewData:t}=this;this._hoveredPointsVisualization=new ce({view:e,analysisViewData:t}),this._geometryVisualization=new d({view:e,analysisViewData:t}),this._lineVisualizations=re(()=>this.analysisViewData.analysis.profiles,i=>new u({view:e,analysisViewData:t,getResult:()=>t.results.find(o=>o.computation.profile===i)}))}destroy(){this._geometryVisualization.destroy(),this._hoveredPointsVisualization.destroy(),this._lineVisualizations.destroy()}get updating(){return this._geometryVisualization.updating||this._lineVisualizations.some(e=>e.updating)}};s([r()],y.prototype,"view",void 0),s([r()],y.prototype,"analysisViewData",void 0),s([r()],y.prototype,"updating",null),y=s([g("esri.views.3d.analysis.ElevationProfile.ElevationProfileVisualization3D")],y);let n=class extends oe{constructor(e){super(e),this.type="elevation-profile-view-3d",this.analysis=null,this.hoveredPosition=null}initialize(){const{analysis:e,view:t}=this;this._controller=new he({analysis:e,analysisViewData:this,view:t,computationFactory:{create:i=>{switch(i.profile.type){case"ground":return new ve(i);case"input":return new ye(i);case"query":return new de(i);case"scene":return new l(i)}}}}),this._visualization=new y({view:t,analysisViewData:this}),this._sketchTool=new me({view:t,analysisViewData:this})}destroy(){var e,t,i;(e=this._controller)==null||e.destroy(),(t=this._visualization)==null||t.destroy(),(i=this._sketchTool)==null||i.destroy()}get effectiveDisplayUnits(){var e;return((e=this._controller)==null?void 0:e.effectiveDisplayUnits)??{distance:"meters",elevation:"meters"}}get error(){var e;return(e=this._controller)==null?void 0:e.error}get hoveredPoints(){var e;return((e=this._controller)==null?void 0:e.hoveredPoints)??[]}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get progress(){var e;return((e=this._controller)==null?void 0:e.progress)??0}get results(){var e;return((e=this._controller)==null?void 0:e.results)??[]}get statistics(){var e;return(e=this._controller)==null?void 0:e.statistics}get updating(){var e,t,i;return((e=this._controller)==null?void 0:e.updating)===!0||((t=this._visualization)==null?void 0:t.updating)===!0||((i=this._sketchTool)==null?void 0:i.updating)===!0}get visible(){return super.visible}set visible(e){super.visible=e}get sketchGraphic(){var e;return(e=this._sketchTool)==null?void 0:e.sketchGraphic}get toolState(){var e;return((e=this._sketchTool)==null?void 0:e.state)??"idle"}place(e){return this._sketchTool.place(e)}pickFeature(e){return this._sketchTool.pickFeature(e)}};s([r({readOnly:!0})],n.prototype,"type",void 0),s([r({constructOnly:!0,nonNullable:!0})],n.prototype,"analysis",void 0),s([r({readOnly:!0})],n.prototype,"effectiveDisplayUnits",null),s([r({readOnly:!0})],n.prototype,"error",null),s([r()],n.prototype,"hoveredPosition",void 0),s([r()],n.prototype,"hoveredPoints",null),s([r({readOnly:!0})],n.prototype,"progress",null),s([r({readOnly:!0})],n.prototype,"results",null),s([r({readOnly:!0})],n.prototype,"statistics",null),s([r({readOnly:!0})],n.prototype,"updating",null),s([r()],n.prototype,"sketchGraphic",null),s([r()],n.prototype,"toolState",null),s([r()],n.prototype,"_controller",void 0),s([r()],n.prototype,"_visualization",void 0),s([r()],n.prototype,"_sketchTool",void 0),n=s([g("esri.views.3d.analysis.ElevationProfileAnalysisView3D")],n);const yt=n;export{yt as default};
