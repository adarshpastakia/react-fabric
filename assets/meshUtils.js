import{i3 as I,b as g,kq as b,kr as R,bP as v,ks as A}from"./ShadowCastClear.glsl.js";import{a as S,Y as h}from"./Mesh.js";import{c as k}from"./MeshVertexAttributes.js";import"./iframe-qDaPDssc.js";import"./index.js";import"./Viewport.js";import"./debounce.js";import"./index2.js";import"./Section.js";import"./ErrorBoundary.js";import"./createClass.js";import"./Global.js";import"./useIsDark.js";import"./MeshComponent.js";import"./meshProperties.js";import"./MeshTransform.js";import"./triangulationUtils.js";import"./earcut.js";import"./deduplicate.js";import"./vertexSpaceConversion.js";import"./vec4.js";import"./External.js";function X(t){const i=new S,s=t.spatialReference??t.layerView.view.spatialReference;return i.externalSources.add({extent:t.extent??C(t,s),source:{type:"loadable",load:a=>V(a,t)}}),new h({metadata:i,vertexSpace:new I,spatialReference:s})}function C({layerView:t,nodeIndex:i,featureIndex:s},a){const r=t.getAABB(i,s);if(!r)return null;const p=t.view.spatialReference;return p.equals(a)||v(r,p,0,r,a,0),A(r,a)}async function V(t,{layerView:i,nodeIndex:s,featureIndex:a}){const r=i.getNodeComponentHandle(s);if(!(r!=null&&r.intersectionGeometry))throw new g("i3s-layer-view-geometry-missing","Cannot load mesh because scene layer view data is no longer available.");const p={indices:null,data:null,stride:0,startIndex:0,endIndex:0};r.intersectionGeometry.getComponentPositions(a,p);const{indices:c,data:n,stride:l,startIndex:w,endIndex:x}=p,e=new Float64Array(3*(x-w));let o=0;for(let m=w;m<x;m+=3){const d=l*c[m],f=l*c[m+1],u=l*c[m+2];e[o++]=n[d],e[o++]=n[d+1],e[o++]=n[d+2],e[o++]=n[f],e[o++]=n[f+1],e[o++]=n[f+2],e[o++]=n[u],e[o++]=n[u+1],e[o++]=n[u+2]}const y=r.transform;b(e,e,y.rotationScale),R(e,e,y.position),v(e,i.view.renderSpatialReference,0,e,t.spatialReference,0),t.vertexAttributes=new k({position:e})}export{X as createMesh};
