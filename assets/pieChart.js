import{a as L,b as H,p as f,P as z}from"./Percent.js";import{k as F,S as B,T as Y}from"./Tick.js";import{T as V,a as x}from"./Theme.js";import{C as X}from"./ColorSet.js";import{s as W}from"./DefaultTheme.js";import{_ as k,r as b,m as P}from"./Animation.js";import{C as D,A as U,j,F as K,h as T,e as R,s as m,n as q}from"./Label.js";import{e as d,i as M}from"./Disposer.js";import{S as E}from"./Slice.js";import{R as $}from"./RadialLabel.js";class G extends V{setupDefaultRules(){super.setupDefaultRules();const t=this._root.interfaceColors,e=this.rule.bind(this);e("PercentSeries").setAll({legendLabelText:"{category}",legendValueText:"{valuePercentTotal.formatNumber('0.00p')}",colors:X.new(this._root,{}),width:L,height:L}),e("PieChart").setAll({radius:H(80),startAngle:-90,endAngle:270}),e("PieSeries").setAll({alignLabels:!0,startAngle:-90,endAngle:270}),e("PieSeries").states.create("hidden",{endAngle:-90,opacity:0}),e("Slice",["pie"]).setAll({position:"absolute",isMeasured:!1,x:0,y:0,toggleKey:"active",tooltipText:"{category}: {valuePercentTotal.formatNumber('0.00p')}",strokeWidth:1,strokeOpacity:1,role:"figure",lineJoin:"round"}),e("Slice",["pie"]).states.create("active",{shiftRadius:20,scale:1}),e("Slice",["pie"]).states.create("hoverActive",{scale:1.04}),e("Slice",["pie"]).states.create("hover",{scale:1.04}),e("RadialLabel",["pie"]).setAll({textType:"aligned",radius:10,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",paddingTop:5,paddingBottom:5,populateText:!0}),e("Tick",["pie"]).setAll({location:1}),e("SlicedChart").setAll({paddingLeft:10,paddingRight:10,paddingTop:10,paddingBottom:10}),e("FunnelSeries").setAll({startLocation:0,endLocation:1,orientation:"vertical",alignLabels:!0,sequencedInterpolation:!0}),e("FunnelSlice").setAll({interactive:!0,expandDistance:0}),e("FunnelSlice").states.create("hover",{expandDistance:.15}),e("Label",["funnel"]).setAll({populateText:!0,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",centerY:f}),e("Label",["funnel","horizontal"]).setAll({centerX:0,centerY:f,rotation:-90}),e("Label",["funnel","vertical"]).setAll({centerY:f,centerX:0}),e("Tick",["funnel"]).setAll({location:1}),e("FunnelSlice",["funnel","link"]).setAll({fillOpacity:.5,strokeOpacity:0,expandDistance:-.1}),e("FunnelSlice",["funnel","link","vertical"]).setAll({height:10}),e("FunnelSlice",["funnel","link","horizontal"]).setAll({width:10}),e("PyramidSeries").setAll({valueIs:"area"}),e("FunnelSlice",["pyramid","link"]).setAll({fillOpacity:.5}),e("FunnelSlice",["pyramid","link","vertical"]).setAll({height:0}),e("FunnelSlice",["pyramid","link","horizontal"]).setAll({width:0}),e("FunnelSlice",["pyramid"]).setAll({interactive:!0,expandDistance:0}),e("FunnelSlice",["pyramid"]).states.create("hover",{expandDistance:.15}),e("Label",["pyramid"]).setAll({populateText:!0,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",centerY:f}),e("Label",["pyramid","horizontal"]).setAll({centerX:0,centerY:f,rotation:-90}),e("Label",["pyramid","vertical"]).setAll({centerY:f,centerX:0}),e("Tick",["pyramid"]).setAll({location:1}),e("FunnelSlice",["pictorial"]).setAll({interactive:!0,tooltipText:"{category}: {valuePercentTotal.formatNumber('0.00p')}"}),e("Label",["pictorial"]).setAll({populateText:!0,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",centerY:f}),e("Label",["pictorial","horizontal"]).setAll({centerX:0,centerY:f,rotation:-90}),e("Label",["pictorial","vertical"]).setAll({centerY:f,centerX:0}),e("FunnelSlice",["pictorial","link"]).setAll({fillOpacity:.5,width:0,height:0}),e("Tick",["pictorial"]).setAll({location:.5});{const i=e("Graphics",["pictorial","background"]);i.setAll({fillOpacity:.2}),W(i,"fill",t,"alternativeBackground")}}}class y extends F{_afterNew(){this._defaultThemes.push(G.new(this._root)),super._afterNew(),this.chartContainer.children.push(this.seriesContainer),this.seriesContainer.children.push(this.bulletsContainer)}_processSeries(t){super._processSeries(t),this.seriesContainer.children.moveValue(this.bulletsContainer,this.seriesContainer.children.length-1)}}Object.defineProperty(y,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PercentChart"});Object.defineProperty(y,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:F.classNames.concat([y.className])});class _ extends B{constructor(){super(...arguments),Object.defineProperty(this,"slicesContainer",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(D.new(this._root,{position:"absolute",isMeasured:!1}))}),Object.defineProperty(this,"labelsContainer",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(D.new(this._root,{position:"absolute",isMeasured:!1}))}),Object.defineProperty(this,"ticksContainer",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(D.new(this._root,{position:"absolute",isMeasured:!1}))}),Object.defineProperty(this,"_lLabels",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_rLabels",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_hLabels",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"slices",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(this._makeSlices())}),Object.defineProperty(this,"labels",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(this._makeLabels())}),Object.defineProperty(this,"ticks",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(this._makeTicks())})}makeSlice(t){const e=this.slicesContainer.children.push(this.slices.make());return e.on("fill",()=>{this.updateLegendMarker(t)}),e.on("fillPattern",()=>{this.updateLegendMarker(t)}),e.on("stroke",()=>{this.updateLegendMarker(t)}),e._setDataItem(t),t.set("slice",e),this.slices.push(e),e}makeLabel(t){const e=this.labelsContainer.children.push(this.labels.make());return e._setDataItem(t),t.set("label",e),this.labels.push(e),e}_shouldMakeBullet(t){return t.get("value")!=null}makeTick(t){const e=this.ticksContainer.children.push(this.ticks.make());return e._setDataItem(t),t.set("tick",e),this.ticks.push(e),e}_afterNew(){this.fields.push("category","fill"),super._afterNew()}_onDataClear(){const t=this.get("colors");t&&t.reset();const e=this.get("patterns");e&&e.reset()}_prepareChildren(){if(super._prepareChildren(),this._lLabels=[],this._rLabels=[],this._hLabels=[],this._valuesDirty){let t=0,e=0,i=0,s=1/0,a=0;d(this._dataItems,l=>{let r=l.get("valueWorking",0);t+=r,e+=Math.abs(r)}),d(this._dataItems,l=>{let r=l.get("valueWorking",0);r>i&&(i=r),r<s&&(s=r),a++;let u=r/e;e==0&&(u=0),l.setRaw("valuePercentTotal",u*100)}),this.setPrivateRaw("valueLow",s),this.setPrivateRaw("valueHigh",i),this.setPrivateRaw("valueSum",t),this.setPrivateRaw("valueAverage",t/a),this.setPrivateRaw("valueAbsoluteSum",e)}}show(t){const e=Object.create(null,{show:{get:()=>super.show}});return k(this,void 0,void 0,function*(){let i=[];i.push(e.show.call(this,t)),i.push(this._sequencedShowHide(!0,t)),yield Promise.all(i)})}hide(t){const e=Object.create(null,{hide:{get:()=>super.hide}});return k(this,void 0,void 0,function*(){let i=[];i.push(e.hide.call(this,t)),i.push(this._sequencedShowHide(!1,t)),yield Promise.all(i)})}_updateChildren(){super._updateChildren(),this._valuesDirty&&d(this._dataItems,t=>{t.get("label").text.markDirtyText()}),(this.isDirty("legendLabelText")||this.isDirty("legendValueText"))&&d(this._dataItems,t=>{this.updateLegendValue(t)}),this._arrange()}_arrange(){this._arrangeDown(this._lLabels),this._arrangeUp(this._lLabels),this._arrangeDown(this._rLabels),this._arrangeUp(this._rLabels),this._arrangeLeft(this._hLabels),this._arrangeRight(this._hLabels),d(this.dataItems,t=>{this._updateTick(t)})}_afterChanged(){super._afterChanged(),this._arrange()}processDataItem(t){if(super.processDataItem(t),t.get("fill")==null){let e=this.get("colors");e&&t.setRaw("fill",e.next())}if(t.get("fillPattern")==null){let e=this.get("patterns");e&&t.setRaw("fillPattern",e.next())}}showDataItem(t,e){const i=Object.create(null,{showDataItem:{get:()=>super.showDataItem}});return k(this,void 0,void 0,function*(){const s=[i.showDataItem.call(this,t,e)];M(e)||(e=this.get("stateAnimationDuration",0));const a=this.get("stateAnimationEasing");let l=t.get("value");const r=t.animate({key:"valueWorking",to:l,duration:e,easing:a});r&&s.push(r.waitForStop());const u=t.get("tick");u&&s.push(u.show(e));const h=t.get("label");h&&s.push(h.show(e));const o=t.get("slice");o&&s.push(o.show(e)),o.get("active")&&o.states.applyAnimate("active"),yield Promise.all(s)})}hideDataItem(t,e){const i=Object.create(null,{hideDataItem:{get:()=>super.hideDataItem}});return k(this,void 0,void 0,function*(){const s=[i.hideDataItem.call(this,t,e)],a=this.states.create("hidden",{});M(e)||(e=a.get("stateAnimationDuration",this.get("stateAnimationDuration",0)));const l=a.get("stateAnimationEasing",this.get("stateAnimationEasing")),r=t.animate({key:"valueWorking",to:0,duration:e,easing:l});r&&s.push(r.waitForStop());const u=t.get("tick");u&&s.push(u.hide(e));const h=t.get("label");h&&s.push(h.hide(e));const o=t.get("slice");o.hideTooltip(),o&&s.push(o.hide(e)),yield Promise.all(s)})}disposeDataItem(t){super.disposeDataItem(t);let e=t.get("label");e&&(this.labels.removeValue(e),e.dispose());let i=t.get("tick");i&&(this.ticks.removeValue(i),i.dispose());let s=t.get("slice");s&&(this.slices.removeValue(s),s.dispose())}hoverDataItem(t){const e=t.get("slice");e&&!e.isHidden()&&e.hover()}unhoverDataItem(t){const e=t.get("slice");e&&e.unhover()}updateLegendMarker(t){if(t){const e=t.get("slice");if(e){const i=t.get("legendDataItem");if(i){const s=i.get("markerRectangle");d(U,a=>{e.get(a)!=null&&s.set(a,e.get(a))})}}}}_arrangeDown(t){if(t){let e=this._getNextDown();t.sort((i,s)=>i.y>s.y?1:i.y<s.y?-1:0),d(t,i=>{const s=i.label.adjustedLocalBounds();let a=s.top;i.y+a<e&&(i.y=e-a),i.label.set("y",i.y),e=i.y+s.bottom})}}_getNextUp(){return this.labelsContainer.maxHeight()}_getNextDown(){return 0}_arrangeUp(t){if(t){let e=this._getNextUp();t.sort((i,s)=>i.y<s.y?1:i.y>s.y?-1:0),d(t,i=>{const s=i.label.adjustedLocalBounds();let a=s.bottom;i.y+a>e&&(i.y=e-a),i.label.set("y",i.y),e=i.y+s.top})}}_arrangeRight(t){if(t){let e=0;t.sort((i,s)=>i.y>s.y?1:i.y<s.y?-1:0),d(t,i=>{const s=i.label.adjustedLocalBounds();let a=s.left;i.y+a<e&&(i.y=e-a),i.label.set("x",i.y),e=i.y+s.right})}}_arrangeLeft(t){if(t){let e=this.labelsContainer.maxWidth();t.sort((i,s)=>i.y<s.y?1:i.y>s.y?-1:0),d(t,i=>{const s=i.label.adjustedLocalBounds();let a=s.right;i.y+a>e&&(i.y=e-a),i.label.set("x",i.y),e=i.y+s.left})}}_updateSize(){super._updateSize(),this.markDirty()}_updateTick(t){}_dispose(){super._dispose();const t=this.chart;t&&t.series.removeValue(this)}}Object.defineProperty(_,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PercentSeries"});Object.defineProperty(_,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:B.classNames.concat([_.className])});class A extends y{constructor(){super(...arguments),Object.defineProperty(this,"_maxRadius",{enumerable:!0,configurable:!0,writable:!0,value:1})}_afterNew(){super._afterNew(),this.seriesContainer.setAll({x:f,y:f})}_prepareChildren(){super._prepareChildren();const t=this.chartContainer,e=t.innerWidth(),i=t.innerHeight(),s=this.get("startAngle",0),a=this.get("endAngle",0),l=this.get("innerRadius");let r=j(0,0,s,a,1);const u=e/(r.right-r.left),h=i/(r.bottom-r.top);let o={left:0,right:0,top:0,bottom:0};if(l instanceof z){let c=l.value,p=Math.min(u,h);c=Math.max(p*c,p-Math.min(i,e))/p,o=j(0,0,s,a,c),this.setPrivateRaw("irModifyer",c/l.value)}r=K([r,o]);const g=this._maxRadius;this._maxRadius=Math.min(u,h);const n=b(this.get("radius",0),this._maxRadius);this.seriesContainer.setAll({dy:-n*(r.bottom+r.top)/2,dx:-n*(r.right+r.left)/2}),(this.isDirty("startAngle")||this.isDirty("endAngle")||g!=this._maxRadius)&&this.series.each(c=>{c._markDirtyKey("startAngle")}),(this.isDirty("innerRadius")||this.isDirty("radius"))&&this.series.each(c=>{c._markDirtyKey("innerRadius")})}radius(t){let e=b(this.get("radius",0),this._maxRadius),i=b(this.get("innerRadius",0),e);if(t){let s=this.series.indexOf(t),a=this.series.length,l=t.get("radius");return l!=null?i+b(l,e-i):i+(e-i)/a*(s+1)}return e}innerRadius(t){const e=this.radius();let i=b(this.get("innerRadius",0),e);if(i<0&&(i=e+i),t){let s=this.series.indexOf(t),a=this.series.length,l=t.get("innerRadius");return l!=null?i+b(l,e-i):i+(e-i)/a*s}return i}_updateSize(){super._updateSize(),this.markDirtyKey("radius")}}Object.defineProperty(A,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PieChart"});Object.defineProperty(A,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:y.classNames.concat([A.className])});class w extends _{_makeSlices(){return new T(x.new({}),()=>E._new(this._root,{themeTags:P(this.slices.template.get("themeTags",[]),["pie","series"])},[this.slices.template]))}_makeLabels(){return new T(x.new({}),()=>$._new(this._root,{themeTags:P(this.labels.template.get("themeTags",[]),["pie","series"])},[this.labels.template]))}_makeTicks(){return new T(x.new({}),()=>Y._new(this._root,{themeTags:P(this.ticks.template.get("themeTags",[]),["pie","series"])},[this.ticks.template]))}processDataItem(t){super.processDataItem(t);const e=this.makeSlice(t);e.on("scale",()=>{this._updateTick(t)}),e.on("shiftRadius",()=>{this._updateTick(t)}),e.events.on("positionchanged",()=>{this._updateTick(t)});const i=this.makeLabel(t);i.events.on("positionchanged",()=>{this._updateTick(t)}),this.makeTick(t),e.events.on("positionchanged",()=>{i.markDirty()})}_getNextUp(){const t=this.chart;return t?t._maxRadius:this.labelsContainer.maxHeight()/2}_getNextDown(){const t=this.chart;return t?-t._maxRadius:-this.labelsContainer.maxHeight()/2}_prepareChildren(){super._prepareChildren();const t=this.chart;if(t){if(this.isDirty("alignLabels")){let e=this.labels.template;if(this.get("alignLabels"))e.set("textType","aligned");else{let i=e.get("textType");(i==null||i=="aligned")&&e.set("textType","adjusted")}}if(this._valuesDirty||this.isDirty("radius")||this.isDirty("innerRadius")||this.isDirty("startAngle")||this.isDirty("endAngle")||this.isDirty("alignLabels")){this.markDirtyBounds();const e=this.get("startAngle",t.get("startAngle",-90)),s=this.get("endAngle",t.get("endAngle",270))-e;let a=e;const l=t.radius(this);this.setPrivateRaw("radius",l);let r=t.innerRadius(this)*t.getPrivate("irModifyer",1);r<0&&(r=l+r),d(this._dataItems,u=>{this.updateLegendValue(u);let h=s*u.get("valuePercentTotal")/100;const o=u.get("slice");if(o){o.set("radius",l),o.set("innerRadius",r),o.set("startAngle",a),o.set("arc",h);const c=u.get("fill");o._setDefault("fill",c),o._setDefault("stroke",c);const p=u.get("fillPattern");o._setDefault("fillPattern",p)}let g=q(a+h/2);const n=u.get("label");if(n&&(n.setPrivate("radius",l),n.setPrivate("innerRadius",r),n.set("labelAngle",g),n.get("textType")=="aligned")){let c=l+n.get("radius",0),p=l*m(g);g>90&&g<=270?(!n.isHidden()&&!n.isHiding()&&this._lLabels.push({label:n,y:p}),c*=-1,c-=this.labelsContainer.get("paddingLeft",0),n.set("centerX",L),n.setPrivateRaw("left",!0)):(!n.isHidden()&&!n.isHiding()&&this._rLabels.push({label:n,y:p}),c+=this.labelsContainer.get("paddingRight",0),n.set("centerX",0),n.setPrivateRaw("left",!1)),n.set("x",c),n.set("y",l*m(g))}a+=h,this._updateTick(u)})}}}_updateTick(t){const e=t.get("tick"),i=t.get("label"),s=t.get("slice"),a=e.get("location",1);if(e&&i&&s){const l=(s.get("shiftRadius",0)+s.get("radius",0))*s.get("scale",1)*a,r=i.get("labelAngle",0),u=R(r),h=m(r),o=this.labelsContainer,g=o.get("paddingLeft",0),n=o.get("paddingRight",0);let c=0,p=0;c=i.x(),p=i.y();let S=[];if(c!=0||p!=0){if(i.get("textType")=="circular"){const N=i.radius()-i.get("paddingBottom",0),O=i.get("labelAngle",0);c=N*R(O),p=N*m(O)}let C=-n;i.getPrivate("left")&&(C=g),S=[{x:s.x()+l*u,y:s.y()+l*h},{x:c+C,y:p},{x:c,y:p}]}e.set("points",S)}}_positionBullet(t){const e=t.get("sprite");if(e){const s=e.dataItem.get("slice");if(s){const a=s.get("innerRadius",0),l=s.get("radius",0),r=s.get("startAngle",0),u=s.get("arc",0),h=t.get("locationX",.5),o=t.get("locationY",.5),g=r+u*h,n=a+(l-a)*o;e.setAll({x:R(g)*n,y:m(g)*n})}}}}Object.defineProperty(w,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PieSeries"});Object.defineProperty(w,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:_.classNames.concat([w.className])});const le=Object.freeze(Object.defineProperty({__proto__:null,PieChartAm5:A,PieSeriesAm5:w},Symbol.toStringTag,{value:"Module"}));export{_ as P,y as a,G as b,A as c,w as d,le as p};
