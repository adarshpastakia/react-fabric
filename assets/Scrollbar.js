import{R as b,B as v}from"./Button3.js";import{C as w,G as x}from"./Label.js";import{i as g}from"./Disposer.js";import{m as f,i as D}from"./Animation.js";class _ extends w{constructor(){super(...arguments),Object.defineProperty(this,"thumb",{enumerable:!0,configurable:!0,writable:!0,value:this._makeThumb()}),Object.defineProperty(this,"startGrip",{enumerable:!0,configurable:!0,writable:!0,value:this._makeButton()}),Object.defineProperty(this,"endGrip",{enumerable:!0,configurable:!0,writable:!0,value:this._makeButton()}),Object.defineProperty(this,"_thumbBusy",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_startDown",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_endDown",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_thumbDown",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_gripDown",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}_addOrientationClass(){this._settings.themeTags=f(this._settings.themeTags,["scrollbar",this._settings.orientation]),this._settings.background||(this._settings.background=b.new(this._root,{themeTags:f(this._settings.themeTags,["main","background"])}))}_makeButton(){return this.children.push(v.new(this._root,{themeTags:["resize","button",this.get("orientation")],icon:x.new(this._root,{themeTags:["icon"]})}))}_makeThumb(){return this.children.push(b.new(this._root,{themeTags:["thumb",this.get("orientation")]}))}_handleAnimation(t){t&&this._disposers.push(t.events.on("stopped",()=>{this.setPrivateRaw("isBusy",!1),this._thumbBusy=!1}))}_afterNew(){this._addOrientationClass(),super._afterNew();const t=this.startGrip,s=this.endGrip,i=this.thumb,n=this.get("background");n&&this._disposers.push(n.events.on("click",e=>{this.setPrivateRaw("isBusy",!0);const a=this._display.toLocal(e.point),r=this.width(),o=this.height(),u=this.get("orientation");let h;u=="vertical"?h=(a.y-i.height()/2)/o:h=(a.x-i.width()/2)/r;let d,l;u=="vertical"?(d=h*o,l="y"):(d=h*r,l="x");const p=this.get("animationDuration",0);p>0?(this._thumbBusy=!0,this._handleAnimation(this.thumb.animate({key:l,to:d,duration:p,easing:this.get("animationEasing")}))):(this.thumb.set(l,d),this._root.events.once("frameended",()=>{this.setPrivateRaw("isBusy",!1)}))})),this._disposers.push(i.events.on("dblclick",e=>{if(!D(e.originalEvent,this))return;const a=this.get("animationDuration",0),r=this.get("animationEasing");this.animate({key:"start",to:0,duration:a,easing:r}),this.animate({key:"end",to:1,duration:a,easing:r})})),this._disposers.push(t.events.on("pointerdown",()=>{this.setPrivateRaw("isBusy",!0),this._startDown=!0,this._gripDown="start"})),this._disposers.push(s.events.on("pointerdown",()=>{this.setPrivateRaw("isBusy",!0),this._endDown=!0,this._gripDown="end"})),this._disposers.push(i.events.on("pointerdown",()=>{this.setPrivateRaw("isBusy",!0),this._thumbDown=!0,this._gripDown=void 0})),this._disposers.push(t.events.on("globalpointerup",()=>{this._startDown&&(this.setPrivateRaw("isBusy",!1),this._released()),this._startDown=!1})),this._disposers.push(s.events.on("globalpointerup",()=>{this._endDown&&(this.setPrivateRaw("isBusy",!1),this._released()),this._endDown=!1})),this._disposers.push(i.events.on("globalpointerup",()=>{this._thumbDown&&(this.setPrivateRaw("isBusy",!1),this._released()),this._thumbDown=!1})),this._disposers.push(t.on("x",()=>{this._updateThumb()})),this._disposers.push(s.on("x",()=>{this._updateThumb()})),this._disposers.push(t.on("y",()=>{this._updateThumb()})),this._disposers.push(s.on("y",()=>{this._updateThumb()})),this._disposers.push(i.events.on("positionchanged",()=>{this._updateGripsByThumb()})),this.get("orientation")=="vertical"?(t.set("x",0),s.set("x",0),this._disposers.push(i.adapters.add("y",e=>Math.max(Math.min(Number(e),this.height()-i.height()),0))),this._disposers.push(i.adapters.add("x",e=>this.width()/2)),this._disposers.push(t.adapters.add("x",e=>this.width()/2)),this._disposers.push(s.adapters.add("x",e=>this.width()/2)),this._disposers.push(t.adapters.add("y",e=>Math.max(Math.min(Number(e),this.height()),0))),this._disposers.push(s.adapters.add("y",e=>Math.max(Math.min(Number(e),this.height()),0)))):(t.set("y",0),s.set("y",0),this._disposers.push(i.adapters.add("x",e=>Math.max(Math.min(Number(e),this.width()-i.width()),0))),this._disposers.push(i.adapters.add("y",e=>this.height()/2)),this._disposers.push(t.adapters.add("y",e=>this.height()/2)),this._disposers.push(s.adapters.add("y",e=>this.height()/2)),this._disposers.push(t.adapters.add("x",e=>Math.max(Math.min(Number(e),this.width()),0))),this._disposers.push(s.adapters.add("x",e=>Math.max(Math.min(Number(e),this.width()),0))))}_updateChildren(){super._updateChildren(),(this.isDirty("end")||this.isDirty("start")||this._sizeDirty)&&this.updateGrips()}_changed(){if(super._changed(),this.isDirty("start")||this.isDirty("end")){const t="rangechanged";this.events.isEnabled(t)&&this.events.dispatch(t,{type:t,target:this,start:this.get("start",0),end:this.get("end",1),grip:this._gripDown})}}_released(){const t="released";this.events.isEnabled(t)&&this.events.dispatch(t,{type:t,target:this})}updateGrips(){const t=this.startGrip,s=this.endGrip,i=this.get("orientation"),n=this.height(),e=this.width();i=="vertical"?(t.set("y",n*this.get("start",0)),s.set("y",n*this.get("end",1))):(t.set("x",e*this.get("start",0)),s.set("x",e*this.get("end",1)));const a=this.getPrivate("positionTextFunction"),r=Math.round(this.get("start",0)*100),o=Math.round(this.get("end",0)*100);let u,h;a?(u=a.call(this,this.get("start",0)),h=a.call(this,this.get("end",0))):(u=r+"%",h=o+"%"),t.set("ariaLabel",this._t("From %1",void 0,u)),t.set("ariaValueNow",""+r),t.set("ariaValueText",r+"%"),t.set("ariaValueMin","0"),t.set("ariaValueMax","100"),s.set("ariaLabel",this._t("To %1",void 0,h)),s.set("ariaValueNow",""+o),s.set("ariaValueText",o+"%"),s.set("ariaValueMin","0"),s.set("ariaValueMax","100")}_updateThumb(){const t=this.thumb,s=this.startGrip,i=this.endGrip,n=this.height(),e=this.width();let a=s.x(),r=i.x(),o=s.y(),u=i.y(),h=0,d=1;this.get("orientation")=="vertical"?g(o)&&g(u)&&(!this._thumbBusy&&!t.isDragging()&&(t.set("height",u-o),t.set("y",o)),h=o/n,d=u/n):g(a)&&g(r)&&(!this._thumbBusy&&!t.isDragging()&&(t.set("width",r-a),t.set("x",a)),h=a/e,d=r/e),this.getPrivate("isBusy")&&(this.get("start")!=h||this.get("end")!=d)&&(this.set("start",h),this.set("end",d));const l=this.getPrivate("positionTextFunction"),p=Math.round(this.get("start",0)*100),y=Math.round(this.get("end",0)*100);let c,m;l?(c=l.call(this,this.get("start",0)),m=l.call(this,this.get("end",0))):(c=p+"%",m=y+"%"),t.set("ariaLabel",this._t("From %1 to %2",void 0,c,m)),t.set("ariaValueNow",""+p),t.set("ariaValueText",p+"%")}_updateGripsByThumb(){const t=this.thumb,s=this.startGrip,i=this.endGrip;if(this.get("orientation")=="vertical"){const n=t.height();s.set("y",t.y()),i.set("y",t.y()+n)}else{const n=t.width();s.set("x",t.x()),i.set("x",t.x()+n)}}}Object.defineProperty(_,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Scrollbar"});Object.defineProperty(_,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:w.classNames.concat([_.className])});export{_ as S};
