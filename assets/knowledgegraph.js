const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./knowledgeGraphService.js","./ShadowCastClear.glsl.js","./iframe-DwvN93Ge.js","./iframe-CGchYWp9.css","./index.js","./Viewport.js","./Section.js","./ErrorBoundary.js","./createClass.js","./Global.js","./useIsDark.js","./debounce.js","./index2.js","./ShadowCastClear-Cq39gfL_.css","./networkEnums.js","./GPMessage.js","./GraphQueryStreaming.js"])))=>i.map(i=>d[i]);
import{b8 as j}from"./iframe-DwvN93Ge.js";import{c9 as u,M as x,k4 as w,k6 as k,k as N,f_ as A,k5 as I,kg as q,hG as J,kh as B,ki as L,eB as Q,K as b,hH as V,hI as O,kj as U,kk as z}from"./ShadowCastClear.glsl.js";import{t as C}from"./arcade2.js";import{o as P,g as T,D as H,z as W,p as D,K as X,f as G,c as Y,i as Z,j as $,U as E}from"./Dictionary.js";import{l as tt}from"./portalUtils.js";import{p as et,a as nt,e as rt,i as at,b as it}from"./GraphQueryStreaming.js";import"./index.js";import"./Viewport.js";import"./Section.js";import"./ErrorBoundary.js";import"./createClass.js";import"./Global.js";import"./useIsDark.js";import"./debounce.js";import"./index2.js";import"./arcadeEnvironment.js";import"./Feature.js";import"./aiServices.js";import"./commonProperties.js";import"./ImmutableArray.js";import"./WhereClause.js";import"./unitConversion.js";import"./number.js";import"./hash.js";let c=null;async function ot(t){const e=J.geometryServiceUrl??"";if(!e){B()||await L();for(const n of t)n.container[n.indexer]=Q(n.container[n.indexer],b.WGS84);return}const r=t.map(n=>n.container[n.indexer]),i=new V({geometries:r,outSpatialReference:b.WGS84}),s=await O(e,i);for(let n=0;n<s.length;n++){const a=t[n];a.container[a.indexer]=s[n]}}async function K(t,e){const r=new N({portal:t,id:e});return await r.load(),c===null&&(c=await j(()=>import("./knowledgeGraphService.js").then(i=>i.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),import.meta.url)),await c.fetchKnowledgeGraph(r.url)}function S(t,e,r,i,s){if(t===null)return null;if(w(t)||A(t))return t;if(G(t)||G(t))return t.toJSDate();if(Y(t))return t.toStorageFormat();if(Z(t))return t.toStorageString();if($(t)){const n={};for(const a of t.keys())n[a]=S(t.field(a),e,r,i,s),n[a]instanceof I&&s.push({container:n,indexer:a});return n}if(k(t)){const n=t.map(a=>S(a,e,r,i,s));for(let a=0;a<n.length;a++)n[a]instanceof I&&s.push({container:n,indexer:a});return n}return E(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&e?q(t):t:void 0}function st(t,e){if(!t)return t;if(t.spatialReference.isWGS84&&e.spatialReference.isWebMercator)return z(t);if(t.spatialReference.equals(e.spatialReference))return t;throw new u(e,"WrongSpatialReference",null)}function v(t,e){if(!t)return null;const r={};for(const i in t)r[i]=d(t[i],e);return r}function d(t,e){return t===null?null:k(t)?t.map(r=>d(r,e)):t instanceof nt?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:v(t.properties,e)}:t instanceof rt?{graphType:"object",properties:v(t.properties,e)}:t instanceof at?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:v(t.properties,e)}:t instanceof it?{graphType:"path",path:t.path?t.path.map(r=>d(r,e)):null}:E(t)?st(t,e):w(t)||A(t)||U(t)?t:null}function Kt(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(e,r){return t.standardFunctionAsync(e,r,(i,s,n)=>{var f,m;if(P(n,2,2,e,r),n[0]===null)throw new u(e,"PortalRequired",r);if(n[0]instanceof C){const l=T(n[1]);let h;return h=(f=e.services)!=null&&f.portal?e.services.portal:x.getDefault(),K(tt(n[0],h),l)}if(w(n[0])===!1)throw new u(e,"InvalidParameter",r);const a=T(n[0]);return K(((m=e.services)==null?void 0:m.portal)??x.getDefault(),a)})},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(e,r){return t.standardFunctionAsync(e,r,async(i,s,n)=>{var _;P(n,2,4,e,r);const a=n[0];if(!H(a))throw new u(e,"InvalidParameter",r);const f=n[1];if(!w(f))throw new u(e,"InvalidParameter",r);c===null&&(c=await j(()=>import("./knowledgeGraphService.js").then(o=>o.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),import.meta.url));let m=null;const l=W(n[2],null);if(!(l instanceof D||l===null))throw new u(e,"InvalidParameter",r);if(l){let o=[];m=S(l,!0,!1,e,o),o=o.filter(p=>!p.container[p.indexer].spatialReference.isWGS84),o.length>0&&await ot(o)}const h=W(n[3],!1),R=new et({openCypherQuery:f,bindParameters:m,provenanceBehavior:h?"include":"exclude"});(((_=a==null?void 0:a.serviceDefinition)==null?void 0:_.currentVersion)??11.3)>11.2&&(R.outputSpatialReference=e.spatialReference);const F=(await c.executeQueryStreaming(a,R)).resultRowsStream.getReader(),y=[];try{for(;;){const{done:o,value:p}=await F.read();if(o)break;if(k(p))for(const g of p)y.push(d(g,e));else{const g=[];for(const M of p)g.push(d(p[M],e));y.push(g)}}}catch(o){throw o}return D.convertJsonToArcade(y,X(e),!1,!0)})},t.signatures.push({name:"querygraph",min:2,max:4}))}export{Kt as registerFunctions};
