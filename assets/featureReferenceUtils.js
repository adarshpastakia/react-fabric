import{fi as h,bJ as I,gF as v,h9 as T,gK as q,gy as w,ha as A,hb as O,hc as P}from"./ShadowCastClear.glsl.js";function k(e,r){return f(e)===f(r)}function f(e){if(e==null)return null;const r=e.layer!=null?e.layer.id:"";let t=null;return t=e.objectId!=null?e.objectId:e.layer!=null&&"objectIdField"in e.layer&&e.layer.objectIdField!=null&&e.attributes!=null?e.attributes[e.layer.objectIdField]:e.uid,t==null?null:`o-${r}-${t}`}const z={json:{write:{writer:x,target:{"feature.layerId":{type:[Number,String],isRequired:!0},"feature.objectId":{type:[Number,String],isRequired:!0}}},origins:{"web-scene":{read:H}}},clonable:"reference"};function x(e,r){var t;((t=e==null?void 0:e.layer)==null?void 0:t.objectIdField)!=null&&e.attributes!=null&&(r.feature={layerId:e.layer.id,objectId:e.attributes[e.layer.objectIdField]})}function H(e){if(e.layerId!=null&&e.objectId!=null)return{uid:null,layer:{id:e.layerId,objectIdField:"ObjectId"},attributes:{ObjectId:e.objectId}}}function B(e,r,t,l){const{sceneIntersectionHelper:F}=e,{observer:y,observerFeatureId:i,targetFeatureId:d,target:j}=t;if(i==null&&d==null)return;l||(l=n=>n),h(s,y,j);const o=v(s),c=1;T(s,y,s,c/o);const N=q(s,j,K);r.options.store=2,F.intersectToolIntersectorRay(N,r);let g=null,m=null,a=null,u=null;for(const n of r.results.all){const S=A(n,e);if(S==null||n.distanceInRenderSpace==null)continue;const b=f(S);b!=null&&(i!=null&&b===i&&(g??(g=l(p(n,e,o))),n.distanceInRenderSpace-c<g&&(a=n)),d!=null&&b===d&&(m??(m=l(p(n,e,o))),u==null&&n.distanceInRenderSpace-c<o&&o-n.distanceInRenderSpace+c<m&&(u=n)))}const{observerAdjusted:R,targetAdjusted:$}=t;a!=null&&a.getIntersectionPoint(R)?t.observerSurfaceNormal=a.getTransformedNormal(I()):t.observerSurfaceNormal=null,u!=null&&u.getIntersectionPoint($)?t.targetSurfaceNormal=u.getTransformedNormal(I()):t.targetSurfaceNormal=null}function p(e,r,t){if(O(e)){const l=P(e,r);if(l!=null)return Math.min(l*J,t)}return 1e-5*t}const J=.05,K=w(),s=I();export{B as I,k as c,z as d,f as s};
