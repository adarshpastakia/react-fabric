import{bE as T,xZ as _e,wh as We,EW as ke,F1 as se,FW as ie,F3 as Oe,EV as Ae,F5 as Te,F6 as je,F7 as Ge,Fc as Ie,GE as De,Fi as Ee,GF as Le,Fr as He,Fp as Ve,bG as ne,op as ze,gF as M,bI as V,h0 as c,bK as p,bL as h,wN as ee,sB as G,mV as we,mY as j,fe as v,gE as ve,st as Me,nq as Ce,a5 as Be,FU as Je,fa as qe,uy as Pe,GG as N,sy as Ke,eU as ae,Am as Ne,l as Ye,GH as Qe,gy as Ze,fc as _,go as W,sz as Xe,D8 as et,fW as C,GI as Y,GJ as tt,GK as rt,hl as st,wP as Ue,fV as w,mn as it,bM as nt,bj as at,b5 as ot,h3 as ct,b8 as F,gM as oe,bJ as z,fb as Q,yh as ce,wn as le,hn as K,kp as de,pc as ue,GL as ge,wR as he,D6 as lt}from"./ShadowCastClear.glsl.js";import{g as dt,j as ut,u as fe,v as gt,C as H,e as ht,i as pe,n as Se,x as Z,U as ft,S as be,l as pt,a as bt,c as mt}from"./sliceToolConfig.js";import{c as $t}from"./SlicePlane.js";import{o as _t,w as wt,p as vt,r as Mt,Y as Ct,t as x}from"./ShadedColorMaterial.glsl.js";import{f as Re}from"./DefaultLayouts.js";import{i as Pt}from"./TriangleMaterial.js";import{b6 as Ut}from"./iframe-DpfJK_wQ.js";import{m as E}from"./ColorMaterial.glsl.js";const St=T(0,0,0,.04);function Rt({accentColor:e}){return _e(e,.5)}function yt({accentColor:e}){return _e(e,.7)}function ye(e){const t=new We,{vertex:a,fragment:n,attributes:s,varyings:i}=t;return ke(a,e),s.add("position","vec3"),s.add("uv0","vec2"),i.add("vUV","vec2"),a.main.add(se`vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);`),n.uniforms.add(new ie("backgroundColor",r=>r.backgroundColor),new ie("gridColor",r=>r.gridColor),new Oe("gridWidth",r=>r.gridWidth)).main.add(se`const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;`),t}const Ft=Object.freeze(Object.defineProperty({__proto__:null,build:ye},Symbol.toStringTag,{value:"Module"}));class xt extends Ae{constructor(){super(...arguments),this.backgroundColor=T(1,0,0,.5),this.gridColor=T(0,1,0,.5),this.gridWidth=4}}class Wt extends Te{constructor(t,a){super(t,a,new je(Ft,()=>Ut(()=>Promise.resolve().then(()=>Vt),void 0,import.meta.url)),Re.locations)}initializePipeline(){return Ge({blending:De,depthTest:{func:513},colorWrite:Ie})}}class kt extends Pt{constructor(t){super(t,At),this.produces=new Map([[8,a=>Ee(a)]]),this._configuration=new Le}get visible(){return!0}createGLMaterial(t){return new Ot(t)}createBufferWriter(){return new He(Re)}getConfiguration(){return this._configuration}}class Ot extends Ve{constructor(t){super(t)}beginSlot(t){return this.getTechnique(Wt,t)}}class At extends xt{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}}class Tt extends _t{constructor(t){super(t),this._material=null,this._renderOccluded=4,this._gridWidth=1,this._gridColor=T(1,0,0,1),this._backgroundColor=T(1,0,0,1),this.applyProperties(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(t){this._gridWidth!==t&&(this._gridWidth=t,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(t){ne(this._gridColor,t),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){ne(this._backgroundColor,t),this._updateMaterial()}createExternalResources(){this._material=new kt(this._materialParameters)}destroyExternalResources(){this._material=null}forEachMaterial(t){t(this._material)}createGeometries(t){if(this._material!=null){const a=ze(this._material);t.addGeometry(a)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){var t;(t=this._material)==null||t.setParameters(this._materialParameters)}}function Zt(e,t,a,n,s,i,r,o){return jt(t,r.worldUpAtPosition(e,c.get()),s,i,o.basis1,o.basis2),h(o.basis1,o.basis1,a),h(o.basis2,o.basis2,n),v(o.origin,e),Pe(o.basis2,o.basis1,o.origin,o.plane),o}function jt(e,t,a,n,s,i){const r=W(e,t),o=c.get(),l=c.get();switch(n===0?Math.abs(r)>ht?1:2:n){case 2:{const u=Math.abs(r)<=pe?e:a.viewUp;w(o,u,t),v(l,t);break}case 1:w(o,a.viewUp,t),w(l,t,o);break;case 3:{const u=Math.abs(r)<=pe?t:a.viewUp;w(o,u,e),w(l,e,o);break}}const d=w(c.get(),o,l);W(d,a.viewForward)>0&&h(l,l,-1),C(s,o),C(i,l)}function Gt(e,t,a){const n=t.worldUpAtPosition(e.origin,c.get()),s=e.basis1,i=re(e,n),r=Math.round(i/k)*k;return N(e,r-i,s,a)}function Xt(e,t,a,n,s,i){const r=v(c.get(),s.origin);p(r,r,h(c.get(),s.basis1,e.direction[0]<0?1:-1)),p(r,r,h(c.get(),s.basis2,e.direction[1]<0?1:-1));const o=M(s.basis1),l=M(s.basis2),d=_(c.get(),a,r),u=_(c.get(),t,r);let g=0,b=0;if(xe(e)){const J=X(s),O=X(i);g=o-.5*e.direction[0]*W(s.basis1,u)/o,b=l-.5*e.direction[1]*W(s.basis2,u)/l;const I=O/J;g*=I,b*=I}const f=g+.5*e.direction[0]*W(s.basis1,d)/o,$=b+.5*e.direction[1]*W(s.basis2,d)/l,R=h(c.get(),s.basis1,f/o),P=h(c.get(),s.basis2,$/l);(f<=0||me(i.origin,R,n)<=fe)&&v(R,i.basis1),($<=0||me(i.origin,P,n)<=fe)&&v(P,i.basis2);const m=v(c.get(),r);return p(m,m,h(c.get(),R,e.direction[0]<0?-1:1)),p(m,m,h(c.get(),P,e.direction[1]<0?-1:1)),Xe(m,R,P,i)}function er(e,t){return gt*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}function tr(e,t,a,n){const s=w(c.get(),t,a);return w(s,s,t),ve(e,s,n)}function rr(e,t){return wt(e.basis1,e.basis2,e.origin,t)}function sr(e,t,a,n){const s=t.worldUpAtPosition(e.origin,c.get()),i=c.get();switch(a){case 1:v(i,s);break;case 2:v(i,e.basis1)}return ve(e.origin,i,n)}function ir(e,t,a,n){const s=te(a,2),i=G.get();et(i,t,s.edge*Math.PI/2);const r=C(c.get(),s.basis);let o=h(c.get(),r,s.direction*n.computeScreenPixelSizeAt(s.position)*H);p(o,o,s.position);const l=n.projectToRenderScreen(o,Y(c.get())),d=It(n,l);tt(n,l,L),C(L.direction,L.direction);const u=c.get();!d&&rt(a,L,u)&&(o=u),i[12]=0,i[13]=0,i[14]=0,e.modelTransform=i,e.renderLocation=st(o),d?e.state|=B:e.state&=~B}function It(e,t){if(t==null)return!1;const[a,n,s,i]=e.viewport,r=Math.min(s,i)/16;let o=!0;return t[0]<a+r?(t[0]=a+r,o=!1):t[0]>a+s-r&&(t[0]=a+s-r,o=!1),t[1]<n+r?(t[1]=n+r,o=!1):t[1]>n+i-r&&(t[1]=n+i-r,o=!1),o}function nr(e,t,a,n){const s=M(n.basis1),i=M(n.basis2),r=Fe(n),o=X(n),l=V(c.get(),0,0,0);p(l,h(c.get(),n.basis1,t.direction[0]),h(c.get(),n.basis2,t.direction[1])),p(l,n.origin,l);let d=0,u=1;if(xe(t))t.direction[0]===1&&t.direction[1]===-1?d=k:t.direction[0]===1&&t.direction[1]===1?d=Math.PI:t.direction[0]===-1&&t.direction[1]===1&&(d=3*Math.PI/2),u=o;else{const b=t.direction[0]!==0?1:2;d=b===1?k:0,u=(b===1?i:s)-r}const g=ee(G.get(),d);we(g,g,V(c.get(),u,u,u)),j(g,a,g),g[12]=0,g[13]=0,g[14]=0,e.modelTransform=g,e.renderLocation=l}function ar(e,t,a,n){const s=n.worldUpAtPosition(a.origin,c.get()),i=te(a,0),r=ee(G.get(),i.edge*Math.PI/2);Ue(r,r,-re(a,s)),j(r,t,r),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=i.position}function or(e,t,a){const n=te(a,1),s=ee(G.get(),n.edge*Math.PI/2);Ue(s,s,k),j(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=n.position}function te(e,t){switch(t){case 0:return{basis:e.basis1,direction:1,position:p(c.get(),e.origin,e.basis1),edge:t};case 1:return{basis:e.basis2,direction:1,position:p(c.get(),e.origin,e.basis2),edge:t};case 2:return{basis:e.basis1,direction:-1,position:_(c.get(),e.origin,e.basis1),edge:t};case 3:return{basis:e.basis2,direction:-1,position:_(c.get(),e.origin,e.basis2),edge:t}}}function me(e,t,a){const n=a.projectToRenderScreen(p(c.get(),e,t),Y(c.get())),s=a.projectToRenderScreen(_(c.get(),e,t),Y(c.get()));return n&&s?it(_(n,n,s)):0}function Fe(e){const t=M(e.basis1),a=M(e.basis2);return dt*Math.min(t,a)}function X(e){return Fe(e)}function xe(e){return e.direction[0]!==0&&e.direction[1]!==0}function cr(e){const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new vt({view:e,attached:!1,color:yt(e.effectiveTheme),width:ut,renderOccluded:4,geometry:[t],isDecoration:!0})}function lr(e){return new Tt({view:e,attached:!1,backgroundColor:St,gridColor:Rt(e.effectiveTheme),gridWidth:4,renderOccluded:4,isDecoration:!0})}function dr(e,t,a,n=new $t){if(e==null)return null;const{renderCoordsHelper:s}=t,i=s.fromRenderCoords(e.origin,new Be({spatialReference:t.spatialReference}));if(i==null)return null;const r=Je(i,a);if(r==null)return null;n.position=r;const o=2*M(e.basis1),l=2*M(e.basis2),d=Ce.renderUnitScaleFactor(t.spatialReference,a);n.width=o*d,n.height=l*d;const u=s.worldUpAtPosition(e.origin,c.get());return n.tilt=qe(re(e,u)),n.heading=s.headingAtPosition(e.origin,e.basis1)-90,n}function re(e,t){return Qe(t,e.basis2,e.basis1)+k}function Dt(e,t,a,n,s,i,r=Me()){return i.toRenderCoords(e,r.origin)?(i.worldBasisAtPosition(r.origin,0,r.basis1),i.worldBasisAtPosition(r.origin,1,r.basis2),Pe(r.basis2,r.basis1,r.origin,r.plane),N(r,-ae(t),Ke(r),r),N(r,ae(a),r.basis1,r),h(r.basis1,r.basis1,n/2),h(r.basis2,r.basis2,s/2),Ne(r),r):(Ye.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function ur(e,t){if((e==null?void 0:e.position)==null)return null;const a=Mt(e.position,t.spatialReference,t.elevationProvider);if(a==null)return null;const n=Ce.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),s=e.width*n,i=e.height*n;return{position:a,heading:e.heading,tilt:e.tilt,renderWidth:s,renderHeight:i}}function gr(e,t,a,n=Me()){if(e==null)return null;const s=Dt(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,n);return a.tiltEnabled||s==null||Gt(s,t.renderCoordsHelper,s),s}const S=16,B=32,L=Ze(),k=Math.PI/2,hr=16,fr=32;function pr(e){return(e.type==="building-scene-3d"?e:null)!=null}let br=class extends Ct{constructor(t,a){const n=new nt({width:1,renderOccluded:4,isDecoration:!0},t.state.isGlobal),s=new E({cullFace:2,renderOccluded:16,isDecoration:!0}),i=new E({cullFace:2,renderOccluded:16,isDecoration:!0}),r=new E({cullFace:2,renderOccluded:16,isDecoration:!0}),o=new E({writeDepth:!1,cullFace:1,renderOccluded:2,isDecoration:!0});super({view:t,...Et({offsetMode:a,tubeMaterial:s,tipMaterial:i,capMaterial:r,outlineMaterial:o,calloutMaterial:n})}),this._themeHandle=at(()=>t.effectiveTheme.accentColor,l=>{const d=ct(l),u=F.toUnitRGBA(l),g=F.toUnitRGBA(d),b=F.toUnitRGBA(F.blendColors(d,l,.4)),f=F.toUnitRGBA(F.blendColors(d,l,.14));n.setParameters({color:u}),s.setParameters({color:f}),i.setParameters({color:g}),r.setParameters({color:b}),o.setParameters({color:u})},ot)}destroy(){this._themeHandle.remove(),super.destroy()}};function Et({offsetMode:e,tubeMaterial:t,tipMaterial:a,capMaterial:n,outlineMaterial:s,calloutMaterial:i}){const r=e===0?H:0,o=[Q(r,0,-be/2),Q(r,0,be/2)],l=Ht(o),d=$e({vertices:o,padding:0,materials:{tube:t,tip:a,cap:n}}),u=$e({vertices:o,padding:ft,materials:{tube:s,tip:s,cap:s}}),g=oe(i,[[r,0,0],[r-H,0,0]]),b=oe(i,[[r,0,0],[r-H,0,0]]);return{renderObjects:[...d.normal.map(f=>new x(f,1|S)),...u.normal.map(f=>new x(f,1|S)),new x(g,1|S|B),...d.focused.map(f=>new x(f,2|S)),...u.focused.map(f=>new x(f,2|S)),new x(b,2|S|B)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[l]},collisionPriority:1,radius:Se,state:S}}function $e({vertices:e,padding:t,materials:a}){const n=s=>{const i=e.slice(),r=_(c.get(),i[0],i[1]);C(r,r);const o=_(c.get(),i[i.length-1],i[i.length-2]);if(C(o,o),t>0){const A=h(z(),o,-t);i[i.length-1]=p(A,A,i[i.length-1]);const y=h(z(),r,-t);i[0]=p(y,y,i[0])}const l=s?mt:1,d=Z*l,u=Se*l,g=ce(G.get());if(t>0){const A=d/4,y=V(c.get(),0,A,0),D=1+t/A;le(g,g,y),we(g,g,V(c.get(),D,D,D)),le(g,g,h(y,y,-1/D))}const b=ce(K()),f=Q(0,1,0),$=de(K(),ue(ge.get(),f,o));$[12]=i[i.length-1][0],$[13]=i[i.length-1][1],$[14]=i[i.length-1][2],j($,$,g);const R=a.tube,P=Lt(pt*(s?bt:1)+t,i,R);P.transformation=b;const m=[P],J=a.tip,O=he(J,d,u,24,!1,!1,!0);O.transformation=$,m.push(O);const I=a.cap,q=he(I,d,u,24,!1,!0,!1);q.transformation=$,m.push(q);const U=de(K(),ue(ge.get(),f,r));return U[12]=i[0][0],U[13]=i[0][1],U[14]=i[0][2],j(U,U,g),m.push(O.instantiate({transformation:U})),m.push(q.instantiate({transformation:U})),m};return{normal:n(!1),focused:n(!0)}}function Lt(e,t,a){const n=[];for(let i=0;i<12;i++){const r=i/12*2*Math.PI;n.push([Math.cos(r)*e,Math.sin(r)*e])}return lt(a,n,t,[],[],!1)}function Ht(e,t){const a=_(z(),e[e.length-1],e[e.length-2]);C(a,a),h(a,a,Z),p(a,a,e[e.length-1]);{const n=_(z(),e[0],e[1]);return C(n,n),h(n,n,Z),p(n,n,e[0]),[n,...e,a]}}const Vt=Object.freeze(Object.defineProperty({__proto__:null,build:ye},Symbol.toStringTag,{value:"Module"}));export{hr as C,pr as L,gr as R,B as S,ur as U,br as _,Zt as a,xe as b,ir as c,or as d,yt as e,St as f,Rt as g,cr as h,X as i,lr as j,fr as k,nr as l,er as n,tr as o,sr as r,rr as s,Xt as t,ar as u,dr as w,S as x};
