const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./lengthOperator2.js","./ShadowCastClear.glsl.js","./iframe-DwvN93Ge.js","./iframe-CGchYWp9.css","./index.js","./Viewport.js","./Section.js","./ErrorBoundary.js","./createClass.js","./Global.js","./useIsDark.js","./debounce.js","./index2.js","./ShadowCastClear-Cq39gfL_.css","./Point2D.js","./Envelope2D.js","./ProjectionTransformation.js","./Transformation2D.js","./OperatorDefinitions.js","./jsonConverter.js","./apiConverter.js"])))=>i.map(i=>d[i]);
import{f0 as Ne,bj as S,bo as T,hw as te,b6 as Q,b8 as Ee,me as je,E as u,F as c,V as L,O as xe,b as Be,ar as R,fq as Z,eA as fe,K as ke,lq as We,eB as oe,lo as Qe,z3 as Ke,b3 as ue,mU as Xe,hA as Je,vB as Ye,hE as Re,b9 as Ce,vF as et,p4 as tt,bx as De,l1 as N,Bk as st,f$ as it,rb as nt,h$ as at,a4 as ot,Bl as rt,y_ as lt,b1 as ut,bi as ct,oV as pt,fz as ht,bl as Y,ew as dt,bn as W,Bm as mt,a$ as ft,Bn as Ge,f7 as Me,f as vt,f8 as yt,mM as O,yg as gt,yd as _t,ye as wt,hd as re,bS as ce,gH as bt,hh as St,kP as ve,a5 as Pt,bk as pe,Bo as $t,sp as Et,b4 as xt,kM as kt,es as ie,eo as Rt,kK as ye,_ as Ct,x_ as Dt,Bp as Gt,kz as Mt,ez as Vt}from"./ShadowCastClear.glsl.js";import{j as It}from"./createUtils.js";import{s as Lt}from"./ExclusiveOperationManager.js";import{b8 as Ot}from"./iframe-DwvN93Ge.js";import{d as Tt}from"./SketchViewModel.js";function Gs(e){return Ne([S(()=>{const{analysis:t,sketchGraphic:s,toolState:i,visible:a}=e.analysisViewData,{geometryVisualizationVisible:o}=t.viewOptions;return{geometryVisualizationVisible:o,geometry:t.geometry,sketchGraphic:s,toolState:i,visible:a}},({geometryVisualizationVisible:t,sketchGraphic:s,toolState:i,visible:a})=>{if(e.remove(),a)return t&&s!=null&&i!=="reshaping"&&i!=="sketching"?e.show(s):void 0},T)])}let Ve={noDataValue:-5e5,defaultQueryOptions:()=>({noDataValue:Ve.noDataValue,demResolution:"auto",maximumAutoTileRequests:150,ignoreInvisibleLayers:!0,signal:null}),updateThrottleMillis:100,delayAfterPreviewMillis:500,defaultDemResolution:te(10,"centimeters","meters"),densificationMaxSamples:3e3,largeChartSamples:1e4,maxTotalSamples:1e5,maxChartRatio:300,minSlopeSampleDistance:10,formatPrecision:1,profileLinesUpdateThrottleMillis:100,hoveredPointsStyle:{size:14,borderStyle:"solid",borderWidth:3,borderColor:"#ffffff",boxShadow:"0px 0px 0px 5px rgba(255,255,255,0.2)"}};function q(){return Ve}const zt={progress:1,hasZ:!1,samples:[],statistics:null,spatialReference:null};function Ms(e,t){e??(e=[]);const s=e.length-1,i=[];let a=[];for(let o=0;o<=s;o++){const{x:n,y:r,z:l}=e[o];l!=null&&a.push([n,r,l]),o!==s&&l!=null||!a.length||(i.push(a),a=[])}return It(i,t,!0)}let z=class extends Q{constructor(t){super(t),this.position=null,this.color=new Ee("#ffffff"),this.element=qt()}initialize(){var t;this.addHandles([S(()=>this._screenLocation,s=>{s&&(this.element.style.transform=`translate(${s.x}px, ${s.y}px)`)},T),S(()=>this.color.toCss(),s=>{this.element.style.background=s},T)]),(t=this.view.surface)==null||t.appendChild(this.element)}destroy(){this.element.remove()}get _screenLocation(){const{position:t,view:s}=this;s.type==="3d"?(s.commitProperty("size"),s.commitProperty("camera")):s.commitProperty("center");const i=s==null?void 0:s.spatialReference,a=i?je(t,i).geometry:null;return a&&(s!=null&&s.ready)?s.toScreen(a):null}};function qt(){const e=document.createElement("div"),{size:t,borderStyle:s,borderColor:i,borderWidth:a,boxShadow:o}=q().hoveredPointsStyle,{style:n}=e;return n.display="block",n.position="absolute",n.top="0",n.left="0",n.contain="strict",n.boxSizing="border-box",n.width=`${t}px`,n.height=`${t}px`,n.marginTop=`-${t/2}px`,n.marginLeft=`-${t/2}px`,n.border=`${s} ${a}px ${i}`,n.borderRadius=`${t}px`,n.boxShadow=o,e}u([c()],z.prototype,"position",void 0),u([c({type:Ee})],z.prototype,"color",void 0),u([c()],z.prototype,"view",void 0),u([c()],z.prototype,"_screenLocation",null),z=u([L("esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointVisualization")],z);let U=class extends Q{constructor(t){super(t),this._hoveredPoints=new xe}initialize(){const{analysisViewData:t}=this,{analysis:s}=t;this.addHandles([S(()=>{const{hoveredPoints:i,visible:a,updating:o}=t;return a?o?null:i.map((n,r)=>{const l=s.profiles.at(r);return(l==null?void 0:l.viewOptions.hoveredPointVisible)===!0&&n!=null?{hoveredPoint:n,color:l.color}:null}).filter(n=>!!n):[]},i=>this._update(i),T),S(()=>s.geometry,()=>this._update([]),T)])}destroy(){this._hoveredPoints.drain(t=>t.destroy())}get updating(){return!1}_update(t){var o;if(!t)return;const{view:s,_hoveredPoints:i}=this,a=t.length;for(;i.length>a;)(o=i.pop())==null||o.destroy();for(;i.length<a;){const n=new z({view:s});i.push(n)}for(let n=0;n<a;++n){const r=t[n],l=i.at(a-1-n);l.position=r.hoveredPoint,l.color=r.color}}};u([c()],U.prototype,"view",void 0),u([c()],U.prototype,"analysisViewData",void 0),u([c()],U.prototype,"_hoveredPoints",void 0),u([c()],U.prototype,"updating",null),U=u([L("esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointsVisualization")],U);function E(e,t){let s,i=!1;function a(...o){const n=e.apply(this,o);return i&&s!==void 0&&(t!=null&&t(s,n))?s:(i=!0,s=n,n)}return a}let K=class extends Be{constructor(t,s,i){super(t,s,i),this.name="unknown",this.name=t}},ee=class extends K{constructor(){super("too-complex","The input geometry has too many points.")}},Ie=class extends K{constructor(){super("invalid-geometry","The input geometry is invalid.")}};class Zt extends K{constructor(){super("elevation-query-error","Error querying elevation from provider.")}}let At=class extends K{constructor(){super("unknown","Unknown error.")}};async function Ut(e,t,s,i,a,o,n){let r,l,p;const h=e.spatialReference,d=h.isGeographic||h.isWebMercator;let m=0;if(!d){const{execute:y}=await Ot(()=>import("./lengthOperator2.js").then(w=>w.l),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),import.meta.url);R(n),m=y(e,{unit:"meters"}),R(n)}const v=1/Z(i);if(d){await fe([{source:h,dest:i},{source:h,dest:ke.WGS84}],n);const y=ss(e);r=We([y],"meters")[0];const w=ge(r,a);if(be(e,r,w)>o)throw new ee;const f=_e(y,t,s);({densifiedPath:l,distances:p}=Qt(f,w,v)),l=oe(l,i)}else{await fe([{source:h,dest:i}],n),r=m;const y=ge(r,a);if(be(e,r,y)>o)throw new ee;const w=_e(e,t,s);({densifiedPath:l,distances:p}=Wt(w,y,v)),R(n),l=oe(l,i)}return{densifiedPath:l,pathLength:r*v,distances:p}}function ge(e,t){const s=e/t.densificationMaxSamples;return Math.max(t.samplingDistance,s)}function _e(e,t,s){if(t==null)return we(e);const i=e.spatialReference,a=t.mode,o=Ke(t,i);let n=null;switch(s.type){case"2d":n=Ht(e,a,o);break;case"3d":n=Ft(e,a,o,s)}return n==null?we(e):new ue({hasZ:!0,hasM:!1,spatialReference:i,paths:Le(e.paths,n)})}function Ht({hasZ:e},t,s){return t==="absolute-height"?e?([i,a,o])=>[i,a,o+s]:([i,a])=>[i,a,s]:null}function Ft({spatialReference:e,hasZ:t},s,i,{elevationProvider:a}){const o=(n,r,l,p)=>(a==null?void 0:a.getElevation(n,r,l,e,p))??0;switch(s){case"on-the-ground":return([n,r])=>[n,r,o(n,r,0,"ground")];case"absolute-height":return t?([n,r,l])=>[n,r,l+i]:([n,r])=>[n,r,i];case"relative-to-ground":return t?([n,r,l])=>[n,r,l+o(n,r,l,"ground")+i]:([n,r])=>[n,r,o(n,r,0,"ground")+i];case"relative-to-scene":return t?([n,r,l])=>[n,r,l+o(n,r,l,"scene")+i]:([n,r])=>[n,r,o(n,r,0,"scene")+i];default:return null}}function we(e){return e.hasZ?new ue({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:Le(e.paths,([t,s])=>[t,s])}):e}function Le(e,t){const s=e.length,i=new Array(s);for(let a=0;a<s;++a){const o=e[a],n=o.length,r=new Array(o.length);i[a]=r;for(let l=0;l<n;++l)r[l]=t(o[l])}return i}function Oe(e){return he(e)&&e.paths.some(t=>t.length>1)}function Nt(e){return jt(e)&&Oe(e.geometry)}function jt(e){return Te(e)&&he(e==null?void 0:e.geometry)}function he(e){return!Te(e)&&e!=null&&e.type==="polyline"}function Te(e){return e!=null&&"geometry"in e}function Bt(e){const t=e==null?void 0:e.layer;return t!=null&&t.type==="graphics"&&t.internal}function ze(e,t,s,i,a){const{spatialReference:o,hasZ:n}=e,r={from:null,to:null,distance:0,azimuth:0,reverseAzimuth:0,spatialReference:o,metersPerSR:Z(o)},l=[],p=[];let h=0;for(let d=0;d<e.paths.length;++d){const m=e.paths[d],v=new Array,y=new Array;let w=0;for(let f=1;f<m.length;++f){const _=m[f-1],C=m[f],D=i(r,_,C);let G;for(G=w;G<D.distance&&!Xe(G,D.distance);G+=t)v.push(a(D,G)),y.push((h+G)*s);w=G-D.distance,h+=D.distance,v.push(C),y.push(h*s)}l[d]=v,p[d]=y}return{densifiedPath:new ue({spatialReference:o,hasZ:n,paths:l}),distances:p}}function Wt(e,t,s){const{hasZ:i}=e;return ze(e,t,s,Xt,i?ts:es)}function Qt(e,t,s){const{hasZ:i}=e;return ze(e,t,s,Kt,i?Yt:Jt)}function Kt(e,t,s){return e.distance=0,Je(e,t,s,e.spatialReference),e.from=t,e.to=s,e}function Xt(e,t,s){return e.from=t,e.to=s,e.distance=Ye(s,t)*e.metersPerSR,e}function Jt({from:e,azimuth:t,spatialReference:s},i){return Re([0,0],e,t,i,s)}function Yt({from:e,to:t,azimuth:s,distance:i,spatialReference:a},o){const n=o/i,r=[0,0,Ce(e[2],t[2],n)];return Re(r,e,s,o,a),r}function es({from:e,to:t,distance:s},i){return et([0,0],e,t,i/s)}function ts({from:e,to:t,distance:s},i){return tt([0,0,0],e,t,i/s)}function ss(e){return Qe(e.spatialReference)?e:oe(e,ke.WGS84)}function qe(e){return e.paths.reduce((t,s)=>t+s.length,0)}function be(e,t,s){return qe(e)+Math.floor(t/s)+Math.max(0,e.paths.reduce(i=>1+i,0)-1)}function is(e,t){const s=e.length;if(s===0)return null;const i=e[0],a=i.sampledZ;let o=a,n=a,r=0,l=0,p=null,h=null,d=a??0,m=0,v=0,y=a!=null?1:0,w=0,f=0;const _=Z(t),C=N(t),D=q().minSlopeSampleDistance/_,G=2*D,A=new Se,x=new Se,se=()=>{Fe(),A.copy(x),x.reset()},me=(P,j)=>{se(),P>0&&P-A.start<=G&&(P=A.start+D),x.restart(P,j)},Fe=()=>{if(A.isHole||x.isHole)return;const P=x.avgElevation-A.avgElevation,j=x.start-A.start,B=P*C,M=j*_,V=te(Math.atan2(B,M),"radians","degrees");V>0?(m+=V,p=I(p,V),w++):V<0&&(v-=V,h=I(h,-V),f++)};i.sampledZ!=null&&me(i.distance,i.sampledZ);for(let P=1;P<s;++P){const j=e[P-1],B=e[P],M=B.sampledZ;if(M==null){x.isHole||se();continue}y++,d+=M,o=de(o,M),n=I(n,M),x.isHole||B.distance-x.start>=D?me(B.distance,M):x.insert(M);const V=j.sampledZ;if(V!=null){const X=M-V;X>0?r+=X:X<0&&(l-=X)}}return se(),y===0?null:{maxDistance:e[s-1].distance,minElevation:o,maxElevation:n,avgElevation:y===0?null:d/y,elevationGain:r,elevationLoss:l,maxPositiveSlope:p,maxNegativeSlope:h,avgPositiveSlope:w===0?null:m/w,avgNegativeSlope:f===0?null:v/f}}function ns(e){const t=e.filter(De),s=t.length;if(s===0)return null;const i=t[0];if(s===1)return i;let a=i.maxDistance,o=i.minElevation,n=i.maxElevation,r=i.maxPositiveSlope,l=i.maxNegativeSlope;for(let p=1;p<t.length;++p){const h=t[p];a=I(a,h.maxDistance),o=de(o,h.minElevation),n=I(n,h.maxElevation),r=I(r,h.maxPositiveSlope),l=I(l,h.maxNegativeSlope)}return{maxDistance:a,minElevation:o,maxElevation:n,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:r,maxNegativeSlope:l,avgPositiveSlope:null,avgNegativeSlope:null}}function as(e){let t=null,s=null,i=null;for(const a of e){if(a==null)continue;const{statistics:o,spatialReference:n}=a;if(o==null)continue;const r=Z(n);t=I(t,ne(o.maxDistance,r));const l=N(n);i=de(i,ne(o.minElevation,l)),s=I(s,ne(o.maxElevation,l))}return{minDistance:0,maxDistance:t??0,minElevation:i??0,maxElevation:s??0}}function de(e,t){return t==null?e:e!=null?Math.min(e,t):t}function I(e,t){return t==null?e:e!=null?Math.max(e,t):t}function ne(e,t){return e!=null&&t!=null?e*t:null}class Se{constructor(){this._start=0,this._totalElevation=0,this._sampleCount=0}get avgElevation(){return this._totalElevation/this._sampleCount}get isHole(){return this._sampleCount===0}get start(){return this._start}copy(t){this._start=t._start,this._sampleCount=t._sampleCount,this._totalElevation=t._totalElevation}reset(){this._start=0,this._sampleCount=0,this._totalElevation=0}restart(t,s){this._start=t,this._sampleCount=1,this._totalElevation=s}insert(t){++this._sampleCount,this._totalElevation+=t}}function os(e,t,s=[]){if(e>=t||(s.push(e),t-e<2))return s;const i=t-1;s.push(i);const a=le(e+1,i);for(;;){const o=a.next();if(o.done)break;s.push(o.value)}return s}function*le(e,t){if(e>=t)return;const s=e+Math.floor((t-e)/2);yield s;const i=le(e,s),a=le(s+1,t);for(;;){const o=i.next(),n=a.next();if(o.done&&n.done)break;o.done||(yield o.value),n.done||(yield n.value)}}async function*rs(e,t){const{view:s,geometry:i,elevationInfo:a,providers:o,options:n}=e,r=s.spatialReference;if(!r||i==null||!Oe(i))throw new Ie;const l=o.length;if(l===0)return null;const p=Math.round(n.maxTotalSamples/l);if(qe(i)>p)throw new ee;const h=await Ut(i,a,s,r,n,p,t);R(t);let d=0;const m=new Array(l),v=new Array(l);for(let f=0;f<l;f++){const _=ds(h);m[f]=_,d+=_.samples.length;const C={...e,provider:o[f],result:_,densificationResult:h};v[f]=ls(C,t)[Symbol.iterator]()}if(d>n.maxTotalSamples)throw new ee;const y=await Promise.all(v.map(f=>{const _=f.next();return _.done===!0?Promise.resolve(null):_.value}));R(t);for(let f=0;f<l;f++)m[f]=y[f];yield m,await at(e.delayAfterPreview??q().delayAfterPreviewMillis,null,t.signal),R(t);const w=[];try{let f;do{f=!1;for(let _=0;_<l;_++){const C=v[_].next();C.done===!1&&(w.push({resultPromise:C.value,index:_}),f=!0)}}while(f)}finally{v.forEach(f=>{var _;return(_=f.return)==null?void 0:_.call(f)})}for(const{resultPromise:f,index:_}of w)m[_]=await f,R(t),yield m;for(const f of m)f!=null&&(f.progress=1);yield m}function*ls(e,t){const{densificationResult:s}=e,i={...e,abortOptions:t,densificationResult:s},a=os(0,i.result.samples.length),o=a.slice(0,i.provider.numSamplesForPreview);yield Pe(i,o,!0);const n=lt(a,i.provider.numSamplesPerChunk);for(const r of n)yield Pe(i,r,!1)}async function Pe({densificationResult:e,result:t,provider:s,queue:i,abortOptions:a,cache:o},n,r){const{densifiedPath:l,pathLength:p}=e,h=t.spatialReference,{samples:d}=t,m=[];for(let v=0;v<n.length;v++){const y=d[n[v]];m[v]=[...y.coordinate]}try{return await i.push({geometry:new ut({spatialReference:h,points:m,hasZ:l.hasZ}),provider:s,indices:n,preview:r,result:t,parameters:{...q().defaultQueryOptions(),minDemResolution:Math.round(r?p/s.numSamplesForPreview:p/d.length),cache:o}},a),{...t}}catch(v){return ct(v)?null:zt}}function us(e){return new st({priority:it.ELEVATION_PROFILE,concurrency:1,scheduler:e,process:async t=>{R(t.parameters);try{await cs(t)}catch(s){nt(s)}}})}async function cs({geometry:e,provider:t,indices:s,preview:i,result:a,parameters:o}){if(s.length===0)return;const n=(await vs(t,e,o)).geometry,{hasZ:r,points:l}=n,p=o.noDataValue,{samples:h}=a;for(let d=0;d<s.length;d++){const m=h[s[d]];if(m.isHole)continue;const v=r?l[d][2]:null;v===null||v===p?m.sampledZ=null:(a.hasZ=!0,m.sampledZ=v),m.sampled=!0}ps(h),a.progress=i?0:a.progress+s.length/h.length,a.statistics=is(a.samples,a.spatialReference)}function ps(e){const t=e.length-1;let s=0;for(let i=1;i<=t;i++)(e[i].sampled||i===t)&&(hs(e,s,i),s=i)}function hs(e,t,s){if(s-t===1)return;const i=e[t],a=i.sampledZ,o=e[s],n=o.sampledZ;if(a==null||n==null){for(let p=t+1;p<s;p++)e[p].sampledZ=null;return}const r=i.distance,l=o.distance-r;for(let p=t+1;p<s;p++){const h=e[p],d=(h.distance-r)/l;h.sampledZ=Ce(a,n,d)}}function ds({densifiedPath:e,distances:t}){const s=e.spatialReference,i=ot(s),a=e.paths,o=a.length,n=[];let r=null,l=0;for(let p=0;p<o;p++){const h=a[p],d=h.length,m=t[p];for(let v=0;v<d;v++){const y=h[v],w=m[v];i&&(y[0]=rt(y[0],i.valid[0],i.valid[1])),r&&v===0&&ms(n,r,y,l,w),n.push(fs(y,w)),r=y,l=w}}return{progress:0,samples:n,hasZ:!1,statistics:null,spatialReference:s}}function ms(e,t,s,i,a){e.push($e(t,i)),e.push($e(s,a))}function fs(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!1,isHole:!1}}function $e(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!0,isHole:!0}}async function vs(e,t,s){try{return await e.queryElevation(t,s)}catch{throw new Zt}}function ys(e,t,s){if(!e||e.length===0)return;const i=e.length-1,a=e[0];if(t<=s(a))return a;const o=e[i];if(t>=s(o))return o;let n=0,r=0,l=i;for(;n<l;){r=n+Math.floor((l-n)/2);const p=e[r],h=s(p);if(h===t)return p;if(t<h){if(r>0){const d=e[r-1],m=s(d);if(t>m)return t-m>=h-t?p:d}l=r}else{if(r<i){const d=e[r+1],m=s(d);if(t<m)return t-h>=m-t?d:p}n=r+1}}return e[r]}function Ze(e){return e>.999999?1:e}let g=class extends Q{constructor(e){super(e),this.error=null,this._getStableEffectiveUnits=E(()=>{const t=as(this._activeComputations.map(a=>a.result.rawResult)),s=this.analysis.displayUnits,i=gt(this.view);return{distance:wt(t.maxDistance,"meters",s.distance??i),elevation:_t(t.maxElevation,"meters",s.elevation??i)}},O),this._updateTask=null,this._queue=null,this._currentTileCache=null,this._parametersPerComputation=new Map,this._getStableUpdateParameters=E(()=>({stationary:this.view.stationary??!0,activeComputations:this._activeComputations,generationParameters:this._generationParameters}),O),this._getStableGenerationParameters=E(()=>{const{view:t,analysis:s}=this;return t!=null&&t.ready&&this._queue?{view:t,geometry:s.geometry,geometryIsValid:s.valid,elevationInfo:this.elevationInfo,queue:this._queue,cache:this._tileCache,options:this._options,slicePlane:t.type==="3d"?t.slice.plane:null}:null},O),this._getStableElevationInfo=E(()=>this.analysis.elevationInfo??gs,re),this._getStableOptions=E(()=>{const{densificationMaxSamples:t,defaultDemResolution:s,maxTotalSamples:i}=q();let a=this._minDemResolution??s;return a=parseFloat(a.toFixed(2)),{samplingDistance:a,densificationMaxSamples:Math.round(t/this._activeComputations.length),maxTotalSamples:i}},O),this._updateThrottled=pt(t=>this._update(t),q().updateThrottleMillis)}initialize(){this._computationsCollection=ht(()=>this.analysis.profiles,t=>this.computationFactory.create({controller:this,profile:t,onInvalidate:s=>this._invalidateComputation(s)}),{recycleItems:!0}),this.addHandles([this._computationsCollection.on("change",()=>{this._parametersPerComputation.clear(),this._updateThrottled(this._updateParameters)}),S(()=>this._updateParameters,t=>this._updateThrottled(t),T),this._updateThrottled]);const e=this.view.type==="3d"?this.view.resourceController:void 0;this._queue=us(e==null?void 0:e.scheduler),e==null||e.addUpdatingObject(this)}destroy(){var e;this._abortUpdate(),this._parametersPerComputation.clear(),(e=this._computationsCollection)==null||e.destroy(),this._queue=Y(this._queue),this._currentTileCache=Y(this._currentTileCache)}get effectiveDisplayUnits(){return this._getStableEffectiveUnits()}get progress(){let e=0,t=0;for(const s of this._activeComputations)e++,t+=s.progress;return Ze(e>0?t/e:0)}get updating(){var a;const{progress:e}=this,t=!!((a=this._queue)!=null&&a.updating),s=this._updateThrottled.hasPendingUpdates(),i=this._updateTask!=null&&!this._updateTask.finished;return t||s||i||e>0&&e<1}get results(){return this._computations.map(e=>e.result)}get statistics(){return ns(this._activeComputations.map(e=>e.result.statistics))}get hoveredPoints(){return this._computations.map(e=>e.hoveredPoint)}onElevationChange(e){const{view:t}=this;return(t==null?void 0:t.type)==="3d"?dt(()=>t.elevationProvider,"elevation-change",e,{onListenerAdd:e,onListenerRemove:e}):W()}get _tileCache(){var t;this._currentTileCache=Y(this._currentTileCache);const e=this.view;if((e==null?void 0:e.type)==="3d"){const s=(t=e.basemapTerrain)==null?void 0:t.elevationQueryCache;if(s!=null)return s}return this._currentTileCache==null&&(this._currentTileCache=new mt(new ft(20971520))),this._currentTileCache}get _computations(){var e;return((e=this._computationsCollection)==null?void 0:e.toArray())??[]}get _activeComputations(){return this._computations.filter(e=>e.profile.enabled&&e.available)}get _minDemResolution(){const e=this._minDemResolutions;return e.length>0?Ge(e):null}get _minDemResolutions(){const e=[];for(const{minDemResolution:t}of this._activeComputations)t!=null&&e.push(t);return e}get _updateParameters(){return this._getStableUpdateParameters()}get _generationParameters(){return this._getStableGenerationParameters()}get elevationInfo(){return this._getStableElevationInfo()}get _options(){return this._getStableOptions()}_update({stationary:e,activeComputations:t,generationParameters:s}){this._abortUpdate(),e&&(s!=null?this._updateTask=Me(async i=>{this.error=null;const a=t.filter(o=>!this._isComputationValid(o,s));try{if(!s.geometryIsValid)throw new Ie;const o=rs({...s,providers:a},{signal:i});let n=!1;for await(const r of o){R(i),n||(this._clearInvalidResults(s),n=!0);for(let l=0;l<a.length;l++)a[l].setResult(r[l])}for(const r of a)this._parametersPerComputation.set(r,s)}catch(o){vt(o),this._abortUpdate(),this.error=o instanceof K?o:new At,a.forEach(n=>{n.clearResult()})}}):this._clearResults())}_abortUpdate(){this._updateTask=yt(this._updateTask)}_isComputationValid(e,t){return this._parametersPerComputation.has(e)&&this._parametersPerComputation.get(e)===t}_invalidateComputation(e){this._parametersPerComputation.delete(e),this._updateThrottled(this._updateParameters)}_clearInvalidResults(e){for(const t of this._computations)this._isComputationValid(t,e)||(t.clearResult(),this._parametersPerComputation.delete(t))}_clearResults(){for(const e of this._computations)e.clearResult(),this._parametersPerComputation.delete(e)}};u([c({constructOnly:!0})],g.prototype,"analysis",void 0),u([c({constructOnly:!0})],g.prototype,"analysisViewData",void 0),u([c({constructOnly:!0})],g.prototype,"computationFactory",void 0),u([c({constructOnly:!0})],g.prototype,"view",void 0),u([c()],g.prototype,"error",void 0),u([c({readOnly:!0})],g.prototype,"effectiveDisplayUnits",null),u([c()],g.prototype,"progress",null),u([c()],g.prototype,"updating",null),u([c()],g.prototype,"results",null),u([c()],g.prototype,"statistics",null),u([c()],g.prototype,"hoveredPoints",null),u([c()],g.prototype,"_updateTask",void 0),u([c()],g.prototype,"_queue",void 0),u([c()],g.prototype,"_tileCache",null),u([c()],g.prototype,"_computationsCollection",void 0),u([c()],g.prototype,"_computations",null),u([c()],g.prototype,"_activeComputations",null),u([c({readOnly:!0})],g.prototype,"_minDemResolution",null),u([c()],g.prototype,"_minDemResolutions",null),u([c()],g.prototype,"_updateParameters",null),u([c()],g.prototype,"_generationParameters",null),u([c()],g.prototype,"elevationInfo",null),u([c()],g.prototype,"_options",null),g=u([L("esri.views.analysis.ElevationProfile.ElevationProfileController")],g);const gs=new ce({...bt});function _s(e,t){if(e==null||t==null)return null;const{samples:s,spatialReference:i}=e,{distance:a,elevation:o}=t,n=Z(i),r=N(i),l=s.length,p=new Array(l);for(let h=0;h<l;++h){const d=s[h],m=d.sampledZ,v=d.coordinate;p[h]={x:v[0],y:v[1],z:m,distance:Ae(d.distance,n,a),elevation:F(m,r,o)}}return p}function ws(e,t){if(e==null||t==null||e.statistics==null||e.spatialReference==null)return null;const{distance:s,elevation:i}=t,{statistics:a,spatialReference:o}=e,n=Z(o),r=N(o);return{maxDistance:Ae(a.maxDistance,n,s),minElevation:F(a.minElevation,r,i),maxElevation:F(a.maxElevation,r,i),avgElevation:F(a.avgElevation,r,i),elevationGain:F(a.elevationGain,r,i),elevationLoss:F(a.elevationLoss,r,i),maxPositiveSlope:a.maxPositiveSlope,maxNegativeSlope:a.maxNegativeSlope,avgPositiveSlope:a.avgPositiveSlope,avgNegativeSlope:a.avgNegativeSlope}}function Ae(e,t,s){return e==null?null:te(e*t,"meters",s)}function F(e,t,s){return e==null?null:te(e*t,"meters",s)}let $=class extends St{constructor(t){super(t),this._getSamplesMemoized=ve((s,i)=>_s(s,i)),this._getStatisticsMemoized=ve((s,i)=>ws(s,i)),this.rawResult=null}get available(){const{computation:t}=this;return t.profile.enabled&&t.available}get profile(){return this.computation.profile}get progress(){return Ze(this.rawResult!=null&&this.computation.profile.enabled?this.rawResult.progress:0)}get samples(){return this._getSamplesMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get statistics(){return this._getStatisticsMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get hoveredPoint(){if(!this.computation.profile.enabled)return null;const t=this.computation.controller.analysisViewData.hoveredPosition;if(t==null)return null;const{rawResult:s,samples:i}=this;if(i==null||s==null)return null;const a=i.length;if(a===0)return null;const o=i[a-1].distance,n=ys(i,t*o,h=>h.distance);if(n==null)return null;const{x:r,y:l,z:p}=n;return p==null?null:new Pt({x:r,y:l,z:p,spatialReference:s.spatialReference})}};u([c()],$.prototype,"available",null),u([c({readOnly:!0})],$.prototype,"profile",null),u([c({readOnly:!0})],$.prototype,"progress",null),u([c()],$.prototype,"samples",null),u([c()],$.prototype,"statistics",null),u([c({constructOnly:!0})],$.prototype,"computation",void 0),u([c()],$.prototype,"rawResult",void 0),u([c()],$.prototype,"hoveredPoint",null),$=u([L("esri.views.analysis.ElevationProfile.ElevationProfileResult")],$);let b=class extends Q{constructor(e){super(e),this.result=new $({computation:this}),this.numSamplesForPreview=30,this.numSamplesPerChunk=200}initialize(){this.addHandles([S(()=>{const{geometry:e,elevationInfo:t}=this.controller.analysis;return[e,t]},()=>this.onInvalidate(this),pe)])}setResult(e){this.result.rawResult=e}clearResult(){this.setResult(null)}get progress(){return this.result.progress}get hoveredPoint(){return this.result.hoveredPoint}get available(){return!0}get minDemResolution(){return q().defaultDemResolution}};u([c({constructOnly:!0})],b.prototype,"controller",void 0),u([c({constructOnly:!0})],b.prototype,"profile",void 0),u([c({constructOnly:!0})],b.prototype,"onInvalidate",void 0),u([c()],b.prototype,"result",void 0),u([c({readOnly:!0})],b.prototype,"progress",null),u([c()],b.prototype,"hoveredPoint",null),u([c()],b.prototype,"available",null),u([c()],b.prototype,"numSamplesForPreview",void 0),u([c()],b.prototype,"numSamplesPerChunk",void 0),u([c({readOnly:!0})],b.prototype,"minDemResolution",null),b=u([L("esri.views.analysis.ElevationProfile.ElevationProfileLineComputation")],b);function Ue(e){var i;if(e==null)return null;if($t(e))return He(e);const t=e.tileInfo;if(t==null)return null;const s=(i=t.lods)==null?void 0:i.at(-1);return s==null?null:s.resolution*Z(t.spatialReference)}function He(e){if(e==null)return null;const t=e.layers.items.map(bs).filter(De);return Ge(t)??null}function bs(e){return e&&"tileInfo"in e?Ue(e):null}let H=class extends b{constructor(){super(...arguments),this.type="ground",this.numSamplesForPreview=50,this.numSamplesPerChunk=1e3,this._getStableQueryElevationDependencies=E(()=>({ground:this._ground,groundLayers:this._getStableGroundLayers()}),O),this._getStableGroundLayers=E(()=>{var t,s;return(s=(t=this._ground)==null?void 0:t.layers)==null?void 0:s.toArray()},O)}get minDemResolution(){return He(this._ground)}get available(){var t;return((t=this._ground)==null?void 0:t.layers.some(s=>s.visible))===!0}initialize(){this.addHandles([S(()=>this._queryElevationDependencies,()=>this.onInvalidate(this))])}async queryElevation(t,s){const i=this._queryElevationDependencies;if(i==null)throw new Error(`${this.declaredClass}: no dependencies`);const{ground:a}=i;if(a==null)throw new Error("No ground configured in the view");const o=await a.queryElevation(t,s),n=N(t.spatialReference),r=N(a.layers.at(0).spatialReference);if(n!==r){const l=o.geometry;l.points=l.points.map(([p,h,d])=>[p,h,d===s.noDataValue?d:d*r/n])}return o}get _queryElevationDependencies(){return this._getStableQueryElevationDependencies()}get _ground(){var t,s;return(s=(t=this.controller.view)==null?void 0:t.map)==null?void 0:s.ground}};u([c()],H.prototype,"minDemResolution",null),u([c()],H.prototype,"available",null),u([c()],H.prototype,"_queryElevationDependencies",null),u([c()],H.prototype,"_ground",null),H=u([L("esri.views.analysis.ElevationProfile.ElevationProfileLineGroundComputation")],H);function Ss(e){var t,s;return((s=(t=e==null?void 0:e.map)==null?void 0:t.allLayers)==null?void 0:s.toArray().filter(i=>(i.type!=="graphics"||!i.internal)&&i.visible).map(i=>i.uid))??[]}let ae=class extends b{constructor(){super(...arguments),this.type="input",this.numSamplesForPreview=50,this.numSamplesPerChunk=500,this._getStableElevationDependencies=E(()=>{const{view:t}=this.controller;if(!t)return null;const s=this._getStableElevationInfo();return{view:t,stationary:!this._requiresElevationAlignment||t.stationary,elevationInfo:s,visibleLayerIds:this._getStableLayerIds(),spatialReference:this._getStableSpatialReference()}},O),this._getStableElevationInfo=E(()=>this.controller.elevationInfo,re),this._getStableSpatialReference=E(()=>{var t;return(t=this.controller.view)==null?void 0:t.spatialReference},re),this._getStableLayerIds=E(()=>{const{view:t}=this.controller;return t.type!=="3d"?[]:Ss(t)},O)}initialize(){const t=()=>this.onInvalidate(this);this.addHandles([S(()=>this._queryElevationDependencies,t,pe),this.controller.onElevationChange(t)])}async queryElevation(t,{noDataValue:s,signal:i}){const a=this._queryElevationDependencies;if(a==null)throw new Error(`${this.declaredClass}: no dependencies`);const{view:o,spatialReference:n}=a;if(this._requiresElevationAlignment&&o.type==="3d"&&n){const r=await Et.fromGeometry(t).project(n,i);if(!r)return{geometry:t,noDataValue:s};const l=o.elevationProvider;return r.coordinates.forEach(p=>{p.z=l.getElevation(p.x,p.y,0,n,"ground")??0}),{geometry:r.export(),noDataValue:s}}return{geometry:t,noDataValue:s}}get _requiresElevationAlignment(){var t;return((t=this.controller.elevationInfo)==null?void 0:t.mode)==="on-the-ground"&&this.controller.view.type==="3d"}get _queryElevationDependencies(){return this._getStableElevationDependencies()}};u([c()],ae.prototype,"_queryElevationDependencies",null),ae=u([L("esri.views.analysis.ElevationProfile.ElevationProfileLineInputComputation")],ae);let J=class extends b{constructor(){super(...arguments),this.type="query",this.numSamplesForPreview=50,this.numSamplesPerChunk=500}get minDemResolution(){return Ue(this.profile.source)}get available(){const{source:e}=this.profile;return!!e&&(e.visible==null||e.visible)&&(e.layers==null||e.layers.some(t=>t.visible))}initialize(){this.addHandles(S(()=>this.profile.source,()=>this.onInvalidate(this),pe))}queryElevation(e,t){if(!this.profile.source)throw new Error("No source configured for the elevation profile line");return this.profile.source.queryElevation(e,t)}};u([c({readOnly:!0})],J.prototype,"minDemResolution",null),u([c()],J.prototype,"available",null),J=u([L("esri.views.analysis.ElevationProfile.ElevationProfileLineQueryComputation")],J);let k=class extends Q{constructor(e){super(e),this._sketchViewModels=new xe,this._updatingHandles=new xt,this._operationManager=new Lt}initialize(){const{view:e}=this;this._graphicsLayer=new kt({listMode:"hide",internal:!0}),this.addHandles([S(()=>({map:e.map,internalGraphicsLayer:this._graphicsLayer,state:this.state,geometryVisualizationVisible:this._analysis.viewOptions.geometryVisualizationVisible,visible:this.analysisViewData.visible}),({map:t,internalGraphicsLayer:s,state:i,geometryVisualizationVisible:a,visible:o})=>{$s(t,s);const n=this.sketchGraphic;switch(n&&(n.visible=o),i){case"idle":case"reshaping-disabled":n&&!a&&(n.visible=!1),this._operationManager.stop(),this._ensureUpdatedSketchGraphic();break;case"reshaping":ie(this._startReshape());break;case"awaiting-sketch":this.analysisViewData.interactive=!0}},T),S(()=>this._analysis.elevationInfo,t=>{this._graphicsLayer.elevationInfo=t},T)])}destroy(){var t;this._operationManager.destroy(),this._sketchViewModels.drain(s=>Y(s));const e=this._graphicsLayer;(t=this.view.map)==null||t.remove(e),e.destroy()}get sketchGraphic(){return this._get("sketchGraphic")}set sketchGraphic(e){e!==this._get("sketchGraphic")&&(this._set("sketchGraphic",e),this._updateAnalysisFromSketchGraphic())}get state(){const{visible:e,interactive:t}=this.analysisViewData;if(!e)return"idle";switch(this._operationManager.currentOperationType){case"place":return this._sketching?"sketching":"awaiting-sketch";case"pick-feature":return"picking";default:return this._analysis.geometry?t?"reshaping":"reshaping-disabled":"idle"}}get updating(){return this._sketchViewModels.some(e=>e.updating)||this._updatingHandles.updating}get _sketching(){return this._sketchViewModels.some(e=>e.createGraphic===this.sketchGraphic)}get _analysis(){return this.analysisViewData.analysis}get _lineSymbol(){return Ps(this.view.type)}place(e){return this._operationManager.start("place",async t=>{const s=this._createSketchViewModel(),i=this._analysis.clone();this._ensureUpdatedSketchGraphic();const a=this.sketchGraphic,o=this._analysis.elevationInfo,n=W(()=>{this.sketchGraphic===a&&(this._graphicsLayer.elevationInfo=o)}),r=s.on("create",l=>{switch(l.state){case"start":this._graphicsLayer.removeAll(),this.sketchGraphic=l.graphic,this._analysis.elevationInfo=this._graphicsLayer.elevationInfo;break;case"active":this._updateAnalysisFromSketchGraphic();break;case"complete":this.sketchGraphic&&(this._updateAnalysisFromSketchGraphic(),this._addSketchGraphic(this.sketchGraphic)),t.stop();break;case"cancel":t.stop()}});t.handles.push(r,W(()=>(r.remove(),s.destroy(),this._sketchViewModels.remove(s),this._updateAnalysisFromSketchGraphic(),this._analysis.valid?Rt(e)||i.equals(this._analysis)?t.reject():void t.resolve({}):(this._clear(),t.reject()))),n),this._graphicsLayer.elevationInfo=Es,await this._updatingHandles.addPromise(ie(s.create("polyline")))},e)}async pickFeature(e){return this._operationManager.start("pick-feature",async t=>{const{view:s}=this;s.closePopup();let i=null;const a=n=>{n.defer(async()=>{i==null||i.abort(),i=Me(async r=>{const{results:l}=await s.hitTest(n);R(r);let p=null;for(const h of l)if(h.type==="graphic"&&Nt(h.graphic)&&!Bt(h.graphic)){p=h.graphic;break}p?(n.preventDefault(),n.stopPropagation(),this.sketchGraphic=null,this._analysis.geometry=p.geometry,this._analysis.elevationInfo=new ce({...Dt(p)}),t.resolve({feature:p}),t.stop()):t.reject()}),await i.promise})},o=n=>{Gt(n)&&(t.reject(),t.stop())};t.handles.push(s.on("immediate-click",a,ye.TOOL),s.on("key-down",o,ye.TOOL),s.acquireCursor("crosshair","high"),W(()=>{i==null||i.abort(),t.reject()})),s.focus()},e)}_startReshape(){const e=this._createSketchViewModel();return this._sketchViewModels.add(e),this._operationManager.start("reshape",async t=>{const s=()=>{const a=this._ensureUpdatedSketchGraphic();return a?this._updatingHandles.addPromise(e.update(a,{tool:"reshape"})):Promise.resolve()};if(!this._ensureUpdatedSketchGraphic())return;const i=e.on("update",a=>{this._updateAnalysisFromSketchGraphic(),a.state==="complete"&&(this.state==="reshaping"?ie(s()):t.resolve())});t.handles.push(i,W(()=>{i.remove(),this._sketchViewModels.remove(e),e.destroy(),t.resolve()})),await s()})}_createSketchViewModel(){return new Tt({layer:this._graphicsLayer,view:this.view,defaultCreateOptions:{mode:"click",hasZ:!0},updateOnGraphicClick:!1,defaultUpdateOptions:{enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,enableZ:!1,highlightOptions:{enabled:!1},multipleSelectionEnabled:!1,reshapeOptions:{shapeOperation:"none"},toggleToolOnClick:!1,tool:"reshape"},polylineSymbol:this._lineSymbol,activeLineSymbol:this._lineSymbol})}_ensureUpdatedSketchGraphic(){const{geometry:e}=this._analysis;if(!e)return this.sketchGraphic=null,this._graphicsLayer.removeAll(),null;const t=this.sketchGraphic??(this.sketchGraphic=new Ct({symbol:this._lineSymbol,geometry:e}));return t.geometry=e,this._addSketchGraphic(t),t}_addSketchGraphic(e){const{graphics:t}=this._graphicsLayer;t.includes(e)||t.add(e),t.length!==1&&t.removeMany(t.filter(s=>s!==e))}_clear(){this.sketchGraphic=null,this._analysis.clear()}_updateAnalysisFromSketchGraphic(){var s;let e=(s=this.sketchGraphic)==null?void 0:s.geometry;he(e)||(e=null);const t=this._analysis;t.geometry!==e&&(t.geometry=e)}};function Ps(e){if(e==="2d"){const t={type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5};return new Mt({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{...t,effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,4],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],color:[0,0,0,255]},{...t,color:[255,255,255,255]}]}}})}return new Vt({color:[0,0,0,0]})}function $s(e,t){t&&(t.removeFromParent(),e==null||e.add(t))}u([c({constructOnly:!0})],k.prototype,"analysisViewData",void 0),u([c({constructOnly:!0})],k.prototype,"view",void 0),u([c()],k.prototype,"sketchGraphic",null),u([c({nonNullable:!0})],k.prototype,"state",null),u([c()],k.prototype,"updating",null),u([c()],k.prototype,"_sketching",null),u([c()],k.prototype,"_analysis",null),u([c()],k.prototype,"_lineSymbol",null),k=u([L("esri.views.analysis.ElevationProfile.ElevationProfileTool")],k);const Es=new ce({mode:"on-the-ground",offset:0});export{k as L,U as a,H as b,q as i,g as k,Ms as l,J as n,Gs as o,b as p,Ss as r,E as t,ae as u};
