import{E as r,F as n,eh as g,ei as d,V as f,ej as y,ek as v,el as S,b as u,ef as w,em as x}from"./ShadowCastClear.glsl.js";const R=m=>{const p=m;let l=class extends p{constructor(){super(...arguments),this.hasMixedImageFormats=!0}get imageFormatIsOpaque(){return!1}get fullExtent(){return this.layer.fullExtent}get isOpaque(){return this.fullOpacity>=1&&this.imageFormatIsOpaque}tilesVisibleAtCurrentScale(){const{minScale:e,maxScale:i}=this.layer;if(!y(e,i))return!0;const{basemapTerrain:t}=this.view,a=t.getLayerIndexByUID(1,this.uid);if(a==null)return!1;const{tilingScheme:s}=t,c=e&&s.levelAtScale(e),h=i&&s.levelAtScale(i);return t.renderer.visibleTiles.some(o=>!!o.layerInfo[1][a]&&(!c||o.level>=c)&&(!h||o.level<=h))}get visibleAtCurrentScale(){return this.tilesVisibleAtCurrentScale()}get dataScaleRange(){const e=this.tileInfo.lods;let i=e[0].scale,t=e[e.length-1].scale;if("tilemapCache"in this.layer&&this.layer.tilemapCache){const{effectiveMinLOD:a,effectiveMaxLOD:s}=this.layer.tilemapCache;i=this.tileInfo.lodAt(a).scale,t=this.tileInfo.lodAt(s).scale}return{minScale:i,maxScale:t}}canResume(){var i,t,a;const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&((i=this.layer)==null?void 0:i.loaded)&&!((t=this.parent)!=null&&t.suspended)&&((a=this.view)==null?void 0:a.ready)&&v(e)&&this.visibleAtCurrentTimeExtent||!1}get dataLevelRange(){const{minScale:e,maxScale:i}=this.dataScaleRange;return this.levelRangeFromScaleRange(e,i)}get displayLevelRange(){const e=this.layer.minScale||this.dataScaleRange.minScale,i=this.layer.maxScale||this.dataScaleRange.maxScale,t=this.levelRangeFromScaleRange(e,i);return this.layer.maxScale&&t.maxLevel++,t}get performanceInfo(){return new S(this.view.basemapTerrain.getUsedMemoryForLayerView(this))}getTileUrl(e){return this.layer.getTileUrl(e[0],e[1],e[2])}_addTilingSchemeMatchPromise(){if(this.fullExtent==null)return this.addResolvingPromise(Promise.reject(new u("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));const e=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(e)return this.addResolvingPromise(Promise.reject(e));this.addResolvingPromise(w(()=>{var i,t;return(t=(i=this.view)==null?void 0:i.basemapTerrain)==null?void 0:t.tilingSchemeLocked}).then(()=>{var s;const i=this.view.basemapTerrain.tilingScheme,t="tilemapCache"in this.layer?(s=this.layer.tilemapCache)==null?void 0:s.effectiveMaxLOD:void 0,a=this._getTileInfoCompatibilityError(this.tileInfo,i,t);if(a)throw a}))}_getTileInfoSupportError(e,i){var s;const t=x(e,i,this.view.spatialReference,this.view.state.viewingMode,"tilemapCache"in this.layer?(s=this.layer.tilemapCache)==null?void 0:s.effectiveMaxLOD:void 0);if(!t)return;const a={layer:this.layer,error:t};switch(t.name){case"tilingscheme:spatial-reference-mismatch":case"tilingscheme:global-unsupported-spatial-reference":case"tilingscheme:local-unsupported-spatial-reference":return new u("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",a);default:return new u("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",a)}}_getTileInfoCompatibilityError(e,i,t){return e!=null&&i.compatibleWith(e,t)?null:new u("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")}levelRangeFromScaleRange(e,i){const t={minLevel:0,maxLevel:1/0},a=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!a)return t;const s=a.levels[0],c=h=>{const o=Math.log(s.scale/h)/Math.LN2;return .5-Math.abs(.5-o%1)<1e-9?Math.round(o):Math.ceil(o)};return e!=null&&e>0&&(t.minLevel=Math.max(0,c(e))),i!=null&&i>0&&(t.maxLevel=Math.max(0,c(i))),t}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};return r([n({readOnly:!0})],l.prototype,"imageFormatIsOpaque",null),r([n({readOnly:!0})],l.prototype,"updating",void 0),r([n(g)],l.prototype,"updatingProgress",void 0),r([n(d)],l.prototype,"updatingProgressValue",void 0),r([n()],l.prototype,"hasMixedImageFormats",void 0),r([n()],l.prototype,"fullExtent",null),r([n({readOnly:!0})],l.prototype,"isOpaque",null),r([n({readOnly:!0})],l.prototype,"visibleAtCurrentScale",null),r([n()],l.prototype,"dataScaleRange",null),r([n({readOnly:!0})],l.prototype,"dataLevelRange",null),r([n({readOnly:!0})],l.prototype,"displayLevelRange",null),r([n()],l.prototype,"layer",void 0),l=r([f("esri.views.3d.layers.TiledLayerView3D")],l),l};export{R as p};
