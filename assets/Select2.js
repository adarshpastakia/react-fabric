import{t as cr,bR as dr,_ as ve,r as c,s as tr,j as d,m as J,l as re,bS as pr,bT as $e,aA as ar,bl as Fe,bx as Se,bQ as Ae,bk as Q,aO as ke,aQ as he,G as vr}from"./iframe-DvMcemLF.js";import{n as fr}from"./nodeCheck.js";import{_ as ue,C as He}from"./index2.js";import{T as gr,I as Re}from"./Tooltip.js";import{g as mr,b as hr,B as De}from"./Button.js";import{D as yr}from"./DropdownTool.js";import{a as br,u as Or,o as jr,F as Pr,_ as xr,D as Dr,Y as wr,b as Cr,B as qe,T as Be,C as Sr}from"./BasePanel.js";import{u as Me}from"./useDebounce.js";import{C as kr}from"./Content.js";import{S as Er}from"./Section.js";import{P as W,D as _}from"./Google.js";import{e as Ee}from"./endOfDay.js";import{e as Tr,a as Ve,d as Nr,i as Ir}from"./zh-CN.js";import{u as Fr}from"./Global.js";import{i as Ye}from"./getDay.js";import{c as Rr}from"./cloneElement.js";import{F as Mr,I as or}from"./InputWrapper.js";import{u as $r}from"./eventHandlers.js";import{a as Ar,s as Hr,f as qr,o as Br,b as Vr,c as Yr,d as Kr,e as Qr,g as zr,F as Ur,h as Gr}from"./floating-ui.react.js";import{E as Lr}from"./EmptyContent.js";import{m as Wr,c as Jr}from"./isEqual.js";import{d as Ke,g as Xr}from"./dedupe.js";function Qe(t,e,n){const r=cr(t,n==null?void 0:n.in);return isNaN(+r)?dr(t,NaN):(r.setFullYear(e),r)}var Zr=["ref","as","id","className","label","icon","iconBg","iconColor","rtlFlip","badge","disabled","onClose","active","onClick","tabFlex","color","actions","tooltip","activeClassName"];function ze(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function je(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ze(Object(n),!0).forEach(function(r){ue(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ze(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var _r=function(e){var n=e.ref,r=e.as,l=e.id,f=e.className,j=e.label,g=e.icon,C=e.iconBg,P=e.iconColor,A=e.rtlFlip,S=e.badge,m=e.disabled,H=e.onClose,b=e.active,h=e.onClick,y=e.tabFlex,k=e.color,p=e.actions,i=e.tooltip,O=e.activeClassName,x=ve(e,Zr),F=c.useMemo(function(){return mr(S)},[S]),E=c.useMemo(function(){return!j},[j]),D=c.useMemo(function(){return tr(i)?{content:i}:i??{}},[i]),N=r??"button",w=i?gr:c.Fragment;return d.jsx(w,je(je({},D),{},{children:d.jsxs(N,je(je({"data-id":l,disabled:m,"data-color":k,"data-inner-clickable":!0,className:J("fabric-tabButton",f,b&&"active pointer-events-none",b&&O,m&&"text-tint-500 pointer-events-none",y?"flex-1":"flex-initial max-w-36",E?"min-w-6 rounded":"min-w-18 rounded-capped","flex items-center justify-center px-1 overflow-hidden cursor-pointer"),onClick:function(){return!b&&(h==null?void 0:h(l))},ref:n},x),{},{children:[g&&d.jsx(Re,{icon:g,bg:C,color:P,rtlFlip:A,className:"flex-content p-2"}),!E&&d.jsx("label",{className:"flex-initial truncate text-center px-1 py-1",children:j}),S&&d.jsx(hr,je(je({},F),{},{placement:E?"end":"",className:J("me-1",F.className)})),p&&b&&d.jsx(yr,{className:"bg-tint-50/20 me-1 z-5",children:p}),H&&d.jsx("span",{role:"none",className:J("cursor-pointer me-1 opacity-65 hover:opacity-90 pointer-events-auto"),onClick:function(ne){H==null||H(),ne.stopPropagation()},children:"Ã—"})]}))}))},qn=function(e){var n=e.children,r=e.headerClassName,l=e.orientation,f=l===void 0?"top":l,j=e.activeTab,g=e.activeClassName,C=e.justify,P=e.variant,A=e.tabFlex,S=e.append,m=e.prepend,H=e.gap,b=e.onBeforeChange,h=e.onChange,y=c.useState(),k=re(y,2),p=k[0],i=k[1],O=c.useMemo(function(){return c.Children.toArray(n).reduce(function(w,M){return fr(M,_r)?w[0].push(M):w[1].push(M),w},[[],[]])},[n]),x=re(O,2),F=x[0],E=x[1];c.useEffect(function(){i(j)},[j]);var D=c.useMemo(function(){var w;return(w=F.find(function(M){return M.props.id===p}))===null||w===void 0?void 0:w.props.children},[F,p]),N=c.useCallback(function(w){Promise.resolve(b==null?void 0:b(w,p)).then(function(M){M!==!1&&(i(w),h==null||h(w))})},[b,h,p]);return d.jsxs("div",{className:J("fabric-tabPanel","area-content grid bg-base overflow-hidden"),"data-orientation":f,"data-variant":P??"default",children:[d.jsxs("div",{className:J("fabric-tabHeader",r,C&&"justify-".concat(C),["start","end"].includes(f)&&"flex-col","flex flex-nowrap overflow-hidden items-center"),children:[m,d.jsx("div",{className:J("fabric-tabList",C&&"justify-".concat(C),["start","end"].includes(f)&&"flex-col",["bottom","end"].includes(f)?"self-start":"self-end","flex flex-1 flex-nowrap overflow-auto scroll-thin"),style:{gap:H},children:F.map(function(w){var M,ne;return c.cloneElement(w,{tabFlex:(M=w.props.tabFlex)!==null&&M!==void 0?M:A,activeClassName:(ne=w.props.activeClassName)!==null&&ne!==void 0?ne:g,onClick:N,active:w.props.id===p})})}),S]}),E,D]})},en=["name","children"],rn=["ref","onChange"];function Ue(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function Pe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ue(Object(n),!0).forEach(function(r){ue(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ue(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Bn=function(e){var n=e.name,r=e.children,l=ve(e,en);if(!n)throw Error("Form Controller missing `name` prop");return d.jsx(br,{name:n,render:function(j){var g,C=j.field,P=C.ref,A=C.onChange,S=ve(C,rn),m=j.fieldState.error,H=j.formState.isSubmitting;return c.isValidElement(r)?c.cloneElement(c.Children.only(r),Pe(Pe(Pe({},S),l),{},{ref:function(h){h&&P(h);try{var y;r.props.ref&&"current"in r.props.ref&&(r.props.ref.current=h),(y=r.props.ref)!==null&&y!==void 0&&y.prototype&&r.props.ref(h)}catch{}},checked:!!S.value,readOnly:H||r.props.readOnly,invalid:!!(m!=null&&m.message)||r.props.invalid,error:(g=m==null?void 0:m.message)!==null&&g!==void 0?g:r.props.error,onChange:function(h){var y,k;A(h),(y=(k=r.props).onChange)===null||y===void 0||y.call(k,h)}})):r(Pe(Pe(Pe({},S),l),{},{ref:function(h){h&&P(h)},readOnly:H,invalid:!!(m!=null&&m.message),checked:!!S.value,error:m==null?void 0:m.message,onChange:function(h){A(h)}}))}})},nn=["formRef","schema","children","defaultValues","onSubmit","onChange"];function Ge(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function Ce(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ge(Object(n),!0).forEach(function(r){ue(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ge(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var tn=function(){},Vn=function(e){var n=e.formRef,r=e.schema,l=e.children,f=e.defaultValues,j=f===void 0?pr:f,g=e.onSubmit,C=g===void 0?tn:g,P=e.onChange,A=ve(e,nn),S=c.useRef(null),m=Or({shouldFocusError:!0,resolver:r&&jr(r),defaultValues:j}),H=c.useTransition(),b=re(H,2),h=b[1],y=Me(P,[P],300);c.useEffect(function(){var i=m.watch(function(O){h(function(){return y==null?void 0:y(O)})});return function(){return i.unsubscribe()}},[m.watch,y]);var k=c.useCallback(function(){var i,O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};m.reset(O),m.clearErrors(),(i=S.current)===null||i===void 0||(i=i.querySelector("[auto-focus], input, textarea"))===null||i===void 0||i.focus()},[j]);c.useImperativeHandle(n,function(){return{state:m.formState,reset:function(){return k(j)},clear:function(){return k()},submit:function(){return m.handleSubmit(C)},validate:function(){var i=xr($e.mark(function x(){return $e.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,m.trigger();case 2:return E.abrupt("return",E.sent);case 3:case"end":return E.stop()}},x)}));function O(){return i.apply(this,arguments)}return O}(),getValues:function(){return m.getValues()},setValues:function(O){return setTimeout(function(){return m.reset(O)},50)},setValue:function(O,x){return setTimeout(function(){return m.setValue(O,x,{shouldDirty:!1,shouldTouch:!1})},50)}}},[C,m,m.formState,j]);var p=c.useCallback(function(i,O){var x=O.target;setTimeout(function(){var F;return(F=x.querySelector("input[aria-invalid='true'],textarea[aria-invalid='true']"))===null||F===void 0?void 0:F.focus()},10)},[]);return d.jsx(Pr,Ce(Ce({},m),{},{children:d.jsxs("form",Ce(Ce({ref:S,onReset:function(){return k(j)},onSubmit:function(O){O.stopPropagation(),m.handleSubmit(C,p)(O)},"data-loading":m.formState.isSubmitting,className:"contents",autoComplete:"off"},A),{},{children:[l,d.jsx("input",{type:"submit",className:"absolute invisible"})]}))}))};function Le(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function an(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Le(Object(n),!0).forEach(function(r){ue(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Le(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var on=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],l=Q(r);n.forEach(function(g){return l.push({label:g.label,hijri:g.hijri,icon:g.icon,start:Qe(_.parseDate(g.start),e),end:Qe(_.parseDate(g.end),e)})}),l.push({label:"superdate:event.newYear",start:Se(new Date("".concat(e-1,"-12-31"))),end:Ee(new Date("".concat(e,"-01-01")))}),l.push({label:"superdate:event.christmas",start:Se(new Date("".concat(e,"-12-24"))),end:Ee(new Date("".concat(e,"-12-26")))});var f=_.startOfYear(new Date("".concat(e-1,"-12-31")),!0);f=_.addMonths(f,8,!0),f.getFullYear()!==e&&(f=_.addYears(f,f.getFullYear()>e?-1:1,!0));var j=_.endOfMonth(f,!0);return l.push({label:"superdate:event.ramadan",start:Se(f),end:Ee(j)}),l.sort(function(g,C){return g.start.getTime()<C.start.getTime()?-1:1})},Yn=function(e){var n=e.isHijri,r=e.onChange,l=e.events,f=l===void 0?Fe:l,j=e.recurringEvents,g=j===void 0?Fe:j,C=ar(),P=C.t,A=c.useState({}),S=re(A,2),m=S[0],H=S[1],b=c.useReducer(function(p,i){var O=!1;if(i.type==="init"&&(p.pageDate=new Date,O=!0),i.type==="changePage"&&(p.page=Math.max(i.page,W.MONTH)),i.type==="changePageDate"&&(O=!0,p.pageDate=i.date,i.changePage&&(p.page=Math.max(p.page-1,W.MONTH))),O){var x,F=p.pageDate.getFullYear();p.events=on(F,g??[],(x=m[F])!==null&&x!==void 0?x:[])}return an({},p)},{pageDate:new Date,page:W.MONTH,events:[]}),h=re(b,2),y=h[0],k=h[1];return c.useEffect(function(){k({type:"init"})},[]),c.useEffect(function(){var p={};f.forEach(function(i){var O=Se(new Date(i.start)),x=Ee(new Date(i.end));p[O.getFullYear()]||(p[O.getFullYear()]=[]),p[O.getFullYear()].push(i),O.getFullYear()!==x.getFullYear()&&(p[x.getFullYear()]||(p[x.getFullYear()]=[]),p[x.getFullYear()].push(i))}),H(p)},[f]),d.jsxs(Er,{children:[d.jsx(Dr,{page:y.page,pageDate:y.pageDate,changePage:function(i){return k({type:"changePage",page:i})},changePageDate:function(i){return k({type:"changePageDate",date:i,changePage:!1})}}),y.page===W.MONTH&&d.jsx(kr,{className:"p-2 max-h-48",children:y.events.map(function(p){return d.jsxs("div",{role:"none","data-dropdown-dismiss":"true",onClick:function(){r==null||r("".concat(p.start.toISOString(),"|").concat(p.end.toISOString()),[p.start.toISOString(),p.end.toISOString()])},className:"text-sm my-1 py-1 px-2 flex flex-nowrap items-center cursor-pointer rounded hover:bg-primary-50",children:[d.jsx("div",{className:"flex-1 truncate",children:P(p.label,{defaultValue:p.label})}),d.jsxs("div",{className:"text-muted text-xs",children:[_.format(p.start,Tr(p.start,p.end)?"dd":"dd/MMM",Ae.language,n),d.jsx("span",{children:" - "}),_.format(p.end,"dd/MMM",Ae.language,n)]})]},p.label)})}),y.page===W.YEAR&&d.jsx(wr,{isHijri:n,page:y.page,pageDate:y.pageDate,changePageDate:function(i){return k({type:"changePageDate",date:i})}}),y.page===W.DECADE&&d.jsx(Cr,{isHijri:n,page:y.page,pageDate:y.pageDate,changePageDate:function(i){return k({type:"changePageDate",date:i})}})]})},ln=["className","max","min","dateDisabled","onChange","showHijriToggle","value","withTime","showApply"];function We(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function de(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?We(Object(n),!0).forEach(function(r){ue(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):We(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Kn=function(e){var n=e.className,r=e.max,l=e.min,f=e.dateDisabled,j=e.onChange,g=e.showHijriToggle,C=e.value,P=e.withTime,A=e.showApply,S=A===void 0?!1:A,m=ve(e,ln),H=ar("date"),b=H.t,h=Fr(),y=h.currentCalendar,k=c.useState(y==="hijri"),p=re(k,2),i=p[0],O=p[1],x=Me(j,[j]);c.useEffect(function(){O(y==="hijri")},[y]);var F=c.useReducer(function(a,u){if(u.type==="reset")if(ke(u.date))a.hilight=void 0,a.selected=void 0,a.start.pageDate=new Date,a.start.hour=0,a.start.minute=0,a.end.pageDate=_.addMonths(new Date,1),a.end.hour=0,a.end.minute=0;else{var Z=re(u.date,2),ye=Z[0],X=Z[1],s=new Date(ye),ie=new Date(X);a.hilight=void 0,a.selected=[s,ie],a.start.pageDate=s,a.start.hour=s.getHours(),a.start.minute=s.getMinutes(),a.end.pageDate=ie,a.end.hour=ie.getHours(),a.end.minute=ie.getMinutes()}if(u.type==="changeDate")if(!a.hilight)a.hilight=[u.date,u.date],a.start.pageDate=u.date,a.end.pageDate=_.addMonths(u.date,1,i);else{var se=Ve(a.hilight[0],u.date),fe=se?u.date:a.hilight[0],be=se?a.hilight[0]:u.date;a.selected=[fe,be],a.hilight=void 0,a.start.pageDate=fe,a.end.pageDate=be}if(u.type==="changeHilight")if(a.hilight&&u.date){var le=re(a.hilight,1),Oe=le[0];a.hilight=[Oe,u.date]}else a.hilight=void 0;if(u.type==="changeTime"){if(u.range==="start"&&(a.start.hour=u.hour,a.start.minute=u.minute,a.selected)){var o,v;(o=a.selected[0])===null||o===void 0||o.setHours(u.hour),(v=a.selected[0])===null||v===void 0||v.setMinutes(u.minute)}if(u.range==="end"&&(a.end.hour=u.hour,a.end.minute=u.minute,a.selected)){var R,Y;(R=a.selected[1])===null||R===void 0||R.setHours(u.hour),(Y=a.selected[1])===null||Y===void 0||Y.setMinutes(u.minute)}}return u.type==="changePage"&&(a[u.range].page=u.page),u.type==="changePageDate"&&(a[u.range].pageDate=u.date,u.pageChange&&(a[u.range].page=Math.max(a[u.range].page-1,0),u.range==="start"&&a.start.page===W.DATE&&(a.end.pageDate=Nr(u.date,1)))),(u.type==="changeDate"||u.type==="changeTime")&&(l&&a.selected&&Ir(a.selected[0],new Date(l))&&(a.selected[0]=new Date(l),a.start.hour=a.selected[0].getHours(),a.start.minute=a.selected[0].getMinutes()),r&&a.selected&&Ve(a.selected[1],new Date(r))&&(a.selected[1]=new Date(r),a.end.hour=a.selected[1].getHours(),a.end.minute=a.selected[1].getMinutes()),!S&&a.selected&&!a.hilight&&(x==null||x([a.selected[0].toISOString(),a.selected[1].toISOString()]))),de({},a)},{start:{page:W.DATE,pageDate:new Date,hour:0,minute:0},end:{page:W.DATE,pageDate:_.addMonths(new Date,1,i),hour:0,minute:0}}),E=re(F,2),D=E[0],N=E[1];c.useEffect(function(){N({type:"reset",date:C})},[C]);var w=c.useCallback(function(a){return D.start.page===W.DATE&&he(f)?!!f.find(function(u){return Ye(new Date(u),a)}):_.isDisabled(a,D.start.page,l,r)},[D.start.page,l,r,f]),M=c.useCallback(function(a){return D.end.page===W.DATE&&he(f)?!!f.find(function(u){return Ye(new Date(u),a)}):_.isDisabled(a,D.end.page,l,r)},[D.end.page,l,r,f]),ne=c.useCallback(function(a){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;N({type:"changePageDate",pageChange:u,range:"start",date:a})},[]),U=c.useCallback(function(a){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;N({type:"changePageDate",pageChange:u,range:"end",date:a})},[]),q=c.useCallback(function(a){N({type:"changeDate",date:a})},[]);return d.jsxs("div",de(de({className:J("block overflow-hidden bg-base rounded-capped",n)},m),{},{children:[d.jsxs("div",{className:"flex flex-nowrap",children:[d.jsx(qe,de(de({},D.start),{},{max:r,min:l,hideNext:!0,withTime:P,isHijri:i,hilight:D.hilight,selected:D.selected,selectDate:q,isDateDisabled:w,changeTime:function(u){return N(de({type:"changeTime",range:"start"},u))},changePage:function(u){return N({type:"changePage",range:"start",page:u})},mouseOver:function(u){return N({type:"changeHilight",date:u})},changePageDate:ne})),d.jsx("div",{className:"border-s border-s-dimmed"}),d.jsx(qe,de(de({},D.end),{},{max:r,min:l,hidePrevious:!0,withTime:P,isHijri:i,hilight:D.hilight,selected:D.selected,selectDate:q,isDateDisabled:M,changeTime:function(u){return N(de({type:"changeTime",range:"end"},u))},changePage:function(u){return N({type:"changePage",range:"end",page:u})},mouseOver:function(u){return N({type:"changeHilight",date:u})},changePageDate:U}))]}),d.jsxs("div",{className:"border-t flex flex-nowrap justify-between px-2",children:[d.jsx("span",{children:g&&d.jsx(De,{size:"sm",variant:"link",color:"primary",className:"my-1",onClick:function(){O(!i)},children:b(i?"label.gregorian":"label.hijri")})}),D.start.page!==W.DATE&&d.jsx(De,{size:"sm",variant:"link",color:"primary",className:"my-1",onClick:function(){return N({type:"changePage",range:"start",page:W.DATE})},children:b("core:action.cancel")}),D.end.page!==W.DATE&&d.jsx(De,{size:"sm",variant:"link",color:"primary",className:"my-1",onClick:function(){return N({type:"changePage",range:"end",page:W.DATE})},children:b("core:action.cancel")}),D.hilight&&d.jsx(De,{size:"sm",variant:"link",color:"primary",className:"my-1",onClick:function(){return N({type:"changeHilight"})},children:b("core:action.cancel")}),!D.hilight&&S&&d.jsx(De,{size:"sm",variant:"solid",color:"primary",disabled:!D.selected,"data-dropdown-dismiss":"true",className:"my-1",onClick:function(){var u,Z;return x==null?void 0:x([(u=D.selected)===null||u===void 0?void 0:u[0].toISOString(),(Z=D.selected)===null||Z===void 0?void 0:Z[1].toISOString()])},children:b("core:action.apply")})]})]}))},un=["children","vertical","noOutline","plain"];function Je(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function Xe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Je(Object(n),!0).forEach(function(r){ue(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Je(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Qn=function(e){var n=e.children,r=e.vertical,l=e.noOutline,f=e.plain,j=ve(e,un);return d.jsx(Mr,Xe(Xe({},j),{},{children:d.jsx("div",{className:J("fabric-fieldGroup",!f&&!l&&"outline",!f&&"bg-base",f&&"flex-wrap","flex-1 rounded",!r&&"flex"),"data-vertical":!!r,children:Rr(n,function(g){return c.cloneElement(g,{"data-inner":!0})})})}))},sn=["ref","value","invalid","readOnly","disabled","required","placeholder","autoFocus","name","min","max","step","onBlur","onFocus","onChange","onEnterPressed"];function Ze(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function _e(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ze(Object(n),!0).forEach(function(r){ue(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ze(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var zn=function(e){var n=e.ref,r=e.value,l=e.invalid,f=e.readOnly,j=e.disabled,g=e.required,C=e.placeholder,P=e.autoFocus,A=e.name,S=e.min,m=e.max,H=e.step,b=e.onBlur,h=e.onFocus,y=e.onChange,k=e.onEnterPressed,p=ve(e,sn),i=c.useState(""),O=re(i,2),x=O[0],F=O[1],E=c.useDeferredValue(r),D=$r(k);c.useEffect(function(){F(E??"")},[E]);var N=c.useCallback(function(w){var M=w==null?void 0:w.target.valueAsNumber;F(M??""),y==null||y(M??null)},[y]);return d.jsx(or,_e(_e({showClear:!!x&&!j&&!f,onClear:N,invalid:l,readOnly:f,disabled:j,required:g},p),{},{children:d.jsx("input",{className:"appearance-none bg-transparent py-1 px-2 flex-1 border-none outline-none ring-0 peer","aria-invalid":l,"aria-disabled":j,"aria-readonly":f,placeholder:C,disabled:j,readOnly:f,"data-testid":A,name:A,type:"number",size:1,min:S,max:m,step:H,ref:n,autoComplete:"off",autoFocus:P,value:x,onBlur:b,onFocus:h,onChange:N,onKeyDown:D})}))},cn=["ref","style","items","active","className","itemRef","empty","valueProperty","labelProperty","itemProps","children"];function er(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function xe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?er(Object(n),!0).forEach(function(r){ue(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):er(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var dn=function(e){var n=e.ref,r=e.style,l=e.items,f=e.active,j=e.className,g=e.itemRef,C=e.empty;e.valueProperty;var P=e.labelProperty,A=P===void 0?"label":P,S=e.itemProps,m=e.children,H=ve(e,cn);return d.jsxs("div",xe(xe({ref:n,className:J("bg-base select-none overflow-x-hidden overflow-y-auto",j),style:r},H),{},{children:[l.length===0&&(C??d.jsx(Lr,{message:d.jsx(Be,{i18nKey:"form:select.emptyList"})})),l.map(function(b,h){var y,k;return b.___group___?d.jsx("p",{className:"px-2 py-1 text-muted text-xs sticky -top-px z-2 bg-base border-t",children:b.label},h):b.___create___?d.jsx("div",xe(xe({role:"none",tabIndex:f===h?0:-1,ref:function(i){return g(h,i)},"data-active":f===h?!0:void 0,className:J("block text-start truncate px-2 py-1 leading-normal cursor-pointer select-none","data-[active]:bg-primary-200 data-[selected]:bg-primary-600 data-[selected]:text-white data-[active]:data-[selected]:underline")},S(b)),{},{children:d.jsx(Be,{i18nKey:"form:select.createOption",values:{query:(y=b.value)!==null&&y!==void 0?y:b},components:[d.jsx("strong",{children:"query"},"t0")]})}),h):d.jsx("div",xe(xe({role:"none",tabIndex:f===h?0:-1,ref:function(i){return g(h,i)},"data-active":f===h?!0:void 0,className:J("block text-start truncate px-2 py-1 leading-normal cursor-pointer","data-[active]:bg-primary-200 data-[selected]:bg-primary-600 data-[selected]:text-white data-[active]:data-[selected]:underline")},S(b)),{},{children:m(b,(k=b[A])!==null&&k!==void 0?k:b)}),h)})]}))},pn=function(e){return e},vn=function(e,n){var r,l,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";return he(e)?e.map(function(j){var g;return(g=j[f])!==null&&g!==void 0?g:j}):(r=(l=e==null?void 0:e[f])!==null&&l!==void 0?l:e)!==null&&r!==void 0?r:n};function rr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function z(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?rr(Object(n),!0).forEach(function(r){ue(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rr(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var fn=function(e){var n=e.options,r=n===void 0?Fe:n,l=e.value,f=e.defaultOpen,j=f===void 0?!1:f,g=e.autoComplete,C=e.multiple,P=C===void 0?!1:C,A=e.allowCreate,S=A===void 0?!1:A,m=e.groupProperty,H=m===void 0?"":m,b=e.valueProperty,h=b===void 0?"id":b,y=e.labelProperty,k=y===void 0?"label":y,p=e.sortProperty,i=e.createOption,O=i===void 0?pn:i,x=e.matcher,F=e.onQuery,E=e.onChange,D=e.onSelect,N=c.useMemo(function(){return P?[]:""},[P]),w=c.useDeferredValue(l??N),M=c.useRef([]),ne=c.useRef(null),U=c.useRef([]),q=c.useRef([]),a=c.useCallback(function(o,v){var R,Y;return(R=x==null?void 0:x(o,v))!==null&&R!==void 0?R:Wr((Y=o[k])!==null&&Y!==void 0?Y:o,v)},[x]),u=c.useCallback(function(o){setTimeout(function(){D==null||D(o??N),E==null||E(vn(o,N,h))},50)},[N,D,E]),Z=c.useReducer(function(o,v){if(v.type==="open"){var R=o.items.indexOf(o.multiple?o.value[0]:o.value);return z(z({},o),{},{open:!0,activeIndex:R>-1?R:null})}if(v.type==="close")return z(z({},o),{},{activeIndex:null,open:!1});if(v.type==="active"&&o.open)return g&&v.index!==null&&(o.query=o.items[v.index]),z(z({},o),{},{activeIndex:v.index});if(v.type==="setValue")return z(z({},o),{},{value:v.value,selectedIndex:o.items.indexOf(o.multiple?v.value[0]:v.value)});if(v.type==="changeValue"){var Y,B=z(z({},o),{},{value:o.emptyValue,activeIndex:null,selectedIndex:g?o.multiple?(Y=v.value)===null||Y===void 0?void 0:Y.length:0:o.items.indexOf(v.value)});if(v.value!==void 0)if(P){var K=[];tr(v.value)?K.push.apply(K,Q(v.value.split(/,\s?/))):K.push(v.value),B.value=Q(o.value),K.forEach(function(ae){var ce,ge;B.value=(ce=(ge=B.value).includes)!==null&&ce!==void 0&&ce.call(ge,ae)?B.value.filter(function(me){return me!==ae}):[].concat(Q(B.value),[ae])})}else B.value=v.value;return o.multiple||(B.open=!1),u(B.value),B}if(v.type==="removeItem"){var ee=o.value;if(o.multiple){var G;ee=Q(ee),ee.splice((G=v.index)!==null&&G!==void 0?G:-1,1)}else ee="";return u(ee),z(z({},o),{},{value:ee})}if(v.type==="startQuery")return z(z({},o),{},{loading:!0,query:v.query});if(v.type==="options"){var L=z(z({},o),{},{loading:!1,query:v.query}),te=Q(v.options);g&&v.query!==void 0&&(te=Ke([v.query].concat(Q(te)))),p&&(te=te.sort(Jr("asc",p)));var Te=Xr(te,H,"");if(v.open&&(L.open=!0),L.items=[],S&&v.query&&L.items.push({___create___:!0,value:v.query}),Object.entries(Te).forEach(function(ae){var ce,ge=re(ae,2),me=ge[0],Ne=ge[1];me&&L.items.push({___group___:!0,label:me}),(ce=L.items).push.apply(ce,Q(Ne))}),v.setActive){var we=L.items.findIndex(function(ae){return!ae.___group___});L.activeIndex=we>=0?we:null}else L.activeIndex=null;return U.current=L.items,L}return o},{multiple:P,emptyValue:N,open:j,loading:!1,activeIndex:null,selectedIndex:null,value:N,query:void 0,items:[]}),ye=re(Z,2),X=ye[0],s=ye[1];c.useEffect(function(){if(!P){var o,v=(S||g)&&w?O(w):void 0,R=r.find(function(B){var K;return((K=B[h])!==null&&K!==void 0?K:B)===w});q.current=r,!R&&v&&(q.current=[v].concat(Q(r??[]))),s({type:"options",options:q.current}),s({type:"setValue",value:(o=R??v)!==null&&o!==void 0?o:w})}if(P){q.current=[];var Y=(he(w)?w:[]).map(function(B){var K,ee=(S||g)&&B?O(B):void 0,G=r.find(function(L){var te;return((te=L[h])!==null&&te!==void 0?te:L)===B});return!G&&ee&&q.current.push(ee),(K=G??ee)!==null&&K!==void 0?K:B});q.current=[].concat(Q(q.current),Q(r??[])),s({type:"options",options:q.current}),s({type:"setValue",value:Y})}},[w,r,P,S,g,O]);var ie=Me(function(o){Promise.resolve(F==null?void 0:F(o)).then(function(v){var R=Q(v);g&&R.push.apply(R,Q(q.current.filter(function(Y){return a==null?void 0:a(Y,o)}))),s({type:"options",query:o,options:R,open:!0,setActive:!0})})},[F],300),se=c.useCallback(function(o){if(!o)s({type:"options",query:"",options:q.current});else{if(F)return s({type:"startQuery",query:o}),ie(o);s({type:"options",query:o,open:!0,setActive:!0,options:q.current.filter(function(v){return a==null?void 0:a(v,o)})})}},[a,F]),fe=c.useCallback(function(o){var v=o;if(g&&P&&o&&(v=o.split(/,\s?/)),s({type:"changeValue",value:o!=null&&o.___create___?o.value:o}),o!=null&&o.___create___){var R=[o.value];P&&(R=o.value.split(/,\s?/)),q.current=[].concat(Q(q.current),Q(R.map(O)))}g&&(q.current=Ke([].concat(Q(he(v)?v:[v]),Q(q.current)))),s({type:"options",options:q.current})},[]),be=c.useCallback(function(o){s({type:"removeItem",index:o})},[]),le=c.useCallback(function(o){s({type:o?"open":"close"}),s({type:"options",query:void 0,options:q.current})},[]),Oe=c.useCallback(function(o){s({type:"active",index:o})},[]);return{state:X,listRef:M,focusableRef:ne,listContentRef:U,handleChange:fe,handleRemove:be,handleQuery:se,macthOption:a,setActiveIndex:Oe,setOpen:le,setItemRef:function(v,R){M.current[v]=R}}},gn=["ref","name","value","invalid","readOnly","disabled","required","placeholder","autoFocus","error","options","defaultOpen","hideHandle","groupProperty","labelProperty","valueProperty","sortProperty","multiple","searchable","allowCreate","emptyDisplay","createOption","matcher","renderer","onQuery","onChange","onSelect","onEnterPressed"];function nr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function pe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?nr(Object(n),!0).forEach(function(r){ue(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):nr(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Un=function(e){var n,r,l=e.ref,f=e.name,j=e.value,g=e.invalid,C=e.readOnly,P=e.disabled,A=e.required,S=e.placeholder,m=e.autoFocus,H=e.error,b=e.options,h=e.defaultOpen,y=e.hideHandle,k=e.groupProperty,p=e.labelProperty,i=p===void 0?"label":p,O=e.valueProperty,x=O===void 0?"id":O,F=e.sortProperty,E=e.multiple,D=e.searchable,N=e.allowCreate,w=e.emptyDisplay,M=e.createOption,ne=e.matcher,U=e.renderer,q=e.onQuery,a=e.onChange,u=e.onSelect,Z=e.onEnterPressed,ye=ve(e,gn),X=fn({value:j,options:b,multiple:E,defaultOpen:h,groupProperty:k,labelProperty:i,valueProperty:x,sortProperty:F,allowCreate:N,createOption:M,matcher:ne,onChange:a,onSelect:u,onQuery:q}),s=X.state,ie=X.listRef,se=X.listContentRef,fe=X.setOpen,be=X.macthOption,le=X.handleChange,Oe=X.handleRemove,o=X.handleQuery,v=X.setItemRef,R=X.setActiveIndex,Y=c.useId(),B=Ar({open:s.open,onOpenChange:function($,T,V){!$&&(ie.current=[]),fe($)},strategy:"fixed",placement:"bottom",whileElementsMounted:vr,middleware:[Hr({padding:8}),qr(),Br(2)]}),K=B.context,ee=B.floatingStyles,G=B.refs,L=Vr(K,{}),te=Yr(K,{}),Te=Kr(K,{listRef:ie,activeIndex:s.activeIndex,selectedIndex:s.selectedIndex,loop:!0,virtual:!0,focusItemOnOpen:!1,onNavigate:R}),we=Qr(K,{listRef:se,activeIndex:s.activeIndex,selectedIndex:s.selectedIndex,findMatch:function($,T){return $.find(function(V){return be(V,T)})},onMatch:function($){s.open&&R($),!D&&!E&&!s.open&&le(se.current[$])}}),ae=zr([te,D?void 0:L,Te,we]),ce=ae.getReferenceProps,ge=ae.getFloatingProps,me=ae.getItemProps,Ne=c.useMemo(function(){var I=ce();return pe(pe({},I),{},{onBlur:function(T){var V;if((V=T.relatedTarget)!==null&&V!==void 0&&V.closest('[data-select-dropdown="'.concat(Y,'"]'))){var oe;(oe=G.domReference.current)===null||oe===void 0||(oe=oe.querySelector("input"))===null||oe===void 0||oe.focus();return}o(""),fe(!1)},onKeyDown:function(T){if(T.key==="Enter"){if(s.activeIndex!==null)return le(se.current[s.activeIndex]),T.preventDefault(),T.stopPropagation(),!1;if(s.query)return o(""),T.preventDefault(),T.stopPropagation(),!1;Z==null||Z(T)}else T.key==="Tab"&&s.activeIndex!==null?le(se.current[s.activeIndex]):T.key==="Backspace"?!s.query&&Oe():(!D||["ArrowUp","ArrowDown"].includes(T.key))&&(["ArrowUp","ArrowDown"].includes(T.key)&&s.activeIndex===null&&R(s.selectedIndex),setTimeout(function(){var V;(V=I.onKeyDown)===null||V===void 0||V.call(I,T)},50))}})},[ce,Z,o,G,s.query,s.activeIndex]),ir=c.useMemo(function(){return ge({"data-select-dropdown":Y})},[ge]),lr=c.useCallback(function(I){var $,T,V=he(s.value)?($=s.value)===null||$===void 0||(T=$.includes)===null||T===void 0?void 0:T.call($,I):s.value===I;return me({"data-selected":V?!0:void 0,onClick:function(){le(I)}})},[me,le,s.value]),ur=c.useMemo(function(){if(he(s.value))return s.value.map(function(T,V){var oe,Ie;return d.jsx(Sr,{onRemove:function(){return Oe(V)},children:(oe=(Ie=U==null?void 0:U(T))!==null&&Ie!==void 0?Ie:T[i])!==null&&oe!==void 0?oe:T},V)});if(!ke(s.value)&&!s.query){var I,$;return d.jsx("span",{className:"self-center pointer-events-none select-none",children:(I=($=U==null?void 0:U(s.value))!==null&&$!==void 0?$:s.value[i])!==null&&I!==void 0?I:s.value})}},[s.value,s.query,S,U]),sr=c.useCallback(function(){var I;fe(!0),(I=G.domReference.current)===null||I===void 0||(I=I.querySelector("input"))===null||I===void 0||I.focus()},[]);return c.useLayoutEffect(function(){s.open&&setTimeout(function(){var I;s.selectedIndex&&((I=ie.current[s.selectedIndex])===null||I===void 0||I.scrollIntoView({block:"center"}))},100)},[s.open]),d.jsxs(or,pe(pe({showClear:!ke(s.value),onClear:le,invalid:g,readOnly:C,disabled:P,required:A,error:H,wrapperRef:G.setReference,className:s.open?"!z-[99]":""},ye),{},{children:[d.jsxs("div",pe(pe({role:"none","data-select-display":"true",className:J("group flex-1 py-1 px-2 truncate text-start flex gap-1 relative min-h-5 justify-start",E?"flex-wrap":"flex-nowrap overflow-hidden")},Ne),{},{onMouseUp:function($){var T;return(T=$.currentTarget.querySelector("input"))===null||T===void 0?void 0:T.focus()},children:[ur,d.jsx("input",{readOnly:!D||C,disabled:P,value:(n=s.query)!==null&&n!==void 0?n:"","aria-invalid":g,"data-testid":f,name:f,size:1,ref:l,autoFocus:m,className:J("appearance-none bg-transparent outline-none border-none ring-0 flex-1 peer",P&&"cursor-not-allowed pointer-events-none",E&&"min-w-24"),placeholder:ke(s.value)?S:"",onChange:function($){return o($.target.value)}})]})),!s.loading&&!y&&d.jsx(Re,{className:J("flex-content p-2 z-0 order-9 text-muted cursor-pointer self-stretch flex items-center h-auto",s.open&&"-scale-y-100 pointer-events-none",P&&"pointer-events-none"),onClick:function(){return!P&&sr()},icon:He.chevronDown}),s.loading&&d.jsx(Re,{animate:"spin",className:J("flex-content p-2 z-0 order-9 text-muted pointer-events-none"),icon:He.spinner}),s.open&&!s.loading&&d.jsx(Ur,{children:d.jsx(Gr,{context:K,initialFocus:-1,visuallyHiddenDismiss:!0,children:d.jsx(dn,pe(pe({ref:G.setFloating,className:"outline shadow-lg max-h-[40vh] z-(--z-popover)",style:pe({width:(r=G.reference.current)===null||r===void 0?void 0:r.getBoundingClientRect().width},ee)},ir),{},{items:s.items,active:s.activeIndex,valueProperty:x,labelProperty:i,itemRef:v,itemProps:lr,empty:w,children:function($,T){var V;return(V=U==null?void 0:U($))!==null&&V!==void 0?V:T}}))})})]}))};export{Bn as C,Yn as E,Qn as F,zn as N,dn as O,Kn as R,Un as S,qn as T,Vn as a,_r as b,fn as u};
