import{t as pr,bH as vr,_ as de,r as c,s as ir,j as d,m as W,l as re,bI as fr,bJ as qe,ax as lr,bb as $e,br as Ne,bG as Ve,ba as Q,aL as Ie,aN as Oe,w as gr,x as mr,y as hr,z as yr,G as br,J as Or,L as Pr,bi as jr,bj as xr,N as Dr,Q as wr,W as Cr}from"./iframe-DwvN93Ge.js";import{n as Sr}from"./nodeCheck.js";import{_ as oe,C as Be}from"./index.js";import{T as kr,I as Ae,a as Er}from"./Tooltip.js";import{g as Nr,b as Ir,B as ke}from"./Button.js";import{D as Tr}from"./DropdownTool.js";import{a as Rr,u as Fr,o as Mr,F as $r,_ as Ar,D as Hr,Y as qr,b as Vr,B as Ye,T as Ke,C as Br}from"./BasePanel.js";import{u as He}from"./useDebounce.js";import{C as Yr}from"./Content.js";import{S as Kr}from"./Section.js";import{P as X,D as _}from"./Google.js";import{e as Te}from"./endOfDay.js";import{e as zr,a as ze,d as Qr,i as Ur}from"./zh-CN.js";import{u as Lr}from"./Global.js";import{i as Qe}from"./getDay.js";import{c as Gr}from"./cloneElement.js";import{F as Wr,I as ur}from"./InputWrapper.js";import{u as Jr}from"./eventHandlers.js";import{E as Xr}from"./EmptyContent.js";import{m as Zr,c as _r}from"./isEqual.js";import{d as Ue,g as en}from"./dedupe.js";function Le(t,e,n){const r=pr(t,n==null?void 0:n.in);return isNaN(+r)?vr(t,NaN):(r.setFullYear(e),r)}var rn=["ref","as","id","className","label","icon","badge","disabled","onClose","active","onClick","tabFlex","color","actions","tooltip","activeClassName"];function Ge(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function be(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ge(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ge(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var nn=function(e){var n=e.ref,r=e.as,l=e.id,p=e.className,O=e.label,P=e.icon,x=e.badge,E=e.disabled,S=e.onClose,j=e.active,m=e.onClick,A=e.tabFlex,R=e.color,b=e.actions,v=e.tooltip,w=e.activeClassName,g=de(e,rn),u=c.useMemo(function(){return Nr(x)},[x]),h=c.useMemo(function(){return!O},[O]),D=c.useMemo(function(){return ir(v)?{content:v}:v??{}},[v]),F=r??"button",q=v?kr:c.Fragment;return d.jsx(q,be(be({},D),{},{children:d.jsxs(F,be(be({"data-id":l,disabled:E,"data-color":R,"data-inner-clickable":!0,className:W("fabric-tabButton",p,j&&"active pointer-events-none",j&&w,E&&"text-tint-500 pointer-events-none",A?"flex-1":"flex-initial max-w-36",h?"min-w-6 rounded":"rounded-capped","flex items-center justify-center overflow-hidden cursor-pointer"),onClick:function(){return!j&&(m==null?void 0:m(l))},ref:n},g),{},{children:[P&&d.jsx(Ae,be({className:"flex-content p-2"},Er(P))),!h&&d.jsx("label",{className:"flex-initial truncate text-center px-1 py-1",children:O}),x&&d.jsx(Ir,be(be({},u),{},{placement:h?"end":"",className:W("me-1",u.className)})),b&&j&&d.jsx(Tr,{className:"bg-tint-50/20 me-1 z-5",children:b}),S&&d.jsx("span",{role:"none",className:W("cursor-pointer me-1 opacity-65 hover:opacity-90 pointer-events-auto"),onClick:function(N){S==null||S(),N.stopPropagation()},children:"Ã—"})]}))}))},Bn=function(e){var n=e.children,r=e.headerClassName,l=e.orientation,p=l===void 0?"top":l,O=e.activeTab,P=e.activeClassName,x=e.justify,E=e.variant,S=e.tabFlex,j=e.append,m=e.prepend,A=e.tabRotate,R=e.gap,b=e.onBeforeChange,v=e.onChange,w=c.useState(),g=re(w,2),u=g[0],h=g[1],D=c.useMemo(function(){return c.Children.toArray(n).reduce(function(C,T){return Sr(T,nn)?C[0].push(T):C[1].push(T),C},[[],[]])},[n]),F=re(D,2),q=F[0],y=F[1];c.useEffect(function(){h(O)},[O]);var N=c.useMemo(function(){var C;return(C=q.find(function(T){return T.props.id===u}))===null||C===void 0?void 0:C.props.children},[q,u]),U=c.useCallback(function(C){Promise.resolve(b==null?void 0:b(C,u)).then(function(T){T!==!1&&(h(C),v==null||v(C))})},[b,v,u]);return d.jsxs("div",{className:W("fabric-tabPanel","area-content grid bg-base overflow-hidden"),"data-orientation":p,"data-variant":E??"default",children:[d.jsxs("div",{className:W("fabric-tabHeader",r,A&&"tab-rotate",x&&"justify-".concat(x),["start","end"].includes(p)&&"flex-col","flex flex-nowrap overflow-hidden items-center"),children:[m,d.jsx("div",{className:W("fabric-tabList",x&&"justify-".concat(x),["start","end"].includes(p)&&"flex-col",["bottom","end"].includes(p)?"self-start":"self-end","flex flex-1 flex-nowrap overflow-auto scroll-thin"),style:{gap:R},children:q.map(function(C){var T,Y;return c.cloneElement(C,{tabFlex:(T=C.props.tabFlex)!==null&&T!==void 0?T:S,activeClassName:(Y=C.props.activeClassName)!==null&&Y!==void 0?Y:P,onClick:U,active:C.props.id===u})})}),j]}),y,N]})},tn=["name","children"],an=["ref","onChange"];function We(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function we(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?We(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):We(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Yn=function(e){var n=e.name,r=e.children,l=de(e,tn);if(!n)throw Error("Form Controller missing `name` prop");return d.jsx(Rr,{name:n,render:function(O){var P,x=O.field,E=x.ref,S=x.onChange,j=de(x,an),m=O.fieldState.error,A=O.formState.isSubmitting;return c.isValidElement(r)?c.cloneElement(c.Children.only(r),we(we(we({},j),l),{},{ref:function(b){b&&E(b);try{var v;r.props.ref&&"current"in r.props.ref&&(r.props.ref.current=b),(v=r.props.ref)!==null&&v!==void 0&&v.prototype&&r.props.ref(b)}catch{}},checked:!!j.value,readOnly:A||r.props.readOnly,invalid:!!(m!=null&&m.message)||r.props.invalid,error:(P=m==null?void 0:m.message)!==null&&P!==void 0?P:r.props.error,onChange:function(b){var v,w;S(b),(v=(w=r.props).onChange)===null||v===void 0||v.call(w,b)}})):r(we(we(we({},j),l),{},{ref:function(b){b&&E(b)},readOnly:A,invalid:!!(m!=null&&m.message),checked:!!j.value,error:m==null?void 0:m.message,onChange:function(b){S(b)}}))}})},on=["formRef","schema","children","defaultValues","onSubmit","onChange"];function Je(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function Ee(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Je(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Je(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var ln=function(){},Kn=function(e){var n=e.formRef,r=e.schema,l=e.children,p=e.defaultValues,O=p===void 0?fr:p,P=e.onSubmit,x=P===void 0?ln:P,E=e.onChange,S=de(e,on),j=c.useRef(null),m=Fr({shouldFocusError:!0,resolver:r&&Mr(r),defaultValues:O}),A=c.useTransition(),R=re(A,2),b=R[1],v=He(E,[E],300);c.useEffect(function(){var u=m.watch(function(h){b(function(){return v==null?void 0:v(h)})});return function(){return u.unsubscribe()}},[m.watch,v]);var w=c.useCallback(function(){var u,h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};m.reset(h),m.clearErrors(),(u=j.current)===null||u===void 0||(u=u.querySelector("[auto-focus], input, textarea"))===null||u===void 0||u.focus()},[O]);c.useImperativeHandle(n,function(){return{state:m.formState,reset:function(){return w(O)},clear:function(){return w()},submit:function(){return m.handleSubmit(x)},validate:function(){var u=Ar(qe.mark(function D(F){return qe.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,m.trigger(F);case 2:return y.abrupt("return",y.sent);case 3:case"end":return y.stop()}},D)}));function h(D){return u.apply(this,arguments)}return h}(),getValues:function(){return m.getValues()},setValues:function(h){return setTimeout(function(){return m.reset(h)},50)},setValue:function(h,D){return setTimeout(function(){return m.setValue(h,D,{shouldDirty:!1,shouldTouch:!1})},50)}}},[x,m,m.formState,O]);var g=c.useCallback(function(u,h){var D=h.target;setTimeout(function(){var F;return(F=D.querySelector("input[aria-invalid='true'],textarea[aria-invalid='true']"))===null||F===void 0?void 0:F.focus()},10)},[]);return d.jsx($r,Ee(Ee({},m),{},{children:d.jsxs("form",Ee(Ee({ref:j,onReset:function(){return w(O)},onSubmit:function(h){h.stopPropagation(),m.handleSubmit(x,g)(h)},"data-loading":m.formState.isSubmitting,className:"contents",autoComplete:"off"},S),{},{children:[l,d.jsx("input",{type:"submit",className:"absolute invisible"})]}))}))};function Xe(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function un(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Xe(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Xe(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var sn=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],l=Q(r);n.forEach(function(P){return l.push({label:P.label,hijri:P.hijri,icon:P.icon,start:Le(_.parseDate(P.start),e),end:Le(_.parseDate(P.end),e)})}),l.push({label:"superdate:event.newYear",start:Ne(new Date("".concat(e-1,"-12-31"))),end:Te(new Date("".concat(e,"-01-01")))}),l.push({label:"superdate:event.christmas",start:Ne(new Date("".concat(e,"-12-24"))),end:Te(new Date("".concat(e,"-12-26")))});var p=_.startOfYear(new Date("".concat(e-1,"-12-31")),!0);p=_.addMonths(p,8,!0),p.getFullYear()!==e&&(p=_.addYears(p,p.getFullYear()>e?-1:1,!0));var O=_.endOfMonth(p,!0);return l.push({label:"superdate:event.ramadan",start:Ne(p),end:Te(O)}),l.sort(function(P,x){return P.start.getTime()<x.start.getTime()?-1:1})},zn=function(e){var n=e.isHijri,r=e.onChange,l=e.events,p=l===void 0?$e:l,O=e.recurringEvents,P=O===void 0?$e:O,x=lr(),E=x.t,S=c.useState({}),j=re(S,2),m=j[0],A=j[1],R=c.useReducer(function(g,u){var h=!1;if(u.type==="init"&&(g.pageDate=new Date,h=!0),u.type==="changePage"&&(g.page=Math.max(u.page,X.MONTH)),u.type==="changePageDate"&&(h=!0,g.pageDate=u.date,u.changePage&&(g.page=Math.max(g.page-1,X.MONTH))),h){var D,F=g.pageDate.getFullYear();g.events=sn(F,P??[],(D=m[F])!==null&&D!==void 0?D:[])}return un({},g)},{pageDate:new Date,page:X.MONTH,events:[]}),b=re(R,2),v=b[0],w=b[1];return c.useEffect(function(){w({type:"init"})},[]),c.useEffect(function(){var g={};p.forEach(function(u){var h=Ne(new Date(u.start)),D=Te(new Date(u.end));g[h.getFullYear()]||(g[h.getFullYear()]=[]),g[h.getFullYear()].push(u),h.getFullYear()!==D.getFullYear()&&(g[D.getFullYear()]||(g[D.getFullYear()]=[]),g[D.getFullYear()].push(u))}),A(g)},[p]),d.jsxs(Kr,{children:[d.jsx(Hr,{page:v.page,pageDate:v.pageDate,changePage:function(u){return w({type:"changePage",page:u})},changePageDate:function(u){return w({type:"changePageDate",date:u,changePage:!1})}}),v.page===X.MONTH&&d.jsx(Yr,{className:"p-2 max-h-48",children:v.events.map(function(g){return d.jsxs("div",{role:"none","data-dropdown-dismiss":"true",onClick:function(){r==null||r("".concat(g.start.toISOString(),"|").concat(g.end.toISOString()),[g.start.toISOString(),g.end.toISOString()])},className:"text-sm my-1 py-1 px-2 flex flex-nowrap items-center cursor-pointer rounded hover:bg-primary-50",children:[d.jsx("div",{className:"flex-1 truncate",children:E(g.label,{defaultValue:g.label})}),d.jsxs("div",{className:"text-muted text-xs",children:[_.format(g.start,zr(g.start,g.end)?"dd":"dd/MMM",Ve.language,n),d.jsx("span",{children:" - "}),_.format(g.end,"dd/MMM",Ve.language,n)]})]},g.label)})}),v.page===X.YEAR&&d.jsx(qr,{isHijri:n,page:v.page,pageDate:v.pageDate,changePageDate:function(u){return w({type:"changePageDate",date:u})}}),v.page===X.DECADE&&d.jsx(Vr,{isHijri:n,page:v.page,pageDate:v.pageDate,changePageDate:function(u){return w({type:"changePageDate",date:u})}})]})},cn=["className","max","min","dateDisabled","onChange","showHijriToggle","value","withTime","showApply"];function Ze(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function se(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ze(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ze(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Qn=function(e){var n=e.className,r=e.max,l=e.min,p=e.dateDisabled,O=e.onChange,P=e.showHijriToggle,x=e.value,E=e.withTime,S=e.showApply,j=S===void 0?!1:S,m=de(e,cn),A=lr("date"),R=A.t,b=Lr(),v=b.currentCalendar,w=c.useState(v==="hijri"),g=re(w,2),u=g[0],h=g[1],D=He(O,[O]);c.useEffect(function(){h(v==="hijri")},[v]);var F=c.useReducer(function(a,o){if(o.type==="reset")if(Ie(o.date))a.hilight=void 0,a.selected=void 0,a.start.pageDate=new Date,a.start.hour=0,a.start.minute=0,a.end.pageDate=_.addMonths(new Date,1),a.end.hour=0,a.end.minute=0;else{var K=re(o.date,2),je=K[0],pe=K[1],ie=new Date(je),z=new Date(pe);a.hilight=void 0,a.selected=[ie,z],a.start.pageDate=ie,a.start.hour=ie.getHours(),a.start.minute=ie.getMinutes(),a.end.pageDate=z,a.end.hour=z.getHours(),a.end.minute=z.getMinutes()}if(o.type==="changeDate")if(!a.hilight)a.hilight=[o.date,o.date],a.start.pageDate=o.date,a.end.pageDate=_.addMonths(o.date,1,u);else{var s=ze(a.hilight[0],o.date),ve=s?o.date:a.hilight[0],le=s?a.hilight[0]:o.date;a.selected=[ve,le],a.hilight=void 0,a.start.pageDate=ve,a.end.pageDate=le}if(o.type==="changeHilight")if(a.hilight&&o.date){var he=re(a.hilight,1),Se=he[0];a.hilight=[Se,o.date]}else a.hilight=void 0;if(o.type==="changeTime"){if(o.range==="start"&&(a.start.hour=o.hour,a.start.minute=o.minute,a.selected)){var ee,fe;(ee=a.selected[0])===null||ee===void 0||ee.setHours(o.hour),(fe=a.selected[0])===null||fe===void 0||fe.setMinutes(o.minute)}if(o.range==="end"&&(a.end.hour=o.hour,a.end.minute=o.minute,a.selected)){var i,f;(i=a.selected[1])===null||i===void 0||i.setHours(o.hour),(f=a.selected[1])===null||f===void 0||f.setMinutes(o.minute)}}return o.type==="changePage"&&(a[o.range].page=o.page),o.type==="changePageDate"&&(a[o.range].pageDate=o.date,o.pageChange&&(a[o.range].page=Math.max(a[o.range].page-1,0),o.range==="start"&&a.start.page===X.DATE&&(a.end.pageDate=Qr(o.date,1)))),(o.type==="changeDate"||o.type==="changeTime")&&(l&&a.selected&&Ur(a.selected[0],new Date(l))&&(a.selected[0]=new Date(l),a.start.hour=a.selected[0].getHours(),a.start.minute=a.selected[0].getMinutes()),r&&a.selected&&ze(a.selected[1],new Date(r))&&(a.selected[1]=new Date(r),a.end.hour=a.selected[1].getHours(),a.end.minute=a.selected[1].getMinutes()),!j&&a.selected&&!a.hilight&&(D==null||D([a.selected[0].toISOString(),a.selected[1].toISOString()]))),se({},a)},{start:{page:X.DATE,pageDate:new Date,hour:0,minute:0},end:{page:X.DATE,pageDate:_.addMonths(new Date,1,u),hour:0,minute:0}}),q=re(F,2),y=q[0],N=q[1];c.useEffect(function(){N({type:"reset",date:x})},[x]);var U=c.useCallback(function(a){return y.start.page===X.DATE&&Oe(p)?!!p.find(function(o){return Qe(new Date(o),a)}):_.isDisabled(a,y.start.page,l,r)},[y.start.page,l,r,p]),C=c.useCallback(function(a){return y.end.page===X.DATE&&Oe(p)?!!p.find(function(o){return Qe(new Date(o),a)}):_.isDisabled(a,y.end.page,l,r)},[y.end.page,l,r,p]),T=c.useCallback(function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;N({type:"changePageDate",pageChange:o,range:"start",date:a})},[]),Y=c.useCallback(function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;N({type:"changePageDate",pageChange:o,range:"end",date:a})},[]),Pe=c.useCallback(function(a){N({type:"changeDate",date:a})},[]);return d.jsxs("div",se(se({className:W("block overflow-hidden bg-base rounded-capped",n)},m),{},{children:[d.jsxs("div",{className:"flex flex-nowrap",children:[d.jsx(Ye,se(se({},y.start),{},{max:r,min:l,hideNext:!0,withTime:E,isHijri:u,hilight:y.hilight,selected:y.selected,selectDate:Pe,isDateDisabled:U,changeTime:function(o){return N(se({type:"changeTime",range:"start"},o))},changePage:function(o){return N({type:"changePage",range:"start",page:o})},mouseOver:function(o){return N({type:"changeHilight",date:o})},changePageDate:T})),d.jsx("div",{className:"border-s border-s-dimmed"}),d.jsx(Ye,se(se({},y.end),{},{max:r,min:l,hidePrevious:!0,withTime:E,isHijri:u,hilight:y.hilight,selected:y.selected,selectDate:Pe,isDateDisabled:C,changeTime:function(o){return N(se({type:"changeTime",range:"end"},o))},changePage:function(o){return N({type:"changePage",range:"end",page:o})},mouseOver:function(o){return N({type:"changeHilight",date:o})},changePageDate:Y}))]}),d.jsxs("div",{className:"border-t flex flex-nowrap justify-between px-2",children:[d.jsx("span",{children:P&&d.jsx(ke,{size:"sm",variant:"link",color:"primary",className:"my-1",onClick:function(){h(!u)},children:R(u?"label.gregorian":"label.hijri")})}),y.start.page!==X.DATE&&d.jsx(ke,{size:"sm",variant:"link",color:"primary",className:"my-1",onClick:function(){return N({type:"changePage",range:"start",page:X.DATE})},children:R("core:action.cancel")}),y.end.page!==X.DATE&&d.jsx(ke,{size:"sm",variant:"link",color:"primary",className:"my-1",onClick:function(){return N({type:"changePage",range:"end",page:X.DATE})},children:R("core:action.cancel")}),y.hilight&&d.jsx(ke,{size:"sm",variant:"link",color:"primary",className:"my-1",onClick:function(){return N({type:"changeHilight"})},children:R("core:action.cancel")}),!y.hilight&&j&&d.jsx(ke,{size:"sm",variant:"solid",color:"primary",disabled:!y.selected,"data-dropdown-dismiss":"true",className:"my-1",onClick:function(){var o,K;return D==null?void 0:D([(o=y.selected)===null||o===void 0?void 0:o[0].toISOString(),(K=y.selected)===null||K===void 0?void 0:K[1].toISOString()])},children:R("core:action.apply")})]})]}))},dn=["children","vertical","noOutline","plain"];function _e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function er(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?_e(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_e(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Un=function(e){var n=e.children,r=e.vertical,l=e.noOutline,p=e.plain,O=de(e,dn);return d.jsx(Wr,er(er({},O),{},{children:d.jsx("div",{className:W("fabric-fieldGroup",!p&&!l&&"outline",!p&&"bg-base",p&&"flex-wrap","flex-1 rounded",!r&&"flex"),"data-vertical":!!r,children:Gr(n,function(P){return c.cloneElement(P,{"data-inner":!0})})})}))},pn=["ref","value","invalid","readOnly","disabled","required","placeholder","defaultValue","autoFocus","name","min","max","step","onBlur","onFocus","onChange","onEnterPressed"];function rr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function nr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?rr(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rr(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Ln=function(e){var n=e.ref,r=e.value,l=e.invalid,p=e.readOnly,O=e.disabled,P=e.required,x=e.placeholder,E=e.defaultValue,S=e.autoFocus,j=e.name,m=e.min,A=e.max,R=e.step,b=e.onBlur,v=e.onFocus,w=e.onChange,g=e.onEnterPressed,u=de(e,pn),h=c.useState(""),D=re(h,2),F=D[0],q=D[1],y=c.useDeferredValue(r??E),N=Jr(g);c.useEffect(function(){q(y??"")},[y]);var U=c.useCallback(function(C){var T,Y=(T=C==null?void 0:C.target.valueAsNumber)!==null&&T!==void 0?T:E;q(Y??""),w==null||w(Y??null)},[w,E]);return d.jsx(ur,nr(nr({showClear:!!F&&!O&&!p,onClear:U,invalid:l,readOnly:p,disabled:O,required:P},u),{},{children:d.jsx("input",{className:"appearance-none bg-transparent py-1 px-2 flex-1 border-none outline-none ring-0 peer","aria-invalid":l,"aria-disabled":O,"aria-readonly":p,placeholder:x,disabled:O,readOnly:p,"data-testid":j,name:j,type:"number",size:1,min:m,max:A,step:R,ref:n,autoComplete:"off",autoFocus:S,value:F,onBlur:b,onFocus:v,onChange:U,onKeyDown:N})}))},vn=["ref","style","items","active","className","itemRef","empty","info","valueProperty","labelProperty","itemProps","children"];function tr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function Ce(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?tr(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tr(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var fn=function(e){var n=e.ref,r=e.style,l=e.items,p=e.active,O=e.className,P=e.itemRef,x=e.empty,E=e.info;e.valueProperty;var S=e.labelProperty,j=S===void 0?"label":S,m=e.itemProps,A=e.children,R=de(e,vn);return d.jsxs("div",Ce(Ce({ref:n,className:W("bg-base select-none flex flex-col",O),style:r},R),{},{children:[d.jsxs("div",{className:W("overflow-x-hidden overflow-y-auto flex-1"),children:[l.length===0&&(x??d.jsx(Xr,{message:d.jsx(Ke,{i18nKey:"form:select.emptyList"})})),l.map(function(b,v){var w,g;return b.___group___?d.jsx("p",{className:"px-2 py-1 text-muted text-xs sticky -top-px z-2 bg-base border-t",children:b.label},v):b.___create___?d.jsx("div",Ce(Ce({role:"none",tabIndex:p===v?0:-1,ref:function(h){return P(v,h)},"data-active":p===v?!0:void 0,className:W("block text-start truncate px-2 py-1 leading-normal cursor-pointer select-none","data-[active]:bg-primary-200 data-[selected]:bg-primary-600 data-[selected]:text-white data-[active]:data-[selected]:underline")},m(b)),{},{children:d.jsx(Ke,{i18nKey:"form:select.createOption",values:{query:(w=b.value)!==null&&w!==void 0?w:b},components:[d.jsx("strong",{children:"query"},"t0")]})}),v):d.jsx("div",Ce(Ce({role:"none",tabIndex:p===v?0:-1,ref:function(h){return P(v,h)},"data-active":p===v?!0:void 0,className:W("block text-start truncate px-2 py-1 leading-normal cursor-pointer","data-[active]:bg-primary-200 data-[selected]:bg-primary-600 data-[selected]:text-white data-[active]:data-[selected]:underline")},m(b)),{},{children:A(b,(g=b[j])!==null&&g!==void 0?g:b)}),v)})]}),E&&d.jsx("div",{className:"px-2 py-1 text-sm bg-dimmed text-muted",children:E})]}))},gn=function(e){return e},mn=function(e,n){var r,l,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";return Oe(e)?e.map(function(O){var P;return(P=O[p])!==null&&P!==void 0?P:O}):(r=(l=e==null?void 0:e[p])!==null&&l!==void 0?l:e)!==null&&r!==void 0?r:n};function ar(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function G(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ar(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ar(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var hn=function(e){var n=e.options,r=n===void 0?$e:n,l=e.value,p=e.autoComplete,O=e.alwaysOpen,P=O===void 0?!1:O,x=e.defaultOpen,E=x===void 0?!1:x,S=e.multiple,j=S===void 0?!1:S,m=e.allowCreate,A=m===void 0?!1:m,R=e.groupProperty,b=R===void 0?"":R,v=e.valueProperty,w=v===void 0?"id":v,g=e.labelProperty,u=g===void 0?"label":g,h=e.sortProperty,D=e.createOption,F=D===void 0?gn:D,q=e.matcher,y=e.onQuery,N=e.onChange,U=e.onSelect,C=c.useMemo(function(){return j?[]:""},[j]),T=c.useDeferredValue(l??C),Y=c.useRef([]),Pe=c.useRef(null),a=c.useRef([]),o=c.useRef([]),K=c.useCallback(function(i,f){var M,Z;return(M=q==null?void 0:q(i,f))!==null&&M!==void 0?M:Zr((Z=i[u])!==null&&Z!==void 0?Z:i,f)},[q]),je=c.useCallback(function(i){setTimeout(function(){U==null||U(i??C),N==null||N(mn(i,C,w))},50)},[C,U,N]),pe=c.useReducer(function(i,f){if(f.type==="open"){var M=i.items.indexOf(i.multiple?i.value[0]:i.value);return G(G({},i),{},{open:!0,activeIndex:M>-1?M:null})}if(f.type==="close")return G(G({},i),{},{activeIndex:null,activeItem:null,open:!1});if(f.type==="active"&&i.open){var Z;return p&&f.index!==null&&(i.query=i.items[f.index]),G(G({},i),{},{activeIndex:f.index,activeItem:i.items[(Z=f.index)!==null&&Z!==void 0?Z:-1]})}if(f.type==="setValue")return G(G({},i),{},{value:f.value,selectedIndex:i.items.indexOf(i.multiple?f.value[0]:f.value)});if(f.type==="changeValue"){var J,H=G(G({},i),{},{value:i.emptyValue,activeIndex:null,activeItem:null,selectedIndex:p?i.multiple?(J=f.value)===null||J===void 0?void 0:J.length:0:i.items.indexOf(f.value)});if(f.value!==void 0)if(j){var te=[];ir(f.value)?te.push.apply(te,Q(f.value.split(/,\s?/))):te.push(f.value),H.value=Q(i.value),te.forEach(function(ae){var ue,me;H.value=(ue=(me=H.value).includes)!==null&&ue!==void 0&&ue.call(me,ae)?H.value.filter(function(De){return De!==ae}):[].concat(Q(H.value),[ae])})}else H.value=f.value;return i.multiple||(H.open=P),je(H.value),H}if(f.type==="removeItem"){var B=i.value;if(i.multiple){var ge;B=Q(B),B.splice((ge=f.index)!==null&&ge!==void 0?ge:-1,1)}else B="";return je(B),G(G({},i),{},{value:B})}if(f.type==="startQuery")return G(G({},i),{},{loading:!0,query:f.query});if(f.type==="options"){var L=G(G({},i),{},{loading:!1,query:f.query}),ye=Q(f.options);p&&f.query!==void 0&&(ye=Ue([f.query].concat(Q(ye)))),h&&(ye=ye.sort(_r("asc",h)));var Re=en(ye,b,"");if(f.open&&(L.open=!0),L.items=[],A&&f.query&&L.items.push({___create___:!0,value:f.query}),Object.entries(Re).forEach(function(ae){var ue,me=re(ae,2),De=me[0],Fe=me[1];De&&L.items.push({___group___:!0,label:De}),(ue=L.items).push.apply(ue,Q(Fe))}),f.setActive){var xe=L.items.findIndex(function(ae){return!ae.___group___});L.activeIndex=xe>=0?xe:null}else L.activeIndex=null;return a.current=L.items,L}return i},{multiple:j,emptyValue:C,open:P||E,loading:!1,activeIndex:null,activeItem:null,selectedIndex:null,value:C,query:void 0,items:[]}),ie=re(pe,2),z=ie[0],s=ie[1];c.useEffect(function(){if(!j){var i,f=(A||p)&&T?F(T):void 0,M=r.find(function(J){var H;return((H=J[w])!==null&&H!==void 0?H:J)===T});o.current=r,!M&&f&&(o.current=[f].concat(Q(r??[]))),s({type:"options",options:o.current}),s({type:"setValue",value:(i=M??f)!==null&&i!==void 0?i:T})}if(j){o.current=[];var Z=(Oe(T)?T:[]).map(function(J){var H,te=(A||p)&&J?F(J):void 0,B=r.find(function(ge){var L;return((L=ge[w])!==null&&L!==void 0?L:ge)===J});return!B&&te&&o.current.push(te),(H=B??te)!==null&&H!==void 0?H:J});o.current=[].concat(Q(o.current),Q(r??[])),s({type:"options",options:o.current}),s({type:"setValue",value:Z})}},[T,r,j,A,p,F]);var ve=He(function(i){Promise.resolve(y==null?void 0:y(i)).then(function(f){var M=Q(f);p&&M.push.apply(M,Q(o.current.filter(function(Z){return K==null?void 0:K(Z,i)}))),s({type:"options",query:i,options:M,open:!0,setActive:!0})})},[y],300),le=c.useCallback(function(i){if(!i)s({type:"options",query:"",options:o.current});else{if(y)return s({type:"startQuery",query:i}),ve(i);s({type:"options",query:i,open:!0,setActive:!0,options:o.current.filter(function(f){return K==null?void 0:K(f,i)})})}},[K,y]),he=c.useCallback(function(i){var f=i;if(p&&j&&i&&(f=i.split(/,\s?/)),s({type:"changeValue",value:i!=null&&i.___create___?i.value:i}),i!=null&&i.___create___){var M=[i.value];j&&(M=i.value.split(/,\s?/)),o.current=[].concat(Q(o.current),Q(M.map(F)))}p&&(o.current=Ue([].concat(Q(Oe(f)?f:[f]),Q(o.current)))),s({type:"options",options:o.current})},[]),Se=c.useCallback(function(i){s({type:"removeItem",index:i})},[]),ee=c.useCallback(function(i){s({type:i?"open":"close"}),s({type:"options",query:void 0,options:o.current})},[]),fe=c.useCallback(function(i){i&&i>-1&&s({type:"active",index:i})},[]);return{state:z,listRef:Y,focusableRef:Pe,listContentRef:a,handleChange:he,handleRemove:Se,handleQuery:le,macthOption:K,setActiveIndex:fe,setOpen:ee,setItemRef:function(f,M){Y.current[f]=M}}},yn=["ref","name","value","invalid","readOnly","disabled","required","placeholder","autoFocus","error","options","defaultOpen","hideHandle","groupProperty","labelProperty","valueProperty","sortProperty","infoProperty","multiple","searchable","allowCreate","emptyDisplay","createOption","matcher","renderer","onQuery","onChange","onSelect","onEnterPressed"];function or(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),n.push.apply(n,r)}return n}function ce(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?or(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):or(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Gn=function(e){var n,r,l,p=e.ref,O=e.name,P=e.value,x=e.invalid,E=e.readOnly,S=e.disabled,j=e.required,m=e.placeholder,A=e.autoFocus,R=e.error,b=e.options,v=e.defaultOpen,w=e.hideHandle,g=e.groupProperty,u=e.labelProperty,h=u===void 0?"label":u,D=e.valueProperty,F=D===void 0?"id":D,q=e.sortProperty,y=e.infoProperty,N=e.multiple,U=e.searchable,C=e.allowCreate,T=e.emptyDisplay,Y=e.createOption,Pe=e.matcher,a=e.renderer,o=e.onQuery,K=e.onChange,je=e.onSelect,pe=e.onEnterPressed,ie=de(e,yn),z=hn({value:P,options:b,multiple:N,defaultOpen:v,groupProperty:g,labelProperty:h,valueProperty:F,sortProperty:q,allowCreate:C,createOption:Y,matcher:Pe,onChange:K,onSelect:je,onQuery:o}),s=z.state,ve=z.listRef,le=z.listContentRef,he=z.setOpen,Se=z.macthOption,ee=z.handleChange,fe=z.handleRemove,i=z.handleQuery,f=z.setItemRef,M=z.setActiveIndex,Z=c.useId(),J=gr({open:s.open,onOpenChange:function($,k,V){!$&&(ve.current=[]),he($)},strategy:"fixed",placement:"bottom",whileElementsMounted:br,middleware:[mr({padding:8}),hr(),yr(2)]}),H=J.context,te=J.floatingStyles,B=J.refs,ge=Or(H,{}),L=Pr(H,{}),ye=jr(H,{listRef:ve,activeIndex:s.activeIndex,selectedIndex:s.selectedIndex,loop:!0,virtual:!0,focusItemOnOpen:!1,onNavigate:M}),Re=xr(H,{listRef:le,activeIndex:s.activeIndex,selectedIndex:s.selectedIndex,findMatch:function($,k){return $.find(function(V){return Se(V,k)})},onMatch:function($){s.open&&M($),!U&&!N&&!s.open&&ee(le.current[$])}}),xe=Dr([L,U?void 0:ge,ye,Re]),ae=xe.getReferenceProps,ue=xe.getFloatingProps,me=xe.getItemProps,De=c.useMemo(function(){var I=ae();return ce(ce({},I),{},{onBlur:function(k){var V;if((V=k.relatedTarget)!==null&&V!==void 0&&V.closest('[data-select-dropdown="'.concat(Z,'"]'))){var ne;(ne=B.domReference.current)===null||ne===void 0||(ne=ne.querySelector("input"))===null||ne===void 0||ne.focus();return}i(""),he(!1)},onKeyDown:function(k){if(k.key==="Enter"){if(s.activeIndex!==null)return ee(le.current[s.activeIndex]),k.preventDefault(),k.stopPropagation(),!1;if(s.query)return i(""),k.preventDefault(),k.stopPropagation(),!1;pe==null||pe(k)}else k.key==="Tab"&&s.activeIndex!==null?ee(le.current[s.activeIndex]):k.key==="Backspace"?!s.query&&fe():(!U||["ArrowUp","ArrowDown"].includes(k.key))&&(["ArrowUp","ArrowDown"].includes(k.key)&&s.activeIndex===null&&M(s.selectedIndex),setTimeout(function(){var V;(V=I.onKeyDown)===null||V===void 0||V.call(I,k)},50))}})},[ae,pe,i,B,s.query,s.activeIndex]),Fe=c.useMemo(function(){return ue({"data-select-dropdown":Z})},[ue]),sr=c.useCallback(function(I){var $,k,V=Oe(s.value)?($=s.value)===null||$===void 0||(k=$.includes)===null||k===void 0?void 0:k.call($,I):s.value===I;return me({"data-selected":V?!0:void 0,onClick:function(){ee(I)}})},[me,ee,s.value]),cr=c.useMemo(function(){if(Oe(s.value))return s.value.map(function(k,V){var ne,Me;return d.jsx(Br,{onRemove:function(){return fe(V)},children:(ne=(Me=a==null?void 0:a(k))!==null&&Me!==void 0?Me:k[h])!==null&&ne!==void 0?ne:k},V)});if(!Ie(s.value)&&!s.query){var I,$;return d.jsx("span",{className:"self-center pointer-events-none select-none",children:(I=($=a==null?void 0:a(s.value))!==null&&$!==void 0?$:s.value[h])!==null&&I!==void 0?I:s.value})}},[s.value,s.query,m,a]),dr=c.useCallback(function(){var I;he(!0),(I=B.domReference.current)===null||I===void 0||(I=I.querySelector("input"))===null||I===void 0||I.focus()},[]);return c.useLayoutEffect(function(){s.open&&setTimeout(function(){var I;s.selectedIndex&&((I=ve.current[s.selectedIndex])===null||I===void 0||I.scrollIntoView({block:"center"}))},100)},[s.open]),d.jsxs(ur,ce(ce({showClear:!Ie(s.value),onClear:ee,invalid:x,readOnly:E,disabled:S,required:j,error:R,wrapperRef:B.setReference,className:s.open?"!z-[99]":""},ie),{},{children:[d.jsxs("div",ce(ce({role:"none","data-select-display":"true",className:W("group flex-1 py-1 px-2 truncate text-start flex gap-1 relative min-h-5 justify-start",N?"flex-wrap":"flex-nowrap overflow-hidden")},De),{},{onMouseUp:function($){var k;return(k=$.currentTarget.querySelector("input"))===null||k===void 0?void 0:k.focus()},children:[cr,d.jsx("input",{readOnly:!U||E,disabled:S,value:(n=s.query)!==null&&n!==void 0?n:"","aria-invalid":x,"data-testid":O,name:O,size:1,ref:p,autoFocus:A,className:W("appearance-none bg-transparent outline-none border-none ring-0 flex-1 peer",S&&"cursor-not-allowed pointer-events-none",N&&"min-w-24"),placeholder:Ie(s.value)?m:"",onChange:function($){return i($.target.value)}})]})),!s.loading&&!w&&d.jsx(Ae,{className:W("flex-content p-2 z-0 order-9 text-muted cursor-pointer self-stretch flex items-center h-auto",s.open&&"-scale-y-100 pointer-events-none",S&&"pointer-events-none"),onClick:function(){return!S&&dr()},icon:Be.chevronDown}),s.loading&&d.jsx(Ae,{animate:"spin",className:W("flex-content p-2 z-0 order-9 text-muted pointer-events-none"),icon:Be.spinner}),s.open&&!s.loading&&d.jsx(wr,{children:d.jsx(Cr,{context:H,initialFocus:-1,visuallyHiddenDismiss:!0,children:d.jsx(fn,ce(ce({ref:B.setFloating,className:"outline shadow-lg max-h-[40vh] z-(--z-popover)",style:ce({width:(r=B.reference.current)===null||r===void 0?void 0:r.getBoundingClientRect().width},te)},Fe),{},{items:s.items,active:s.activeIndex,valueProperty:F,labelProperty:h,itemRef:f,itemProps:sr,empty:T,info:(l=s.activeItem)===null||l===void 0?void 0:l[y??"info"],children:function($,k){var V;return(V=a==null?void 0:a($))!==null&&V!==void 0?V:k}}))})})]}))};export{Yn as C,zn as E,Un as F,Ln as N,fn as O,Qn as R,Gn as S,Bn as T,Kn as a,nn as b,hn as u};
