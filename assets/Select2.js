import{t as pr,bR as vr,_ as de,r as c,s as ir,j as d,m as W,l as re,bS as fr,bT as qe,aA as lr,bl as $e,bx as Ne,bQ as Ve,bk as U,aO as Te,aQ as be,G as gr}from"./iframe-Ctw5u0Cj.js";import{n as mr}from"./nodeCheck.js";import{_ as oe,C as Be}from"./index2.js";import{T as hr,I as Ae}from"./Tooltip.js";import{g as yr,b as br,B as ke}from"./Button.js";import{D as Or}from"./DropdownTool.js";import{a as Pr,u as jr,o as xr,F as Dr,_ as wr,D as Cr,Y as Sr,b as kr,B as Ye,T as Ke,C as Er}from"./BasePanel.js";import{u as He}from"./useDebounce.js";import{C as Nr}from"./Content.js";import{S as Tr}from"./Section.js";import{P as X,D as _}from"./Google.js";import{e as Ie}from"./endOfDay.js";import{e as Ir,a as Qe,d as Fr,i as Rr}from"./zh-CN.js";import{u as Mr}from"./Global.js";import{i as ze}from"./getDay.js";import{c as $r}from"./cloneElement.js";import{F as Ar,I as ur}from"./InputWrapper.js";import{u as Hr}from"./eventHandlers.js";import{a as qr,s as Vr,f as Br,o as Yr,b as Kr,c as Qr,d as zr,e as Ur,g as Gr,F as Lr,h as Wr}from"./floating-ui.react.js";import{E as Jr}from"./EmptyContent.js";import{m as Xr,c as Zr}from"./isEqual.js";import{d as Ue,g as _r}from"./dedupe.js";function Ge(t,e,n){const r=pr(t,n==null?void 0:n.in);return isNaN(+r)?vr(t,NaN):(r.setFullYear(e),r)}var en=["ref","as","id","className","label","icon","iconBg","iconColor","rtlFlip","badge","disabled","onClose","active","onClick","tabFlex","color","actions","tooltip","activeClassName"];function Le(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),n.push.apply(n,r)}return n}function De(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Le(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Le(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var rn=function(e){var n=e.ref,r=e.as,u=e.id,p=e.className,b=e.label,O=e.icon,w=e.iconBg,I=e.iconColor,F=e.rtlFlip,j=e.badge,m=e.disabled,M=e.onClose,k=e.active,h=e.onClick,g=e.tabFlex,x=e.color,f=e.actions,l=e.tooltip,y=e.activeClassName,D=de(e,en),$=c.useMemo(function(){return yr(j)},[j]),R=c.useMemo(function(){return!b},[b]),P=c.useMemo(function(){return ir(l)?{content:l}:l??{}},[l]),E=r??"button",B=l?hr:c.Fragment;return d.jsx(B,De(De({},P),{},{children:d.jsxs(E,De(De({"data-id":u,disabled:m,"data-color":x,"data-inner-clickable":!0,className:W("fabric-tabButton",p,k&&"active pointer-events-none",k&&y,m&&"text-tint-500 pointer-events-none",g?"flex-1":"flex-initial max-w-36",R?"min-w-6 rounded":"rounded-capped","flex items-center justify-center overflow-hidden cursor-pointer"),onClick:function(){return!k&&(h==null?void 0:h(u))},ref:n},D),{},{children:[O&&d.jsx(Ae,{icon:O,bg:w,color:I,rtlFlip:F,className:"flex-content p-2"}),!R&&d.jsx("label",{className:"flex-initial truncate text-center px-1 py-1",children:b}),j&&d.jsx(br,De(De({},$),{},{placement:R?"end":"",className:W("me-1",$.className)})),f&&k&&d.jsx(Or,{className:"bg-tint-50/20 me-1 z-5",children:f}),M&&d.jsx("span",{role:"none",className:W("cursor-pointer me-1 opacity-65 hover:opacity-90 pointer-events-auto"),onClick:function(N){M==null||M(),N.stopPropagation()},children:"Ã—"})]}))}))},Bn=function(e){var n=e.children,r=e.headerClassName,u=e.orientation,p=u===void 0?"top":u,b=e.activeTab,O=e.activeClassName,w=e.justify,I=e.variant,F=e.tabFlex,j=e.append,m=e.prepend,M=e.tabRotate,k=e.gap,h=e.onBeforeChange,g=e.onChange,x=c.useState(),f=re(x,2),l=f[0],y=f[1],D=c.useMemo(function(){return c.Children.toArray(n).reduce(function(C,N){return mr(N,rn)?C[0].push(N):C[1].push(N),C},[[],[]])},[n]),$=re(D,2),R=$[0],P=$[1];c.useEffect(function(){y(b)},[b]);var E=c.useMemo(function(){var C;return(C=R.find(function(N){return N.props.id===l}))===null||C===void 0?void 0:C.props.children},[R,l]),B=c.useCallback(function(C){Promise.resolve(h==null?void 0:h(C,l)).then(function(N){N!==!1&&(y(C),g==null||g(C))})},[h,g,l]);return d.jsxs("div",{className:W("fabric-tabPanel","area-content grid bg-base overflow-hidden"),"data-orientation":p,"data-variant":I??"default",children:[d.jsxs("div",{className:W("fabric-tabHeader",r,M&&"tab-rotate",w&&"justify-".concat(w),["start","end"].includes(p)&&"flex-col","flex flex-nowrap overflow-hidden items-center"),children:[m,d.jsx("div",{className:W("fabric-tabList",w&&"justify-".concat(w),["start","end"].includes(p)&&"flex-col",["bottom","end"].includes(p)?"self-start":"self-end","flex flex-1 flex-nowrap overflow-auto scroll-thin"),style:{gap:k},children:R.map(function(C){var N,K;return c.cloneElement(C,{tabFlex:(N=C.props.tabFlex)!==null&&N!==void 0?N:F,activeClassName:(K=C.props.activeClassName)!==null&&K!==void 0?K:O,onClick:B,active:C.props.id===l})})}),j]}),P,E]})},nn=["name","children"],tn=["ref","onChange"];function We(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),n.push.apply(n,r)}return n}function we(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?We(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):We(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Yn=function(e){var n=e.name,r=e.children,u=de(e,nn);if(!n)throw Error("Form Controller missing `name` prop");return d.jsx(Pr,{name:n,render:function(b){var O,w=b.field,I=w.ref,F=w.onChange,j=de(w,tn),m=b.fieldState.error,M=b.formState.isSubmitting;return c.isValidElement(r)?c.cloneElement(c.Children.only(r),we(we(we({},j),u),{},{ref:function(h){h&&I(h);try{var g;r.props.ref&&"current"in r.props.ref&&(r.props.ref.current=h),(g=r.props.ref)!==null&&g!==void 0&&g.prototype&&r.props.ref(h)}catch{}},checked:!!j.value,readOnly:M||r.props.readOnly,invalid:!!(m!=null&&m.message)||r.props.invalid,error:(O=m==null?void 0:m.message)!==null&&O!==void 0?O:r.props.error,onChange:function(h){var g,x;F(h),(g=(x=r.props).onChange)===null||g===void 0||g.call(x,h)}})):r(we(we(we({},j),u),{},{ref:function(h){h&&I(h)},readOnly:M,invalid:!!(m!=null&&m.message),checked:!!j.value,error:m==null?void 0:m.message,onChange:function(h){F(h)}}))}})},an=["formRef","schema","children","defaultValues","onSubmit","onChange"];function Je(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),n.push.apply(n,r)}return n}function Ee(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Je(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Je(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var on=function(){},Kn=function(e){var n=e.formRef,r=e.schema,u=e.children,p=e.defaultValues,b=p===void 0?fr:p,O=e.onSubmit,w=O===void 0?on:O,I=e.onChange,F=de(e,an),j=c.useRef(null),m=jr({shouldFocusError:!0,resolver:r&&xr(r),defaultValues:b}),M=c.useTransition(),k=re(M,2),h=k[1],g=He(I,[I],300);c.useEffect(function(){var l=m.watch(function(y){h(function(){return g==null?void 0:g(y)})});return function(){return l.unsubscribe()}},[m.watch,g]);var x=c.useCallback(function(){var l,y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};m.reset(y),m.clearErrors(),(l=j.current)===null||l===void 0||(l=l.querySelector("[auto-focus], input, textarea"))===null||l===void 0||l.focus()},[b]);c.useImperativeHandle(n,function(){return{state:m.formState,reset:function(){return x(b)},clear:function(){return x()},submit:function(){return m.handleSubmit(w)},validate:function(){var l=wr(qe.mark(function D(){return qe.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,m.trigger();case 2:return R.abrupt("return",R.sent);case 3:case"end":return R.stop()}},D)}));function y(){return l.apply(this,arguments)}return y}(),getValues:function(){return m.getValues()},setValues:function(y){return setTimeout(function(){return m.reset(y)},50)},setValue:function(y,D){return setTimeout(function(){return m.setValue(y,D,{shouldDirty:!1,shouldTouch:!1})},50)}}},[w,m,m.formState,b]);var f=c.useCallback(function(l,y){var D=y.target;setTimeout(function(){var $;return($=D.querySelector("input[aria-invalid='true'],textarea[aria-invalid='true']"))===null||$===void 0?void 0:$.focus()},10)},[]);return d.jsx(Dr,Ee(Ee({},m),{},{children:d.jsxs("form",Ee(Ee({ref:j,onReset:function(){return x(b)},onSubmit:function(y){y.stopPropagation(),m.handleSubmit(w,f)(y)},"data-loading":m.formState.isSubmitting,className:"contents",autoComplete:"off"},F),{},{children:[u,d.jsx("input",{type:"submit",className:"absolute invisible"})]}))}))};function Xe(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),n.push.apply(n,r)}return n}function ln(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Xe(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Xe(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var un=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],u=U(r);n.forEach(function(O){return u.push({label:O.label,hijri:O.hijri,icon:O.icon,start:Ge(_.parseDate(O.start),e),end:Ge(_.parseDate(O.end),e)})}),u.push({label:"superdate:event.newYear",start:Ne(new Date("".concat(e-1,"-12-31"))),end:Ie(new Date("".concat(e,"-01-01")))}),u.push({label:"superdate:event.christmas",start:Ne(new Date("".concat(e,"-12-24"))),end:Ie(new Date("".concat(e,"-12-26")))});var p=_.startOfYear(new Date("".concat(e-1,"-12-31")),!0);p=_.addMonths(p,8,!0),p.getFullYear()!==e&&(p=_.addYears(p,p.getFullYear()>e?-1:1,!0));var b=_.endOfMonth(p,!0);return u.push({label:"superdate:event.ramadan",start:Ne(p),end:Ie(b)}),u.sort(function(O,w){return O.start.getTime()<w.start.getTime()?-1:1})},Qn=function(e){var n=e.isHijri,r=e.onChange,u=e.events,p=u===void 0?$e:u,b=e.recurringEvents,O=b===void 0?$e:b,w=lr(),I=w.t,F=c.useState({}),j=re(F,2),m=j[0],M=j[1],k=c.useReducer(function(f,l){var y=!1;if(l.type==="init"&&(f.pageDate=new Date,y=!0),l.type==="changePage"&&(f.page=Math.max(l.page,X.MONTH)),l.type==="changePageDate"&&(y=!0,f.pageDate=l.date,l.changePage&&(f.page=Math.max(f.page-1,X.MONTH))),y){var D,$=f.pageDate.getFullYear();f.events=un($,O??[],(D=m[$])!==null&&D!==void 0?D:[])}return ln({},f)},{pageDate:new Date,page:X.MONTH,events:[]}),h=re(k,2),g=h[0],x=h[1];return c.useEffect(function(){x({type:"init"})},[]),c.useEffect(function(){var f={};p.forEach(function(l){var y=Ne(new Date(l.start)),D=Ie(new Date(l.end));f[y.getFullYear()]||(f[y.getFullYear()]=[]),f[y.getFullYear()].push(l),y.getFullYear()!==D.getFullYear()&&(f[D.getFullYear()]||(f[D.getFullYear()]=[]),f[D.getFullYear()].push(l))}),M(f)},[p]),d.jsxs(Tr,{children:[d.jsx(Cr,{page:g.page,pageDate:g.pageDate,changePage:function(l){return x({type:"changePage",page:l})},changePageDate:function(l){return x({type:"changePageDate",date:l,changePage:!1})}}),g.page===X.MONTH&&d.jsx(Nr,{className:"p-2 max-h-48",children:g.events.map(function(f){return d.jsxs("div",{role:"none","data-dropdown-dismiss":"true",onClick:function(){r==null||r("".concat(f.start.toISOString(),"|").concat(f.end.toISOString()),[f.start.toISOString(),f.end.toISOString()])},className:"text-sm my-1 py-1 px-2 flex flex-nowrap items-center cursor-pointer rounded hover:bg-primary-50",children:[d.jsx("div",{className:"flex-1 truncate",children:I(f.label,{defaultValue:f.label})}),d.jsxs("div",{className:"text-muted text-xs",children:[_.format(f.start,Ir(f.start,f.end)?"dd":"dd/MMM",Ve.language,n),d.jsx("span",{children:" - "}),_.format(f.end,"dd/MMM",Ve.language,n)]})]},f.label)})}),g.page===X.YEAR&&d.jsx(Sr,{isHijri:n,page:g.page,pageDate:g.pageDate,changePageDate:function(l){return x({type:"changePageDate",date:l})}}),g.page===X.DECADE&&d.jsx(kr,{isHijri:n,page:g.page,pageDate:g.pageDate,changePageDate:function(l){return x({type:"changePageDate",date:l})}})]})},sn=["className","max","min","dateDisabled","onChange","showHijriToggle","value","withTime","showApply"];function Ze(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),n.push.apply(n,r)}return n}function se(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ze(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ze(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var zn=function(e){var n=e.className,r=e.max,u=e.min,p=e.dateDisabled,b=e.onChange,O=e.showHijriToggle,w=e.value,I=e.withTime,F=e.showApply,j=F===void 0?!1:F,m=de(e,sn),M=lr("date"),k=M.t,h=Mr(),g=h.currentCalendar,x=c.useState(g==="hijri"),f=re(x,2),l=f[0],y=f[1],D=He(b,[b]);c.useEffect(function(){y(g==="hijri")},[g]);var $=c.useReducer(function(a,o){if(o.type==="reset")if(Te(o.date))a.hilight=void 0,a.selected=void 0,a.start.pageDate=new Date,a.start.hour=0,a.start.minute=0,a.end.pageDate=_.addMonths(new Date,1),a.end.hour=0,a.end.minute=0;else{var Q=re(o.date,2),Pe=Q[0],pe=Q[1],ie=new Date(Pe),z=new Date(pe);a.hilight=void 0,a.selected=[ie,z],a.start.pageDate=ie,a.start.hour=ie.getHours(),a.start.minute=ie.getMinutes(),a.end.pageDate=z,a.end.hour=z.getHours(),a.end.minute=z.getMinutes()}if(o.type==="changeDate")if(!a.hilight)a.hilight=[o.date,o.date],a.start.pageDate=o.date,a.end.pageDate=_.addMonths(o.date,1,l);else{var s=Qe(a.hilight[0],o.date),ve=s?o.date:a.hilight[0],le=s?a.hilight[0]:o.date;a.selected=[ve,le],a.hilight=void 0,a.start.pageDate=ve,a.end.pageDate=le}if(o.type==="changeHilight")if(a.hilight&&o.date){var he=re(a.hilight,1),Se=he[0];a.hilight=[Se,o.date]}else a.hilight=void 0;if(o.type==="changeTime"){if(o.range==="start"&&(a.start.hour=o.hour,a.start.minute=o.minute,a.selected)){var ee,fe;(ee=a.selected[0])===null||ee===void 0||ee.setHours(o.hour),(fe=a.selected[0])===null||fe===void 0||fe.setMinutes(o.minute)}if(o.range==="end"&&(a.end.hour=o.hour,a.end.minute=o.minute,a.selected)){var i,v;(i=a.selected[1])===null||i===void 0||i.setHours(o.hour),(v=a.selected[1])===null||v===void 0||v.setMinutes(o.minute)}}return o.type==="changePage"&&(a[o.range].page=o.page),o.type==="changePageDate"&&(a[o.range].pageDate=o.date,o.pageChange&&(a[o.range].page=Math.max(a[o.range].page-1,0),o.range==="start"&&a.start.page===X.DATE&&(a.end.pageDate=Fr(o.date,1)))),(o.type==="changeDate"||o.type==="changeTime")&&(u&&a.selected&&Rr(a.selected[0],new Date(u))&&(a.selected[0]=new Date(u),a.start.hour=a.selected[0].getHours(),a.start.minute=a.selected[0].getMinutes()),r&&a.selected&&Qe(a.selected[1],new Date(r))&&(a.selected[1]=new Date(r),a.end.hour=a.selected[1].getHours(),a.end.minute=a.selected[1].getMinutes()),!j&&a.selected&&!a.hilight&&(D==null||D([a.selected[0].toISOString(),a.selected[1].toISOString()]))),se({},a)},{start:{page:X.DATE,pageDate:new Date,hour:0,minute:0},end:{page:X.DATE,pageDate:_.addMonths(new Date,1,l),hour:0,minute:0}}),R=re($,2),P=R[0],E=R[1];c.useEffect(function(){E({type:"reset",date:w})},[w]);var B=c.useCallback(function(a){return P.start.page===X.DATE&&be(p)?!!p.find(function(o){return ze(new Date(o),a)}):_.isDisabled(a,P.start.page,u,r)},[P.start.page,u,r,p]),C=c.useCallback(function(a){return P.end.page===X.DATE&&be(p)?!!p.find(function(o){return ze(new Date(o),a)}):_.isDisabled(a,P.end.page,u,r)},[P.end.page,u,r,p]),N=c.useCallback(function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;E({type:"changePageDate",pageChange:o,range:"start",date:a})},[]),K=c.useCallback(function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;E({type:"changePageDate",pageChange:o,range:"end",date:a})},[]),Oe=c.useCallback(function(a){E({type:"changeDate",date:a})},[]);return d.jsxs("div",se(se({className:W("block overflow-hidden bg-base rounded-capped",n)},m),{},{children:[d.jsxs("div",{className:"flex flex-nowrap",children:[d.jsx(Ye,se(se({},P.start),{},{max:r,min:u,hideNext:!0,withTime:I,isHijri:l,hilight:P.hilight,selected:P.selected,selectDate:Oe,isDateDisabled:B,changeTime:function(o){return E(se({type:"changeTime",range:"start"},o))},changePage:function(o){return E({type:"changePage",range:"start",page:o})},mouseOver:function(o){return E({type:"changeHilight",date:o})},changePageDate:N})),d.jsx("div",{className:"border-s border-s-dimmed"}),d.jsx(Ye,se(se({},P.end),{},{max:r,min:u,hidePrevious:!0,withTime:I,isHijri:l,hilight:P.hilight,selected:P.selected,selectDate:Oe,isDateDisabled:C,changeTime:function(o){return E(se({type:"changeTime",range:"end"},o))},changePage:function(o){return E({type:"changePage",range:"end",page:o})},mouseOver:function(o){return E({type:"changeHilight",date:o})},changePageDate:K}))]}),d.jsxs("div",{className:"border-t flex flex-nowrap justify-between px-2",children:[d.jsx("span",{children:O&&d.jsx(ke,{size:"sm",variant:"link",color:"primary",className:"my-1",onClick:function(){y(!l)},children:k(l?"label.gregorian":"label.hijri")})}),P.start.page!==X.DATE&&d.jsx(ke,{size:"sm",variant:"link",color:"primary",className:"my-1",onClick:function(){return E({type:"changePage",range:"start",page:X.DATE})},children:k("core:action.cancel")}),P.end.page!==X.DATE&&d.jsx(ke,{size:"sm",variant:"link",color:"primary",className:"my-1",onClick:function(){return E({type:"changePage",range:"end",page:X.DATE})},children:k("core:action.cancel")}),P.hilight&&d.jsx(ke,{size:"sm",variant:"link",color:"primary",className:"my-1",onClick:function(){return E({type:"changeHilight"})},children:k("core:action.cancel")}),!P.hilight&&j&&d.jsx(ke,{size:"sm",variant:"solid",color:"primary",disabled:!P.selected,"data-dropdown-dismiss":"true",className:"my-1",onClick:function(){var o,Q;return D==null?void 0:D([(o=P.selected)===null||o===void 0?void 0:o[0].toISOString(),(Q=P.selected)===null||Q===void 0?void 0:Q[1].toISOString()])},children:k("core:action.apply")})]})]}))},cn=["children","vertical","noOutline","plain"];function _e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),n.push.apply(n,r)}return n}function er(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?_e(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_e(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Un=function(e){var n=e.children,r=e.vertical,u=e.noOutline,p=e.plain,b=de(e,cn);return d.jsx(Ar,er(er({},b),{},{children:d.jsx("div",{className:W("fabric-fieldGroup",!p&&!u&&"outline",!p&&"bg-base",p&&"flex-wrap","flex-1 rounded",!r&&"flex"),"data-vertical":!!r,children:$r(n,function(O){return c.cloneElement(O,{"data-inner":!0})})})}))},dn=["ref","value","invalid","readOnly","disabled","required","placeholder","defaultValue","autoFocus","name","min","max","step","onBlur","onFocus","onChange","onEnterPressed"];function rr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),n.push.apply(n,r)}return n}function nr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?rr(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rr(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Gn=function(e){var n=e.ref,r=e.value,u=e.invalid,p=e.readOnly,b=e.disabled,O=e.required,w=e.placeholder,I=e.defaultValue,F=e.autoFocus,j=e.name,m=e.min,M=e.max,k=e.step,h=e.onBlur,g=e.onFocus,x=e.onChange,f=e.onEnterPressed,l=de(e,dn),y=c.useState(""),D=re(y,2),$=D[0],R=D[1],P=c.useDeferredValue(r??I),E=Hr(f);c.useEffect(function(){R(P??"")},[P]);var B=c.useCallback(function(C){var N,K=(N=C==null?void 0:C.target.valueAsNumber)!==null&&N!==void 0?N:I;R(K??""),x==null||x(K??null)},[x,I]);return d.jsx(ur,nr(nr({showClear:!!$&&!b&&!p,onClear:B,invalid:u,readOnly:p,disabled:b,required:O},l),{},{children:d.jsx("input",{className:"appearance-none bg-transparent py-1 px-2 flex-1 border-none outline-none ring-0 peer","aria-invalid":u,"aria-disabled":b,"aria-readonly":p,placeholder:w,disabled:b,readOnly:p,"data-testid":j,name:j,type:"number",size:1,min:m,max:M,step:k,ref:n,autoComplete:"off",autoFocus:F,value:$,onBlur:h,onFocus:g,onChange:B,onKeyDown:E})}))},pn=["ref","style","items","active","className","itemRef","empty","info","valueProperty","labelProperty","itemProps","children"];function tr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),n.push.apply(n,r)}return n}function Ce(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?tr(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tr(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var vn=function(e){var n=e.ref,r=e.style,u=e.items,p=e.active,b=e.className,O=e.itemRef,w=e.empty,I=e.info;e.valueProperty;var F=e.labelProperty,j=F===void 0?"label":F,m=e.itemProps,M=e.children,k=de(e,pn);return d.jsxs("div",Ce(Ce({ref:n,className:W("bg-base select-none flex flex-col",b),style:r},k),{},{children:[d.jsxs("div",{className:W("overflow-x-hidden overflow-y-auto flex-1"),children:[u.length===0&&(w??d.jsx(Jr,{message:d.jsx(Ke,{i18nKey:"form:select.emptyList"})})),u.map(function(h,g){var x,f;return h.___group___?d.jsx("p",{className:"px-2 py-1 text-muted text-xs sticky -top-px z-2 bg-base border-t",children:h.label},g):h.___create___?d.jsx("div",Ce(Ce({role:"none",tabIndex:p===g?0:-1,ref:function(y){return O(g,y)},"data-active":p===g?!0:void 0,className:W("block text-start truncate px-2 py-1 leading-normal cursor-pointer select-none","data-[active]:bg-primary-200 data-[selected]:bg-primary-600 data-[selected]:text-white data-[active]:data-[selected]:underline")},m(h)),{},{children:d.jsx(Ke,{i18nKey:"form:select.createOption",values:{query:(x=h.value)!==null&&x!==void 0?x:h},components:[d.jsx("strong",{children:"query"},"t0")]})}),g):d.jsx("div",Ce(Ce({role:"none",tabIndex:p===g?0:-1,ref:function(y){return O(g,y)},"data-active":p===g?!0:void 0,className:W("block text-start truncate px-2 py-1 leading-normal cursor-pointer","data-[active]:bg-primary-200 data-[selected]:bg-primary-600 data-[selected]:text-white data-[active]:data-[selected]:underline")},m(h)),{},{children:M(h,(f=h[j])!==null&&f!==void 0?f:h)}),g)})]}),I&&d.jsx("div",{className:"px-2 py-1 text-sm bg-dimmed text-muted",children:I})]}))},fn=function(e){return e},gn=function(e,n){var r,u,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";return be(e)?e.map(function(b){var O;return(O=b[p])!==null&&O!==void 0?O:b}):(r=(u=e==null?void 0:e[p])!==null&&u!==void 0?u:e)!==null&&r!==void 0?r:n};function ar(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),n.push.apply(n,r)}return n}function L(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ar(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ar(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var mn=function(e){var n=e.options,r=n===void 0?$e:n,u=e.value,p=e.autoComplete,b=e.alwaysOpen,O=b===void 0?!1:b,w=e.defaultOpen,I=w===void 0?!1:w,F=e.multiple,j=F===void 0?!1:F,m=e.allowCreate,M=m===void 0?!1:m,k=e.groupProperty,h=k===void 0?"":k,g=e.valueProperty,x=g===void 0?"id":g,f=e.labelProperty,l=f===void 0?"label":f,y=e.sortProperty,D=e.createOption,$=D===void 0?fn:D,R=e.matcher,P=e.onQuery,E=e.onChange,B=e.onSelect,C=c.useMemo(function(){return j?[]:""},[j]),N=c.useDeferredValue(u??C),K=c.useRef([]),Oe=c.useRef(null),a=c.useRef([]),o=c.useRef([]),Q=c.useCallback(function(i,v){var A,Z;return(A=R==null?void 0:R(i,v))!==null&&A!==void 0?A:Xr((Z=i[l])!==null&&Z!==void 0?Z:i,v)},[R]),Pe=c.useCallback(function(i){setTimeout(function(){B==null||B(i??C),E==null||E(gn(i,C,x))},50)},[C,B,E]),pe=c.useReducer(function(i,v){if(v.type==="open"){var A=i.items.indexOf(i.multiple?i.value[0]:i.value);return L(L({},i),{},{open:!0,activeIndex:A>-1?A:null})}if(v.type==="close")return L(L({},i),{},{activeIndex:null,activeItem:null,open:!1});if(v.type==="active"&&i.open){var Z;return p&&v.index!==null&&(i.query=i.items[v.index]),L(L({},i),{},{activeIndex:v.index,activeItem:i.items[(Z=v.index)!==null&&Z!==void 0?Z:-1]})}if(v.type==="setValue")return L(L({},i),{},{value:v.value,selectedIndex:i.items.indexOf(i.multiple?v.value[0]:v.value)});if(v.type==="changeValue"){var J,q=L(L({},i),{},{value:i.emptyValue,activeIndex:null,activeItem:null,selectedIndex:p?i.multiple?(J=v.value)===null||J===void 0?void 0:J.length:0:i.items.indexOf(v.value)});if(v.value!==void 0)if(j){var te=[];ir(v.value)?te.push.apply(te,U(v.value.split(/,\s?/))):te.push(v.value),q.value=U(i.value),te.forEach(function(ae){var ue,me;q.value=(ue=(me=q.value).includes)!==null&&ue!==void 0&&ue.call(me,ae)?q.value.filter(function(xe){return xe!==ae}):[].concat(U(q.value),[ae])})}else q.value=v.value;return i.multiple||(q.open=O),Pe(q.value),q}if(v.type==="removeItem"){var Y=i.value;if(i.multiple){var ge;Y=U(Y),Y.splice((ge=v.index)!==null&&ge!==void 0?ge:-1,1)}else Y="";return Pe(Y),L(L({},i),{},{value:Y})}if(v.type==="startQuery")return L(L({},i),{},{loading:!0,query:v.query});if(v.type==="options"){var G=L(L({},i),{},{loading:!1,query:v.query}),ye=U(v.options);p&&v.query!==void 0&&(ye=Ue([v.query].concat(U(ye)))),y&&(ye=ye.sort(Zr("asc",y)));var Fe=_r(ye,h,"");if(v.open&&(G.open=!0),G.items=[],M&&v.query&&G.items.push({___create___:!0,value:v.query}),Object.entries(Fe).forEach(function(ae){var ue,me=re(ae,2),xe=me[0],Re=me[1];xe&&G.items.push({___group___:!0,label:xe}),(ue=G.items).push.apply(ue,U(Re))}),v.setActive){var je=G.items.findIndex(function(ae){return!ae.___group___});G.activeIndex=je>=0?je:null}else G.activeIndex=null;return a.current=G.items,G}return i},{multiple:j,emptyValue:C,open:O||I,loading:!1,activeIndex:null,activeItem:null,selectedIndex:null,value:C,query:void 0,items:[]}),ie=re(pe,2),z=ie[0],s=ie[1];c.useEffect(function(){if(!j){var i,v=(M||p)&&N?$(N):void 0,A=r.find(function(J){var q;return((q=J[x])!==null&&q!==void 0?q:J)===N});o.current=r,!A&&v&&(o.current=[v].concat(U(r??[]))),s({type:"options",options:o.current}),s({type:"setValue",value:(i=A??v)!==null&&i!==void 0?i:N})}if(j){o.current=[];var Z=(be(N)?N:[]).map(function(J){var q,te=(M||p)&&J?$(J):void 0,Y=r.find(function(ge){var G;return((G=ge[x])!==null&&G!==void 0?G:ge)===J});return!Y&&te&&o.current.push(te),(q=Y??te)!==null&&q!==void 0?q:J});o.current=[].concat(U(o.current),U(r??[])),s({type:"options",options:o.current}),s({type:"setValue",value:Z})}},[N,r,j,M,p,$]);var ve=He(function(i){Promise.resolve(P==null?void 0:P(i)).then(function(v){var A=U(v);p&&A.push.apply(A,U(o.current.filter(function(Z){return Q==null?void 0:Q(Z,i)}))),s({type:"options",query:i,options:A,open:!0,setActive:!0})})},[P],300),le=c.useCallback(function(i){if(!i)s({type:"options",query:"",options:o.current});else{if(P)return s({type:"startQuery",query:i}),ve(i);s({type:"options",query:i,open:!0,setActive:!0,options:o.current.filter(function(v){return Q==null?void 0:Q(v,i)})})}},[Q,P]),he=c.useCallback(function(i){var v=i;if(p&&j&&i&&(v=i.split(/,\s?/)),s({type:"changeValue",value:i!=null&&i.___create___?i.value:i}),i!=null&&i.___create___){var A=[i.value];j&&(A=i.value.split(/,\s?/)),o.current=[].concat(U(o.current),U(A.map($)))}p&&(o.current=Ue([].concat(U(be(v)?v:[v]),U(o.current)))),s({type:"options",options:o.current})},[]),Se=c.useCallback(function(i){s({type:"removeItem",index:i})},[]),ee=c.useCallback(function(i){s({type:i?"open":"close"}),s({type:"options",query:void 0,options:o.current})},[]),fe=c.useCallback(function(i){i&&i>-1&&s({type:"active",index:i})},[]);return{state:z,listRef:K,focusableRef:Oe,listContentRef:a,handleChange:he,handleRemove:Se,handleQuery:le,macthOption:Q,setActiveIndex:fe,setOpen:ee,setItemRef:function(v,A){K.current[v]=A}}},hn=["ref","name","value","invalid","readOnly","disabled","required","placeholder","autoFocus","error","options","defaultOpen","hideHandle","groupProperty","labelProperty","valueProperty","sortProperty","infoProperty","multiple","searchable","allowCreate","emptyDisplay","createOption","matcher","renderer","onQuery","onChange","onSelect","onEnterPressed"];function or(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),n.push.apply(n,r)}return n}function ce(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?or(Object(n),!0).forEach(function(r){oe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):or(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Ln=function(e){var n,r,u,p=e.ref,b=e.name,O=e.value,w=e.invalid,I=e.readOnly,F=e.disabled,j=e.required,m=e.placeholder,M=e.autoFocus,k=e.error,h=e.options,g=e.defaultOpen,x=e.hideHandle,f=e.groupProperty,l=e.labelProperty,y=l===void 0?"label":l,D=e.valueProperty,$=D===void 0?"id":D,R=e.sortProperty,P=e.infoProperty,E=e.multiple,B=e.searchable,C=e.allowCreate,N=e.emptyDisplay,K=e.createOption,Oe=e.matcher,a=e.renderer,o=e.onQuery,Q=e.onChange,Pe=e.onSelect,pe=e.onEnterPressed,ie=de(e,hn),z=mn({value:O,options:h,multiple:E,defaultOpen:g,groupProperty:f,labelProperty:y,valueProperty:$,sortProperty:R,allowCreate:C,createOption:K,matcher:Oe,onChange:Q,onSelect:Pe,onQuery:o}),s=z.state,ve=z.listRef,le=z.listContentRef,he=z.setOpen,Se=z.macthOption,ee=z.handleChange,fe=z.handleRemove,i=z.handleQuery,v=z.setItemRef,A=z.setActiveIndex,Z=c.useId(),J=qr({open:s.open,onOpenChange:function(H,S,V){!H&&(ve.current=[]),he(H)},strategy:"fixed",placement:"bottom",whileElementsMounted:gr,middleware:[Vr({padding:8}),Br(),Yr(2)]}),q=J.context,te=J.floatingStyles,Y=J.refs,ge=Kr(q,{}),G=Qr(q,{}),ye=zr(q,{listRef:ve,activeIndex:s.activeIndex,selectedIndex:s.selectedIndex,loop:!0,virtual:!0,focusItemOnOpen:!1,onNavigate:A}),Fe=Ur(q,{listRef:le,activeIndex:s.activeIndex,selectedIndex:s.selectedIndex,findMatch:function(H,S){return H.find(function(V){return Se(V,S)})},onMatch:function(H){s.open&&A(H),!B&&!E&&!s.open&&ee(le.current[H])}}),je=Gr([G,B?void 0:ge,ye,Fe]),ae=je.getReferenceProps,ue=je.getFloatingProps,me=je.getItemProps,xe=c.useMemo(function(){var T=ae();return ce(ce({},T),{},{onBlur:function(S){var V;if((V=S.relatedTarget)!==null&&V!==void 0&&V.closest('[data-select-dropdown="'.concat(Z,'"]'))){var ne;(ne=Y.domReference.current)===null||ne===void 0||(ne=ne.querySelector("input"))===null||ne===void 0||ne.focus();return}i(""),he(!1)},onKeyDown:function(S){if(S.key==="Enter"){if(s.activeIndex!==null)return ee(le.current[s.activeIndex]),S.preventDefault(),S.stopPropagation(),!1;if(s.query)return i(""),S.preventDefault(),S.stopPropagation(),!1;pe==null||pe(S)}else S.key==="Tab"&&s.activeIndex!==null?ee(le.current[s.activeIndex]):S.key==="Backspace"?!s.query&&fe():(!B||["ArrowUp","ArrowDown"].includes(S.key))&&(["ArrowUp","ArrowDown"].includes(S.key)&&s.activeIndex===null&&A(s.selectedIndex),setTimeout(function(){var V;(V=T.onKeyDown)===null||V===void 0||V.call(T,S)},50))}})},[ae,pe,i,Y,s.query,s.activeIndex]),Re=c.useMemo(function(){return ue({"data-select-dropdown":Z})},[ue]),sr=c.useCallback(function(T){var H,S,V=be(s.value)?(H=s.value)===null||H===void 0||(S=H.includes)===null||S===void 0?void 0:S.call(H,T):s.value===T;return me({"data-selected":V?!0:void 0,onClick:function(){ee(T)}})},[me,ee,s.value]),cr=c.useMemo(function(){if(be(s.value))return s.value.map(function(S,V){var ne,Me;return d.jsx(Er,{onRemove:function(){return fe(V)},children:(ne=(Me=a==null?void 0:a(S))!==null&&Me!==void 0?Me:S[y])!==null&&ne!==void 0?ne:S},V)});if(!Te(s.value)&&!s.query){var T,H;return d.jsx("span",{className:"self-center pointer-events-none select-none",children:(T=(H=a==null?void 0:a(s.value))!==null&&H!==void 0?H:s.value[y])!==null&&T!==void 0?T:s.value})}},[s.value,s.query,m,a]),dr=c.useCallback(function(){var T;he(!0),(T=Y.domReference.current)===null||T===void 0||(T=T.querySelector("input"))===null||T===void 0||T.focus()},[]);return c.useLayoutEffect(function(){s.open&&setTimeout(function(){var T;s.selectedIndex&&((T=ve.current[s.selectedIndex])===null||T===void 0||T.scrollIntoView({block:"center"}))},100)},[s.open]),d.jsxs(ur,ce(ce({showClear:!Te(s.value),onClear:ee,invalid:w,readOnly:I,disabled:F,required:j,error:k,wrapperRef:Y.setReference,className:s.open?"!z-[99]":""},ie),{},{children:[d.jsxs("div",ce(ce({role:"none","data-select-display":"true",className:W("group flex-1 py-1 px-2 truncate text-start flex gap-1 relative min-h-5 justify-start",E?"flex-wrap":"flex-nowrap overflow-hidden")},xe),{},{onMouseUp:function(H){var S;return(S=H.currentTarget.querySelector("input"))===null||S===void 0?void 0:S.focus()},children:[cr,d.jsx("input",{readOnly:!B||I,disabled:F,value:(n=s.query)!==null&&n!==void 0?n:"","aria-invalid":w,"data-testid":b,name:b,size:1,ref:p,autoFocus:M,className:W("appearance-none bg-transparent outline-none border-none ring-0 flex-1 peer",F&&"cursor-not-allowed pointer-events-none",E&&"min-w-24"),placeholder:Te(s.value)?m:"",onChange:function(H){return i(H.target.value)}})]})),!s.loading&&!x&&d.jsx(Ae,{className:W("flex-content p-2 z-0 order-9 text-muted cursor-pointer self-stretch flex items-center h-auto",s.open&&"-scale-y-100 pointer-events-none",F&&"pointer-events-none"),onClick:function(){return!F&&dr()},icon:Be.chevronDown}),s.loading&&d.jsx(Ae,{animate:"spin",className:W("flex-content p-2 z-0 order-9 text-muted pointer-events-none"),icon:Be.spinner}),s.open&&!s.loading&&d.jsx(Lr,{children:d.jsx(Wr,{context:q,initialFocus:-1,visuallyHiddenDismiss:!0,children:d.jsx(vn,ce(ce({ref:Y.setFloating,className:"outline shadow-lg max-h-[40vh] z-(--z-popover)",style:ce({width:(r=Y.reference.current)===null||r===void 0?void 0:r.getBoundingClientRect().width},te)},Re),{},{items:s.items,active:s.activeIndex,valueProperty:$,labelProperty:y,itemRef:v,itemProps:sr,empty:N,info:(u=s.activeItem)===null||u===void 0?void 0:u[P??"info"],children:function(H,S){var V;return(V=a==null?void 0:a(H))!==null&&V!==void 0?V:S}}))})})]}))};export{Yn as C,Qn as E,Un as F,Gn as N,vn as O,zn as R,Ln as S,Bn as T,Kn as a,rn as b,mn as u};
