import{sb as G,f9 as S,b as v,bR as E,oX as L,cl as M,b0 as D,eZ as B,E as h,F as p,V as b,no as $,tT as P,g_ as H,tU as U,tV as N,sV as Q,ls as T,ix as V,sW as A,t7 as J,ar as q,tW as W,tX as z,tY as j,tZ as X,b6 as Z,ot as Y,n_ as K,ah as ee,bl as re,ew as te,bj as k,el as ne,bn as se}from"./ShadowCastClear.glsl.js";import{t as ie}from"./FeatureLayerViewBase3D.js";import{i as ae}from"./AttributeBinsFeatureSet.js";import{n as oe}from"./utils9.js";import{F as de}from"./LodRenderer.js";import{s as C}from"./highlightUtils.js";import"./iframe-qDaPDssc.js";import"./index.js";import"./Viewport.js";import"./debounce.js";import"./index2.js";import"./Section.js";import"./ErrorBoundary.js";import"./createClass.js";import"./Global.js";import"./useIsDark.js";import"./HeatmapDensity.glsl.js";import"./timeSupport.js";import"./AttributeBinsQuery.js";import"./queryUtils.js";import"./FixedIntervalBinParameters.js";import"./attributeUtils.js";import"./highlightOptionsUtils.js";import"./FeatureTileDescriptor.js";import"./dehydratedFeatureComparison.js";import"./queryForSymbologySnapping.js";import"./Graphics3DFeatureProcessor.js";import"./hash.js";import"./renderingInfoUtils.js";import"./ExtentSet.js";import"./rendererConversion.js";import"./optimizedFeatureQueryEngineAdapter.js";import"./popupUtils.js";import"./Graphics3DObjectStates.js";import"./floorFilterUtils.js";import"./QueryEngine.js";import"./WhereClauseCache.js";import"./WhereClause.js";import"./timeSupport2.js";import"./utils.js";import"./utils2.js";import"./ClassBreaksDefinition.js";import"./SnappingCandidate.js";import"./featureServiceUtils.js";import"./FeatureStore.js";import"./BoundsStore.js";import"./heatmapTextureUtils.js";import"./LayerView3D.js";import"./EventedSet.js";import"./FeatureLayerView.js";import"./FeatureIdInfo.js";import"./constants2.js";import"./featurePopupQueryUtils.js";import"./LayerView.js";import"./RefreshableLayerView.js";let m=class extends G{constructor(e){super(e),this.schedule=null,this._workerUpdating=!0}get updating(){return this._workerUpdating}get _graphicOrigin(){const e=this.layer.graphicOrigin;if(!S(e))throw new v("featurelayerview3d:invalid-graphic-origin","Layer's graphic origin is not a FeatureGraphicOrigin");return e}initialize(){const{layer:e,layerView:r,viewSpatialReference:t,renderSpatialReference:n}=this,i=e.elevationInfo;this._elevationContext=E.fromElevationInfo(i),this._workerHandle=new le(this.schedule,{createTexture:async({data:s,parameters:a})=>({result:await this.renderer.createTexture(s,a),transferList:[]}),releaseTexture:async({uid:s})=>(await this.renderer.releaseTexture(s),g),createMaterial:async({materialJSON:s})=>(await this.renderer.createMaterial(s),g),destroyMaterial:async({materialId:s})=>(await this.renderer.destroyMaterial(s),g),createDirectRenderer:async({materialId:s})=>(await this.renderer.createDirectRenderer(s),g),destroyDirectRenderer:async({materialId:s})=>(await this.renderer.destroyDirectRenderer(s),g),createLoDRenderer:async({rendererId:s,lodRenderGeometry:a},o)=>(await this.renderer.createLoDRenderer(s,a,(o==null?void 0:o.signal)??void 0),g),destroyLoDRenderer:async({rendererId:s},a)=>(await this.renderer.destroyLoDRenderer(s,(a==null?void 0:a.signal)??void 0),g),dispatchRenderCommands:async({commands:s})=>(await this.renderer.executeRenderCommands(s),g),applyElevationAlignment:async({mapPoints:s})=>{const{viewSpatialReference:a,elevationProvider:o,renderCoordsHelper:d}=this,l=oe(s,a,this._elevationContext,o,d);return{result:l,transferList:[l.buffer]}},setBaseInstance:async({rendererId:s,baseInstance:a})=>(this.renderer.setBaseInstance(s,a),g)}),this.addResolvingPromise((async()=>{var o,d,l,c;await e.load();const s={url:((o=e.parsedUrl)==null?void 0:o.path)??"",baseQuery:e.createQuery().toJSON(),objectIdField:e.objectIdField,capabilities:e.capabilities,fieldIndex:e.fieldsIndex.toJSON(),timeInfo:(d=e.timeInfo)==null?void 0:d.toJSON(),elevationInfo:i==null?void 0:i.toJSON(),fullExtent:(l=e.fullExtent)==null?void 0:l.toJSON(),renderer:(c=e.renderer)==null?void 0:c.toJSON()},a={fullOpacity:r.fullOpacity};await this._workerHandle.invokeMethod("setup",{viewSpatialReference:t.toJSON(),renderSpatialReference:n.toJSON(),viewingMode:this.viewingMode,layerInfo:s,layerViewInfo:a})})()),this.addHandles(this._workerHandle.on("notify-updating",({updating:s})=>{this._workerUpdating=s}))}onTileTreeChange(e){this._workerHandle.invokeMethod("onTileTreeChange",{tiles:e.items.map(ue)})}onElevationChange(e){var r;this._workerHandle.invokeMethod("onElevationChange",{context:e.context,spatialReference:(r=e.spatialReference)==null?void 0:r.toJSON(),extent:L(e.extent)})}onLayerViewOpacityChange(e){this._workerHandle.invokeMethod("onLayerViewOpacityChange",e)}onRendererChange(e){const r=e==null?void 0:e.toJSON();this._workerHandle.invokeMethod("onRendererChange",r)}async executeQuery(e,r){const t=await this._workerHandle.invokeMethod("executeQuery",e==null?void 0:e.toJSON(),r),n=M.fromJSON(t);return this._ensureLayerOnFeatures(n),n}async executeQueryForIds(e,r){return await this._workerHandle.invokeMethod("executeQueryForIds",e==null?void 0:e.toJSON(),r)}async executeQueryForCount(e,r){return await this._workerHandle.invokeMethod("executeQueryForCount",e==null?void 0:e.toJSON(),r)}async executeQueryForExtent(e,r){const{count:t,extent:n}=await this._workerHandle.invokeMethod("executeQueryForExtent",e==null?void 0:e.toJSON(),r);return{count:t,extent:D.fromJSON(n)}}async executeQueryForLatestObservations(e,r){const t=await this._workerHandle.invokeMethod("executeQueryForLatestObservations",e==null?void 0:e.toJSON(),r),n=M.fromJSON(t);return this._ensureLayerOnFeatures(n),n}async executeAttributeBinsQuery(e,r){const t=await this._workerHandle.invokeMethod("executeAttributeBinsQuery",e.toJSON(),r);return ae.fromJSON(t)}_ensureLayerOnFeatures(e){const{layer:r,_graphicOrigin:t}=this;for(const n of e.features)n.layer=r,n.sourceLayer=r,n.origin=t}};h([p()],m.prototype,"updating",null),h([p({constructOnly:!0})],m.prototype,"schedule",void 0),h([p({constructOnly:!0})],m.prototype,"layer",void 0),h([p({constructOnly:!0})],m.prototype,"layerView",void 0),h([p({constructOnly:!0})],m.prototype,"viewSpatialReference",void 0),h([p({constructOnly:!0})],m.prototype,"renderSpatialReference",void 0),h([p({constructOnly:!0})],m.prototype,"viewingMode",void 0),h([p({constructOnly:!0})],m.prototype,"renderer",void 0),h([p({constructOnly:!0})],m.prototype,"elevationProvider",void 0),h([p({constructOnly:!0})],m.prototype,"renderCoordsHelper",void 0),h([p()],m.prototype,"_workerUpdating",void 0),h([p()],m.prototype,"_graphicOrigin",null),m=h([b("esri.views.3d.layers.graphics.pipeline.Feature3DPipelineWorkerHandle")],m);let le=class extends B{constructor(r,t){super("Feature3DPipelineWorker","setup",{},r,{strategy:"dedicated",client:t})}};function ue({id:e,lij:r,extent:t}){return{id:e,lij:r,extent:t}}const g={result:void 0};let I=class extends ${constructor(e){super(e),this._glMaterials=null,this._produces=new Map,this._renderGeometries=new Map,this._renderContext=null,this._drawParameters=new P,this._bufferWriter=null,this._baseInstance=null,this.slicePlaneEnabled=!1,this.isGround=!1,this.type=e.material instanceof H?1:4,this.layerViewUid=e.layerViewUid}get produces(){return this._produces}get numFeatures(){let e=0;return this._renderGeometries.forEach(r=>e+=r.numElements),e}get usedMemory(){let e=0;return this._renderGeometries.forEach(r=>{e+=r.vao.usedMemory}),e}intersect(e,r,t,n){const{material:i,_bufferWriter:s,layerViewUid:a,_renderGeometries:o}=this;s.intersect!=null&&o.forEach(({buffer:d,localOrigin:l,items:c})=>s.intersect(d.data,i.parameters,l,e,t,n,(u,y,w,f)=>{if(!c.visibilities[w])return;const R=c.objectIds[w];e.handleObjectIntersection({object:{id:N,graphicUid:R,layerViewUid:a,boundingVolumeWorldSpace:new U,geometries:[{material:i}]},geometryId:0,primitiveIndex:w},u,y,null,f)}))}initialize(){this._bufferWriter=this.material.createBufferWriter(),this.material.produces.forEach((e,r)=>{this._produces.set(r,t=>t!==9&&t!==5&&e(t))})}destroy(){var r;this._glMaterials.dispose();const e=this._renderGeometries.keys();for(const t of e)this.removeRenderGeometryBuffer(t);(r=this._baseInstance)==null||r.vbo.dispose(),this._baseInstance=null}acquireTechniques(e){const r=this.material;if(!r.shouldRender(e))return null;const{output:t,bind:n}=e,i=r.produces.get(n.slot);if(!(i!=null&&i(t))||t===9||t===5)return null;const s=this._glMaterials.load(e.rctx,n.slot,t);return s==null?void 0:s.beginSlot(n)}render(e,r){const t=this._renderGeometries;if(t.size===0)return;const{bind:n}=e,i=n.slot===10||n.slot===11?n.slot:null,s=e.rctx;s.runAppleAmdDriverHelper(),s.bindTechnique(r,n,this.material.parameters);const a=r.program,{_baseInstance:o}=this,d=o==null?l=>{s.drawArrays(r.primitiveType,l.start,l.count)}:(l,c)=>{J(s,c.locations,c.buffer("instances"),l.start),s.drawArraysInstanced(r.primitiveType,0,o.buffer.elementCount,l.count)};for(const[l,c]of t){const{vao:u,localOrigin:y,drawCalls:w}=c;this._drawParameters.origin=y,a.bindDraw(n,this.material.parameters,this._drawParameters),r.ensureAttributeLocations(u),s.bindVAO(u),s.setPipelineState(r.getPipeline(!1,i));for(const f of w)d(f,u)}}initializeRenderContext(e){this._glMaterials=new Q(this.material,e.materials),this._renderContext=e.renderContext}uninitializeRenderContext(){}addRenderGeometryBuffer(e,r,t,n){this.removeRenderGeometryBuffer(e);const{data:i,elementCount:s}=r,{_baseInstance:a,_bufferWriter:o,_renderContext:{rctx:d}}=this,l=a==null?o.layout:o.instanceLayout;if(!l)throw new Error("Cannot create instance buffer for non-instanced material");const c=new T(d,V(l,a==null?0:1),i);let u;u=new A(d,a==null?new Map([["geometry",c]]):new Map([["geometry",a.vbo],["instances",c]]));const y={localOrigin:n,numElements:s,buffer:r,items:t,vao:u,drawCalls:this._produceDrawCalls(t)};this._renderGeometries.set(e,y)}updateRenderGeometryBuffer(e,r,t,n){const{data:i,elementCount:s}=r,a=this._renderGeometries.get(e);if(a==null)return;const o=a.vao.buffer(this._baseInstance==null?"geometry":"instances");o==null||o.setSize(i.byteLength),o==null||o.setSubData(new Uint8Array(i),0,0,i.byteLength),a.localOrigin=n,a.numElements=s,a.buffer=r,a.items=t,a.drawCalls=this._produceDrawCalls(t)}removeRenderGeometryBuffer(e){var t;const r=this._renderGeometries.get(e);r!=null&&(this._baseInstance?((t=r.vao.buffer("instances"))==null||t.dispose(),r.vao.disposeVAOOnly()):r.vao.dispose(),this._renderGeometries.delete(e))}updateVisibility(e,r){const t=this._renderGeometries.get(e);if(t==null)return;const{items:n}=t;if(n.visibilities.length!==r.length)throw new Error("Unexpected mismatch between old and new visibility flag buffer length.");n.visibilities=r,t.drawCalls=this._produceDrawCalls(n)}setBaseInstance(e){var n;if((n=this._baseInstance)==null||n.vbo.dispose(),e==null)return void(this._baseInstance=null);const{data:r}=e,t=new T(this._renderContext.rctx,V(this._bufferWriter.layout),r);this._baseInstance={buffer:e,vbo:t}}hasHighlight(){return!1}_produceDrawCalls(e){const{visibilities:r,ranges:t}=e,n=[];if(ce(t)){if(t.numItems===0)return[];const i=t.numVertices;let s=null;for(let a=0;a<t.numItems;++a)r[a]?s==null?(s={start:a*i,count:i},n.push(s)):s.count+=i:s=null}else{const i=t.counts,s=i.length;if(s===0)return[];let a=null,o=0;for(let d=0;d<s;++d){const l=r[d],c=i[d];l?a==null?(a={start:o,count:c},n.push(a)):a.count+=c:a=null,o+=c}}return n}};function ce(e){return"numItems"in e}h([p({constructOnly:!0})],I.prototype,"material",void 0),I=h([b("esri.views.3d.layers.graphics.pipeline.rendering.DirectRenderer")],I);let F=class{constructor(e){this._instanceGroupToIndices=new Map,this._instanceIndexToFeatureId=new Map,this._disposeResourceHandles=new Array,this._lodRendererResources=null,this._numFeatures=0,this.layerViewUid=e.layerViewUid,this.view=e.view,this.sharedResources=this.view.sharedSymbolResources,this.scheduler=this.view.resourceController.scheduler}get numFeatures(){return this._numFeatures}get usedMemory(){var t;const e=(t=this._lodRendererResources)==null?void 0:t.lodRenderer,r=e==null?void 0:e.symbol;return((r==null?void 0:r.computeUsedMemory())??0)+16*this._instanceIndexToFeatureId.size}destroy(){this._disposeResourceHandles.forEach(e=>e())}async doLoad(e,r,t){const n=he(d=>r(d),e),i=this.view.stage,s=n.getMaterials(),a=n.getTextures();i.addTextures(a),this._addDisposeResource(()=>{a.forEach(d=>d.unload()),i.removeTextures(a)}),await Promise.all(a.map(d=>this.view.stage.schedule(()=>d.load(i.renderView.renderingContext),t))),q(t);const o=await this._createLodRenderer(n,t);this._lodRendererResources={lodRenderer:o,materials:s,textures:a}}addInstances(e,r){const t=this._lodRendererResources;if(t==null)return;const n=t.lodRenderer;if(n==null)return;const{featureIds:i,localTransforms:s,globalTransforms:a,visibility:o}=r,d=new Array,l=n.instanceData,c=i.length,u=this._instanceIndexToFeatureId;for(let y=0;y<c;++y){const w=i[y],f=l.addInstance(),R=l.view,O=16*y;R.localTransform.copyFromTypedBuffer(f,s,O),R.globalTransform.copyFromTypedBuffer(f,a,O),l.updateModelTransform(f),l.setVisible(f,!!o[y]),d.push(f),u.set(f,w)}this._instanceGroupToIndices.set(e,d),this._numFeatures+=c}removeInstances(e){const r=this._instanceGroupToIndices.get(e);if(r==null)return;const t=this._lodRendererResources;if(t==null)return;const n=t.lodRenderer.instanceData,i=this._instanceIndexToFeatureId;for(const s of r)n.removeInstance(s),i.delete(s);this._numFeatures-=r.length,this._instanceGroupToIndices.delete(e)}updateVisibility(e,r){const t=this._instanceGroupToIndices.get(e);if(t==null)return;const n=this._lodRendererResources;if(n==null)return;const i=t.length;if(i!==r.length)throw new Error("Unexpected mismatch instance count and visibility flag buffer length.");const s=n.lodRenderer.instanceData;for(let a=0;a<i;++a)s.setVisible(t[a],!!r[a])}updateGlobalTransforms(e,r){const t=this._instanceGroupToIndices.get(e);if(t==null)return;const n=this._lodRendererResources;if(n==null)return;const i=t.length;if(16*i!==r.length)throw new Error("Unexpected mismatch instance count and visibility flag buffer length.");const s=n.lodRenderer.instanceData,a=s.view;for(let o=0;o<i;++o){const d=t[o],l=16*o;a.globalTransform.copyFromTypedBuffer(d,r,l),s.updateModelTransform(d)}}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createLodRenderer(e,r){const t=this.view.stage,n={layerViewUid:this.layerViewUid,graphicUid:s=>this._instanceIndexToFeatureId.get(s)??-1,notifyGraphicGeometryChanged:s=>1,notifyGraphicVisibilityChanged:s=>1},i=new de({symbol:e,metadata:n,shaderTransformation:null},this.scheduler);return i.slicePlaneEnabled=!1,this._addDisposeResource(()=>{t.removeRenderPlugin(i),i.destroy()}),await t.addRenderPlugin(i,r),i}};function he(e,r){const t=r.levels.map(n=>{const i=n.components.map(s=>{const a=e(s.materialId);if(!pe(a))throw new Error("LodRenderer only supports DefaultMaterial");const o=new W(a,s.renderGeometryBuffer.data,s.renderGeometryBuffer.elementCount,s.boundingInfo);return new z(o)});return new j(i,n.minScreenSpaceRadius)});return new X(t)}function pe(e){return e!=null&&"materialType"in e&&e.materialType==="default"}F=h([b("esri.views.3d.layers.graphics.pipeline.rendering.LodRenderer")],F);let x=class extends Z{constructor(e){super(),this.view=null,this.layerViewUid=null,this._stage=null,this._materials=new Map,this._textures=new Map,this._directRenderers=new Map,this._lodRenderers=new Map,this.totalFeatures=0,this.view=e.view,this.layerViewUid=e.layerViewUid}initialize(){this._stage=this.view.stage}destroy(){this.removeAllHandles(),this._lodRenderers.forEach(e=>e.destroy())}async createTexture(e,r){const{_textures:t,_stage:n}=this,i=new Y(e,r);return t.set(i.id,i),n&&(i.load(n.renderView.renderingContext),n.addTexture(i)),i.id}async releaseTexture(e){const{_textures:r,_stage:t}=this,n=r.get(e);n&&(t&&(n.unload(),t.removeTexture(n)),r.delete(e))}_destroyTexture(e){const{_textures:r,_stage:t}=this,n=r.get(e);n&&(t&&(n.unload(),t.removeTexture(n)),r.delete(e))}async createMaterial(e){const{view:r}=this,t=r.state.viewingMode===1;let n=null;switch(e.type){case"default":{const i=e.parameters,s=new K(i,{spherical:t});s.setParameters({cullFace:s.transparent?0:2}),n=s;break}case"hud":{const i=e.parameters;n=new H(i,t)}}this._materials.set(e.materialId,n)}async destroyMaterial(e){this._materials.delete(e)}async updateMaterial(e){}async createDirectRenderer(e){if(this._directRenderers.has(e))return;const r=this._materials.get(e);if(r==null)throw new Error(`material not found ${e}`);const{view:t}=this,n=new I({material:r,layerViewUid:this.layerViewUid});this._directRenderers.set(e,n),t.stage.addRenderPlugin(n),t.stage.renderView.renderer.updateHasFlags()}setBaseInstance(e,r){const t=this._directRenderers.get(e);if(t==null)throw new Error(`renderer not found ${e}`);t.setBaseInstance(r)}async destroyDirectRenderer(e){const r=this._directRenderers.get(e);if(r==null)return;const t=this.view;t.stage.removeRenderPlugin(r),this._directRenderers.delete(e),t.stage.renderView.renderer.updateHasFlags()}async createLoDRenderer(e,r,t){const n=new F({view:this.view,layerViewUid:this.layerViewUid}),i=s=>this._materials.get(s);if(await n.doLoad(r,i,t),t==null?void 0:t.aborted)throw n.destroy(),ee();this._lodRenderers.set(e,n)}async destroyLoDRenderer(e,r){const t=this._lodRenderers.get(e);t!=null&&(t.destroy(),this._lodRenderers.delete(e))}_destroyLodRenderer({rendererId:e}){const r=this._lodRenderers.get(e);r!=null&&(r.destroy(),this._lodRenderers.delete(e))}async executeRenderCommands(e){for(const r of e)switch(r.id){case"destroy-texture":this._destroyTexture(r.textureId);break;case"update-material":this._updateMaterial(r);break;case"destroy-material":this._destroyMaterial(r);break;case"add-direct-renderer-geometry-buffer":this._addDirectRendererGeometryBuffer(r);break;case"update-direct-renderer-geometry-buffer":this._updateDirectRendererGeometryBuffer(r);break;case"remove-direct-renderer-geometry-buffer":this._removeDirectRendererGeometryBuffer(r);break;case"destroy-lod-renderer":this._destroyLodRenderer(r);break;case"add-lod-instances":this._addLodInstances(r);break;case"remove-lod-instances":this._removeLodInstances(r);break;case"update-lod-instance-data":this._updateLodInstanceData(r);break;case"update-visibility":this._updateVisibility(r)}e.length>0&&this._updateFeatureCount()}_updateFeatureCount(){let e=0;for(const r of this._directRenderers.values())e+=r.numFeatures;for(const r of this._lodRenderers.values())e+=r.numFeatures;this._set("totalFeatures",e)}get usedMemory(){let e=0;for(const r of this._directRenderers.values())e+=r.usedMemory;for(const r of this._lodRenderers.values())e+=r.usedMemory;return e}_updateMaterial({materialId:e,parameters:r}){const t=this._materials.get(e);t!=null?t.setParameters(r):console.error("material not found")}_destroyMaterial({materialId:e}){this._materials.get(e)!=null?this._materials.delete(e):console.error("material not found")}_addDirectRendererGeometryBuffer({groupId:e,rendererId:r,renderGeometryBuffer:t,renderGeometryBufferItems:n,localOrigin:i}){const s=this._directRenderers.get(r);s!=null?(s.addRenderGeometryBuffer(e,t,n,i),this.view.stage.renderView.requestRender()):console.error("no renderer assigned to provided material")}_updateDirectRendererGeometryBuffer({groupId:e,rendererId:r,renderGeometryBuffer:t,renderGeometryBufferItems:n,localOrigin:i}){const s=this._directRenderers.get(r);s!=null?(s.updateRenderGeometryBuffer(e,t,n,i),this.view.stage.renderView.requestRender()):console.error("no renderer assigned to provided material")}_removeDirectRendererGeometryBuffer({groupId:e,rendererId:r}){const t=this._directRenderers.get(r);t!=null?(t.removeRenderGeometryBuffer(e),this.view.stage.renderView.requestRender()):console.error("no renderer assigned to provided material")}_addLodInstances({rendererId:e,groupId:r,data:t}){const n=this._lodRenderers.get(e);if(n==null)throw new Error("no lod renderer assigned to provided lod renderer Id");n.addInstances(r,t),this.view.stage.renderView.requestRender()}_removeLodInstances({rendererId:e,groupId:r}){const t=this._lodRenderers.get(e);if(t==null)throw new Error("no lod renderer assigned to provided lod renderer Id");t.removeInstances(r),this.view.stage.renderView.requestRender()}_updateLodInstanceData({rendererId:e,groupId:r,globalTransforms:t}){const n=this._lodRenderers.get(e);if(n==null)throw new Error("No renderer found with the provided id");t!=null&&n.updateGlobalTransforms(r,t),this.view.stage.renderView.requestRender()}_updateVisibility({rendererId:e,groupId:r,visibility:t}){const n=this._directRenderers.get(e)??this._lodRenderers.get(e);if(n==null)throw new Error("No renderer found with the provided id");n.updateVisibility(r,t),this.view.stage.renderView.requestRender()}};h([p({readOnly:!0})],x.prototype,"totalFeatures",void 0),x=h([b("esri.views.3d.layers.graphics.pipeline.rendering.FeaturePipelineRenderManager")],x);let _=class extends G{constructor(e){super(e),this._renderer=null,this.graphicsQuery={queryForSymbologySnapping:(r,t)=>{throw new v("featurelayer:unsupported-symbology-snapping","Symbology snapping not supported")},executeQuery:async(r,t)=>await this._workerHandle.executeQuery(r,t),executeQueryForIds:async(r,t)=>await this._workerHandle.executeQueryForIds(r,t),executeQueryForCount:async(r,t)=>await this._workerHandle.executeQueryForCount(r,t),executeQueryForExtent:async(r,t)=>await this._workerHandle.executeQueryForExtent(r,t),executeQueryForLatestObservations:async(r,t)=>await this._workerHandle.executeQueryForLatestObservations(r,t),executeAttributeBinsQuery:async(r,t)=>this._workerHandle.executeAttributeBinsQuery(r,t)},this.maximumNumberOfFeatures=1e3}initialize(){if(this.layerView.layer.geometryType!=="point")throw new v("featurelayer:unsupported-geometry-type",`${this.layerView.layer.geometryType} is not supported`);this.addResolvingPromise(this.setup())}destroy(){this.removeAllHandles(),this._workerHandle.destroy(),re(this._renderer)}async setup(){const e=this.layerView,{layer:r,view:t,uid:n}=e,{spatialReference:i,renderSpatialReference:s,resourceController:a,renderCoordsHelper:o,elevationProvider:d}=t,l=t.state.viewingMode;if(this._renderer=new x({view:t,layerViewUid:n}),r.type!=="feature")throw new v("featurelayer:unsupported-layertype","Only FeatureLayer is supported");const c=new m({schedule:u=>a.immediate.schedule(u),layer:r,layerView:e,viewSpatialReference:i,renderSpatialReference:s,viewingMode:l,renderer:this._renderer,elevationProvider:d,renderCoordsHelper:o});this._workerHandle=await c.when(),this.addHandles([this.layerView.view.enableFeatureTiles(),te(()=>{var u;return(u=this.layerView.view.featureTiles)==null?void 0:u.tiles},"change",u=>{this._workerHandle.onTileTreeChange(u.target)},{onListenerAdd:u=>this._workerHandle.onTileTreeChange(u),onListenerRemove:u=>this._workerHandle.onTileTreeChange(u)}),t.elevationProvider.on("elevation-change",u=>this._workerHandle.onElevationChange(u)),k(()=>this.layerView.fullOpacity,u=>this._workerHandle.onLayerViewOpacityChange(u),{sync:!1}),k(()=>r.renderer,u=>this._workerHandle.onRendererChange(u),{sync:!1})])}get legendEnabled(){return!1}get hasAllFeatures(){return!1}get hasAllFeaturesInView(){return!1}get hasFullGeometries(){return!1}get symbologySnappingSupported(){return!1}get scaleVisibilitySuspended(){return!1}get snappingComplexityExceeded(){return!1}get suspendInfo(){return{}}get updating(){return this._workerHandle.updating}get dataUpdating(){return!1}get updatePolicy(){return 0}get maximumNumberOfFeaturesExceeded(){return!1}get updatingProgressValue(){return 1}get usedMemory(){var e;return((e=this._renderer)==null?void 0:e.usedMemory)??0}get unloadedMemory(){return 0}get ignoresMemoryFactor(){return!0}get totalFeatures(){var e;return((e=this._renderer)==null?void 0:e.totalFeatures)??0}get performanceInfo(){const e=this.totalFeatures;return new ie(new ne(this.usedMemory,e,e,this.maximumNumberOfFeatures,0,null),e,e,this.maximumNumberOfFeaturesExceeded,"tiles","n/a")}get suspendResumeExtentMode(){return"computed"}forEachGraphic(e){}findGraphic(e){return null}highlightByObjectIds(e,r){return C}highlightByGraphics(e,r){return C}maskOccludee(e){return se()}async whenGraphicBounds(e,r){return null}computeAttachmentOrigin(e,r){return null}elevationAlignPointsInFeatures(e,r){throw new v("featurelayer:unsupported-elevation-alignment","Elevation alignment not supported")}async doRefresh(e){}setVisibility(e,r){}getMissingAttributesForFeature(e){return null}getHydratedGeometry(e){return null}};h([p()],_.prototype,"layerView",void 0),h([p()],_.prototype,"updating",null),h([p()],_.prototype,"totalFeatures",null),_=h([b("esri.views.3d.layers.graphics.pipeline.Feature3DPipeline")],_);export{_ as Feature3DPipeline};
