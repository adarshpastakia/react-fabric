import{E as d,F as l,V as S,O as _,e$ as O,f0 as U,bn as x,es as H,l as I,eM as w}from"./ShadowCastClear.glsl.js";const h=Symbol(),T=$=>{const V=$;let s=class extends V{constructor(...e){super(...e),this.layerViews=new _,this._debouncedUpdate=O(async()=>{const{layer:t,parent:a}=this,i=a==null?void 0:a.footprintLayerView;let n=[];const u=this._createQuery();if(u&&i){const{features:c}=await i.queryFeatures(u);this.suspended||(n=c.map(p=>t.acquireLayer(p)))}this.removeHandles(h),this.addHandles(n,h)})}get creatingLayerViews(){var e;return((e=this.view)==null?void 0:e.layerViewManager.isCreatingLayerViewsForLayer(this.layer))??!1}isUpdating(){return this.creatingLayerViews||this.layer.updating||this.layerViews.some(e=>e.updating)}enableLayerUpdates(){return U([this._updatingHandles.addWhen(()=>{var e,t;return((t=(e=this.parent)==null?void 0:e.footprintLayerView)==null?void 0:t.dataUpdating)===!1},()=>this.updateLayers()),this._updatingHandles.add(()=>{var e,t,a,i,n;return[this.layer.maximumVisibleSublayers,(e=this.layer.parent)==null?void 0:e.orderBy,(a=(t=this.parent)==null?void 0:t.footprintLayerView)==null?void 0:a.filter,(n=(i=this.parent)==null?void 0:i.footprintLayerView)==null?void 0:n.timeExtent,this.suspended]},()=>this.updateLayers()),x(()=>this.removeHandles(h))])}updateLayers(){this.suspended?this.removeHandles(h):this._updatingHandles.addPromise(H(this._debouncedUpdate()).catch(e=>{I.getLogger(this).error(e)}))}_createQuery(){var f,g;const e=(f=this.parent)==null?void 0:f.footprintLayerView,t=(g=this.layer)==null?void 0:g.parent;if(!e||!t||t.destroyed)return null;const{layer:{maximumVisibleSublayers:a},view:{scale:i}}=this;if(!a)return null;const{itemTypeField:n,itemSourceField:u,itemNameField:c,minScaleField:p,maxScaleField:L,objectIdField:F,orderBy:m}=t,v=w(`${p} IS NULL OR ${i} <= ${p} OR ${p} = 0`,`${L} IS NULL OR ${i} >= ${L}`),o=m==null?void 0:m.find(y=>y.field&&!y.valueExpression),r=e.createQuery();if(r.returnGeometry=!1,r.num=a,r.outFields=[F,u,c],r.where=w(r.where,v),this.unsupportedItemTypes!=null){const y=`${n} NOT IN (${this.unsupportedItemTypes.map(b=>`'${b}'`)})`;r.where=w(r.where,y)}return o!=null&&o.field&&(r.orderByFields=[`${o.field} ${o.order==="descending"?"DESC":"ASC"}`],r.outFields.push(o.field)),r}};return d([l({readOnly:!0})],s.prototype,"creatingLayerViews",null),d([l()],s.prototype,"layer",void 0),d([l()],s.prototype,"layerViews",void 0),d([l({readOnly:!0})],s.prototype,"unsupportedItemTypes",void 0),d([l()],s.prototype,"parent",void 0),d([l({readOnly:!0})],s.prototype,"isUpdating",null),s=d([S("esri.views.layers.CatalogDynamicGroupLayerView")],s),s};export{T as y};
