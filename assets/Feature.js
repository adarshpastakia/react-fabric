import{L as T,c9 as l,a5 as A,hf as S,k5 as k,dd as B,iH as H,ck as p,k4 as K,f_ as q,k2 as Q,kj as W,cj as X,ci as Y}from"./ShadowCastClear.glsl.js";import{j as z,t as c,p as N,B as ee,E as te,m as ie,V as L,f as Z,i as O,c as C,G as se,F as re}from"./Dictionary.js";function ae(e,i,s=null){const t=P(e,!0);if(t.hasm!==void 0&&(t.hasM=t.hasm,delete t.hasm),t.hasz!==void 0&&(t.hasZ=t.hasz,delete t.hasz),t.spatialreference!==void 0&&(t.spatialReference=t.spatialreference,delete t.spatialreference),t.spatialReference||(t.spatialReference=i),t.curverings!==void 0){const r=F(t.curverings,t.hasZ,t.hasM,G);if(r==null)return null;t.curveRings=r.arrays,delete t.curverings,delete t.rings,t.hasZ=r.hasZ,t.hasM=r.hasM}else if(t.rings!==void 0){const r=F(t.rings,t.hasZ,t.hasM,f);if(r==null)return null;t.rings=r.arrays,t.hasZ=r.hasZ,t.hasM=r.hasM}if(t.curvepaths!==void 0){const r=F(t.curvepaths,t.hasZ,t.hasM,G);if(r==null)return null;t.curvePaths=r.arrays,delete t.curvepaths,delete t.paths,t.hasZ=r.hasZ,t.hasM=r.hasM}else if(t.paths!==void 0){const r=F(t.paths,t.hasZ,t.hasM,f);if(r==null)return null;t.paths=r.arrays,t.hasZ=r.hasZ,t.hasM=r.hasM}if(t.points!==void 0){const r=pe(t.points,t.hasZ,t.hasM);if(r==null)return null;t.points=r.array,t.hasZ=r.hasZ,t.hasM=r.hasM}const a=T(t);if(s!=null&&(a==null?void 0:a.type)!==s)throw new l(null,"InvalidParameter",null);return a}function P(e,i=!1){const s={};for(const t of e.keys()){const a=i?t.toLowerCase():t,r=e.attributes[t];s[a]=z(r)?P(r):r}return s}const v=Symbol("NoValue");function g(e){return Array.isArray(e)&&e.length>0?e[0]:c(e)&&e.length()>0?e.get(0):v}function ne(e){const i=g(g(e));return i===v||Array.isArray(i)||c(i)||i instanceof A?e:[e]}const w=0;function R(e){return S(e,w)??w}function j(e){return typeof e=="number"&&!Number.isNaN(e)}const x=null;function U(e){return S(e,x)??x}function J(e){return typeof e=="number"&&!Number.isNaN(e)||e===null}function D(e){return!(e.length<2)&&typeof e[0]=="number"&&!Number.isNaN(e[0])&&typeof e[1]=="number"&&!Number.isNaN(e[1])}function b(e){return D(e)?e.length>2?e.slice(0,2):e:null}function le(e){return D(e)?j(e[2])?e.length>3?e.slice(0,3):e:[e[0],e[1],R(e[2])]:null}function oe(e){return D(e)?e.length>=3&&!J(e[2])?[e[0],e[1],U(e[2])]:e.length>3?e.slice(0,3):e:null}function ue(e){return D(e)?j(e[2])&&J(e[3])?e.length>4?e.slice(0,4):e:[e[0],e[1],R(e[2]),U(e[3])]:null}function _(e){return[e.x,e.y]}function fe(e){return[e.x,e.y,e.z??w]}function ce(e){return[e.x,e.y,e.m??x]}function he(e){return[e.x,e.y,e.z??w,e.m??x]}function de(e,i,s){if(c(e)&&(e=e.toArray()),!Array.isArray(e)||e.length!==2)throw new l(null,"InvalidParameter",null);const t=f(e[0],i,s);if(t==null)return null;const a=f(e[1],_,b);return a==null?null:{c:[t,a]}}function ye(e,i,s){if(c(e)&&(e=e.toArray()),!Array.isArray(e)||e.length!==4&&e.length!==7)throw new l(null,"InvalidParameter",null);const t=f(e[0],i,s);if(t==null)return null;const a=f(e[1],_,b);if(a==null)return null;const r=e[2];if(r!==0&&r!==1)throw new l(null,"InvalidParameter",null);const n=e[3];if(n!==0&&n!==1)throw new l(null,"InvalidParameter",null);if(e.length===4)return{a:[t,a,r,n]};const o=e[4];if(typeof o!="number")throw new l(null,"InvalidParameter",null);if(Number.isNaN(o))return null;const y=e[5];if(typeof y!="number")throw new l(null,"InvalidParameter",null);if(Number.isNaN(y))return null;const h=e[6];if(typeof h!="number")throw new l(null,"InvalidParameter",null);return Number.isNaN(h)?null:{a:[t,a,r,n,o,y,h]}}function me(e,i,s){if(c(e)&&(e=e.toArray()),!Array.isArray(e)||e.length!==3)throw new l(null,"InvalidParameter",null);const t=f(e[0],i,s);if(t==null)return null;const a=f(e[1],_,b);if(a==null)return null;const r=f(e[2],_,b);return r==null?null:{b:[t,a,r]}}function $(e,i){return e?i?ue:le:i?oe:b}function V(e,i){return e?i?he:fe:i?ce:_}function f(e,i,s){return Array.isArray(e)?s(e):e instanceof A?i(e):c(e)?s(e.toArray()):null}function G(e,i,s){return Array.isArray(e)?s(e):z(e)?e.hasField("c")?de(e.field("c"),i,s):e.hasField("a")?ye(e.field("a"),i,s):e.hasField("b")?me(e.field("b"),i,s):null:e instanceof A?i(e):c(e)?s(e.toArray()):null}function M(e,i,s,t){const a=[];if(Array.isArray(e))for(const r of e){const n=i(r,s,t);n!=null&&a.push(n)}else if(c(e))for(let r=0;r<e.length();r++){const n=i(e.get(r),s,t);n!=null&&a.push(n)}return a}function m(e,i,s){return Array.isArray(e)?e.length>=i:c(e)?e.length()>=i:e instanceof A&&e[s]}function E(e,i,s){return e===void 0&&i===void 0?{hasZ:m(s,3,"hasZ"),hasM:m(s,4,"hasM")}:e===void 0?i===!0?{hasZ:m(s,4,"hasZ"),hasM:!0}:{hasZ:m(s,3,"hasZ"),hasM:!1}:i===void 0?e===!0?{hasZ:!0,hasM:m(s,4,"hasM")}:{hasZ:!1,hasM:m(s,3,"hasM")}:{hasZ:e===!0,hasM:i===!0}}function pe(e,i,s){const t=g(e);if(t===v)return null;const{hasZ:a,hasM:r}=E(i,s,t);return{array:M(e,f,V(a,r),$(a,r)),hasZ:a,hasM:r}}function F(e,i,s,t){const a=g(g(e=ne(e)));if(a===v)return null;const{hasZ:r,hasM:n}=E(i,s,a),o=V(r,n),y=$(r,n),h=[];if(Array.isArray(e))for(let d=0;d<e.length;d++)h.push(M(e[d],t,o,y));else if(c(e))for(let d=0;d<e.length();d++)h.push(M(e.get(d),t,o,y));return{arrays:h,hasZ:r,hasM:n}}function ge(e){switch(e.type){case"small-integer":case"esriFieldTypeSmallInteger":case"integer":case"esriFieldTypeInteger":case"single":case"esriFieldTypeSingle":case"double":case"esriFieldTypeDouble":case"big-integer":case"esriFieldTypeBigInteger":case"long":case"esriFieldTypeLong":case"oid":case"esriFieldTypeOID":return{name:e.name,type:"number"};case"global-id":case"esriFieldTypeGlobalID":case"guid":case"esriFieldTypeGUID":case"string":case"esriFieldTypeString":return{name:e.name,type:"text"};case"date":case"esriFieldTypeDate":case"timestamp-offset":case"esriFieldTypeTimestampOffset":return{name:e.name,type:"date"};case"date-only":case"esriFieldTypeDateOnly":return{name:e.name,type:"dateOnly"};case"time-only":case"esriFieldTypeTimeOnly":return{name:e.name,type:"time"};default:return null}}function I(e,i,s){if(e==null)return null;switch(i){case"time-only":return O(e)?e:Y.fromReader(e.toString());case"date-only":return C(e)?e:X.fromReader(e.toString());case"timestamp-offset":return Z(e)?e:p.fromReaderAsTimeStampOffset(e.toString());case"date":return Z(e)?e:W(e)?p.dateJSAndZoneToArcadeDate(e,s):p.epochToArcadeDate(e,s);case"geometry":return null;default:return e}}class u{constructor(){this.arcadeDeclaredClass="esri.arcade.Feature",this._optimizedGeomDefinition=null,this._geometry=null,this.attributes=null,this._layer=null,this._fieldTypesFixed=!0,this.fieldsIndex=null,this.contextTimeZone=null,this.immutable=!0,this._fieldsToFixDataTypes=null,this.immutable=!0}static createFromGraphic(i,s){const t=new u;return t.contextTimeZone=s??null,t._geometry=i.geometry!=null?i.geometry:null,i.attributes===void 0||i.attributes===null?t.attributes={}:t.attributes=i.attributes,i._sourceLayer?(t._layer=i._sourceLayer,t._fieldTypesFixed=!1):i._layer?(t._layer=i._layer,t._fieldTypesFixed=!1):i.layer&&"fields"in i.layer?(t._layer=i.layer,t._fieldTypesFixed=!1):i.sourceLayer&&"fields"in i.sourceLayer&&(t._layer=i.sourceLayer,t._fieldTypesFixed=!1),t._layer&&!t._fieldTypesFixed&&(t.fieldsIndex=this.hydrateFieldsIndex(t._layer)),t}static createFromArcadeFeature(i){if(i instanceof u){const t=new u;return t._fieldTypesFixed=i._fieldTypesFixed,t.attributes=i.attributes,t._geometry=i._geometry,t._optimizedGeomDefinition=i._optimizedGeomDefinition,i._layer&&(t._layer=i._layer),t.fieldsIndex=i.fieldsIndex,t.contextTimeZone=i.contextTimeZone,t}const s={};for(const t of i.keys())s[t]=i.field(t);return u.createFromGraphicLikeObject(i.geometry(),s,i.fullSchema(),i.contextTimeZone)}static createFromOptimisedFeature(i,s,t){const a=new u;return a._geometry=i.geometry?{geometry:i.geometry}:null,a._optimizedGeomDefinition=t,a.attributes=i.attributes||{},a._layer=s,a._fieldTypesFixed=!1,a}static createFromArcadeDictionary(i,s){const t=new u;return t.attributes=i.field("attributes"),t.attributes!==null&&t.attributes instanceof N?(t.attributes=t.attributes.attributes,t.attributes===null&&(t.attributes={})):t.attributes={},t._geometry=i.field("geometry"),t._geometry!==null&&(t._geometry instanceof N?t._geometry=ae(t._geometry,s):t._geometry instanceof k||(t._geometry=null)),t}static createFromGraphicLikeObject(i,s,t=null,a){const r=new u;return r.contextTimeZone=a??null,s===null&&(s={}),r.attributes=s,r._geometry=i??null,r._layer=t,r._layer&&(r._fieldTypesFixed=!1,r.fieldsIndex=this.hydrateFieldsIndex(r._layer)),r}static hydrateFieldsIndex(i){return i===null?null:ee(i)?i.getFieldsIndex():i.fieldsIndex?i.fieldsIndex:B.fromLayerJSON({datesInUnknownTimezone:i.datesInUnknownTimezone,fields:i.fields,timeInfo:i.timeInfo,editFieldsInfo:i.editFieldsInfo,dateFieldsTimeReference:i.dateFieldsTimeReference??{timeZone:"UTC",respectsDaylightSaving:!1}})}repurposeFromGraphicLikeObject(i,s,t=null){s===null&&(s={}),this.attributes=s,this._geometry=i??null,this._layer=t,this._layer?this._fieldTypesFixed=!1:this._fieldTypesFixed=!0}castToText(i=!1){this._fieldTypesFixed===!1&&this._fixFieldTypes();const s=te(this.attributes,{useNumbersForDates:i});return'{"geometry":'+(this.geometry()===null?"null":ie(this.geometry()))+',"attributes":'+s+"}"}_fixFieldTypes(){var t;if(this._fieldsToFixDataTypes&&((t=this._fieldsToFixDataTypes)==null?void 0:t.length)>0)return this._fixAllFields(this._fieldsToFixDataTypes),void(this._fieldTypesFixed=!0);const i=[],s=this._layer.fields;for(let a=0;a<((s==null?void 0:s.length)??0);a++){const r=s[a],{name:n,type:o}=r;switch(o){case"date":case"esriFieldTypeDate":i.push({field:n,dataType:"date"});break;case"date-only":case"esriFieldTypeDateOnly":i.push({field:n,dataType:"date-only"});break;case"time-only":case"esriFieldTypeTimeOnly":i.push({field:n,dataType:"time-only"});break;case"timestamp-offset":case"esriFieldTypeTimestampOffset":i.push({field:n,dataType:"timestamp-offset"});break;case"geometry":case"esriFieldTypeGeometry":i.push({field:n,dataType:"geometry"})}}this._fieldsToFixDataTypes=i,i.length>0&&this._fixAllFields(i),this._fieldTypesFixed=!0}isUnknownDateTimeField(i){var s;return((s=this.fieldsIndex)==null?void 0:s.getTimeZone(i))==="unknown"}_fixAllFields(i){this.attributes={...this.attributes};const s=this.contextTimeZone??"system";for(let t=0;t<i.length;t++){const a=i[t].field,r=i[t].dataType;let n=this.attributes[a];if(n===void 0){for(const o in this.attributes)if(o.toLowerCase()===a.toLowerCase()){n=this.attributes[o],this.attributes[o]=I(n,r,this.isUnknownDateTimeField(o)?"unknown":s);break}}else n!==null&&(this.attributes[a]=I(n,r,this.isUnknownDateTimeField(a)?"unknown":s))}}geometry(){return this._geometry===null||this._geometry instanceof k||(this._optimizedGeomDefinition?(this._geometry=T(H(this._geometry,this._optimizedGeomDefinition.geometryType,this._optimizedGeomDefinition.hasZ,this._optimizedGeomDefinition.hasM)),this._geometry.spatialReference=this._optimizedGeomDefinition.spatialReference):this._geometry=T(this._geometry)),this._geometry}field(i){this._fieldTypesFixed||this._fixFieldTypes();const s=this.attributes[i];if(s!==void 0)return s;const t=i.toLowerCase();for(const a in this.attributes)if(a.toLowerCase()===t)return this.attributes[a];if(this._hasFieldDefinition(t))return null;throw new l(null,"FieldNotFound",null,{key:i})}_hasFieldDefinition(i){if(this._layer===null)return!1;for(let s=0;s<this._layer.fields.length;s++)if(this._layer.fields[s].name.toLowerCase()===i)return!0;return!1}setField(i,s){if(this.immutable)throw new l(null,"Immutable",null);if(s instanceof Date&&(s=this.isUnknownDateTimeField(i)?p.unknownDateJSToArcadeDate(s):p.dateJSToArcadeDate(s)),L(s)===!1)throw new l(null,"TypeNotAllowedInFeature",null);const t=i.toLowerCase();if(this.attributes[i]===void 0){for(const a in this.attributes)if(a.toLowerCase()===t)return void(this.attributes[a]=s);this.attributes[i]=s}else this.attributes[i]=s}hasField(i){const s=i.toLowerCase();if(this.attributes[i]!==void 0)return!0;for(const t in this.attributes)if(t.toLowerCase()===s)return!0;return!!this._hasFieldDefinition(s)}keys(){let i=[];const s={};for(const t in this.attributes)i.push(t),s[t.toLowerCase()]=1;if(this._layer!==null)for(let t=0;t<this._layer.fields.length;t++){const a=this._layer.fields[t];s[a.name.toLowerCase()]!==1&&i.push(a.name)}return i=i.sort(),i}isEmpty(){for(const i in this.attributes)return!1;return!(this._layer!=null&&this._layer.fields.length>0)&&this.geometry()==null}static parseAttributesFromDictionary(i){const s={};for(const t in i.attributes){const a=i.attributes[t];if(!L(a))throw new l(null,"InvalidParameter",null);s[t]=a}return s}static fromJson(i,s){let t=null;i.geometry!==null&&i.geometry!==void 0&&(t=T(i.geometry));const a={};if(i.attributes!==null&&i.attributes!==void 0)for(const r in i.attributes){const n=i.attributes[r];if(n===null)a[r]=n;else{if(!(K(n)||q(n)||Q(n)||Z(n)||O(n)||C(n)))throw new l(null,"InvalidParameter",null);a[r]=n}}return u.createFromGraphicLikeObject(t,a,null,s??null)}fullSchema(){return this._layer}gdbVersion(){var s;if(this._layer===null)return"";const i=this._layer.gdbVersion;return i===void 0?"":i===""&&((s=this._layer.capabilities)!=null&&s.isVersioned)?"SDE.DEFAULT":i}castAsJson(i){var t;const s={attributes:{},geometry:(i==null?void 0:i.keepGeometryType)===!0?this.geometry():((t=this.geometry())==null?void 0:t.toJSON())??null};for(const a in this.attributes){const r=this.attributes[a];r!==void 0&&(s.attributes[a]=se(r,i))}return s}async castAsJsonAsync(i=null,s){return this.castAsJson(s)}}re(u);const Fe=Object.freeze(Object.defineProperty({__proto__:null,Feature:u,convertAttributeToArcadeValue:I,getArcadeVariableForField:ge},Symbol.toStringTag,{value:"Module"}));export{ge as D,Fe as F,u as I,ae as a,I as w};
