const L=9999999e31,S=2e-7,w={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34028234663852886e22,34028234663852886e22],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};function x(t){return w[t]??[-34028234663852886e22,34028234663852886e22]}const U={u1:1,u2:1,u4:1,u8:1,s8:1,u16:2,s16:2,u32:4,s32:4,f32:4,f64:8,unknown:4,c64:16,c128:32};function V(t){return U[t]}function P(t){return V(t.pixelType)*t.bandCount}function T(t,n){return t==null||n==null?"s32":t<0?t>=-128&&n<128?"s8":t>=-32768&&n<32768?"s16":"s32":n<256?"u8":n<65536?"u16":"u32"}function v(t){return((t==null?void 0:t.startsWith("s"))||(t==null?void 0:t.startsWith("u")))??!1}function W(t,n,e,r){let[l,i]=x(e);const u=v(e);return u&&(l-=1e-5,i+=1e-5),u?e.startsWith("u")?C(t,n,r,[l,i]):I(t,n,r,[l,i]):O(t,n,r,[l,i])}function X(t,n){for(let e=0;e<n.length;e++)n[e]&&isNaN(t[e])&&(n[e]=0,t[e]=0)}function C(t,n,e,r){const[l,i]=r;for(let u=0;u<n.length;u++)if(n[u]){const o=t[u];o<l||o>i?n[u]=0:e[u]=o+.5|0}}function I(t,n,e,r){const[l,i]=r;for(let u=0;u<n.length;u++)if(n[u]){const o=t[u];o<l||o>i?n[u]=0:e[u]=o+(o>0?.5:-.5)|0}}function O(t,n,e,r){const[l,i]=r;for(let u=0;u<n.length;u++)if(n[u]){const o=t[u];o<l||o>i?n[u]=0:e[u]=o}}function _(t,n,e){var k,M;if(t.depthCount&&t.depthCount>1)return;const{pixels:r,statistics:l,pixelType:i}=t,u=r[0].length,o=t.bandMasks??[],g=t.mask??new Uint8Array(u).fill(255),y=i==="f32"||i==="f64",N=x(i);let p=!1;for(let s=0;s<r.length;s++){const a=typeof n=="number"?n:n[s];if(a==null)continue;const d=((k=l==null?void 0:l[s])==null?void 0:k.minValue)??N[0],m=((M=l==null?void 0:l[s])==null?void 0:M.maxValue)??N[1];if(d>a+Number.EPSILON||m<a-Number.EPSILON)continue;const h=o[s]||g.slice(),c=r[s],A=e==null?void 0:e.customFloatTolerance;if(y&&A!==0){let f=A;f||(f=Math.abs(a)>=L?S*Math.abs(a):i==="f32"?2**-23:Number.EPSILON);for(let b=0;b<c.length;b++)h[b]&&Math.abs(c[b]-a)<f&&(c[b]=0,h[b]=0,g[b]=0,p=!0)}else for(let f=0;f<c.length;f++)h[f]&&c[f]===a&&(c[f]=0,h[f]=0,g[f]=0,p=!0);o[s]=h}if(p){const s=t.bandMasks||t.pixels.length>1?o:null;e!=null&&e.matchAllNoData?t.mask=s&&s.length>1?E(s):g:(t.bandMasks=s,t.mask=g)}function E(s){if(s.length<2)return s[0];const a=s[0].length,d=new Uint8Array(a).fill(0);for(let m=0;m<s.length;m++){const h=s[m];for(let c=0;c<a;c++)h[c]&&(d[c]=255)}return d}p&&"updateStatistics"in t&&t.updateStatistics()}export{W as c,X as f,_ as g,T as i,P as l,v as r,x as u};
