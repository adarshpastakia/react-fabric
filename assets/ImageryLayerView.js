import{E as n,F as l,V as x,b as g,dd as E,ar as F,fn as $,a5 as u}from"./ShadowCastClear.glsl.js";import{a as b}from"./rasterFieldUtils.js";import{i as D}from"./timeSupport.js";import{I,j as N}from"./rasterProjectionHelper.js";import{n as S}from"./popupUtils.js";const L=c=>{const d=c;let t=class extends d{constructor(...e){super(...e),this.view=null}get timeExtent(){var e;return D(this.layer,(e=this.view)==null?void 0:e.timeExtent,this._get("timeExtent"))}async fetchPopupFeaturesAtLocation(e,s){const{layer:r}=this;if(!e)throw new g("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:r});const{popupEnabled:y}=r,p=S(r,s);if(!y||p==null)return[];const w=await p.getRequiredFields(null,{index:new E(r.rasterFields),partitions:new Map([["$pixel",r.rasterFields.filter(i=>i.name.startsWith(b)).map(i=>i.name)],["$imageCollectionItem",r.fields.map(i=>i.name)]])});F(s);const a=new $;a.timeExtent=this.timeExtent,a.geometry=e,a.outFields=w,a.outSpatialReference=e.spatialReference;const{resolution:o,spatialReference:m}=this.view,h=this.view.type==="2d"?new u(o,o,m):new u(.5*o,.5*o,m),{returnTopmostRaster:f,showNoDataRecords:R}=p.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},v={returnDomainValues:!0,returnTopmostRaster:f,pixelSize:h,showNoDataRecords:R,signal:s==null?void 0:s.signal};return r.queryVisibleRasters(a,v)}async getSourceScale(){return await N(),await this.layer.load(),I(this.layer.serviceRasterInfo,this.view.spatialReference)}canResume(){var e;return!!super.canResume()&&!((e=this.timeExtent)!=null&&e.isEmpty)}};return n([l()],t.prototype,"layer",void 0),n([l()],t.prototype,"suspended",void 0),n([l({readOnly:!0})],t.prototype,"timeExtent",null),n([l()],t.prototype,"view",void 0),t=n([x("esri.views.layers.ImageryLayerView")],t),t};export{L as y};
