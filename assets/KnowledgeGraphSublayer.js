const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./lclayout.js","./commonjsHelpers.js"])))=>i.map(i=>d[i]);
import{K as Te,wk as de,H as yt,cd as Y,iN as Nt,b as ee,iG as $t,L as vt,bA as je,co as St,fY as ht,b6 as mt,l as ft,fn as oe,ah as Lt,eA as Ie,iz as re,eB as he,b0 as Ee,lP as qe,b2 as gt,E as h,F as m,V as $e,ph as bt,qt as Mt,qu as kt,pi as wt,qy as Dt,zR as Ct,zS as xt,v7 as Ft,tc as Rt,ru as pe,bf as me,zT as fe,b8 as Pe,kz as At,tt as Ot,u2 as Ge,bu as jt,P as qt,rm as Pt,rn as Gt,ro as Ut,js as zt,rp as Ht,jL as Qt,jl as Wt,jt as Bt,ao as Vt,zU as Jt,cb as we,j9 as ue,rr as Zt,pj as Yt,ip as Ue,i0 as ze,re as He,qw as Kt,cl as Xt,rs as es,b3 as ts,a5 as ss,as as rs,i as V,zV as is,zW as ns,zX as as,vz as os,zY as ls,zZ as ps,ju as ds,rB as us,rC as cs,ta as ys,z_ as hs,qA as ms,iq as fs,rw as gs,tL as bs,e1 as ws,x0 as Ts,rt as Is}from"./ShadowCastClear.glsl.js";import{i as xe,r as Es,n as Fe,a as le,l as _s,V as Ns}from"./knowledgeGraphService.js";import{I as _e,t as Ne,_ as z,E as ge,S as Re,o as ke}from"./constants2.js";import{b8 as $s}from"./iframe-qDaPDssc.js";import{p as ne,a as Qe,i as We}from"./GraphQueryStreaming.js";import{f as vs}from"./FeatureStore.js";import{W as Ss}from"./QueryEngine.js";let Ls=class{constructor(){this.version="",this.queryResult=new Ms}},Ms=class{constructor(){this.featureResult=new ks}},ks=class{constructor(){this.objectIdFieldName="",this.uniqueIdField=new Ds,this.globalIdFieldName="",this.geohashFieldName="",this.geometryProperties=new Cs,this.geometryType=null,this.spatialReference=new Te,this.exceededTransferLimit=!1,this.hasZ=!1,this.hasM=!1,this.transform=new Tt,this.fields=[],this.fieldNameToAttributeIndexMap={},this.values=[],this.features=[],this.geometryFields=[]}},Ds=class{constructor(){this.name="",this.isSystemMaintained=!1}},Cs=class{constructor(){this.shapeAreaFieldName="",this.shapeLengthFieldName="",this.units=""}},Tt=class{constructor(){this.quantizeOriginPosition="upperLeft",this.scale=new xs,this.translate=new Fs}},xs=class{constructor(){this.xScale=0,this.yScale=0,this.mScale=0,this.zScale=0}},Fs=class{constructor(){this.xTranslate=0,this.yTranslate=0,this.mTranslate=0,this.zTranslate=0}},Rs=class{constructor(){this.name="",this.fieldType="esriFieldTypeString",this.alias="",this.sqlType="sqlTypeVarchar",this.domain="",this.defaultValue=""}},As=class{constructor(){this.attributes=[],this.compressedGeometry=new De,this.centroid=new De,this.aggregateGeometries=[]}},De=class{constructor(){this.geometryType=null,this.lengths=[],this.coords=[]}};const Os=["ELEMENTUID","TYPENAME"],js={upperLeft:0,lowerLeft:1},qs={sqlTypeBigInt:0,sqlTypeBinary:1,sqlTypeBit:2,sqlTypeChar:3,sqlTypeDate:4,sqlTypeDecimal:5,sqlTypeDouble:6,sqlTypeFloat:7,sqlTypeGeometry:8,sqlTypeGUID:9,sqlTypeInteger:10,sqlTypeLongNVarchar:11,sqlTypeLongVarbinary:12,sqlTypeLongVarchar:13,sqlTypeNChar:14,sqlTypeNVarChar:15,sqlTypeOther:16,sqlTypeReal:17,sqlTypeSmallInt:18,sqlTypeSqlXml:19,sqlTypeTime:20,sqlTypeTimestamp:21,sqlTypeTimestamp2:22,sqlTypeTinyInt:23,sqlTypeVarbinary:24,sqlTypeVarchar:25};function Ps(t){const e=new Ls;e.version=t.version;const s=t.get_query_result();if(s.results_type.value!==0)throw new Error("Got a non-feature collection type");const r=s.get_feature_result(),i=e.queryResult.featureResult;i.objectIdFieldName=r.objectid_field_name,i.exceededTransferLimit=r.exceeded_transfer_limit,i.hasM=r.has_m,i.hasZ=r.has_z,i.geometryType=de(xe,r.geometry_type.value),i.globalIdFieldName=r.globalid_field_name,i.geohashFieldName=r.geohash_field_name;const n=i.uniqueIdField,a=r.unique_id_field;n.name=a.name,n.isSystemMaintained=a.isSystemMaintained;const o=i.geometryProperties,p=r.geometry_properties;o.shapeAreaFieldName=p.shapeAreaFieldName,o.shapeLengthFieldName=p.shapeLengthFieldName,o.units=p.units;const c=i.spatialReference,y=r.spatial_reference;c.wkid=y.wkid,c.latestWkid=y.latestWkid,c.vcsWkid=y.vcsWkid,c.latestVcsWkid=y.latestVcsWkid,c.wkt=y.wkt,i.transform=Us(r.transform);const d=i.fields,l=i.fieldNameToAttributeIndexMap,u=r.fields,b=u.size();for(let _=0;_<b;_++){const k=u.get(_),I=It(k);d.push(I),l[I.name]=_,k.delete()}u.delete();const v=i.values,N=r.values_count();for(let _=0;_<N;_++)v.push(r.get_value_at(_));const R=i.features,f=r.features,$=f.size();if($>0){for(const _ of Os)if(l[_]===void 0)throw new Error(`Feature collection missing required attribute: ${_}`)}for(let _=0;_<$;_++){const k=new As,I=f.get(_),q=k.attributes,G=I.attributes_count();for(let P=0;P<G;P++)q.push(I.get_attribute_at(P));const O=I.get_compressed_geometry();O&&(k.compressedGeometry=Se(O),k.centroid=Se(I.get_centroid()));const H=k.aggregateGeometries,U=I.aggregate_geometries,te=U.size();for(let P=0;P<te;P++){const E=U.get(P),w=Se(E);H.push(w),E.delete()}U.delete(),R.push(k),I.delete()}f.delete();const A=i.geometryFields,C=r.geometry_fields,L=C.size();for(let _=0;_<L;_++){const k=C.get(_),I=Gs(k);A.push(I),k.delete()}return C.delete(),e}function Se(t){const e=new De;e.geometryType=de(xe,t.geometry_type.value);const s=[],r=[];for(let i=0;i<t.lengths.length;i++)s.push(t.lengths[i]);for(let i=0;i<t.coords.length;i++)r.push(t.coords[i]);return e.lengths=s,e.coords=r,e}function It(t){const e=new Rs;return e.name=t.name,e.alias=t.alias,e.fieldType=de(Es,t.field_type.value),e.sqlType=de(qs,t.sql_type.value),e.domain=t.domain,e.defaultValue=t.default_value,e}function Gs(t){const e=It(t);return e.geometryType=de(xe,t.geometry_type.value),e}function Us(t){const e=new Tt;e.quantizeOriginPosition=de(js,t.quantizeOriginPosition.value);const s=e.scale,r=t.scale;s.xScale=r.xScale,s.yScale=r.yScale,s.mScale=r.mScale,s.zScale=r.zScale;const i=e.translate,n=t.translate;return i.xTranslate=n.xTranslate,i.yTranslate=n.yTranslate,i.mTranslate=n.mTranslate,i.zTranslate=n.zTranslate,e}async function zs(t){const e=[],s={generateAllSublayers:!1,namedTypeDefinitions:new Map};return t.entitiesUrl&&e.push(Be(t.entitiesUrl).then(r=>{Ve(r,s)})),t.relationshipsUrl&&e.push(Be(t.relationshipsUrl).then(r=>{Ve(r,s)})),await Promise.all(e),s}async function qr(t,e){e??(e=!1);const s={generateAllSublayers:e,namedTypeDefinitions:new Map};return await Ws(t).then(r=>{Vs(r,s)}),s}async function Pr(t){const e=await Fe(),s=new e.MapOfObjectIdentifierSets;Hs(s,e,t);const r=new e.MapOfObjectIdentifierSetsEncoder;try{r.set_map_of_identifier_sets(s),r.encode();const i=r.get_encoding_result();if(i.error.error_code!==0)throw new ee("knowledge-graph:layer-support-utils",i.error.error_message);const n=structuredClone(i.get_byte_buffer());return r.delete(),n}finally{s.delete()}}function Hs(t,e,s){for(const[r,i]of s.namedTypeDefinitions){if(!i.members||i.useAllData)continue;const n=i.members.keys();let a=!1,o=!0;const p=new e.ObjectIdArray,c=new e.StringArray,y=new e.GlobalIdArray,d=new e.IdentifierArray,l=new e.ObjectIdentifierSet;for(const u of n)o&&(a=!isNaN(Number(u)),o=!1),a?p.add_objectid(Number(u)):(c.add_string(u),y.add_globalid(u)),d.add_identifier(u);l.set_oid_array(p),l.set_string_array(c),l.set_globalid_array(y),l.set_identifier_array(d),p.delete(),c.delete(),y.delete(),d.delete(),t.put_identifier_set(r,l),l.delete()}return t}async function Be(t){const e=await yt(t,{responseType:"array-buffer"});return Qs(await e.data)}async function Qs(t){const e=new(await Fe()).FeatureCollectionDecoder,s=e.decode(new Uint8Array(t));if(s.error_code!==0)throw new ee("knowledge-graph:layer-support-utils",s.error_message);const r=e.get_feature_collection(),i=Ps(r);return e.delete(),i}async function Ws(t){const e=await yt(t,{responseType:"array-buffer"}),s=await e.data;return Bs(new Uint8Array(s))}async function Bs(t){const e=new(await Fe()).MapOfObjectIdentifierSetsDecoder,s=e.decode(new Uint8Array(t)),r=new Map;if(s.error_code!==0)throw new ee("knowledge-graph:layer-support-utils",s.error_message);const i=e.get_map_of_identifier_sets(),n=i.keys,a=n.size();for(let o=0;o<a;o++){const p=n.get(o),c=i.query_identifier_set(p),y=[];if(c.id_array_type.value===1){const d=c.get_globalid_array(),l=d.count();for(let u=0;u<l;u++)y.push(d.get_globalid_at(u))}else if(c.id_array_type.value===3){const d=c.get_identifier_array(),l=d.count();for(let u=0;u<l;u++)y.push(d.get_identifier_at(u).toString())}else if(c.id_array_type.value===2){const d=c.get_string_array(),l=d.count();for(let u=0;u<l;u++)y.push(d.get_string_at(u))}else{if(c.id_array_type.value!==0)throw new ee("knowledge-graph:layer-support-utils","Tried to encode an unexpected ID Array type.");{const d=c.get_oid_array(),l=d.count();for(let u=0;u<l;u++)y.push(d.get_objectid_at(u).toString())}}r.set(p,y)}return e.delete(),r}function Ve(t,e){var r,i,n;if(!((r=t==null?void 0:t.queryResult)!=null&&r.featureResult))return e;const s=t.queryResult.featureResult.fieldNameToAttributeIndexMap;for(const a of t.queryResult.featureResult.features){const o=a.attributes[s.TYPENAME],p=Y(e.namedTypeDefinitions,o,()=>({useAllData:!1,members:new Map})),c=a.attributes[s.ELEMENTUID];if(((n=(i=a.compressedGeometry)==null?void 0:i.coords)==null?void 0:n.length)>0){let y=a.compressedGeometry.lengths;a.compressedGeometry.geometryType==="esriGeometryPoint"&&(y=[]),p.members.set(c,{id:c,linkChartLocation:new Nt(y,a.compressedGeometry.coords)})}else p.members.set(c,{id:c})}return e}function Vs(t,e){for(const[s,r]of t){const i=Y(e.namedTypeDefinitions,s,()=>({useAllData:!1,members:new Map}));for(const n of r)i.members.has(n)||i.members.set(n,{id:n})}return e}const Gr={fetchAndConvertSerializedLinkChart:t=>zs(t)},Ce=(t,e)=>{if(t.type==="column-reference")return t.column===e.systemOidFieldName?"ID(n)":`n.${t.column}`;if(t.type==="string")return`'${t.value}'`;if(t.type==="number")return`${t.value}`;if(t.type==="binary-expression"&&e.supportedSqlTypes.has(t.left.type)&&e.supportedSqlTypes.has(t.right.type)&&e.supportedSqlOperators.has(t.operator))return`${Ce(t.left,e)} ${t.operator} ${Ce(t.right,e)}`;if(t.type==="binary-expression"&&t.operator==="LIKE"){let s="";if(t.left.type==="function"&&t.left.args.value[0].type==="column-reference")s+=`lower(n.${t.left.args.value[0].column})`;else{if(t.left.type!=="column-reference")return e.unsupportedOperationFound=!0,"";s+=`lower(n.${t.left.column})`}if(s+=" CONTAINS (",t.right.type!=="string")return e.unsupportedOperationFound=!0,"";{let r=t.right.value;r.startsWith("%")&&(r=r.slice(1)),r.endsWith("%")&&(r=r.slice(0,-1)),s+=`'${r.toLowerCase()}')`}return s}return e.unsupportedOperationFound=!0,""};let Le=class ae{constructor(){this._featureLookup=new Map}static getInstance(){return ae.instance||(ae.instance=new ae),ae.instance}static resetInstance(){ae.instance&&(ae.instance=null)}deleteFromStore(e){e.forEach(s=>{this._featureLookup.delete(s)})}readFromStoreByList(e){const s=[];return e.forEach(r=>{const i=this.readFromStoreById(r);i&&s.push(i)}),s}readFromStoreById(e){return this._featureLookup.get(e)??null}writeToStore(e,s,r){const i=[];return e.forEach(n=>{if(!(n!=null&&n.id))return;n.properties||(n.properties=[]);let a,o=null;if(r&&n.properties[r]&&(o=$t(n.properties[r])),"originId"in n&&"destinationId"in n&&(n.properties[_e]=n.originId,n.properties[Ne]=n.destinationId),n.properties[s]=n.id,n.id&&this._featureLookup.has(n.id)&&this._featureLookup.get(n.id).attributes){const p=this._featureLookup.get(n.id),c=JSON.parse(JSON.stringify(Object.assign(p.attributes,n.properties)));r&&n.properties[r]&&(c[r]=vt(n.properties[r])),a=new je(o?JSON.parse(JSON.stringify(o)):p!=null&&p.geometry?JSON.parse(JSON.stringify(p.geometry)):null,c,null,n.properties[s])}else a=new je(o?JSON.parse(JSON.stringify(o)):null,n.properties,null,n.properties[s]);this._featureLookup.set(`${n.typeName?`${n.typeName}__${n.id}`:n.id}`,a),i.push(a)}),i}},Me,T=null;function Ur(){return Me||(Me=$s(()=>import("./lclayout.js"),__vite__mapDeps([0,1]),import.meta.url).then(t=>t.l).then(({default:t})=>t({locateFile:e=>St(`esri/libs/linkchartlayout/${e}`)})).then(t=>{Js(t)}),Me)}function Js(t){T=t}const Je={right:0,left:1,top:2,bottom:3},Ze={none:0,"start-only":1,"start-and-end":2};function Zs(t){const e={timeDirection:"right",timeBannerUTCOffsetInMinutes:0,eventsTicksVisualization:"start-and-end",showDurationLineForNonZeroDurationEntityEvents:!0,durationLineWidth:5,entityPositionAtDurationRatio:1,showNonZeroDurationIntervalBounds:!1,separateTimeOverlaps:!0,separateTimelineOverlaps:!0,moveFirstBends:!0,secondBendRatio:.3,lineSeparationMultiplier:1,spaceSeparatedLinesEvenly:!1,useBezierCurves:!1,separatedLineShapeRatio:0,...t==null?void 0:t.toJSON(),eventsTicksVisualization:(t==null?void 0:t.eventsTicksVisualization)??"start-and-end"};return{...e,timeDirection:{value:Je[e.timeDirection]??Je.right},eventsTicksVisualization:{value:Ze[e.eventsTicksVisualization]??Ze["start-and-end"]}}}function ie(t,e,s,r,i,n){const a=s.length,o=i.length,p=Float64Array.BYTES_PER_ELEMENT,c=Uint32Array.BYTES_PER_ELEMENT,y=Uint8Array.BYTES_PER_ELEMENT,d=16,l=d+a*(y+2*p)+o*(2*c),u=T._malloc(l);try{const b=u+d-u%d,v=b+a*p,N=v+a*p,R=N+o*c,f=R+o*c,$=()=>[T.HEAPF64.subarray(b>>3,(b>>3)+a),T.HEAPF64.subarray(v>>3,(v>>3)+a),T.HEAPU32.subarray(N>>2,(N>>2)+o),T.HEAPU32.subarray(R>>2,(R>>2)+o),T.HEAPU8.subarray(f,f+a)],[A,C,L,_,k]=$();A.set(s),C.set(r),L.set(i),_.set(n),k.set(e);const I=t(a,f,b,v,o,N,R);let q=null,G=null;if(I.value===0){const E=T.getLayoutLinksTypes(),w=T.getLayoutLinksVerticesEndIndices(),x=T.getLayoutLinksVertices(),F=T.countLayoutLinksVertices();!o||E&&w?F&&!x?I.value=1:(q={types:new Uint8Array(T.HEAPU8.subarray(E,E+o)),vertexEndIndex:new Uint32Array(T.HEAPU32.subarray(w>>2,(w>>2)+o)),vertices:new Float64Array(T.HEAPF64.subarray(x>>3,(x>>3)+2*F))},G=T.getAuxiliaryGraphicElements()):I.value=1}const[O,H,U,te,P]=$();return s.set(O),r.set(H),i.set(U),n.set(te),e.set(P),{status:I.value,links:q,graphics:G}}finally{T._free(u),T.cleanupLayout()}}const Ye=2,Ke=1,Xe=-1;var et,tt,st,rt,it,nt,at;(function(t){function e(){return T.getMinIdealEdgeLength()}function s(r,i,n,a,o,p,c=Ye,y=Ke,d=Xe){return ie((l,u,b,v,N,R,f)=>T.applyForceDirectedLayout(r,l,u,b,v,N,R,f,c,y,d),i,n,a,o,p)}t.getMinIdealEdgeLength=e,t.apply=s})(et||(et={})),function(t){function e(s,r,i,n,a,o,p=Ye,c=Ke,y=Xe){return ie((d,l,u,b,v,N,R)=>T.applyCommunityLayout(s,d,l,u,b,v,N,R,p,c,y),r,i,n,a,o)}t.apply=e}(tt||(tt={})),function(t){function e(s,r,i,n,a,o){return ie((p,c,y,d,l,u,b)=>T.applySimpleLayout(s,p,c,y,d,l,u,b),r,i,n,a,o)}t.apply=e}(st||(st={})),function(t){function e(s,r,i,n,a,o){return ie((p,c,y,d,l,u,b)=>T.applyHierarchicalLayout(s,p,c,y,d,l,u,b),r,i,n,a,o)}t.apply=e}(rt||(rt={})),function(t){function e(s,r,i,n,a,o){return ie((p,c,y,d,l,u,b)=>T.applyRadialTreeLayout(s,p,c,y,d,l,u,b),r,i,n,a,o)}t.apply=e}(it||(it={})),function(t){function e(s,r,i,n,a,o){return ie((p,c,y,d,l,u,b)=>T.applySmartTreeLayout(s,p,c,y,d,l,u,b),r,i,n,a,o)}t.apply=e}(nt||(nt={})),function(t){function e(s,r,i,n,a,o,p,c,y,d,l,u){return ie((b,v,N,R,f,$,A)=>{if(a.length!==b)return{value:1};if(o.length!==b)return{value:1};if(y.length!==f)return{value:1};if(d.length!==f)return{value:1};const C=Float64Array.BYTES_PER_ELEMENT,L=16,_=T._malloc(L+b*C),k=T._malloc(L+b*C),I=T._malloc(L+f*C),q=T._malloc(L+f*C),G=_+L-_%L,O=k+L-k%L,H=I+L-I%L,U=q+L-q%L;try{return T.HEAPF64.subarray(G>>3,(G>>3)+b).set(a),T.HEAPF64.subarray(O>>3,(O>>3)+b).set(o),T.HEAPF64.subarray(H>>3,(H>>3)+f).set(y),T.HEAPF64.subarray(U>>3,(U>>3)+f).set(d),T.applyChronologicalLayout(s,b,v,N,R,G,O,f,$,A,H,U,l,Zs(u))}finally{T._free(_),T._free(k),T._free(I),T._free(q)}},r,i,n,p,c)}t.apply=e}(at||(at={}));ht()({none:"none",startAndEnd:"start-and-end",startOnly:"start-only"});ht()({absoluteValue:"absolute-value",multiplier:"multiplier"});const Ys=new Map([["basic-grid","basic-grid"],["geographic-organic-standard","geographic-organic-standard"],["hierarchical-bottom-to-top","hierarchical-bottom-to-top"],["hierarchical-top-to-bottom","hierarchical-bottom-to-top"],["organic-community","organic-community"],["organic-fusiform","organic-standard"],["organic-leaf-circle","organic-standard"],["organic-standard","organic-standard"],["radial-node-centric","radial-root-centric"],["radial-root-centric","radial-root-centric"],["tree-bottom-to-top","tree-left-to-right"],["tree-left-to-right","tree-left-to-right"],["tree-right-to-left","tree-left-to-right"],["tree-top-to-bottom","tree-left-to-right"],["chronological-mono-timeline","chronological-mono-timeline"],["chronological-multi-timeline","chronological-multi-timeline"]]);function Ks(t,e){var r,i;const s=new Map;if((r=e.dataModel)!=null&&r.relationshipTypes)for(const n of e.dataModel.relationshipTypes)n.name&&s.set(n.name,[]);for(const n of t)s.has(n.typeName)&&((i=s.get(n.typeName))==null||i.push(n.id));return s}async function zr(t,e,s){const r=[],i=Ks(t,e),n={},a=[];for(const[y,d]of i){if(d.length<1)continue;const l=`${y}_ids`;n[l]=d,a.push(`MATCH (n)-[r:${y}]->(m) WHERE id(r) in $${l} RETURN id(n), labels(n)[0], id(m), labels(m)[0]`)}if(a.length===0)return[];const o=a.join(" UNION "),p=new ne({openCypherQuery:o,bindParameters:n}),c=(await le(e,p,s==null?void 0:s.requestOptions)).resultRowsStream.getReader();for(;;){const{done:y,value:d}=await c.read();if(y)break;for(const l of d)r.push({id:l[0],typeName:l[1]}),r.push({id:l[2],typeName:l[3]})}return r}const Hr=t=>Ys.get(t)??"radial-root-centric";function Xs(t){if(!t.spatialReference.isWGS84)throw new ee("knowledge-graph:layer-support-utils","The utilsExtentToInBoundsRings function only supports WGS84 spatial references.");return t.clone().normalize().map(e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]])}let Z=class extends mt{constructor(e){var r,i,n;super(e),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;const s=new Map;(r=e.knowledgeGraph.dataModel.entityTypes)==null||r.forEach(a=>{var o,p;a.name&&(s.set(a.name,"entity"),this._processingCacheUpdatesLookup.set(a.name,[]),e.inclusionModeDefinition&&!((o=e.inclusionModeDefinition)!=null&&o.generateAllSublayers)||this.entityTypeNames.add(a.name),(p=a.properties)==null||p.forEach(c=>{c.geometryType&&c.geometryType!=="esriGeometryNull"&&this.geographicLookup.set(a.name,{name:c.name??"",geometryType:c.geometryType})}))}),(i=e.knowledgeGraph.dataModel.relationshipTypes)==null||i.forEach(a=>{var o,p;a.name&&(s.set(a.name,"relationship"),this._processingCacheUpdatesLookup.set(a.name,[]),e.inclusionModeDefinition&&!((o=e.inclusionModeDefinition)!=null&&o.generateAllSublayers)||this.relationshipTypeNames.add(a.name),(p=a.properties)==null||p.forEach(c=>{c.geometryType&&c.geometryType!=="esriGeometryNull"&&this.geographicLookup.set(a.name,{name:c.name??"",geometryType:c.geometryType})}))}),(n=e.inclusionModeDefinition)==null||n.namedTypeDefinitions.forEach((a,o)=>{var c,y;if(s.get(o)==="entity")this.entityTypeNames.add(o);else{if(s.get(o)!=="relationship")return ft.getLogger(this).warn(`A named type, ${o}, was in the inclusion list that wasn't in the data model and will be removed`),void((c=e.inclusionModeDefinition)==null?void 0:c.namedTypeDefinitions.delete(o));this.relationshipTypeNames.add(o)}const p=new Map;(y=a.members)==null||y.forEach(d=>{Y(this.memberIdTypeLookup,d.id,()=>new Set).add(o)}),this.sublayerCaches.set(o,p)})}addToLayer(e){e.forEach(({typeName:s,id:r})=>{if(!this.inclusionModeDefinition)throw new ee("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(s)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(s)){const i=this.inclusionModeDefinition.namedTypeDefinitions.get(s);i.members||(i.members=new Map),i.members.set(r,{id:r}),Y(this.memberIdTypeLookup,r,()=>new Set).add(s)}}else{const i=new Map;i.set(r,{id:r}),this.inclusionModeDefinition.namedTypeDefinitions.set(s,{useAllData:!1,members:i}),Y(this.memberIdTypeLookup,r,()=>new Set).add(s)}})}getById(e){return Le.getInstance().readFromStoreById(e)}async getData(e,s,r){var n,a;if(s.objectType.name&&((n=this.inclusionModeDefinition)!=null&&n.namedTypeDefinitions)&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(s.objectType.name))return[];let i;if(i=e||new oe({where:"1=1",outFields:["*"]}),s.parentCompositeLayer.type==="link-chart"){const o=s.parentCompositeLayer,p=this._processingCacheUpdatesLookup.get(s.objectType.name??""),c=i.outFields;c&&c.length===1&&c[0]===z&&i.where==="1=1"||await Promise.all(p??[]);const y=this.sublayerCaches.has(s.objectType.name??"")?Array.from((a=this.sublayerCaches.get(s.objectType.name))==null?void 0:a.values()):[],d=[];return y.forEach(l=>{if(this.relationshipTypeNames.has(s.objectType.name)){l.geometry=o.relationshipLinkChartDiagramLookup.get(l.attributes[s.objectIdField]);const u=this.memberIdTypeLookup.get(l.attributes[_e]),b=this.memberIdTypeLookup.get(l.attributes[Ne]),v=this._isEndEntitySpatial(u,l,_e),N=this._isEndEntitySpatial(b,l,Ne);l.attributes[ge]=Number(v&&N)}else{l.geometry=o.entityLinkChartDiagramLookup.get(l.attributes[s.objectIdField]);const u=this.geographicLookup.get(s.objectType.name);u&&l.attributes[u.name]?l.attributes[ge]=1:l.attributes[ge]=0}l.attributes[Re]=l.geometry,d.push(l)}),d}return this.retrieveDataFromService(i,s,r)}async getConnectedRecordIds(e,s,r){const i=[];let n="";const a=this._getNamedTypeIdMapFromNodeIds(e);if(s&&(s==null?void 0:s.length)!==0){for(const d of s)n=n+d+"|";n=n.slice(0,-1)}const o={},p=[];for(const[d,l]of a){const u=`${d}_ids`;o[u]=l,s&&(s==null?void 0:s.length)!==0?p.push(`MATCH (n:${d}) WHERE id(n) IN $${u} WITH n MATCH (n)-[r:${n}]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`):p.push(`MATCH (n:${d}) WHERE id(n) IN $${u} WITH n MATCH (n)-[r]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`)}if(!p.length)return i;const c=p.join(" UNION "),y=(await le(this.knowledgeGraph,new ne({openCypherQuery:c,bindParameters:o}),{signal:r==null?void 0:r.signal})).resultRowsStream.getReader();for(;;){const{done:d,value:l}=await y.read();if(d)break;for(let u=0;u<l.length;u++){const b=l[u];i.push({id:b[0],typeName:b[1]}),i.push({id:b[2],typeName:b[3]})}}return i}async getRelationshipsBetweenNodes(e,s,r){const i=this._getNamedTypeIdMapFromNodeIds(e);if(i.size===0)return[];const n={relationshipExclusionIds:s,possibleConnectionEntityIds:e},a=[];for(const[y,d]of i.entries()){const l=`${y}_ids`;n[l]=d,a.push(`MATCH (n:${y}) WHERE id(n) IN $${l} WITH n MATCH (n)-[r]->(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}const o=a.join(" UNION "),p=[],c=(await le(this.knowledgeGraph,new ne({openCypherQuery:o,bindParameters:n}),{signal:r==null?void 0:r.signal})).resultRowsStream.getReader();for(;;){const{done:y,value:d}=await c.read();if(y)break;for(let l=0;l<d.length;l++){const u=d[l];p.push({id:u[0],typeName:u[1]})}}return p}async getRelationshipsFromNodes(e,s,r,i){const n=this._getNamedTypeIdMapFromNodeIds(e);if(n.size===0||s.length===0)return[];const a={relationshipExclusionIds:r,possibleConnectionEntityIds:s},o=[];for(const[l,u]of n.entries()){const b=`${l}_ids`;a[b]=u,o.push(`MATCH (n:${l}) WHERE id(n) IN $${b} WITH n MATCH (n)-[r]-(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}const p=o.join(" UNION "),c=new Map,y=(await le(this.knowledgeGraph,new ne({openCypherQuery:p,bindParameters:a}),{signal:i==null?void 0:i.signal})).resultRowsStream.getReader();for(;;){const{done:l,value:u}=await y.read();if(l)break;for(let b=0;b<u.length;b++){const v=u[b];let N=c.get(v[1]);N||(N=new Set,c.set(v[1],N)),N.add(v[0])}}const d=[];for(const[l,u]of c)for(const b of u)d.push({id:b,typeName:l});return d}async refreshCacheContent(e,s,r,i=!0,n){var y,d,l,u,b,v,N,R;const a=Le.getInstance(),o=[],p=new Map,c=new Map;(y=this.knowledgeGraph.dataModel.entityTypes)==null||y.forEach(f=>{f.name&&c.set(f.name,f)}),(d=this.knowledgeGraph.dataModel.relationshipTypes)==null||d.forEach(f=>{f.name&&c.set(f.name,f)}),e||this.inclusionModeDefinition?e?e.forEach(f=>{var $;if(this.memberIdTypeLookup.has(f))for(const A of this.memberIdTypeLookup.get(f))p.has(A)?($=p.get(A))==null||$.push(f):p.set(A,[f])}):(u=(l=this.inclusionModeDefinition)==null?void 0:l.namedTypeDefinitions)==null||u.forEach((f,$)=>{f.useAllData?p.set($,null):f.members&&f.members.forEach(A=>{var C;p.has($)&&p.get($)!==null?(C=p.get($))==null||C.push(A.id):p.set($,[A.id])})}):((b=this.knowledgeGraph.dataModel.entityTypes)==null||b.forEach(f=>{f.name&&p.set(f.name,null)}),(v=this.knowledgeGraph.dataModel.entityTypes)==null||v.forEach(f=>{f.name&&p.set(f.name,null)}));for(const[f,$]of p){const A=new Set($),C=new Promise((L,_)=>{(async()=>{var P,E,w,x,F,j,M,Q,S;const I=new Set,q=[];let G,O="",H=!1;if(s||((E=(P=c.get(f))==null?void 0:P.properties)==null||E.forEach(D=>{D.name&&I.add(D.name)})),r&&this.geographicLookup.has(f)){const D=(w=this.geographicLookup.get(f))==null?void 0:w.name;D&&I.add(D)}if(this.entityTypeNames.has(f))O=`MATCH (n:${f}) ${$?"WHERE id(n) IN $ids ":""}return ID(n)`,I.forEach(D=>{O+=`, n.${D}`,q.push(D)});else{if(!this.relationshipTypeNames.has(f))throw new ee("knowledge-graph:layer-data-manager",`The graph type of ${f} could not be determined. Was this type set in the KG data model and inclusion definition?`);H=!0,O=`MATCH ()-[n:${f}]->() ${$?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,I.forEach(D=>{O+=`, n.${D}`,q.push(D)})}G=new ne($?{openCypherQuery:O,bindParameters:{ids:$}}:{openCypherQuery:O});const U=(await le(this.knowledgeGraph,G,{signal:n==null?void 0:n.signal})).resultRowsStream.getReader();for(;;){const{done:D,value:Ae}=await U.read();if(D)break;const Oe=[];for(let K=0;K<Ae.length;K++){const se=Ae[K];let W=0,be=0;const B={properties:{}};for(B.id=se[W],W++,be++,H&&(B.originId=se[W],W++,be++,B.destinationId=se[W],W++,be++,Y(this.nodeConnectionsLookup,B.originId,()=>new Set).add(B.id),Y(this.nodeConnectionsLookup,B.destinationId,()=>new Set).add(B.id),Y(this.relationshipConnectionsLookup,B.id,()=>[B.originId,B.destinationId]));W<se.length;W++)B.properties[q[W-be]]=se[W];A.delete(B.id),Oe.push(B)}const _t=a.writeToStore(Oe,z,(x=this.geographicLookup.get(f))==null?void 0:x.name);this.sublayerCaches.has(f)||this.sublayerCaches.set(f,new Map),i&&!((F=this.inclusionModeDefinition)!=null&&F.namedTypeDefinitions.has(f))&&((j=this.inclusionModeDefinition)==null||j.namedTypeDefinitions.set(f,{useAllData:!1,members:new Map})),i&&!((M=this.inclusionModeDefinition)!=null&&M.namedTypeDefinitions.get(f).members)&&(this.inclusionModeDefinition.namedTypeDefinitions.get(f).members=new Map);const ve=this.sublayerCaches.get(f);_t.forEach(K=>{var se,W;ve==null||ve.set(K.attributes[z],K),i&&!((se=this.inclusionModeDefinition)!=null&&se.namedTypeDefinitions.get(f).members.has(K.attributes[z]))&&((W=this.inclusionModeDefinition)==null||W.namedTypeDefinitions.get(f).members.set(K.attributes[z],{id:K.attributes[z]}),Y(this.memberIdTypeLookup,K.attributes[z],()=>new Set).add(f))})}const te=(Q=this.inclusionModeDefinition)==null?void 0:Q.namedTypeDefinitions.get(f);if(te)for(const D of A)(S=te.members)==null||S.delete(D)})().then(()=>{L(null)}).catch(I=>{I.name==="AbortError"?L(null):_(I)})});o.push(C),(N=this._processingCacheUpdatesLookup.get(f))==null||N.push(C)}if(await Promise.all(o),(R=n==null?void 0:n.signal)==null?void 0:R.aborted)throw Lt()}removeFromLayer(e){var i,n,a;const s=new Set,r=new Set(e.map(o=>o.id));for(const o of e)s.add(o.typeName),((i=this.memberIdTypeLookup.get(o.id))==null?void 0:i.size)===1?this.memberIdTypeLookup.delete(o.id):(n=this.memberIdTypeLookup.get(o.id))==null||n.delete(o.typeName),(a=this.inclusionModeDefinition)==null||a.namedTypeDefinitions.forEach((p,c)=>{var y;c===o.typeName&&((y=p.members)!=null&&y.has(o.id))&&p.members.delete(o.id)});s.forEach(o=>{var p;(p=this.sublayerCaches.get(o))==null||p.forEach((c,y)=>{var d;r.has(y)&&((d=this.sublayerCaches.get(o))==null||d.delete(y))})})}async retrieveDataFromService(e,s,r){var v,N,R,f,$,A,C,L,_,k,I,q,G,O,H,U,te,P;const i=Le.getInstance(),n=new Set,a=[];let o,p="",c=[];const y=s.graphType==="relationship",d=(R=(N=(v=this.inclusionModeDefinition)==null?void 0:v.namedTypeDefinitions)==null?void 0:N.get(s.objectType.name))==null?void 0:R.useAllData,l=s.parentCompositeLayer.sublayerIdsCache.get(s.objectType.name);let u=!d&&l?Array.from(l).sort():null;if((A=($=(f=this.inclusionModeDefinition)==null?void 0:f.namedTypeDefinitions)==null?void 0:$.get(s.objectType.name))!=null&&A.useAllData)(_=(L=(C=this.inclusionModeDefinition)==null?void 0:C.namedTypeDefinitions)==null?void 0:L.get(s.objectType.name))!=null&&_.useAllData&&e.objectIds!=null&&(u=e.objectIds);else if(e.objectIds!=null&&u&&u.length>0){const E=e.objectIds;e.objectIds=u.filter(w=>E.includes(w))}else if(e.objectIds!=null)u=e.objectIds;else{if((k=this.inclusionModeDefinition)!=null&&k.namedTypeDefinitions.has(s.objectType.name)&&(!((I=this.inclusionModeDefinition.namedTypeDefinitions.get(s.objectType.name))!=null&&I.members)||((G=(q=this.inclusionModeDefinition.namedTypeDefinitions.get(s.objectType.name))==null?void 0:q.members)==null?void 0:G.size)<1))return e.objectIds=[],[];e.objectIds=u}if(e.outFields!=null){const E=e.outFields;E.includes("*")?s.fields.forEach(w=>{n.add(w.name)}):E.forEach(w=>{w!==z&&w!==s.geometryFieldName&&n.add(w)})}if(e.geometry!=null){const E=e.geometry;let w;const x=s.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,F=x==null?void 0:x.spatialReference,j=(O=x==null?void 0:x.serviceCapabilities)==null?void 0:O.geometryCapabilities;let M=j==null?void 0:j.geometryMaxBoundingRectangleSizeX,Q=j==null?void 0:j.geometryMaxBoundingRectangleSizeY;if(E.type==="point"){let S=E;(H=S.spatialReference)!=null&&H.isWGS84||(await Ie(S.spatialReference,re),S=he(S,re)),w=new Ee({spatialReference:re,xmin:S.x-1e-4,ymin:S.y-1e-4,xmax:S.x+1e-4,ymax:S.y+1e-4})}else(U=E==null?void 0:E.extent)!=null&&U.spatialReference&&!((te=E.spatialReference)!=null&&te.isWGS84)?(await Ie(E.extent.spatialReference,re),w=he(E.extent,re)):w=E.extent;if(M&&Q&&F){if(F.wkid!==4326){const S=new Ee({spatialReference:F,xmax:M,ymax:Q}),D=he(S,re);M=D.xmax,Q=D.ymax}if(w.xmax-w.xmin>M)throw new ee("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${M}° latitude, limit exceeded`);if(w.ymax-w.ymin>Q)throw new ee("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${Q}° longitude, limit exceeded`)}if(e.where!=null&&e.where!=="1=1"){const S=await qe(e.where.toUpperCase(),s.fieldsIndex);s.fields.forEach(D=>{S.fieldNames.includes(D.name)&&n.add(D.name)})}p=y?`Match ()-[n:${s.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${s.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${s.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${s.geometryFieldName}) return ID(n)`,s.geometryFieldName&&n.add(s.geometryFieldName),n.forEach(S=>{p+=`, n.${S}`,a.push(S)}),o=new ne({openCypherQuery:p,bindParameters:{param_filter_geom:new gt({rings:Xs(w)})}})}else{let E="";if(e.where!=null&&e.where!=="1=1"){const F=await qe(e.where,s.fieldsIndex);s.fields.forEach(M=>{F.fieldNames.includes(M.name)&&n.add(M.name)});const j={systemOidFieldName:z,supportedSqlTypes:new Set(["column-reference","string","number","binary-expression"]),supportedSqlOperators:new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]),unsupportedOperationFound:!1};E=Ce(F.parseTree,j),j.unsupportedOperationFound&&(E="")}let w="";w=y?`Match ()-[n:${s.objectType.name}]->()`:`Match (n:${s.objectType.name})`;let x=!1;u&&(x=!0,w+=" WHERE ID(n) IN $ids"),E&&(w+=x?" AND":" WHERE",w+=` ${E}`),w+=" return ID(n)",y&&(w+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&s.geometryFieldName&&n.add(s.geometryFieldName),n.forEach(F=>{w+=`, n.${F}`,a.push(F)}),o=new ne(u?{openCypherQuery:w,bindParameters:{ids:u}}:{openCypherQuery:w})}const b=(await le(s.parentCompositeLayer.dataManager.knowledgeGraph,o,r)).resultRowsStream.getReader();for(;;){const{done:E,value:w}=await b.read();if(E)break;const x=[];for(let F=0;F<w.length;F++){const j=w[F];let M=0,Q=0;const S={properties:{}};for(S.id=j[M],M++,Q++,y&&(S.originId=j[M],M++,Q++,S.destinationId=j[M],M++,Q++);M<j.length;M++)S.properties[a[M-Q]]=j[M];x.push(S)}c=c.concat(i.writeToStore(x,z,(P=s.parentCompositeLayer.dataManager.geographicLookup.get(s.objectType.name))==null?void 0:P.name))}return c}_isEndEntitySpatial(e,s,r){var i;for(const n of e??[])if(this.entityTypeNames.has(n)){const a=this.geographicLookup.get(n),o=a&&((i=this.sublayerCaches.get(n))==null?void 0:i.get(s.attributes[r]));if(a&&(o!=null&&o.attributes[a.name]))return!0}return!1}_getNamedTypeIdMapFromNodeIds(e){const s=new Map;return e.forEach(r=>{var i;if(this.memberIdTypeLookup.has(r))for(const n of this.memberIdTypeLookup.get(r)){if(!this.entityTypeNames.has(n))return;s.has(n)?(i=s.get(n))==null||i.push(r):s.set(n,[r])}}),s}};h([m()],Z.prototype,"knowledgeGraph",void 0),h([m()],Z.prototype,"inclusionModeDefinition",void 0),h([m()],Z.prototype,"entityTypeNames",void 0),h([m()],Z.prototype,"relationshipTypeNames",void 0),h([m()],Z.prototype,"geographicLookup",void 0),h([m()],Z.prototype,"sublayerCaches",void 0),h([m()],Z.prototype,"nodeConnectionsLookup",void 0),h([m()],Z.prototype,"relationshipConnectionsLookup",void 0),h([m()],Z.prototype,"memberIdTypeLookup",void 0),Z=h([$e("esri.layers.knowledgeGraph.KnowledgeGraphLayerDataManager")],Z);const er=Symbol("isKnowledgeGraphGraphicOriginSymbol");var ot;class tr extends bt{get[(ot=er,Mt)](){return this.sublayer}get[kt](){return this.sublayer}get[wt](){return this.sublayer}constructor(e,s){super(),this[ot]=!0,this.type="knowledge-graph",this.layer=e,this.sublayer=s}get id(){return this.layer.id}}const sr=Symbol("isLinkChartGraphicOriginSymbol");var lt;class rr extends bt{get[(lt=sr,wt)](){return this.layer}constructor(e,s){super(),this[lt]=!0,this.type="link-chart",this.layer=e,this.sublayer=s}get id(){return`${this.layer.id}:__${this.sublayer.id}__`}}const pt=Dt(),ir=t=>{const e=t;let s=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return h([m(pt.fields)],s.prototype,"fields",void 0),h([m(pt.fieldsIndex)],s.prototype,"fieldsIndex",void 0),s=h([$e("esri.layers.knowledgeGraph.KnowledgeGraphSublayerBase")],s),s},nr=Ct;let X=class extends mt{constructor(t){super(t),this.entityAdds=void 0,this.entityUpdates=void 0,this.entityDeletes=void 0,this.relationshipAdds=void 0,this.relationshipUpdates=void 0,this.relationshipDeletes=void 0,this.options=void 0}};h([m()],X.prototype,"entityAdds",void 0),h([m()],X.prototype,"entityUpdates",void 0),h([m()],X.prototype,"entityDeletes",void 0),h([m()],X.prototype,"relationshipAdds",void 0),h([m()],X.prototype,"relationshipUpdates",void 0),h([m()],X.prototype,"relationshipDeletes",void 0),h([m()],X.prototype,"options",void 0),X=h([$e("esri.rest.knowledgeGraph.GraphApplyEdits")],X);const ar={initializeLayersFromClientData:async(t,e,s)=>{if(e||(e=[...t.layers,...t.tables].map(n=>n.graphTypeName)),(e==null?void 0:e.length)===0)return;const r=new Map;for(const n of e)r.set(n,dt(t,n));const i=await _s(t.dataManager.knowledgeGraph,Array.from(r.values()),{requestOptions:{signal:s==null?void 0:s.signal}});for(const n of[...t.layers,...t.tables]){const a=n.objectType.name;if(a==null)continue;const o=i.get(dt(t,a));if(o){const p=JSON.parse(o);p===null||typeof p!="object"||p.hasOwnProperty("showLabels")||(p.showLabels=!1),n.read(p,{origin:"service"})}}}},dt=(t,e)=>t.type==="knowledge-graph"?`${e}/Map`:`${e}/LinkChart/LinkChartSubLayer`;async function Wr(t,e,s){return ar.initializeLayersFromClientData(t,e,s)}const ut=["#4a0932","#b31515","#18382e","#a64f1b","#102432","#8c213f","#ed9310","#2c6954","#144d59","#ffc730","#75351e","#454f4b","#78b1c2","#191921","#8f8f82","#9be0c0","#dbb658","#87b051","#11495c","#c43541","#9c5596","#44498b","#ad9d63","#86afb3","#5c98ca","#b0bfa2","#73241f","#b86b53","#d9d78c","#3e756d","#f260a1","#a0d17d","#c27c30","#eb82eb","#ffdf3c","#ffb259","#ab52b3","#3cccb4","#0095ba","#d92b30"],or="#8f8f82";function lr(t){return t<0||t>=ut.length?new Pe(or):new Pe(ut[t])}function pr(t){const e=t.toArray();return new At({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,style:"solid",width:.75,color:e},{type:"CIMVectorMarker",enable:!0,size:6,markerPlacement:{type:"CIMMarkerPlacementOnLine",angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-10,ymin:-5,xmax:0,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[-12,-3.47],[-12,3.6],[1.96,-.03],[-12,-3.47]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:e}]}}]}]}}})}function dr(t){let e="ESRI__ID",s=4;for(const r of t)if(r.name){if(r.name.toLowerCase()==="name"){e=r.name;break}r.name.toLowerCase().includes("name")?(e=r.name,s=2):r.fieldType==="esriFieldTypeString"&&s>3&&(e=r.name,s=3)}return e}function ur(t,e,s){const r={color:[80,80,80],haloColor:[255,255,255],haloSize:.7,font:{size:10,weight:"normal"}},i=new pe({labelExpressionInfo:new fe({expression:s==="ESRI__ID"?`${e}`:`$feature.${s}`}),labelPlacement:"above-center",symbol:new me(r)}),n=new pe({labelExpressionInfo:new fe({expression:`'${e}' + IIf($feature.ESRI__AggregationCount>1, ' (' + $feature.ESRI__AggregationCount + ')', '')`}),labelPlacement:"center-along",labelPosition:"parallel",repeatLabel:!1,symbol:new me({...r,yoffset:"12px"})});return t==="entity"?[i]:[n]}function cr(t,e,s){const r={color:[255,255,255],haloColor:[0,0,0],haloSize:.7,font:{size:10,weight:"bold"}},i=s==="ESRI__ID"?`${t}`:`$feature.${s}`;return e==="point"?[new pe({labelExpressionInfo:new fe({expression:i}),labelPlacement:"above-center",symbol:new me(r)})]:e==="polyline"?[new pe({labelExpressionInfo:new fe({expression:i}),labelPlacement:"center-along",repeatLabel:!0,symbol:new me(r)})]:e==="polygon"?[new pe({labelExpressionInfo:new fe({expression:i}),labelPlacement:"always-horizontal",symbol:new me(r)})]:null}const yr={capabilities:[],allowGeometryUpdates:!1,serviceCapabilities:{geometryCapabilities:{supportsZValues:!1,supportsMValues:!1}}};function hr(t){const{capabilities:e,allowGeometryUpdates:s,serviceCapabilities:{geometryCapabilities:{supportsZValues:r,supportsMValues:i}}}=(t==null?void 0:t.serviceDefinition)||yr,n=t!=null&&t.dataModel.arcgisManaged?e:e.filter(o=>o==="Query"),a=new Set(n);return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:i,supportsZ:r},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:a.has("Create"),supportsDelete:a.has("Delete"),supportsEditing:a.has("Editing"),supportsChangeTracking:!1,supportsQuery:a.has("Query"),supportsQueryBins:!1,supportsQueryPivot:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:a.has("Update"),supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},query:Ft,queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryAttributeBins:xt,editing:{supportsGeometryUpdate:!!(t!=null&&t.dataModel.arcgisManaged)&&s,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:a.has("Delete"),supportsUpdateByAnonymous:!1,supportsUpdateByOthers:a.has("Update"),supportsAsyncApplyEdits:!1,zDefault:void 0}}}async function mr(t,e){var y;const s=new X,r=e.graphTypeName,i=e.graphType,n=e.parentCompositeLayer.type==="knowledge-graph"?e.geometryFieldName:null,a=!!((y=e.fieldsIndex.get(n))!=null&&y.editable),o=d=>{const l={...d};for(const u of e.fields)u.editable||delete l[u.name];for(const u of Object.keys(d))u.includes("ESRI__")&&delete l[u];return l},p=async d=>{await Ie(d.spatialReference,Te.WGS84);const l=he(d,Te.WGS84);return l.type==="point"?l.normalize():(await qt(l))[0]};for(const d of t.addFeatures??[]){const l=o(d.attributes);Ge(d.sourceLayer)&&d.sourceLayer.graphTypeName===r&&(i==="entity"?(s.entityAdds||(s.entityAdds=[]),n&&d.geometry&&(l[n]=await p(d.geometry)),s.entityAdds.push(new Qe({properties:l,typeName:r}))):(s.relationshipAdds||(s.relationshipAdds=[]),s.relationshipAdds.push(new We({properties:l,typeName:r}))))}for(const d of t.updateFeatures??[]){const l=d.attributes[z],u=o(d.attributes);Ge(d.sourceLayer)&&d.sourceLayer.graphTypeName===r&&(i==="entity"?(s.entityUpdates||(s.entityUpdates=[]),n&&a&&d.geometry&&(u[n]=await p(d.geometry)),s.entityUpdates.push(new Qe({id:l,properties:u,typeName:r}))):(s.relationshipUpdates||(s.relationshipUpdates=[]),s.relationshipUpdates.push(new We({id:l,properties:u,typeName:r}))))}const c=new Map;for(const d of t.deleteFeatures??[])if(jt(d)){const l=d,u=Y(c,l.sourceLayer.graphTypeName,()=>({typeName:l.sourceLayer.graphTypeName,ids:[]}));l.sourceLayer.graphTypeName===r&&u.ids.push(l.attributes[z])}else d.objectId&&typeof d.objectId=="string"&&Y(c,r,()=>({typeName:r,ids:[]})).ids.push(d.objectId);for(const d of c.values())d.ids.length>0&&(i==="entity"?(s.entityDeletes||(s.entityDeletes=[]),s.entityDeletes.push({typeName:d.typeName,ids:d.ids})):(s.relationshipDeletes||(s.relationshipDeletes=[]),s.relationshipDeletes.push({typeName:d.typeName,ids:d.ids})));return s}function fr(t,e){const s={addFeatureResults:[],updateFeatureResults:[],deleteFeatureResults:[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]};for(const r of t.editResults)if(r.typeName===e){for(const i of r.adds)s.addFeatureResults.push({objectId:i.id,globalId:i.id});for(const i of r.updates)s.updateFeatureResults.push({objectId:i.id,globalId:i.id});for(const i of r.deletes)s.deleteFeatureResults.push({objectId:i.id,globalId:i.id})}return s}function gr(t){if(!t.objectType)return null;const e=[];for(const s of t.fields)!s.name.includes("ESRI__")&&s.editable&&s.type!=="geometry"&&e.push(new nr({fieldName:s.name}));return new Rt({elements:e})}function br(t){if(!t.objectType)return null;let e=null;switch(t.geometryType){case"point":case"multipoint":e="point";break;case"polyline":e="line";break;case"polygon":e="polygon";break;default:e=null}return[new Ot({name:t.graphTypeName,drawingTool:e,prototype:{}})]}function J(t){if(!t.json)return t;t.json.write=ct(t.json.write);const e=t.json.origins;if(!e)return t;let s;for(s in e){const r=e[s];r&&(r.write=ct(r.write))}return t}function ct(t){return typeof t=="object"&&t?(t.enabled!==!1&&(t.overridePolicy=wr(t)),t):t===!0?ce():t}function wr(t){const{target:e,writer:s,overridePolicy:r,...i}=t;return function(n,a){const o=Et.call(this,n,a);return o.enabled?{...i,...o}:o}}function ce(){return{overridePolicy:Et}}function Et(t,e){const s=!!this.geometryType;let r={enabled:s};return s&&(r={...r,...ye.call(this,t,e)}),r}function ye(t,e){return{ignoreOrigin:this.originIdOf(e)>0}}let g=class extends ir(Pt(Gt(Ut(zt(Ht(Qt(Wt(Bt(Vt(rs)))))))))){constructor(t){super(t),this.blendMode="normal",this.charts=null,this.definitionExpression=null,this.displayFilterEnabled=!0,this.displayFilterInfo=null,this.effect=null,this.elevationInfo=null,this.featureEffect=null,this.graphType=null,this.labelsVisible=!0,this.layerType=null,this.legendEnabled=!0,this.maxScale=0,this.minScale=0,this.objectIdField=z,this.objectType=null,this.opacity=1,this.orderBy=null,this.parent=null,this.parentCompositeLayer=null,this.persistenceEnabled=!0,this.popupEnabled=!0,this.popupTemplate=null,this.refreshInterval=0,this.source={openPorts:()=>this.load().then(()=>{const e=new MessageChannel;return new Jt(e.port1,{channel:e,client:{queryFeatures:(s,r={})=>{const i=oe.fromJSON(s);return this.queryFeaturesJSON(i,r)}}}),[e.port2]})},this.type="knowledge-graph-sublayer",this.useViewTime=!0,this.visible=!0}get capabilities(){return this.parent?this.parent.sublayerCapabilities:hr(null)}get userHasUpdateItemPrivileges(){var t;return!!((t=this.parent)!=null&&t.userHasUpdateItemPrivileges)}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.capabilities.operations.supportsEditing}set editingEnabled(t){this._overrideIfSome("editingEnabled",t)}get isTable(){return this.parentCompositeLayer.type!=="link-chart"&&this.geometryFieldName==null}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(t){const e=this._normalizeFeatureReduction(t);this._set("featureReduction",e)}get fields(){var e,s;const t=[];return(s=(e=this.objectType)==null?void 0:e.properties)==null||s.forEach(r=>{const i=r.fieldType==="esriFieldTypeOID"?"esriFieldTypeInteger":r.fieldType;t.push(we.fromJSON({name:r.name,type:i,alias:r.alias,defaultValue:r.defaultValue,editable:r.editable,nullable:r.nullable}))}),t.push(we.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1}),we.fromJSON({name:ke,type:"esriFieldTypeInteger",alias:ke,editable:!1}),we.fromJSON({name:ge,type:"esriFieldTypeInteger",alias:ge,editable:!1})),t}get formTemplate(){return this._isOverridden("formTemplate")?this._get("formTemplate"):gr(this)}set formTemplate(t){this._overrideIfSome("formTemplate",t)}get geometryType(){var s,r,i;if(((s=this.parentCompositeLayer)==null?void 0:s.type)==="link-chart")return this.graphType==="relationship"?"polyline":"point";const t=(i=this.parentCompositeLayer)==null?void 0:i.dataManager.geographicLookup.get((r=this.objectType)==null?void 0:r.name),e=t==null?void 0:t.geometryType;return e&&e!=="esriGeometryNull"?ue.fromJSON(e):null}get geometryFieldName(){var e,s,r;if(((e=this.parentCompositeLayer)==null?void 0:e.type)==="link-chart")return Re;const t=(r=this.parentCompositeLayer)==null?void 0:r.dataManager.geographicLookup.get((s=this.objectType)==null?void 0:s.name);return(t==null?void 0:t.name)??null}get graphicOrigin(){if(!this.parent)return null;switch(this.parent.type){case"knowledge-graph":return new tr(this.parent,this);case"link-chart":return new rr(this.parent,this)}}get graphTypeName(){var t;return(t=this.objectType)==null?void 0:t.name}set graphTypeName(t){this._set("graphTypeName",t)}get hasM(){var r,i,n,a;const t=(i=this.parentCompositeLayer)==null?void 0:i.dataManager.geographicLookup.get((r=this.objectType)==null?void 0:r.name),e=t==null?void 0:t.name,s=e?(a=(n=this.objectType)==null?void 0:n.properties)==null?void 0:a[e]:null;return(s==null?void 0:s.hasM)??!1}get hasZ(){var r,i,n,a;const t=(i=this.parentCompositeLayer)==null?void 0:i.dataManager.geographicLookup.get((r=this.objectType)==null?void 0:r.name),e=t==null?void 0:t.name,s=e?(a=(n=this.objectType)==null?void 0:n.properties)==null?void 0:a[e]:null;return(s==null?void 0:s.hasZ)??!1}set labelingInfo(t){this._set("labelingInfo",t)}get labelingInfo(){if(this._isOverridden("labelingInfo"))return this._get("labelingInfo");if(!this.objectType||!this.parentCompositeLayer||!this.graphTypeName)return null;const t=this.objectType.properties?dr(this.objectType.properties):"ESRI__ID";return this.parentCompositeLayer.type==="link-chart"?ur(this.graphType,this.graphTypeName,t):cr(this.graphTypeName,this.geometryType,t)}set renderer(t){Zt(t,this.fieldsIndex),this._set("renderer",t)}get renderer(){var i,n,a,o;if(this._isOverridden("renderer"))return this._get("renderer");const t=(a=(n=(i=this.parentCompositeLayer)==null?void 0:i.dataManager)==null?void 0:n.knowledgeGraph)==null?void 0:a.dataModel,e=[...(t==null?void 0:t.entityTypes)??[],...(t==null?void 0:t.relationshipTypes)??[]].map(p=>p.name).indexOf(this.graphTypeName),s=lr(e);if(((o=this.parentCompositeLayer)==null?void 0:o.type)==="link-chart"){if(this.graphType==="relationship")return new Yt({type:"simple",symbol:pr(s)});const p=Ue(ze(ue.toJSON("point")).renderer);return He(p.symbol,s),p}const r=Ue(ze(ue.toJSON(this.geometryType)).renderer);return He(r.symbol,s),r}get spatialReference(){var t,e,s,r;return((r=(s=(e=(t=this.parentCompositeLayer)==null?void 0:t.dataManager)==null?void 0:e.knowledgeGraph)==null?void 0:s.dataModel)==null?void 0:r.spatialReference)??Te.WGS84}get templates(){return this._isOverridden("templates")?this._get("templates"):br(this)}set templates(t){this._overrideIfSome("templates",t)}set timeInfo(t){this._set("timeInfo",t)}get title(){return this._isOverridden("title")?this._get("title"):this.graphTypeName}set title(t){this._set("title",t)}writeTitle(t,e){e.title=t??"Layer"}createPopupTemplate(t){return Kt(this,t)}createQuery(){return new oe({where:"1=1",outFields:["*"]})}getField(t){return this.fieldsIndex.get(t)}getFieldDomain(t,e){return null}async queryFeatures(t,e){await this.load();const{resolvedQuery:s,queryEngine:r}=await this._setupQueryObjects(t),i=this.graphicOrigin,n=Xt.fromJSON(await r.executeQuery(s.toJSON(),e==null?void 0:e.signal));return n.features.forEach(a=>{a.sourceLayer=this,a.origin=i}),n}async queryFeaturesJSON(t,e){await this.load();const{resolvedQuery:s,queryEngine:r}=await this._setupQueryObjects(t);return await r.executeQuery(s.toJSON(),e==null?void 0:e.signal)}async queryFeatureCount(t,e){await this.load();const{resolvedQuery:s,queryEngine:r}=await this._setupQueryObjects(t);return r.executeQueryForCount(s.toJSON(),e==null?void 0:e.signal)}async queryExtent(t={},e){var o,p,c,y;await this.load();const s={...t,returnGeometry:!0},{resolvedQuery:r,queryEngine:i}=await this._setupQueryObjects(s),n=await i.executeQueryForExtent(r.toJSON(),e==null?void 0:e.signal);let a;return a=((o=n.extent)==null?void 0:o.xmin)!=null&&((p=n.extent)==null?void 0:p.xmax)!=null&&((c=n.extent)==null?void 0:c.ymin)!=null&&((y=n.extent)==null?void 0:y.ymax)!=null?new Ee(n.extent):new Ee,{count:n.count,extent:a}}async queryObjectIds(t,e){await this.load();const s=oe.from(t);let r;if(this.parentCompositeLayer.type==="link-chart"&&this._cachedQueryEngine)r=this._cachedQueryEngine;else{const i=await this.parentCompositeLayer.dataManager.getData(s,this,e);r=this.loadQueryEngine(i)}return await r.executeQueryForIds(s.toJSON(),e==null?void 0:e.signal)}async applyEdits(t){var n;if(!this.parentCompositeLayer.dataManager.knowledgeGraph)throw new ee("knowledge-graph-sublayer:no-knowledge-graph","ApplyEdits cannot be executed because the parent does not have a Knowledge Graph model.  This is usually caused by the layer not yet being loaded");const e=await mr(t,this);e.options={cascadeDelete:!0,cascadeProvenanceDelete:!!((n=this.parent)!=null&&n.knowledgeGraph.serviceDefinition.supportsProvenance)||void 0};const s=await Ns(this.parentCompositeLayer.dataManager.knowledgeGraph,e),r=fr(s,this.graphTypeName),i={addedFeatures:r.addFeatureResults,updatedFeatures:r.updateFeatureResults,deletedFeatures:r.deleteFeatureResults,addedAttachments:r.addAttachmentResults,deletedAttachments:r.deleteAttachmentResults,updatedAttachments:r.updateAttachmentResults,exceededTransferLimit:!1,historicMoment:new Date,edits:void 0};return this.emit("edits",i),this.emit("apply-edits",{result:Promise.resolve(i)}),this.parentCompositeLayer.type==="link-chart"&&await this.parentCompositeLayer.refreshLinkChartCache([...i.addedFeatures.map(a=>a.globalId),...i.updatedFeatures.map(a=>a.globalId),...i.deletedFeatures.map(a=>a.globalId)]),r}loadQueryEngine(t){var r;const e=new vs({geometryType:ue.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),s=new Ss({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:ue.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,featureIdInfo:{type:"object-id",fieldName:this.objectIdField},spatialReference:this.spatialReference.toJSON(),timeInfo:(r=this.timeInfo)==null?void 0:r.toJSON(),featureStore:e});return s.featureStore.addMany(t),s}async refreshCachedQueryEngine(){const t=await this.parentCompositeLayer.dataManager.getData(new oe({where:"1=1",outFields:[z]}),this);this._cachedQueryEngine=this.loadQueryEngine(t)}load(t){return this.addResolvingPromise(this.parent.load(t).then(()=>es(this.timeInfo,this.fieldsIndex))),Promise.resolve(this)}async _setupQueryObjects(t,e){var n;const s=oe.from(t),r=s.geometry;if(r&&!((n=r.spatialReference)!=null&&n.isWGS84)&&(await Ie(r.spatialReference,re),s.geometry=he(r instanceof gt||r instanceof ts||r instanceof ss?r:r.extent,re)),this.parentCompositeLayer.type==="link-chart"&&this._cachedQueryEngine)return{resolvedQuery:s,queryEngine:this._cachedQueryEngine};const i=await this.parentCompositeLayer.dataManager.getData(s,this,e);return{resolvedQuery:s,queryEngine:this.loadQueryEngine(i)}}};function Tr(t,e,s){var i,n;const r=[["ESRI__AGGREGATION_COUNT",ke],["ESRI__ORIGIN_ID",_e],["ESRI__DESTINATION_ID",Ne],["ESRI__LAYOUT_GEOMETRY",Re]];try{for(const a of t)for(const[o,p]of r)a.labelExpression=(i=a.labelExpression)==null?void 0:i.replaceAll(o,p),(n=a.labelExpressionInfo)!=null&&n.expression&&(a.labelExpressionInfo.expression=a.labelExpressionInfo.expression.replaceAll(o,p))}catch(a){ft.getLogger(this).warn("Error updating labelingInfo",a)}return Is(t,e,s)}h([m(J(V(is)))],g.prototype,"blendMode",void 0),h([m({readOnly:!0})],g.prototype,"capabilities",null),h([m({readOnly:!0})],g.prototype,"userHasUpdateItemPrivileges",null),h([m({type:Boolean})],g.prototype,"editingEnabled",null),h([m()],g.prototype,"isTable",null),h([m({json:{origins:{"web-scene":{write:!1}},write:ce()}})],g.prototype,"charts",void 0),h([m({readOnly:!0})],g.prototype,"defaultPopupTemplate",null),h([m({type:String,json:{origins:{service:{read:!1}},name:"layerDefinition.definitionExpression",write:{ignoreOrigin:!0}}})],g.prototype,"definitionExpression",void 0),h([m(J(V(ns)))],g.prototype,"displayFilterEnabled",void 0),h([m(J(V(as)))],g.prototype,"displayFilterInfo",void 0),h([m(J(V(os)))],g.prototype,"effect",void 0),h([m()],g.prototype,"elevationInfo",void 0),h([m(J(V(ls)))],g.prototype,"featureEffect",void 0),h([m(J(V(ps)))],g.prototype,"featureReduction",null),h([m()],g.prototype,"fields",null),h([m()],g.prototype,"formTemplate",null),h([m()],g.prototype,"geometryType",null),h([m()],g.prototype,"geometryFieldName",null),h([m({readOnly:!0})],g.prototype,"graphicOrigin",null),h([m({type:["entity","relationship"],nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],g.prototype,"graphType",void 0),h([m({type:String,nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],g.prototype,"graphTypeName",null),h([m()],g.prototype,"hasM",null),h([m()],g.prototype,"hasZ",null),h([m({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],g.prototype,"id",void 0),h([m({type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",default:!1,write:{overridePolicy(){return{enabled:!!this.geometryType,alwaysWriteDefaults:!0,ignoreOrigin:!0}}}}})],g.prototype,"labelsVisible",void 0),h([m({type:[pe],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:Tr,write:ce()}})],g.prototype,"labelingInfo",null),h([m({readOnly:!0,json:{read:!1,write:{writer(t,e){var s;switch((s=this.parentCompositeLayer)==null?void 0:s.type){case"link-chart":e.layerType="LinkChartSubLayer";break;case"knowledge-graph":e.layerType=this.geometryType?"KnowledgeGraphSubLayer":"KnowledgeGraphSubTable"}},isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],g.prototype,"layerType",void 0),h([m(J(V(ds)))],g.prototype,"legendEnabled",void 0),h([m(J(V(us)))],g.prototype,"maxScale",void 0),h([m(J(V(cs)))],g.prototype,"minScale",void 0),h([m()],g.prototype,"objectIdField",void 0),h([m()],g.prototype,"objectType",void 0),h([m(J(V(ys)))],g.prototype,"opacity",void 0),h([m(J(V(hs)))],g.prototype,"orderBy",void 0),h([m({clonable:!1})],g.prototype,"parent",void 0),h([m()],g.prototype,"parentCompositeLayer",void 0),h([m(J(V(ms)))],g.prototype,"popupEnabled",void 0),h([m({type:fs,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],g.prototype,"popupTemplate",void 0),h([m({type:Number,json:{write:{overridePolicy:ye}}})],g.prototype,"refreshInterval",void 0),h([m({types:gs,json:{name:"layerDefinition.drawingInfo.renderer",write:ce()}})],g.prototype,"renderer",null),h([m()],g.prototype,"source",void 0),h([m()],g.prototype,"spatialReference",null),h([m()],g.prototype,"templates",null),h([m({type:bs,json:{name:"layerDefinition.timeInfo",write:{overridePolicy:ye},origins:{"web-document":{name:"layerDefinition.timeInfo",read:!0,write:{overridePolicy:ye}},"portal-item":{name:"layerDefinition.timeInfo",read:!0,write:{overridePolicy:ye}}}}})],g.prototype,"timeInfo",null),h([m({type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],g.prototype,"title",null),h([ws("title")],g.prototype,"writeTitle",null),h([m({json:{read:!1}})],g.prototype,"type",void 0),h([m(J(V(Ts)))],g.prototype,"useViewTime",void 0),h([m({type:Boolean,json:{name:"visibility",write:ce()}})],g.prototype,"visible",void 0),g=h([$e("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],g);export{st as A,Hr as C,hr as F,Gr as I,Wr as L,g as N,rt as P,Z as a,at as b,it as c,nt as d,tt as e,qr as f,zr as g,Le as o,et as p,Ur as r,Pr as w};
