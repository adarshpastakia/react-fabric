import{b6 as h,bj as c,bo as V,b as w,f7 as u,ar as d,f8 as p,bl as _,eo as A,E as n,F as r,V as v}from"./ShadowCastClear.glsl.js";let a=class extends h{get updating(){return this._createAnalysisViewTask!=null||this.analysisView!=null&&this.analysisView.updating}constructor(s){super(s),this._analysisModule=null,this._emitOnView=(e,i)=>this.parent.view.emit(e,i)}initialize(){this.addHandles(c(()=>this.getAnalysis(),s=>this._createAnalysisView(s),V))}destroy(){this._destroyAnalysisView()}async whenAnalysisView(){if(this.analysisView!=null)return this.analysisView;if(this._createAnalysisViewTask!=null)return this._createAnalysisViewTask.promise;throw new w("layerview:no-analysisview-for-analysis","The analysis is not set on the layer of this layer view")}_createAnalysisView(s){var l;const e=(l=this._createAnalysisViewTask)==null?void 0:l.promise;if(this._destroyAnalysisView(),!s)return;const i=u(async y=>{try{await Promise.allSettled([e]);const t=await this._createAnalysisViewPromise(s,y);return d(y),this.analysisView=t,this._emitOnView("analysis-view-create",{analysis:s,analysisView:t}),t}catch(t){throw this._emitOnView("analysis-view-create-error",{analysis:s,error:t}),t}finally{this._createAnalysisViewTask===i&&(this._createAnalysisViewTask=null)}});this._createAnalysisViewTask=i}_destroyAnalysisView(){const s=this.getAnalysis();this._createAnalysisViewTask=p(this._createAnalysisViewTask);const{analysisView:e}=this;e&&(this.analysisView=_(e),this._emitOnView("analysis-view-destroy",{analysis:s,analysisView:e}))}async _createAnalysisViewPromise(s,e){let i,l=this._analysisModule;const y=t=>{if(!A(t))return;i==null||i.destroy();const o=this.getAnalysis();throw new w("layerview:no-analysisview-for-analysis",o!=null&&s!==o?"The analysis changed before the analysis view could be created":"The analysis is not set on the layer of this layer view",{analysis:s})};return l||(l=await this.loadAnalysisViewModule(),y(e),this._analysisModule=l),i=new l.default({analysis:s,parent:this.parent,view:this.parent.view}),await i.when(),y(e),i}};n([r({constructOnly:!0})],a.prototype,"getAnalysis",void 0),n([r({constructOnly:!0})],a.prototype,"loadAnalysisViewModule",void 0),n([r({constructOnly:!0})],a.prototype,"parent",void 0),n([r()],a.prototype,"analysisView",void 0),n([r()],a.prototype,"_createAnalysisViewTask",void 0),n([r()],a.prototype,"updating",null),n([r()],a.prototype,"_analysisModule",void 0),a=n([v("esri.views.3d.layers.support.LayerViewAnalysisViewManager")],a);export{a as h};
