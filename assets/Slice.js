import{G as ce,d as re,e as fe,s as de}from"./Label.js";import{i as ae}from"./Disposer.js";import{P as ue}from"./Percent.js";import{w as he,c as C}from"./Tick.js";const le=Math.abs,y=Math.atan2,Y=Math.cos,ge=Math.max,te=Math.min,N=Math.sin,k=Math.sqrt,R=1e-12,z=Math.PI,Q=z/2,ye=2*z;function me(s){return s>1?0:s<-1?z:Math.acos(s)}function oe(s){return s>=1?Q:s<=-1?-Q:Math.asin(s)}function pe(s){return s.innerRadius}function Re(s){return s.outerRadius}function xe(s){return s.startAngle}function ve(s){return s.endAngle}function be(s){return s&&s.padAngle}function Ae(s,l,c,g,d,o,h,n){var x=c-s,a=g-l,e=h-d,b=n-o,i=b*x-e*a;if(!(i*i<R))return i=(e*(l-o)-b*(s-d))/i,[s+i*x,l+i*a]}function L(s,l,c,g,d,o,h){var n=s-c,x=l-g,a=(h?o:-o)/k(n*n+x*x),e=a*x,b=-a*n,i=s+e,u=l+b,m=c+e,p=g+b,G=(i+m)/2,f=(u+p)/2,A=m-i,v=p-u,w=A*A+v*v,M=d-o,T=i*p-m*u,j=(v<0?-1:1)*k(ge(0,M*M*w-T*T)),S=(T*v-A*j)/w,q=(-T*A-v*j)/w,I=(T*v+A*j)/w,P=(-T*A+v*j)/w,D=S-G,t=q-f,r=I-G,X=P-f;return D*D+t*t>r*r+X*X&&(S=I,q=P),{cx:S,cy:q,x01:-e,y01:-b,x11:S*(d/M-1),y11:q*(d/M-1)}}function Pe(){var s=pe,l=Re,c=C(0),g=null,d=xe,o=ve,h=be,n=null,x=he(a);function a(){var e,b,i=+s.apply(this,arguments),u=+l.apply(this,arguments),m=d.apply(this,arguments)-Q,p=o.apply(this,arguments)-Q,G=le(p-m),f=p>m;if(n||(n=e=x()),u<i&&(b=u,u=i,i=b),!(u>R))n.moveTo(0,0);else if(G>ye-R)n.moveTo(u*Y(m),u*N(m)),n.arc(0,0,u,m,p,!f),i>R&&(n.moveTo(i*Y(p),i*N(p)),n.arc(0,0,i,p,m,f));else{var A=m,v=p,w=m,M=p,T=G,j=G,S=h.apply(this,arguments)/2,q=S>R&&(g?+g.apply(this,arguments):k(i*i+u*u)),I=te(le(u-i)/2,+c.apply(this,arguments)),P=I,D=I,t,r;if(q>R){var X=oe(q/i*N(S)),B=oe(q/u*N(S));(T-=X*2)>R?(X*=f?1:-1,w+=X,M-=X):(T=0,w=M=(m+p)/2),(j-=B*2)>R?(B*=f?1:-1,A+=B,v-=B):(j=0,A=v=(m+p)/2)}var $=u*Y(A),E=u*N(A),F=i*Y(M),H=i*N(M);if(I>R){var J=u*Y(v),K=u*N(v),U=i*Y(w),V=i*N(w),O;if(G<z)if(O=Ae($,E,U,V,J,K,F,H)){var W=$-O[0],Z=E-O[1],_=J-O[0],ee=K-O[1],ie=1/N(me((W*_+Z*ee)/(k(W*W+Z*Z)*k(_*_+ee*ee)))/2),se=k(O[0]*O[0]+O[1]*O[1]);P=te(I,(i-se)/(ie-1)),D=te(I,(u-se)/(ie+1))}else P=D=0}j>R?D>R?(t=L(U,V,$,E,u,D,f),r=L(J,K,F,H,u,D,f),n.moveTo(t.cx+t.x01,t.cy+t.y01),D<I?n.arc(t.cx,t.cy,D,y(t.y01,t.x01),y(r.y01,r.x01),!f):(n.arc(t.cx,t.cy,D,y(t.y01,t.x01),y(t.y11,t.x11),!f),n.arc(0,0,u,y(t.cy+t.y11,t.cx+t.x11),y(r.cy+r.y11,r.cx+r.x11),!f),n.arc(r.cx,r.cy,D,y(r.y11,r.x11),y(r.y01,r.x01),!f))):(n.moveTo($,E),n.arc(0,0,u,A,v,!f)):n.moveTo($,E),!(i>R)||!(T>R)?n.lineTo(F,H):P>R?(t=L(F,H,J,K,i,-P,f),r=L($,E,U,V,i,-P,f),n.lineTo(t.cx+t.x01,t.cy+t.y01),P<I?n.arc(t.cx,t.cy,P,y(t.y01,t.x01),y(r.y01,r.x01),!f):(n.arc(t.cx,t.cy,P,y(t.y01,t.x01),y(t.y11,t.x11),!f),n.arc(0,0,i,y(t.cy+t.y11,t.cx+t.x11),y(r.cy+r.y11,r.cx+r.x11),f),n.arc(r.cx,r.cy,P,y(r.y11,r.x11),y(r.y01,r.x01),!f))):n.arc(0,0,i,M,w,f)}if(n.closePath(),e)return n=null,e+""||null}return a.centroid=function(){var e=(+s.apply(this,arguments)+ +l.apply(this,arguments))/2,b=(+d.apply(this,arguments)+ +o.apply(this,arguments))/2-z/2;return[Y(b)*e,N(b)*e]},a.innerRadius=function(e){return arguments.length?(s=typeof e=="function"?e:C(+e),a):s},a.outerRadius=function(e){return arguments.length?(l=typeof e=="function"?e:C(+e),a):l},a.cornerRadius=function(e){return arguments.length?(c=typeof e=="function"?e:C(+e),a):c},a.padRadius=function(e){return arguments.length?(g=e==null?null:typeof e=="function"?e:C(+e),a):g},a.startAngle=function(e){return arguments.length?(d=typeof e=="function"?e:C(+e),a):d},a.endAngle=function(e){return arguments.length?(o=typeof e=="function"?e:C(+e),a):o},a.padAngle=function(e){return arguments.length?(h=typeof e=="function"?e:C(+e),a):h},a.context=function(e){return arguments.length?(n=e??null,a):n},a}class ne extends ce{constructor(){super(...arguments),Object.defineProperty(this,"ix",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"iy",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_generator",{enumerable:!0,configurable:!0,writable:!0,value:Pe()})}_getTooltipPoint(){let l=this.get("tooltipX"),c=this.get("tooltipY"),g=0,d=0;ae(l)&&(g=l),ae(c)&&(d=c);let o=this.get("radius",0),h=this.get("innerRadius",0),n=this.get("dRadius",0),x=this.get("dInnerRadius",0);return o+=n,h+=x,h<0&&(h=o+h),l instanceof ue&&(g=this.ix*(h+(o-h)*l.value)),c instanceof ue&&(d=this.iy*(h+(o-h)*c.value)),this.get("arc")>=360&&h==0&&(g=0,d=0),{x:g,y:d}}_beforeChanged(){super._beforeChanged(),(this.isDirty("radius")||this.isDirty("arc")||this.isDirty("innerRadius")||this.isDirty("startAngle")||this.isDirty("dRadius")||this.isDirty("dInnerRadius")||this.isDirty("cornerRadius")||this.isDirty("shiftRadius"))&&(this._clear=!0)}_changed(){if(super._changed(),this._clear){let l=this.get("startAngle",0),c=this.get("arc",0);const g=this._generator;c<0&&(l=l+c,c=c*-1),c>.1&&g.cornerRadius(this.get("cornerRadius",0)),g.context(this._display);let d=this.get("radius",0),o=this.get("innerRadius",0),h=this.get("dRadius",0),n=this.get("dInnerRadius",0);d+=h,o+=n,o<0&&(o=d+o),g({innerRadius:o,outerRadius:d,startAngle:(l+90)*re,endAngle:(l+c+90)*re});let x=l+c/2;this.ix=fe(x),this.iy=de(x);const a=this.get("shiftRadius",0);this.setRaw("dx",this.ix*a),this.setRaw("dy",this.iy*a),this.markDirtyPosition()}}}Object.defineProperty(ne,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Slice"});Object.defineProperty(ne,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:ce.classNames.concat([ne.className])});export{ne as S};
