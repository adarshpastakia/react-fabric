import{E as n,F as u,V as j,b as L,_ as $}from"./ShadowCastClear.glsl.js";import{V as A,i as c,a as z}from"./rasterFieldUtils.js";import{i as C}from"./timeSupport.js";import{t as D}from"./datasetUtils.js";import{v as N,u as T,I as k}from"./rasterProjectionHelper.js";import{n as q}from"./popupUtils.js";const Q=b=>{const I=b;let r=class extends I{constructor(...e){super(...e),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){var e;return C(this.layer,(e=this.view)==null?void 0:e.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){const{renderer:e}=this.layer;return!!((e==null?void 0:e.type)==="raster-stretch"&&e.dynamicRangeAdjustment&&!(e.stretchType==="min-max"||e.stretchType==="standard-deviation"))}get datumTransformation(){try{return this.layer.loaded?N(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(e){try{return!this.layer.loaded||!!T(this.layer.serviceRasterInfo,e)}catch{return!1}}async fetchPopupFeaturesAtLocation(e,y){var g,v;const{layer:t}=this;if(!e)throw new L("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:t});const{popupEnabled:R}=t,V=q(t,y);if(!R||V==null)return[];const d=[],{value:s,magdirValue:l,processedValue:m}=await t.identify(e,{timeExtent:this.timeExtent,signal:y==null?void 0:y.signal});let h="";if(s!=null&&s.length){h=t.type==="imagery-tile"&&t.hasStandardTime()&&s[0]!=null?s.map(f=>t.getStandardTimeValue(f)).join(", "):s.join(", ");const a={ObjectId:0};a[c.servicePixelValue]=t.type==="imagery-tile"&&D(t.raster)?m==null?void 0:m.join(", "):h,a[c.rawServicePixelValue]=h;const o=((g=t.raster)==null?void 0:g.rasterInfo)??t.serviceRasterInfo,x=o==null?void 0:o.attributeTable;if(x!=null){const{fields:f,features:O}=x,w=f.find(({name:i})=>i.toLowerCase()==="value"),P=a[c.servicePixelValue],p=w?O.find(i=>String(i.attributes[w.name])===P):null;if(p)for(const i in p.attributes)p.attributes.hasOwnProperty(i)&&(a[z+i]=p.attributes[i])}const E=o==null?void 0:o.dataType;E!=="vector-magdir"&&E!=="vector-uv"||(a[c.magnitude]=l==null?void 0:l[0],a[c.direction]=l==null?void 0:l[1]);const{multidimensionalDefinition:F}=this.layer.normalizeRasterFetchOptions({timeExtent:this.timeExtent});A(t.rasterFields,a,F);const{graphicOrigin:S}=t,_=new $({geometry:(v=this.fullExtent)==null?void 0:v.clone(),attributes:a,layer:t,origin:S,sourceLayer:t});d.push(_)}return d}async getSourceScale(){return await this.layer.load(),k(this.layer.serviceRasterInfo,this.view.spatialReference)}_getFullExtent(){return T(this.layer.serviceRasterInfo,this.view.spatialReference)}};return n([u()],r.prototype,"fullExtent",null),n([u()],r.prototype,"layer",void 0),n([u({readOnly:!0})],r.prototype,"timeExtent",null),n([u()],r.prototype,"tileInfo",void 0),n([u({readOnly:!0})],r.prototype,"hasTilingEffects",null),n([u()],r.prototype,"datumTransformation",null),r=n([j("esri.views.layers.ImageryTileLayerView")],r),r};export{Q as f};
