import{cn as V,co as K,aa as x,cp as X,b as W,cq as I,cr as Y,cs as _,l as $,ct as aa,cu as ea,cv as Q,cw as la,cx as na,cy as sa}from"./ShadowCastClear.glsl.js";import{u as P,t as D,s as ta,l as ra,L as oa,p as ia,o as ca,n as ua,e as pa,c as ha,m as ma}from"./previewUtils.js";import{resolveWebStyleSymbol as fa}from"./webStyleSymbolUtils.js";import"./iframe-qDaPDssc.js";import"./index.js";import"./Viewport.js";import"./debounce.js";import"./index2.js";import"./Section.js";import"./ErrorBoundary.js";import"./createClass.js";import"./Global.js";import"./useIsDark.js";import"./devEnvironmentUtils.js";import"./webStyleAcceptedFormats.js";const L=22,E=120,R=80,A=50,Z=20;function j(e){const a=e.outline,s=e.material!=null?e.material.color:null,l=s!=null?s.toHex():null;if(a==null||"pattern"in a&&a.pattern!=null&&a.pattern.type==="style"&&a.pattern.style==="none")return e.type==="fill"&&l==="#ffffff"?{color:"#bdc3c7",width:.75}:null;const c=x(a.size)||0;return{color:"rgba("+(a.color!=null?a.color.toRgba():"255,255,255,1")+")",width:Math.min(c,R),style:"pattern"in a&&a.pattern!=null&&a.pattern.type==="style"?Q(a.pattern.style):null,join:"butt",cap:"patternCap"in a?a.patternCap:"butt"}}async function ya(e,a){var l,c,f;if((l=e.thumbnail)!=null&&l.url)return e.thumbnail.url;if(a.type==="icon"&&((c=a==null?void 0:a.resource)==null?void 0:c.href))return la(a);const s=K("esri/images/Legend/legend3dsymboldefault.png");if(e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)){const t=await fa(e.styleOrigin,{portal:e.styleOrigin.portal}).catch(()=>null);if(t&&"thumbnail"in t&&((f=t.thumbnail)!=null&&f.url))return t.thumbnail.url}return s}function U(e,a=1){const s=e.a,l=aa(e),c=l.h,f=l.s/a,t=100-(100-l.v)/a,{r:d,g:o,b:r}=ea({h:c,s:f,v:t});return[d,o,r,s]}function F(e){var a;return e.type==="water"?e.color==null?null:e.color:((a=e.material)==null?void 0:a.color)==null?null:e.material.color}function i(e,a=0){const s=F(e);if(!s){if(e.type==="fill")return null;const c=X.r,f=P(c,a);return[f,f,f,100]}const l=s.toRgba();for(let c=0;c<3;c++)l[c]=P(l[c],a);return l}async function da(e,a){const s=e.style;return s==="none"?null:{type:"pattern",x:0,y:0,src:await V(K(`esri/symbols/patterns/${s}.png`),a.toCss(!0)),width:5,height:5}}function G(e){return e.outline?j(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function N(e,a){const s=F(e);if(!s)return null;let l="rgba(";return l+=P(s.r,a)+",",l+=P(s.g,a)+",",l+=P(s.b,a)+",",l+s.a+");"}function J(e,a){const s=e.edges;return!s||!s.color||!s.size?null:{color:s.color.toCss(!0),width:Math.min(x(s.size),a,R),join:"round"}}function H(e,a){var c;const s=N(e,a);if(!s||"pattern"in e&&e.pattern!=null&&e.pattern.type==="style"&&e.pattern.style==="none")return null;const l={color:s,width:Math.min(e.size?x(e.size):.75,R)};return"pattern"in e&&((c=e.pattern)==null?void 0:c.type)==="style"&&(l.style=Q(e.pattern.style)),"cap"in e&&e.cap&&(l.cap=e.cap),"join"in e&&e.join&&(l.join=e.join==="miter"?x(2):e.join),l}function q(e,a,s){const l=s!=null?.75*s:0;return{type:"linear",x1:l?.25*l:0,y1:l?.5*l:0,x2:l||4,y2:l?.5*l:4,colors:[{color:e,offset:0},{color:a,offset:1}]}}function ba(e){const a=e.depth,s=e.height,l=e.width;return l!==0&&a!==0&&s!==0&&l===a&&l!=null&&s!=null&&l<s}function ka(e,a,s){var c,f;const l=[];if(!e)return l;switch(e.type){case"icon":{const o=a,r=a;switch(((c=e.resource)==null?void 0:c.primitive)??sa){case"circle":l.push({shape:{type:"circle",cx:0,cy:0,r:.5*a},fill:i(e,0),stroke:j(e)});break;case"square":l.push({shape:{type:"path",path:[{command:"M",values:[0,r]},{command:"L",values:[0,0]},{command:"L",values:[o,0]},{command:"L",values:[o,r]},{command:"Z",values:[]}]},fill:i(e,0),stroke:j(e)});break;case"triangle":l.push({shape:{type:"path",path:[{command:"M",values:[0,r]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,r]},{command:"Z",values:[]}]},fill:i(e,0),stroke:j(e)});break;case"cross":l.push({shape:{type:"path",path:[{command:"M",values:[.5*o,0]},{command:"L",values:[.5*o,r]},{command:"M",values:[0,.5*r]},{command:"L",values:[o,.5*r]}]},stroke:G(e)});break;case"x":l.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,r]},{command:"M",values:[o,0]},{command:"L",values:[0,r]}]},stroke:G(e)});break;case"kite":l.push({shape:{type:"path",path:[{command:"M",values:[0,.5*r]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,.5*r]},{command:"L",values:[.5*o,r]},{command:"Z",values:[]}]},fill:i(e,0),stroke:j(e)})}break}case"object":switch(((f=e.resource)==null?void 0:f.primitive)??na){case"cone":{const t=q(i(e,0),i(e,-.6),s?Z:a),d=ua(a,s);l.push({shape:d[0],fill:t},{shape:d[1],fill:t});break}case"inverted-cone":{const t=i(e,0),d=q(t,i(e,-.6),a),o=ca(a);l.push({shape:o[0],fill:d},{shape:o[1],fill:t});break}case"cube":{const t=ia(a,s);l.push({shape:t[0],fill:i(e,0)},{shape:t[1],fill:i(e,-.3)},{shape:t[2],fill:i(e,-.5)});break}case"cylinder":{const t=q(i(e,0),i(e,-.6),s?Z:a),d=oa(a,s);l.push({shape:d[0],fill:t},{shape:d[1],fill:t},{shape:d[2],fill:i(e,0)});break}case"diamond":{const t=ra(a);l.push({shape:t[0],fill:i(e,-.3)},{shape:t[1],fill:i(e,0)},{shape:t[2],fill:i(e,-.3)},{shape:t[3],fill:i(e,-.7)});break}case"sphere":{const t=q(i(e,0),i(e,-.6));t.x1=0,t.y1=0,t.x2=.25*a,t.y2=.25*a,l.push({shape:{type:"circle",cx:0,cy:0,r:.5*a},fill:t});break}case"tetrahedron":{const t=ta(a);l.push({shape:t[0],fill:i(e,-.3)},{shape:t[1],fill:i(e,0)},{shape:t[2],fill:i(e,-.6)});break}}break}return l}function T(e){const a=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null;return a?x(a):null}function va(e){return e.type==="icon"?"multiply":"tint"}async function ga(e,a){const s=T(a),l=a!=null&&a.maxSize?x(a.maxSize):null,c=(a==null?void 0:a.disableUpsampling)??!1,f=e.symbolLayers,t=[],d=[];let o=!1,r=0,y=0,g=0;f.forEach(n=>{var k,v,w,z;if(n.type!=="icon"&&n.type!=="object")return;n&&n.type==="icon"&&(g=Math.max(n.size&&x(n.size),g));const p=n.type==="icon"?n.size&&x(n.size):0,h=s||p?Math.ceil(Math.min(s||p,l||E)):L;let m=n.type==="icon"?n.angle:null;if((a==null?void 0:a.rotation)!=null&&(m=(m??0)+a.rotation),d.push(m),(k=n==null?void 0:n.resource)==null?void 0:k.href){const S=ya(e,n).then(M=>{var B;const C=(B=n==null?void 0:n.material)==null?void 0:B.color,O=va(n);return _(M,h,C,O,c)}).then(M=>{const C=M.width,O=M.height;return r=Math.max(r,C),y=Math.max(y,O),m&&(o=!0),[{shape:{type:"image",x:0,y:0,width:C,height:O,src:M.url},fill:null,stroke:null}]});t.push(S)}else{let S=h;n.type==="icon"&&s&&(S=h*(p/g));const M=(a==null?void 0:a.symbolConfig)==="tall"||((v=a==null?void 0:a.symbolConfig)==null?void 0:v.isTall)||n.type==="object"&&ba(n);r=Math.max(r,M?Z:S),y=Math.max(y,S),m&&((w=n.resource)!=null&&w.primitive)&&["square","triangle","x"].includes((z=n.resource)==null?void 0:z.primitive)&&(o=!0),t.push(Promise.resolve(ka(n,S,M)))}});const u=await Promise.allSettled(t),b=[];return u.forEach(n=>{n.status==="fulfilled"?b.push(n.value):n.reason&&$.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",n.reason)}),I(b,[r,y],{node:a==null?void 0:a.node,scale:!1,opacity:a==null?void 0:a.opacity,ariaLabel:a==null?void 0:a.ariaLabel,rotations:d,useRotationSize:o})}function wa(e,a){const s=e.symbolLayers,l=[],c=Y(e),f=T(a),t=(a!=null&&a.maxSize?x(a.maxSize):null)||R;let d,o=0,r=0;return s.forEach((y,g)=>{if(!y||y.type!=="line"&&y.type!=="path")return;const u=[];switch(y.type){case"line":{const b=H(y,0);if(b==null)break;const n=(b==null?void 0:b.width)||0;g===0&&(d=n);const p=Math.min(f||n,t),h=g===0?p:f?p*(n/d):p,m=h>A/2?2*h:A;r=Math.max(r,h),o=Math.max(o,m),b.width=h,u.push({shape:{type:"path",path:[{command:"M",values:[0,.5*r]},{command:"L",values:[o,.5*r]}]},stroke:b});break}case"path":{const b=Math.min(f||L,t),n=i(y,0),p=i(y,-.2),h=N(y,-.4),m=h?{color:h,width:1}:{};if(y.profile==="quad"){const k=y.width,v=y.height,w=pa(k&&v?k/v:1,v===0,k===0),z={...m,join:"bevel"};u.push({shape:w[0],fill:p,stroke:z},{shape:w[1],fill:p,stroke:z},{shape:w[2],fill:n,stroke:z})}else u.push({shape:D.pathSymbol3DLayer[0],fill:p,stroke:m},{shape:D.pathSymbol3DLayer[1],fill:n,stroke:m});r=Math.max(r,b),o=r}}l.push(u)}),Promise.resolve(I(l,[o,r],{node:a==null?void 0:a.node,scale:c,opacity:a==null?void 0:a.opacity,ariaLabel:a==null?void 0:a.ariaLabel}))}async function xa(e,a){const s=e.type==="mesh-3d",l=e.symbolLayers,c=T(a),f=a!=null&&a.maxSize?x(a.maxSize):null,t=c||L,d=[];let o=0,r=0,y=!1;for(let g=0;g<l.length;g++){const u=l.at(g),b=[];if(!s||u.type==="fill"){switch(u.type){case"fill":{const n=Math.min(t,f||E);if(o=Math.max(o,n),r=Math.max(r,n),y=!0,s){const p=D.meshSymbol3DFill,h=N(u,-.4),m=J(u,.05*n)??(h?{join:"round",color:h,width:1}:null);b.push({shape:p[0],fill:i(u,0),stroke:m},{shape:p[1],fill:i(u,-.2),stroke:m},{shape:p[2],fill:i(u,-.6),stroke:m})}else{let p=i(u,0);const h="pattern"in u?u.pattern:null,m=j(u),k=F(u);h!=null&&h.type==="style"&&h.style!=="solid"&&k&&(p=await da(h,k)),b.push({shape:D.fill[0],fill:p,stroke:m})}break}case"line":{const n=H(u,0);if(n==null)break;const p={stroke:n,shape:D.fill[0]};o=Math.max(o,L),r=Math.max(r,L),b.push(p);break}case"extrude":{const n=i(u,0),p=i(u,-.2),h=Math.min(t,f||E),m=ma(h),k=L,v=.7*L+.5*h,w=J(u,.1*Math.min(k,v))??{join:"round",...H(u,-.4),width:1};b.push({shape:m[0],fill:p,stroke:w},{shape:m[1],fill:p,stroke:w},{shape:m[2],fill:n,stroke:w}),o=Math.max(o,k),r=Math.max(r,v);break}case"water":{const n=F(u),p=U(n),h=U(n,2),m=U(n,3),k=ha();y=!0,b.push({shape:k[0],fill:p},{shape:k[1],fill:h},{shape:k[2],fill:m});const v=Math.min(t,f||E);o=Math.max(o,v),r=Math.max(r,v);break}}d.push(b)}}return I(d,[o,r],{node:a==null?void 0:a.node,scale:y,opacity:a==null?void 0:a.opacity,ariaLabel:a==null?void 0:a.ariaLabel})}function Ha(e,a){if(e.symbolLayers.length===0)return Promise.reject(new W("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return ga(e,a);case"line-3d":return wa(e,a);case"polygon-3d":case"mesh-3d":return xa(e,a)}return Promise.reject(new W("symbolPreview: swatchInfo3D","symbol not supported."))}export{da as getPatternDescriptor,T as getSizeFromOptions,i as getSymbolLayerFill,Ha as previewSymbol3D};
