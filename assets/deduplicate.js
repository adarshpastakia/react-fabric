import{bU as O,bV as L,bW as R}from"./ShadowCastClear.glsl.js";function B(o,n,e){const l=Array.isArray(o),r=l?o.length/n:o.byteLength/(4*n),A=l?o:new Uint32Array(o,0,r*n),u=(e==null?void 0:e.minReduction)??0,s=(e==null?void 0:e.originalIndices)||null,q=s?s.length:0,a=(e==null?void 0:e.componentOffsets)||null;let U=0;if(a)for(let t=0;t<a.length-1;t++){const c=a[t+1]-a[t];c>U&&(U=c)}else U=r;const b=Math.floor(1.1*U)+1;(y==null||y.length<2*b)&&(y=new Uint32Array(R(2*b)));for(let t=0;t<2*b;t++)y[t]=0;let i=0;const w=!!a&&!!s,m=w?q:r;let h=O(r);const d=new Uint32Array(q),k=1.96;let I=u!==0?Math.ceil(4*k*k/(u*u)*u*(1-u)):m,p=1,$=a?a[1]:m;for(let t=0;t<m;t++){if(t===I){const f=1-i/t;if(f+k*Math.sqrt(f*(1-f)/t)<u)return null;I*=2}if(t===$){for(let f=0;f<2*b;f++)y[f]=0;if(s)for(let f=a[p-1];f<a[p];f++)d[f]=h[s[f]];$=a[++p]}const c=w?s[t]:t,j=c*n,x=v(A,j,n);let g=x%b,C=i;for(;y[2*g+1]!==0;){if(y[2*g]===x){const f=y[2*g+1]-1;if(V(A,j,f*n,n)){C=h[f];break}}g++,g>=b&&(g-=b)}C===i&&(y[2*g]=x,y[2*g+1]=c+1,i++),h[c]=C}if(u!==0&&1-i/r<u)return null;if(w){for(let t=a[p-1];t<d.length;t++)d[t]=h[s[t]];h=L(d)}const M=l?new Array(i):new Uint32Array(i*n);i=0;for(let t=0;t<m;t++)h[t]===i&&(W(A,(w?s[t]:t)*n,M,i*n,n),i++);if(s&&!w){const t=new Uint32Array(q);for(let c=0;c<t.length;c++)t[c]=h[s[c]];h=L(t)}return{buffer:Array.isArray(M)?M:M.buffer,indices:h,uniqueCount:i}}function V(o,n,e,l){for(let r=0;r<l;r++)if(o[n+r]!==o[e+r])return!1;return!0}function W(o,n,e,l,r){for(let A=0;A<r;A++)e[l+A]=o[n+A]}function v(o,n,e){let l=0;for(let r=0;r<e;r++)l=o[n+r]+l|0,l=l+(l<<11)+(l>>>2)|0;return l>>>0}let y=null;export{B as e};
