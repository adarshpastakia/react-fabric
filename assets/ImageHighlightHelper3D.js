const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./GraphicsView3D.js","./ShadowCastClear.glsl.js","./iframe-DwvN93Ge.js","./iframe-CGchYWp9.css","./index.js","./Viewport.js","./Section.js","./ErrorBoundary.js","./createClass.js","./Global.js","./useIsDark.js","./debounce.js","./index2.js","./ShadowCastClear-Cq39gfL_.css","./GraphicsProcessor.js","./renderingInfoUtils.js","./ExtentSet.js","./rendererConversion.js","./optimizedFeatureQueryEngineAdapter.js","./popupUtils.js","./Graphics3DObjectStates.js","./highlightUtils.js","./highlightOptionsUtils.js"])))=>i.map(i=>d[i]);
import{b8 as c}from"./iframe-DwvN93Ge.js";import{b6 as d,ex as u,b8 as w,ey as m,ez as y,b7 as _,bn as g,ed as f,bj as v,bo as V,bx as b,eA as H,eB as G,E as o,F as p,V as $}from"./ShadowCastClear.glsl.js";import{i as x}from"./highlightUtils2.js";let h=class extends d{get updating(){var s;return((s=this.graphicsView)==null?void 0:s.updating)??!1}constructor(s){super(s),this._highlightCounts=new Map,this._graphicsViewLoader=null,this.graphics=new u,this.graphicsView=null,this.suspended=!1;const e=new w([255,255,255,1/255]);this._symbols=new Map([["point",new m({size:"2px",style:"square",color:e})],["polyline",new y({width:"2px",color:e})],["polygon",new _({outline:null,color:e})]])}highlight(s,e){const i=x(s);if(i.length===0)return g();let a,t=!1;return this.updatingHandles.addPromise(Promise.all([this._createHighlightGraphics(i),this._ensureGraphicsView3D()]).then(([n,r])=>{!t&&r&&(a=this._addHighlightGraphics(r,n,e))})),g(()=>{t=!0,a==null||a.remove()})}preload(){this._ensureGraphicsView3D()}_addHighlightGraphics(s,e,i){for(const t of e)this._highlightCounts.set(t,(this._highlightCounts.get(t)??0)+1);this.graphics.addMany(e);const a=s.highlight(e,i);return g(()=>{this._removeHighlightGraphics(e),a.remove()})}_removeHighlightGraphics(s){this.graphics.removeMany(s.filter(e=>{const i=Math.max(0,(this._highlightCounts.get(e)??0)-1);return i===0?(this._highlightCounts.delete(e),!0):(this._highlightCounts.set(e,i),!1)}))}async _ensureGraphicsView3D(){if(this.graphicsView)return this.graphicsView;this._graphicsViewLoader||(this._graphicsViewLoader=c(()=>import("./GraphicsView3D.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]),import.meta.url));const{default:s}=await this._graphicsViewLoader;if(this.destroyed)return null;const e=new s({view:this.view,layer:{type:"graphics-view-3d-dummy",id:this.layer.id,uid:this.layer.uid,elevationInfo:{mode:"on-the-ground"}},getGraphics:()=>this.graphics,drapeSourcePriorityOffset:.5});return this._set("graphicsView",e),this.addHandles([f(this.graphicsView),v(()=>this.suspended,i=>{e.suspended=i},V)]),e}async _createHighlightGraphics(s){const e=s.map(({geometry:t})=>t==null?void 0:t.spatialReference).filter(b).reduce((t,n)=>{var r;return t.length!==0&&((r=t.at(-1))!=null&&r.equals(n))||t.push(n),t},[]),i=this.view.spatialReference,a=e.map(t=>({source:t,dest:i}));try{await H(a)}catch{return[]}return s.map(t=>{const{geometry:n}=t;try{const r=n?G(n,i):null,l=t.cloneShallow();return l.geometry=r,l.symbol=this._symbols.get(r==null?void 0:r.type),l}catch{return t}})}};o([p()],h.prototype,"graphics",void 0),o([p()],h.prototype,"graphicsView",void 0),o([p()],h.prototype,"view",void 0),o([p()],h.prototype,"layer",void 0),o([p()],h.prototype,"updatingHandles",void 0),o([p()],h.prototype,"suspended",void 0),o([p()],h.prototype,"updating",null),h=o([$("esri.views.3d.layers.support.ImageHighlightHelper3D")],h);export{h as w};
