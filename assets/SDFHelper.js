import{dB as X,dC as k,dD as L,dE as Y}from"./ShadowCastClear.glsl.js";import{t as j}from"./CIMSymbolHelper.js";const q=.45;function B(n,t=.5){var e;switch(n.type){case"CIMPointSymbol":{const o=n.symbolLayers;if(!o||o.length!==1)return null;const a=o[0];return a.type!=="CIMVectorMarker"?null:B(a)}case"CIMVectorMarker":{const o=n.markerGraphics;if(!o||o.length!==1)return null;const a=o[0];if(!a)return null;const r=a.geometry;if(!r)return null;const i=a.symbol;return!i||i.type!=="CIMPolygonSymbol"&&i.type!=="CIMLineSymbol"||(e=i.symbolLayers)!=null&&e.some(l=>!!l.effects)?null:{type:"sdf",geom:r,sdfPaddingRatio:t,asFill:i.type==="CIMPolygonSymbol"}}}}function E(n){return n?n.rings?n.rings:n.paths?n.paths:n.xmin!==void 0&&n.ymin!==void 0&&n.xmax!==void 0&&n.ymax!==void 0?[[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]]:null:null}function G(n){let t=1/0,e=-1/0,o=1/0,a=-1/0;for(const r of n)for(const i of r)i[0]<t&&(t=i[0]),i[0]>e&&(e=i[0]),i[1]<o&&(o=i[1]),i[1]>a&&(a=i[1]);return new j(t,o,e-t,a-o)}function V(n){let t=1/0,e=-1/0,o=1/0,a=-1/0;for(const r of n)for(const i of r)i[0]<t&&(t=i[0]),i[0]>e&&(e=i[0]),i[1]<o&&(o=i[1]),i[1]>a&&(a=i[1]);return[t,o,e,a]}function U(n){return n?n.rings?V(n.rings):n.paths?V(n.paths):X(n)?[n.xmin,n.ymin,n.xmax,n.ymax]:null:null}function Q(n,t){const[e,o,a,r]=U(n),i=a-e,l=r-o,m=k,c=L,s=Math.floor(.5*(m*t-c)),f=(m-2*(s+c))/Math.max(i,l),y=Math.round(i*f),h=Math.round(l*f);return{pixelDimensions:[i,l],texelDimensions:[Math.round((y+2*s)/f),Math.round((h+2*s)/f)]}}function T(n,t,e,o,a,r,i){const[l,m,c,s]=n;if(c<l||s<m)return{frameSizeRatio:0,anchorX:0,anchorY:0,widthRatio:1,sdfPaddingRatio:.5};const f=c-l,y=s-m,h=Math.max(f,y);let u=.5;if(r!=null&&e!=null){!i&&t!=null&&(r*=(t.ymax-t.ymin)/e);const b=r/(r+h);b>q&&b<1&&(u=Math.min(b+.1,.99))}const x=k,M=L,p=Math.floor(.5*(x*u-M)),g=(x-2*(p+M))/h,I=Math.round(f*g)+2*p,w=Math.round(y*g)+2*p;let d=1;t&&(d=w*(1-u)/((t.ymax-t.ymin)*g));let P=0,R=0,C=1;o&&(a?t&&e&&t.ymax-t.ymin>0&&(C=(t.xmax-t.xmin)/(t.ymax-t.ymin),P=o.x/(e*C),R=o.y/e):(P=o.x,R=o.y)),t&&(P=.5*(t.xmax+t.xmin)+P*(t.xmax-t.xmin),R=.5*(t.ymax+t.ymin)+R*(t.ymax-t.ymin)),P-=l,R-=m,P*=g,R*=g,P+=p,R+=p;let S=P/I-.5,v=R/w-.5;return a&&e&&(S*=e*C,v*=e),{frameSizeRatio:d,anchorX:S,anchorY:v,widthRatio:C,sdfPaddingRatio:u}}function W(n){const t=E(n.geom),e=G(t),o=k,a=L,r=Math.floor(.5*(o*n.sdfPaddingRatio-a)),i=o-2*(r+a),l=i/Math.max(e.width,e.height),m=Math.round(e.width*l)+2*r,c=Math.round(e.height*l)+2*r,s=[];for(const y of t)if(y&&y.length>1){const h=[];for(const u of y){let[x,M]=u;x-=e.x,M-=e.y,x*=l,M*=l,x+=r-.5,M+=r-.5,n.asFill?h.push([x,M]):h.push([Math.round(x),Math.round(M)])}if(n.asFill){const u=h.length-1;h[0][0]===h[u][0]&&h[0][1]===h[u][1]||h.push(h[0])}s.push(h)}const f=H(s,m,c,r);return n.asFill&&J(s,m,c,r,f),{data:K(f,r),width:m,height:c,sdfPaddingRatio:n.sdfPaddingRatio,sdfDecodeCoeff:2*r/i}}function H(n,t,e,o){const a=t*e,r=new Array(a),i=o*o+1;for(let l=0;l<a;++l)r[l]=i;for(const l of n){const m=l.length;for(let c=1;c<m;++c){const s=l[c-1],f=l[c];let y,h,u,x;s[0]<f[0]?(y=s[0],h=f[0]):(y=f[0],h=s[0]),s[1]<f[1]?(u=s[1],x=f[1]):(u=f[1],x=s[1]);let M=Math.floor(y)-o,p=Math.floor(h)+o,g=Math.floor(u)-o,I=Math.floor(x)+o;M<0&&(M=0),p>t&&(p=t),g<0&&(g=0),I>e&&(I=e);const w=f[0]-s[0],d=f[1]-s[1],P=w*w+d*d;for(let R=M;R<p;R++)for(let C=g;C<I;C++){const S=R+.5,v=C+.5;let b,F,D=(S-s[0])*w+(v-s[1])*d;D<0?(b=s[0],F=s[1]):D>P?(b=f[0],F=f[1]):(D/=P,b=s[0]+D*w,F=s[1]+D*d);const z=(S-b)*(S-b)+(v-F)*(v-F),A=(e-C-1)*t+R;z<r[A]&&(r[A]=z)}}}for(let l=0;l<a;++l)r[l]=Math.sqrt(r[l]);return r}function J(n,t,e,o,a){for(const r of n){const i=r.length;for(let l=1;l<i;++l){const m=r[l-1],c=r[l];let s,f,y,h;m[0]<c[0]?(s=m[0],f=c[0]):(s=c[0],f=m[0]),m[1]<c[1]?(y=m[1],h=c[1]):(y=c[1],h=m[1]);let u=Math.floor(s),x=Math.floor(f)+1,M=Math.floor(y),p=Math.floor(h)+1;u<o&&(u=o),x>t-o&&(x=t-o),M<o&&(M=o),p>e-o&&(p=e-o);for(let g=M;g<p;++g){if(m[1]>g==c[1]>g)continue;const I=g+.5,w=(e-g-1)*t;for(let d=u;d<x;++d)d+.5<(c[0]-m[0])*(I-m[1])/(c[1]-m[1])+m[0]&&(a[w+d]=-a[w+d]);for(let d=o;d<u;++d)a[w+d]=-a[w+d]}}}}function K(n,t){const e=2*t,o=n.length,a=new Uint8Array(4*o);for(let r=0;r<o;++r){const i=.5-n[r]/e;Y(i,a,4*r)}return a}export{B as a,Q as c,T as h,U as m,W as u};
