"use strict";(self.webpackChunkreact_fabric=self.webpackChunkreact_fabric||[]).push([[8989],{"./packages/draw/stories/Playground.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Playground:()=>Playground,__namedExportsOrder:()=>__namedExportsOrder,default:()=>Playground_stories});var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),dist=__webpack_require__("./node_modules/@storybook/addon-actions/dist/index.mjs"),esm=__webpack_require__("./packages/core/dist/esm/index.js"),dist_esm=__webpack_require__("./packages/utilities/dist/esm/index.js"),tldraw_dist_esm=__webpack_require__("./node_modules/@tldraw/tldraw/dist-esm/index.mjs"),react=(__webpack_require__("./node_modules/@tldraw/tldraw/tldraw.css"),__webpack_require__("./node_modules/react/index.js"));const DrawContext=(0,react.createContext)({}),DrawContextProvider=({children,...props})=>(0,jsx_runtime.jsx)(DrawContext.Provider,{value:props,children});try{DrawContextProvider.displayName="DrawContextProvider",DrawContextProvider.__docgenInfo={description:"",displayName:"DrawContextProvider",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/draw/src/canvas/DrawContext.tsx#DrawContextProvider"]={docgenInfo:DrawContextProvider.__docgenInfo,name:"DrawContextProvider",path:"packages/draw/src/canvas/DrawContext.tsx#DrawContextProvider"})}catch(__react_docgen_typescript_loader_error){}var editor_dist_esm=__webpack_require__("./node_modules/@tldraw/editor/dist-esm/index.mjs"),dom_to_image=__webpack_require__("./node_modules/dom-to-image/src/dom-to-image.js"),dom_to_image_default=__webpack_require__.n(dom_to_image);class Idle extends editor_dist_esm.YM5{static id="idle";onPointerDown=info=>{this.parent.transition("pointing",info)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")};onKeyUp=info=>{if("Enter"===info.key){if(this.editor.getInstanceState().isReadonly)return null;const onlySelectedShape=this.editor.getOnlySelectedShape();onlySelectedShape&&this.editor.getShapeUtil(onlySelectedShape).canEdit(onlySelectedShape)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(onlySelectedShape.id),this.editor.root.value?.transition("editing_shape",{...info,target:"shape",shape:onlySelectedShape}))}}}class Pointing extends editor_dist_esm.YM5{static id="pointing";markId="";onPointerUp=()=>{this.cancel()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};onPointerMove=info=>{if(this.editor.inputs.isDragging){const{originPagePoint}=this.editor.inputs,id=(0,tldraw_dist_esm.n6Y)();this.markId=`creating:${id}`,this.editor.mark(this.markId),this.editor.createShapes([{id,type:"avatar",x:originPagePoint.x,y:originPagePoint.y,props:{color:"black",fill:"none",size:"m",font:"draw",text:"person"}}]).select(id).setCurrentTool("select.resizing",{...info,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"avatar"})}};cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle",{})}}const AvatarShapeProps={color:tldraw_dist_esm.ive,fill:tldraw_dist_esm.u8f,size:tldraw_dist_esm.Sg3,font:tldraw_dist_esm.yes,text:tldraw_dist_esm.T.string};class AvatarShapeTool extends editor_dist_esm.YM5{static id="avatar";static initial="idle";static children=()=>[Idle,Pointing];shapeType="avatar"}const SIZE_MAP={s:48,m:72,l:96,xl:128},FONT_SIZE_MAP={s:12,m:16,l:18,xl:22};class AvatarShapeUtil extends tldraw_dist_esm.inY{static type="avatar";static props=AvatarShapeProps;el=document.createElement("div");canEdit=()=>!0;canResize=()=>!0;hideRotateHandle=()=>!0;getDefaultProps(){return{color:"black",fill:"none",size:"s",font:"draw",text:"person"}}constructor(editor){super(editor),this.el.style.position="absolute",editor.getContainer().appendChild(this.el)}getSize(shape){const size=SIZE_MAP[shape.props.size];return this.el.innerHTML=`<div class="tl-text-label" data-font="${shape.props.font}" style="position:relative;align-items:end;font-size:${FONT_SIZE_MAP[shape.props.size]}px;">\n<div class="tl-text-label__inner">\n  <div class="tl-text tl-text-content" style="white-space:nowrap;padding:4px;">\n      ${shape.props.text}\n    </div></div></div>`,{width:Math.max(size,this.el.offsetWidth),height:+size+this.el.offsetHeight}}getGeometry(shape){const{width,height}=this.getSize(shape);return new tldraw_dist_esm.krb({width,height,isFilled:!0})}indicator(shape){const{width,height}=this.getSize(shape);return(0,jsx_runtime.jsx)("rect",{width,height})}onChange=(shape,newText)=>{const{id,type,props:{text}}=shape;newText&&text.trim()!==newText.trim()&&this.editor.updateShapes([{id,type,props:{text:newText.trim()}}])};component(shape){const isDark=(0,esm.Yf)(),isEditing=(0,tldraw_dist_esm._As)(shape.id),size=SIZE_MAP[shape.props.size],theme=(0,tldraw_dist_esm.AnR)({isDarkMode:isDark}),inputRef=(0,react.useRef)(""),{width,height}=this.getSize(shape);(0,react.useEffect)((()=>{!isEditing&&inputRef.current&&this.onChange(shape,inputRef.current)}),[isEditing]);let bg="transparent";return"solid"!==shape.props.fill&&"pattern"!==shape.props.fill||(bg=theme[shape.props.color]?.semi),"semi"===shape.props.fill&&(bg=isDark?"#28292e":"#fcfffe"),(0,jsx_runtime.jsxs)("div",{"data-shape-id":shape.id,style:{position:"relative",textAlign:"center",width,height},children:[(0,jsx_runtime.jsx)("svg",{id:"svg-"+shape.id,viewBox:"0 0 30 30",width:size,height:size,children:(0,jsx_runtime.jsx)("path",{fill:bg,stroke:theme[shape.props.color]?.solid,d:"M5 27.4996C5 20.2996 8.79988 17.0996 14.9999 17.0996C21.1999 17.0996 25.0001 20.2996 25 27.4996M14.9997 15.6001C18.4792 15.6001 21.2998 12.7794 21.2998 9.30003C21.2998 5.82062 18.4792 3 14.9997 3C11.5203 3 8.69971 5.82062 8.69971 9.30003C8.69971 12.7794 11.5203 15.6001 14.9997 15.6001Z"})}),(0,jsx_runtime.jsx)("div",{id:"label-"+shape.id,className:"tl-text-label","data-isediting":isEditing,"data-font":shape.props.font,style:{alignItems:"end",fontSize:FONT_SIZE_MAP[shape.props.size],color:theme[shape.props.color].solid},children:(0,jsx_runtime.jsxs)("div",{className:"tl-text-label__inner",style:{minWidth:"100%"},children:[(0,jsx_runtime.jsx)("div",{className:"tl-text tl-text-content",style:{whiteSpace:"nowrap",padding:4},children:`${shape.props.text}`}),isEditing&&(0,jsx_runtime.jsx)("textarea",{className:"tl-text tl-text-input",style:{whiteSpace:"nowrap",padding:4,minWidth:"100%"},name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",ref:el=>[el?.select(),el?.focus()],onKeyDown:e=>"Enter"===e.key&&(e.stopPropagation(),this.onChange(shape,inputRef.current),this.editor.setEditingShape(null)),onChange:e=>inputRef.current=e.target.value,defaultValue:shape.props.text})]})})]})}async toSvg(shape){const el=document.querySelector(`div[data-shape-id="${shape.id}"]`);return el?await dom_to_image_default().toPng(el).then((function(dataUrl){return(0,jsx_runtime.jsx)("img",{src:dataUrl,alt:"svg"})})):(0,jsx_runtime.jsx)("img",{src:"",alt:"svg"})}}try{type.displayName="AvatarShapeUtil.type",type.__docgenInfo={description:"The type of the shape util, which should match the shape's type.",displayName:"AvatarShapeUtil.type",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/draw/src/canvas/shapes/avatar/AvatarShapeTool.tsx#AvatarShapeUtil.type"]={docgenInfo:AvatarShapeUtil.type.__docgenInfo,name:"AvatarShapeUtil.type",path:"packages/draw/src/canvas/shapes/avatar/AvatarShapeTool.tsx#AvatarShapeUtil.type"})}catch(__react_docgen_typescript_loader_error){}class AudioShapeUtil extends tldraw_dist_esm.inY{static type="audio-card";canResize=()=>!1;getDefaultProps(){return{src:"",poster:"",fileName:"",fileSize:0}}getGeometry(shape){return new tldraw_dist_esm.krb({width:320,height:96,isFilled:!0})}component(shape){const audioRef=(0,react.useRef)(null);return(0,react.useEffect)((()=>{audioRef.current?.addEventListener("play",(()=>{audioRef.current?.closest(".tl-container")?.querySelectorAll("video,audio").forEach((el=>{el!==audioRef.current&&el.pause()}))}))}),[]),(0,jsx_runtime.jsx)(tldraw_dist_esm.hDc,{className:"relative grid",children:(0,jsx_runtime.jsxs)("div",{"data-shape-id":shape.id,className:"bg-zinc-900 relative p-1 flex flex-col overflow-hidden",children:[(0,jsx_runtime.jsx)("audio",{controls:!0,ref:audioRef,src:shape.props.src,className:"object-contain flex-1 w-full pointer-events-auto overflow-hidden"}),(0,jsx_runtime.jsx)("img",{alt:shape.props.fileName,src:shape.props.poster,className:"object-fill flex-1 pointer-events-auto overflow-hidden hidden"}),(0,jsx_runtime.jsxs)("div",{className:"bg-zinc-800/80 text-white items-center py-1 px-2 flex gap-1 text-sm",children:[(0,jsx_runtime.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:16,height:16,children:(0,jsx_runtime.jsx)("path",{d:"M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.53 16.39,17.44 13,17.93V21H11V17.93C7.61,17.44 5,14.53 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z"})}),(0,jsx_runtime.jsx)("div",{className:"truncate flex-1",children:shape.props.fileName}),(0,jsx_runtime.jsx)("div",{children:dist_esm.yL.bytes(shape.props.fileSize??0)})]})]})})}indicator(shape){return(0,jsx_runtime.jsx)("rect",{})}async toSvg(shape){const el=document.querySelector(`div[data-shape-id="${shape.id}"]`);return el?(el.childNodes.item(0).style.display="none",el.childNodes.item(1).style.display="block",await dom_to_image_default().toPng(el).then((function(dataUrl){return el.childNodes.item(0).style.display="block",el.childNodes.item(1).style.display="none",(0,jsx_runtime.jsx)("img",{src:dataUrl,alt:"svg"})}))):(0,jsx_runtime.jsx)("img",{src:"",alt:"svg"})}}try{type.displayName="AudioShapeUtil.type",type.__docgenInfo={description:"The type of the shape util, which should match the shape's type.",displayName:"AudioShapeUtil.type",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/draw/src/canvas/shapes/custom/AudioShape.tsx#AudioShapeUtil.type"]={docgenInfo:AudioShapeUtil.type.__docgenInfo,name:"AudioShapeUtil.type",path:"packages/draw/src/canvas/shapes/custom/AudioShape.tsx#AudioShapeUtil.type"})}catch(__react_docgen_typescript_loader_error){}class CardShapeUtil extends tldraw_dist_esm.inY{static type="data-card";onResize(shape,info){return{props:{w:Math.max(Math.min(info.initialBounds.w*info.scaleX,1024),128),h:Math.max(Math.min(info.initialBounds.h*info.scaleY,768),128)}}}getDefaultProps(){return{w:300,h:200}}getGeometry(shape){return new tldraw_dist_esm.krb({width:shape.props.w,height:shape.props.h,isFilled:!0})}component(shape){const{renderer}=(0,react.useContext)(DrawContext);return(0,jsx_runtime.jsx)(tldraw_dist_esm.hDc,{className:"relative grid",children:(0,jsx_runtime.jsx)("div",{className:"relative grid","data-shape-id":shape.id,children:renderer?.(shape.props)})})}indicator(shape){return(0,jsx_runtime.jsx)("rect",{width:shape.props.w,height:shape.props.h})}async toSvg(shape){const el=document.querySelector(`div[data-shape-id="${shape.id}"]`);return el?await dom_to_image_default().toPng(el).then((function(dataUrl){return(0,jsx_runtime.jsx)("img",{src:dataUrl,alt:"svg"})})):(0,jsx_runtime.jsx)("img",{src:"",alt:"svg"})}}try{type.displayName="CardShapeUtil.type",type.__docgenInfo={description:"The type of the shape util, which should match the shape's type.",displayName:"CardShapeUtil.type",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/draw/src/canvas/shapes/custom/CardShape.tsx#CardShapeUtil.type"]={docgenInfo:CardShapeUtil.type.__docgenInfo,name:"CardShapeUtil.type",path:"packages/draw/src/canvas/shapes/custom/CardShape.tsx#CardShapeUtil.type"})}catch(__react_docgen_typescript_loader_error){}class FileShapeUtil extends tldraw_dist_esm.inY{static type="file-card";canResize=()=>!1;getDefaultProps(){return{icon:"",fileType:"",fileName:"",fileSize:0}}getGeometry(shape){return new tldraw_dist_esm.krb({width:320,height:72,isFilled:!0})}component(shape){return(0,jsx_runtime.jsx)(tldraw_dist_esm.hDc,{className:"relative grid",children:(0,jsx_runtime.jsxs)("div",{"data-shape-id":shape.id,className:"relative p-1 flex border rounded m-1 overflow-hidden",children:[(0,jsx_runtime.jsx)("img",{src:shape.props.icon,alt:shape.props.fileType,className:"object-contain pointer-events-none overflow-hidden w-12 h-12"}),(0,jsx_runtime.jsxs)("div",{className:"flex-1 overflow-hidden text-sm py-1 px-2",children:[(0,jsx_runtime.jsxs)("div",{className:"items-center flex gap-1",children:[(0,jsx_runtime.jsx)("div",{className:"truncate flex-1",children:shape.props.fileName}),(0,jsx_runtime.jsx)("div",{children:dist_esm.yL.bytes(shape.props.fileSize??0)})]}),(0,jsx_runtime.jsx)("div",{children:shape.props.fileType})]})]})})}indicator(shape){return(0,jsx_runtime.jsx)("rect",{})}async toSvg(shape){const el=document.querySelector(`div[data-shape-id="${shape.id}"]`);return el?await dom_to_image_default().toPng(el).then((function(dataUrl){return(0,jsx_runtime.jsx)("img",{src:dataUrl,alt:"svg"})})):(0,jsx_runtime.jsx)("img",{src:"",alt:"svg"})}}try{type.displayName="FileShapeUtil.type",type.__docgenInfo={description:"The type of the shape util, which should match the shape's type.",displayName:"FileShapeUtil.type",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/draw/src/canvas/shapes/custom/FileShape.tsx#FileShapeUtil.type"]={docgenInfo:FileShapeUtil.type.__docgenInfo,name:"FileShapeUtil.type",path:"packages/draw/src/canvas/shapes/custom/FileShape.tsx#FileShapeUtil.type"})}catch(__react_docgen_typescript_loader_error){}class ImageShapeUtil extends tldraw_dist_esm.inY{static type="image-card";onResize(shape,info){return{props:{w:Math.max(Math.min(info.initialBounds.w*info.scaleX,1024),128),h:Math.max(Math.min(info.initialBounds.h*info.scaleY,768),128)}}}getDefaultProps(){return{src:"",fileName:"",fileSize:0,w:400,h:300}}getGeometry(shape){return new tldraw_dist_esm.krb({width:shape.props.w,height:shape.props.h,isFilled:!0})}component(shape){return(0,jsx_runtime.jsx)(tldraw_dist_esm.hDc,{className:"relative grid",children:(0,jsx_runtime.jsxs)("div",{"data-shape-id":shape.id,className:"bg-zinc-900 relative p-1 flex flex-col overflow-hidden",children:[(0,jsx_runtime.jsx)("img",{src:shape.props.src,alt:shape.props.fileName,className:"object-contain flex-1 pointer-events-none overflow-hidden"}),(0,jsx_runtime.jsxs)("div",{className:"bg-zinc-800/80 text-white items-center py-1 px-2 flex gap-1 text-sm",children:[(0,jsx_runtime.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:16,height:16,children:(0,jsx_runtime.jsx)("path",{d:"M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z"})}),(0,jsx_runtime.jsx)("div",{className:"truncate flex-1",children:shape.props.fileName}),(0,jsx_runtime.jsx)("div",{children:dist_esm.yL.bytes(shape.props.fileSize??0)})]})]})})}indicator(shape){return(0,jsx_runtime.jsx)("rect",{width:shape.props.w,height:shape.props.h})}async toSvg(shape){const el=document.querySelector(`div[data-shape-id="${shape.id}"]`);return el?await dom_to_image_default().toPng(el).then((function(dataUrl){return(0,jsx_runtime.jsx)("img",{src:dataUrl,alt:"svg"})})):(0,jsx_runtime.jsx)("img",{src:"",alt:"svg"})}}try{type.displayName="ImageShapeUtil.type",type.__docgenInfo={description:"The type of the shape util, which should match the shape's type.",displayName:"ImageShapeUtil.type",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/draw/src/canvas/shapes/custom/ImageShape.tsx#ImageShapeUtil.type"]={docgenInfo:ImageShapeUtil.type.__docgenInfo,name:"ImageShapeUtil.type",path:"packages/draw/src/canvas/shapes/custom/ImageShape.tsx#ImageShapeUtil.type"})}catch(__react_docgen_typescript_loader_error){}class VideoShapeUtil extends tldraw_dist_esm.inY{static type="video-card";onResize(shape,info){return{props:{w:Math.max(Math.min(info.initialBounds.w*info.scaleX,1024),128),h:Math.max(Math.min(info.initialBounds.h*info.scaleY,768),128)}}}getDefaultProps(){return{src:"",poster:"",fileName:"",fileSize:0,w:400,h:300}}getGeometry(shape){return new tldraw_dist_esm.krb({width:shape.props.w,height:shape.props.h,isFilled:!0})}component(shape){const videoRef=(0,react.useRef)(null);return(0,react.useEffect)((()=>{videoRef.current?.addEventListener("play",(()=>{videoRef.current?.closest(".tl-container")?.querySelectorAll("video,audio").forEach((el=>{el!==videoRef.current&&el.pause()}))}))}),[]),(0,jsx_runtime.jsx)(tldraw_dist_esm.hDc,{className:"relative grid",children:(0,jsx_runtime.jsxs)("div",{"data-shape-id":shape.id,className:"bg-zinc-900 relative p-1 flex flex-col overflow-hidden",children:[(0,jsx_runtime.jsx)("video",{controls:!0,ref:videoRef,src:shape.props.src,poster:shape.props.poster,className:"object-contain flex-1 pointer-events-auto overflow-hidden"}),(0,jsx_runtime.jsx)("img",{src:shape.props.poster,alt:shape.props.fileName,className:"object-contain flex-1 pointer-events-auto overflow-hidden hidden"}),(0,jsx_runtime.jsxs)("div",{className:"bg-zinc-800/80 text-white items-center py-1 px-2 flex gap-1 text-sm",children:[(0,jsx_runtime.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:16,height:16,children:(0,jsx_runtime.jsx)("path",{d:"M17,10.5V7A1,1 0 0,0 16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5Z"})}),(0,jsx_runtime.jsx)("div",{className:"truncate flex-1",children:shape.props.fileName}),(0,jsx_runtime.jsx)("div",{children:dist_esm.yL.bytes(shape.props.fileSize??0)})]})]})})}indicator(shape){return(0,jsx_runtime.jsx)("rect",{width:shape.props.w,height:shape.props.h})}async toSvg(shape){const el=document.querySelector(`div[data-shape-id="${shape.id}"]`);return el?(el.childNodes.item(0).style.display="none",el.childNodes.item(1).style.display="block",await dom_to_image_default().toPng(el).then((function(dataUrl){return el.childNodes.item(0).style.display="block",el.childNodes.item(1).style.display="none",(0,jsx_runtime.jsx)("img",{src:dataUrl,alt:"svg"})}))):(0,jsx_runtime.jsx)("img",{src:"",alt:"svg"})}}try{type.displayName="VideoShapeUtil.type",type.__docgenInfo={description:"The type of the shape util, which should match the shape's type.",displayName:"VideoShapeUtil.type",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/draw/src/canvas/shapes/custom/VideoShape.tsx#VideoShapeUtil.type"]={docgenInfo:VideoShapeUtil.type.__docgenInfo,name:"VideoShapeUtil.type",path:"packages/draw/src/canvas/shapes/custom/VideoShape.tsx#VideoShapeUtil.type"})}catch(__react_docgen_typescript_loader_error){}const customAssetUrls={icons:{avatar:"data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiPgo8cGF0aCBkPSJNMjIuOCAyMi44di0yLjRjMC0xLjY1Ni0wLjY3My0zLjE1OC0xLjc1Ny00LjI0M3MtMi41ODctMS43NTctNC4yNDMtMS43NTdoLTkuNmMtMS42NTYgMC0zLjE1OCAwLjY3My00LjI0MyAxLjc1N3MtMS43NTcgMi41ODctMS43NTcgNC4yNDN2Mi40YzAgMC42NjIgMC41MzggMS4yIDEuMiAxLjJzMS4yLTAuNTM4IDEuMi0xLjJ2LTIuNGMwLTAuOTk1IDAuNDAyLTEuODkyIDEuMDU1LTIuNTQ1czEuNTUtMS4wNTUgMi41NDUtMS4wNTVoOS42YzAuOTk1IDAgMS44OTIgMC40MDIgMi41NDUgMS4wNTVzMS4wNTUgMS41NSAxLjA1NSAyLjU0NXYyLjRjMCAwLjY2MiAwLjUzOCAxLjIgMS4yIDEuMnMxLjItMC41MzggMS4yLTEuMnpNMTggNmMwLTEuNjU2LTAuNjczLTMuMTU4LTEuNzU3LTQuMjQzcy0yLjU4Ny0xLjc1Ny00LjI0My0xLjc1Ny0zLjE1OCAwLjY3My00LjI0MyAxLjc1Ny0xLjc1NyAyLjU4Ny0xLjc1NyA0LjI0MyAwLjY3MyAzLjE1OCAxLjc1NyA0LjI0MyAyLjU4NyAxLjc1NyA0LjI0MyAxLjc1NyAzLjE1OC0wLjY3MyA0LjI0My0xLjc1NyAxLjc1Ny0yLjU4NyAxLjc1Ny00LjI0M3pNMTUuNiA2YzAgMC45OTUtMC40MDIgMS44OTItMS4wNTUgMi41NDVzLTEuNTUgMS4wNTUtMi41NDUgMS4wNTUtMS44OTItMC40MDItMi41NDUtMS4wNTUtMS4wNTUtMS41NS0xLjA1NS0yLjU0NSAwLjQwMi0xLjg5MiAxLjA1NS0yLjU0NSAxLjU1LTEuMDU1IDIuNTQ1LTEuMDU1IDEuODkyIDAuNDAyIDIuNTQ1IDEuMDU1IDEuMDU1IDEuNTUgMS4wNTUgMi41NDV6Ij48L3BhdGg+Cjwvc3ZnPgo="}};async function getSvgAsDataUrl(svg){const clone=svg.cloneNode(!0);clone.setAttribute("encoding",'UTF-8"');const fileReader=new FileReader,imgs=Array.from(clone.querySelectorAll("image"));for(const img of imgs){const src=img.getAttribute("xlink:href");if(src&&!src.startsWith("data:")){const blob=await(await fetch(src)).blob(),base64=await new Promise(((resolve,reject)=>{fileReader.onload=()=>resolve(fileReader.result),fileReader.onerror=()=>reject(fileReader.error),fileReader.readAsDataURL(blob)}));img.setAttribute("xlink:href",base64)}}const svgStr=(new XMLSerializer).serializeToString(clone);return`data:image/svg+xml;base64,${"undefined"!=typeof window?window.btoa(unescape(encodeURIComponent(svgStr))):""}`}const TypeMap={image:"image-card",video:"video-card",audio:"audio-card",file:"file-card",card:"data-card"},DrawCanvas=({snapshot,renderer,onUpdate,canvasRef})=>{const[editorRef,setEditor]=(0,react.useState)(),isDark=(0,esm.Yf)();(0,react.useEffect)((()=>{editorRef?.user.updateUserPreferences({colorScheme:isDark?"dark":"light"})}),[editorRef,isDark]),(0,react.useEffect)((()=>{const handler=(0,dist_esm.sg)((()=>{editorRef&&onUpdate?.((0,tldraw_dist_esm.dVW)(editorRef.store))}),500);return editorRef?.sideEffects.registerAfterChangeHandler("shape",handler),editorRef?.sideEffects.registerAfterCreateHandler("shape",handler),editorRef?.sideEffects.registerAfterDeleteHandler("shape",handler),()=>{}}),[editorRef]),(0,react.useLayoutEffect)((()=>{setTimeout((()=>{editorRef?.store&&snapshot&&(0,tldraw_dist_esm.N2B)(editorRef.store,snapshot)}),500)}),[editorRef,snapshot]);const handleDragOver=(0,react.useCallback)((e=>!!e.dataTransfer.getData("react-fabric/canvas")||(e.preventDefault(),!1)),[]),handleDrop=(0,react.useCallback)((e=>{const data=e.dataTransfer.getData("react-fabric/canvas");if(!data)return e.preventDefault(),!1;const{type,...props}=JSON.parse(data);if(type in TypeMap){const{x=0,y=0}=editorRef?.getContainer().getBoundingClientRect()??{};editorRef?.createShape({type:TypeMap[type],x:e.clientX-x,y:e.clientY-y,props})}return!0}),[editorRef]);(0,react.useImperativeHandle)(canvasRef,(()=>({exportPages:async()=>{const currentPage=editorRef?.getCurrentPageId(),pages=Object.keys(editorRef?.store.getSnapshot().store??{}).filter((key=>key.startsWith("page:"))),pageSnapshots=[];for(;pages.length;){const pg=pages.shift();await new Promise((resolve=>{editorRef?.addListener("change",(()=>{editorRef.getCurrentPageId()===pg&&(editorRef.removeListener("change"),resolve(0))})),editorRef?.setCurrentPage(pg)}));const shapes=editorRef?.getCurrentPageShapeIds(),svg=await(editorRef?.getSvg([...shapes],{scale:1,background:!0}));svg&&pageSnapshots.push({id:pg,name:editorRef?.getCurrentPage().name,content:{image:await getSvgAsDataUrl(svg)}})}return currentPage&&editorRef?.setCurrentPage(currentPage),pageSnapshots}})),[editorRef]);const TLDraw=(0,react.useMemo)((()=>(0,jsx_runtime.jsx)(tldraw_dist_esm.Z1z,{assetUrls:customAssetUrls,shapeUtils:[AvatarShapeUtil,AudioShapeUtil,ImageShapeUtil,VideoShapeUtil,CardShapeUtil,FileShapeUtil],tools:[AvatarShapeTool],onMount:setEditor,components:{Toolbar:props=>{const tools=(0,tldraw_dist_esm.DKZ)(),isAvatarSelected=(0,tldraw_dist_esm.Pou)(tools.avatar);return(0,jsx_runtime.jsxs)(tldraw_dist_esm.F0h,{...props,children:[(0,jsx_runtime.jsx)(tldraw_dist_esm.y5O,{}),(0,jsx_runtime.jsx)(tldraw_dist_esm.LRd,{...tools.avatar,isSelected:isAvatarSelected})]})}},overrides:{translations:{en:{"tool.avatar":"Avatar"}},tools:(editor,schema)=>(schema.avatar={id:"avatar",label:"tool.avatar",readonlyOk:!1,icon:"avatar",onSelect(){editor.setCurrentTool("avatar")}},{...schema}),actions:(editor,schema)=>(delete schema["insert-embed"],delete schema["insert-media"],schema)}})),[]);return(0,jsx_runtime.jsx)(DrawContextProvider,{renderer,children:(0,jsx_runtime.jsx)(esm.wn,{children:(0,jsx_runtime.jsx)("div",{className:"absolute inset-0",onDragOver:handleDragOver,onDrop:handleDrop,"data-ref":"drawCanvas",children:TLDraw})})})};try{getSvgAsDataUrl.displayName="getSvgAsDataUrl",getSvgAsDataUrl.__docgenInfo={description:"",displayName:"getSvgAsDataUrl",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/draw/src/canvas/DrawCanvas.tsx#getSvgAsDataUrl"]={docgenInfo:getSvgAsDataUrl.__docgenInfo,name:"getSvgAsDataUrl",path:"packages/draw/src/canvas/DrawCanvas.tsx#getSvgAsDataUrl"})}catch(__react_docgen_typescript_loader_error){}try{DrawCanvas.displayName="DrawCanvas",DrawCanvas.__docgenInfo={description:"",displayName:"DrawCanvas",props:{snapshot:{defaultValue:null,description:"",name:"snapshot",required:!1,type:{name:"TLEditorSnapshot"}},onUpdate:{defaultValue:null,description:"",name:"onUpdate",required:!1,type:{name:"((snapshot: TLEditorSnapshot) => void)"}},renderer:{defaultValue:null,description:"",name:"renderer",required:!1,type:{name:"((props: KeyValue) => AnyObject)"}},canvasRef:{defaultValue:null,description:"",name:"canvasRef",required:!1,type:{name:"Ref<{ exportPages: () => Promise<KeyValue[]>; }>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["packages/draw/src/canvas/DrawCanvas.tsx#DrawCanvas"]={docgenInfo:DrawCanvas.__docgenInfo,name:"DrawCanvas",path:"packages/draw/src/canvas/DrawCanvas.tsx#DrawCanvas"})}catch(__react_docgen_typescript_loader_error){}const snapshot_namespaceObject=JSON.parse('{"document":{"store":{"document:document":{"gridSize":10,"name":"","meta":{},"id":"document:document","typeName":"document"},"page:page":{"meta":{},"id":"page:page","name":"Page 1","index":"a1","typeName":"page"},"shape:k93v3RXkwhDffFZ8eV8zp":{"x":327.244140625,"y":165.787109375,"rotation":0,"isLocked":false,"opacity":1,"meta":{},"id":"shape:k93v3RXkwhDffFZ8eV8zp","type":"avatar","props":{"color":"light-blue","fill":"solid","size":"l","font":"draw","text":"Actor 1"},"parentId":"page:page","index":"a1","typeName":"shape"},"shape:FTLP4d4LVKZ7HJ0106C0G":{"x":1249.361328125,"y":160.6328125,"rotation":0,"isLocked":false,"opacity":1,"meta":{},"id":"shape:FTLP4d4LVKZ7HJ0106C0G","type":"avatar","props":{"color":"light-green","fill":"solid","size":"l","font":"draw","text":"Actor 2"},"parentId":"page:page","index":"a2","typeName":"shape"},"shape:TX6_7BUfmBEKSJfBK5TKJ":{"x":714.3515625,"y":96.9140625,"rotation":0,"isLocked":false,"opacity":1,"meta":{},"id":"shape:TX6_7BUfmBEKSJfBK5TKJ","type":"geo","props":{"w":259.46875,"h":172.73828125,"geo":"rectangle","color":"light-red","labelColor":"black","fill":"semi","dash":"draw","size":"s","font":"mono","text":"Some information","align":"middle","verticalAlign":"middle","growY":0,"url":"","scale":1},"parentId":"page:page","index":"a3","typeName":"shape"},"shape:zq4yU5V3sL-FjsqfFl_-Z":{"x":420.75,"y":208.60546875,"rotation":0,"isLocked":false,"opacity":1,"meta":{},"id":"shape:zq4yU5V3sL-FjsqfFl_-Z","type":"arrow","parentId":"page:page","index":"a4","props":{"dash":"draw","size":"l","fill":"semi","color":"blue","labelColor":"black","bend":0,"start":{"x":0,"y":0},"end":{"x":0,"y":0},"arrowheadStart":"none","arrowheadEnd":"arrow","text":"","font":"mono","labelPosition":0.5,"scale":1},"typeName":"shape"},"shape:o-F6HR5017OaijidKadOo":{"x":981.99609375,"y":202.44140625,"rotation":0,"isLocked":false,"opacity":1,"meta":{},"id":"shape:o-F6HR5017OaijidKadOo","type":"arrow","parentId":"page:page","index":"a5","props":{"dash":"draw","size":"l","fill":"semi","color":"green","labelColor":"black","bend":0,"start":{"x":0,"y":0},"end":{"x":0,"y":0},"arrowheadStart":"none","arrowheadEnd":"arrow","text":"","font":"mono","labelPosition":0.5,"scale":1},"typeName":"shape"},"binding:G6PktCkOJzy5xvIPXNet-":{"typeName":"binding","id":"binding:G6PktCkOJzy5xvIPXNet-","type":"arrow","fromId":"shape:zq4yU5V3sL-FjsqfFl_-Z","toId":"shape:k93v3RXkwhDffFZ8eV8zp","meta":{},"props":{"terminal":"start","normalizedAnchor":{"x":0.6115926106770834,"y":0.1811337070610687},"isExact":false,"isPrecise":false}},"binding:QY2SzUmMMx62HnSvEfXM4":{"typeName":"binding","id":"binding:QY2SzUmMMx62HnSvEfXM4","type":"arrow","fromId":"shape:zq4yU5V3sL-FjsqfFl_-Z","toId":"shape:TX6_7BUfmBEKSJfBK5TKJ","meta":{},"props":{"terminal":"end","normalizedAnchor":{"x":0.06693363844393593,"y":0.41459939847583727},"isExact":false,"isPrecise":true}},"binding:ApXbA303dQISWZuJj63_3":{"typeName":"binding","id":"binding:ApXbA303dQISWZuJj63_3","type":"arrow","fromId":"shape:o-F6HR5017OaijidKadOo","toId":"shape:TX6_7BUfmBEKSJfBK5TKJ","meta":{},"props":{"terminal":"start","normalizedAnchor":{"x":0.9430476936047212,"y":0.5725334117274598},"isExact":false,"isPrecise":false}},"binding:XD5ShTd-z2uwRtIxN8EOo":{"typeName":"binding","id":"binding:XD5ShTd-z2uwRtIxN8EOo","type":"arrow","fromId":"shape:o-F6HR5017OaijidKadOo","toId":"shape:FTLP4d4LVKZ7HJ0106C0G","meta":{},"props":{"terminal":"end","normalizedAnchor":{"x":0.5,"y":0.5},"isExact":false,"isPrecise":true}}},"schema":{"schemaVersion":2,"sequences":{"com.tldraw.store":4,"com.tldraw.asset":1,"com.tldraw.camera":1,"com.tldraw.document":2,"com.tldraw.instance":25,"com.tldraw.instance_page_state":5,"com.tldraw.page":1,"com.tldraw.instance_presence":5,"com.tldraw.pointer":1,"com.tldraw.shape":4,"com.tldraw.asset.bookmark":2,"com.tldraw.asset.image":5,"com.tldraw.asset.video":5,"com.tldraw.shape.group":0,"com.tldraw.shape.text":2,"com.tldraw.shape.bookmark":2,"com.tldraw.shape.draw":2,"com.tldraw.shape.geo":9,"com.tldraw.shape.note":7,"com.tldraw.shape.line":5,"com.tldraw.shape.frame":0,"com.tldraw.shape.arrow":5,"com.tldraw.shape.highlight":1,"com.tldraw.shape.embed":4,"com.tldraw.shape.image":4,"com.tldraw.shape.video":2,"com.tldraw.shape.avatar":0,"com.tldraw.shape.audio-card":0,"com.tldraw.shape.image-card":0,"com.tldraw.shape.video-card":0,"com.tldraw.shape.data-card":0,"com.tldraw.shape.file-card":0,"com.tldraw.binding.arrow":0}}},"session":{"version":0,"currentPageId":"page:page","exportBackground":true,"isFocusMode":false,"isDebugMode":false,"isToolLocked":false,"isGridMode":false,"pageStates":[{"pageId":"page:page","camera":{"x":0,"y":0,"z":1},"selectedShapeIds":[],"focusedGroupId":null}]}}'),Playground_stories={component:DrawCanvas,title:"@draw/_Playground_",parameters:{layout:"fullscreen",controls:{exclude:"children"}}},Playground={render:args=>(0,jsx_runtime.jsx)("div",{className:"min-h-[600px]",children:(0,jsx_runtime.jsx)(esm.LM,{children:(0,jsx_runtime.jsx)(DrawCanvas,{...args,snapshot:snapshot_namespaceObject,onUpdate:(0,dist.XI)("onChange")})})}),args:{}},__namedExportsOrder=["Playground"];Playground.parameters={...Playground.parameters,docs:{...Playground.parameters?.docs,source:{originalSource:'{\n  render: args => {\n    return <div className="min-h-[600px]">\n        <Viewport>\n          <DrawCanvas {...args} snapshot={(snapshot as AnyObject)} onUpdate={action("onChange")} />\n        </Viewport>\n      </div>;\n  },\n  args: {}\n}',...Playground.parameters?.docs?.source}}}}}]);